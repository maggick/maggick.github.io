
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="True" name="HandheldFriendly"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="" name="robots"/>
<link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&amp;family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&amp;display=swap" rel="stylesheet"/>
<link href="../../theme/stylesheet/style.min.css" rel="stylesheet" type="text/css"/>
<link href="../../theme/stylesheet/dark-theme.min.css" id="dark-theme-style" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css"/>
<link href="../../theme/pygments/monokai.min.css" id="pygments-dark-theme" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css"/>
<link href="../../theme/pygments/sas.min.css" id="pygments-light-theme" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)" rel="stylesheet" type="text/css"/>
<link href="../../theme/font-awesome/css/fontawesome.css" rel="stylesheet" type="text/css"/>
<link href="../../theme/font-awesome/css/brands.css" rel="stylesheet" type="text/css"/>
<link href="../../theme/font-awesome/css/solid.css" rel="stylesheet" type="text/css"/>
<link href="https://maggick.fr/feeds/all.atom.xml" rel="alternate" title="maggick's logs Atom" type="application/atom+xml"/>
<meta content="maggick" name="author"/>
<meta content="I work on a Windows machine for my dally job. On my personal desktop I use Arch Linux and i3 therefore my music player is in curses and does not need any mouse. In fact I use cmus. So I tried to replace my old media player clementine with cmus on Windows in cygwin. For that we need to compile cmus from sources." name="description"/>
<meta content="cygwin, cmus, programming, windows" name="keywords"/>
<meta content="maggick's logs" property="og:site_name">
<meta content="Compiling cmus for cygwin" property="og:title"/>
<meta content="I work on a Windows machine for my dally job. On my personal desktop I use Arch Linux and i3 therefore my music player is in curses and does not need any mouse. In fact I use cmus. So I tried to replace my old media player clementine with cmus on Windows in cygwin. For that we need to compile cmus from sources." property="og:description"/>
<meta content="en_US" property="og:locale"/>
<meta content="../../2015/01/compiling-cmus-for-cygwin.html" property="og:url"/>
<meta content="article" property="og:type"/>
<meta content="2015-01-21 00:00:00+01:00" property="article:published_time"/>
<meta content="" property="article:modified_time"/>
<meta content="../../author/maggick.html" property="article:author"/>
<meta content="Programming" property="article:section">
<meta content="cygwin" property="article:tag"/>
<meta content="cmus" property="article:tag"/>
<meta content="programming" property="article:tag"/>
<meta content="windows" property="article:tag"/>
<meta content="https://maggick.fr/media/image.png" property="og:image"/>
<title>maggick's logs – Compiling cmus for cygwin</title>
</meta></meta></head>
<body>
<aside>
<div>
<a href="../../">
<img alt="maggick's logs" src="https://maggick.fr/media/image.png" title="maggick's logs"/>
</a>
<h1>
<a href="../../">maggick's logs</a>
</h1>
<p>Offensive security tales</p>
<nav>
<ul class="list">
<li>
<a href="../../pages/about.html" target="_self">
                About
              </a>
</li>
<li>
<a href="../../pages/links.html" target="_self">
                Links
              </a>
</li>
<li>
<a href="../../pages/notes.html" target="_self">
                Notes
              </a>
</li>
<li>
<a href="../../pages/tools.html" target="_self">
                Tools
              </a>
</li>
</ul>
</nav>
<ul class="social">
<li>
<a class="sc-github" href="https://github.com/maggick" target="_blank">
<i class="fa-brands fa-github"></i>
</a>
</li>
<li>
<a class="sc-twitter" href="https://twitter.com/maggick_fr" target="_blank">
<i class="fa-brands fa-twitter"></i>
</a>
</li>
<li>
<a class="sc-stack-overflow" href="http://stackoverflow.com/users/1827067/maggick" target="_blank">
<i class="fa-brands fa-stack-overflow"></i>
</a>
</li>
<li>
<a class="sc-rss" href="https://maggick.fr/feeds/all.atom.xml" target="_blank">
<i class="fa-solid fa-rss"></i>
</a>
</li>
</ul>
</div>
</aside>
<main>
<nav>
<a href="../../">Home</a>
<a href="/archives.html">Archives</a>
<a href="/categories.html">Categories</a>
<a href="/tags.html">Tags</a>
<a href="https://maggick.fr/feeds/all.atom.xml">Atom</a>
</nav>
<article class="single">
<header>
<h1 id="compiling-cmus-for-cygwin">Compiling cmus for cygwin</h1>
<p>
      Posted on 21 Jan 2015 in <a href="../../category/programming.html">Programming</a>

        • 5 min read
    </p>
</header>
<div>
<p><img alt="cmus" class="align-left" src="/media/2015.01/2015.01.cmus.png" width="342"/>
I work on a Windows machine for my dally job.
On my personal desktop I use Arch Linux and i3 therefore my music player is in
curses and does not need any mouse. In fact I use
<a href="https://cmus.github.io/">cmus</a>. So I tried to replace my old media player
<a href="https://www.clementine-player.org/">clementine</a> with
<a href="https://cmus.github.io/">cmus</a> on Windows in <a href="https://www.cygwin.com/">cygwin</a>.</p>
<p>For that we need to compile <a href="https://cmus.github.io/">cmus</a> from sources.</p>
<p><strong>A <a href="https://en.wikipedia.org/wiki/TL;DR">TL;DR</a> is available at the end of
the article.</strong></p>
<p>It is really easy, you just need to download the <code>tar.gz</code> archive, untar it, and
run :</p>
<div class="highlight"><pre><span></span><code>./configure
make
make install
</code></pre></div>
<p>Then <a href="https://cmus.github.io/">cmus</a> will be directly accessible in your
<a href="https://www.cygwin.com/">cygwin</a> environment. You can access a file explorer
by pressing the <code>5</code> key and then navigate through your files and add a folder
to your libarary with the <code>a</code> key. To know more about how to use
<a href="https://cmus.github.io/">cmus</a> please refer to the official documentation.</p>
<p>Okay then why a whole blog post about 3 classical commands ?
Well you may notice that when adding your folder(s) to your library not all your
files are added to it, in fact <a href="https://www.cygwin.com/">cygwin</a> does not
package any mp3 codec so your <code>flac</code> files will be read by
<a href="https://cmus.github.io/">cmus</a> but not the <code>mp3</code> one (as long as you have
install the flac codec).</p>
<p>In oder to read mp3 files with <a href="https://cmus.github.io/">cmus</a> we need to
install (so to build) a library that read this file format: libmad</p>
<h1>libmad</h1>
<p>First of all we need to download the source package from the official web site :
<a href="https://www.underbit.com/products/mad/">http://www.underbit.com/products/mad/</a>
now we extract the files and make the classical commands:</p>
<div class="highlight"><pre><span></span><code>./configure
make
make install
</code></pre></div>
<p>You may encounter the "guess build" error:</p>
<h2>guess error</h2>
<p>This append during the make command</p>
<div class="highlight"><pre><span></span><code><span class="n">configure</span><span class="o">:</span><span class="w"> </span><span class="n">error</span><span class="o">:</span><span class="w"> </span><span class="n">cannot</span><span class="w"> </span><span class="n">guess</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="n">type</span><span class="o">;</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">specify</span><span class="w"> </span><span class="n">one</span>
</code></pre></div>
<p>You may need the <code>automake</code> package and moreover you may need to replace the two
old files config.guess and config.sub from libmad with the new ones downloadable
at : <a href="ftp://ftp.gnu.org/pub/gnu/config/README">ftp://ftp.gnu.org/pub/gnu/config/README</a></p>
<p><strong>An other classical error is the <code>-fforce-memi</code> one:</strong></p>
<h2><code>-fforce-mem</code> gcc error</h2>
<p>This error is characterize by the following trace:</p>
<div class="highlight"><pre><span></span><code><span class="nl">gcc</span><span class="p">:</span><span class="w"> </span><span class="nl">error</span><span class="p">:</span><span class="w"> </span><span class="n">unrecognized</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="k">option</span><span class="w"> </span><span class="s1">'-fforce-mem'</span>
<span class="nl">Makefile</span><span class="p">:</span><span class="mi">383</span><span class="err">:</span><span class="w"> </span><span class="n">recipe</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="s1">'version.lo'</span><span class="w"> </span><span class="n">failed</span>
<span class="n">make</span><span class="o">[</span><span class="n">2</span><span class="o">]</span><span class="err">:</span><span class="w"> </span><span class="o">***</span><span class="w"> </span><span class="o">[</span><span class="n">version.lo</span><span class="o">]</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="mi">1</span>
<span class="n">make</span><span class="o">[</span><span class="n">2</span><span class="o">]</span><span class="err">:</span><span class="w"> </span><span class="n">Leaving</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="s1">'/cygdrive/c/Users/user/Downloads/libmad-0.15.1b'</span>
<span class="nl">Makefile</span><span class="p">:</span><span class="mi">424</span><span class="err">:</span><span class="w"> </span><span class="n">recipe</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="s1">'all-recursive'</span><span class="w"> </span><span class="n">failed</span>
<span class="n">make</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="err">:</span><span class="w"> </span><span class="o">***</span><span class="w"> </span><span class="o">[</span><span class="n">all-recursive</span><span class="o">]</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="mi">1</span>
<span class="n">make</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="err">:</span><span class="w"> </span><span class="n">Leaving</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="s1">'/cygdrive/c/Users/user/Downloads/libmad-0.15.1b'</span>
<span class="nl">Makefile</span><span class="p">:</span><span class="mi">249</span><span class="err">:</span><span class="w"> </span><span class="n">recipe</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="s1">'all'</span><span class="w"> </span><span class="n">failed</span>
<span class="nl">make</span><span class="p">:</span><span class="w"> </span><span class="o">***</span><span class="w"> </span><span class="o">[</span><span class="n">all</span><span class="o">]</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="mi">2</span>
</code></pre></div>
<p>From GCC 4.3 release notes:</p>
<p><em>The -fforce-mem option has been removed because it has had no effect in the
last few GCC releases.</em></p>
<p>So we need to remove this option from our configure script, <a href="https://www.linuxfromscratch.org/blfs/view/svn/multimedia/libmad.html">some people wrote a
patch for it</a>
but it is just a <code>sed</code> command</p>
<div class="highlight"><pre><span></span><code>sed -i '/-fforce-mem/d' configure
</code></pre></div>
<p>We need to redo the 3 basics commands:</p>
<div class="highlight"><pre><span></span><code>./configure
make
make install
</code></pre></div>
<p><strong>At this point you should not have any error, but a classical one is the
missing library error:</strong></p>
<h2>missing library error</h2>
<p>The error is indicating the precise missing library (here <code>libtool</code>):</p>
<div class="highlight"><pre><span></span><code><span class="n">Makefile</span><span class="o">.</span><span class="n">am</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="w"> </span><span class="n">Libtool</span><span class="w"> </span><span class="n">library</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="err">`</span><span class="n">LIBTOOL</span><span class="s1">' is undefined</span>
<span class="n">Makefile</span><span class="o">.</span><span class="n">am</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span>
<span class="n">Makefile</span><span class="o">.</span><span class="n">am</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">usual</span><span class="w"> </span><span class="n">way</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">define</span><span class="w"> </span><span class="err">`</span><span class="n">LIBTOOL</span><span class="s1">' is to add `AC_PROG_LIBTOOL'</span>
<span class="n">Makefile</span><span class="o">.</span><span class="n">am</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="err">`</span><span class="n">configure</span><span class="o">.</span><span class="n">ac</span><span class="s1">' and run `aclocal'</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="err">`</span><span class="n">autoconf</span><span class="s1">' again.</span>
<span class="n">Makefile</span><span class="p">:</span><span class="mi">256</span><span class="p">:</span><span class="w"> </span><span class="n">recipe</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="s1">'Makefile.in'</span><span class="w"> </span><span class="n">failed</span>
<span class="n">make</span><span class="p">:</span><span class="w"> </span><span class="o">***</span><span class="w"> </span><span class="p">[</span><span class="n">Makefile</span><span class="o">.</span><span class="ow">in</span><span class="p">]</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="mi">1</span>
</code></pre></div>
<p>And we just need to install the missing library using <a href="https://www.cygwin.com/">cygwin</a> package manager.</p>
<p><strong>Now we have libmad install in <code>/usr/local/lib/</code></strong></p>
<h1>cmus</h1>
<p>But our installation is not completed we need to recompile
<a href="https://cmus.github.io/">cmus</a> with the support
of this new library and if you just launch the 3 basic commands it will not
work. In fact, gcc does not search libraries in <code>/usr/local</code> by default. We need
to add a flag at the configure step:</p>
<div class="highlight"><pre><span></span><code>.<span class="o">/</span><span class="nv">configure</span><span class="w"> </span><span class="nv">CPPFLAGS</span><span class="o">=-</span><span class="nv">I</span><span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="k">include</span><span class="w"> </span><span class="nv">LDFLAGS</span><span class="o">=-</span><span class="nv">L</span><span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">lib</span>
<span class="nv">make</span>
<span class="nv">make</span><span class="w"> </span><span class="nv">install</span>
</code></pre></div>
<p>And now you can launch <a href="https://cmus.github.io/">cmus</a> and re-add your mp3
files and <strong>it works!</strong></p>
<p>You can still have some erros, mostly with the newest cygwin versions.</p>
<h2>recipe for target 'ape.o' failed</h2>
<p><em>This error was first mention by buzzbo on
<a href="https://github.com/cmus/cmus/issues/343">github</a> and resolved by mahkoh.
Thanks to them.</em></p>
<p>After the <code>./configure</code>, the <code>make</code> may output something like:</p>
<div class="highlight"><pre><span></span><code>   CC     ape.o
In file included from ape.c:23:0:
xmalloc.h: In function 'xstrndup':
xmalloc.h:79:2: error: implicit declaration of function 'strndup' [-Werror=implicit-function-declaration]
  char *s = strndup(str, n);
  ^
xmalloc.h:79:12: warning: incompatible implicit declaration of built-in function 'strndup'
  char *s = strndup(str, n);
            ^
cc1: some warnings being treated as errors
scripts/lib.mk:66: recipe for target 'ape.o' failed
make: *** [ape.o] Error 1
</code></pre></div>
<p>This error is due to an implicit function declaration that is incorrect. Add
this after all the includes of the offending files (<code>xmalloc.h</code>):</p>
<div class="highlight"><pre><span></span><code><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="nf">strndup</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">n</span><span class="p">);</span>
</code></pre></div>
<h3>Workflow - TL;DR</h3>
<p>Here is the <a href="https://en.wikipedia.org/wiki/TL;DR">TL;DR</a>.</p>
<ul>
<li>Cygwin dependencies</li>
<li>flac-devel</li>
<li>
<p>ncurses</p>
</li>
<li>
<p>Install <a href="http://www.underbit.com/products/mad/">libmad</a></p>
</li>
<li>change the <code>config.gess</code> and <code>config.sub</code> files with the one from <a href="http://ftp.gnu.org/gnu/config/README">this readme</a></li>
<li>patch the configuration to not use the <code>-fforce-mem</code> option with sed: <code>sed -i '/-fforce-mem/d' configure</code></li>
<li>
<p>run the 3 classical commands:</p>
<ul>
<li><code>./configure</code></li>
<li><code>make</code></li>
<li><code>make install</code></li>
</ul>
</li>
<li>
<p>Install <a href="https://cmus.github.io/">cmus</a> from source and add the <code>gcc</code> flags to load libraries in /usr/local:</p>
<ul>
<li><code>./configure CPPFLAGS=-I/usr/local/include LDFLAGS=-L/usr/local/lib</code></li>
<li><code>make</code></li>
<li><code>make install</code></li>
</ul>
</li>
</ul>
<p><em>If you run a classical linux distribution to install cmus use <code>aptitude install
cmus</code> or <code>pacman -S cmus</code>. It is so much easier!</em></p>
<h1>Disqus comments</h1>
<p><em>This is a copy of the Disqus comments for this page</em></p>
<p><strong>snapdeus - 2019</strong></p>
<blockquote>
<p>Thanks for this guide! I've been referring to it frequently.</p>
<p>I'm running into an issue trying to get .m4a files to work in cmus.</p>
<p>Have you had success with this?</p>
<p>So far, I've tried including libmp4v2.dll.a in /usr/local/lib, like you did with the libmad.a library, but that did not work.</p>
<p>I'm not aware of a good method for adding libraries to build dependencies - but that is my own fault.</p>
</blockquote>
<p><strong>maggick - 2019</strong></p>
<blockquote>
<p>Hi snapdeus, I didn't use cmus on Windows for a while. Probably the right library to decode .m4a is missing.</p>
</blockquote>
<p><strong>Abhishek upadhyay - 2017</strong></p>
<blockquote>
<p>Thank you very much for this awesome tutorial. I did exactly the same in babun and it worked! LOved it Thank you very much</p>
</blockquote>
<p><strong>James - 2017</strong></p>
<blockquote>
<p>Another post just to say thanks so much for this tutorial.</p>
</blockquote>
<p><strong>AerialB - 2015</strong></p>
<blockquote>
<p>Thank you so much for this. I am forced by circumstance to use Windows atm, and although I like foobar, cmus is just the best.</p>
</blockquote>
<p><strong>Lee - 2015</strong></p>
<blockquote>
<p>Thank you for minimizing a serious headache! Have you managed to get flac compatability figured out? I've not had much luck.</p>
</blockquote>
<p><strong>maggick - 2015</strong></p>
<blockquote>
<p>Thank you for your interest, flac compatibility is given with the flac codec package (the first one in the following capture) directly in the cygwin installer / package manager.</p>
</blockquote>
<p><img alt="cygwin package manager" src="/media/2015.01/cmus_disqus.jpg"/></p>
</div>
<div class="tag-cloud">
<p>
<a href="../../tag/cygwin.html">cygwin</a>
<a href="../../tag/cmus.html">cmus</a>
<a href="../../tag/programming.html">programming</a>
<a href="../../tag/windows.html">windows</a>
</p>
</div>
<div class="neighbors">
<a class="btn float-left" href="../../2014/12/switching-to-horde.html" title="Switching to Horde">
<i class="fa fa-angle-left"></i> Previous Post
    </a>
<a class="btn float-right" href="../../2015/04/first-april-sstic-challenge.html" title="First April SSTIC challenge">
      Next Post <i class="fa fa-angle-right"></i>
</a>
</div>
</article>
<footer>
<p>
  © 2022  - This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/deed.en_US" rel="license" target="_blank">Creative Commons Attribution</a>
</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script data-default-theme="light" data-enable-auto-detect-theme="True" id="dark-theme-script" src="../../theme/dark-theme/dark-theme.min.js" type="text/javascript">
</script>
</p><p>
<a href="http://creativecommons.org/licenses/by/4.0/" rel="license" target="_blank">
<img alt="Creative Commons License" height="15" src="https://i.creativecommons.org/l/by/4.0/80x15.png" style="border-width:0" title="Creative Commons License" width="80">
</img></a>
</p></footer> </main>
<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " maggick's logs ",
  "url" : "../..",
  "image": "https://maggick.fr/media/image.png",
  "description": ""
}
</script>
</body>
</html>