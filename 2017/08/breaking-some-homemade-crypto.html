<!DOCTYPE html>
<html class="no-js">
<head>
    <meta charset="utf-8">
    <title>Breaking some homemade crypto | maggick's logs</title>

    <meta name="author" content="maggick">
    <meta name="description" content="">
    <meta name="robots" content="">
        <meta name="keywords" content="">
        <meta property="og:title" content="">
        <meta property="og:description" content="">
        <meta property="og:url" content="">
        <meta property="og:image" content="">
    <meta property="og:site_name" content="maggick's logs">
    <meta property="og:type" content="website">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="icon" type="image/x-icon" href="https://maggick.fr/media/favicon.ico">

        <link href="feeds/all.atom.xml" rel="alternate" title="maggick's logs" type="application/atom+xml">

    <link rel="canonical" href="">

    <link rel="stylesheet" href="../../theme/css/pure-min.css">
    <link rel="stylesheet" href="../../theme/css/main.css">
</head>
<body>
<div id="page" class="full-entry">
    <header class="pure-g-r header">
        <div class="pure-u-1">
            <div class="wrapper">
                <div class="l-box">
                    <a href="../../index.html" title="Home page"
                            class="logo">maggick's
<span class="secondary">logs</span>                    </a>
                </div>
            </div>

<nav class="pure-menu pure-menu-open pure-menu-horizontal menu">
    <ul>
            <li>
              |
            </li>
                <li>
                    <a href="../../pages/about.html">About</a>
                </li>
                <li>
                    <a href="../../pages/notes.html">Notes</a>
                </li>
    </ul>
</nav>        </div>
    </header>

    <div class="pure-g-r wrapper">
        <section class="content pure-u-17-24">
            <div class="l-box">

<article class="entry">

    <header class="entry-header">
        <h1 class="entry-title">
      <a href="../../2017/08/breaking-some-homemade-crypto.html" title="Read more" class="entry-title-link">
                Breaking some homemade crypto</a>
        </h1>

        <div class="entry-date">
            <time datetime="2017-08-01T18:00:00+02:00">01 Aug 2017</time>
        </div>

    <div class="entry-meta">
      <span class="meta entry-author">
        <span class="icons icons-author"></span>
        <a href="../../author/maggick.html" title="Read more posts from maggick" class="meta-link">maggick</a>
      </span>

      <span class="meta entry-tags">
        <span class="icons icons-category"></span>
          <a href="../../tag/security.html" title="Read more with the label security" class="meta-link">security</a> 
          <a href="../../tag/cryptography.html" title="Read more with the label cryptography" class="meta-link">cryptography</a> 
          <a href="../../tag/code-review.html" title="Read more with the label code review" class="meta-link">code review</a> 
      </span>
              <span class="meta entry-tags">
              <p style="text-align:right; color:#aaaaaa; ">&nbsp Estimated read time: 4 minutes</p></span>
    </div>
    </header>

    <div class="entry-content">
            <p>I recently did a code review assessment on an application for one of my client.
The best part of the application was their own cryptography algorithm.</p>
<p>Moreover, the application was written in PHP and PHP do some strange things with
string, characters and XOR operations.
It only needed a few lines of python in order to break it.</p>
<p>TL;DR : <strong>please do not write your own crypto!</strong></p>


<p>The cryptography algorithm was a symmetric one, that means there is always a
private key shared between the encryption and the decryption. In fact the
key was shared for the application.</p>
<h2 id="encryption-algorithm">Encryption algorithm</h2>
<p>The encryption algorithm is the following (I rewrote it in python for a better
comprehension):</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="k">def</span> <span class="nf">crypt</span><span class="p">(</span><span class="n">clearText</span><span class="p">):</span></span>
<span class="code-line">    <span class="n">privateKey</span> <span class="o">=</span> <span class="s1">&#39;123456&#39;</span></span>
<span class="code-line">    <span class="n">cipherText</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">key</span><span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">32000</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span></span>
<span class="code-line">    <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span></span>
<span class="code-line">    <span class="k">while</span> <span class="p">(</span><span class="n">i</span><span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">clearText</span><span class="p">)):</span></span>
<span class="code-line">        <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)):</span></span>
<span class="code-line">            <span class="n">j</span><span class="o">=</span><span class="mi">0</span></span>
<span class="code-line">        <span class="n">cipherText</span> <span class="o">+=</span> <span class="n">key</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">clearText</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">^</span><span class="nb">ord</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span></span>
<span class="code-line">        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span></span>
<span class="code-line">        <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">key2</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">privateKey</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span></span>
<span class="code-line">    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span></span>
<span class="code-line">    <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span></span>
<span class="code-line">    <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">while</span> <span class="p">(</span><span class="n">i</span><span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">cipherText</span><span class="p">)):</span></span>
<span class="code-line">        <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">key2</span><span class="p">)):</span></span>
<span class="code-line">            <span class="n">j</span><span class="o">=</span><span class="mi">0</span></span>
<span class="code-line">        <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">cipherText</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">^</span> <span class="nb">ord</span><span class="p">(</span><span class="n">key2</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span></span>
<span class="code-line">        <span class="n">i</span><span class="o">+=</span><span class="mi">1</span></span>
<span class="code-line">        <span class="n">j</span><span class="o">+=</span><span class="mi">1</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">return</span> <span class="n">result</span></span>
<span class="code-line"></code></pre></div>

<p>We observe that there is only XOR operations. Quick reminder about XOR
operations:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="mf">0</span><span class="w"> </span><span class="n">XOR</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="w"></span></span>
<span class="code-line"><span class="mf">0</span><span class="w"> </span><span class="n">XOR</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="w"></span></span>
<span class="code-line"><span class="mf">1</span><span class="w"> </span><span class="n">XOR</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="w"></span></span>
<span class="code-line"><span class="mf">1</span><span class="w"> </span><span class="n">XOR</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="w"></span></span>
<span class="code-line"></code></pre></div>

<p>Moreover, by definition: <code>a XOR b XOR a = b</code></p>
<h2 id="breaking-things">Breaking things</h2>
<p>In our situation we need to find <code>cipherText</code> in order to find the md5 hash of
the private key. However <code>cipherText</code> is build using the clear text and a random
number included between 0 and 32 000. Therefore by a
<a href="https://en.wikipedia.org/wiki/Known-plaintext_attack">Known-plaintext attack</a>
we can generate the 32 001 values of <code>cipherText</code>, XOR it with the encrypted
string, search for the resulting sting which will be repeating every 36
characters and get the md5 hash of the private key. Our only constrain in that
the plain text must be longer than 36 characters in order to easily find the md5
hash (an other option might have be to search for ascii characters).</p>
<p>Here is the python code:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">brute</span><span class="p">()</span><span class="err">:</span><span class="w"></span></span>
<span class="code-line"><span class="w">    </span><span class="n">clearText</span><span class="o">=</span><span class="s1">&#39;this is a test in order to break some home made crypto&#39;</span><span class="w"></span></span>
<span class="code-line"><span class="w">    </span><span class="n">codedText</span><span class="o">=</span><span class="n">crypt</span><span class="p">(</span><span class="n">clearText</span><span class="p">)</span><span class="w"></span></span>
<span class="code-line"><span class="w">    </span><span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="w"></span></span>
<span class="code-line"><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="o">&lt;</span><span class="mi">32001</span><span class="p">)</span><span class="err">:</span><span class="w"></span></span>
<span class="code-line"><span class="w">        </span><span class="k">key</span><span class="o">=</span><span class="w"> </span><span class="n">hashlib</span><span class="p">.</span><span class="n">md5</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">k</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)).</span><span class="n">hexdigest</span><span class="p">()</span><span class="w"></span></span>
<span class="code-line"><span class="w">        </span><span class="n">cipherText</span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"></span></span>
<span class="code-line"></span>
<span class="code-line"><span class="w">        </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span></span>
<span class="code-line"><span class="w">        </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span></span>
<span class="code-line"><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">clearText</span><span class="p">))</span><span class="err">:</span><span class="w"></span></span>
<span class="code-line"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="k">key</span><span class="p">))</span><span class="err">:</span><span class="w"></span></span>
<span class="code-line"><span class="w">                </span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="w"></span></span>
<span class="code-line"><span class="w">            </span><span class="n">cipherText</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">key</span><span class="o">[</span><span class="n">j</span><span class="o">]+</span><span class="n">chr</span><span class="p">(</span><span class="n">ord</span><span class="p">(</span><span class="n">clearText</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span><span class="o">^</span><span class="n">ord</span><span class="p">(</span><span class="k">key</span><span class="o">[</span><span class="n">j</span><span class="o">]</span><span class="p">))</span><span class="w"></span></span>
<span class="code-line"><span class="w">            </span><span class="n">i</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span></span>
<span class="code-line"><span class="w">            </span><span class="n">j</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span></span>
<span class="code-line"></span>
<span class="code-line"><span class="w">        </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span></span>
<span class="code-line"><span class="w">        </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span></span>
<span class="code-line"><span class="w">        </span><span class="k">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"></span></span>
<span class="code-line"></span>
<span class="code-line"><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">codedText</span><span class="p">))</span><span class="err">:</span><span class="w"></span></span>
<span class="code-line"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">cipherText</span><span class="p">))</span><span class="err">:</span><span class="w"></span></span>
<span class="code-line"><span class="w">                </span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="w"></span></span>
<span class="code-line"><span class="w">            </span><span class="k">result</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">chr</span><span class="p">(</span><span class="n">ord</span><span class="p">(</span><span class="n">codedText</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="n">ord</span><span class="p">(</span><span class="n">cipherText</span><span class="o">[</span><span class="n">j</span><span class="o">]</span><span class="p">))</span><span class="w"></span></span>
<span class="code-line"><span class="w">            </span><span class="n">i</span><span class="o">+=</span><span class="mi">1</span><span class="w"></span></span>
<span class="code-line"><span class="w">            </span><span class="n">j</span><span class="o">+=</span><span class="mi">1</span><span class="w"></span></span>
<span class="code-line"><span class="w">        </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span></span>
<span class="code-line"><span class="w">        </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span></span>
<span class="code-line"><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="o">&lt;</span><span class="mi">32</span><span class="p">)</span><span class="err">:</span><span class="w"></span></span>
<span class="code-line"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">result</span><span class="o">[</span><span class="n">l</span><span class="o">]==</span><span class="k">result</span><span class="o">[</span><span class="n">l+32</span><span class="o">]</span><span class="p">)</span><span class="err">:</span><span class="w"></span></span>
<span class="code-line"><span class="w">                </span><span class="n">s</span><span class="w"> </span><span class="o">+=</span><span class="mi">1</span><span class="w"></span></span>
<span class="code-line"><span class="w">            </span><span class="n">l</span><span class="o">+=</span><span class="mi">1</span><span class="w"></span></span>
<span class="code-line"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">s</span><span class="o">==</span><span class="mi">32</span><span class="err">:</span><span class="w"></span></span>
<span class="code-line"><span class="w">            </span><span class="k">print</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"></span></span>
<span class="code-line"><span class="w">            </span><span class="k">print</span><span class="p">(</span><span class="k">result</span><span class="o">[</span><span class="n">:32</span><span class="o">]</span><span class="p">)</span><span class="w"></span></span>
<span class="code-line"><span class="w">            </span><span class="k">break</span><span class="w"></span></span>
<span class="code-line"><span class="w">        </span><span class="n">k</span><span class="o">+=</span><span class="mi">1</span><span class="w"></span></span>
<span class="code-line"></code></pre></div>

<p>I put the two function in a file, added a main and run it:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="o">[</span><span class="n">maggick@eridani ~</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="nc">time</span><span class="w"> </span><span class="n">python</span><span class="w"> </span><span class="n">crypt</span><span class="p">.</span><span class="n">py</span><span class="w"></span></span>
<span class="code-line"><span class="mi">23467</span><span class="w"></span></span>
<span class="code-line"><span class="n">e10adc3949ba59abbe56e057f20f883e</span><span class="w"></span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nc">real</span><span class="w">    </span><span class="mi">0</span><span class="n">m2</span><span class="mf">.186</span><span class="n">s</span><span class="w"></span></span>
<span class="code-line"><span class="k">user</span><span class="w">    </span><span class="mi">0</span><span class="n">m2</span><span class="mf">.186</span><span class="n">s</span><span class="w"></span></span>
<span class="code-line"><span class="n">sys</span><span class="w"> </span><span class="mi">0</span><span class="n">m0</span><span class="mf">.000</span><span class="n">s</span><span class="w"></span></span>
<span class="code-line"><span class="o">[</span><span class="n">maggick@eridani ~</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">echo</span><span class="w"> </span><span class="o">-</span><span class="n">en</span><span class="w"> </span><span class="s1">&#39;123456&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">md5sum</span><span class="w"></span></span>
<span class="code-line"><span class="n">e10adc3949ba59abbe56e057f20f883e</span><span class="w">  </span><span class="o">-</span><span class="w"></span></span>
<span class="code-line"></code></pre></div>

<p>We got the md5 hash of the private key. The default key used in the application
was 8 characters long and was use in other algorithms not home made.</p>
<h2 id="php-character-xor-character">PHP: character XOR character</h2>
<p>PHP is doing really funny things, most of you know that.
When analysing the original PHP code of the encryption function, I found
something very strange:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="x">$tmp .= mb_substr($text, $i, 1) ^ mb_substr($key, $j, 1);</span></span>
<span class="code-line"></code></pre></div>

<p>How can you make a xor operation between two characters?!</p>
<p>In fact PHP make a xor operation between the ASCII value of the character and
convert the result back to the ASCII character. For instance <code>'a' xor 'B'</code> will
result in <code>65 xor 98</code> which give <code>35</code> therefore <code>'a' xor 'B' â†’ '#'</code></p>
<p>As you may have seen in the above code this is equivalent to the following
python code:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="n">tmp</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">clearText</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">^</span><span class="nb">ord</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span></span>
<span class="code-line"></code></pre></div>

<h2 id="full-code">Full code</h2>
<p>The complete code is the following:</p>
<div class="highlight"><pre><span class="code-line"><span></span><code><span class="kn">import</span> <span class="nn">hashlib</span></span>
<span class="code-line"><span class="kn">import</span> <span class="nn">base64</span></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">def</span> <span class="nf">crypt</span><span class="p">(</span><span class="n">clearText</span><span class="p">):</span></span>
<span class="code-line">    <span class="n">privateKey</span> <span class="o">=</span> <span class="s1">&#39;123456&#39;</span></span>
<span class="code-line">    <span class="n">cipherText</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">key</span><span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">32000</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span></span>
<span class="code-line">    <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span></span>
<span class="code-line">    <span class="k">while</span> <span class="p">(</span><span class="n">i</span><span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">clearText</span><span class="p">)):</span></span>
<span class="code-line">        <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)):</span></span>
<span class="code-line">            <span class="n">j</span><span class="o">=</span><span class="mi">0</span></span>
<span class="code-line">        <span class="n">cipherText</span> <span class="o">+=</span> <span class="n">key</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">clearText</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">^</span><span class="nb">ord</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span></span>
<span class="code-line">        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span></span>
<span class="code-line">        <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">key2</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">privateKey</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span></span>
<span class="code-line">    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span></span>
<span class="code-line">    <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span></span>
<span class="code-line">    <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">while</span> <span class="p">(</span><span class="n">i</span><span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">cipherText</span><span class="p">)):</span></span>
<span class="code-line">        <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">key2</span><span class="p">)):</span></span>
<span class="code-line">            <span class="n">j</span><span class="o">=</span><span class="mi">0</span></span>
<span class="code-line">        <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">cipherText</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">^</span> <span class="nb">ord</span><span class="p">(</span><span class="n">key2</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span></span>
<span class="code-line">        <span class="n">i</span><span class="o">+=</span><span class="mi">1</span></span>
<span class="code-line">        <span class="n">j</span><span class="o">+=</span><span class="mi">1</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">return</span> <span class="n">result</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">def</span> <span class="nf">brute</span><span class="p">():</span></span>
<span class="code-line">    <span class="n">clearText</span><span class="o">=</span><span class="s1">&#39;this is a test in order to break some home made crypto&#39;</span></span>
<span class="code-line">    <span class="n">codedText</span><span class="o">=</span><span class="n">crypt</span><span class="p">(</span><span class="n">clearText</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">k</span><span class="o">=</span><span class="mi">0</span></span>
<span class="code-line">    <span class="k">while</span> <span class="p">(</span><span class="n">k</span><span class="o">&lt;</span><span class="mi">32001</span><span class="p">):</span></span>
<span class="code-line">        <span class="n">key</span><span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span></span>
<span class="code-line">        <span class="n">cipherText</span><span class="o">=</span> <span class="s1">&#39;&#39;</span></span>
<span class="code-line"></span>
<span class="code-line">        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span></span>
<span class="code-line">        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span></span>
<span class="code-line">        <span class="k">while</span> <span class="p">(</span><span class="n">i</span><span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">clearText</span><span class="p">)):</span></span>
<span class="code-line">            <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)):</span></span>
<span class="code-line">                <span class="n">j</span><span class="o">=</span><span class="mi">0</span></span>
<span class="code-line">            <span class="n">cipherText</span> <span class="o">+=</span> <span class="n">key</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">clearText</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">^</span><span class="nb">ord</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span></span>
<span class="code-line">            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span></span>
<span class="code-line">            <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span></span>
<span class="code-line">        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span></span>
<span class="code-line">        <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span></span>
<span class="code-line"></span>
<span class="code-line">        <span class="k">while</span> <span class="p">(</span><span class="n">i</span><span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">codedText</span><span class="p">)):</span></span>
<span class="code-line">            <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">cipherText</span><span class="p">)):</span></span>
<span class="code-line">                <span class="n">j</span><span class="o">=</span><span class="mi">0</span></span>
<span class="code-line">            <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">codedText</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">^</span> <span class="nb">ord</span><span class="p">(</span><span class="n">cipherText</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span></span>
<span class="code-line">            <span class="n">i</span><span class="o">+=</span><span class="mi">1</span></span>
<span class="code-line">            <span class="n">j</span><span class="o">+=</span><span class="mi">1</span></span>
<span class="code-line">        <span class="n">l</span> <span class="o">=</span> <span class="mi">0</span></span>
<span class="code-line">        <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span></span>
<span class="code-line">        <span class="k">while</span> <span class="p">(</span><span class="n">l</span><span class="o">&lt;</span><span class="mi">32</span><span class="p">):</span></span>
<span class="code-line">            <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">==</span><span class="n">result</span><span class="p">[</span><span class="n">l</span><span class="o">+</span><span class="mi">32</span><span class="p">]):</span></span>
<span class="code-line">                <span class="n">s</span> <span class="o">+=</span><span class="mi">1</span></span>
<span class="code-line">            <span class="n">l</span><span class="o">+=</span><span class="mi">1</span></span>
<span class="code-line">        <span class="k">if</span> <span class="n">s</span><span class="o">==</span><span class="mi">32</span><span class="p">:</span></span>
<span class="code-line">            <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">)</span></span>
<span class="code-line">            <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">[:</span><span class="mi">32</span><span class="p">])</span></span>
<span class="code-line">            <span class="k">break</span></span>
<span class="code-line">        <span class="n">k</span><span class="o">+=</span><span class="mi">1</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span></span>
<span class="code-line">    <span class="n">brute</span><span class="p">()</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span></span>
<span class="code-line">    <span class="n">main</span><span class="p">()</span></span>
<span class="code-line"></code></pre></div>
    </div>

      <footer>
          <div>
            <b>Previous article:</b> <a href="../../2017/03/building-this-blog-with-travis.html"> Building this blog with travis </a>
          </div>
          <div>
            <b>Next article:</b> <a href="../../2017/11/vulnhub-bulldog-1.html"> Vulnhub, Bulldog: 1 </a>
          </div>

<div class="social-buttons">


</div>
      </footer>


    <div class="clearfix"></div>

</article>
<!-- /.entry -->
            </div>
        </section>

        <aside class="sidebar pure-u-7-24">
            <div class="l-box">
    <section class="module menuitems">
        <h3 class="title module-title">Menu</h3>

        <ul>
                <li>
                    <span class= "icons icons-archives"></span>
                    <a href="/archives">archives</a>
                </li>
                <li>
                    <span class= "icons icons-feeds"></span>
                    <a href="/feeds/all.atom.xml">feeds</a>
                </li>
                <li>
                    <span class= "icons icons-links"></span>
                    <a href="/pages/links.html">links</a>
                </li>
        </ul>
    </section>

    <section class="module social">
        <h3 class="title module-title">Social</h3>

        <ul>
                <li>
                    <span class= "icons icons-github"></span>
                    <a href="https://github.com/maggick">github</a>
                </li>
                <li>
                    <span class= "icons icons-twitter"></span>
                    <a href="https://twitter.com/maggick_fr">twitter</a>
                </li>
                <li>
                    <span class= "icons icons-stackoverflow"></span>
                    <a href="http://stackoverflow.com/users/1827067/maggick">stackoverflow</a>
                </li>
        </ul>
    </section>


<section class="module tagcloud">
    <h3 class="title module-title">Tags</h3>

    <ul>
            <li class="tag tag-4">
              <a href="../../tag/upload.html">Upload</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/impacket.html">impacket</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/azure.html">Azure</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/screen.html">screen</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/openadmin.html">openAdmin</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/programming.html">programming</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/chef.html">chef</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/phs.html">PHS</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/challenge.html">challenge</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/msfconsole.html">msfconsole</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/cewl.html">cewl</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/pypi.html">pypi</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/deserialization.html">deserialization</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/crypto.html">Crypto</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/android.html">Android</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/snmp.html">snmp</a>
            </li>
            <li class="tag tag-1">
              <a href="../../tag/boot2root.html">boot2root</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/misc.html">misc</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/webassembly.html">webassembly</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/neofetch.html">neofetch</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/umbraco.html">umbraco</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/cve-2019-5736.html">CVE-2019-5736</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/jackson.html">jackson</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/lfi.html">lfi</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/docker.html">docker</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/drupalgeddon.html">Drupalgeddon</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/composer.html">composer</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/reverse.html">reverse</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/phone-number.html">phone number</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/metasploit.html">metasploit</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/javascript.html">javascript</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/cryptocurrency.html">cryptocurrency</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/nmap.html">nmap</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/smb.html">SMB</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/ldap.html">LDAP</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/ssrf.html">SSRF</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/sudo.html">sudo</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/nft.html">NFT</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/devops.html">devops</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/python.html">python</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/adb.html">adb</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/git.html">git</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/windows.html">windows</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/john.html">john</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/vnc.html">VNC</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/memcache.html">memcache</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/osint.html">osint</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/iot.html">IOT</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/blog.html">blog</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/ctf.html">CTF</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/winrm.html">winrm</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/vulnhub.html">vulnhub</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/teamviewer.html">teamviewer</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/lxd.html">lxd</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/vb.html">VB</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/msfvenom.html">msfvenom</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/strapi.html">strapi</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/subdomain.html">subdomain</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/zip.html">zip</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/chisel.html">chisel</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/php-filter.html">php filter</a>
            </li>
            <li class="tag tag-1">
              <a href="../../tag/security.html">security</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/vault.html">vault</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/logrotate.html">logrotate</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/scf-file-attack.html">SCF file attack</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/gitlab.html">gitlab</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/bludit.html">bludit</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/xxe.html">XXE</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/xss.html">XSS</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/capabilities.html">capabilities</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/cloudme.html">cloudme</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/imagemagick.html">ImageMagick</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/print-nightmare.html">print nightmare</a>
            </li>
            <li class="tag tag-1">
              <a href="../../tag/linux.html">linux</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/php.html">php</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/laravel.html">laravel</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/suid.html">suid</a>
            </li>
            <li class="tag tag-1">
              <a href="../../tag/htb.html">HTB</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/ad-recycle-bin.html">AD Recycle bin</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/splunk.html">Splunk</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/alwaysinstallelevated.html">AlwaysInstallElevated</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/jwt.html">jwt</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/gdbserver.html">gdbserver</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/exiftool.html">exiftool</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/wordpress.html">wordpress</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/exploit.html">exploit</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/lxc.html">lxc</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/path.html">PATH</a>
            </li>
            <li class="tag tag-2">
              <a href="../../tag/cve.html">CVE</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/enumeration.html">enumeration</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/openemr.html">openEMR</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/core-dump.html">core dump</a>
            </li>
            <li class="tag tag-3">
              <a href="../../tag/sqli.html">SQLi</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/ssti.html">SSTI</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/openbsd.html">OpenBSD</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/adminer.html">adminer</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/pandora.html">pandora</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/yaml.html">YAML</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/phishing.html">phishing</a>
            </li>
            <li class="tag tag-4">
              <a href="../../tag/tomcat.html">tomcat</a>
            </li>
    </ul>
</section>

            </div>
        </aside>
    </div>

    <section class="pure-g-r footer">
<div class="pure-u-2-3 copyright">
    <p class="l-box">
        The content of this blog in under
        <a href="https://creativecommons.org/licenses/by/4.0/"
            title="Share, adapt, use. But mention the author.">Creative Commons Attribution 4.0</a> License.

        The source code is available on <a href="https://github.com/maggick/maggick.github.io/" title="Contribute through GitHub">GitHub</a>.
    </p>
</div>

<div class="pure-u-1-3 credits">
    <p class="l-box">
        Design by <a href="http://www.templateify.com/" title="Maggner Theme">Templateify</a>.
    </p>
</div>    </section>


</div>
</body>
</html>