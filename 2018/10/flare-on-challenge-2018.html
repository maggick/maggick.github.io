
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="../../theme/stylesheet/style.min.css">

    <link id="dark-theme-style" rel="stylesheet" type="text/css"
          media="(prefers-color-scheme: dark)"
    href="../../theme/stylesheet/dark-theme.min.css">

    <link id="pygments-dark-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: dark)"
          href="../../theme/pygments/monokai.min.css">
    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"
          href="../../theme/pygments/sas.min.css">


  <link rel="stylesheet" type="text/css" href="../../theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="../../theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="../../theme/font-awesome/css/solid.css">


    <link href="https://maggick.fr/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="maggick's logs Atom">



  


 

<meta name="author" content="maggick" />
<meta name="description" content="The fifth edition of the FireEye&#39;s Flare-on reverse challenge take place this year between august 24th and the 5th octobe with a total of 12 challenges centered on Windows binaries." />
<meta name="keywords" content="security, reverse">


  <meta property="og:site_name" content="maggick's logs"/>
  <meta property="og:title" content="Flare-on Challenge 2018"/>
  <meta property="og:description" content="The fifth edition of the FireEye&#39;s Flare-on reverse challenge take place this year between august 24th and the 5th octobe with a total of 12 challenges centered on Windows binaries."/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="../../2018/10/flare-on-challenge-2018.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2018-10-07 11:43:00+02:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="../../author/maggick.html">
  <meta property="article:section" content="security"/>
  <meta property="article:tag" content="security"/>
  <meta property="article:tag" content="reverse"/>
  <meta property="og:image" content="https://maggick.fr/media/image.png">

  <title>maggick's logs &ndash; Flare-on Challenge 2018</title>

</head>
<body >
  <aside>
    <div>
      <a href="../../">
        <img src="https://maggick.fr/media/image.png" alt="" title="">
      </a>

      <h1>
        <a href="../../"></a>
      </h1>



      <nav>
        <ul class="list">


              <li>
                <a target="_self"
                   href="../../pages/about.html">
                  About
                </a>
              </li>
              <li>
                <a target="_self"
                   href="../../pages/notes.html">
                  Notes
                </a>
              </li>
              <li>
                <a target="_self"
                   href="../../pages/tools.html">
                  Tools
                </a>
              </li>

        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-github" href="https://github.com/maggick" target="_blank">
              <i class="fab fa-github"></i>
            </a>
          </li>
          <li>
            <a  class="sc-twitter" href="https://twitter.com/maggick_fr" target="_blank">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
          <li>
            <a  class="sc-stack-overflow" href="http://stackoverflow.com/users/1827067/maggick" target="_blank">
              <i class="fab fa-stack-overflow"></i>
            </a>
          </li>
          <li>
            <a  class="sc-rss" href="https://maggick.fr/feeds/all.atom.xml" target="_blank">
              <i class="fas fa-rss"></i>
            </a>
          </li>
      </ul>
    </div>

  </aside>
  <main>

    <nav>
      <a href="../../">Home</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>

      <a href="https://maggick.fr/feeds/all.atom.xml">Atom</a>

    </nav>

<article class="single">
  <header>
      
    <h1 id="flare-on-challenge-2018">Flare-on Challenge 2018</h1>
    <p>
      Posted on 07 Oct 2018 in <a href="../../category/security.html">security</a>

        &#8226; 4 min read
    </p>
  </header>


  <div>
    <p>The fifth edition of the FireEye's Flare-on reverse challenge take place this year between
august 24th and the 5th octobe with a total of 12 challenges centered on Windows
binaries.</p>


<h2>Minesweeper Championship Registration</h2>
<blockquote>
<p>Welcome to the Fifth Annual Flare-On Challenge! The Minesweeper World
Championship is coming soon and we found the registration app. You weren't
officially invited but if you can figure out what the code is you can probably
get in anyway. Good luck!</p>
</blockquote>
<p><a href="/media/2018.10/flare/MinesweeperChampionshipRegistration.7z">Download the challenge</a></p>
<p>We download the 7z and after extraction we got the jar.
We start jd-gui and load the jar.
The <code>InviteValidator</code> class is the following:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">javax.swing.JOptionPane</span><span class="p">;</span><span class="w"></span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">InviteValidator</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JOptionPane</span><span class="p">.</span><span class="na">showInputDialog</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Enter your invitation code:&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Minesweeper Championship 2018&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;GoldenTicket2018@flare-on.com&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">JOptionPane</span><span class="p">.</span><span class="na">showMessageDialog</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Welcome to the Minesweeper Championship 2018!\nPlease enter the following code to the ctfd.flare-on.com website to compete:\n\n&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">response</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Success!&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">JOptionPane</span><span class="p">.</span><span class="na">showMessageDialog</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Incorrect invitation code. Please try again next year.&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Failure&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>We directly got the challenge flag <code>GoldenTicket2018@flare-on.com</code>.</p>
<h2>Ultimate Minesweeper</h2>
<blockquote>
<p>You hacked your way into the Minesweeper Championship, good job. Now its time to
compete. Here is the Ultimate Minesweeper binary. Beat it, win the championship,
and we'll move you on to greater challenges.</p>
</blockquote>
<p><a href="/media/2018.10/flare/UltimateMinesweeper.7z">Download the challenge</a></p>
<p>Once unzip the file is a 32bits executable binary.
    $ file UltimateMinesweeper.exe
    UltimateMinesweeper.exe: PE32 executable (GUI) Intel 80386 Mono/.Net assembly, for MS Windows</p>
<p>When executed the program is similar to every Minesweeper execpt there is a LOT
of mines! Only 3 squares of the 900 are not mines. The goal is to reveal this 3
squares with exploding on a mine.</p>
<p><img alt="Capture4.PNG" src="/media/2018.10/Capture4.PNG"></p>
<p>We can use a tool like <a href="https://github.com/0xd4d/dnSpy">DnSpy</a> to decompile the
.NET and access the source code.</p>
<p><img alt="Capture5.PNG" src="/media/2018.10/Capture5.PNG"></p>
<p>We can even recompile the code. Nevertheless , the line 156 will fire a
compilation error. In order to fix it, we need to convert the value to byte:</p>
<div class="highlight"><pre><span></span><code>array3[(int)num2] = (byte)(array3[(int)num2] ^ array[(int)num]);
</code></pre></div>

<p>We can for instance disable the failure when revealing a mine by changing the
code of the <code>BombRevealed</code> function and make it always return <code>false</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nv">public</span> <span class="nv">bool</span> <span class="nv">BombRevealed</span>
{
  <span class="nv">get</span>
  {
    <span class="nv">int</span> <span class="nv">num</span> <span class="o">=</span> <span class="mi">0</span><span class="c1">;</span>
    <span class="k">while</span> <span class="ss">((</span><span class="nv">long</span><span class="ss">)</span><span class="nv">num</span> <span class="o">&lt;</span> <span class="ss">(</span><span class="nv">long</span><span class="ss">)((</span><span class="nv">ulong</span><span class="ss">)</span><span class="nv">this</span>.<span class="nv">Size</span><span class="ss">))</span>
    {
      <span class="nv">int</span> <span class="nv">num2</span> <span class="o">=</span> <span class="mi">0</span><span class="c1">;</span>
      <span class="k">while</span> <span class="ss">((</span><span class="nv">long</span><span class="ss">)</span><span class="nv">num2</span> <span class="o">&lt;</span> <span class="ss">(</span><span class="nv">long</span><span class="ss">)((</span><span class="nv">ulong</span><span class="ss">)</span><span class="nv">this</span>.<span class="nv">Size</span><span class="ss">))</span>
      {
        <span class="k">if</span> <span class="ss">(</span><span class="nv">this</span>.<span class="nv">MinesPresent</span>[<span class="nv">num2</span>, <span class="nv">num</span>] <span class="o">&amp;&amp;</span> <span class="nv">this</span>.<span class="nv">MinesVisible</span>[<span class="nv">num2</span>, <span class="nv">num</span>]<span class="ss">)</span>
        {
          <span class="k">return</span> <span class="nv">false</span><span class="c1">;</span>
        }
        <span class="nv">num2</span><span class="o">++</span><span class="c1">;</span>
      }
      <span class="nv">num</span><span class="o">++</span><span class="c1">;</span>
    }
    <span class="k">return</span> <span class="nv">false</span><span class="c1">;</span>
  }
}
</code></pre></div>

<p>Then we can clic on every square and get the Success message.</p>
<p><img alt="Capture2.PNG" src="/media/2018.10/Capture2.PNG"></p>
<p>The flag seems to be encoded. When looking at the function <code>GetKey</code> we see that
the <code>Random</code> is build using a seed depending of the revealed cells.</p>
<p>We then discover that the mines (and more importently the 3 empty squares) are
always at the same place. So we can just found the position of every empty
squares with our modified binary.</p>
<p><img alt="Capture.PNG" src="/media/2018.10/Capture.PNG"></p>
<p>And then just reveal this three squares in order to get the Success message with
the flag.</p>
<p><img alt="Capture3.PNG" src="/media/2018.10/Capture3.PNG"></p>
<h2>FLEGGO</h2>
<blockquote>
<p>When you are finished with your media interviews and talk show appearances after
that crushing victory at the Minesweeper Championship, I have another task for
you. Nothing too serious, as you'll see, this one is child's play.</p>
</blockquote>
<p><a href="/media/2018.10/flare/FLEGGO.7z">Download the challenge</a></p>
<p>Once extraxted we get 48 executables. Each binary is a 32bits executable.</p>
<div class="highlight"><pre><span></span><code>$ file ./*
./1BpnGjHOT7h5vvZsV4vISSb60Xj3pX5G.exe: PE32 executable <span class="o">(</span>console<span class="o">)</span> Intel <span class="m">80386</span>, <span class="k">for</span> MS Window
</code></pre></div>

<p>When launching any of the executable we get an error about the VCRUNTIME140 DLL
missing.</p>
<p><img alt="Capture6.PNG" src="/media/2018.10/Capture6.PNG"></p>
<p>To fix this you just need to install Visual Studio Community Edition.</p>
<p>After a few try using IDA and OllyDBG, I found a hint on <a href="https://twitter.com/ixSly/status/1034842534957203456">twitter</a>:
<img alt="Capture7.PNG" src="/media/2018.10/Capture7.PNG"></p>
<div class="highlight"><pre><span></span><code>FLOSS static UTF-16 strings
@BRICK
%s\%s
IronManSucks
Oh, hello Batman...
I super hate you right now.
What is the password?
%15ls
Go step on a brick!
Oh look a rainbow.
Everything is awesome!
%s =&gt; %s
BRICK
ZImIT7DyCMOeF6


FLOSS decoded 0 strings

FLOSS extracted 0 stackstrings

Finished execution after 2.266808 seconds
</code></pre></div>

<p>The binary password is given just after the <code>BRICK</code> string.</p>
<div class="highlight"><pre><span></span><code><span class="n">root</span><span class="nv">@kalili</span><span class="err">:</span><span class="o">~/</span><span class="k">work</span><span class="o">/</span><span class="n">fleggo</span><span class="err">#</span><span class="w"> </span><span class="n">wine</span><span class="w"> </span><span class="mi">1</span><span class="n">BpnGjHOT7h5vvZsV4vISSb60Xj3pX5G</span><span class="p">.</span><span class="n">exe</span><span class="w"></span>
<span class="mi">000</span><span class="nl">f</span><span class="p">:</span><span class="nl">err</span><span class="p">:</span><span class="nl">service</span><span class="p">:</span><span class="n">process_send_command</span><span class="w"> </span><span class="n">receiving</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="k">result</span><span class="w"> </span><span class="n">timed</span><span class="w"> </span><span class="k">out</span><span class="w"></span>
<span class="n">What</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">password</span><span class="vm">?</span><span class="w"></span>
<span class="n">ZImIT7DyCMOeF6</span><span class="w"></span>
<span class="n">Everything</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">awesome</span><span class="err">!</span><span class="w"></span>
<span class="mf">65141174.</span><span class="n">png</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">w</span><span class="w"></span>
</code></pre></div>

<p>An image is created associated to a character.</p>
<p>We can automatized this for the 48 binary:</p>
<div class="highlight"><pre><span></span><code>root@kalili:~/work/fleggo# for f in *exe; do wine $f &lt;&lt;&lt; `./floss $f | grep &#39;^BRICK&#39; -A 1 | grep -v BRICK` ; done
000f:err:service:process_send_command receiving command result timed out
What is the password?
Everything is awesome!
65141174.png =&gt; w
000f:err:service:process_send_command receiving command result timed out
What is the password?
Everything is awesome!
85934406.png =&gt; m
&lt;SNIP&gt;
</code></pre></div>

<p>A simple redirection allow to keep the information in a file.
In the corner of each image is the position of the associated charactere.
(for instance the image 85934406.png is associated to the letter "m" and the
number in the right corner is 35 so the "m" is in the 35th position).</p>
<p><img alt="Capture8.PNG" src="/media/2018.10/Capture8.PNG"></p>
<p>We might use tesseract in order to automaticaly detect the number in the corner.
But I manualy identify them and got the order of the flag:</p>
<div class="highlight"><pre><span></span><code><span class="n">mor3_awes0m3_th4n_an_awes0me_p0ssum</span><span class="nv">@flare</span><span class="o">-</span><span class="k">on</span><span class="p">.</span><span class="n">com</span><span class="w"></span>
</code></pre></div>

<h2>binstall</h2>
<blockquote>
<p>It is time to get serious. Reverse Engineering isn't about toys and games.
Sometimes its about malicious software. I recommend you run this next
challenge in a VM or someone else's computer you have gained access to,
especially if they are a Firefox user.</p>
</blockquote>
<p><a href="/media/2018.10/flare/binstall.7z">Download the challenge</a></p>
<p>Once unzip we get a simple executable.</p>
<div class="highlight"><pre><span></span><code><span class="o">$</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">binstall</span><span class="o">.</span><span class="n">exe</span><span class="w"></span>
<span class="n">Downloads</span><span class="o">/</span><span class="n">binstall</span><span class="o">/</span><span class="n">binstall</span><span class="o">.</span><span class="n">exe</span><span class="p">:</span><span class="w"> </span><span class="n">PE32</span><span class="w"> </span><span class="n">executable</span><span class="w"> </span><span class="p">(</span><span class="n">console</span><span class="p">)</span><span class="w"> </span><span class="n">Intel</span><span class="w"> </span><span class="mi">80386</span><span class="w"> </span><span class="n">Mono</span><span class="o">/.</span><span class="n">Net</span><span class="w"> </span><span class="n">assembly</span><span class="p">,</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MS</span><span class="w"> </span><span class="n">Windows</span><span class="w"></span>
</code></pre></div>

<p>As said in the descritpion this file is a malware and a lot of AV detect it as
someone uploaded it on <a href="https://www.virustotal.com/#/file/1284211e57621f84118ce28a4df024163f663c6891c9f154883df804b592ee08/detection">virus
total</a>.</p>
<p><img alt="Capture9.PNG" src="/media/2018.10/Capture9.PNG"></p>
<p>I didn't get a lot of time to work on this challenge and didn't solve it.</p>
<h1>Contest ending</h1>
<p>The contest is now over and fireEye realse the <a href="https://www.fireeye.com/blog/threat-research/2018/10/2018-flare-on-challenge-solutions.html">solution for all challenges</a>.</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="../../tag/security.html">security</a>
      <a href="../../tag/reverse.html">reverse</a>
    </p>
  </div>


  <div class="neighbors">
    <a class="btn float-left" href="../../2017/11/vulnhub-born2root.html" title="Vulnhub, born2root">
      <i class="fa fa-angle-left"></i> Previous Post
    </a>
    <a class="btn float-right" href="../../2019/09/htb-jerry.html" title="HTB: Jerry">
      Next Post <i class="fa fa-angle-right"></i>
    </a>
  </div>



</article>

    <footer>
<p>
  &copy; 2022  - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/deed.en_US" target="_blank">Creative Commons Attribution</a>
</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script id="dark-theme-script"
          src="../../theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="True"
          data-default-theme="light"
          type="text/javascript">
  </script>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " maggick's logs ",
  "url" : "../..",
  "image": "https://maggick.fr/media/image.png",
  "description": ""
}
</script>

</body>
</html>